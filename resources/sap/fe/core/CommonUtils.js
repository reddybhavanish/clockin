/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/View","sap/ui/core/Component","sap/m/MessageBox","sap/base/Log","sap/fe/navigation/SelectionVariant","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/odata/v4/FieldBaseDelegate"],function(V,C,M,L,S,F,a){"use strict";var v=["Edm.Boolean","Edm.Byte","Edm.Date","Edm.DateTimeOffset","Edm.Decimal","Edm.Double","Edm.Guid","Edm.Int16","Edm.Int32","Edm.Int64","Edm.SByte","Edm.Single","Edm.String","Edm.TimeOfDay"],e={"Contains":"NotContains","StartsWith":"NotStartsWith","EndsWith":"NotEndsWith","Empty":"NotEmpty","NotEmpty":"Empty","LE":"NOTLE","GE":"NOTGE","LT":"NOTLT","GT":"NOTGT","BT":"NOTBT","NE":"EQ","EQ":"NE"};function g(i){while(i&&!(i instanceof V)){i=i.getParent();}return i;}function h(i){var j=false;i.getCurrentContexts().forEach(function(I){if(I&&I.isTransient()){j=true;}});return j;}function _(i,j,I){var J=false;var K=i.getObject(j+"@Org.OData.Capabilities.V1.FilterRestrictions");if(K&&K.NonFilterableProperties){J=K.NonFilterableProperties.some(function(N){return N.$NavigationPropertyPath===I||N.$PropertyPath===I;});}return J;}function b(i,j,I){var J=I.split("/"),K=false,N="";J.some(function(O,P,Q){if(N.length>0){N+="/"+O;}else{N=O;}if(P===Q.length-1){K=_(i,j,N);}else if(i.getObject(j+"/$NavigationPropertyBinding/"+O)){K=_(i,j,N);N="";j="/"+i.getObject(j+"/$NavigationPropertyBinding/"+O);}return K===true;});return K;}function c(i,j,P,I,J){var K;if(!I){I=j+"/"+P;}if(i.getObject(I+"@com.sap.vocabularies.UI.v1.Hidden")){return false;}if(!J&&i.getObject(I+"@com.sap.vocabularies.UI.v1.HiddenFilter")){return false;}if(typeof P==="string"){P=P;}else{P=i.getObject(I+"@sapui.name");}if(P.indexOf("/")<0){K=_(i,j,P);}else{K=b(i,j,P);}return!K;}function u(I,O,X,J,K,N,P,Q,R){var T={};if(I){if(N&&N.length>0){for(var j=0;j<N.length;j++){var W=N[j].$PropertyPath;if(!T[W]){T[W]=I[W];}}}else{var Y=Q.getObject(R+"/$Type/$Key");for(var Z in Y){var $=Y[Z];if(!T[$]){T[$]=I[$];}}}}var a1=X.getLinks({semanticObject:J,params:T});a1.done(function(b1){b1.sort(function(g1,h1){if(g1.text<h1.text){return-1;}if(g1.text>h1.text){return 1;}return 0;});if(b1&&b1.length>0){var c1=[];for(var i=0;i<b1.length;i++){var d1=b1[i];var e1=d1.intent;var f1=e1.split("-")[1].split("?")[0];if(f1!==K&&(!P||(P&&P.indexOf(f1)===-1))){c1.push({text:d1.text,targetSemObject:e1.split("#")[1].split("-")[0],targetAction:f1.split("~")[0]});}}O.getModel("relatedAppsModel").setProperty("/visibility",c1.length>0);O.getModel("relatedAppsModel").setProperty("/items",c1);}else{O.getModel("relatedAppsModel").setProperty("/visibility",false);}});}function U(O){var i=sap.ushell&&sap.ushell.Container;var X=i&&i.getService("CrossApplicationNavigation");var j=i&&i.getService("URLParsing");var P=j&&j.parseShellHash(document.location.hash);var I=P.semanticObject;var J=P.action;var K=O.getModel().getMetaModel();var N=O.getBindingContext();var Q=N&&N.getPath();var R=K.getMetaPath(Q);var T=R+"/"+"@com.sap.vocabularies.Common.v1.SemanticKey";var W=K.getObject(T);var Y=K.getObject(R+"/"+"@com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions");var Z=N.getObject();if(!Z){N.requestObject().then(function(Z){u(Z,O,X,I,J,W,Y,K,R);});}else{u(Z,O,X,I,J,W,Y,K,R);}}function f(i){var j=["sap.m.Button","sap.m.OverflowToolbarButton"];if(i&&j.indexOf(i.getMetadata().getName())!==-1&&i.getVisible()&&i.getEnabled()){i.firePress();}}function r(i){if(i==="true"||i===true){return true;}else{return false;}}function d(i){var O=C.getOwnerComponentFor(i);if(!O){return i;}else{return d(O);}}function p(P,i,j,I){var J=i&&i.getModel("ui")&&i.getModel("ui").getData(),K=J.createMode||J.editMode==="Editable",R=sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates"),W=R&&R.getText("NAVIGATION_AWAY_MSG"),N=R&&R.getText("NAVIGATION_AWAY_CONFIRM_BUTTON"),O=R&&R.getText("NAVIGATION_AWAY_CANCEL_BUTTON");if(j==="Sticky"&&K){return M.warning(W,{actions:[N,O],onClose:function(Q){if(Q===N){var T=i&&i.getModel("localUI");L.info("Navigation confirmed.");if(T){T.setProperty("/sessionOn",false);}else{L.warning("Local UIModel couldn't be found.");}P();if(I){I.editFlow.fnStickyDiscard(i.getBindingContext());}}else{L.info("Navigation rejected.");}}});}return P();}function n(i,j,I,J,O,K){j=j?j:new S();var N=j.toJSONString();var P=H.getAppComponent(i);if(K){i.getModel("localUI").setProperty("/IBN_OpenInNewTable",true);}P.getService("navigation").then(function(Q){Q.navigate(I,J,N,null,O,null,K?"explace":"inplace");});}function G(i,j){var I=i.getObject("/"+j+"/")||{},P={};for(var K in I){if(I.hasOwnProperty(K)&&!/^\$/i.test(K)&&I[K].$kind&&I[K].$kind==="Property"){P[K]=I[K];}}return P;}function k(i,j){var I;if(i&&j){I=i.getObject("/"+j+"@Org.OData.Capabilities.V1.FilterRestrictions/RequiredProperties");}return I;}function l(j){var I=sap.ushell&&sap.ushell.Container;var X=I&&I.getService("CrossApplicationNavigation");var J=X.getLinks({params:{}});J.then(function(K){if(K&&K.length>0){var N={};for(var i=0;i<K.length;i++){N[K[i].intent.substring(1)]=true;}j.setProperty("/IBNActions",N);}});}function m(i,R,P,j){var I;if(R){if(j){I=i+"|"+j;if(R.getText(I,P,true)){return R.getText(I,P,true);}}if(R.getText(i,P,true)){return R.getText(i,P,true);}}R=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");return R.getText(i,P);}function o(i,R,j,I){j=!j?i.getObject(i.getPath()):j;var J=i.getPath().split("/@")[0];J=i.getObject(J).$Type;J=q(i.getModel(),J);if(I){return i.getObject("/"+J+"/"+j+"@Org.OData.Core.V1.OperationAvailable");}if(R){return"/"+J+"/"+j;}else{return{sEntityName:J,sProperty:i.getObject("/"+J+"/"+j+"@Org.OData.Core.V1.OperationAvailable/$Path"),sBindingParameter:i.getObject("/"+J+"/"+j+"/@$ui5.overload/0/$Parameter/0/$Name")};}}function q(i,j){var I=i.getObject("/");for(var J in I){if(typeof I[J]==="object"&&I[J].$Type===j){return J;}}}function s(P,i){var T=P["@com.sap.vocabularies.Common.v1.Text"],j=T&&((P&&P["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"])||(i&&i["@com.sap.vocabularies.UI.v1.TextArrangement"]));if(j){if(j.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){return"Description";}else if(j.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextLast"){return"ValueDescription";}return"DescriptionValue";}return T?"DescriptionValue":"Value";}function t(j,I,J,K){for(var N in I){j.setProperty(J+"/"+N,false);var P=I[N];for(var i=0;i<K.length;i++){var O=K[i];var Q=O.getObject();if(P===null&&!!Q["#"+N]){j.setProperty(J+"/"+N,true);break;}else if(!!O.getObject(P)){j.setProperty(J+"/"+N,true);break;}}}}function w(R){var i=a.getDataTypeClass(null,R);var j=a.getBaseType(null,i);return F.getOperatorsForType(j);}function x(i,j){var O=i.filter(function(I){return j.indexOf(I)>-1;});return O.toString()||undefined;}function y(P,i,j){var I=j.getObject(i+"@Org.OData.Capabilities.V1.FilterRestrictions");var J=["EQ"];var K=["EQ","BT","BTEX","LT","NOTLT","GT","NOTGT","LE","NOTLE","GE","NOTGE"];var N=["EQ","BT","BTEX","NOTBT","NOTBTEX","LT","NOTLT","GT","NOTGT","LE","NOTLE","GE","NOTGE","NE"];var O=["StartsWith","NotStartsWith","EndsWith","NotEndsWith","Contains","NotContains"];if(I&&I.FilterExpressionRestrictions&&I.FilterExpressionRestrictions.some(function(W){return W.Property.$PropertyPath===P;})){var R=j.getObject(i+"/"+P+"/$Type");var Q=w(R);var T=I.FilterExpressionRestrictions.filter(function(W){return W.Property.$PropertyPath===P;});if(T.some(function(W){return W.AllowedExpressions==="SingleValue"||W.AllowedExpressions==="MultiValue";})){return x(Q,J);}if(T.some(function(W){return W.AllowedExpressions==="SingleRange";})){return x(Q,K);}if(T.some(function(W){return W.AllowedExpressions==="MultiRange";})){return x(Q,N);}if(T.some(function(W){return W.AllowedExpressions==="SearchExpression";})){return x(Q,O);}if(T.some(function(W){return W.AllowedExpressions==="MultiRangeOrSearchExpression";})){return x(Q,O.concat(N));}return undefined;}}function z(i,T){var j;if(v.indexOf(T)>-1){j=i;if(T==="Edm.Boolean"){j=i==="true"||(i==="false"?false:undefined);}else if(T==="Edm.Double"||T==="Edm.Single"){j=isNaN(i)?undefined:parseFloat(i);}else if(T==="Edm.Byte"||T==="Edm.Int16"||T==="Edm.Int32"||T==="Edm.SByte"){j=isNaN(i)?undefined:parseInt(i,10);}else if(T==="Edm.Date"){j=i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)?i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]:i.match(/^(\d{8})/)&&i.match(/^(\d{8})/)[0];}else if(T==="Edm.DateTimeOffset"){if(i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)){j=i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)[0];}else if(i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)){j=i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]+"+0000";}else if(i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)){j=i.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]+"T00:00:00+0000";}else if(i.indexOf("Z")===i.length-1){j=i.split("Z")[0]+"+0100";}else{j=undefined;}}else if(T==="Edm.TimeOfDay"){j=i.match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?i.match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]:undefined;}}return j;}function A(O,i,j,I){var J=i,K,N,P={isEmpty:null,values:[]};if(i===undefined||i===null){return;}switch(O){case"CP":N="Contains";if(J){var Q=J.indexOf("*");var R=J.lastIndexOf("*");if(Q>-1){if(Q===0&&R!==J.length-1){N="EndsWith";J=J.substring(1,J.length);}else if(Q!==0&&R===J.length-1){N="StartsWith";J=J.substring(0,J.length-1);}else{J=J.substring(1,J.length-1);}}else{L.warning("Contains Option cannot be used without '*'.");return;}}break;case"EQ":N=i===""?"Empty":O;break;case"NE":N=i===""?"NotEmpty":O;break;case"BT":if(j===undefined||j===null){return;}K=j;N=O;break;case"LE":case"GE":case"GT":case"LT":N=O;break;default:L.warning("Selection Option is not supported : '"+O+"'");return;}if(I==="E"){N=e[N];}P.operator=N;P.values.push(J);if(K){P.values.push(K);}return P;}function B(i,j,I,J){var K=i.getSelectOptionsPropertyNames(),N=H.getEntitySetProperties(I,J),P=i.getParameterNames();P.forEach(function(O){if(O.substring(0,2)==="P_"){var Q=O;O=O.slice(2,O.length);if(K.indexOf(O)==-1){if(O in N){var R=i.getParameter(Q),T=H.getValueTypeCompliant(R,N[O].$Type),W;if(T!==undefined||T!==null){W={isEmpty:null,operator:"EQ",values:[T]};j[O]=j.hasOwnProperty(O)?j[O].concat([W]):[W];}}}}});K.forEach(function(O){var Q=O;if(O.substring(0,2)==="P_"){O=O.slice(2,O.length);if(K.indexOf(O)>-1){O="";}}if(O in N){var R=[],T,W;if(H.isPropertyFilterable(I,"/"+J,O,false,true)){T=i.getSelectOption(Q==O?O:Q);W=H.getOperatorsForProperty(O,"/"+J,I);R=T.reduce(function(X,Y){var Z=H.getValueTypeCompliant(Y.Low,N[O].$Type),$=Y.High?H.getValueTypeCompliant(Y.High,N[O].$Type):undefined;if((Z!==undefined||Z!==null)&&Y.Option){var a1=H.createConditions(Y.Option,Z,$,Y.Sign);if(!W||W.indexOf(a1.operator)>-1){X.push(a1);}}return X;},R);if(R.length){j[O]=j.hasOwnProperty(O)?j[O].concat(R):R;}}}});return j;}function D(i,j){var I,J="",K=null;var N=function(T,W,X){var Y={option:"",sign:"I",low:W,high:X};switch(T){case"Contains":Y.option="CP";break;case"StartsWith":Y.option="CP";Y.low+="*";break;case"EndsWith":Y.option="CP";Y.low="*"+Y.low;break;case"BT":case"LE":case"LT":case"GT":case"NE":case"EQ":Y.option=T;break;case"EEQ":Y.option="EQ";break;case"Empty":Y.option="EQ";Y.low="";break;case"NotContains":Y.option="CP";Y.sign="E";break;case"NOTBT":Y.option="BT";Y.sign="E";break;case"NotStartsWith":Y.option="CP";Y.low+="*";Y.sign="E";break;case"NotEndsWith":Y.option="CP";Y.low="*"+Y.low;Y.sign="E";break;case"NotEmpty":Y.option="NE";Y.low="";break;case"NOTLE":Y.option="LE";Y.sign="E";break;case"NOTGE":Y.option="GE";Y.sign="E";break;case"NOTLT":Y.option="LT";Y.sign="E";break;case"NOTGT":Y.option="GT";Y.sign="E";break;default:L.warning(T+" is not supported. "+I+" could not be added to the navigation context");}return Y;};j=j.filter||j;for(var I in j){if(I==="$editState"){continue;}var O=j[I];for(var P in O){var Q=O[P];J=Q.values[0].toString();K=(Q.values[1]&&Q.values[1].toString())||null;var R=N(Q.operator,J,K);if(R.option){i.addSelectOption(I,R.sign,R.option,R.low,R.high);}}}return i;}function E(i,j){var I=i&&i.getModel("ui")&&i.getModel("ui").getData();var J=I.createMode||I.editMode==="Editable";return j==="Sticky"&&J;}var H={isPropertyFilterable:c,fireButtonPress:f,getParentViewOfControl:g,hasTransientContext:h,updateRelatedAppsDetails:U,resolveStringtoBoolean:r,getAppComponent:d,processDataLossConfirmation:p,navigateToExternalApp:n,getMandatoryFilterFields:k,getEntitySetProperties:G,updateDataFiledForIBNButtonsVisibility:l,getTranslatedText:m,getEntitySetName:q,getActionPath:o,computeDisplayMode:s,setActionEnablement:t,isStickyEditMode:E,getOperatorsForProperty:y,addSelectionVariantToConditions:B,addExternalStateFiltersToSelectionVariant:D,createConditions:A,getValueTypeCompliant:z};return H;});
