sap.ui.define(["./templates/index","sap/fe/core/converters/common/AnnotationConverter","./Constants"],function(t,A,C){"use strict";var V=C.VOCABULARY_ALIAS;function _(o,k,v){if(k in o){Object.defineProperty(o,k,{value:v,enumerable:true,configurable:true,writable:true});}else{o[k]=v;}return o;}function a(g,i){return f(g)||e(g,i)||c(g,i)||b();}function b(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function c(o,m){if(!o)return;if(typeof o==="string")return d(o,m);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(o,m);}function d(g,l){if(l==null||l>g.length)l=g.length;for(var i=0,h=new Array(l);i<l;i++){h[i]=g[i];}return h;}function e(g,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(g)))return;var h=[];var j=true;var k=false;var l=undefined;try{for(var m=g[Symbol.iterator](),n;!(j=(n=m.next()).done);j=true){h.push(n.value);if(i&&h.length===i)break;}}catch(o){k=true;l=o;}finally{try{if(!j&&m["return"]!=null)m["return"]();}finally{if(k)throw l;}}return h;}function f(g){if(Array.isArray(g))return g;}var T;(function(T){T["ListReport"]="ListReport";T["ObjectPage"]="ObjectPage";})(T||(T={}));var M={parsePropertyValue:function(g,p,h,i){var j=this;var v;var k=h+"/"+p;if(typeof g==="string"){v={type:"String",String:g};}else if(typeof g==="boolean"){v={type:"Bool",Bool:g};}else if(typeof g==="number"){v={type:"Int",Int:g};}else if(Array.isArray(g)){v={type:"Collection",Collection:g.map(function(s,l){return j.parseAnnotationObject(s,k+"/"+l,i);})};if(g.length>0){if(g[0].hasOwnProperty("$PropertyPath")){v.Collection.type="PropertyPath";}else if(g[0].hasOwnProperty("$Path")){v.Collection.type="Path";}else if(g[0].hasOwnProperty("$NavigationPropertyPath")){v.Collection.type="NavigationPropertyPath";}else if(g[0].hasOwnProperty("$AnnotationPath")){v.Collection.type="AnnotationPath";}else if(g[0].hasOwnProperty("$Type")){v.Collection.type="Record";}else if(typeof g[0]==="object"){v.Collection.type="Record";}else{v.Collection.type="String";}}}else if(g.$Path!==undefined){v={type:"Path",Path:g.$Path};}else if(g.$Decimal!==undefined){v={type:"Decimal",Decimal:parseFloat(g.$Decimal)};}else if(g.$PropertyPath!==undefined){v={type:"PropertyPath",PropertyPath:g.$PropertyPath};}else if(g.$NavigationPropertyPath!==undefined){v={type:"NavigationPropertyPath",NavigationPropertyPath:g.$NavigationPropertyPath};}else if(g.$AnnotationPath!==undefined){v={type:"AnnotationPath",AnnotationPath:g.$AnnotationPath};}else if(g.$EnumMember!==undefined){v={type:"EnumMember",EnumMember:this.mapNameToAlias(g.$EnumMember.split("/")[0])+"/"+g.$EnumMember.split("/")[1]};}else if(g.$Type){v={type:"Record",Record:this.parseAnnotationObject(g,h,i)};}return{name:p,value:v};},mapNameToAlias:function(g){var h=g.split("@"),i=a(h,2),p=i[0],j=i[1];if(!j){j=p;p="";}else{p+="@";}var l=j.lastIndexOf(".");return p+V[j.substr(0,l)]+"."+j.substr(l+1);},parseAnnotationObject:function(g,h,i){var j=this;var p={};var k=false;if(typeof g==="string"){p={type:"String",String:g};}else if(typeof g==="boolean"){p={type:"Bool",Bool:g};}else if(typeof g==="number"){p={type:"Int",Int:g};}else if(g.$AnnotationPath!==undefined){p={type:"AnnotationPath",AnnotationPath:g.$AnnotationPath};}else if(g.$Path!==undefined){p={type:"Path",Path:g.$Path};}else if(g.$Decimal!==undefined){p={type:"Decimal",Decimal:parseFloat(g.$Decimal)};}else if(g.$PropertyPath!==undefined){p={type:"PropertyPath",PropertyPath:g.$PropertyPath};}else if(g.$NavigationPropertyPath!==undefined){p={type:"NavigationPropertyPath",NavigationPropertyPath:g.$NavigationPropertyPath};}else if(g.$EnumMember!==undefined){p={type:"EnumMember",EnumMember:this.mapNameToAlias(g.$EnumMember.split("/")[0])+"/"+g.$EnumMember.split("/")[1]};}else if(Array.isArray(g)){k=true;var l=p;l.collection=g.map(function(s,r){return j.parseAnnotationObject(s,h+"/"+r,i);});if(g.length>0){if(g[0].hasOwnProperty("$PropertyPath")){l.collection.type="PropertyPath";}else if(g[0].hasOwnProperty("$Path")){l.collection.type="Path";}else if(g[0].hasOwnProperty("$NavigationPropertyPath")){l.collection.type="NavigationPropertyPath";}else if(g[0].hasOwnProperty("$AnnotationPath")){l.collection.type="AnnotationPath";}else if(g[0].hasOwnProperty("$Type")){l.collection.type="Record";}else if(typeof g[0]==="object"){l.collection.type="Record";}else{l.collection.type="String";}}}else{if(g.$Type){var m=g.$Type;var n=V[m.substr(0,m.lastIndexOf("."))];var o=m.substr(m.lastIndexOf(".")+1);p.type="".concat(n,".").concat(o);}var q=[];Object.keys(g).forEach(function(r){if(r!=="$Type"&&!r.startsWith("@")){q.push(j.parsePropertyValue(g[r],r,h,i));}else if(r.startsWith("@")){var s=r.split("#");var u=s[1];var v=s[0];var w=j.getOrCreateAnnotationList(h,i);w.annotations.push({term:j.mapNameToAlias(v.substr(1)),qualifier:u,value:j.parseAnnotationObject(g[r],h,i),isCollection:false});}});p.propertyValues=q;}return p;},getOrCreateAnnotationList:function(g,h){var p=h.find(function(i){return i.target===g;});if(!p){p={target:g,annotations:[]};h.push(p);}return p;},createAnnotationLists:function(m,g,h,i){var j=this;var o={target:h,annotations:[]};Object.keys(g).forEach(function(k){var l=o;var n=g[k];var p=k.split("#");var q=p[1];k=p[0];var r=k.split("@");if(r.length>2){l=j.getOrCreateAnnotationList(h+"@"+j.mapNameToAlias(r[1]),i);k=r[2];}else{k=r[1];}var s=V[k.substr(0,k.lastIndexOf("."))];var u=k.substr(k.lastIndexOf(".")+1);var v={term:"".concat(s,".").concat(u),qualifier:q};var w=h+"@"+v.term;if(q){w+="#"+q;}var x=false;if(n===null){v.value={type:"Bool",Bool:n};}else if(typeof n==="string"){v.value={type:"String",String:n};}else if(typeof n==="boolean"){v.value={type:"Bool",Bool:n};}else if(typeof n==="number"){v.value={type:"Int",Int:n};}else if(n.$Path!==undefined){v.value={type:"Path",Path:n.$Path};}else if(n.$AnnotationPath!==undefined){v.value={type:"AnnotationPath",AnnotationPath:n.$AnnotationPath};}else if(n.$Decimal!==undefined){v.value={type:"Decimal",Decimal:parseFloat(n.$Decimal)};}else if(n.$EnumMember!==undefined){v.value={type:"EnumMember",EnumMember:j.mapNameToAlias(n.$EnumMember.split("/")[0])+"/"+n.$EnumMember.split("/")[1]};}else if(Array.isArray(n)){x=true;v.collection=n.map(function(F,G){return j.parseAnnotationObject(F,w+"/"+G,i);});if(n.length>0){if(n[0].hasOwnProperty("$PropertyPath")){v.collection.type="PropertyPath";}else if(n[0].hasOwnProperty("$Path")){v.collection.type="Path";}else if(n[0].hasOwnProperty("$NavigationPropertyPath")){v.collection.type="NavigationPropertyPath";}else if(n[0].hasOwnProperty("$AnnotationPath")){v.collection.type="AnnotationPath";}else if(n[0].hasOwnProperty("$Type")){v.collection.type="Record";}else if(typeof n[0]==="object"){v.collection.type="Record";}else{v.collection.type="String";}}}else{var y={propertyValues:[]};if(n.$Type){var z=n.$Type;var B=V[z.substr(0,z.lastIndexOf("."))];var D=z.substr(z.lastIndexOf(".")+1);y.type="".concat(B,".").concat(D);}var E=[];Object.keys(n).forEach(function(F){if(F!=="$Type"&&!F.startsWith("@")){E.push(j.parsePropertyValue(n[F],F,w,i));}else if(F.startsWith("@")){i.push({target:w,annotations:[{value:j.parseAnnotationObject(n[F],w,i)}]});}});y.propertyValues=E;v.record=y;}v.isCollection=x;l.annotations.push(v);});if(o.annotations.length>0){i.push(o);}},parseProperty:function(m,g,p,h){var i=m.getObject("/".concat(g.name,"/").concat(p,"@"));var j=m.getObject("/".concat(g.name,"/").concat(p));var k={_type:"Property",name:p,fullyQualifiedName:"".concat(g.fullyQualifiedName,"/").concat(p),type:j.$Type,maxLength:j.$MaxLength,precision:j.$Precision,scale:j.$Scale,nullable:j.$Nullable,annotations:{}};this.createAnnotationLists(m,i,k.fullyQualifiedName,h);return k;},parseNavigationProperty:function(m,g,n,h){var i=m.getObject("/".concat(g.name,"/").concat(n,"@"));var j=m.getObject("/".concat(g.name,"/").concat(n));var r=[];if(j.$ReferentialConstraint){r=Object.keys(j.$ReferentialConstraint).map(function(s){return{sourceTypeName:g.name,sourceProperty:s,targetTypeName:j.$Type,targetProperty:j.$ReferentialConstraint[s]};});}var k={_type:"NavigationProperty",name:n,fullyQualifiedName:"".concat(g.fullyQualifiedName,"/").concat(n),partner:j.$Partner,isCollection:j.$isCollection?j.$isCollection:false,targetTypeName:j.$Type,referentialConstraint:r,annotations:{}};this.createAnnotationLists(m,i,k.fullyQualifiedName,h);return k;},parseEntityType:function(m,g,h,i){var j=this;var k=m.getObject("/".concat(g));var l=m.getObject("/".concat(g,"@"));var n=m.getObject("/".concat(g,"/@"));var o=m.getObject("/".concat(g,"/"));var p=o.$Key;var q={_type:"EntityType",name:g,fullyQualifiedName:k.$Type,keys:[],entityProperties:[],navigationProperties:[],annotations:{getAnnotation:function(v){return q.annotations[v];}}};var r={_type:"EntitySet",name:g,navigationPropertyBinding:{},entityType:k.$Type,fullyQualifiedName:"".concat(i,"/").concat(g)};this.createAnnotationLists(m,n,q.fullyQualifiedName,h);this.createAnnotationLists(m,l,r.fullyQualifiedName,h);var s=Object.keys(o).filter(function(v){if(v!="$Key"&&v!="$kind"){return o[v].$kind==="Property";}}).map(function(v){return j.parseProperty(m,q,v,h);});var u=Object.keys(o).filter(function(v){if(v!="$Key"&&v!="$kind"){return o[v].$kind==="NavigationProperty";}}).map(function(v){return j.parseNavigationProperty(m,q,v,h);});q.keys=p.map(function(v){return s.find(function(w){return w.name===v;});});q.entityProperties=s;q.navigationProperties=u;return{entityType:q,entitySet:r};},parseAction:function(g,h,n){var i="";var j="".concat(g);if(h.$IsBound){i=h.$Parameter.filter(function(k){return k.$Name===h.$EntitySetPath;}).map(function(k){return k.$Type;}).join("");j="".concat(g,"(").concat(i,")");}var p=h.$Parameter||[];return{_type:"Action",name:g.substr(n.length+1),fullyQualifiedName:j,isBound:h.$IsBound,sourceType:i,returnType:h.$ReturnType?h.$ReturnType.$Type:"",parameters:p.map(function(k){return{_type:"ActionParameter",isEntitySet:k.$Type===h.$EntitySetPath,fullyQualifiedName:"".concat(j,"/").concat(k.$Name),type:k.$Type};})};},parseEntityTypes:function(m){var g=this;var o=m.getObject("/$");var E=m.getObject("/");var h=[];var i=[];var j=[];var k=o.$EntityContainer;Object.keys(E).filter(function(r){return r!=="$kind"&&E[r].$kind==="EntitySet";}).forEach(function(r){var v=g.parseEntityType(m,r,h,k),w=v.entityType,x=v.entitySet;i.push(w);j.push(x);});j.forEach(function(r){var v=o[k][r.name].$NavigationPropertyBinding;if(v){Object.keys(v).forEach(function(w){var x=j.find(function(y){return y.name===v[w];});if(x){r.navigationPropertyBinding[w]=x;}});}});var u=function(r){if(!r){return r;}var v=r.split("."),w=a(v,2),x=w[0],y=w[1];var n=Object.keys(V).find(function(G){return V[G]===x;});if(n){return"".concat(n,".").concat(y);}else{if(r.indexOf("@")!==-1){var z=r.split("@"),B=a(z,2),D=B[0],F=B[1];return"".concat(D,"@").concat(u(F));}else{return r;}}};var n="";var s=Object.keys(o).filter(function(r){return o[r].$kind==="Schema";});if(s&&s.length>0){n=s[0].substr(0,s[0].length-1);}else if(i&&i.length){n=i[0].fullyQualifiedName.replace(i[0].name,"");n=n.substr(0,n.length-1);}var l=Object.keys(o).filter(function(r){return Array.isArray(o[r])&&o[r].length>0&&o[r][0].$kind==="Action";}).reduce(function(r,v){var l=o[v];l.forEach(function(w){r.push(g.parseAction(v,w,n));});return r;},[]);var p=o.$Annotations;var q=Object.keys(p).filter(function(r){return r.indexOf("(")!==-1;});q.forEach(function(r){g.createAnnotationLists(m,o.$Annotations[r],r,h);});return{identification:"metamodelResult",version:"4.0",schema:{entityContainer:{},entitySets:j,entityTypes:i,associations:[],actions:l,namespace:n,annotations:{"metamodelResult":h}},references:[],unalias:u};},convertTypes:function(m){var p=this.parseEntityTypes(m);return A.convertTypes(p);},convertPage:function(s,m,o){var g=this.convertTypes(m);var E=o.entitySet;var h=g.schema.entitySets.find(function(j){return j.name===E;});if(h){var i=m.createBindingContext("/"+E);return _({},E,t[s].convertPage(h,i,o,g.unalias));}}};return M;});
