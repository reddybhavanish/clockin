sap.ui.define(["././TableConverter", "././ChartConverter", "./CommonConverter"], function (TableConverter, ChartConverter, CommonConverter) {
  "use strict";

  var _exports = {};
  var getTemplateAnnotationPath = CommonConverter.getTemplateAnnotationPath;
  var getOnlyAnnotation = CommonConverter.getOnlyAnnotation;
  var getNavigationProperties = CommonConverter.getNavigationProperties;
  var getTargetEntityType = CommonConverter.getTargetEntityType;
  var getChartProperties = ChartConverter.getChartProperties;
  var getTableManifestConfiguration = TableConverter.getTableManifestConfiguration;
  var getTableAnnotationConfiguration = TableConverter.getTableAnnotationConfiguration;
  var getTableActionsConfiguration = TableConverter.getTableActionsConfiguration;

  function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

  function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

  function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

  var _getSelectionFields = function (context, selectionVariants) {
    var _entityType$annotatio, _entityType$annotatio2, _entityType$annotatio3;

    var entityType = context.entityType;
    var selectionFields = [];
    var oSelectionVariantFields = {};
    selectionVariants === null || selectionVariants === void 0 ? void 0 : selectionVariants.forEach(function (selectionVariant) {
      selectionVariant.propertyNames.forEach(function (propertyName) {
        if (!oSelectionVariantFields[propertyName]) {
          oSelectionVariantFields[propertyName] = true;
        }
      });
    });
    (_entityType$annotatio = entityType.annotations) === null || _entityType$annotatio === void 0 ? void 0 : (_entityType$annotatio2 = _entityType$annotatio.UI) === null || _entityType$annotatio2 === void 0 ? void 0 : (_entityType$annotatio3 = _entityType$annotatio2.SelectionFields) === null || _entityType$annotatio3 === void 0 ? void 0 : _entityType$annotatio3.forEach(function (selection, selectionIndex) {
      var selectionFieldValue = selection.value;

      if (!oSelectionVariantFields[selectionFieldValue]) {
        selectionFields.push({
          readablePath: selectionFieldValue,
          templatingPath: "/" + entityType.name + "/@com.sap.vocabularies.UI.v1.SelectionFields/" + selectionIndex + "/$PropertyPath"
        });
      }
    });
    return selectionFields;
  };
  /**
   * Get Page presentation properties (LineItem, SelectionFields, Chart configuration and Table configuration).
   * @param {PageConverterContext} [context] Page Context
   * @param {string} [presentationPath] relative annotation Path used for presentation (PResentation Variant or Line Item)
   * @returns {PresentationConfiguration} object containing LineItem, SelectionFields, Chart configuration and Table configuration
   */


  function getPresentation(context, presentationPath) {
    var _oEntityType$annotati;

    var entityType = context.entityType,
        manifestSettings = context.manifestSettings;
    var annotationPath = presentationPath;
    var result = {};
    var navigationInfo = getNavigationProperties(presentationPath, entityType);
    var defaultAnnotationPath = navigationInfo.prefix + "@com.sap.vocabularies.UI.v1.LineItem";
    var visualizationLineItemPath = "",
        visualizationChartPath = "";
    var oEntityType = navigationInfo.property ? getTargetEntityType(navigationInfo.property, entityType) : entityType;
    var visualizationPaths = [],
        selectionVariants = [],
        isCompliantPresentationVariant = false;
    var presentationVariant = (_oEntityType$annotati = oEntityType.annotations) === null || _oEntityType$annotati === void 0 ? void 0 : _oEntityType$annotati.getAnnotation("UI")[getOnlyAnnotation(annotationPath)];

    if (presentationVariant && presentationVariant.$Type === "com.sap.vocabularies.UI.v1.PresentationVariantType") {
      // Presentation Variant
      var visualizations = presentationVariant.Visualizations;

      if (visualizations) {
        for (var i = 0; i < visualizations.length; i++) {
          var targetAnnotationPath = visualizations[i].value;
          var itemPath = navigationInfo.prefix + targetAnnotationPath;

          if (targetAnnotationPath && targetAnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.LineItem") > -1 && !visualizationLineItemPath) {
            visualizationPaths.push(itemPath);
            isCompliantPresentationVariant = true;
            result.annotationPath = getTemplateAnnotationPath(presentationVariant.fullyQualifiedName, entityType);
            visualizationLineItemPath = itemPath;
          } else if (targetAnnotationPath && targetAnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.Chart") > -1 && sap.ui.Device && sap.ui.Device.system.desktop && !navigationInfo.property && // Currently chart is not managed with navigation Property
          !visualizationChartPath) {
            visualizationPaths.push(itemPath);
            visualizationChartPath = itemPath;
          }

          if (visualizationLineItemPath && visualizationChartPath) {
            i = visualizations.length;
          }
        }
      }

      if (!isCompliantPresentationVariant) {
        visualizationLineItemPath = defaultAnnotationPath;
        visualizationPaths = [defaultAnnotationPath];
        annotationPath = defaultAnnotationPath;
      }
    } else {
      visualizationLineItemPath = annotationPath.indexOf("@com.sap.vocabularies.UI.v1.LineItem") > -1 ? annotationPath : defaultAnnotationPath;
      visualizationPaths = [visualizationLineItemPath];
    } //Calculate Threshold for Table


    if (isCompliantPresentationVariant && presentationVariant.MaxItems) {
      result.threshold = presentationVariant.MaxItems;
    } else {
      result.threshold = navigationInfo.property ? 10 : 30;
    }

    result.visualizationPaths = [];
    visualizationPaths.forEach(function (itemPath) {
      var _oEntityType$annotati2;

      var visualization = (_oEntityType$annotati2 = oEntityType.annotations) === null || _oEntityType$annotati2 === void 0 ? void 0 : _oEntityType$annotati2.getAnnotation("UI")[getOnlyAnnotation(itemPath)];

      if (visualization) {
        var targetPath = "/" + entityType.name + "/" + itemPath;
        result.visualizationPaths.push(targetPath);
      }
    });

    if (!result.annotationPath) {
      result.annotationPath = result.visualizationPaths[0];
    }

    if (manifestSettings.controlConfiguration) {
      var _manifestSettings$con, _manifestSettings$con2, _manifestSettings$con3, _manifestSettings$con4;

      (_manifestSettings$con = manifestSettings.controlConfiguration[visualizationLineItemPath]) === null || _manifestSettings$con === void 0 ? void 0 : (_manifestSettings$con2 = _manifestSettings$con.tableSettings) === null || _manifestSettings$con2 === void 0 ? void 0 : (_manifestSettings$con3 = _manifestSettings$con2.quickVariantSelection) === null || _manifestSettings$con3 === void 0 ? void 0 : (_manifestSettings$con4 = _manifestSettings$con3.paths) === null || _manifestSettings$con4 === void 0 ? void 0 : _manifestSettings$con4.forEach(function (path) {
        var _oEntityType$annotati3;

        var selection = (_oEntityType$annotati3 = oEntityType.annotations) === null || _oEntityType$annotati3 === void 0 ? void 0 : _oEntityType$annotati3.getAnnotation("UI")[getOnlyAnnotation(path.annotationPath)];

        if (selection) {
          var _selection$SelectOpti;

          var propertyNames = [];
          (_selection$SelectOpti = selection.SelectOptions) === null || _selection$SelectOpti === void 0 ? void 0 : _selection$SelectOpti.forEach(function (selectOption) {
            var propertyName = selectOption.PropertyName;
            var PropertyPath = propertyName.value;

            if (propertyNames.indexOf(PropertyPath) === -1) {
              propertyNames.push(PropertyPath);
            }
          });
          selectionVariants.push({
            text: selection.Text,
            key: path.annotationPath,
            propertyNames: propertyNames
          });
        }
      });
    }

    var presentationConfiguration = _objectSpread({}, result, {}, {
      selectionFields: navigationInfo.property ? undefined : _getSelectionFields(context, selectionVariants),
      lineItemPath: visualizationLineItemPath,
      entityName: entityType.name,
      targetEntityName: oEntityType.name,
      quickVariantSelection: selectionVariants
    });

    var visualizationContext = _objectSpread({}, {
      visualizationPath: visualizationLineItemPath
    }, {}, context);

    var tableConfiguration = {
      annotation: getTableAnnotationConfiguration(visualizationContext),
      control: getTableManifestConfiguration(visualizationContext),
      actions: getTableActionsConfiguration(visualizationLineItemPath, entityType, manifestSettings)
    };
    presentationConfiguration = _objectSpread({}, presentationConfiguration, {}, {
      tableConfiguration: tableConfiguration
    }); //Get Chart properties

    if (visualizationChartPath && isCompliantPresentationVariant) {
      visualizationContext.visualizationPath = visualizationChartPath;
      presentationConfiguration.chartConfiguration = getChartProperties(visualizationContext);
    }

    return presentationConfiguration;
  }

  _exports.getPresentation = getPresentation;
  return _exports;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlByZXNlbnRhdGlvbkNvbnZlcnRlci50cyJdLCJuYW1lcyI6WyJfZ2V0U2VsZWN0aW9uRmllbGRzIiwiY29udGV4dCIsInNlbGVjdGlvblZhcmlhbnRzIiwiZW50aXR5VHlwZSIsInNlbGVjdGlvbkZpZWxkcyIsIm9TZWxlY3Rpb25WYXJpYW50RmllbGRzIiwiZm9yRWFjaCIsInNlbGVjdGlvblZhcmlhbnQiLCJwcm9wZXJ0eU5hbWVzIiwicHJvcGVydHlOYW1lIiwiYW5ub3RhdGlvbnMiLCJVSSIsIlNlbGVjdGlvbkZpZWxkcyIsInNlbGVjdGlvbiIsInNlbGVjdGlvbkluZGV4Iiwic2VsZWN0aW9uRmllbGRWYWx1ZSIsInZhbHVlIiwicHVzaCIsInJlYWRhYmxlUGF0aCIsInRlbXBsYXRpbmdQYXRoIiwibmFtZSIsImdldFByZXNlbnRhdGlvbiIsInByZXNlbnRhdGlvblBhdGgiLCJtYW5pZmVzdFNldHRpbmdzIiwiYW5ub3RhdGlvblBhdGgiLCJyZXN1bHQiLCJuYXZpZ2F0aW9uSW5mbyIsImdldE5hdmlnYXRpb25Qcm9wZXJ0aWVzIiwiZGVmYXVsdEFubm90YXRpb25QYXRoIiwicHJlZml4IiwidmlzdWFsaXphdGlvbkxpbmVJdGVtUGF0aCIsInZpc3VhbGl6YXRpb25DaGFydFBhdGgiLCJvRW50aXR5VHlwZSIsInByb3BlcnR5IiwiZ2V0VGFyZ2V0RW50aXR5VHlwZSIsInZpc3VhbGl6YXRpb25QYXRocyIsImlzQ29tcGxpYW50UHJlc2VudGF0aW9uVmFyaWFudCIsInByZXNlbnRhdGlvblZhcmlhbnQiLCJnZXRBbm5vdGF0aW9uIiwiZ2V0T25seUFubm90YXRpb24iLCIkVHlwZSIsInZpc3VhbGl6YXRpb25zIiwiVmlzdWFsaXphdGlvbnMiLCJpIiwibGVuZ3RoIiwidGFyZ2V0QW5ub3RhdGlvblBhdGgiLCJpdGVtUGF0aCIsImluZGV4T2YiLCJnZXRUZW1wbGF0ZUFubm90YXRpb25QYXRoIiwiZnVsbHlRdWFsaWZpZWROYW1lIiwic2FwIiwidWkiLCJEZXZpY2UiLCJzeXN0ZW0iLCJkZXNrdG9wIiwiTWF4SXRlbXMiLCJ0aHJlc2hvbGQiLCJ2aXN1YWxpemF0aW9uIiwidGFyZ2V0UGF0aCIsImNvbnRyb2xDb25maWd1cmF0aW9uIiwidGFibGVTZXR0aW5ncyIsInF1aWNrVmFyaWFudFNlbGVjdGlvbiIsInBhdGhzIiwicGF0aCIsIlNlbGVjdE9wdGlvbnMiLCJzZWxlY3RPcHRpb24iLCJQcm9wZXJ0eU5hbWUiLCJQcm9wZXJ0eVBhdGgiLCJ0ZXh0IiwiVGV4dCIsImtleSIsInByZXNlbnRhdGlvbkNvbmZpZ3VyYXRpb24iLCJ1bmRlZmluZWQiLCJsaW5lSXRlbVBhdGgiLCJlbnRpdHlOYW1lIiwidGFyZ2V0RW50aXR5TmFtZSIsInZpc3VhbGl6YXRpb25Db250ZXh0IiwidmlzdWFsaXphdGlvblBhdGgiLCJ0YWJsZUNvbmZpZ3VyYXRpb24iLCJhbm5vdGF0aW9uIiwiZ2V0VGFibGVBbm5vdGF0aW9uQ29uZmlndXJhdGlvbiIsImNvbnRyb2wiLCJnZXRUYWJsZU1hbmlmZXN0Q29uZmlndXJhdGlvbiIsImFjdGlvbnMiLCJnZXRUYWJsZUFjdGlvbnNDb25maWd1cmF0aW9uIiwiY2hhcnRDb25maWd1cmF0aW9uIiwiZ2V0Q2hhcnRQcm9wZXJ0aWVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBLE1BQU1BLG1CQUFtQixHQUFHLFVBQzNCQyxPQUQyQixFQUUzQkMsaUJBRjJCLEVBR0Y7QUFBQTs7QUFBQSxRQUNqQkMsVUFEaUIsR0FDRkYsT0FERSxDQUNqQkUsVUFEaUI7QUFFekIsUUFBSUMsZUFBdUMsR0FBRyxFQUE5QztBQUNBLFFBQUlDLHVCQUE0QixHQUFHLEVBQW5DO0FBQ0FILElBQUFBLGlCQUFpQixTQUFqQixJQUFBQSxpQkFBaUIsV0FBakIsWUFBQUEsaUJBQWlCLENBQUVJLE9BQW5CLENBQTJCLFVBQUNDLGdCQUFELEVBQTBEO0FBQ3BGQSxNQUFBQSxnQkFBZ0IsQ0FBQ0MsYUFBakIsQ0FBK0JGLE9BQS9CLENBQXVD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ckIsS0FBUixNQUE2RDdCLE9BQTdELENBQXpEOztBQUNBLFFBQUk2RSxrQkFBdUIsR0FBRztBQUM3QkMsTUFBQUEsVUFBVSxFQUFFQywrQkFBK0IsQ0FBQ0osb0JBQUQsQ0FEZDtBQUU3QkssTUFBQUEsT0FBTyxFQUFFQyw2QkFBNkIsQ0FBQ04sb0JBQUQsQ0FGVDtBQUc3Qk8sTUFBQUEsT0FBTyxFQUFFQyw0QkFBNEIsQ0FBQ3RELHlCQUFELEVBQTRCM0IsVUFBNUIsRUFBd0NvQixnQkFBeEM7QUFIUixLQUE5QjtBQU1BZ0QsSUFBQUEseUJBQXlCLHFCQUNyQkEseUJBRHFCLE1BRXJCO0FBQ0ZPLE1BQUFBLGtCQUFrQixFQUFFQTtBQURsQixLQUZxQixDQUF6QixDQTNIbUgsQ0FrSW5IOztBQUNBLFFBQUkvQyxzQkFBc0IsSUFBSUssOEJBQTlCLEVBQThEO0FBQzdEd0MsTUFBQUEsb0JBQW9CLENBQUNDLGlCQUFyQixHQUF5QzlDLHNCQUF6QztBQUNBd0MsTUFBQUEseUJBQXlCLENBQUNjLGtCQUExQixHQUErQ0Msa0JBQWtCLENBQUNWLG9CQUFELENBQWpFO0FBQ0E7O0FBRUQsV0FBT0wseUJBQVA7QUFDQSIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRW50aXR5VHlwZSwgQW5ub3RhdGlvblBhdGgsIFNlbGVjdGlvblZhcmlhbnRUeXBlLCBTZWxlY3RPcHRpb25UeXBlLCBQcm9wZXJ0eVBhdGggfSBmcm9tIFwiQHNhcC11eC92b2NhYnVsYXJpZXMtdHlwZXNcIjtcbmltcG9ydCB7XG5cdEZpbHRlclNlbGVjdGlvbkZpZWxkLFxuXHRQYWdlQ29udmVydGVyQ29udGV4dCxcblx0UHJlc2VudGF0aW9uQ29uZmlndXJhdGlvbixcblx0UXVpY2tTZWxlY3Rpb25WYXJpYW50Q29uZmlndXJhdGlvbixcblx0VGFibGVDb25maWd1cmF0aW9uLFxuXHRWaXN1YWxpemF0aW9uQ29udmVydGVyQ29udGV4dFxufSBmcm9tIFwiLi4vTWFuaWZlc3RTZXR0aW5nc1wiO1xuaW1wb3J0IHsgZ2V0VGFibGVBY3Rpb25zQ29uZmlndXJhdGlvbiwgZ2V0VGFibGVBbm5vdGF0aW9uQ29uZmlndXJhdGlvbiwgZ2V0VGFibGVNYW5pZmVzdENvbmZpZ3VyYXRpb24gfSBmcm9tIFwiLi8uL1RhYmxlQ29udmVydGVyXCI7XG5pbXBvcnQgeyBnZXRDaGFydFByb3BlcnRpZXMgfSBmcm9tIFwiLi8uL0NoYXJ0Q29udmVydGVyXCI7XG5pbXBvcnQge1xuXHROYXZpZ2F0aW9uUHJvcGVydHksXG5cdGdldFRhcmdldEVudGl0eVR5cGUsXG5cdGdldE5hdmlnYXRpb25Qcm9wZXJ0aWVzLFxuXHRnZXRPbmx5QW5ub3RhdGlvbixcblx0Z2V0VGVtcGxhdGVBbm5vdGF0aW9uUGF0aFxufSBmcm9tIFwiLi9Db21tb25Db252ZXJ0ZXJcIjtcblxuY29uc3QgX2dldFNlbGVjdGlvbkZpZWxkcyA9IGZ1bmN0aW9uKFxuXHRjb250ZXh0OiBQYWdlQ29udmVydGVyQ29udGV4dCxcblx0c2VsZWN0aW9uVmFyaWFudHM6IFF1aWNrU2VsZWN0aW9uVmFyaWFudENvbmZpZ3VyYXRpb25bXSB8IHVuZGVmaW5lZFxuKTogRmlsdGVyU2VsZWN0aW9uRmllbGRbXSB7XG5cdGNvbnN0IHsgZW50aXR5VHlwZSB9ID0gY29udGV4dDtcblx0dmFyIHNlbGVjdGlvbkZpZWxkczogRmlsdGVyU2VsZWN0aW9uRmllbGRbXSA9IFtdO1xuXHR2YXIgb1NlbGVjdGlvblZhcmlhbnRGaWVsZHM6IGFueSA9IHt9O1xuXHRzZWxlY3Rpb25WYXJpYW50cz8uZm9yRWFjaCgoc2VsZWN0aW9uVmFyaWFudDogUXVpY2tTZWxlY3Rpb25WYXJpYW50Q29uZmlndXJhdGlvbikgPT4ge1xuXHRcdHNlbGVjdGlvblZhcmlhbnQucHJvcGVydHlOYW1lcy5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xuXHRcdFx0aWYgKCFvU2VsZWN0aW9uVmFyaWFudEZpZWxkc1twcm9wZXJ0eU5hbWVdKSB7XG5cdFx0XHRcdG9TZWxlY3Rpb25WYXJpYW50RmllbGRzW3Byb3BlcnR5TmFtZV0gPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblx0ZW50aXR5VHlwZS5hbm5vdGF0aW9ucz8uVUk/LlNlbGVjdGlvbkZpZWxkcz8uZm9yRWFjaCgoc2VsZWN0aW9uOiBQcm9wZXJ0eVBhdGgsIHNlbGVjdGlvbkluZGV4OiBudW1iZXIpID0+IHtcblx0XHRjb25zdCBzZWxlY3Rpb25GaWVsZFZhbHVlOiBzdHJpbmcgPSBzZWxlY3Rpb24udmFsdWU7XG5cdFx0aWYgKCFvU2VsZWN0aW9uVmFyaWFudEZpZWxkc1tzZWxlY3Rpb25GaWVsZFZhbHVlXSkge1xuXHRcdFx0c2VsZWN0aW9uRmllbGRzLnB1c2goe1xuXHRcdFx0XHRyZWFkYWJsZVBhdGg6IHNlbGVjdGlvbkZpZWxkVmFsdWUsXG5cdFx0XHRcdHRlbXBsYXRpbmdQYXRoOiBcIi9cIiArIGVudGl0eVR5cGUubmFtZSArIFwiL0Bjb20uc2FwLnZvY2FidWxhcmllcy5VSS52MS5TZWxlY3Rpb25GaWVsZHMvXCIgKyBzZWxlY3Rpb25JbmRleCArIFwiLyRQcm9wZXJ0eVBhdGhcIlxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcblx0cmV0dXJuIHNlbGVjdGlvbkZpZWxkcztcbn07XG5cbi8qKlxuICogR2V0IFBhZ2UgcHJlc2VudGF0aW9uIHByb3BlcnRpZXMgKExpbmVJdGVtLCBTZWxlY3Rpb25GaWVsZHMsIENoYXJ0IGNvbmZpZ3VyYXRpb24gYW5kIFRhYmxlIGNvbmZpZ3VyYXRpb24pLlxuICogQHBhcmFtIHtQYWdlQ29udmVydGVyQ29udGV4dH0gW2NvbnRleHRdIFBhZ2UgQ29udGV4dFxuICogQHBhcmFtIHtzdHJpbmd9IFtwcmVzZW50YXRpb25QYXRoXSByZWxhdGl2ZSBhbm5vdGF0aW9uIFBhdGggdXNlZCBmb3IgcHJlc2VudGF0aW9uIChQUmVzZW50YXRpb24gVmFyaWFudCBvciBMaW5lIEl0ZW0pXG4gKiBAcmV0dXJucyB7UHJlc2VudGF0aW9uQ29uZmlndXJhdGlvbn0gb2JqZWN0IGNvbnRhaW5pbmcgTGluZUl0ZW0sIFNlbGVjdGlvbkZpZWxkcywgQ2hhcnQgY29uZmlndXJhdGlvbiBhbmQgVGFibGUgY29uZmlndXJhdGlvblxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQcmVzZW50YXRpb24oY29udGV4dDogUGFnZUNvbnZlcnRlckNvbnRleHQsIHByZXNlbnRhdGlvblBhdGg6IHN0cmluZyk6IFByZXNlbnRhdGlvbkNvbmZpZ3VyYXRpb24ge1xuXHRjb25zdCB7IGVudGl0eVR5cGUsIG1hbmlmZXN0U2V0dGluZ3MgfSA9IGNvbnRleHQ7XG5cdHZhciBhbm5vdGF0aW9uUGF0aDogc3RyaW5nID0gcHJlc2VudGF0aW9uUGF0aDtcblx0dmFyIHJlc3VsdDogeyBbazogc3RyaW5nXTogYW55IH0gPSB7fTtcblx0Y29uc3QgbmF2aWdhdGlvbkluZm86IE5hdmlnYXRpb25Qcm9wZXJ0eSA9IGdldE5hdmlnYXRpb25Qcm9wZXJ0aWVzKHByZXNlbnRhdGlvblBhdGgsIGVudGl0eVR5cGUpO1xuXHRjb25zdCBkZWZhdWx0QW5ub3RhdGlvblBhdGg6IHN0cmluZyA9IG5hdmlnYXRpb25JbmZvLnByZWZpeCArIFwiQGNvbS5zYXAudm9jYWJ1bGFyaWVzLlVJLnYxLkxpbmVJdGVtXCI7XG5cdHZhciB2aXN1YWxpemF0aW9uTGluZUl0ZW1QYXRoOiBzdHJpbmcgPSBcIlwiLFxuXHRcdHZpc3VhbGl6YXRpb25DaGFydFBhdGg6IHN0cmluZyA9IFwiXCI7XG5cdGNvbnN0IG9FbnRpdHlUeXBlOiBSZXF1aXJlZDxFbnRpdHlUeXBlPiA9IG5hdmlnYXRpb25JbmZvLnByb3BlcnR5XG5cdFx0PyBnZXRUYXJnZXRFbnRpdHlUeXBlKG5hdmlnYXRpb25JbmZvLnByb3BlcnR5LCBlbnRpdHlUeXBlKVxuXHRcdDogZW50aXR5VHlwZTtcblx0dmFyIHZpc3VhbGl6YXRpb25QYXRoczogc3RyaW5nW10gPSBbXSxcblx0XHRzZWxlY3Rpb25WYXJpYW50czogUXVpY2tTZWxlY3Rpb25WYXJpYW50Q29uZmlndXJhdGlvbltdID0gW10sXG5cdFx0aXNDb21wbGlhbnRQcmVzZW50YXRpb25WYXJpYW50OiBib29sZWFuID0gZmFsc2U7XG5cblx0Y29uc3QgcHJlc2VudGF0aW9uVmFyaWFudDogYW55ID0gb0VudGl0eVR5cGUuYW5ub3RhdGlvbnM/LmdldEFubm90YXRpb24oXCJVSVwiKVtnZXRPbmx5QW5ub3RhdGlvbihhbm5vdGF0aW9uUGF0aCldO1xuXHRpZiAocHJlc2VudGF0aW9uVmFyaWFudCAmJiBwcmVzZW50YXRpb25WYXJpYW50LiRUeXBlID09PSBcImNvbS5zYXAudm9jYWJ1bGFyaWVzLlVJLnYxLlByZXNlbnRhdGlvblZhcmlhbnRUeXBlXCIpIHtcblx0XHQvLyBQcmVzZW50YXRpb24gVmFyaWFudFxuXHRcdGNvbnN0IHZpc3VhbGl6YXRpb25zOiBBbm5vdGF0aW9uUGF0aFtdID0gcHJlc2VudGF0aW9uVmFyaWFudC5WaXN1YWxpemF0aW9ucztcblxuXHRcdGlmICh2aXN1YWxpemF0aW9ucykge1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2aXN1YWxpemF0aW9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRjb25zdCB0YXJnZXRBbm5vdGF0aW9uUGF0aDogc3RyaW5nID0gdmlzdWFsaXphdGlvbnNbaV0udmFsdWU7XG5cdFx0XHRcdGNvbnN0IGl0ZW1QYXRoID0gbmF2aWdhdGlvbkluZm8ucHJlZml4ICsgdGFyZ2V0QW5ub3RhdGlvblBhdGg7XG5cdFx0XHRcdGlmIChcblx0XHRcdFx0XHR0YXJnZXRBbm5vdGF0aW9uUGF0aCAmJlxuXHRcdFx0XHRcdHRhcmdldEFubm90YXRpb25QYXRoLmluZGV4T2YoXCJAY29tLnNhcC52b2NhYnVsYXJpZXMuVUkudjEuTGluZUl0ZW1cIikgPiAtMSAmJlxuXHRcdFx0XHRcdCF2aXN1YWxpemF0aW9uTGluZUl0ZW1QYXRoXG5cdFx0XHRcdCkge1xuXHRcdFx0XHRcdHZpc3VhbGl6YXRpb25QYXRocy5wdXNoKGl0ZW1QYXRoKTtcblx0XHRcdFx0XHRpc0NvbXBsaWFudFByZXNlbnRhdGlvblZhcmlhbnQgPSB0cnVlO1xuXHRcdFx0XHRcdHJlc3VsdC5hbm5vdGF0aW9uUGF0aCA9IGdldFRlbXBsYXRlQW5ub3RhdGlvblBhdGgocHJlc2VudGF0aW9uVmFyaWFudC5mdWxseVF1YWxpZmllZE5hbWUsIGVudGl0eVR5cGUpO1xuXHRcdFx0XHRcdHZpc3VhbGl6YXRpb25MaW5lSXRlbVBhdGggPSBpdGVtUGF0aDtcblx0XHRcdFx0fSBlbHNlIGlmIChcblx0XHRcdFx0XHR0YXJnZXRBbm5vdGF0aW9uUGF0aCAmJlxuXHRcdFx0XHRcdHRhcmdldEFubm90YXRpb25QYXRoLmluZGV4T2YoXCJAY29tLnNhcC52b2NhYnVsYXJpZXMuVUkudjEuQ2hhcnRcIikgPiAtMSAmJlxuXHRcdFx0XHRcdHNhcC51aS5EZXZpY2UgJiZcblx0XHRcdFx0XHRzYXAudWkuRGV2aWNlLnN5c3RlbS5kZXNrdG9wICYmXG5cdFx0XHRcdFx0IW5hdmlnYXRpb25JbmZvLnByb3BlcnR5ICYmIC8vIEN1cnJlbnRseSBjaGFydCBpcyBub3QgbWFuYWdlZCB3aXRoIG5hdmlnYXRpb24gUHJvcGVydHlcblx0XHRcdFx0XHQhdmlzdWFsaXphdGlvbkNoYXJ0UGF0aFxuXHRcdFx0XHQpIHtcblx0XHRcdFx0XHR2aXN1YWxpemF0aW9uUGF0aHMucHVzaChpdGVtUGF0aCk7XG5cdFx0XHRcdFx0dmlzdWFsaXphdGlvbkNoYXJ0UGF0aCA9IGl0ZW1QYXRoO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICh2aXN1YWxpemF0aW9uTGluZUl0ZW1QYXRoICYmIHZpc3VhbGl6YXRpb25DaGFydFBhdGgpIHtcblx0XHRcdFx0XHRpID0gdmlzdWFsaXphdGlvbnMubGVuZ3RoO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCFpc0NvbXBsaWFudFByZXNlbnRhdGlvblZhcmlhbnQpIHtcblx0XHRcdHZpc3VhbGl6YXRpb25MaW5lSXRlbVBhdGggPSBkZWZhdWx0QW5ub3RhdGlvblBhdGg7XG5cdFx0XHR2aXN1YWxpemF0aW9uUGF0aHMgPSBbZGVmYXVsdEFubm90YXRpb25QYXRoXTtcblx0XHRcdGFubm90YXRpb25QYXRoID0gZGVmYXVsdEFubm90YXRpb25QYXRoO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHR2aXN1YWxpemF0aW9uTGluZUl0ZW1QYXRoID1cblx0XHRcdGFubm90YXRpb25QYXRoLmluZGV4T2YoXCJAY29tLnNhcC52b2NhYnVsYXJpZXMuVUkudjEuTGluZUl0ZW1cIikgPiAtMSA/IGFubm90YXRpb25QYXRoIDogZGVmYXVsdEFubm90YXRpb25QYXRoO1xuXHRcdHZpc3VhbGl6YXRpb25QYXRocyA9IFt2aXN1YWxpemF0aW9uTGluZUl0ZW1QYXRoXTtcblx0fVxuXG5cdC8vQ2FsY3VsYXRlIFRocmVzaG9sZCBmb3IgVGFibGVcblx0aWYgKGlzQ29tcGxpYW50UHJlc2VudGF0aW9uVmFyaWFudCAmJiBwcmVzZW50YXRpb25WYXJpYW50Lk1heEl0ZW1zKSB7XG5cdFx0cmVzdWx0LnRocmVzaG9sZCA9IHByZXNlbnRhdGlvblZhcmlhbnQuTWF4SXRlbXM7XG5cdH0gZWxzZSB7XG5cdFx0cmVzdWx0LnRocmVzaG9sZCA9IG5hdmlnYXRpb25JbmZvLnByb3BlcnR5ID8gMTAgOiAzMDtcblx0fVxuXG5cdHJlc3VsdC52aXN1YWxpemF0aW9uUGF0aHMgPSBbXTtcblx0dmlzdWFsaXphdGlvblBhdGhzLmZvckVhY2goaXRlbVBhdGggPT4ge1xuXHRcdGNvbnN0IHZpc3VhbGl6YXRpb246IGFueSA9IG9FbnRpdHlUeXBlLmFubm90YXRpb25zPy5nZXRBbm5vdGF0aW9uKFwiVUlcIilbZ2V0T25seUFubm90YXRpb24oaXRlbVBhdGgpXTtcblx0XHRpZiAodmlzdWFsaXphdGlvbikge1xuXHRcdFx0Y29uc3QgdGFyZ2V0UGF0aCA9IFwiL1wiICsgZW50aXR5VHlwZS5uYW1lICsgXCIvXCIgKyBpdGVtUGF0aDtcblx0XHRcdHJlc3VsdC52aXN1YWxpemF0aW9uUGF0aHMucHVzaCh0YXJnZXRQYXRoKTtcblx0XHR9XG5cdH0pO1xuXG5cdGlmICghcmVzdWx0LmFubm90YXRpb25QYXRoKSB7XG5cdFx0cmVzdWx0LmFubm90YXRpb25QYXRoID0gcmVzdWx0LnZpc3VhbGl6YXRpb25QYXRoc1swXTtcblx0fVxuXG5cdGlmIChtYW5pZmVzdFNldHRpbmdzLmNvbnRyb2xDb25maWd1cmF0aW9uKSB7XG5cdFx0bWFuaWZlc3RTZXR0aW5ncy5jb250cm9sQ29uZmlndXJhdGlvblt2aXN1YWxpemF0aW9uTGluZUl0ZW1QYXRoXT8udGFibGVTZXR0aW5ncz8ucXVpY2tWYXJpYW50U2VsZWN0aW9uPy5wYXRocz8uZm9yRWFjaChcblx0XHRcdChwYXRoOiB7IGFubm90YXRpb25QYXRoOiBzdHJpbmcgfSkgPT4ge1xuXHRcdFx0XHRjb25zdCBzZWxlY3Rpb246IFNlbGVjdGlvblZhcmlhbnRUeXBlID0gb0VudGl0eVR5cGUuYW5ub3RhdGlvbnM/LmdldEFubm90YXRpb24oXCJVSVwiKVtcblx0XHRcdFx0XHRnZXRPbmx5QW5ub3RhdGlvbihwYXRoLmFubm90YXRpb25QYXRoKVxuXHRcdFx0XHRdO1xuXHRcdFx0XHRpZiAoc2VsZWN0aW9uKSB7XG5cdFx0XHRcdFx0dmFyIHByb3BlcnR5TmFtZXM6IHN0cmluZ1tdID0gW107XG5cdFx0XHRcdFx0c2VsZWN0aW9uLlNlbGVjdE9wdGlvbnM/LmZvckVhY2goKHNlbGVjdE9wdGlvbjogU2VsZWN0T3B0aW9uVHlwZSkgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc3QgcHJvcGVydHlOYW1lOiBhbnkgPSBzZWxlY3RPcHRpb24uUHJvcGVydHlOYW1lO1xuXHRcdFx0XHRcdFx0Y29uc3QgUHJvcGVydHlQYXRoOiBzdHJpbmcgPSBwcm9wZXJ0eU5hbWUudmFsdWU7XG5cdFx0XHRcdFx0XHRpZiAocHJvcGVydHlOYW1lcy5pbmRleE9mKFByb3BlcnR5UGF0aCkgPT09IC0xKSB7XG5cdFx0XHRcdFx0XHRcdHByb3BlcnR5TmFtZXMucHVzaChQcm9wZXJ0eVBhdGgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdHNlbGVjdGlvblZhcmlhbnRzLnB1c2goe1xuXHRcdFx0XHRcdFx0dGV4dDogc2VsZWN0aW9uLlRleHQgYXMgc3RyaW5nLFxuXHRcdFx0XHRcdFx0a2V5OiBwYXRoLmFubm90YXRpb25QYXRoLFxuXHRcdFx0XHRcdFx0cHJvcGVydHlOYW1lczogcHJvcGVydHlOYW1lc1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0KTtcblx0fVxuXG5cdHZhciBwcmVzZW50YXRpb25Db25maWd1cmF0aW9uID0ge1xuXHRcdC4uLnJlc3VsdCxcblx0XHQuLi57XG5cdFx0XHRzZWxlY3Rpb25GaWVsZHM6IG5hdmlnYXRpb25JbmZvLnByb3BlcnR5ID8gdW5kZWZpbmVkIDogX2dldFNlbGVjdGlvbkZpZWxkcyhjb250ZXh0LCBzZWxlY3Rpb25WYXJpYW50cyksXG5cdFx0XHRsaW5lSXRlbVBhdGg6IHZpc3VhbGl6YXRpb25MaW5lSXRlbVBhdGgsXG5cdFx0XHRlbnRpdHlOYW1lOiBlbnRpdHlUeXBlLm5hbWUsXG5cdFx0XHR0YXJnZXRFbnRpdHlOYW1lOiBvRW50aXR5VHlwZS5uYW1lLFxuXHRcdFx0cXVpY2tWYXJpYW50U2VsZWN0aW9uOiBzZWxlY3Rpb25WYXJpYW50c1xuXHRcdH1cblx0fSBhcyBQcmVzZW50YXRpb25Db25maWd1cmF0aW9uO1xuXHRjb25zdCB2aXN1YWxpemF0aW9uQ29udGV4dDogVmlzdWFsaXphdGlvbkNvbnZlcnRlckNvbnRleHQgPSB7IC4uLnsgdmlzdWFsaXphdGlvblBhdGg6IHZpc3VhbGl6YXRpb25MaW5lSXRlbVBhdGggfSwgLi4uY29udGV4dCB9O1xuXHR2YXIgdGFibGVDb25maWd1cmF0aW9uOiBhbnkgPSB7XG5cdFx0YW5ub3RhdGlvbjogZ2V0VGFibGVBbm5vdGF0aW9uQ29uZmlndXJhdGlvbih2aXN1YWxpemF0aW9uQ29udGV4dCksXG5cdFx0Y29udHJvbDogZ2V0VGFibGVNYW5pZmVzdENvbmZpZ3VyYXRpb24odmlzdWFsaXphdGlvbkNvbnRleHQpLFxuXHRcdGFjdGlvbnM6IGdldFRhYmxlQWN0aW9uc0NvbmZpZ3VyYXRpb24odmlzdWFsaXphdGlvbkxpbmVJdGVtUGF0aCwgZW50aXR5VHlwZSwgbWFuaWZlc3RTZXR0aW5ncylcblx0fTtcblxuXHRwcmVzZW50YXRpb25Db25maWd1cmF0aW9uID0ge1xuXHRcdC4uLnByZXNlbnRhdGlvbkNvbmZpZ3VyYXRpb24sXG5cdFx0Li4ue1xuXHRcdFx0dGFibGVDb25maWd1cmF0aW9uOiB0YWJsZUNvbmZpZ3VyYXRpb24gYXMgVGFibGVDb25maWd1cmF0aW9uXG5cdFx0fVxuXHR9O1xuXG5cdC8vR2V0IENoYXJ0IHByb3BlcnRpZXNcblx0aWYgKHZpc3VhbGl6YXRpb25DaGFydFBhdGggJiYgaXNDb21wbGlhbnRQcmVzZW50YXRpb25WYXJpYW50KSB7XG5cdFx0dmlzdWFsaXphdGlvbkNvbnRleHQudmlzdWFsaXphdGlvblBhdGggPSB2aXN1YWxpemF0aW9uQ2hhcnRQYXRoO1xuXHRcdHByZXNlbnRhdGlvbkNvbmZpZ3VyYXRpb24uY2hhcnRDb25maWd1cmF0aW9uID0gZ2V0Q2hhcnRQcm9wZXJ0aWVzKHZpc3VhbGl6YXRpb25Db250ZXh0KTtcblx0fVxuXG5cdHJldHVybiBwcmVzZW50YXRpb25Db25maWd1cmF0aW9uO1xufVxuIl19