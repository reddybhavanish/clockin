sap.ui.define(["sap/fe/core/helpers/StableIdHelper","sap/ui/model/odata/v4/AnnotationHelper","../ManifestSettings","../controls/PresentationConverter","../ConverterUtil"],function(S,A,M,P,C){"use strict";var g=P.getPresentation;var a=M.ActionType;var b=M.SectionType;var c=M.Placement;var F=M.FeFacetType;function o(i,u){var v=Object.keys(i);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(i);if(u)w=w.filter(function(x){return Object.getOwnPropertyDescriptor(i,x).enumerable;});v.push.apply(v,w);}return v;}function _(u){for(var i=1;i<arguments.length;i++){var v=arguments[i]!=null?arguments[i]:{};if(i%2){o(Object(v),true).forEach(function(w){d(u,w,v[w]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(u,Object.getOwnPropertyDescriptors(v));}else{o(Object(v)).forEach(function(w){Object.defineProperty(u,w,Object.getOwnPropertyDescriptor(v,w));});}}return u;}function d(i,u,v){if(u in i){Object.defineProperty(i,u,{value:v,enumerable:true,configurable:true,writable:true});}else{i[u]=v;}return i;}var e=function(i,u,v,w,x){var y,z,B,D;var E=i.entityType,G=i.manifestSettings;var H="/"+E.name,I={type:v,annotationPath:H+"/@"+u};switch(v){case F.Form:I=_({},I,{},{id:k([],w,u),entitySet:"/"+E.name,useFormContainerLabels:!!(x&&x.Facets),hasFacetsNotPartOfPreview:x&&x.Facets?x.Facets.some(function(K){var L,N;return((L=K.annotations)===null||L===void 0?void 0:(N=L.UI)===null||N===void 0?void 0:N.PartOfPreview)===false;}):false,hidden:false});break;case F.Table:I=_({},I,{},{presentation:g(i,w.Target.value)});break;case F.HeaderContact:var J=w;I=_({},I,{},{contact:I.annotationPath+"/Target/$AnnotationPath",text:(y=J.Target.$target.fn)===null||y===void 0?void 0:(z=y.$target)===null||z===void 0?void 0:(B=z.annotations)===null||B===void 0?void 0:(D=B.Common)===null||D===void 0?void 0:D.Label});break;case F.Contact:I=_({},I,{},{text:"For Contacts Fragment"});break;case F.Chart:I=_({},I,{},{text:"For Chart Fragment"});break;}return I;};var f=function(i,u,v){var w=i.entityType;var x=[];var y=function(z){var B=j(w,u,z);if(B.length>0){x=x.concat(B);}};if(v.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"&&v.Facets){v.Facets.forEach(function(z){y(z);});}else{y(v);}return x;};var h=function(i,u,v){if(!i){return v;}else if(s(i)){return A.format({$Path:i.path},{context:u});}else{return A.format(i,{context:u});}};var j=function(i,u,v){var w=v;var x=w.Target.value;var y=[];if(x&&/.*com\.sap\.vocabularies\.UI\.v1\.(Identification#|FieldGroup|StatusInfo).*/.test(x)){var z=w.Target.$target;if(z){var B=z.Data?z.Data:z;B.forEach(function(D){if(D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){y.push({id:S.generate(["fe","Form",{Facet:w},D]),type:a.DataFieldForIntentBasedNavigation,text:D.Label,visible:D.RequiresContext?"true":"{= ${localUI>/IBNActions/"+D.SemanticObject+"-"+D.Action+"} === undefined ? false : ${localUI>/IBNActions/"+D.SemanticObject+"-"+D.Action+"} }",press:".handlers.onDataFieldForIntentBasedNavigation($controller, '"+D.SemanticObject+"','"+D.Action+"', '"+JSON.stringify(D.Mapping)+"', undefined ,"+D.RequiresContext+")"});}else if(D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){var E,G,H;var I=i.actions[D.Action];var J=(E=D.annotations)===null||E===void 0?void 0:(G=E.UI)===null||G===void 0?void 0:(H=G.Hidden)===null||H===void 0?void 0:H.path;var K=function(){var L,N;if(I.isBound!==true){return"true";}var O=(L=I.annotations)===null||L===void 0?void 0:(N=L.Core)===null||N===void 0?void 0:N.OperationAvailable;if(O){var Q=h(O,u);if(Q){var R,T;var U=(R=I.parameters)===null||R===void 0?void 0:(T=R[0])===null||T===void 0?void 0:T.fullyQualifiedName;if(U){U=U.replace(I.fullyQualifiedName+"/","");Q=Q.replace(U+"/","");}return Q;}return"true";}return"true";};y.push({id:S.generate(["fe","Form",{Facet:w},D]),enabled:K(),type:a.DataFieldForAction,text:D.Label,visible:J?"{= !%{"+J+"}}":"true",press:".editFlow.onCallAction('"+D.Action+"', { contexts: ${$view>/#fe::ObjectPage/}.getBindingContext(), invocationGrouping : '"+(D.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated")+"', label: '"+D.Label+"', model: ${$source>/}.getModel()})"});}});}}return y;};var k=function(i,u,v){var w=i.concat();if(u.ID){w.push(u.ID);}else{switch(u.$Type){case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":w.push(v);break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":w.push(u.Target.value);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":w.push(v);break;}}return S.generate(w);};var l=function(i,u){var v,w;return((v=i.ID)===null||v===void 0?void 0:v.toString())||((w=i.Label)===null||w===void 0?void 0:w.toString())||u;};var m=function(i,u,v){var w=i.entityType;var x=function(z,B){var D,E;var G=[];if(((D=B.annotations)===null||D===void 0?void 0:(E=D.UI)===null||E===void 0?void 0:E.Hidden)!==true){switch(B.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":G.push(e(i,"".concat(z),F.Form,B,u));break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":var H=B.Target.value;var I=w.resolvePath(H);if(r(B)){G.push(e(i,z,F.Form,B,u));}else{var J=I!==undefined&&/.*com\.sap\.vocabularies\.UI\.v1\.(LineItem|Presentation).*/.test(H);if(J){G.push(e(i,z,F.Table,B));}else if(H.indexOf("com.sap.vocabularies.Communication.v1.Contact")>-1){G.push(e(i,z,F.Contact,B));}else if(H.indexOf("com.sap.vocabularies.Communication.v1.Chart")>-1){G.push(e(i,z,F.Chart,B));}}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":break;}}return G;};if(u.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"&&!u.Facets.every(r)){var y=[];u.Facets.forEach(function(z,B){y=y.concat(x("".concat(v,"/Facets/").concat(B),z));});return y;}else{return x(v,u);}};var n=function(i,u,v){var w=[];var x=function(z,B,D){var E,G;if(((E=z.annotations)===null||E===void 0?void 0:(G=E.UI)===null||G===void 0?void 0:G.Hidden)!==true){var H=z.Target.$target.$Type==="com.sap.vocabularies.Communication.v1.ContactType"?F.HeaderContact:F.Form;w.push(e(i,B,H,z,D));}};if(u.Facets){var y;(y=u.Facets)===null||y===void 0?void 0:y.forEach(function(z,B){x(z,"".concat(v,"/Facets/").concat(B),u);});}else{x(u,v);}return w;};var p=function(i,u,v){if(!i){return v;}var w=h(i,u,v);return"{= !$".concat(w,"}");};var q=function(i,u,v,w,x){var y,z;var B={id:k(w,u,x),title:h(u.Label,v),visible:p((y=u.annotations)===null||y===void 0?void 0:(z=y.UI)===null||z===void 0?void 0:z.Hidden,v,true),subSections:{},facetType:u.$Type,type:b.Annotation};B.showTitle=B.title!==undefined;var D=function(H,I,J,K){var L="FacetSubSection";var N={type:b.Annotation,visible:K.visible};var O=m(i,H,I);return _({},{title:J,id:k(["fe",L],H,I),facets:O,moreFacets:O.filter(function(u){return u.type==="Form"&&u.hasFacetsNotPartOfPreview;}),actions:f(i,v,H)},{},N);};if(u.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"&&u.Facets.find(function(u){return u.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet";})){var E,G;u.Facets.forEach(function(H,I){G=D(H,"".concat(x,"/Facets/").concat(I),h(H.Label,v),B);if(E!==undefined){G.position={anchor:E,placement:c.After};}E=l(H,I.toString());B.subSections[E]=G;});}else{B.subSections[l(u,k(["fe","Section"],u,x))]=D(u,x,B.title,B);}return B;};var r=function(i){return i.Target&&/.*com\.sap\.vocabularies\.UI\.v1\.(FieldGroup|Identification|DataPoint|StatusInfo).*/.test(i.Target.value);};var s=function(i){return i.type!==undefined&&i.type==="Path";};var t=function(i,u){if(!i){throw new Error("undefined section");}if(i.visible===undefined||i.visible===null){i.visible=true;}i.showTitle=i.title!==undefined;if(!i.type){i.type=b.Default;}if((i.type===b.XMLFragment||i.type===b.Default)&&(!i.subSections||!Object.keys(i.subSections).length)){i.subSections={"default":_({},i,{},{visible:true,showTitle:false,position:undefined,id:S.generate(["fe","CustomSubSection",u])})};}return i;};return{convertPage:function(i,u,v,w){var x,y,z;var B={};var D=i.entityTypeInstance;var E={entitySet:i,entityType:D,manifestSettings:v};var G={};var H;var I=[];if(v.editableHeaderContent){var J,K,L;(J=D.annotations)===null||J===void 0?void 0:(K=J.UI)===null||K===void 0?void 0:(L=K.HeaderFacets)===null||L===void 0?void 0:L.forEach(function(W,X){var Y=n(E,W,"".concat(w("UI.HeaderFacets"),"/").concat(X));if(Y.length>0){I=I.concat(Y);}});if(I.length>0){G.headerSection={subSection:{facets:I}};}}(x=D.annotations)===null||x===void 0?void 0:(y=x.UI)===null||y===void 0?void 0:(z=y.Facets)===null||z===void 0?void 0:z.forEach(function(W,X){var Y=q(E,W,u,["fe","FacetSection"],"".concat(w("UI.Facets"),"/").concat(X));if(H!=null){Y.position={anchor:H,placement:c.After};}H=l(W,X.toString());B[H]=Y;});for(var N in(O=v.content)===null||O===void 0?void 0:(Q=O.body)===null||Q===void 0?void 0:Q.sections){var O,Q,R,T;var U=(R=v.content)===null||R===void 0?void 0:(T=R.body)===null||T===void 0?void 0:T.sections[N];B[N]=t(_({},{id:S.generate(["fe","CustomSection",N])},{},B[N],{},U),N);}var V=C.orderByPosition(B).filter(function(W){return W.visible;}).map(function(W){W.subSections=C.orderByPosition(W.subSections);return W;});return _({},{sections:V},{},G);}};});
