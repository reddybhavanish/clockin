sap.ui.define(["sap/ui/core/service/Service","sap/ui/core/service/ServiceFactory","sap/ui/core/Component","sap/ui/base/BindingParser","sap/fe/core/helpers/SemanticKeyHelper","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/routing/HashChanger","sap/base/Log"],function(S,a,C,B,b,F,c,H,L){"use strict";var R=S.extend("sap.fe.core.services.RoutingService",{initPromise:Promise.resolve(this),init:function(){var t=this;var o=this.getContext();if(o.scopeType==="component"){this.oAppComponent=o.scopeObject;this.oModel=this.oAppComponent.getModel();this.oRouter=this.oAppComponent.getRouter();var r=this.oAppComponent.getManifestEntry("/sap.ui5/routing");this._parseRoutingConfiguration(r);this.initPromise=Promise.resolve(t);}},_parseRoutingConfiguration:function(r){var t=this;this._mTargets={};Object.keys(r.targets).forEach(function(T){t._mTargets[T]=Object.assign({targetName:T},r.targets[T]);if(t._mTargets[T].contextPattern!==undefined){t._mTargets[T].viewLevel=t._getViewLevelFromPattern(t._mTargets[T].contextPattern);}});this._mRoutes={};for(var s in r.routes){var o=r.routes[s];var d=Array.isArray(r.routes)?o.name:s;t._mRoutes[d]={name:d,pattern:o.pattern,targets:Array.isArray(o.target)?o.target:[o.target]};if(!Array.isArray(o.target)){var v=t._getViewLevelFromPattern(o.pattern);if(t._mTargets[o.target].viewLevel===undefined||t._mTargets[o.target].viewLevel<v){t._mTargets[o.target].viewLevel=v;}}}},_getViewLevelFromPattern:function(p){p=p.replace(":?query:","");if(p&&p[0]!=="/"&&p[0]!=="?"){p="/"+p;}return p.split("/").length-1;},getRouteInformation:function(r){return this._mRoutes[r];},getTargetInformation:function(t){return this._mTargets[t];},_getComponentId:function(o,s){if(s.indexOf(o+"---")===0){return s.substr(o.length+3);}return s;},getTargetInformationFor:function(o){var t=this._getComponentId(o._sOwnerId,o.getId());var d=this;var s=null;Object.keys(this._mTargets).forEach(function(T){if(d._mTargets[T].id===t){s=T;}});return this.getTargetInformation(s);},navigateTo:function(o,r,p,P){var t;if(!p){t=b.getSemanticPath(o);}else{var m=this.prepareParameters(p,r,o);t=this.oRouter.getURL(r,m);}this.oAppComponent.getRouterProxy().navToHash(t,P);},prepareParameters:function(p,t,o){var P;try{var s=o.getPath();var d=s.split("/");P=Object.keys(p).reduce(function(r,f){var g=p[f];var h=B.complexParser(g);var i=h.parts||[h];var j=i.map(function(k){var l=k.path.split("../");var m=d.slice(0,d.length-l.length+1);m.push(l[l.length-1]);return o.getObject(m.join("/"));});if(h.formatter){r[f]=h.formatter.apply(this,j);}else{r[f]=j.join("");}return r;},{});}catch(e){L.error("Could not parse the parameters for the navigation to route "+t);P=undefined;}return P;}});return a.extend("sap.fe.core.services.RoutingServiceFactory",{createInstance:function(s){var r=new R(s);return r.initPromise;}});},true);
