/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/fe/macros/CommonHelper","sap/fe/core/library","sap/ui/model/odata/v4/AnnotationHelper"],function(J,C,F,O){"use strict";var a=F.CreationMode;var T={_isPresentationVariantAnnotation:function(A){return A&&A.$Type==="com.sap.vocabularies.UI.v1.PresentationVariantType";},createButtonTemplating:function(t,c){var o=t.collection,n,N,s=t.navigationPath,b=C.getTargetCollection(t.collection,t.navigationPath),r=t.parentEntitySet.getObject(t.parentEntitySet.getPath()+"@Org.OData.Capabilities.V1.NavigationRestrictions/RestrictedProperties"),d=o.getObject(b+"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction")||o.getObject(b+"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction");for(var i in r){n=r[i];if(n.NavigationProperty.$NavigationPropertyPath===s&&n.InsertRestrictions&&n.InsertRestrictions.Insertable){N=n.InsertRestrictions.Insertable;}}if(!t.onCreate||(t.creationMode===a.CreationRow&&c===false)){return false;}else if(d){return(o.getObject(b+"/"+d+"@Org.OData.Core.V1.OperationAvailable")!==false);}else if(N===false){return false;}else if(N){return true;}return(o.getObject(b+"@Org.OData.Capabilities.V1.InsertRestrictions/Insertable")!==false);},deleteButtonTemplating:function(t){var o=t.collection;if(t.selectedContextsModel&&t.id&&t.onDelete){if(t.showDelete!==undefined&&t.showDelete!==null){return t.showDelete;}return!(o.getObject(o.getPath()+"@Org.OData.Capabilities.V1.DeleteRestrictions/Deletable")===false);}return false;},addPresentationVariantToSelectQuery:function(p){var r=[];if(!(p&&T._isPresentationVariantAnnotation(p)&&p.RequestAtLeast&&p.RequestAtLeast.length>0)){return"";}p.RequestAtLeast.forEach(function(R){r.push(R.$PropertyPath);});return r.join(",");},addOperationAvailableFieldsToSelectQuery:function(l,c){var s=[],b="";l.forEach(function(r){var A=r.Action;if(r.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&A.indexOf("/")<0&&!r.Determining){if(C.getActionPath(c.context,false,A,true)===null){s.push(A);}else{var R=C.getActionPath(c.context,false,A);if(R.sProperty){s.push(R.sProperty.substr(R.sBindingParameter.length+1));}}}});b=s.join(",");return b;},getOperationAvailableMap:function(l,c){var A={},r;l.forEach(function(R){var s=R.Action;if(R.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&s.indexOf("/")<0&&!R.Determining){r=C.getActionPath(c.context,false,s,true);if(r===null){A[s]=null;}else{r=C.getActionPath(c.context,false,s);if(r.sProperty){A[s]=r.sProperty.substr(r.sBindingParameter.length+1);}}}});return JSON.stringify(A);},getMultiSelectDisabledActions:function(l,c){var m=[],A,s,b,p,o;var d=l.filter(function(i){return i.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction";});d.forEach(function(e){s=e.Action;A=C.getActionPath(c.context,true,s,false);o=c.context.getObject(A+"/@$ui5.overload/0");if(o&&o.$Parameter&&o.$IsBound){for(var n in o.$Parameter){b=A+"/"+o.$Parameter[n].$Name+"@";p=c.context.getObject(b);if(p&&((p["@com.sap.vocabularies.UI.v1.Hidden"]&&p["@com.sap.vocabularies.UI.v1.Hidden"].$Path)||(p["@com.sap.vocabularies.Common.v1.FieldControl"]&&p["@com.sap.vocabularies.Common.v1.FieldControl"].$Path))){m.push(s);break;}}}});return m;},getSortConditions:function(p){if(p&&T._isPresentationVariantAnnotation(p)&&p.SortOrder){var s={sorters:[]};p.SortOrder.forEach(function(c){var S={};S.name=c.Property.$PropertyPath;S.descending=!!c.Descending;s.sorters.push(S);});return JSON.stringify(s);}return undefined;},getUiLineItem:function(p){var P=p.getObject(p.sPath),m=p.getModel();if(T._isPresentationVariantAnnotation(P)){var l,v=P.Visualizations;for(var i=0;i<v.length;i++){if(v[i].$AnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.LineItem")!==-1){l=v[i].$AnnotationPath;break;}}return m.getMetaContext(p.getPath().split("@")[0]+l);}return p;},getCollectionFields:function(e,m){var p=[],o,E;E=m.getObject(e+"/");for(var k in E){o=E[k];if(o&&o.$kind==="Property"){p.push({name:k,label:m.getObject(e+"/"+k+"@com.sap.vocabularies.Common.v1.Label"),type:o.$Type});}}return p;},create$Select:function(c,o,p,s){var P=T.addPresentationVariantToSelectQuery(p);var S=o+(o&&P?",":"")+P;if(s){s.forEach(function(b){S+=S?","+b.$PropertyPath:b.$PropertyPath;});}if(c["@Org.OData.Capabilities.V1.DeleteRestrictions"]&&c["@Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.$Path){var r=c["@Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.$Path;S+=S?","+r:r;}return!S?"":", $select: '"+S+"'";},getColumnWidth:function(A,d,f,i,D,n,c,s){var w,h=false,I=typeof A!=="undefined"&&(A.hasOwnProperty("@Org.OData.Measures.V1.Unit")||A.hasOwnProperty("@Org.OData.Measures.V1.ISOCurrency"));if(c&&c[s]&&c[s].width){w=c[s].width;}else if(C.getEditMode(A,d,f,i)==="Display"){h=A&&A.hasOwnProperty("@com.sap.vocabularies.Common.v1.Text");if(D==="Edm.String"&&!h&&n&&n<10){n+=0.75;if(n<3){n=3;}w=n+"em";}}else if(D==="Edm.Date"||D==="Edm.DateTimeOffset"){w="9em";}else if(I){w="18em";}else if(D==="Edm.Boolean"){w="8em";}else if(A&&A.hasOwnProperty("@com.sap.vocabularies.UI.v1.IsImageURL")&&A.hasOwnProperty("@com.sap.vocabularies.UI.v1.IsImageURL")===true){w="7em";}return w;},getMarginClass:function(c,d,v){if(JSON.stringify(c[c.length-1])==JSON.stringify(d)){if(v=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return"sapUiNoMarginBottom sapUiNoMarginTop";}return"";}else{if(v=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return"sapUiNoMarginTop";}return"sapUiTinyMarginBottom";}},isStickySessionSupported:function(c,i){var m=i.context.getModel().getMetaPath(i.context).split("/")[1];var M=i.context.getModel().getObject("/"+m+"@com.sap.vocabularies.Session.v1.StickySessionSupported");return M?true:false;},getDataFieldForIBNMap:function(l){var s=[];l.forEach(function(r){if(r.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&!r.RequiresContext){var b=r.SemanticObject+"-"+r.Action;s.push(b);}});return s.toString();},updateDataFiledForIBNButtonsVisibility:function(b){var k=Object.keys(b.getData());if(k&&k.length>0){var u=sap.ushell&&sap.ushell.Container;var x=u&&u.getService("CrossApplicationNavigation");if(x){var l=x.getLinks({params:{}});var n=0;l.then(function(L){if(L&&L.length>0){for(var i=0;i<L.length;i++){if(k.length==n){break;}for(var j=0;j<k.length;j++){if(L[i].intent.substring(1)===k[j]){n++;b.setProperty("/"+k[j],true);}}}}});}}},getDefaultQuickFilterKey:function(q){if(q){var Q=JSON.parse(q);if(Q&&Array.isArray(Q.paths)&&Q.paths.length>0){return Q.paths[0].annotationPath;}return undefined;}return undefined;},getQuickFilter:function(c){var q=c.getObject("quickFilter"),Q,s;if(q){Q=JSON.parse(q);}s=new J(Q||{});return s.createBindingContext("/");},getHiddenPathExpressionForTableActions:function(h,d){var c=d.context,p=c.getPath(),e=O.getNavigationPath(p);if(h.indexOf("/")>0){var n=h.split("/")[0];if(c.getObject(e+"/$Partner")===n){return"{= !%{"+h.split("/")[1]+"} }";}return true;}return"{= !%{"+h+"} }";}};T.getOperationAvailableMap.requiresIContext=true;T.addOperationAvailableFieldsToSelectQuery.requiresIContext=true;return T;},true);
