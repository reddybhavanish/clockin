/*
 * ! @copyright@
 */
sap.ui.define(["./NavError","./NavigationHelper","./SelectionVariant","./library","sap/ui/base/Object","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/Log","sap/base/assert","sap/base/util/merge"],function(N,a,S,b,B,U,H,e,c,L,d,m){"use strict";var f=b.NavType;var P=b.ParamHandlingMode;var g=b.SuppressionBehavior;var h=B.extend("sap.fe.navigation.NavigationHandler",{metadata:{publicMethods:["navigate","parseNavigation","storeInnerAppState","storeInnerAppStateWithImmediateReturn","processBeforeSmartLinkPopoverOpens","setModel","getTechnicalParameters","setTechnicalParameters","replaceHash"]},constructor:function(C,p){if(!C){throw new N("NavigationHandler.INVALID_INPUT");}if(C instanceof U){this.oRouter=C.getRouter();this.oComponent=C;}else{if(typeof C.getOwnerComponent!=="function"){throw new N("NavigationHandler.INVALID_INPUT");}this.oRouter=this._getRouter(C);this.oComponent=C.getOwnerComponent();}if(this.oComponent&&this.oComponent.getAppComponent){this.oComponent=this.oComponent.getAppComponent();}if(typeof this.oRouter==="undefined"||typeof this.oComponent==="undefined"||typeof this.oComponent.getComponentData!=="function"){throw new N("NavigationHandler.INVALID_INPUT");}try{this.oCrossAppNavService=this._getAppNavigationService();if(!this.oCrossAppNavService){L.error("NavigationHandler: CrossApplicationNavigation is not available.");throw new N("NavigationHandler.NO.XAPPSERVICE");}}catch(i){L.error("NavigationHandler: UShell service API for CrossApplicationNavigation is not available.");}this.IAPP_STATE="sap-iapp-state";this.sDefaultedParamProp="sap-ushell-defaultedParameterNames";this.sSAPSystemProp="sap-system";this._aTechnicalParamaters=["hcpApplicationId"];this._oLastSavedInnerAppData={sAppStateKey:"",oAppData:{},iCacheHit:0,iCacheMiss:0};this._rIAppStateOld=new RegExp("/"+this.IAPP_STATE+"=([^/?]+)");this._rIAppStateOldAtStart=new RegExp("^"+this.IAPP_STATE+"=([^/?]+)");this._rIAppStateNew=new RegExp("[?&]"+this.IAPP_STATE+"=([^&]+)");if(p===P.URLParamWins||p===P.InsertInSelOpt){this.sParamHandlingMode=p;}else{this.sParamHandlingMode=P.SelVarWins;}},_getAppNavigationService:function(){return sap.ushell.Container.getService("CrossApplicationNavigation");},_getRouter:function(C){return U.getRouterFor(C);},navigate:function(s,A,n,i,o,E,j){var k,p,x,C,l,q=false,t={};C=this.oComponent.getComponentData();if(C){l=C.startupParameters;if(l&&l["sap-ushell-next-navmode"]&&l["sap-ushell-next-navmode"].length>0){q=l["sap-ushell-next-navmode"][0]==="explace";}}if(j&&(j==="inplace"||j==="explace")){q=j==="explace";}else if(j){throw new N("NavigationHandler.INVALID_NAV_MODE");}if(E===undefined||E===null){x={};}else{x=E;}if(typeof n==="string"){k=n;}else if(typeof n==="object"){var r=this._splitInboundNavigationParameters(new S(),n,[]).oNavigationSelVar;k=r.toJSONString();}else{throw new N("NavigationHandler.INVALID_INPUT");}t.selectionVariant=new S(k).toJSONObject();t=this._removeMeasureBasedInformation(t);t=this._checkIsPotentiallySensitive(t);if(t.selectionVariant){p=this._getURLParametersFromSelectionVariant(new S(t.selectionVariant));k=new S(t.selectionVariant).toJSONString();}else{p={};k=null;}var u=this;var v={target:{semanticObject:s,action:A},params:p||{}};if(j){v.params["sap-ushell-navmode"]=q?"explace":"inplace";}var w=u.oCrossAppNavService.isNavigationSupported([v],u.oComponent);w.done(function(T){if(T[0].supported){var R;if(!q){R=u.storeInnerAppStateWithImmediateReturn(i,true);if(R&&R.appStateKey){u.replaceHash(R.appStateKey);}}if(!x.selectionVariant){x.selectionVariant=k;}x=u._removeMeasureBasedInformation(x);R=u._saveAppStateWithImmediateReturn(x,o);if(R){v.appStateKey=R.appStateKey;u.oCrossAppNavService.toExternal(v,u.oComponent);}}else{if(o){var y=new N("NavigationHandler.isIntentSupported.notSupported");o(y);}}});if(o){w.fail(function(){var y=u._createTechnicalError("NavigationHandler.isIntentSupported.failed");o(y);});}},parseNavigation:function(){var A=H.getInstance().getHash();var i=this._getInnerAppStateKey(A);var C=this.oComponent.getComponentData();if(C===undefined){L.warning("The navigation Component's data was not set properly; assuming instead that no parameters are provided.");C={};}var s=C.startupParameters;var D=[];if(s&&s[this.sDefaultedParamProp]&&s[this.sDefaultedParamProp].length>0){D=JSON.parse(s[this.sDefaultedParamProp][0]);}var M=jQuery.Deferred();var n=this;if(i){this._loadAppState(i,M);}else{var I=C["sap-xapp-state"]!==undefined;if(I){var o=this.oCrossAppNavService.getStartupAppState(this.oComponent);o.done(function(l){var k=l.getData();if(k){try{k=JSON.parse(JSON.stringify(k));}catch(x){var E=n._createTechnicalError("NavigationHandler.AppStateData.parseError");M.reject(E,s,f.xAppState);return M.promise();}}if(k){var p=new S(k.selectionVariant);var j=n._splitInboundNavigationParameters(p,s,D);k.selectionVariant=j.oNavigationSelVar.toJSONString();k.oSelectionVariant=j.oNavigationSelVar;k.oDefaultedSelectionVariant=j.oDefaultedSelVar;k.bNavSelVarHasDefaultsOnly=j.bNavSelVarHasDefaultsOnly;M.resolve(k,s,f.xAppState);}else{E=n._createTechnicalError("NavigationHandler.getDataFromAppState.failed");M.reject(E,s||{},f.xAppState);}});o.fail(function(){var E=n._createTechnicalError("NavigationHandler.getStartupState.failed");M.reject(E,{},f.xAppState);});}else{if(s){var j=n._splitInboundNavigationParameters(new S(),s,D);if(j.oNavigationSelVar.isEmpty()&&j.oDefaultedSelVar.isEmpty()){M.resolve({},s,f.initial);}else{var k={};k.selectionVariant=j.oNavigationSelVar.toJSONString();k.oSelectionVariant=j.oNavigationSelVar;k.oDefaultedSelectionVariant=j.oDefaultedSelVar;k.bNavSelVarHasDefaultsOnly=j.bNavSelVarHasDefaultsOnly;M.resolve(k,s,f.URLParams);}}else{M.resolve({},{},f.initial);}}}return M.promise();},setTechnicalParameters:function(t){if(!t){t=[];}if(!Array.isArray(t)){L.error("NavigationHandler: parameter incorrect, array of strings expected");throw new N("NavigationHandler.INVALID_INPUT");}this._aTechnicalParamaters=t;},getTechnicalParameters:function(){return this._aTechnicalParamaters.concat([]);},_isTechnicalParameter:function(p){if(p){if(p.toLowerCase().indexOf("sap-")===0){return true;}else if(this._aTechnicalParamaters.indexOf(p)>=0){return true;}}return false;},_splitInboundNavigationParameters:function(s,o,D){if(!Array.isArray(D)){throw new N("NavigationHandler.INVALID_INPUT");}var p,i;var j={};for(p in o){if(!o.hasOwnProperty(p)){continue;}if(this._isTechnicalParameter(p)){continue;}if(typeof o[p]==="string"){j[p]=o[p];}else if(jQuery.type(o[p])==="array"&&o[p].length===1){j[p]=o[p][0];}else if(jQuery.type(o[p])==="array"&&o[p].length>1){j[p]=o[p];}else{throw new N("NavigationHandler.INVALID_INPUT");}}var k=new S();var n=new S();var l=s.getParameterNames().concat(s.getSelectOptionsPropertyNames());for(i=0;i<l.length;i++){p=l[i];if(p in j){if(D.indexOf(p)>-1){n.massAddSelectOption(p,s.getValue(p));this._addParameterValues(k,p,"I","EQ",j[p]);}else{switch(this.sParamHandlingMode){case P.SelVarWins:n.massAddSelectOption(p,s.getValue(p));break;case P.URLParamWins:this._addParameterValues(n,p,"I","EQ",j[p]);break;case P.InsertInSelOpt:n.massAddSelectOption(p,s.getValue(p));this._addParameterValues(n,p,"I","EQ",j[p]);break;default:throw new N("NavigationHandler.INVALID_INPUT");}}}else{if(D.indexOf(p)>-1){k.massAddSelectOption(p,s.getValue(p));}else{n.massAddSelectOption(p,s.getValue(p));}}}for(p in j){if(l.indexOf(p)>-1){continue;}if(D.indexOf(p)>-1){this._addParameterValues(k,p,"I","EQ",j[p]);}else{this._addParameterValues(n,p,"I","EQ",j[p]);}}var q=false;if(n.isEmpty()){q=true;var r=k.getSelectOptionsPropertyNames();for(i=0;i<r.length;i++){n.massAddSelectOption(r[i],k.getValue(r[i]));}}return{oNavigationSelVar:n,oDefaultedSelVar:k,bNavSelVarHasDefaultsOnly:q};},_addParameterValues:function(s,p,j,o,v){if(Array.isArray(v)){for(var i=0;i<v.length;i++){s.addSelectOption(p,j,o,v[i]);}}else{s.addSelectOption(p,j,o,v);}},replaceHash:function(A){var o=this.oRouter.oHashChanger?this.oRouter.oHashChanger:H.getInstance();var s=o.getHash();var i=this._replaceInnerAppStateKey(s,A);o.replaceHash(i);},storeInnerAppState:function(i,I){if(typeof I!=="boolean"){I=true;}var n=this;var M=jQuery.Deferred();var r=function(s){var k=n.oRouter.oHashChanger?n.oRouter.oHashChanger:H.getInstance();var l=k.getHash();var p=n._replaceInnerAppStateKey(l,s);k.replaceHash(p);};if(i===null){M.resolve("");return M.promise();}var A=this._oLastSavedInnerAppData.sAppStateKey;if(c(i)&&!A){M.resolve("");return M.promise();}var j=JSON.stringify(i)===JSON.stringify(this._oLastSavedInnerAppData.oAppData);if(j&&A){this._oLastSavedInnerAppData.iCacheHit++;r(A);M.resolve(A);return M.promise();}this._oLastSavedInnerAppData.iCacheMiss++;var o=function(s){if(!I){r(s);}n._oLastSavedInnerAppData.oAppData=i;n._oLastSavedInnerAppData.sAppStateKey=s;M.resolve(s);};var O=function(E){M.reject(E);};var s=this._saveAppState(i,o,O);if(s!==undefined){if(I){r(s);}}return M.promise();},storeInnerAppStateWithImmediateReturn:function(i,I,n){if(typeof I!=="boolean"){I=false;}var t=this;var A=jQuery.Deferred();if(i===null){return{appStateKey:"",promise:A.resolve("")};}var s=this._oLastSavedInnerAppData.sAppStateKey;if(c(i)&&!s){return{appStateKey:"",promise:A.resolve("")};}var j=JSON.stringify(i)===JSON.stringify(this._oLastSavedInnerAppData.oAppData);if(j&&s){this._oLastSavedInnerAppData.iCacheHit++;return{appStateKey:s,promise:A.resolve(s)};}this._oLastSavedInnerAppData.iCacheMiss++;var o=function(k){if(!I){t.replaceHash(k);}t._oLastSavedInnerAppData.oAppData=i;t._oLastSavedInnerAppData.sAppStateKey=k;A.resolve(k);};var O=function(E){A.reject(E);};var k=this._saveAppState(i,o,O,n);return{appStateKey:k,promise:A.promise()};},processBeforeSmartLinkPopoverOpens:function(t,s,i,E){var M=jQuery.Deferred();var j=t.semanticAttributes;var x,n=this;if(E===undefined){x={};}else{x=E;}var k=function(j,s){s=x.selectionVariant||s||"{}";var l=g.raiseErrorOnNull|g.raiseErrorOnUndefined;var p=a.mixAttributesAndSelectionVariant(j,s,l);s=p.toJSONString();var T={};T.selectionVariant=p.toJSONObject();T=n._removeMeasureBasedInformation(T);T=n._checkIsPotentiallySensitive(T);j=T.selectionVariant?n._getURLParametersFromSelectionVariant(new S(T.selectionVariant)):{};var O=function(A){t.setSemanticAttributes(j);t.setAppStateKey(A);t.open();M.resolve(t);};var q=function(r){M.reject(r);};x.selectionVariant=s;x=n._removeMeasureBasedInformation(x);n._saveAppState(x,O,q);};if(i){var o=this.storeInnerAppState(i,true);o.done(function(){k(j,s);});o.fail(function(l){M.reject(l);});}else{k(j,s);}return M.promise();},_ensureSelectionVariantFormatString:function(s){if(s===undefined){return undefined;}var C=s;if(typeof s==="object"){C=JSON.stringify(s);}return C;},_saveAppState:function(A,o,O,n){var r=this._saveAppStateWithImmediateReturn(A,O,n);if(r){r.promise.done(function(){if(o){o(r.appStateKey);}});if(O){var i=this;r.promise.fail(function(){var E=i._createTechnicalError("NavigationHandler.AppStateSave.failed");O(E);});}return r.appStateKey;}return undefined;},_saveAppStateWithImmediateReturn:function(A,o,n){var i=this.oCrossAppNavService.createEmptyAppState(this.oComponent);var s=i.getKey();var j={};if(this._getModel().isA("sap.ui.model.odata.v4.ODataModel")&&n){j=m(j,A);}else{j={selectionVariant:{},tableVariantId:"",customData:{}};if(A.hasOwnProperty("selectionVariant")){j.selectionVariant=A.selectionVariant;if(A.selectionVariant){if(typeof A.selectionVariant==="string"){try{j.selectionVariant=JSON.parse(A.selectionVariant);}catch(x){var E=this._createTechnicalError("NavigationHandler.AppStateSave.parseError");if(o){o(E);}return undefined;}}}}if(A.tableVariantId){j.tableVariantId=A.tableVariantId;}if(A.customData){j.customData=A.customData;}if(A.presentationVariant){j.presentationVariant=A.presentationVariant;}if(A.valueTexts){j.valueTexts=A.valueTexts;}}j=this._checkIsPotentiallySensitive(j);i.setData(j);var k=i.save();return{appStateKey:s,promise:k.promise()};},_loadAppState:function(A,D){var o=this.oCrossAppNavService.getAppState(this.oComponent,A);var n=this;o.done(function(i){var j={};var k=i.getData();if(typeof k==="undefined"){var E=n._createTechnicalError("NavigationHandler.getDataFromAppState.failed");D.reject(E,{},f.iAppState);}else{if(n._getModel().isA("sap.ui.model.odata.v4.ODataModel")){j=m(j,k);}else{j={selectionVariant:"{}",oSelectionVariant:new S(),oDefaultedSelectionVariant:new S(),bNavSelVarHasDefaultsOnly:false,tableVariantId:"",customData:{},appStateKey:A,presentationVariant:{},valueTexts:{}};if(k.selectionVariant){j.selectionVariant=n._ensureSelectionVariantFormatString(k.selectionVariant);j.oSelectionVariant=new S(j.selectionVariant);}if(k.tableVariantId){j.tableVariantId=k.tableVariantId;}if(k.customData){j.customData=k.customData;}if(k.presentationVariant){j.presentationVariant=k.presentationVariant;}if(k.valueTexts){j.valueTexts=k.valueTexts;}}}D.resolve(j,{},f.iAppState);});o.fail(function(){var E=n._createTechnicalError("NavigationHandler.getAppState.failed");D.reject(E,{},f.iAppState);});},_getInnerAppStateKey:function(A){if(!A){return undefined;}var M=this._rIAppStateNew.exec(A);if(M===null){M=this._rIAppStateOld.exec(A);}if(M===null){M=this._rIAppStateOldAtStart.exec(A);}if(M===null){return undefined;}return M[1];},_replaceInnerAppStateKey:function(A,s){var n=this.IAPP_STATE+"="+s;if(!A){return"?"+n;}var i=function(A){if(A.indexOf("?")!==-1){return A+"&"+n;}return A+"?"+n;};if(!this._getInnerAppStateKey(A)){return i(A);}if(this._rIAppStateNew.test(A)){return A.replace(this._rIAppStateNew,function(j){return j.replace(/\=.*/gi,"="+s);});}var r=function(j,A){A=A.replace(j,"");return i(A);};if(this._rIAppStateOld.test(A)){return r(this._rIAppStateOld,A);}if(this._rIAppStateOldAtStart.test(A)){return r(this._rIAppStateOldAtStart,A);}d(false,"internal inconsistency: Approach of sap-iapp-state not known, but _getInnerAppStateKey returned it");return undefined;},_getURLParametersFromSelectionVariant:function(s){var u={};var i=0;if(typeof s==="string"){var o=new S(s);}else if(typeof s==="object"){o=s;}else{throw new N("NavigationHandler.INVALID_INPUT");}var j=o.getSelectOptionsPropertyNames();for(i=0;i<j.length;i++){var k=o.getSelectOption(j[i]);if(k.length===1&&k[0].Sign==="I"&&k[0].Option==="EQ"){u[j[i]]=k[0].Low;}}var p=o.getParameterNames();for(i=0;i<p.length;i++){var l=o.getParameter(p[i]);u[p[i]]=l;}return u;},_createTechnicalError:function(E){return new N(E);},setModel:function(M){this._oModel=M;},_getModel:function(){return this._oModel||this.oComponent.getModel();},_removeAllProperties:function(D){if(D){if(D.selectionVariant){D.selectionVariant=null;}if(D.valueTexts){D.valueTexts=null;}}},_removeProperties:function(F,p,D){if(F.length&&D&&(D.selectionVariant||D.valueTexts)){F.forEach(function(n){if(D.selectionVariant.SelectOptions){D.selectionVariant.SelectOptions.some(function(v,i){if(n===v.PropertyName){D.selectionVariant.SelectOptions.splice(i,1);return true;}return false;});}if(D.valueTexts&&D.valueTexts.Texts){D.valueTexts.Texts.forEach(function(t){if(t.PropertyTexts){t.PropertyTexts.some(function(v,i){if(n===v.PropertyName){t.PropertyTexts.splice(i,1);return true;}return false;});}});}});}if(p.length&&D&&D.selectionVariant&&D.selectionVariant.Parameters){p.forEach(function(n){D.selectionVariant.Parameters.some(function(v,i){if(n===v.PropertyName||"$Parameter."+n===v.PropertyName){D.selectionVariant.Parameters.splice(i,1);return true;}return false;});});}},_isTermTrue:function(p,t){var i=function(T){if(T){return T.Bool?T.Bool!=="false":true;}return false;};return!!p[t]&&i(p[t]);},_isExcludedFromNavigationContext:function(p){return this._isTermTrue(p,"com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext");},_isPotentiallySensitive:function(p){return this._isTermTrue(p,"com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive");},_isMeasureProperty:function(p){return this._isTermTrue(p,"com.sap.vocabularies.Analytics.v1.Measure");},_isToBeExcluded:function(p){return this._isPotentiallySensitive(p)||this._isExcludedFromNavigationContext(p);},constructContextUrl:function(E,M){if(!E){throw new N("NavigationHandler.NO_ENTITY_SET_PROVIDED");}if(M===undefined){M=this._getModel();}if(!(M&&M.isA("sap.ui.model.odata.v2.ODataModel"))){throw new N("NavigationHandler.NO_V2_MODEL_PROVIDED");}return this._constructContextUrl(M)+"#"+E;},_constructContextUrl:function(M){var s=M._getServerUrl();if(s&&s.lastIndexOf("/")===s.length-1){s=s.substr(0,s.length-1);}return s+M.sServiceUrl+"/$metadata";},_checkIsPotentiallySensitive:function(D){var A=D,s=[],k=[];var i,M,o,E,l,n,p,F=[],q=[];if(D&&D.selectionVariant&&((D.selectionVariant.FilterContextUrl&&D.selectionVariant.SelectOptions)||(D.selectionVariant.ParameterContextUrl&&D.selectionVariant.Parameters))){M=this._getModel();if(this.oComponent&&M&&M.isA("sap.ui.model.odata.v2.ODataModel")){o=M.getMetaModel();if(M.getServiceMetadata()&&o&&o.oModel){if(D.selectionVariant.FilterContextUrl){F=D.selectionVariant.FilterContextUrl.split("#");}if(F.length===2&&D.selectionVariant.SelectOptions&&this._constructContextUrl(M).indexOf(F[0])===0){E=o.getODataEntitySet(F[1]);if(E){l=o.getODataEntityType(E.entityType);}else{l=o.getODataEntityType(F[1]);}if(l){if(l&&l.property){for(i=0;i<l.property.length;i++){if(this._isToBeExcluded(l.property[i])){s.push(l.property[i].name);}}}if(l.navigationProperty){for(i=0;i<l.navigationProperty.length;i++){p=o.getODataAssociationEnd(l,l.navigationProperty[i].name);if(!p||p.type===D.selectionVariant.FilterContextUrl){continue;}if(p.multiplicity==="1"||p.multiplicity==="0..1"){n=o.getODataEntityType(p.type);if(n&&n.property){for(var j=0;j<n.property.length;j++){if(this._isToBeExcluded(n.property[j])){s.push(l.navigationProperty[i].name+"."+n.property[j].name);}}}}}}}}if(D.selectionVariant.ParameterContextUrl){q=D.selectionVariant.ParameterContextUrl.split("#");}if(q.length===2&&D.selectionVariant.Parameters&&this._constructContextUrl(M).indexOf(q[0])===0){E=o.getODataEntitySet(q[1]);if(E){l=o.getODataEntityType(E.entityType);}else{l=o.getODataEntityType(F[1]);}if(l){if(l.property){for(i=0;i<l.property.length;i++){if(this._isToBeExcluded(l.property[i])){k.push(l.property[i].name);}}}}}if(s.length||k.length){A=e(true,{},A);this._removeProperties(s,k,A);}}else{this._removeAllProperties(A);L.error("NavigationHandler: oMetadata are not fully loaded!");}}}return A;},_removeMeasureBasedInformation:function(A){var o=A;if(A.selectionVariant){if(typeof A.selectionVariant==="string"){try{o.selectionVariant=JSON.parse(A.selectionVariant);}catch(x){L.error("NavigationHandler: _removeMeasureBasedInformation parse error");}}o=this._removeMeasureBasedProperties(o);}return o;},_removeMeasureBasedProperties:function(D){var A=D,M=[],k=[];var i,o,l,E,n,s,p,F=[],q=[];if(D&&D.selectionVariant&&((D.selectionVariant.FilterContextUrl&&D.selectionVariant.SelectOptions)||(D.selectionVariant.ParameterContextUrl&&D.selectionVariant.Parameters))){o=this._getModel();if(this.oComponent&&o&&o.isA("sap.ui.model.odata.v2.ODataModel")){l=o.getMetaModel();if(o.getServiceMetadata()&&l&&l.oModel){if(D.selectionVariant.FilterContextUrl){F=D.selectionVariant.FilterContextUrl.split("#");}if(F.length===2&&D.selectionVariant.SelectOptions&&this._constructContextUrl(o).indexOf(F[0])===0){E=l.getODataEntitySet(F[1]);if(E){n=l.getODataEntityType(E.entityType);}else{n=l.getODataEntityType(F[1]);}if(n){if(n&&n.property){for(i=0;i<n.property.length;i++){if(this._isMeasureProperty(n.property[i])){M.push(n.property[i].name);}}}if(n.navigationProperty){for(i=0;i<n.navigationProperty.length;i++){p=l.getODataAssociationEnd(n,n.navigationProperty[i].name);if(!p||p.type===D.selectionVariant.FilterContextUrl){continue;}if(p.multiplicity==="1"||p.multiplicity==="0..1"){s=l.getODataEntityType(p.type);if(s&&s.property){for(var j=0;j<s.property.length;j++){if(this._isMeasureProperty(s.property[j])){M.push(n.navigationProperty[i].name+"."+s.property[j].name);}}}}}}}}if(D.selectionVariant.ParameterContextUrl){q=D.selectionVariant.ParameterContextUrl.split("#");}if(q.length===2&&D.selectionVariant.Parameters&&this._constructContextUrl(o).indexOf(q[0])===0){E=l.getODataEntitySet(q[1]);if(E){n=l.getODataEntityType(E.entityType);}else{n=l.getODataEntityType(F[1]);}if(n){if(n.property){for(i=0;i<n.property.length;i++){if(this._isMeasureProperty(n.property[i])){k.push(n.property[i].name);}}}}}if(M.length||k.length){A=e(true,{},A);this._removeProperties(M,k,A);}}else{this._removeAllProperties(A);L.error("NavigationHandler: oMetadata are not fully loaded!");}}}return A;}});return h;});
