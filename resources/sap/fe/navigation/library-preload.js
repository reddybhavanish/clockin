//@ui5-bundle sap/fe/navigation/library-preload.js
/*
 * ! @copyright@
 */
sap.ui.predefine('sap/fe/navigation/NavigationHandler',["./NavError","./NavigationHelper","./SelectionVariant","./library","sap/ui/base/Object","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/Log","sap/base/assert","sap/base/util/merge"],function(N,a,S,b,B,U,H,e,c,L,d,m){"use strict";var f=b.NavType;var P=b.ParamHandlingMode;var g=b.SuppressionBehavior;
var h=B.extend("sap.fe.navigation.NavigationHandler",{
metadata:{publicMethods:["navigate","parseNavigation","storeInnerAppState","storeInnerAppStateWithImmediateReturn","processBeforeSmartLinkPopoverOpens","setModel","getTechnicalParameters","setTechnicalParameters","replaceHash"]},
constructor:function(C,p){if(!C){throw new N("NavigationHandler.INVALID_INPUT");}if(C instanceof U){this.oRouter=C.getRouter();this.oComponent=C;}else{if(typeof C.getOwnerComponent!=="function"){throw new N("NavigationHandler.INVALID_INPUT");}this.oRouter=this._getRouter(C);this.oComponent=C.getOwnerComponent();}if(this.oComponent&&this.oComponent.getAppComponent){this.oComponent=this.oComponent.getAppComponent();}if(typeof this.oRouter==="undefined"||typeof this.oComponent==="undefined"||typeof this.oComponent.getComponentData!=="function"){throw new N("NavigationHandler.INVALID_INPUT");}try{this.oCrossAppNavService=this._getAppNavigationService();if(!this.oCrossAppNavService){L.error("NavigationHandler: CrossApplicationNavigation is not available.");throw new N("NavigationHandler.NO.XAPPSERVICE");}}catch(i){L.error("NavigationHandler: UShell service API for CrossApplicationNavigation is not available.");}this.IAPP_STATE="sap-iapp-state";this.sDefaultedParamProp="sap-ushell-defaultedParameterNames";this.sSAPSystemProp="sap-system";this._aTechnicalParamaters=["hcpApplicationId"];this._oLastSavedInnerAppData={sAppStateKey:"",oAppData:{},iCacheHit:0,iCacheMiss:0};this._rIAppStateOld=new RegExp("/"+this.IAPP_STATE+"=([^/?]+)");this._rIAppStateOldAtStart=new RegExp("^"+this.IAPP_STATE+"=([^/?]+)");this._rIAppStateNew=new RegExp("[?&]"+this.IAPP_STATE+"=([^&]+)");if(p===P.URLParamWins||p===P.InsertInSelOpt){this.sParamHandlingMode=p;}else{this.sParamHandlingMode=P.SelVarWins;}},
_getAppNavigationService:function(){return sap.ushell.Container.getService("CrossApplicationNavigation");},
_getRouter:function(C){return U.getRouterFor(C);},
navigate:function(s,A,n,i,o,E,j){var k,p,x,C,l,q=false,t={};C=this.oComponent.getComponentData();if(C){l=C.startupParameters;if(l&&l["sap-ushell-next-navmode"]&&l["sap-ushell-next-navmode"].length>0){q=l["sap-ushell-next-navmode"][0]==="explace";}}if(j&&(j==="inplace"||j==="explace")){q=j==="explace";}else if(j){throw new N("NavigationHandler.INVALID_NAV_MODE");}if(E===undefined||E===null){x={};}else{x=E;}if(typeof n==="string"){k=n;}else if(typeof n==="object"){var r=this._splitInboundNavigationParameters(new S(),n,[]).oNavigationSelVar;k=r.toJSONString();}else{throw new N("NavigationHandler.INVALID_INPUT");}t.selectionVariant=new S(k).toJSONObject();t=this._removeMeasureBasedInformation(t);t=this._checkIsPotentiallySensitive(t);if(t.selectionVariant){p=this._getURLParametersFromSelectionVariant(new S(t.selectionVariant));k=new S(t.selectionVariant).toJSONString();}else{p={};k=null;}var u=this;var v={target:{semanticObject:s,action:A},params:p||{}};if(j){v.params["sap-ushell-navmode"]=q?"explace":"inplace";}var w=u.oCrossAppNavService.isNavigationSupported([v],u.oComponent);w.done(function(T){if(T[0].supported){var R;if(!q){R=u.storeInnerAppStateWithImmediateReturn(i,true);if(R&&R.appStateKey){u.replaceHash(R.appStateKey);}}if(!x.selectionVariant){x.selectionVariant=k;}x=u._removeMeasureBasedInformation(x);R=u._saveAppStateWithImmediateReturn(x,o);if(R){v.appStateKey=R.appStateKey;u.oCrossAppNavService.toExternal(v,u.oComponent);}}else{if(o){var y=new N("NavigationHandler.isIntentSupported.notSupported");o(y);}}});if(o){w.fail(function(){var y=u._createTechnicalError("NavigationHandler.isIntentSupported.failed");o(y);});}},
parseNavigation:function(){var A=H.getInstance().getHash();var i=this._getInnerAppStateKey(A);var C=this.oComponent.getComponentData();if(C===undefined){L.warning("The navigation Component's data was not set properly; assuming instead that no parameters are provided.");C={};}var s=C.startupParameters;var D=[];if(s&&s[this.sDefaultedParamProp]&&s[this.sDefaultedParamProp].length>0){D=JSON.parse(s[this.sDefaultedParamProp][0]);}var M=jQuery.Deferred();var n=this;if(i){this._loadAppState(i,M);}else{var I=C["sap-xapp-state"]!==undefined;if(I){var o=this.oCrossAppNavService.getStartupAppState(this.oComponent);o.done(function(l){var k=l.getData();if(k){try{k=JSON.parse(JSON.stringify(k));}catch(x){var E=n._createTechnicalError("NavigationHandler.AppStateData.parseError");M.reject(E,s,f.xAppState);return M.promise();}}if(k){var p=new S(k.selectionVariant);var j=n._splitInboundNavigationParameters(p,s,D);k.selectionVariant=j.oNavigationSelVar.toJSONString();k.oSelectionVariant=j.oNavigationSelVar;k.oDefaultedSelectionVariant=j.oDefaultedSelVar;k.bNavSelVarHasDefaultsOnly=j.bNavSelVarHasDefaultsOnly;M.resolve(k,s,f.xAppState);}else{E=n._createTechnicalError("NavigationHandler.getDataFromAppState.failed");M.reject(E,s||{},f.xAppState);}});o.fail(function(){var E=n._createTechnicalError("NavigationHandler.getStartupState.failed");M.reject(E,{},f.xAppState);});}else{if(s){var j=n._splitInboundNavigationParameters(new S(),s,D);if(j.oNavigationSelVar.isEmpty()&&j.oDefaultedSelVar.isEmpty()){M.resolve({},s,f.initial);}else{var k={};k.selectionVariant=j.oNavigationSelVar.toJSONString();k.oSelectionVariant=j.oNavigationSelVar;k.oDefaultedSelectionVariant=j.oDefaultedSelVar;k.bNavSelVarHasDefaultsOnly=j.bNavSelVarHasDefaultsOnly;M.resolve(k,s,f.URLParams);}}else{M.resolve({},{},f.initial);}}}return M.promise();},
setTechnicalParameters:function(t){if(!t){t=[];}if(!Array.isArray(t)){L.error("NavigationHandler: parameter incorrect, array of strings expected");throw new N("NavigationHandler.INVALID_INPUT");}this._aTechnicalParamaters=t;},
getTechnicalParameters:function(){return this._aTechnicalParamaters.concat([]);},
_isTechnicalParameter:function(p){if(p){if(p.toLowerCase().indexOf("sap-")===0){return true;}else if(this._aTechnicalParamaters.indexOf(p)>=0){return true;}}return false;},
_splitInboundNavigationParameters:function(s,o,D){if(!Array.isArray(D)){throw new N("NavigationHandler.INVALID_INPUT");}var p,i;var j={};for(p in o){if(!o.hasOwnProperty(p)){continue;}if(this._isTechnicalParameter(p)){continue;}if(typeof o[p]==="string"){j[p]=o[p];}else if(jQuery.type(o[p])==="array"&&o[p].length===1){j[p]=o[p][0];}else if(jQuery.type(o[p])==="array"&&o[p].length>1){j[p]=o[p];}else{throw new N("NavigationHandler.INVALID_INPUT");}}var k=new S();var n=new S();var l=s.getParameterNames().concat(s.getSelectOptionsPropertyNames());for(i=0;i<l.length;i++){p=l[i];if(p in j){if(D.indexOf(p)>-1){n.massAddSelectOption(p,s.getValue(p));this._addParameterValues(k,p,"I","EQ",j[p]);}else{switch(this.sParamHandlingMode){case P.SelVarWins:n.massAddSelectOption(p,s.getValue(p));break;case P.URLParamWins:this._addParameterValues(n,p,"I","EQ",j[p]);break;case P.InsertInSelOpt:n.massAddSelectOption(p,s.getValue(p));this._addParameterValues(n,p,"I","EQ",j[p]);break;default:throw new N("NavigationHandler.INVALID_INPUT");}}}else{if(D.indexOf(p)>-1){k.massAddSelectOption(p,s.getValue(p));}else{n.massAddSelectOption(p,s.getValue(p));}}}for(p in j){if(l.indexOf(p)>-1){continue;}if(D.indexOf(p)>-1){this._addParameterValues(k,p,"I","EQ",j[p]);}else{this._addParameterValues(n,p,"I","EQ",j[p]);}}var q=false;if(n.isEmpty()){q=true;var r=k.getSelectOptionsPropertyNames();for(i=0;i<r.length;i++){n.massAddSelectOption(r[i],k.getValue(r[i]));}}return{oNavigationSelVar:n,oDefaultedSelVar:k,bNavSelVarHasDefaultsOnly:q};},
_addParameterValues:function(s,p,j,o,v){if(Array.isArray(v)){for(var i=0;i<v.length;i++){s.addSelectOption(p,j,o,v[i]);}}else{s.addSelectOption(p,j,o,v);}},
replaceHash:function(A){var o=this.oRouter.oHashChanger?this.oRouter.oHashChanger:H.getInstance();var s=o.getHash();var i=this._replaceInnerAppStateKey(s,A);o.replaceHash(i);},
storeInnerAppState:function(i,I){if(typeof I!=="boolean"){I=true;}var n=this;var M=jQuery.Deferred();var r=function(s){var k=n.oRouter.oHashChanger?n.oRouter.oHashChanger:H.getInstance();var l=k.getHash();var p=n._replaceInnerAppStateKey(l,s);k.replaceHash(p);};if(i===null){M.resolve("");return M.promise();}var A=this._oLastSavedInnerAppData.sAppStateKey;if(c(i)&&!A){M.resolve("");return M.promise();}var j=JSON.stringify(i)===JSON.stringify(this._oLastSavedInnerAppData.oAppData);if(j&&A){this._oLastSavedInnerAppData.iCacheHit++;r(A);M.resolve(A);return M.promise();}this._oLastSavedInnerAppData.iCacheMiss++;var o=function(s){if(!I){r(s);}n._oLastSavedInnerAppData.oAppData=i;n._oLastSavedInnerAppData.sAppStateKey=s;M.resolve(s);};var O=function(E){M.reject(E);};var s=this._saveAppState(i,o,O);if(s!==undefined){if(I){r(s);}}return M.promise();},
storeInnerAppStateWithImmediateReturn:function(i,I,n){if(typeof I!=="boolean"){I=false;}var t=this;var A=jQuery.Deferred();if(i===null){return{appStateKey:"",promise:A.resolve("")};}var s=this._oLastSavedInnerAppData.sAppStateKey;if(c(i)&&!s){return{appStateKey:"",promise:A.resolve("")};}var j=JSON.stringify(i)===JSON.stringify(this._oLastSavedInnerAppData.oAppData);if(j&&s){this._oLastSavedInnerAppData.iCacheHit++;return{appStateKey:s,promise:A.resolve(s)};}this._oLastSavedInnerAppData.iCacheMiss++;var o=function(k){if(!I){t.replaceHash(k);}t._oLastSavedInnerAppData.oAppData=i;t._oLastSavedInnerAppData.sAppStateKey=k;A.resolve(k);};var O=function(E){A.reject(E);};var k=this._saveAppState(i,o,O,n);return{appStateKey:k,promise:A.promise()};},
processBeforeSmartLinkPopoverOpens:function(t,s,i,E){var M=jQuery.Deferred();var j=t.semanticAttributes;var x,n=this;if(E===undefined){x={};}else{x=E;}var k=function(j,s){s=x.selectionVariant||s||"{}";var l=g.raiseErrorOnNull|g.raiseErrorOnUndefined;var p=a.mixAttributesAndSelectionVariant(j,s,l);s=p.toJSONString();var T={};T.selectionVariant=p.toJSONObject();T=n._removeMeasureBasedInformation(T);T=n._checkIsPotentiallySensitive(T);j=T.selectionVariant?n._getURLParametersFromSelectionVariant(new S(T.selectionVariant)):{};var O=function(A){t.setSemanticAttributes(j);t.setAppStateKey(A);t.open();M.resolve(t);};var q=function(r){M.reject(r);};x.selectionVariant=s;x=n._removeMeasureBasedInformation(x);n._saveAppState(x,O,q);};if(i){var o=this.storeInnerAppState(i,true);o.done(function(){k(j,s);});o.fail(function(l){M.reject(l);});}else{k(j,s);}return M.promise();},
_ensureSelectionVariantFormatString:function(s){if(s===undefined){return undefined;}var C=s;if(typeof s==="object"){C=JSON.stringify(s);}return C;},
_saveAppState:function(A,o,O,n){var r=this._saveAppStateWithImmediateReturn(A,O,n);if(r){r.promise.done(function(){if(o){o(r.appStateKey);}});if(O){var i=this;r.promise.fail(function(){var E=i._createTechnicalError("NavigationHandler.AppStateSave.failed");O(E);});}return r.appStateKey;}return undefined;},
_saveAppStateWithImmediateReturn:function(A,o,n){var i=this.oCrossAppNavService.createEmptyAppState(this.oComponent);var s=i.getKey();var j={};if(this._getModel().isA("sap.ui.model.odata.v4.ODataModel")&&n){j=m(j,A);}else{j={selectionVariant:{},tableVariantId:"",customData:{}};if(A.hasOwnProperty("selectionVariant")){j.selectionVariant=A.selectionVariant;if(A.selectionVariant){if(typeof A.selectionVariant==="string"){try{j.selectionVariant=JSON.parse(A.selectionVariant);}catch(x){var E=this._createTechnicalError("NavigationHandler.AppStateSave.parseError");if(o){o(E);}return undefined;}}}}if(A.tableVariantId){j.tableVariantId=A.tableVariantId;}if(A.customData){j.customData=A.customData;}if(A.presentationVariant){j.presentationVariant=A.presentationVariant;}if(A.valueTexts){j.valueTexts=A.valueTexts;}}j=this._checkIsPotentiallySensitive(j);i.setData(j);var k=i.save();return{appStateKey:s,promise:k.promise()};},
_loadAppState:function(A,D){var o=this.oCrossAppNavService.getAppState(this.oComponent,A);var n=this;o.done(function(i){var j={};var k=i.getData();if(typeof k==="undefined"){var E=n._createTechnicalError("NavigationHandler.getDataFromAppState.failed");D.reject(E,{},f.iAppState);}else{if(n._getModel().isA("sap.ui.model.odata.v4.ODataModel")){j=m(j,k);}else{j={selectionVariant:"{}",oSelectionVariant:new S(),oDefaultedSelectionVariant:new S(),bNavSelVarHasDefaultsOnly:false,tableVariantId:"",customData:{},appStateKey:A,presentationVariant:{},valueTexts:{}};if(k.selectionVariant){j.selectionVariant=n._ensureSelectionVariantFormatString(k.selectionVariant);j.oSelectionVariant=new S(j.selectionVariant);}if(k.tableVariantId){j.tableVariantId=k.tableVariantId;}if(k.customData){j.customData=k.customData;}if(k.presentationVariant){j.presentationVariant=k.presentationVariant;}if(k.valueTexts){j.valueTexts=k.valueTexts;}}}D.resolve(j,{},f.iAppState);});o.fail(function(){var E=n._createTechnicalError("NavigationHandler.getAppState.failed");D.reject(E,{},f.iAppState);});},
_getInnerAppStateKey:function(A){if(!A){return undefined;}var M=this._rIAppStateNew.exec(A);if(M===null){M=this._rIAppStateOld.exec(A);}if(M===null){M=this._rIAppStateOldAtStart.exec(A);}if(M===null){return undefined;}return M[1];},
_replaceInnerAppStateKey:function(A,s){var n=this.IAPP_STATE+"="+s;if(!A){return"?"+n;}var i=function(A){if(A.indexOf("?")!==-1){return A+"&"+n;}return A+"?"+n;};if(!this._getInnerAppStateKey(A)){return i(A);}if(this._rIAppStateNew.test(A)){return A.replace(this._rIAppStateNew,function(j){return j.replace(/\=.*/gi,"="+s);});}var r=function(j,A){A=A.replace(j,"");return i(A);};if(this._rIAppStateOld.test(A)){return r(this._rIAppStateOld,A);}if(this._rIAppStateOldAtStart.test(A)){return r(this._rIAppStateOldAtStart,A);}d(false,"internal inconsistency: Approach of sap-iapp-state not known, but _getInnerAppStateKey returned it");return undefined;},
_getURLParametersFromSelectionVariant:function(s){var u={};var i=0;if(typeof s==="string"){var o=new S(s);}else if(typeof s==="object"){o=s;}else{throw new N("NavigationHandler.INVALID_INPUT");}var j=o.getSelectOptionsPropertyNames();for(i=0;i<j.length;i++){var k=o.getSelectOption(j[i]);if(k.length===1&&k[0].Sign==="I"&&k[0].Option==="EQ"){u[j[i]]=k[0].Low;}}var p=o.getParameterNames();for(i=0;i<p.length;i++){var l=o.getParameter(p[i]);u[p[i]]=l;}return u;},
_createTechnicalError:function(E){return new N(E);},
setModel:function(M){this._oModel=M;},
_getModel:function(){return this._oModel||this.oComponent.getModel();},
_removeAllProperties:function(D){if(D){if(D.selectionVariant){D.selectionVariant=null;}if(D.valueTexts){D.valueTexts=null;}}},
_removeProperties:function(F,p,D){if(F.length&&D&&(D.selectionVariant||D.valueTexts)){F.forEach(function(n){if(D.selectionVariant.SelectOptions){D.selectionVariant.SelectOptions.some(function(v,i){if(n===v.PropertyName){D.selectionVariant.SelectOptions.splice(i,1);return true;}return false;});}if(D.valueTexts&&D.valueTexts.Texts){D.valueTexts.Texts.forEach(function(t){if(t.PropertyTexts){t.PropertyTexts.some(function(v,i){if(n===v.PropertyName){t.PropertyTexts.splice(i,1);return true;}return false;});}});}});}if(p.length&&D&&D.selectionVariant&&D.selectionVariant.Parameters){p.forEach(function(n){D.selectionVariant.Parameters.some(function(v,i){if(n===v.PropertyName||"$Parameter."+n===v.PropertyName){D.selectionVariant.Parameters.splice(i,1);return true;}return false;});});}},
_isTermTrue:function(p,t){var i=function(T){if(T){return T.Bool?T.Bool!=="false":true;}return false;};return!!p[t]&&i(p[t]);},
_isExcludedFromNavigationContext:function(p){return this._isTermTrue(p,"com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext");},
_isPotentiallySensitive:function(p){return this._isTermTrue(p,"com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive");},
_isMeasureProperty:function(p){return this._isTermTrue(p,"com.sap.vocabularies.Analytics.v1.Measure");},
_isToBeExcluded:function(p){return this._isPotentiallySensitive(p)||this._isExcludedFromNavigationContext(p);},
constructContextUrl:function(E,M){if(!E){throw new N("NavigationHandler.NO_ENTITY_SET_PROVIDED");}if(M===undefined){M=this._getModel();}if(!(M&&M.isA("sap.ui.model.odata.v2.ODataModel"))){throw new N("NavigationHandler.NO_V2_MODEL_PROVIDED");}return this._constructContextUrl(M)+"#"+E;},
_constructContextUrl:function(M){var s=M._getServerUrl();if(s&&s.lastIndexOf("/")===s.length-1){s=s.substr(0,s.length-1);}return s+M.sServiceUrl+"/$metadata";},
_checkIsPotentiallySensitive:function(D){var A=D,s=[],k=[];var i,M,o,E,l,n,p,F=[],q=[];if(D&&D.selectionVariant&&((D.selectionVariant.FilterContextUrl&&D.selectionVariant.SelectOptions)||(D.selectionVariant.ParameterContextUrl&&D.selectionVariant.Parameters))){M=this._getModel();if(this.oComponent&&M&&M.isA("sap.ui.model.odata.v2.ODataModel")){o=M.getMetaModel();if(M.getServiceMetadata()&&o&&o.oModel){if(D.selectionVariant.FilterContextUrl){F=D.selectionVariant.FilterContextUrl.split("#");}if(F.length===2&&D.selectionVariant.SelectOptions&&this._constructContextUrl(M).indexOf(F[0])===0){E=o.getODataEntitySet(F[1]);if(E){l=o.getODataEntityType(E.entityType);}else{l=o.getODataEntityType(F[1]);}if(l){if(l&&l.property){for(i=0;i<l.property.length;i++){if(this._isToBeExcluded(l.property[i])){s.push(l.property[i].name);}}}if(l.navigationProperty){for(i=0;i<l.navigationProperty.length;i++){p=o.getODataAssociationEnd(l,l.navigationProperty[i].name);if(!p||p.type===D.selectionVariant.FilterContextUrl){continue;}if(p.multiplicity==="1"||p.multiplicity==="0..1"){n=o.getODataEntityType(p.type);if(n&&n.property){for(var j=0;j<n.property.length;j++){if(this._isToBeExcluded(n.property[j])){s.push(l.navigationProperty[i].name+"."+n.property[j].name);}}}}}}}}if(D.selectionVariant.ParameterContextUrl){q=D.selectionVariant.ParameterContextUrl.split("#");}if(q.length===2&&D.selectionVariant.Parameters&&this._constructContextUrl(M).indexOf(q[0])===0){E=o.getODataEntitySet(q[1]);if(E){l=o.getODataEntityType(E.entityType);}else{l=o.getODataEntityType(F[1]);}if(l){if(l.property){for(i=0;i<l.property.length;i++){if(this._isToBeExcluded(l.property[i])){k.push(l.property[i].name);}}}}}if(s.length||k.length){A=e(true,{},A);this._removeProperties(s,k,A);}}else{this._removeAllProperties(A);L.error("NavigationHandler: oMetadata are not fully loaded!");}}}return A;},
_removeMeasureBasedInformation:function(A){var o=A;if(A.selectionVariant){if(typeof A.selectionVariant==="string"){try{o.selectionVariant=JSON.parse(A.selectionVariant);}catch(x){L.error("NavigationHandler: _removeMeasureBasedInformation parse error");}}o=this._removeMeasureBasedProperties(o);}return o;},
_removeMeasureBasedProperties:function(D){var A=D,M=[],k=[];var i,o,l,E,n,s,p,F=[],q=[];if(D&&D.selectionVariant&&((D.selectionVariant.FilterContextUrl&&D.selectionVariant.SelectOptions)||(D.selectionVariant.ParameterContextUrl&&D.selectionVariant.Parameters))){o=this._getModel();if(this.oComponent&&o&&o.isA("sap.ui.model.odata.v2.ODataModel")){l=o.getMetaModel();if(o.getServiceMetadata()&&l&&l.oModel){if(D.selectionVariant.FilterContextUrl){F=D.selectionVariant.FilterContextUrl.split("#");}if(F.length===2&&D.selectionVariant.SelectOptions&&this._constructContextUrl(o).indexOf(F[0])===0){E=l.getODataEntitySet(F[1]);if(E){n=l.getODataEntityType(E.entityType);}else{n=l.getODataEntityType(F[1]);}if(n){if(n&&n.property){for(i=0;i<n.property.length;i++){if(this._isMeasureProperty(n.property[i])){M.push(n.property[i].name);}}}if(n.navigationProperty){for(i=0;i<n.navigationProperty.length;i++){p=l.getODataAssociationEnd(n,n.navigationProperty[i].name);if(!p||p.type===D.selectionVariant.FilterContextUrl){continue;}if(p.multiplicity==="1"||p.multiplicity==="0..1"){s=l.getODataEntityType(p.type);if(s&&s.property){for(var j=0;j<s.property.length;j++){if(this._isMeasureProperty(s.property[j])){M.push(n.navigationProperty[i].name+"."+s.property[j].name);}}}}}}}}if(D.selectionVariant.ParameterContextUrl){q=D.selectionVariant.ParameterContextUrl.split("#");}if(q.length===2&&D.selectionVariant.Parameters&&this._constructContextUrl(o).indexOf(q[0])===0){E=l.getODataEntitySet(q[1]);if(E){n=l.getODataEntityType(E.entityType);}else{n=l.getODataEntityType(F[1]);}if(n){if(n.property){for(i=0;i<n.property.length;i++){if(this._isMeasureProperty(n.property[i])){k.push(n.property[i].name);}}}}}if(M.length||k.length){A=e(true,{},A);this._removeProperties(M,k,A);}}else{this._removeAllProperties(A);L.error("NavigationHandler: oMetadata are not fully loaded!");}}}return A;}
});
return h;});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/fe/navigation/library',[],function(){"use strict";sap.ui.getCore().initLibrary({name:"sap.fe.navigation",version:"1.78.0",dependencies:["sap.ui.core"],types:["sap.fe.navigation.NavType","sap.fe.navigation.ParamHandlingMode","sap.fe.navigation.SuppressionBehavior"],interfaces:[],controls:[],elements:[],noLibraryCSS:true});sap.fe.navigation.ParamHandlingMode={SelVarWins:"SelVarWins",URLParamWins:"URLParamWins",InsertInSelOpt:"InsertInSelOpt"};sap.fe.navigation.NavType={initial:"initial",URLParams:"URLParams",xAppState:"xAppState",iAppState:"iAppState"};sap.fe.navigation.SuppressionBehavior={standard:0,ignoreEmptyString:1,raiseErrorOnNull:2,raiseErrorOnUndefined:4};return sap.fe.navigation;},false);
/*!
 * @copyright@
 */
sap.ui.predefine('sap/fe/navigation/NavigationHelper',["sap/base/Log","sap/fe/navigation/SelectionVariant","sap/fe/navigation/NavError"],function(L,S,N){"use strict";var a={aValidTypes:["Edm.Boolean","Edm.Byte","Edm.Date","Edm.DateTimeOffset","Edm.Decimal","Edm.Double","Edm.Guid","Edm.Int16","Edm.Int32","Edm.Int64","Edm.SByte","Edm.Single","Edm.String","Edm.TimeOfDay"],oExcludeMap:{"Contains":"NotContains","StartsWith":"NotStartsWith","EndsWith":"NotEndsWith","Empty":"NotEmpty","NotEmpty":"Empty","LE":"NOTLE","GE":"NOTGE","LT":"NOTLT","GT":"NOTGT","BT":"NOTBT","NE":"EQ","EQ":"NE"},removeSensitiveData:function(c,d){if(!c){L.error("Context is required");return;}var p=[],i,P,C=c.getObject(),m=c.getModel().getMetaModel(),e=this._getTargetCollection(c),t=this,I=function(s,b,D){var f;b=b||e;D=D||C;f=m.getObject(b+"/"+s+"@");if(f){if(t._checkPropertyAnnotationsForSensitiveData(f)){return true;}else if(f["@com.sap.vocabularies.Common.v1.FieldControl"]){var F=f["@com.sap.vocabularies.Common.v1.FieldControl"];if(F["$EnumMember"]&&F["$EnumMember"].split("/")[1]==="Inapplicable"){return true;}else if(F["$Path"]){var o=F["$Path"],g=o.split("/");if(g.length>1){return D[g[0]]&&D[g[0]][g[1]]&&D[g[0]][g[1]]===0;}else{return D[o]===0;}}}}return false;};if(C){delete C["@odata.context"];delete C["@odata.metadataEtag"];}if(d){P=d;if(d.getMetadata&&d.getMetadata().getName()==="sap.fe.navigation.SelectionVariant"){i=true;p=d.getPropertyNames()||[];}else if(d instanceof Object){p=Object.keys(d)||[];}else{L.error("Unsupported format - Sensitive data not removed. Pass a SelectionVariant or data map");}}else{p=Object.keys(C)||[];P=JSON.parse(JSON.stringify(C));}p.forEach(function(s){if(!(C[s]instanceof Object)){if(I(s)){if(i){P.removeSelectOption(s);}else{delete P[s];}}}else{var b="/"+m.getObject(e+"/$NavigationPropertyBinding/"+s),n=i?JSON.parse(d.getSelectOption(s)[0].Low):P[s],f=Object.keys(n),g=false;f.forEach(function(h){if(I(h,b,n)){g=true;delete n[h];}});if(g){if(i){P.removeSelectOption(s);P.addSelectOption(s,"I","EQ",JSON.stringify(n));}else{P[s]=n;}}}});return P;},_checkPropertyAnnotationsForSensitiveData:function(p){return(p["@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]||p["@com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]||p["@com.sap.vocabularies.Analytics.v1.Measure"]);},_getTargetCollection:function(c,n){var p=c.getPath(),P,e,b;if(c.getMetadata().getName()==="sap.ui.model.Context"&&c.getObject("$kind")==="EntitySet"){return p;}if(c.getModel){p=(c.getModel().getMetaPath&&c.getModel().getMetaPath(p))||c.getModel().getMetaModel().getMetaPath(p);}P=p.split("/").filter(Boolean);e="/"+P[0];if(P.length===1){return e;}b=typeof n==="undefined"?P[P.length-1]:n;return e+"/$NavigationPropertyBinding/"+b;},addDefaultDisplayCurrency:function(m,A){if(A&&A.oSelectionVariant&&m&&m.length){for(var i=0;i<m.length;i++){var s=A.oSelectionVariant.getSelectOption("DisplayCurrency"),d=A.oDefaultedSelectionVariant&&A.oDefaultedSelectionVariant.getSelectOption("DisplayCurrency");if(m[i].$PropertyPath==="DisplayCurrency"&&(!s||!s.length)&&d&&d.length){var b=d[0];var c=b["Sign"];var o=b["Option"];var l=b["Low"];var h=b["High"];A.oSelectionVariant.addSelectOption("DisplayCurrency",c,o,l,h);}}}},_mixAttributesToSelVariant:function(s,o,i){for(var p in s){if(s.hasOwnProperty(p)){var v=s[p];if(jQuery.type(v)==="array"||jQuery.type(v)==="object"){v=JSON.stringify(v);}else if(jQuery.type(v)==="date"){v=v.toJSON();}else if(jQuery.type(v)==="number"||jQuery.type(v)==="boolean"){v=v.toString();}if(v===""){if(i&sap.fe.navigation.SuppressionBehavior.ignoreEmptyString){L.info("Semantic attribute "+p+" is an empty string and due to the chosen Suppression Behiavour is being ignored.");continue;}}if(v===null){if(i&sap.fe.navigation.SuppressionBehavior.raiseErrorOnNull){throw new N("NavigationHandler.INVALID_INPUT");}else{L.warning("Semantic attribute "+p+" is null and ignored for mix in to selection variant");continue;}}if(v===undefined){if(i&sap.fe.navigation.SuppressionBehavior.raiseErrorOnUndefined){throw new N("NavigationHandler.INVALID_INPUT");}else{L.warning("Semantic attribute "+p+" is undefined and ignored for mix in to selection variant");continue;}}if(jQuery.type(v)==="string"){o.addSelectOption(p,"I","EQ",v);}else{throw new N("NavigationHandler.INVALID_INPUT");}}}return o;},mixAttributesAndSelectionVariant:function(s,b,c){var o=new S(b);var n=new S();if(o.getFilterContextUrl()){n.setFilterContextUrl(o.getFilterContextUrl());}if(o.getParameterContextUrl()){n.setParameterContextUrl(o.getParameterContextUrl());}if(Array.isArray(s)){s.forEach(function(m){a._mixAttributesToSelVariant(m,n,c);});}else{a._mixAttributesToSelVariant(s,n,c);}var p=o.getParameterNames();for(var i=0;i<p.length;i++){if(!n.getSelectOption(p[i])){n.addSelectOption(p[i],"I","EQ",o.getParameter(p[i]));}}var d=o.getSelectOptionsPropertyNames();for(i=0;i<d.length;i++){var e=o.getSelectOption(d[i]);if(!n.getSelectOption(d[i])){for(var j=0;j<e.length;j++){n.addSelectOption(d[i],e[j].Sign,e[j].Option,e[j].Low,e[j].High);}}}return n;}};return a;});
sap.ui.predefine('sap/fe/navigation/PresentationVariant',["./NavError","sap/ui/base/Object","sap/base/util/extend","sap/base/util/each","sap/base/Log"],function(N,B,e,a,L){"use strict";
var P=B.extend("sap.fe.navigation.PresentationVariant",{
constructor:function(p){this._sId="";if(p!==undefined){if(typeof p==="string"){this._parseFromString(p);}else if(typeof p==="object"){this._parseFromObject(p);}else{throw new N("PresentationVariant.INVALID_INPUT_TYPE");}}},
getID:function(){return this._sId;},
setID:function(i){this._sId=i;},
setText:function(n){if(typeof n!=="string"){throw new N("PresentationVariant.INVALID_INPUT_TYPE");}this._sText=n;},
getText:function(){return this._sText;},
setContextUrl:function(u){if(typeof u!=="string"){throw new N("PresentationVariant.INVALID_INPUT_TYPE");}this._sCtxUrl=u;},
getContextUrl:function(){return this._sCtxUrl;},
isEmpty:function(){return(Object.keys(this.getTableVisualization()).length===0&&Object.keys(this.getChartVisualization()).length===0&&Object.keys(this.getProperties()).length===0);},
setProperties:function(p){this._mProperties=e({},p);},
getProperties:function(){return this._mProperties;},
setTableVisualization:function(p){this._mVisTable=e({},p);},
getTableVisualization:function(){return this._mVisTable;},
setChartVisualization:function(p){this._mVisChart=e({},p);},
getChartVisualization:function(){return this._mVisChart;},
toJSONObject:function(){var E={Version:{Major:"1",Minor:"0",Patch:"0"},PresentationVariantID:this._sId};if(this._sCtxUrl){E.ContextUrl=this._sCtxUrl;}if(this._sText){E.Text=this._sText;}else{E.Text="Presentation Variant with ID "+this._sId;}this._serializeProperties(E);this._serializeVisualizations(E);return E;},
toJSONString:function(){return JSON.stringify(this.toJSONObject());},
_serializeProperties:function(E){if(!this.getProperties()){return;}e(E,this.getProperties());},
_serializeVisualizations:function(E){if(this.getTableVisualization()){if(!E.Visualizations){E.Visualizations=[];}E.Visualizations.push(this.getTableVisualization());}if(this.getChartVisualization()){if(!E.Visualizations){E.Visualizations=[];}E.Visualizations.push(this.getChartVisualization());}},
_parseFromString:function(j){if(j===undefined){throw new N("PresentationVariant.UNABLE_TO_PARSE_INPUT");}if(typeof j!=="string"){throw new N("PresentationVariant.INVALID_INPUT_TYPE");}var i=JSON.parse(j);this._parseFromObject(i);},
_parseFromObject:function(i){if(i.PresentationVariantID===undefined){L.warning("PresentationVariantID is not defined");i.PresentationVariantID="";}var I=e({},i);delete I.Version;this.setID(i.PresentationVariantID);delete I.PresentationVariantID;if(i.ContextUrl!==undefined&&i.ContextUrl!==""){this.setContextUrl(i.ContextUrl);delete I.ContextUrl;}if(i.Text!==undefined){this.setText(i.Text);delete I.Text;}if(i.Visualizations){this._parseVisualizations(i.Visualizations);delete I.Visualizations;}this._parseProperties(I);},
_parseProperties:function(i){var p={};a(i,function(k,v){p[k]=v;});this.setProperties(p);},
_parseVisualizations:function(v){if(!Array.isArray(v)){throw new N("PresentationVariant.INVALID_INPUT_TYPE");}if(typeof v.length>2){throw new N("PresentationVariant.TOO_MANY_VISUALIZATIONS");}for(var i=0;i<v.length;i++){if(v[i].Type&&v[i].Type.indexOf("Chart")>=0){this.setChartVisualization(v[i]);}else{this.setTableVisualization(v[i]);}}}
});
return P;});
sap.ui.predefine('sap/fe/navigation/SelectionVariant',["./NavError","sap/ui/base/Object","sap/base/util/each","sap/base/Log"],function(N,B,e,L){"use strict";
var S=B.extend("sap.fe.navigation.SelectionVariant",{
_rVALIDATE_SIGN:new RegExp("[E|I]"),
_rVALIDATE_OPTION:new RegExp("EQ|NE|LE|GE|LT|GT|BT|CP"),
constructor:function(s){this._mParameters={};this._mSelectOptions={};this._sId="";if(s!==undefined){if(typeof s==="string"){this._parseFromString(s);}else if(typeof s==="object"){this._parseFromObject(s);}else{throw new N("SelectionVariant.INVALID_INPUT_TYPE");}}},
getID:function(){return this._sId;},
setID:function(i){this._sId=i;},
setText:function(n){if(typeof n!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}this._sText=n;},
getText:function(){return this._sText;},
setParameterContextUrl:function(u){if(typeof u!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}this._sParameterCtxUrl=u;},
getParameterContextUrl:function(){return this._sParameterCtxUrl;},
getFilterContextUrl:function(){return this._sFilterCtxUrl;},
setFilterContextUrl:function(u){if(typeof u!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}this._sFilterCtxUrl=u;},
addParameter:function(n,v){if(typeof n!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(typeof v!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(n===""){throw new N("SelectionVariant.PARAMETER_WITHOUT_NAME");}if(this._mSelectOptions[n]){throw new N("SelectionVariant.PARAMETER_SELOPT_COLLISION");}this._mParameters[n]=v;return this;},
removeParameter:function(n){if(typeof n!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(n===""){throw new N("SelectionVariant.PARAMETER_WITHOUT_NAME");}delete this._mParameters[n];return this;},
renameParameter:function(n,s){if(typeof n!=="string"||typeof s!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(n===""||s===""){throw new N("SelectionVariant.PARAMETER_WITHOUT_NAME");}if(this._mParameters[n]!==undefined){if(this._mSelectOptions[s]){throw new N("SelectionVariant.PARAMETER_SELOPT_COLLISION");}if(this._mParameters[s]){throw new N("SelectionVariant.PARAMETER_COLLISION");}this._mParameters[s]=this._mParameters[n];delete this._mParameters[n];}return this;},
getParameter:function(n){if(typeof n!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}return this._mParameters[n];},
getParameterNames:function(){return Object.keys(this._mParameters);},
addSelectOption:function(p,s,o,l,h){if(typeof p!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(p===""){throw new N("SelectionVariant.INVALID_PROPERTY_NAME");}if(typeof s!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(typeof o!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(typeof l!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(o==="BT"&&typeof h!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(!this._rVALIDATE_SIGN.test(s.toUpperCase())){throw new N("SelectionVariant.INVALID_SIGN");}if(!this._rVALIDATE_OPTION.test(o.toUpperCase())){throw new N("SelectionVariant.INVALID_OPTION");}if(this._mParameters[p]){throw new N("SelectionVariant.PARAMETER_SELOPT_COLLISION");}if(o!=="BT"){if(h!==undefined&&h!==""&&h!==null){throw new N("SelectionVariant.HIGH_PROVIDED_THOUGH_NOT_ALLOWED");}}if(this._mSelectOptions[p]===undefined){this._mSelectOptions[p]=[];}var E={Sign:s.toUpperCase(),Option:o.toUpperCase(),Low:l};if(o==="BT"){E.High=h;}else{E.High=null;}for(var i=0;i<this._mSelectOptions[p].length;i++){var a=this._mSelectOptions[p][i];if(a.Sign===E.Sign&&a.Option===E.Option&&a.Low===E.Low&&a.High===E.High){return this;}}this._mSelectOptions[p].push(E);return this;},
removeSelectOption:function(n){if(typeof n!=="string"){throw new N("SelectionVariant.SELOPT_WRONG_TYPE");}if(n===""){throw new N("SelectionVariant.SELOPT_WITHOUT_NAME");}delete this._mSelectOptions[n];return this;},
renameSelectOption:function(n,s){if(typeof n!=="string"||typeof s!=="string"){throw new N("SelectionVariant.SELOPT_WRONG_TYPE");}if(n===""||s===""){throw new N("SelectionVariant.SELOPT_WITHOUT_NAME");}if(this._mSelectOptions[n]!==undefined){if(this._mSelectOptions[s]){throw new N("SelectionVariant.SELOPT_COLLISION");}if(this._mParameters[s]){throw new N("SelectionVariant.PARAMETER_SELOPT_COLLISION");}this._mSelectOptions[s]=this._mSelectOptions[n];delete this._mSelectOptions[n];}return this;},
getSelectOption:function(p){if(typeof p!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}if(p===""){throw new N("SelectionVariant.INVALID_PROPERTY_NAME");}var E=this._mSelectOptions[p];if(!E){return undefined;}return JSON.parse(JSON.stringify(E));},
getSelectOptionsPropertyNames:function(){return Object.keys(this._mSelectOptions);},
getPropertyNames:function(){return this.getParameterNames().concat(this.getSelectOptionsPropertyNames());},
massAddSelectOption:function(p,s){if(!Array.isArray(s)){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}for(var i=0;i<s.length;i++){var o=s[i];this.addSelectOption(p,o.Sign,o.Option,o.Low,o.High);}return this;},
getValue:function(n){var v=this.getSelectOption(n);if(v!==undefined){return v;}var p=this.getParameter(n);if(p!==undefined){v=[{Sign:"I",Option:"EQ",Low:p,High:null}];return v;}return undefined;},
isEmpty:function(){return this.getParameterNames().length===0&&this.getSelectOptionsPropertyNames().length===0;},
toJSONObject:function(){var E={Version:{Major:"1",Minor:"0",Patch:"0"},SelectionVariantID:this._sId};if(this._sParameterCtxUrl){E.ParameterContextUrl=this._sParameterCtxUrl;}if(this._sFilterCtxUrl){E.FilterContextUrl=this._sFilterCtxUrl;}if(this._sText){E.Text=this._sText;}else{E.Text="Selection Variant with ID "+this._sId;}this._determineODataFilterExpression(E);this._serializeParameters(E);this._serializeSelectOptions(E);return E;},
toJSONString:function(){return JSON.stringify(this.toJSONObject());},
_determineODataFilterExpression:function(E){E.ODataFilterExpression="";},
_serializeParameters:function(E){if(this._mParameters.length===0){return;}E.Parameters=[];e(this._mParameters,function(p,P){var o={PropertyName:p,PropertyValue:P};E.Parameters.push(o);});},
_serializeSelectOptions:function(E){if(this._mSelectOptions.length===0){return;}E.SelectOptions=[];e(this._mSelectOptions,function(p,a){var s={PropertyName:p,Ranges:a};E.SelectOptions.push(s);});},
_parseFromString:function(j){if(j===undefined){throw new N("SelectionVariant.UNABLE_TO_PARSE_INPUT");}if(typeof j!=="string"){throw new N("SelectionVariant.INVALID_INPUT_TYPE");}var i=JSON.parse(j);this._parseFromObject(i);},
_parseFromObject:function(i){if(i.SelectionVariantID===undefined){L.warning("SelectionVariantID is not defined");i.SelectionVariantID="";}this.setID(i.SelectionVariantID);if(i.ParameterContextUrl!==undefined&&i.ParameterContextUrl!==""){this.setParameterContextUrl(i.ParameterContextUrl);}if(i.FilterContextUrl!==undefined&&i.FilterContextUrl!==""){this.setFilterContextUrl(i.FilterContextUrl);}if(i.Text!==undefined){this.setText(i.Text);}if(i.Parameters){this._parseFromStringParameters(i.Parameters);}if(i.SelectOptions){this._parseFromStringSelectOptions(i.SelectOptions);}},
_parseFromStringParameters:function(p){e(p,function(i,E){this.addParameter(E.PropertyName,E.PropertyValue);}.bind(this));},
_parseFromStringSelectOptions:function(s){e(s,function(i,o){if(!o.Ranges){L.warning("Select Option object does not contain a Ranges entry; ignoring entry");return true;}if(!Array.isArray(o.Ranges)){throw new N("SelectionVariant.SELECT_OPTION_RANGES_NOT_ARRAY");}e(o.Ranges,function(I,r){this.addSelectOption(o.PropertyName,r.Sign,r.Option,r.Low,r.High);}.bind(this));}.bind(this));}
});
return S;},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/fe/navigation/NavError',["sap/ui/base/Object"],function(B){"use strict";
var N=B.extend("sap.fe.navigation.NavError",{
metadata:{publicMethods:["getErrorCode"],properties:{},library:"sap.fe.navigation"},
constructor:function(e){B.apply(this);this._sErrorCode=e;}
});
N.prototype.getErrorCode=function(){return this._sErrorCode;};
return N;});
sap.ui.require.preload({
	"sap/fe/navigation/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.fe.navigation","type":"library","embeds":[],"applicationVersion":{"version":"1.78.0"},"title":"UI5 library: sap.fe.navigation","description":"UI5 library: sap.fe.navigation","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":[]},"sap.ui5":{"dependencies":{"minUI5Version":"1.78","libs":{"sap.ui.core":{"minVersion":"1.78.0"},"sap.ushell":{"minVersion":"1.78.0"}}},"library":{"i18n":false,"css":false,"content":{"controls":[],"elements":[],"types":["sap.fe.navigation.NavType","sap.fe.navigation.ParamHandlingMode","sap.fe.navigation.SuppressionBehavior"],"interfaces":[]}}}}'
},"sap/fe/navigation/library-preload"
);
//# sourceMappingURL=library-preload.js.map