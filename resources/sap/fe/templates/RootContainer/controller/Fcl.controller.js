sap.ui.define(["sap/ui/model/json/JSONModel","./BaseController","sap/f/FlexibleColumnLayoutSemanticHelper","sap/ui/core/Component","sap/fe/core/controllerextensions/Routing"],function(J,B,F,C,R){"use strict";var a={page:{names:["BeginColumn","MidColumn","EndColumn"],currentGetter:{prefix:"getCurrent",suffix:"Page"},getter:{prefix:"get",suffix:"Pages"}}};return B.extend("sap.fe.templates.RootContainer.controller.Fcl",{onInit:function(e){B.prototype.onInit.bind(this)();this.oTargetsAggregation={};this.oTargetsFromRoutePattern={};this.sCurrentRouteName="";this.sCurrentArguments={};this.SQUERYKEYNAME="?query";var A=C.getOwnerComponentFor(this.getView());this.oRouter=A.getRouter();this.oNavigationHelper=A.getRouterProxy();this.oRouter.attachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.oRouter.attachRouteMatched(this.onRouteMatched,this);this._oFCLConfig={};var r=A.getManifest()["sap.ui5"].routing;if(r.config&&r.config.flexibleColumnLayout){var f=r.config.flexibleColumnLayout;if(f.defaultTwoColumnLayoutType){this._oFCLConfig.defaultTwoColumnLayoutType=f.defaultTwoColumnLayoutType;}if(f.defaultThreeColumnLayoutType){this._oFCLConfig.defaultThreeColumnLayoutType=f.defaultThreeColumnLayoutType;}}this.initializeTargetAggregation(A);this._initializeRoutesInformation(A);var o=new R();var b=o.getFirstBeforeRouteMatchedCallEvent();if(b){this.onBeforeRouteMatched(b);}},getFclControl:function(){return this.getView().getContent()[0];},onExit:function(){this.oRouter.detachRouteMatched(this.onRouteMatched,this);this.oRouter.detachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.getFclControl().detachStateChange(this.onStateChanged,this);this.getFclControl().detachAfterEndColumnNavigate(this.onStateChanged,this);this.oRouter=null;this.oTargetsAggregation=null;this.oTargetsFromRoutePattern=null;},isFclEnabled:function(){return true;},initializeTargetAggregation:function(A){var m=A.getManifest();var t=m["sap.ui5"].routing.targets;var b=this;Object.keys(t).forEach(function(T){var o=t[T];if(o.controlAggregation){b.oTargetsAggregation[T]={aggregation:o.controlAggregation,pattern:o.contextPattern};}else{b.oTargetsAggregation[T]={aggregation:"page",pattern:null};}});},_initializeRoutesInformation:function(A){var m=A.getManifest();var r=m["sap.ui5"].routing.routes;var t=this;r.forEach(function(b){t.oTargetsFromRoutePattern[b.pattern]=b.target;});},getCurrentArgument:function(){return this.sCurrentArguments;},getCurrentRouteName:function(){return this.sCurrentRouteName;},getConstants:function(){return a;},getTargetAggregation:function(){return this.oTargetsAggregation;},onRouteMatched:function(e){var r=e.getParameter("name");this._updateUIstateForEachviews();this.sCurrentRouteName=r;this.sCurrentArguments=e.getParameter("arguments");},onStateChanged:function(e){var i=e.getParameter("isNavigationArrow");if(this.sCurrentArguments!==undefined){if(!this.sCurrentArguments[this.SQUERYKEYNAME]){this.sCurrentArguments[this.SQUERYKEYNAME]={};}this.sCurrentArguments[this.SQUERYKEYNAME].layout=e.getParameter("layout");}this._updateUIstateForEachviews();this._forceModelContextChangeOnBreadCrumbs(e);if(i){this.oNavigationHelper.navTo(this.sCurrentRouteName,this.sCurrentArguments);}},_forceModelContextChangeOnBreadCrumbs:function(e){var f=e.getSource();var p=[];p=p.concat(f.getBeginColumnPages()).concat(f.getMidColumnPages()).concat(f.getEndColumnPages());p.forEach(function(P){var v=P.getComponentInstance().getRootControl();var b=v.byId("breadcrumbs");if(b){b.fireModelContextChange();}});},_updateUIstateForEachviews:function(){var t=this;this._getAllCurrentViews().forEach(function(v){t._updateUIStateForView(v);});},_updateShareButtonVisibility:function(v,l){var s;switch(l){case"OneColumn":s=v==="beginColumn";break;case"MidColumnFullScreen":case"ThreeColumnsBeginExpandedEndHidden":case"ThreeColumnsMidExpandedEndHidden":case"TwoColumnsBeginExpanded":case"TwoColumnsMidExpanded":s=v==="midColumn";break;case"EndColumnFullScreen":case"ThreeColumnsEndExpanded":case"ThreeColumnsMidExpanded":s=v==="endColumn";break;default:s=false;}return s;},_updateUIStateForView:function(v){var u=this.getHelper().getCurrentUIState();var f=["beginColumn","midColumn","endColumn"];var b=v.getController().fcl.getFCLLevel();var l=this.getFclControl().getLayout();var c=f[b<=2?b:2];if(!v.getModel("fclhelper")){v.setModel(new J(),"fclhelper");}if(b>2){u.actionButtonsInfo.endColumn.exitFullScreen=null;u.actionButtonsInfo.endColumn.closeColumn=null;}if(b>2||l==="EndColumnFullScreen"||l==="MidColumnFullScreen"||l==="OneColumn"){v.getModel("fclhelper").setProperty("/breadCrumbIsVisible",true);}else{v.getModel("fclhelper").setProperty("/breadCrumbIsVisible",false);}u.actionButtonsInfo.beginColumn={fullScreen:null,exitFullScreen:null,closeColumn:null};v.getModel("fclhelper").setProperty("/actionButtonsInfo",Object.assign({},u.actionButtonsInfo[c]));v.getModel("fclhelper").setProperty("/showShareIcon",this._updateShareButtonVisibility(c,l));},_getViewFromContainer:function(c){if(c.isA("sap.ui.core.ComponentContainer")){return c.getComponentInstance().getRootControl();}else{return c;}},_getAllCurrentViews:function(){var v=[];var c;if((c=this.getFclControl().getCurrentEndColumnPage())!==undefined){v.push(this._getViewFromContainer(c));}if((c=this.getFclControl().getCurrentMidColumnPage())!==undefined){v.push(this._getViewFromContainer(c));}if((c=this.getFclControl().getCurrentBeginColumnPage())!==undefined){v.push(this._getViewFromContainer(c));}return v;},onBeforeRouteMatched:function(e){if(e){var q=e.getParameters().arguments[this.SQUERYKEYNAME];var l=q?q.layout:null;if(!l){var n=this.getHelper().getNextUIState(0);l=n.layout;}var t=e.getParameter("config").target;l=this._correctLayoutForTargets(l,t);if(l){if(!this.getFclControl().getModel("fcl")){this.getFclControl().setModel(new J(),"fcl");this.getFclControl().bindProperty("layout","fcl>/layout");}this.getFclControl().setProperty("layout",l);}}},getHelper:function(){return F.getInstanceFor(this.getFclControl(),this._oFCLConfig);},updateFCLLevels:function(t,c){var v;if(t.length==1&&this.getTargetAggregation()[t[0]].aggregation==="endColumnPages"){v=this._getViewFromContainer(c[0]);v.getController().fcl.setFCLLevel(3);this._updateUIStateForView(v);}else{for(var i=0;i<t.length;i++){var T=t[i];var o=this.getTargetAggregation()[T];v=this._getViewFromContainer(c[i]);switch(o.aggregation){case"beginColumnPages":v.getController().fcl.setFCLLevel(0);break;case"midColumnPages":v.getController().fcl.setFCLLevel(1);break;default:v.getController().fcl.setFCLLevel(2);}this._updateUIStateForView(v);}}},getFCLLayout:function(n,h,p){if(!p){p=this.getHelper().getNextUIState(n).layout;}var r=this.oRouter.getRouteByHash(h+"?layout="+p);var t=this.oTargetsFromRoutePattern[r.getPattern()];return this._correctLayoutForTargets(p,t);},_correctLayoutForTargets:function(p,t){var b={"2":["TwoColumnsMidExpanded","TwoColumnsBeginExpanded","MidColumnFullScreen"],"3":["ThreeColumnsMidExpanded","ThreeColumnsEndExpanded","ThreeColumnsMidExpandedEndHidden","ThreeColumnsBeginExpandedEndHidden","MidColumnFullScreen","EndColumnFullScreen"]};if(!t){return p;}else if(t.length>1){var l=b[t.length];if(l.indexOf(p)<0){p=l[0];}}else{switch(this.getTargetAggregation()[t[0]].aggregation){case"beginColumnPages":p="OneColumn";break;case"midColumnPages":p="MidColumnFullScreen";break;default:p="EndColumnFullScreen";break;}}return p;}});},true);
