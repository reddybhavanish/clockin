sap.ui.define(["sap/ui/test/OpaBuilder","./FEBuilder","./FieldBuilder","./OverflowToolbarBuilder","sap/fe/test/Utils","sap/ui/table/library","sap/ui/test/matchers/Interactable"],function(O,F,a,b,U,G,I){"use strict";var R=G.RowActionType;function _(m){return m._oTable.getMetadata().getName()==="sap.ui.table.Table";}function c(m){return _(m)?"rows":"items";}function d(C,m){var j=Number(C);return Number.isNaN(j)?m.getColumns().findIndex(function(o){return o.getHeader()===C;}):j;}function e(C,r){var m=r;do{m=m.getParent();}while(!m.isA("sap.ui.mdc.Table"));return d(C,m);}function f(C,r){if(U.isOfType(C,String)){return r.getCells().findIndex(function(j){return j.getText&&j.getText()===C;});}else{return F.Matchers.state("type","sap.m.Button")(r.getCells()[C])?C:-1;}}function g(r){var o=r.getRowAction();return o.getItems().reduce(function(j,A,k){if(!j&&A.getType()===R.Navigation){j=o.getAggregation("_icons")[k];}return j;},null);}function h(r){var j=[new I(),F.Matchers.bound()];if(U.isOfType(r,Object)){r=T.Row.Matchers.cellValues(r);}if(r){j=j.concat(r);}return j;}function i(C){return C.isA("sap.ui.mdc.Field")?[C]:O.Matchers.children(O.create().hasType("sap.ui.mdc.Field"))(C);}var T=function(){return F.apply(this,arguments).hasType("sap.ui.mdc.Table");};T.create=function(o){return new T(o);};T.prototype=Object.create(F.prototype);T.prototype.constructor=T;T.prototype.hasColumns=function(C){if(!C||Object.keys(C).length===0){return this;}return this.has(T.Matchers.columnsMatcher(C));};T.prototype.hasRows=function(r,j){r=h(r);return j?this.has(T.Matchers.rows(r)):this.has(T.Matchers.rowsMatcher(r));};T.prototype.doOnRows=function(r,v){if(arguments.length===1){v=r;r=undefined;}if(!v){return this;}return this.hasRows(r,true).do(O.Actions.executor(v));};T.prototype.doClickOnCell=function(r,C){return this.doOnRows(r,T.Row.Actions.onCell(C,O.Actions.press()));};T.prototype.doEditValues=function(r,C){if(arguments.length===1){C=r;r=undefined;}return this.doOnRows(r,T.Row.Actions.editCells(C));};T.prototype.doEditCreationRowValues=function(C){return this.has(O.Matchers.aggregation("creationRow")).do(T.Row.Actions.editCells(C));};T.prototype.doSelect=function(r){return this.doOnRows(r,function(o){if(o.getMetadata().getName()==="sap.ui.table.Row"){var t=o.getParent(),j=t.indexOfRow(o);return O.Actions.press("rowsel"+j).executeOn(t);}return O.Actions.press().executeOn(o.getMultiSelectControl());});};T.prototype.doNavigate=function(r){return this.doOnRows(r,function(o){if(o.getMetadata().getName()==="sap.ui.table.Row"){return O.Actions.press().executeOn(g(o));}return O.Actions.press("imgNav").executeOn(o);});};T.prototype.hasNumberOfRows=function(n){return this.has(function(t){var r=t.getRowBinding();return((r&&(n===undefined?r.getLength()!==0:r.getLength()===n))||(!r&&n===0));});};T.prototype.hasQuickFilterItems=function(n){return this.has(function(t){var q=t.getQuickFilter(),j=q.getItems();if(U.isOfType(j,Array)){return j.length===n;}return false;});};T.prototype.doSelectQuickFilter=function(o){return this.has(function(t){return t.getQuickFilter();}).doConditional(F.Matchers.state("type","sap.m.Select"),O.Actions.press()).success(function(q){return F.create(this).hasId([].concat(q)[0].getId()).doOnAggregation("items",o,O.Actions.press()).execute();}.bind(this));};T.prototype.doOpenOverflow=function(){return b.openOverflow(this,"toolbar");};T.prototype.doCloseOverflow=function(){return b.closeOverflow(this,"toolbar");};T.prototype.doExecuteAction=function(A){var s=new T(this._getOpaInstance(),this.build()).doOnAggregation("actions",A,O.Actions.press());return this.doOpenOverflow().success(s);};T.prototype.doOpenColumnAdaptation=function(){return this.doOpenOverflow().success(function(t){return O.create().hasType("sap.m.Button").hasId(/-settings$/).has(O.Matchers.ancestor(t)).doPress().execute();});};T.prototype.doExecuteInlineAction=function(r,C){return this.doOnRows(r,T.Row.Actions.pressInlineAction(C));};T.Cell={Matchers:{state:function(n,v){switch(n){case"editor":case"editors":return function(C){var j=i(C),k=a.Matchers.states(v);return j.some(k);};default:return F.Matchers.state(n,v);}},states:function(s){if(!U.isOfType(s,Object)){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){return T.Cell.Matchers.state(p,s[p]);}));}}};T.Column={Matchers:{state:function(n,v){switch(n){case"template":case"creationTemplate":return function(C){return a.Matchers.states(v)(C.getAggregation(n));};default:return F.Matchers.state(n,v);}},states:function(s){if(!U.isOfType(s,Object)){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){return T.Column.Matchers.state(p,s[p]);}));}}};T.Row={Matchers:{cell:function(C){return function(r){var j=e(C,r);return r.getCells()[j];};},cellFields:function(C){return function(r){return i(T.Row.Matchers.cell(C)(r));};},cellValue:function(C,E){return function(r){var j=T.Row.Matchers.cellFields(C)(r),k=a.Matchers.value(E);return j.some(k);};},cellValues:function(C){if(!C){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellValue(s,C[s]);}));},cellProperty:function(C,E){return function(r){var o=T.Row.Matchers.cell(C)(r);return T.Cell.Matchers.states(E)(o);};},cellProperties:function(C){if(!C){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellProperty(s,C[s]);}));},selected:function(s){return function(r){var t=r.getParent(),m=t.getParent(),j=_(m),k=j?t.getSelectedIndices.includes(t.indexOfRow(r)):r.getSelected();return s?k:!k;};},focused:function(){return function(r){var E=[r];if(r.getMetadata().getName()==="sap.ui.table.Row"){E.push(g(r));}return E.some(O.Matchers.focused(true));};},states:function(s){if(!U.isOfType(s,Object)){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){switch(p){case"selected":return T.Row.Matchers.selected(s.selected);case"focus":return T.Row.Matchers.focused();default:return F.Matchers.state(p,s[p]);}}));}},Actions:{onCell:function(C,v){return function(r){var j=e(C,r),o;if(r.isA("sap.ui.mdc.table.CreationRow")){o=r._oInnerCreationRow.getCells()[j];}else{o=r.getCells()[j];}if(v.executeOn){v.executeOn(o);}else{v(o);}};},editCell:function(C,v){return T.Row.Actions.onCell(C,O.Actions.enterText(v,true));},editCells:function(C){return Object.keys(C).map(function(s){return T.Row.Actions.editCell(s,C[s]);});},onCellInlineAction:function(C,v){return function(r){var j=f(C,r),o;o=r.getCells()[j];if(v.executeOn){v.executeOn(o);}else{v(o);}};},pressInlineAction:function(C){return T.Row.Actions.onCellInlineAction(C,O.Actions.press());}}};T.Matchers={isGridTable:function(){return _;},rows:function(r){return function(m){return O.Matchers.aggregation(c(m),r)(m._oTable);};},rowsMatcher:function(r){var m=T.Matchers.rows(r);return function(M){return m(M).length>0;};},columns:function(C){return function(m){var j=Object.keys(C).map(function(v){return{index:d(v,m),states:C[v]};}),k=U.getAggregation(m,"columns");return j.reduce(function(r,l){var o=k[l.index];if(o&&(!l.states||F.Matchers.match(T.Column.Matchers.states(l.states))(o))){r.push(o);}return r;},[]);};},columnsMatcher:function(C){var m=T.Matchers.columns(C);return function(M){return m(M).length===Object.keys(C).length;};}};T.Actions={};return T;});
