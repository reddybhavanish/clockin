(function(){'use strict';var e,P;if(typeof module==='undefined'){window.sap=window.sap||{};window.sap.es=window.sap.es||{};window.sap.es.suv=window.sap.es.suv||{};e=window.sap.es.suv;P=window.Promise;}else{P=require('bluebird');var a=require('sap-pdfjs');e=module.exports;}var d=function(b){var r="";var i=0;var c=0;var f=0;var h=0;var j=new Uint8Array(b);if(j.length>=3&&j[0]===0xef&&j[1]===0xbb&&j[2]===0xbf){i=3;}while(i<j.length){c=j[i];if(c<128){r+=String.fromCharCode(c);i++;}else if(c>191&&c<224){if(i+1>=j.length){throw"UTF-8 Decode failed. Two byte character was truncated.";}h=j[i+1];r+=String.fromCharCode(((c&31)<<6)|(h&63));i+=2;}else{if(i+2>=j.length){throw"UTF-8 Decode failed. Multi byte character was truncated.";}h=j[i+1];f=j[i+2];r+=String.fromCharCode(((c&15)<<12)|((h&63)<<6)|(f&63));i+=3;}}return r;};var g=function(u,m){if(P===undefined){P=window.Promise;}return new P(function(r,b){var h=new XMLHttpRequest();if(!h){b('error getting '+u);return;}h.onreadystatechange=function(){if(h.readyState===XMLHttpRequest.DONE){if(h.status===200){r(h.response);}else{b('There was a problem with the request');}}};h.open('GET',u);if(m=='binary'){h.responseType="arraybuffer";}h.send(null);});};e.getSuv=function(u){var h;return g(u,'binary').then(function(b){return e.disAssembleSuv(b);});};e._createDefaultSuvData=function(){var s={entities:[],version:{},title:''};return s;};e._disAssembleSuv=function(s){var h=s.slice(0,80);var p=parseInt(String.fromCharCode.apply(null,new Uint8Array(h)));var b=s.slice(80,80+p);var c=JSON.parse(d(s.slice(80+p)));if(Object.prototype.toString.call(c)==='[object Array]'){c=e._createDefaultSuvData();}c.entities=c.entities||[];c.highlights=c.entities;c.pdfData=b;return c;};e.isSuv=function(s){var h=new Uint8Array(s.slice(0,80));if(h.length<80){return false;}var n=true;for(var i=0;i<80;++i){var c=h[i];var b=c>=48&&c<=57;if(n){if(b){continue;}if(c!==32){return false;}n=false;}else{if(c===32){continue;}else{return false;}}}return true;};e.disAssembleSuv=function(s){if(e.isSuv(s)){return e._disAssembleSuv(s);}else{var b=e._createDefaultSuvData();b.highlights=b.entities;b.pdfData=s;return b;}};e.assembleSuv=function(s){var p=new Array(81).join(' ');var h=new Buffer((''+s.pdfBuffer.length+p).slice(0,80));var b=s.pdfBuffer;var c={version:e.version(),title:s.title||'',conversionOptions:s.conversionOptions,entities:s.entities,};var f=new Buffer(JSON.stringify(c));var i=Buffer.concat([h,b,f]);return i;};e.version=function(){return{'pdfjs':a.version,'sap-fpt':require('../package.json').version};};e.Entity2CssClassMapSingleton=(function(){var b;function c(){var _={};return{hashEntityName:function(o){var f=0;var h='';var l=o.length;if(l===0){return f;}for(var i=0;i<l;i++){h=o.charCodeAt(i);f=((f<<5)-f)+h;f|=0;}f='entity'+'-'+o.replace(/\s/g,'').substring(0,10).toLocaleLowerCase().replace(/[!\"#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,'')+f;return f;},mapEntityToCssClass:function(f){if(_[f]){return _[f];}else{var h=this.hashEntityName(f);_[f]=h;return h;}},getValue:function(k){return _[k];}};};return{getInstance:function(){if(!b){b=c();}return b;}};})();})();
