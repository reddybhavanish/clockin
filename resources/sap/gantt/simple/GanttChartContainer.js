/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/gantt/library","sap/ui/base/ManagedObjectObserver","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/library","../control/AssociateContainer","../config/TimeHorizon","./GanttChartContainerRenderer"],function(C,l,M,S,a,c,A,T){"use strict";var G=l.simple.GanttChartWithTableDisplayType;var O=c.Orientation;var b=C.extend("sap.gantt.simple.GanttChartContainer",{metadata:{library:"sap.gantt",properties:{height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},layoutOrientation:{type:"sap.ui.core.Orientation",group:"Behavior",defaultValue:sap.ui.core.Orientation.Vertical},enableTimeScrollSync:{type:"boolean",defaultValue:true},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType",defaultValue:G.Both}},defaultAggregation:"ganttCharts",aggregations:{toolbar:{type:"sap.gantt.simple.ContainerToolbar",multiple:false},ganttCharts:{type:"sap.gantt.simple.GanttChartWithTable",multiple:true},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false}},events:{customSettingChange:{parameters:{name:{type:"string"},value:{type:"boolean"}}}}}});var d=["enableCursorLine","enableNowLine","enableVerticalLine","enableAdhocLine"];var e=["enableTimeScrollSync"].concat(d);d.forEach(function(p){b.prototype["set"+jQuery.sap.charToUpperCase(p,0)]=function(v){this.setProperty(p,v);this.getGanttCharts().forEach(function(g){g.setProperty(p,v);});return this;};});b.prototype.setSharedPropertiesValueToGantts=function(){d.forEach(function(p){var P=this.getProperty(p);this.getGanttCharts().forEach(function(g){g.setProperty(p,P,true);});}.bind(this));};b.prototype.init=function(){this._bInitHorizonApplied=false;this._nInitialRenderedGantts=0;this._oSplitter=new S({orientation:this.getLayoutOrientation()});this.oObserver=new M(this.observePropertiesChanges.bind(this));this.oObserver.observe(this,{properties:e});};b.prototype.exit=function(){this.oObserver.disconnect();};b.prototype.setDisplayType=function(D){this._setDisplayTypeForAll(D);this.setProperty("displayType",D,false);return this;};b.prototype.setToolbar=function(t){this.setAggregation("toolbar",t,true);t.attachZoomStopChange(this._onToolbarZoomStopChange,this);t.attachBirdEyeButtonPress(this._onToolbarBirdEyeButtonPress,this);t.attachEvent("_settingsChange",this._onToolbarSettingsChange.bind(this));t.attachEvent("_zoomControlTypeChange",this._onToolbarZoomControlTypeChange.bind(this));t.attachDisplayTypeChange(this._onToolbarDisplayTypeChanged,this);t._oDisplayTypeSegmentedButton.setSelectedKey(this.getDisplayType());return this;};b.prototype.setLayoutOrientation=function(o){this.setProperty("layoutOrientation",o);this._oSplitter.setOrientation(o);return this;};b.prototype.addGanttChart=function(g){this.addAggregation("ganttCharts",g);this._insertGanttChart(g);};b.prototype.insertGanttChart=function(g,i){this.insertAggregation("ganttCharts",g,i);this._insertGanttChart(g,i);};b.prototype.removeGanttChart=function(g){this._removeGanttChartFromSplitter(g);var r=this.removeAggregation("ganttCharts",g);this._adjustSplitterLayoutData();return r;};b.prototype.removeAllGanttCharts=function(){var g=this.getGanttCharts();for(var i=0;i<g.length;i++){this._removeGanttChartFromSplitter(g[i]);}return this.removeAllAggregation("ganttCharts");};b.prototype._insertGanttChart=function(g,i){if(!g){return;}var o=this._getOtherGanttSelectionPanelSize(g);if(o){g.setProperty("selectionPanelSize",o,"true");}var f=new A({content:g,layoutData:g.getLayoutData()?g.getLayoutData().clone():new a()});if(i!==0&&!i){this._oSplitter.addContentArea(f);}else{this._oSplitter.insertContentArea(f,i);}this._sanitizeGanttChartEvents(g);this.setSharedPropertiesValueToGantts();g.setDisplayType(this.getDisplayType());};b.prototype._adjustSplitterLayoutData=function(){var g=this.getGanttCharts();var f=this._oSplitter.getContentAreas();if(g.length===1){f[0].getLayoutData().setSize("auto");}};b.prototype._getOtherGanttSelectionPanelSize=function(n){var o=this.getGanttCharts().filter(function(g){return g.getId()!==n.getId();});return o&&o.length>0?o[0].getSelectionPanelSize():null;};b.prototype._sanitizeGanttChartEvents=function(g){var E={"_initialRenderGanttChartsSync":this._onInitialRenderGanttChartsSync,"_timePeriodZoomOperation":this._onGanttChartTimePeriodZoomOperation,"_zoomInfoUpdated":this._onZoomInfoUpdated,"_selectionPanelResize":this._onSelectionPanelWidthChange,"_layoutDataChange":this._onGanttChartLayoutDataChange};Object.keys(E).forEach(function(s){g.detachEvent(s,E[s],this);}.bind(this));Object.keys(E).forEach(function(s){g.attachEvent(s,E[s],this);}.bind(this));};b.prototype._onGanttChartLayoutDataChange=function(E){var g=E.getSource(),n=g.getLayoutData();this._oSplitter.getContentAreas().forEach(function(o){if(o.getContent()===g.getId()){o.getLayoutData().setSize(n.getSize()).setMinSize(n.getMinSize());}});};b.prototype._removeGanttChartFromSplitter=function(g){var o=g;if((typeof g)==="number"){o=this.getGanttCharts()[g];}if(o){this._oSplitter.removeContentArea(o);}return o;};b.prototype._onInitialRenderGanttChartsSync=function(E){var p=E.getParameters();var g=this.getGanttCharts();if(p.reasonCode==="initialRender"&&!this.getEnableTimeScrollSync()){return;}if(!this.getEnableTimeScrollSync()){if(p.reasonCode==="visibleHorizonUpdated"){for(var i=0;i<g.length;i++){if(E.getSource().getId()===g[i].getId()){continue;}g[i].syncVisibleHorizon(p.visibleHorizon,p.visibleWidth,true);}}else{var s;if(p.reasonCode==="mouseWheelZoom"){s="syncMouseWheelZoom";}if(s){for(var m=0;m<g.length;m++){var o=g[m];var f=o;if(E.getSource().getId()===f.getId()){continue;}f[s](p);}}}}else{for(var j=0;j<g.length;j++){g[j].syncVisibleHorizon(p.visibleHorizon,p.visibleWidth);}}};b.prototype._onGanttChartTimePeriodZoomOperation=function(E){var t=this.getEnableTimeScrollSync();var g=this.getGanttCharts();for(var i=0;i<g.length;i++){if(E.getSource().getId()===g[i].getId()){continue;}var o=this._oSplitter.getOrientation();g[i].syncTimePeriodZoomOperation(E,t,o);}};b.prototype._onSelectionPanelWidthChange=function(E){var D=this.getDisplayType(),g=E.getParameter("displayType");if(D!==g){this.setDisplayType(g);return;}if(this.getLayoutOrientation()===O.Horizontal&&D!==G.Both){return;}var n=E.getParameter("newWidth");this.getGanttCharts().forEach(function(o){o.setProperty("selectionPanelSize",n+"px",false);o._draw();});};b.prototype._removeGanttChartFromSplitter=function(g){var o=g;if((typeof g)==="number"){o=this.getGanttCharts()[g];}if(o){this._oSplitter.removeContentArea(o._oAC);}};b.prototype.onBeforeRendering=function(){this.observePropertiesChanges();this.handleZoomControlTypeToAxistimeStrategy();};b.prototype.handleZoomControlTypeToAxistimeStrategy=function(){if(this.getToolbar()){var g=this.getGanttCharts();var z=this.getToolbar().getZoomControlType();g.forEach(function(o){o.getAxisTimeStrategy()._updateZoomControlType(z);});}};b.prototype._onZoomInfoUpdated=function(E){if(this.getToolbar()){var z=E.getParameter("zoomLevel");if(!isNaN(z)){this.getToolbar().updateZoomLevel(z);}}};b.prototype._onToolbarDisplayTypeChanged=function(E){this.setDisplayType(E.getParameter("displayType"));};b.prototype._setDisplayTypeForAll=function(D){var t=this.getToolbar();if(t){t._oDisplayTypeSegmentedButton.setSelectedKey(D);}this.getGanttCharts().forEach(function(o){o.setDisplayType(D);});};b.prototype._onToolbarBirdEyeButtonPress=function(E){var g=this.getGanttCharts();var s;var o;g.forEach(function(f){var h=f._getZoomExtension().calculateBirdEyeRange();if(h.startTime&&h.endTime){if(!s||h.startTime.getTime()<s.getTime()){s=h.startTime;}if(!o||o.getTime()<h.endTime.getTime()){o=h.endTime;}}});if(s&&o){var B=new T({startTime:s,endTime:o});g.forEach(function(f){f.syncVisibleHorizon(B);});}};b.prototype._onToolbarZoomStopChange=function(E){var g=this.getGanttCharts();g.forEach(function(o){o.getAxisTimeStrategy().updateStopInfo({index:E.getParameter("index"),selectedItem:E.getParameter("selectedItem")});});};b.prototype._onToolbarZoomControlTypeChange=function(E){this._handleZoomControlType(E.getParameter("zoomControlType"));};b.prototype._handleZoomControlType=function(z){var g=this.getGanttCharts();g.forEach(function(o){o.getAxisTimeStrategy()._updateZoomControlType(z);});};b.prototype._onToolbarSettingsChange=function(E){var p=E.getParameters();var f=[];p.forEach(function(P){var s=P.name.substr(4);if(e.indexOf(s)>=0){this["set"+jQuery.sap.charToUpperCase(s,0)](P.value);}else{f.push(P);}}.bind(this));if(f.length>0){this.fireCustomSettingChange(f);}};b.prototype.observePropertiesChanges=function(o){var s;if(!o){s=e.reduce(function(m,p){m[p]=this.getProperty(p);return m;}.bind(this),{});}else{s={};s[o.name]=o.current;}var t=this.getToolbar();if(t){t.updateSettingsConfig(s);}};return b;},true);
