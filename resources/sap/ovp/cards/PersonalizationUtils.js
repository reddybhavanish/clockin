sap.ui.define(['sap/ovp/cards/CommonUtils','sap/base/Log','sap/ui/fl/write/api/ControlPersonalizationWriteAPI'],function(C,L,a){"use strict";function b(o,h){h.every(function(i){if(i.id===o.cardId){i.selectedKey=o.selectedKey;return false;}return true;});return h;}function c(o,h){h.every(function(i){if(i.id===o.cardId){i.visibility=o.visibility;return false;}return true;});return h;}function d(o,h,v){var M=C.getApp(),i=M._getCardId(o.id);h.every(function(j){if(j.id===i){j.visibility=v;return false;}return true;});return h;}function e(o,h){var i=[];var v,t;v=h.filter(function(j){return j.visibility;});h.forEach(function(j,I){if(!j.visibility){i.push({card:j,index:I});}});if(!v[o.oldPosition]||!v[o.position]){return h;}t=v[o.oldPosition];v[o.oldPosition]=v[o.position];v[o.position]=t;i.forEach(function(I){v.splice(I.index,0,I.card);});h=v;return h;}function f(o,h){h.every(function(i){if(i.id===o.cardId){Object.keys(o.dashboardLayout).forEach(function(k){if(!i.dashboardLayout[k]){i.dashboardLayout[k]={};}if(o.dashboardLayout[k].rowSpan){i.dashboardLayout[k].rowSpan=o.dashboardLayout[k].rowSpan;}if(o.dashboardLayout[k].colSpan){i.dashboardLayout[k].colSpan=o.dashboardLayout[k].colSpan;}if(o.dashboardLayout[k].maxColSpan){i.dashboardLayout[k].maxColSpan=o.dashboardLayout[k].maxColSpan;}if(o.dashboardLayout[k].noOfItems){i.dashboardLayout[k].noOfItems=o.dashboardLayout[k].noOfItems;}if(o.dashboardLayout[k].hasOwnProperty('autoSpan')){i.dashboardLayout[k].autoSpan=o.dashboardLayout[k].autoSpan;}if(o.dashboardLayout[k].row){i.dashboardLayout[k].row=o.dashboardLayout[k].row;}if(o.dashboardLayout[k].column){i.dashboardLayout[k].col=o.dashboardLayout[k].column;}if(o.dashboardLayout[k].hasOwnProperty('showOnlyHeader')){i.dashboardLayout[k].showOnlyHeader=o.dashboardLayout[k].showOnlyHeader;}});return false;}return true;});return h;}function m(h,D){if(!Array.isArray(D)||!h){return h;}var M=[];h.forEach(function(o){var i={};Object.keys(o).forEach(function(k){i[k]=o[k];});M.push(i);});D.forEach(function(o){switch(o.getChangeType()){case"viewSwitch":M=b(o.getContent(),M);break;case"visibility":M=c(o.getContent(),M);break;case"hideCardContainer":M=d(o.getContent(),M,false);break;case"unhideCardContainer":M=d(o.getContent(),M,true);break;case"position":M=e(o.getContent(),M);break;case"dragOrResize":M=f(o.getContent(),M);break;default:break;}});return M;}function g(M,D){var h=M.filter(function(o){var H=false;D.forEach(function(i){if(o.id===i.id){H=true;return;}});return!H;});return D.concat(h);}function s(o,v){var l=v?v.byId("ovpLayout"):null;var h=[],i=[],j=[];if(!Array.isArray(o)){o=[o];}o.forEach(function(O){var k=O.content.cardId;O.jsOnly=true;h.push({selectorElement:v.byId(k),changeSpecificData:O});i.push(v.byId(k));j.push(O.changeType);});a.reset({selectors:i,changeTypes:j}).finally(function(){a.add({changes:h},true).then(function(h){return a.save({changes:h,selector:l});}).then(function(){L.info("Personalization changes have been saved in lrep backend");}).catch(function(k){L.error("Personalization changes were not saved",k);});},function(){L.error("Personalization changes were not being added by 'addPersonalizationChanges' function");});}var p={mergeChanges:m,addMissingCardsFromManifest:g,savePersonalization:s};return p;},true);
