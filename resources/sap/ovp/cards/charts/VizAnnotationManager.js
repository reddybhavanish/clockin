sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/Log","sap/base/util/each"],function(q,U,C,a,N,D,V,b,c,O,e,M,F,g,h,l,L,n){"use strict";var o={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var p={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var S=["yearweek","yearmonth","yearquarter"];var G;function t(f,j,v,x,y1,z1,A1){var B1="{";if(!f||!f.getSetting('ovpCardProperties')){L.error(p.ANALYTICAL_CONFIG_ERROR);B1+="}";return B1;}var C1=f.getSetting("dataModel");var D1;if(A1&&A1.EnumMember){D1=A1.EnumMember.split("/");if(D1&&(D1[1]==='Donut')){C1.setDefaultCountMode(C.Inline);}if(D1&&(D1[1]!='Donut')&&(y1===undefined)){return null;}}var E1=[];var F1=[];var G1=[];var H1=[];var I1=[];var J1=[];var K1=[];var L1=v&&v.Parameters;var M1=x&&x.SortOrder;var N1=x&&x.MaxItems,O1=null;var P1;var Q1;var R1;var S1=null;var T1=o.TEXT_KEY;var U1=o.TEXT_KEY_V4;var V1=o.UNIT_KEY;var W1=o.UNIT_KEY_V4_ISOCurrency;var X1=o.UNIT_KEY_V4_Unit;var Y1={};if(N1){O1=N1.Int32?N1.Int32:N1.Int;}if(O1){if(O1==="0"){L.error("OVP-AC: Analytic card Error: maxItems is configured as "+O1);B1+="}";return B1;}if(!/^\d+$/.test(O1)){L.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");B1+="}";return B1;}}var Z1=f.getSetting('ovpCardProperties'),$1=Z1.getProperty('/parameters');var _1=Z1.getProperty("/metaModel");L1=L1||!!$1;if(L1){var a2=a.resolveParameterizedEntitySet(C1,j,v,$1);B1+="path: '"+a2+"'";}else{B1+="path: '/"+j.name+"'";}var b2=[];S1=f.getSetting('ovpCardProperties').getProperty("/entitySet");if(!C1||!S1){return B1;}var c2=m1(C1,S1);var d2=f.getSetting('ovpCardProperties').getProperty("/cardLayout");var e2=1,f2;var g2=R();var h2;var i2;if(y1&&d2&&d2.colSpan&&d2.colSpan>1){f2=d2.colSpan-e2;for(var j2 in g2){if((i2=g2[j2].reference)&&g2[i2]){var k2=q.extend(true,{},g2[i2]);g2[j2]=k2;}if(j2===D1[1]||(g2[j2].time&&g2[j2].time.type===D1[1].toLowerCase())){h2=g2[j2];break;}}var l2=T(y1,h2,C1,S1);if(l2){h2=h2.time;}else{h2=h2.default;}var m2=f.getSetting('ovpCardProperties').getProperty("/dataStep");if(!m2){if(h2.resize&&h2.resize.hasOwnProperty("dataStep")&&!isNaN(h2.resize.dataStep)){m2=h2.resize.dataStep;}}m2=parseInt(m2,10);if(f2>0&&m2&&!isNaN(m2)){O1=parseInt(O1,10)+m2*f2;}}if(v){var Z1=f.getSetting('ovpCardProperties');b2=a.getFilters(Z1,v);}if(b2.length>0){B1+=", filters: "+JSON.stringify(b2);}if(M1){var n2=x.SortOrder;if(!n2.length){n2=U.getSortAnnotationCollection(C1,x,j);}if(n2.length<1){L.warning(p.CARD_WARNING+p.SORTORDER_WARNING);}else{var o2="";var p2;var q2;var r2;for(var i=0;i<n2.length;i++){p2=n2[i];r2=p2.Property.PropertyPath;K1.push(r2);if(typeof p2.Descending==="undefined"){q2='true';}else{var c1=p2.Descending.Bool||p2.Descending.Boolean;if(!c1){L.warning(p.CARD_WARNING+p.BOOLEAN_ERROR);q2='true';}else{q2=c1.toLowerCase()==='true'?'true':'false';}}o2=o2+"{path: '"+r2+"',descending: "+q2+"},";}B1+=", sorter: ["+o2.substring(0,o2.length-1)+"]";}}var s2=f.getSetting("ovpCardProperties").getProperty("/entityType");n(z1,function(i,m){P1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=s2[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&(d.ForecastValue.PropertyPath||d.ForecastValue.Path)){var r=(d.ForecastValue.PropertyPath||d.ForecastValue.Path);I1.push((d.ForecastValue.PropertyPath||d.ForecastValue.Path));if(c2&&c2[r]){var s;if(c2[r][W1]){s=c2[r][W1].Path?c2[r][W1].Path:undefined;}else if(c2[r][X1]){s=c2[r][X1].Path?c2[r][X1].Path:undefined;}else if(c2[r][V1]){s=c2[r][V1];}if(s){if((I1?Array.prototype.indexOf.call(I1,s):-1)===-1){I1.push(s);}}}}if(d.TargetValue&&(d.TargetValue.PropertyPath||d.TargetValue.Path)){var x2=(d.TargetValue.PropertyPath||d.TargetValue.Path);I1.push((d.TargetValue.PropertyPath||d.TargetValue.Path));if(c2&&c2[x2]){var s;if(c2[x2][W1]){s=c2[x2][W1].Path?c2[x2][W1].Path:undefined;}else if(c2[x2][X1]){s=c2[x2][X1].Path?c2[x2][X1].Path:undefined;}else if(c2[x2][V1]){s=c2[x2][V1];}if(s){if((I1?Array.prototype.indexOf.call(I1,s):-1)===-1){I1.push(s);}}}}}I1.push(P1);if(c2&&c2[P1]){if(c2[P1][U1]){if(c2[P1][U1].String&&P1!=c2[P1][U1].String){I1.push(c2[P1][U1].String?c2[P1][U1].String:P1);}else if(c2[P1][U1].Path&&P1!=c2[P1][U1].Path){I1.push(c2[P1][U1].Path?c2[P1][U1].Path:P1);}}else if(c2[P1][T1]&&P1!=c2[P1][T1]){I1.push(c2[P1][T1]?c2[P1][T1]:P1);}}if(c2&&c2[P1]){var s;if(c2[P1][W1]){s=c2[P1][W1].Path?c2[P1][W1].Path:undefined;}else if(c2[P1][X1]){s=c2[P1][X1].Path?c2[P1][X1].Path:undefined;}else if(c2[P1][V1]){s=c2[P1][V1];}if(s){if((I1?Array.prototype.indexOf.call(I1,s):-1)===-1){I1.push(s);}}}});n(y1,function(i,d){P1=d.Dimension.PropertyPath;E1.push(P1);if(c2&&c2[P1]){if(c2[P1][U1]){if(c2[P1][U1].String&&P1!=c2[P1][U1].String){E1.push(c2[P1][U1].String?c2[P1][U1].String:P1);}else if(c2[P1][U1].Path&&P1!=c2[P1][U1].Path){R1=c2[P1][U1].Path;var m=R1.split("/");if(m.length>1){Q1=u(_1,s2,R1);if(Q1!==""){E1.push(R1);F1.push(Q1);H1=w(_1,s2,R1);if(H1.length>0){G1=G1.concat(H1);}}}else{E1.push(R1?R1:P1);}}}else if(c2[P1][T1]&&P1!=c2[P1][T1]){E1.push(c2[P1][T1]?c2[P1][T1]:P1);}}});if(G1.length>0){var k=0;while(k<G1.length){if(E1.indexOf(G1[k])!==-1){G1.splice(k,1);}else{k++;}}}if(I1.length>0){n(I1,function(i,m){Y1[m]=true;});}if(E1.length>0){n(E1,function(i,d){Y1[d]=true;});}B1+=", parameters: {select:'"+[].concat(E1,I1).join(",");var t2=_1.getODataEntityType(j.entityType);if(t2){var u2=a.getRequestFields(x);if(u2&&u2.length>0){n(u2,function(i,r){if(!Y1.hasOwnProperty(r)){Y1[r]=true;J1.push(r);}});if(J1.length>0){B1+=","+J1.join(",");}}}if(K1.length>0){var v2=[];n(K1,function(i,s){if(!Y1.hasOwnProperty(s)){v2.push(s);}});if(v2.length>0){B1+=","+v2.join(",");}}if(F1.length>0){B1+="'"+","+" expand:'"+F1.join(',');}var w2=a.checkFilterPreference(f.getSetting("ovpCardProperties"));if(w2){B1+="', custom: {cardId: '"+f.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}";}else{B1+="'}";}if(D1&&(D1[1]==='Donut')&&(y1===undefined)){B1+=", length: 1";}else if(D1&&(D1[1]==='Donut')&&(y1)&&O1){B1+=", length: "+(parseInt(O1,10)+1);}else if(O1){B1+=", length: "+O1;}B1+="}";return B1;}t.requiresIContext=true;function u(m,d,s){var f="";var j=s.split("/");if(j.length>1){for(var i=0;i<(j.length-1);i++){var k=m.getODataAssociationEnd(d,j[i]);if(k){d=m.getODataEntityType(k.type);if(f){f=f+"/";}f=f+j[i];}else{return f;}}}return f;}function w(m,d,s){var f=[];var k=[];var r;var v=s.split("/");if(v.length>1){for(var i=0;i<(v.length-1);i++){var x=m.getODataAssociationEnd(d,v[i]);if(x){d=m.getODataEntityType(x.type);if(d){k=d&&d.key&&d.key.propertyRef;for(var j=0;j<k.length;j++){r=v[i]+"/"+k[j].name;f.push(r);}}}}}return f;}function y(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(p.CARD_WARNING+p.INVALID_FORECAST);return undefined;}}function z(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(p.CARD_WARNING+p.INVALID_TARGET);return undefined;}}function A(m,d){var f;n(d,function(i,v){if(v.name===m){if(v["com.sap.vocabularies.Common.v1.Label"]){f=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){f=v["sap:label"];}return false;}});return f;}function B(f,d){var j=true;if(d==="line"||d==="column"){n(f,function(i,v){if((v.getUid()==='valueAxis')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(p.CARD_WARNING+p.INVALID_DIMMEAS);return false;}}});}else if(d==="vertical_bullet"){n(f,function(i,v){if((v.getUid()==='actualValues')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(p.CARD_WARNING+p.INVALID_DIMMEAS);return false;}}});}if(j===true){return true;}}function E(m,s,v){var d=o.TYPE_KEY;if(!m||!m[s]||!m[s][d]){return v;}var f=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var i=m[s][d];if((f?Array.prototype.indexOf.call(f,i):-1)!==-1){return Number(v);}return v;}function H(d){if(d){return d;}return"";}function I(){var d={locale:function(){},format:function(v,f){var i="";if(f){i=f.split('/');}if(i.length>0){var m,s;if(i.length===3){m=Number(i[1]);s=Number(i[2]);if(isNaN(m)){m=-1;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(i[0]==="axisFormatter"||(i[0]==="ShortFloat")){var j;j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m?m:1});if(i[0]==="ShortFloat"){j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){j=N.getFloatInstance({style:'short'});}return j.format(Number(v));}else if(i[0]==="tooltipNoScaleFormatter"){var k=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){k=N.getFloatInstance({minFractionDigits:0,currencyCode:false});}return k.format(Number(v));}else if(i[0]==="CURR"){var r=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){r=N.getCurrencyInstance({style:'short',currencyCode:false});}return r.format(Number(v));}else if(i[0].search("%")!==-1){var x=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){x=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=x.format(Number(v));return v;}}if(v.constructor===Date){var y1=D.getDateTimeInstance({pattern:f});if(f==="YearMonthDay"){y1=D.getDateInstance({style:"medium"});}if(f==="YearMonth"){y1=D.getDateTimeInstance({format:"YYYYMMM"});}if(f==="YearQuarter"||f==="Quarter"){y1=D.getDateTimeInstance({format:"YYYYQ"});}if(f==="YearWeek"||f==="Week"){y1=D.getDateTimeInstance({format:"YYYYWW"});}v=y1.format(new Date(v));}return v;}};V.numericFormatter(d);}function J(v,f){var d=v.getModel();var k=v.getVizType();if(k!="line"&&k!="bubble"){return;}if(!f){f=k==="line"?"categoryAxis":"valueAxis";}var m=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!m){return;}var r=m1(d,m);var s=v.getFeeds();for(var i=0;i<s.length;i++){if(s[i].getUid()===f){var x=s[i].getValues();if(!x){return;}for(var j=0;j<x.length;j++){if(r[x[j][o.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}}function K(d,f,i,m,j,k){m=typeof m==="undefined"?false:m;var r=false;var s;if(!d&&m){L.error(j+p.CARD_ERROR+i+p.IS_MANDATORY);return r;}if(!d){L.warning(j+p.CARD_WARNING+i+p.IS_MISSING);r=true;return r;}s=f[d];if(!s||typeof s!=="object"){var v=m?L.error:L.warning;v(j+p.CARD_ERROR+"in "+i+". ("+d+" "+p.NOT_WELL_FORMED);return r;}if(k&&k==="sap.ovp.cards.charts.analytical.analyticalChart"&&i==="Chart Annotation"&&(!s.ChartType||!s.ChartType.EnumMember)){L.error(j+p.CARD_ERROR+p.MISSING_CHARTTYPE+p.CHART_ANNO);return r;}r=true;return r;}function P(d){var r=false;if(!d){return r;}var s;var f;var i;var j;var k;var m;var v;var x="";var y1;var z1=d.getView();if(z1){x="["+z1.getId()+"] ";}if(!(y1=d.getCardPropertiesModel())){L.error(x+p.CARD_ERROR+"in "+p.CARD_CONFIG+p.NO_CARD_MODEL);return r;}v=y1.getProperty("/entityType");if(!v||q.isEmptyObject(v)){L.error(x+p.CARD_ERROR+"in "+p.CARD_ANNO);return r;}s=y1.getProperty("/selectionAnnotationPath");f=y1.getProperty("/chartAnnotationPath");j=y1.getProperty("/presentationAnnotationPath");k=y1.getProperty("/identificationAnnotationPath");m=y1.getProperty("/dataPointAnnotationPath");i=y1.getProperty("/contentFragment");r=K(s,v,"Selection Variant",false,x);r=K(f,v,"Chart Annotation",true,x,i)&&r;r=K(j,v,"Presentation Variant",false,x)&&r;r=K(k,v,"Identification Annotation",true,x)&&r;r=K(m,v,"Data Point",false,x)&&r;return r;}function Q(d,f,v){}function R(d){return U.getConfig(d);}function T(d,f,i,j){var r=false;var m;var k;var s;var v;var x;var y1;if(!f.time||q.isEmptyObject(f.time)){return r;}if(!d){return r;}for(var z1=0;z1<d.length;z1++){if(!d[z1].Dimension||!(k=d[z1].Dimension.PropertyPath)){return r;}m=m1(i,j);if(m&&m[k]){s=m[k][o.TYPE_KEY];v=m[k][o.DISPLAY_FORMAT_KEY];x=m[k][o.SEMANTICS_KEY];y1=m[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"];}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(v&&v.toLowerCase()==="date"){r=true;}}else{r=true;}}if(s==="Edm.String"&&(y1||x&&S.indexOf(x)>-1)){r=true;}if(r){d.unshift(d.splice(z1,1)[0]);break;}}return r;}function W(i,d,f){var r="";var j=R(d);var k,m;if(!j){return r;}r=j.default.type;k=i.getSetting("dataModel");m=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(T(f,j,k,m)){r=j.time.type;}return r;}W.requiresIContext=true;function X(d,j,k){if(!d.length){return;}var m=k==="dimension"?"Dimension":"Measure";var r=[];n(d,function(i,v){if(!v||!v[m]||!v[m].PropertyPath){L.error(p.INVALID_CHART_ANNO);return false;}r.push(v[m].PropertyPath);});var s=q.map(j.feeds,function(f){if(f.type===k){if(f.role){return f.role.split("|");}return[];}});s=q.grep(s,function(f,i){return(s?Array.prototype.indexOf.call(s,f):-1)===i;}).join(", ");L.error(p.CARD_ERROR+p.INVALID_REDUNDANT+k+"(s) "+r.join(", ")+". "+p.ALLOWED_ROLES+j.type+p.CHART_IS+s);}function Y(v,i){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=Z(v);}else{d=$(v,i);}}return d;}function Z(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function $(v,i){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}if(i){var f=N.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(d){d=f.format(Number(d));}}return d;}function _(i,d){function b1(y1){if(y1){if(y1.Path){return"{path:'"+y1.Path+"'}";}else{return Y(y1);}}else{return"";}}var v=i[i.measureNames];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection){var s=d.CriticalityCalculation.ImprovementDirection.EnumMember;var f=b1(d.CriticalityCalculation.DeviationRangeLowValue);var j=b1(d.CriticalityCalculation.DeviationRangeHighValue);var k=b1(d.CriticalityCalculation.ToleranceRangeLowValue);var m=b1(d.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(v,s,f,j,k,m,a.criticalityConstants.StateValues);}else{var r=d.Criticality.EnumMember;var x=r?r.split("/"):[];if(x){return x[1];}}}function a1(d,m,f){var j,k;n(m,function(i,v){if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].String===d.measureNames){j=v.name;return false;}else if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].Path===d.measureNames){j=v.name;return false;}else if(v["sap:label"]===d.measureNames){j=v.name;return false;}});n(f,function(i,v){if(v.Measure.PropertyPath===j){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}k=v.DataPoint.AnnotationPath;return false;}});return k;}function b1(i,d){if(i){if(i.Path){return i.Path;}else{return Y(i,d);}}else{return"";}}function c1(m,d){function f(s,i){return s&&s.indexOf(i,s.length-i.length)!==-1;}var j=false;n(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var k=d[v.DataPoint.AnnotationPath.substring(1)];if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ImprovementDirection&&k.CriticalityCalculation.ImprovementDirection.EnumMember){var s=k.CriticalityCalculation.ImprovementDirection.EnumMember;var r=b1(k.CriticalityCalculation.DeviationRangeLowValue);var x=b1(k.CriticalityCalculation.DeviationRangeHighValue);var y1=b1(k.CriticalityCalculation.ToleranceRangeLowValue);var z1=b1(k.CriticalityCalculation.ToleranceRangeHighValue);if(f(s,"Minimize")||f(s,"Minimizing")){if(z1&&x){j=true;return false;}else{L.warning(p.CARD_WARNING+p.INVALID_CRITICALITY);}}else if(f(s,"Maximize")||f(s,"Maximizing")){if(y1&&r){j=true;return false;}else{L.warning(p.CARD_WARNING+p.INVALID_CRITICALITY);}}else if(f(s,"Target")){if(y1&&r&&z1&&x){j=true;return false;}else{L.warning(p.CARD_WARNING+p.INVALID_CRITICALITY);}}}else if(k&&k.Criticality){j=true;return false;}else{L.warning(p.CARD_WARNING+p.INVALID_IMPROVEMENT_DIR);}}});if(j===true&&m.length>1){L.warning(p.CARD_WARNING+p.INVALID_SEMANTIC_MEASURES);}return j;}function d1(m,d,f,v){function i(D1,E1){return D1&&D1.indexOf(E1,D1.length-E1.length)!==-1;}var r=[null,null];var j=true;var k=m.Measure.PropertyPath;if(f[k]){if(f[k][o.LABEL_KEY_V4]){k=l1(f[k][o.LABEL_KEY_V4].String?f[k][o.LABEL_KEY_V4].String:f[k][o.LABEL_KEY_V4].Path,v,f);}else if(f[k][o.LABEL_KEY]){k=f[k][o.LABEL_KEY];}else if(k){k=k;}}var s=m.DataPoint.AnnotationPath;var x=d[s.substring(1)];if(!x.CriticalityCalculation||!x.CriticalityCalculation.ImprovementDirection||!x.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var y1=x.CriticalityCalculation.ImprovementDirection.EnumMember;var z1=b1(x.CriticalityCalculation.DeviationRangeLowValue,j);var A1=b1(x.CriticalityCalculation.DeviationRangeHighValue,j);var B1=b1(x.CriticalityCalculation.ToleranceRangeLowValue,j);var C1=b1(x.CriticalityCalculation.ToleranceRangeHighValue,j);if(i(y1,"Minimize")||i(y1,"Minimizing")){if(C1&&A1){r[0]=h.getText("MINIMIZING_LESS",[k,C1]);r[1]=h.getText("MINIMIZING_MORE",[k,A1]);r[2]=h.getText("MINIMIZING_CRITICAL",[C1,k,A1]);}}else if(i(y1,"Maximize")||i(y1,"Maximizing")){if(B1&&z1){r[0]=h.getText("MAXIMISING_MORE",[k,B1]);r[1]=h.getText("MAXIMISING_LESS",[k,z1]);r[2]=h.getText("MAXIMIZING_CRITICAL",[z1,k,B1]);}}else if(i(y1,"Target")){if(B1&&z1&&C1&&A1){r[0]=h.getText("TARGET_BETWEEN",[B1,k,C1]);r[1]=h.getText("TARGET_AROUND",[k,z1,A1]);r[2]=h.getText("TARGET_CRITICAL",[z1,k,B1,C1,A1]);}}return r;}function e1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var i,j;if(f&&f.ValueFormat){i=f.ValueFormat;}else if(f&&f.NumberFormat){i=f.NumberFormat;}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){j=i.NumberOfFractionalDigits.Int;if(m<Number(j)){m=Number(j);}}}return m;}function f1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var s,i;if(f&&f.ValueFormat){s=f.ValueFormat;}else if(f&&f.NumberFormat){s=f.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){i=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){i=Number(s.ScaleFactor.Int);}if(!isNaN(i)){if(m===undefined){m=Number(i);}else if(m>Number(i)){m=Number(i);}}}}return m;}function g1(m,s){if(m&&m[s]&&(m[s]["Org.OData.Measures.V1.ISOCurrency"]||(m[s][o.SEMANTICS_KEY]&&m[s][o.SEMANTICS_KEY]===o.CURRENCY_CODE))){return true;}return false;}function h1(m,v,f){if(m[v[f].PropertyPath][o.EDM_TYPE]===o.EDM_INT32){return true;}return false;}function i1(m,v,f){if(m[v[f].PropertyPath][o.EDM_TYPE]===o.EDM_INT64){return true;}return false;}function j1(d,f,m,r){var s,x,y1,z1;var A1,B1,C1,D1,E1;var F1;var G1,H1,I1;var J1,K1=[],L1=[];var M1;var N1;var O1=r&&r.getView();var P1,Q1;A1=d.getVizType();B1=R();for(var R1 in B1){if((N1=B1[R1].reference)&&B1[N1]){var S1=q.extend(true,{},B1[N1]);B1[R1]=S1;}if(B1[R1].default.type===A1||(B1[R1].time&&B1[R1].time.type===A1)){C1=B1[R1];break;}}if(!C1){L.error(p.CARD_ERROR+"in "+p.CARD_CONFIG+p.CARD_CONFIG_ERROR+A1+" "+p.CARD_CONFIG_JSON);return;}if(!(s=d.getModel('ovpCardProperties'))){L.error(p.CARD_ERROR+"in "+p.CARD_CONFIG+p.NO_CARD_MODEL);return;}var T1=d.getModel();var U1=s.getProperty("/entitySet");if(!T1||!U1){return;}x=s.getProperty("/entityType");if(!x){L.error(p.CARD_ANNO_ERROR+"in "+p.CARD_ANNO);return;}var V1=m1(T1,U1);y1=s.getProperty("/chartAnnotationPath");if(!y1||!(z1=x[y1])){L.error(p.CARD_ANNO_ERROR+"in "+p.CARD_ANNO);return;}if(!(D1=z1.DimensionAttributes)||!D1.length){L.error(p.CHART_ANNO_ERROR+"in "+p.CHART_ANNO+" "+p.DIMENSIONS_MANDATORY);return;}var W1;if(!(E1=z1.MeasureAttributes)||!E1.length){L.error(p.CHART_ANNO_ERROR+"in "+p.CHART_ANNO+" "+p.MEASURES_MANDATORY);return;}else{var X1=E1[0].DataPoint?x[E1[0].DataPoint.AnnotationPath.substring(1)]:null;var Y1=X1&&X1.ValueFormat&&X1.ValueFormat.NumberOfFractionalDigits&&X1.ValueFormat.NumberOfFractionalDigits.Int;W1=Y1?Y1:0;}M1=T(D1,C1,T1,U1);if(M1){C1=C1.time;}else{C1=C1.default;}var Z1=s.getProperty("/ChartProperties")||s.getProperty("/chartProperties");if(s&&s.getProperty("/tabs")&&(Z1===undefined)){P1=O1.byId("ovp_card_dropdown");Q1=parseInt(P1.getSelectedKey(),10);Z1=s.getProperty("/tabs")&&s.getProperty("/tabs")[Q1-1]&&(s.getProperty("/tabs")[Q1-1]["ChartProperties"]||s.getProperty("/tabs")[Q1-1]["chartProperties"]);}var $1=false;var _1=W1>0?"tooltipNoScaleFormatter/"+W1.toString()+"/":'tooltipNoScaleFormatter/-1/';var a2=new b({formatString:_1});a2.connect(d.getVizUid());a2.connect(d.getVizUid());d._oOvpVizFrameTooltip=a2;[C1.dimensions,C1.measures].forEach(function(j,i){var k=i?E1:D1;var v=i?"measure(s)":"dimension(s)";if(j.min&&k.length<j.min){L.error(p.CARD_ERROR+"in "+A1+" "+p.CARD_LEAST+j.min+" "+v);$1=true;}if(j.max&&k.length>j.max){L.error(p.CARD_ERROR+"in "+A1+p.CARD_MOST+j.max+" "+v);$1=true;}});if($1){return;}var b2=true;if(C1.properties&&C1.properties.hasOwnProperty("hideLabel")&&!C1.properties["hideLabel"]){b2=false;}var c2=true;var d2=false;if(A1==='donut'){d2=true;}d.removeAllAggregation();F1={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:c2?false:true,selectability:{legendSelection:d2?true:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:d2?true:false,type:'value'},dataPoint:{invalidity:'ignore'},alignment:{vertical:'top'}},categoryAxis:{label:{truncatedLabelRatio:0.15}},general:{groupData:false,showAsUTC:true}};if(C1.properties&&C1.properties.semanticColor===true&&c1(E1,x)){var e2=h.getText("GOOD");var f2=h.getText("BAD");var g2=h.getText("CRITICAL");var h2=h.getText("OTHERS");if(E1.length===1){var i2=d1(E1[0],x,V1,d);var e2=i2[0]||e2,f2=i2[1]||f2,g2=i2[2]||g2,h2=h.getText("OTHERS");}F1.plotArea.dataPointStyle={rules:[{callback:function(i){var j=a1(i,V1,E1);if(!j){return false;}var k=x[j.substring(1)];var v=_(i,k);if(v===a.criticalityConstants.StateValues.Positive){return true;}else if(v==="Positive"){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":e2},{callback:function(i){var j=a1(i,V1,E1);if(!j){return false;}var k=x[j.substring(1)];var v=_(i,k);if(v===a.criticalityConstants.StateValues.Critical){return true;}else if(v==="Critical"){return true;}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},"displayName":g2},{callback:function(i){var j=a1(i,V1,E1);if(!j){return false;}var k=x[j.substring(1)];var v=_(i,k);if(v===a.criticalityConstants.StateValues.Negative){return true;}else if(v==="Negative"){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":f2},{callback:function(i){var j=a1(i,V1,E1);if(!j){return false;}var k=x[j.substring(1)];var v=_(i,k);if(v===a.criticalityConstants.StateValues.None){return true;}else if(v==="Neutral"){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":h2}]};}var j2=s.getProperty("/bEnableStableColors");var k2=s.getProperty("/colorPalette");var l2;if(!j2&&(z1.ChartType.EnumMember===o.COLUMNSTACKED_CHARTTYPE||z1.ChartType.EnumMember===o.DONUT_CHARTTYPE||z1.ChartType.EnumMember===o.COLUMN_CHARTTYPE||z1.ChartType.EnumMember===o.VERTICALBULLET_CHARTTYPE||z1.ChartType.EnumMember===o.LINE_CHARTTYPE||z1.ChartType.EnumMember===o.COMBINATION_CHARTTYPE||z1.ChartType.EnumMember===o.BUBBLE_CHARTTYPE)&&k2&&Object.keys(k2).length>=2&&Object.keys(k2).length<=4){n(D1,function(i,j){if(j&&j.Role&&j.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){l2=j.Dimension&&j.Dimension.PropertyPath;return;}});var m2;if(l2){if(V1&&V1[l2]){if(V1[l2][o.LABEL_KEY_V4]){m2=l1(V1[l2][o.LABEL_KEY_V4].String?V1[l2][o.LABEL_KEY_V4].String:V1[l2][o.LABEL_KEY_V4].Path,d,V1);}else if(V1[l2][o.LABEL_KEY]){m2=V1[l2][o.LABEL_KEY];}else if(l2){m2=l2;}}if(k2 instanceof Array){var n2=k2.map(function(v){return v.color;});var o2=k2.map(function(v){return v.legendText;});var p2=o2[0]!=undefined?o2[0]:h.getText("OTHERS");var q2=o2[1]!=undefined?o2[1]:h.getText("BAD");var r2=o2[2]!=undefined?o2[2]:h.getText("CRITICAL");var s2=o2[3]!=undefined?o2[3]:h.getText("GOOD");}F1.plotArea.dataPointStyle={rules:[{callback:function(i){if(i&&(i[m2]==="3"||i[m2]===3)){if(k2 instanceof Array){if(k2.length<4){return false;}}else if(k2&&!k2.hasOwnProperty(3)){return false;}return true;}},properties:{color:k2 instanceof Array&&n2.length?n2[3]:k2[3]&&k2[3]["color"]},"displayName":s2||k2[3]&&k2[3]["legendText"]},{callback:function(i){if(i&&(i[m2]==="2"||i[m2]===2)){if(k2 instanceof Array){if(k2.length<3){return false;}}else if(k2&&!k2.hasOwnProperty(2)){return false;}return true;}},properties:{color:k2 instanceof Array&&n2.length?n2[2]:k2[2]&&k2[2]["color"]},"displayName":r2||k2[2]&&k2[2]["legendText"]},{callback:function(i){if(i&&(i[m2]==="1"||i[m2]===1)){return true;}},properties:{color:k2 instanceof Array&&n2.length?n2[1]:k2[1]&&k2[1]["color"]},"displayName":q2||k2[1]&&k2[1]["legendText"]},{callback:function(i){if(i&&(i[m2]==="0"||i[m2]===0)){return true;}},properties:{color:k2 instanceof Array&&n2.length?n2[0]:k2[0]&&k2[0]["color"]},"displayName":p2||k2[0]&&k2[0]["legendText"]}]};}}var t2=false;var u2=false;if(z1.ChartType.EnumMember===o.SCATTER_CHARTTYPE||z1.ChartType.EnumMember===o.BUBBLE_CHARTTYPE||z1.ChartType.EnumMember===o.LINE_CHARTTYPE){if(z1&&z1.AxisScaling&&z1.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var v2=z1.AxisScaling;if(v2.AutoScaleBehavior&&v2.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var w2=v2.AutoScaleBehavior;if(w2.ZeroAlwaysVisible&&w2.ZeroAlwaysVisible.Bool=="true"){F1.plotArea.adjustScale=false;t2=true;}else if(w2.DataScope){F1.plotArea.adjustScale=true;t2=true;}}else if(v2.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&v2.ScaleBehavior&&v2.ScaleBehavior.EnumMember){var x2=v2.ScaleBehavior.EnumMember;var y2=x2.substring(x2.lastIndexOf('/')+1,x2.length);if(y2=="FixedScale"){u2=true;}}}else if(z1&&z1.AxisScaling&&z1.AxisScaling.EnumMember){var z2=z1.AxisScaling.EnumMember.substring(z1.AxisScaling.EnumMember.lastIndexOf('/')+1,z1.AxisScaling.EnumMember.length);switch(z2){case"AdjustToDataIncluding0":F1.plotArea.adjustScale=false;t2=true;break;case"AdjustToData":F1.plotArea.adjustScale=true;t2=true;break;case"MinMaxValues":u2=true;break;default:break;}}if(u2){var A2=[];if(z1["MeasureAttributes"][0]&&z1["MeasureAttributes"][0].DataPoint&&z1["MeasureAttributes"][0].DataPoint.AnnotationPath){var B2=z1["MeasureAttributes"][0].DataPoint.AnnotationPath;var C2=B2.substring(B2.lastIndexOf('@')+1,B2.length);if(x&&x[C2]){var D2=x[C2];if(D2&&D2.MaximumValue&&D2.MaximumValue.Decimal&&D2.MinimumValue&&D2.MinimumValue.Decimal){A2.push({feed:"valueAxis",max:D2.MaximumValue.Decimal,min:D2.MinimumValue.Decimal});t2=true;}else{L.error(p.ERROR_MISSING_AXISSCALES);}}}if(z1.ChartType.EnumMember!==o.LINE_CHARTTYPE&&z1["MeasureAttributes"][1]&&z1["MeasureAttributes"][1].DataPoint&&z1["MeasureAttributes"][1].DataPoint.AnnotationPath){var B2=z1["MeasureAttributes"][1].DataPoint.AnnotationPath;var C2=B2.substring(B2.lastIndexOf('@')+1,B2.length);if(x&&x[C2]){var D2=x[C2];if(D2&&D2.MaximumValue&&D2.MaximumValue.Decimal&&D2.MinimumValue&&D2.MinimumValue.Decimal){A2.push({feed:"valueAxis2",max:D2.MaximumValue.Decimal,min:D2.MinimumValue.Decimal});t2=true;}else{L.error(p.ERROR_MISSING_AXISSCALES);}}}d.setVizScales(A2);}}H1=D1.slice();I1=E1.slice();var E2=0;var F2=0;var G2;var H2;var I2=false;var J2=false;var K2;var L2=[];var M2=[],N2=[];if((A1==="column"||A1==="vertical_bullet")&&C1.feeds&&(C1.feeds.length>0)){var O2;for(O2=0;O2<C1.feeds.length;O2++){if(C1.feeds[O2].uid==="color"){C1.feeds.splice(O2,1);break;}}for(O2=0;O2<C1.feeds.length;O2++){if(C1.feeds[O2].uid==="categoryAxis"){delete C1.feeds[O2].role;break;}}if(s.getProperty("/colorPalette")){for(O2=0;O2<C1.feeds.length;O2++){if(C1.feeds[O2].uid==="categoryAxis"){C1.feeds[O2].role="Category";break;}}C1.feeds.push({"uid":"color","min":1,"type":"dimension","role":"Series"});}}n(C1.feeds,function(i,v){var V2=v.uid;var W2=[];if(v.type){var X2,Y2,Z2;if(v.type==="dimension"){X2=D1.length;Y2="Dimension";Z2="dimensions";G1=H1;J1=K1;}else{X2=E1.length;Y2="Measure";Z2="measures";G1=I1;J1=L1;}var $2=0,_2=X2;if(v.min){$2=$2>v.min?$2:v.min;}if(v.max){_2=_2<v.max?_2:v.max;}if(!v.role){var a3=G1.length;for(var j=0;j<a3&&W2.length<_2;++j){var b3=G1[j];G1.splice(j,1);--a3;--j;W2.push(b3);if(V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency].Path?V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit].Path?V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit].Path:undefined;}else if(V1[b3[Y2].PropertyPath][o.UNIT_KEY]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY];}if(g1(V1,K2)){I2=true;}else{J2=true;}if(!I2){E2=e1(E2,b3,x);G2=f1(G2,b3,x);}else{F2=e1(F2,b3,x);H2=f1(H2,b3,x);}}}else{var c3=v.role.split("|");n(c3,function(j,v3){if(W2.length===_2){return false;}var a3=G1.length;for(var k=0;k<a3&&W2.length<_2;++k){var b3=G1[k];if(b3&&b3.Role&&b3.Role.EnumMember&&b3.Role.EnumMember.split("/")&&b3.Role.EnumMember.split("/")[1]){var w3=b3.Role.EnumMember.split("/")[1];if(w3===v3){G1.splice(k,1);--a3;--k;W2.push(b3);if(V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency].Path?V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit].Path?V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit].Path:undefined;}else if(V1[b3[Y2].PropertyPath][o.UNIT_KEY]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY];}if(g1(V1,K2)){I2=true;}else{J2=true;}if(!I2){E2=e1(E2,b3,x);G2=f1(G2,b3,x);}else{F2=e1(F2,b3,x);H2=f1(H2,b3,x);}}}else if((J1?Array.prototype.indexOf.call(J1,b3):-1)===-1){J1.push(b3);}}});if(W2.length<_2){n(J1,function(k,b3){var v3;var O2;if((v3=C1[Z2].defaultRole)&&((c3?Array.prototype.indexOf.call(c3,v3):-1)!==-1)&&(O2=(G1?Array.prototype.indexOf.call(G1,b3):-1)!==-1)){G1.splice(O2,1);W2.push(b3);if(V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency].Path?V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit].Path?V1[b3[Y2].PropertyPath][o.UNIT_KEY_V4_Unit].Path:undefined;}else if(V1[b3[Y2].PropertyPath][o.UNIT_KEY]){K2=V1[b3[Y2].PropertyPath][o.UNIT_KEY];}if(g1(V1,K2)){I2=true;}else{J2=true;}if(!I2){E2=e1(E2,b3,x);G2=f1(G2,b3,x);}else{F2=e1(F2,b3,x);H2=f1(H2,b3,x);}if(W2.length===_2){return false;}}});}if(W2.length<$2){L.error(p.CARD_ERROR+p.MIN_FEEDS+A1+" "+p.FEEDS_OBTAINED+W2.length+" "+p.FEEDS_REQUIRED+$2+" "+p.FEEDS);return false;}}if(W2.length){var d3=[];var e3;if(!(e3=d.getDataset())){L.error(p.NO_DATASET);return false;}G=x;n(W2,function(i,b3){if(!b3||!b3[Y2]||!b3[Y2].PropertyPath){L.error(p.INVALID_CHART_ANNO);return false;}var k=b3[Y2].PropertyPath;var m2=k;var v3=k;var w3=null;if(V1&&V1[k]){if(V1[k][o.LABEL_KEY_V4]){if(V1[k][o.LABEL_KEY_V4].String){m2=l1(V1[k][o.LABEL_KEY_V4].String,d,V1);}else if(V1[k][o.LABEL_KEY_V4].Path){m2=V1[k][o.LABEL_KEY_V4].Path;}else{m2=k;}}else if(V1[k][o.LABEL_KEY]){m2=V1[k][o.LABEL_KEY];}else if(k){m2=k;}if(V1[k][o.TEXT_KEY_V4]){v3=V1[k][o.TEXT_KEY_V4].String?V1[k][o.TEXT_KEY_V4].String:V1[k][o.TEXT_KEY_V4].Path;}else if(V1[k][o.TEXT_KEY]){v3=V1[k][o.TEXT_KEY];}else if(k){v3=k;}w3=V1[k][o.TYPE_KEY]||null;}var x3;if((w3==="Edm.DateTime"||w3==="Edm.DateTimeOffset")&&v3===k){x3="{path:'"+k+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}else{if(V1[k]&&V1[k][o.TEXT_KEY_V4]&&V1[k][o.TEXT_KEY_V4][o.TEXT_ARRANGEMENT_ANNO]){var y3,z3;y3=V1[k][o.TEXT_ARRANGEMENT_ANNO];z3=y3&&y3.EnumMember;if(!z3){y3=V1[k][o.TEXT_KEY_V4][o.TEXT_ARRANGEMENT_ANNO];z3=y3&&y3.EnumMember;}if(!z3){var A3=G;y3=A3&&A3[o.TEXT_ARRANGEMENT_ANNO];z3=y3&&y3.EnumMember;}switch(z3){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":x3="{"+v3+"}"+" "+"("+"{"+k+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":x3="{"+k+"}"+" "+"("+"{"+v3+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":x3="{"+v3+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":x3="{"+k+"}"+" "+"("+"{"+v3+"}"+")";break;default:x3="{"+k+"}";break;}}else{x3="{"+v3+"}";}}d3.push(m2);if(Y2==="Dimension"){if(V2==="waterfallType"){var B3=new e({name:m2,value:"{"+k+"}"});}else{var B3=new e({name:m2,value:"{"+k+"}",displayValue:x3});}var C3=V1[k][o.SEMANTICS_KEY];var D3=V1[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"]&&V1[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"].Bool;if(M1&&(w3==="Edm.DateTime"||D3||w3==="Edm.DateTimeOffset"||(C3&&C3.lastIndexOf("year",0)===0))){B3.setDataType("date");}e3.addDimension(B3);if((N2?Array.prototype.indexOf.call(N2,m2):-1)===-1){N2.push(m2);}}else{e3.addMeasure(new M({name:m2,value:"{"+k+"}"}));if(((M2?Array.prototype.indexOf.call(M2,m2):-1)===-1)&&(V2!="bubbleWidth")){M2.push(m2);}}});d.addFeed(new F({'uid':V2,'type':Y2,'values':d3}));if(V2==="categoryAxis"){F1[V2]={title:{visible:b2?false:true,text:d3.join(", ")},label:{formatString:I2?'CURR':'axisFormatter',truncatedLabelRatio:0.15}};}else{F1[V2]={title:{visible:b2?false:true,text:d3.join(", ")},label:{formatString:I2?'CURR':'axisFormatter'}};}L2.push(F1[V2]);if(C1.hasOwnProperty("vizProperties")){var f3=0;var g3=C1.vizProperties.length;var h3;var i3;for(;f3<g3;f3++){if(C1.vizProperties[f3].hasOwnProperty("value")){i3=C1.vizProperties[f3].value;}if(C1.vizProperties[f3].hasOwnProperty("path")){h3=(C1.vizProperties[f3].path).split(".");var j3=h3.length;var k3,l3;var m3;for(var n3=0,m3=h3[0],k3=F1,l3=Z1;n3<j3;++n3){if(n3===j3-1){if(l3&&l3.hasOwnProperty(m3)){if(A1==='donut'&&(l3[m3]==="value"||l3[m3]==="percentage")){i3=l3[m3];}else if(A1!='donut'){i3=l3[m3];}}if((t2&&(m3!="adjustScale"))||(!t2&&(m3==="adjustScale"))||(!t2&&(m3!="adjustScale"))){k3[m3]=i3;}break;}k3[m3]=k3[m3]||{};k3=k3[m3];if(l3){l3[m3]=l3[m3]||{};l3=l3[m3];}m3=h3[n3+1];}}}}if(v.hasOwnProperty("vizProperties")){var i=0;var o3=v.vizProperties.length;var p3;var q3;var r3;for(;i<o3;i++){if(v.vizProperties[i].hasOwnProperty("method")){q3=v.vizProperties[i].method;switch(q3){case'count':p3=d3.length;if(v.vizProperties[i].hasOwnProperty("min")&&p3<=v.vizProperties[i].min){p3=v.vizProperties[i].min;}else if(v.vizProperties[i].hasOwnProperty("max")&&p3>=v.vizProperties[i].max){p3=v.vizProperties[i].max;}break;default:break;}}else if(v.vizProperties[i].hasOwnProperty("value")){p3=v.vizProperties[i].value;}if(v.vizProperties[i].hasOwnProperty("path")){r3=(v.vizProperties[i].path).split(".");var s3=r3.length;for(var j=0,t3=r3[0],u3=F1;j<s3;++j){if(j===s3-1){u3[t3]=p3;break;}u3[t3]=u3[t3]||{};u3=u3[t3];t3=r3[j+1];}}}}}}});var P2=d.getFeeds();if(C1.properties&&C1.properties.semanticPattern===true&&B(P2,A1)){n(P2,function(i,v){if(P2[i].getType()==='Measure'&&((P2[i].getUid()==='valueAxis')||(P2[i].getUid()==='actualValues'))){var j;n(E1,function(O2,$2){var _2=A($2.Measure.PropertyPath,V1);if(_2===P2[i].getValues()[0]){j=y($2,x);return false;}});if(j){var k=A(j.Measure.PropertyPath,V1);var V2=(x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path);var W2=A(V2,V1);var X2=h.getText("ACTUAL",[k]);var Y2=h.getText("FORECAST",[W2]);F1.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:k},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:X2},{dataContext:{MeasureNamesDimension:W2},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:Y2}]};d.getDataset().addMeasure(new M({name:W2,value:"{"+V2+"}"}));var Z2=P2[i].getValues();Z2.push(W2);P2[i].setValues(Z2);}return false;}});}if(C1.properties&&C1.properties.semanticPattern===true&&B(P2,A1)&&d.getVizType()==="vertical_bullet"){n(P2,function(i,v){if(P2[i].getType()==='Measure'&&((P2[i].getUid()==='valueAxis')||(P2[i].getUid()==='actualValues'))){var j;n(E1,function(O2,W2){var X2=A(W2.Measure.PropertyPath,V1);if(X2===P2[i].getValues()[0]){j=z(W2,x);return false;}});if(j){var k=(x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.Path);var V2=A(k,V1);d.getDataset().addMeasure(new M({name:V2,value:"{"+k+"}"}));d.addFeed(new F({'uid':"targetValues",'type':"Measure",'values':[V2]}));}return false;}});}if(I2&&J2){L.warning(h.getText("Currency_non_currency_measure"));}n(P2,function(i,k){var v=k.getProperty("type");if(v==="Measure"){var V2=k.getProperty("values");var W2=true;var X2=z1.MeasureAttributes.filter(function(j){return V2.indexOf(V1[j[v]["PropertyPath"]][o.LABEL_KEY])>=0||V2.indexOf(V1[j[v]["PropertyPath"]][o.LABEL_KEY_V4])>=0;});n(X2,function(j,Y2){if(h1(V1,Y2,v)||i1(V1,Y2,v)){W2=false;}else{W2=true;return false;}});if(!W2){F1[k.getProperty('uid')]['label']['allowDecimals']=false;}}});var Q2;if(H2===undefined){H2="";}if(G2===undefined){G2="";}if(I2){Q2=o1(H2,I2);}else{Q2=o1(G2,I2);}if(f){f.setScale(Q2);}n1(M2,N2,m);var R2="";n(P2,function(i,j){var k="-1";var v=j.getProperty("type");if(v==="Measure"){var V2=L2.filter(function(Y2){var Z2=Y2["title"]["text"].split(",").filter(function($2){if(j.getValues().indexOf($2.trim())>=0){return true;}else{return false;}});if(Z2.length>0){return true;}else{return false;}});if(V2&&V2.length){var W2=j.getValues();if(W2&&W2.length){n(W2,function(i,Y2){var Z2=Y2.trim();var $2=E1.filter(function(c3){if(c3["Measure"]&&c3["Measure"]["PropertyPath"]){var d3=c3["Measure"]["PropertyPath"];if((V1[d3]&&V1[d3][o.LABEL_KEY]===Z2)||(V1[d3]&&V1[d3][o.LABEL_KEY_V4]===Z2)){return true;}else{return false;}}});if($2&&$2.length){var _2=$2[0];if(!h1(V1,_2,v)&&!i1(V1,_2,v)){var a3="";if(_2&&_2["DataPoint"]&&_2["DataPoint"]["AnnotationPath"]&&_2["DataPoint"]["AnnotationPath"]){a3=_2["DataPoint"]["AnnotationPath"]&&_2["DataPoint"]["AnnotationPath"].substring(1);if(a3!=""){var b3;b3=x[a3]&&x[a3]["ValueFormat"]&&x[a3]["ValueFormat"]["NumberOfFractionalDigits"]&&x[a3]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];k=b3>k?b3:k;}}}else{k=k<"0"?"0":k;}}});}}if(V2&&V2[0]&&V2[0].label&&V2[0].label.formatString){var X2=V2[0].label.formatString;}R2="";if(I2){if(X2==='CURR'){R2='CURR/'+k.toString()+"/";}else{R2='axisFormatter/'+k.toString()+"/";}}else{R2='axisFormatter/'+k.toString()+"/";}if(V2&&V2[0]){V2[0].label.formatString=R2;}}});if(A1==="vertical_bullet"){F1["valueAxis"]={title:{visible:b2?false:true},label:{formatString:R2}};}var S2="";var T2="";if(I2){S2=F2.toString();T2='CURR/'+F2.toString()+"/";}else{S2=E2.toString();T2='axisFormatter/'+E2.toString()+"/";}if(A1==="donut"){F1.legendGroup={layout:{height:0.3}};F1.plotArea.dataLabel.formatString=T2;if(F1.plotArea.dataLabel.type==="percentage"){F1.plotArea.dataLabel.formatString="0.0%/"+S2+"/";}}X(H1,C1,"dimension");X(I1,C1,"measure");if(M1){var U2=D1[0].Dimension.PropertyPath;if(V1[U2][o.SEMANTICS_KEY]==='yearmonth'||V1[U2]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){F1.timeAxis.levels=["year","month"];}else if(V1[U2][o.SEMANTICS_KEY]==='yearquarter'||V1[U2]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){F1.timeAxis.levels=["quarter"];}else if(V1[U2][o.SEMANTICS_KEY]==='yearweek'||V1[U2]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){F1.timeAxis.levels=["week"];}}d.setVizProperties(F1);}function k1(v,d,f){if(v&&(v.getVizType()==="bubble"||v.getVizType()==="scatter")){return;}var j,k,r,s;var x;var y1=o.UNIT_KEY;var z1=o.UNIT_KEY_V4_ISOCurrency;var A1=o.UNIT_KEY_V4_Unit;var B1;var C1=[];if(!(j=v.getModel('ovpCardProperties'))){L.error(p.CARD_ERROR+"in "+p.CARD_CONFIG+p.NO_CARD_MODEL);return;}var D1=v.getModel();var E1=j.getProperty("/entitySet");if(!D1||!E1){return;}k=j.getProperty("/entityType");if(!k){L.error(p.CARD_ANNO_ERROR+"in "+p.CARD_ANNO);return;}var F1=m1(D1,E1);r=j.getProperty("/chartAnnotationPath");if(!r||!(s=k[r])){L.error(p.CARD_ANNO_ERROR+"in "+p.CARD_ANNO);return;}if(!(x=s.MeasureAttributes)||!x.length){L.error(p.CHART_ANNO_ERROR+"in "+p.CHART_ANNO+" "+p.MEASURES_MANDATORY);return;}n(x,function(i,m){B1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var O1=k[m.DataPoint.AnnotationPath.substring(1)];if(O1.ForecastValue&&(O1.ForecastValue.PropertyPath||O1.ForecastValue.Path)){C1.push((O1.ForecastValue.PropertyPath||O1.ForecastValue.Path));}}C1.push(B1);});var G1=d?d.results:null;var H1="";var I1=true;var J1=[];var K1=v.getFeeds();n(K1,function(i,m){if(m.getType()==="Measure"){J1=J1.concat(m.getValues());}});if(G1){n(C1,function(i,m){var O1="";if(F1&&F1[m]){if(F1[m][o.LABEL_KEY_V4]){O1=l1(F1[m][o.LABEL_KEY_V4].String?F1[m][o.LABEL_KEY_V4].String:F1[m][o.LABEL_KEY_V4].Path,v,F1);}else if(F1[m][o.LABEL_KEY]){O1=F1[m][o.LABEL_KEY];}else if(m){O1=m;}}if((J1?Array.prototype.indexOf.call(J1,O1):-1)!=-1){if(F1&&F1[m]){var P1;if(F1[m][z1]){P1=F1[m][z1].Path?F1[m][z1].Path:F1[m][z1].String;}else if(F1[m][A1]){P1=F1[m][A1].Path?F1[m][A1].Path:F1[m][A1].String;}else if(F1[m][y1]){P1=F1[m][y1];}if(!P1){I1=false;return false;}if(P1&&F1[P1]){for(var i=0;i<G1.length;i++){var Q1=G1[i];if(I1){if(H1&&Q1[P1]&&(Q1[P1]!="")&&(H1!="")&&(H1!=Q1[P1])){I1=false;break;}}H1=Q1[P1];}}}}});}var L1="";if(I1){if(H1!=""){L1=h.getText("IN_NO_SCALE",[H1]);L1=" "+L1;}if(f){f.setText(L1);f.data("aria-label",L1,true);var M1=v.data("aria-label");if(M1&&L1&&M1.indexOf(L1)===-1){var N1=M1+L1;v.data("aria-label",N1,true);}}}}function l1(f,v,m){var r;var s;var d;if(f.indexOf("{")===0){f=f.slice(1,-1);if(f.indexOf(">")!=-1){d=f.split(">");r=d[0];s=d[1];}else if(f.indexOf("&gt;")!=-1){d=f.split("&gt;");r=d[0];s=d[1];}try{f=v.getModel(r).getProperty(s);}catch(i){f=m[f][o.LABEL_KEY_V4].String;L.error("Unable to read labels from resource file",i);}}return f;}function m1(m,d){var f=U.cacheODataMetadata(m);if(!f){return undefined;}return f[d];}function n1(m,d,f){var j="",k="",r="";if(f){j=f.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(k!=""){k+=", ";}k+=m[i];}k=h.getText("MEAS_DIM_TITLE",[k,m[i]]);}else if(m){k=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(r!=""){r+=", ";}r+=d[i];}r=h.getText("MEAS_DIM_TITLE",[r,d[i]]);}else if(d){r=d[0];}if(f&&(j==="")){j=h.getText("NO_CHART_TITLE",[k,r]);f.setText(j);f.data("aria-label",j,true);}}function o1(m,i){var d=1;var s;if(i){var f=N.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=f.format(Number(d));}else{var j=N.getFloatInstance({style:'short',shortRefNumber:m});s=j.format(Number(d));}var k=s.slice(-1);return k;}function p1(v,d){v.attachSelectData(function(f){var s=l.bCRTLPressed?l.constants.explace:l.constants.inplace;l.bCRTLPressed=false;var m=v.getModel('ovpCardProperties');var y1=v.getModel();var z1=m.getProperty("/entitySet");var A1=m1(y1,z1);var B1=[],C1=[];var D1={},E1={};var F1=v.getDataset().getDimensions();var G1;for(var i=0;i<F1.length;i++){B1.push(F1[i].getName());}var H1=q.map(v.getDataset().getBinding("data").getCurrentContexts(),function(x){return x.getObject();});if(f.getParameter("data")&&f.getParameter("data")[0]&&f.getParameter("data")[0].data){C1=Object.keys(f.getParameter("data")[0].data);G1=f.getParameter("data")[0].data._context_row_number;var I1=v.getDataset().getBinding("data").getContexts()[G1];var J1=d.getEntityNavigationEntries(I1)[0];if(H1[G1].$isOthers&&H1[G1].$isOthers===true){var K1={},L1=[];for(var j=0;j<B1.length;j++){for(var k=0;k<C1.length;k++){if(B1[j]===C1[k]){for(var M1 in A1){if(A1.hasOwnProperty(M1)){var N1=A1[M1][o.LABEL_KEY]||A1[M1][o.NAME_KEY]||A1[M1][o.NAME_CAP_KEY];if(N1===C1[k]){L1.push(M1);}}}}}}for(var i=0;i<L1.length;i++){K1[L1[i]]=[];for(var j=0;j<H1.length-1;j++){if(j!=G1){K1[L1[i]].push(H1[j][L1[i]]);}}}var O1={$isOthers:true};var P1={getObject:function(){return O1;},getOtherNavigationDimensions:function(){return K1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(P1);}}else{if(J1){d.doNavigation(P1,J1,s);}}}else{for(var j=0;j<B1.length;j++){for(var k=0;k<C1.length;k++){if(B1[j]===C1[k]){for(var M1 in A1){if(A1.hasOwnProperty(M1)){var N1=(A1[M1][o.LABEL_KEY_V4]&&A1[M1][o.LABEL_KEY_V4].String)||A1[M1][o.LABEL_KEY]||A1[M1][o.NAME_KEY]||A1[M1][o.NAME_CAP_KEY];if(N1.match(/{@i18n>.+}/gi)){var Q1=this.getModel("@i18n").getResourceBundle();N1=Q1.getText(N1.substring(N1.indexOf(">")+1,N1.length-1));}if(N1===C1[k]){D1[M1]=H1[G1][M1];}}}}for(var M1 in H1[G1]){if(A1.hasOwnProperty(M1)){E1[M1]=H1[G1][M1];}}}}if(D1){n(Object.keys(D1),function(i,M1){if(A1[M1]["type"]==="Edm.String"){if(A1[M1]["sap:semantics"]==="yearmonth"||A1[M1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){D1[M1]=(D1[M1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(D1[M1]):D1[M1]);}else if(A1[M1]["sap:semantics"]==="yearquarter"||A1[M1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){D1[M1]=(D1[M1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(D1[M1]):D1[M1]);}else if(A1[M1]["sap:semantics"]==="yearweek"||A1[M1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){D1[M1]=(D1[M1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(D1[M1]):D1[M1]);}}});}if(E1){n(Object.keys(E1),function(i,M1){if(A1[M1]["type"]==="Edm.String"){if(A1[M1]["sap:semantics"]==="yearmonth"||A1[M1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){E1[M1]=(E1[M1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(E1[M1]):E1[M1]);}else if(A1[M1]["sap:semantics"]==="yearquarter"||A1[M1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){E1[M1]=(E1[M1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(E1[M1]):E1[M1]);}else if(A1[M1]["sap:semantics"]==="yearweek"||A1[M1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){E1[M1]=(E1[M1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(E1[M1]):E1[M1]);}}});}var R1=m.getProperty("/entityType"),S1=R1[m.getProperty('/presentationAnnotationPath')];if(R1){var T1=a.getRequestFields(S1);if(T1&&T1.length>0){n(T1,function(i,r){if(!D1.hasOwnProperty(r)){D1[r]=H1[G1][r];}});}}var P1={getObject:function(){return D1;},getAllData:function(){return E1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(P1);}}else{if(J1){d.doNavigation(P1,J1,s);}}}}});}function q1(d){if(d.EnumMember.endsWith("Bubble")){return true;}else{return false;}}function r1(d){var r=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.PropertyPath){L.error(p.CHART_ANNO_ERROR+"in "+p.CHART_ANNO+" "+p.DIMENSIONS_MANDATORY);return r;}r=true;return r;}function s1(m){var r=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.PropertyPath){L.error(p.CHART_ANNO_ERROR+"in "+p.CHART_ANNO+" "+p.MEASURES_MANDATORY);return r;}r=true;return r;}function t1(d){return d.name;}function u1(d){if(d&&d.indexOf("#")!=-1){var f=d.split("#");if(f.length>1){return f[1];}}return"";}function v1(d,v){var f=v.getModel('ovpCardProperties');var i=w1(v);var m=+i.itemsLength;var j=+f.getProperty("/dataStep");if(m&&j){var k=d.colSpan-1;if(k>=0){m+=j*k;x1(v,m);}}}function w1(v){var d=v.getModel('ovpCardProperties');var f=d.getProperty("/entityType");var i=d.getProperty("/presentationAnnotationPath");var j=f.hasOwnProperty(i)&&f[i];var m=j&&j.MaxItems;if(m){var k=m.Int32?m.Int32:m.Int;return{itemsLength:+k,dataStep:+d.getProperty("/dataStep")};}}function x1(v,d){var f,j={},k=[];var r=v.getVizType();var s=v.getModel('ovpCardProperties');var x=s.getProperty("/entityType");var y1=s.getProperty("/chartAnnotationPath");var z1=x[y1];var A1=v.getParent();var B1=A1.getBinding("data");j.path=B1.getPath();j.parameters={};if(B1.mParameters&&B1.mParameters.select){j.parameters.select=B1.mParameters.select;}j.filters=B1.aApplicationFilters;j.sorter=B1.aSorters;j.length=(r==="donut")?d+1:d;j.template=new g();A1.bindAggregation("data",j);if(r==="donut"){n(z1.MeasureAttributes,function(i,m){k.push(m.Measure.PropertyPath);});f={};f.path=B1.getPath();f.parameters={};f.parameters.select=k.join(",");f.filters=B1.aApplicationFilters;f.sorter=B1.aSorters;f.length=1;f.template=new g();A1.bindAggregation("aggregateData",f);}A1.updateBindingContext();}return{constants:o,errorMessages:p,formatItems:t,formatByType:E,returnDateFormat:H,formatChartAxes:I,hideDateTimeAxis:J,checkExists:K,validateCardConfiguration:P,checkNoData:Q,getConfig:R,hasTimeSemantics:T,getChartType:W,getPrimitiveValue:Y,formThePathForCriticalityStateCalculation:_,checkFlag:c1,buildVizAttributes:j1,setChartUoMTitle:k1,getMetadata:m1,getSelectedDataPoint:p1,checkBubbleChart:q1,dimensionAttrCheck:r1,measureAttrCheck:s1,getEntitySet:t1,getAnnotationQualifier:u1,reprioritizeContent:v1,getMaxItems:w1,getLabelFromAnnotationPath:l1};},true);
