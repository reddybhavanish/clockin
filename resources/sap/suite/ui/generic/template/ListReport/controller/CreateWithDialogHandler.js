sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/base/util/extend","sap/suite/ui/generic/template/lib/testableHelper"],function(B,S,M,e,t){"use strict";function g(s,c,T){var i=S.getStableId({type:"ListReportAction",subType:"CreateWithDialog"});var d=c.byId(i);function G(){return{"aFilters":[{sPath:"fullTarget",sOperator:"StartsWith",oValue1:d.getBindingContext().getPath()},{sPath:"target",sOperator:"EQ",oValue1:"/"+c.getOwnerComponent().getEntitySet()}]};}function r(){var o=G(d);var m=sap.ui.getCore().getMessageManager().getMessageModel();if(o){var h=m.bindList("/",null,null,[o]);var j=h.getContexts();if(j.length){var E=[];for(var k in j){E.push(j[k].getObject());}sap.ui.getCore().getMessageManager().removeMessages(E);}}}function C(){d.close();if(T.oComponentUtils.isDraftEnabled()){T.oServices.oCRUDManager.deleteEntities([d.getBindingContext().getPath()],true);}else{r(d);c.getView().getModel().deleteCreatedEntry(d.getBindingContext());}d.setBindingContext(null);}function f(E){var m=false;var h=sap.ui.getCore().getMessageManager().getMessageModel().getData();m=h.some(function(k){return k.type==="Error"&&k.validation;});if(!m&&T.oComponentUtils.isDraftEnabled()){s.oCRUDActionHandler=T.oServices.oApplication.getCRUDActionHandler(c,T.oCommonUtils);s.oCRUDActionHandler.handleCRUDScenario(1,a);}else if(!m){T.oCommonEventHandlers.submitChangesForSmartMultiInput();var F=G(d);var o=T.oServices.oCRUDManager.saveEntity(F);o.then(function(){d.close();T.oCommonUtils.refreshModel(s.oSmartTable);T.oCommonUtils.refreshSmartTable(s.oSmartTable);r(d);d.setBindingContext(null);});var j={saveEntityPromise:o};T.oComponentUtils.fire(c,"AfterSave",j);}}function a(){var A=T.oServices.oCRUDManager.activateDraftEntity(s.oCRUDActionHandler,d.getBindingContext());A.then(function(R){if(R&&R.response&&R.response.statusCode==="200"){d.close();d.setBindingContext(null);M.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_SAVED"),T.oServices);T.oCommonUtils.refreshSmartTable(s.oSmartTable);}},Function.prototype);var E={activationPromise:A};T.oComponentUtils.fire(c,"AfterActivate",E);}function b(E){var o=s.oSmartFilterbar;var h=T.oCommonUtils.getOwnerControl(E);h=T.oCommonUtils.isSmartTable(h)?h:h.getParent();if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.addEntry(E,false,o,false,false,true).then(function(j){T.oServices.oApplication.registerContext(j);d.setBindingContext(j);d.open();});}else{var n=T.oServices.oApplication.createNonDraft(h.getEntitySet());d.setBindingContext(n);d.open();}}var a=t.testable(a,"fnActivateImpl");var r=t.testable(r,"fnRemoveOldMessageFromModel");var G=t.testable(G,"fnGetFilterForCurrentState");return{onCancelPopUpDialog:C,onSavePopUpDialog:f,createWithDialog:b};}return B.extend("sap.suite.ui.generic.template.ListReport.controller.CreateWithDialogHandler",{constructor:function(s,c,T){e(this,g(s,c,T));}});});
