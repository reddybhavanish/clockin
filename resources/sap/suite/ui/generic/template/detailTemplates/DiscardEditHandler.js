sap.ui.define(["sap/ui/base/Object","sap/base/util/extend"],function(B,e){"use strict";function g(c,t,v,s){var i=t.oComponentUtils.isDraftEnabled();var b=t.oServices.oApplication.getBusyHelper();var V=c.getView();var u=V.getModel("ui");var C;var o;var I=false;var a=false;var f;var d;if(i&&t.oComponentUtils.getViewLevel()!==1){d=Function.prototype;}function F(){d();f=null;d=null;}function h(){a=false;if(I){C.close();}else{F();}}function O(l,m){if(!o){o=t.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.DiscardEditPopover",{onDiscardConfirm:function(){if(!I||a){return;}f();},beforeClose:function(){I=false;F();}},"discard",function(p,q){q.setProperty("/placement",sap.m.PlacementType.Top);});}o.then(function(p){I=true;C=p;var q=C.getModel("discard");q.setProperty("/isCreate",m);C.openBy(l);});}function j(){if(i){var l=V.getBindingContext();return t.oServices.oApplication.getNavigateAfterDraftCancelPromise(l).then(function(N){return function(){t.oServices.oViewDependencyHelper.setRootPageToDirty();t.oServices.oViewDependencyHelper.unbindChildren(c.getOwnerComponent());t.oServices.oApplication.invalidatePaginatorInfo();N();};});}return Promise.resolve(function(){var T=t.oComponentUtils.getTemplatePrivateModel();T.setProperty("/objectPage/displayMode",1);v.setEditable(false);if(u.getProperty("/createMode")){var m=c.getOwnerComponent().getModel("_templPrivGlobal");var p=m.getProperty("/generic/FCL");return(p&&p.highestViewLevel===1)?t.oServices.oNavigationController.navigateToRoot():t.oServices.oNavigationController.navigateBack();}});}function n(){return new Promise(function(r){if(i){var l=V.getBindingContext();var p=l.getPath();s.CRUDActionHandler.hasValidationMessageOnDetailsViews().then(function(q){var w=t.oServices.oApplication.getIsDraftModified(p)||q;r(w);});}else{var H=!!s.aUnsavedDataCheckFunctions&&s.aUnsavedDataCheckFunctions.some(function(U){return U();});var m=V.getModel();r(H||m.hasPendingChanges());}});}function k(){if(i){var l=V.getBindingContext();var E=l.getObject();var m=E.hasOwnProperty("HasActiveEntity")&&!l.getProperty("IsActiveEntity")&&!l.getProperty("HasActiveEntity");return m;}return u.getProperty("/createMode");}function D(l){if(d){return Promise.reject();}if(!(t.oComponentUtils.isComponentActive()&&u.getProperty("/editable"))){return Promise.reject();}var r=new Promise(function(R,m){d=m;var E=j();var p=function(){if(l&&b.isBusy()){F();return;}var q=function(){a=true;var w=E.then(function(A){var S=function(){d=R;A();h();};var x;if(i){x=t.oServices.oCRUDManager.deleteEntity(false,true).then(S);x.catch(h);}else{S();}t.oCommonUtils.resetChangesAndFireCancelEvent(x);return x;});b.setBusy(w);};n().then(function(N){if(l&&N){f=q;O(l,k());}else{q();}});};t.oServices.oApplication.performAfterSideEffectExecution(p);});r.catch(Function.prototype);return r;}return{discardEdit:D};}return B.extend("sap.suite.ui.generic.template.detailTemplates.DiscardEditHandler",{constructor:function(c,t,v,s){e(this,g(c,t,v,s));}});});
