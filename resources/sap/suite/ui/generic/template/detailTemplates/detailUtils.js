sap.ui.define(["sap/base/Log","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/extensionAPI/NavigationController","sap/suite/ui/generic/template/lib/MessageButtonHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/DiscardEditHandler","sap/suite/ui/generic/template/detailTemplates/PaginatorButtonsHelper","sap/suite/ui/generic/template/ObjectPage/extensionAPI/DraftTransactionController","sap/suite/ui/generic/template/ObjectPage/extensionAPI/NonDraftTransactionController","sap/m/DraftIndicator"],function(L,U,H,F,a,N,M,t,D,P,b,c){"use strict";var d=sap.m.DraftIndicatorState;var p=new F({path:"persistent",operator:a.EQ,value1:false});function g(C,o,v){function i(){var T=o.getTemplatePrivateModel();T.setProperty("/objectPage",{displayMode:0,headerInfo:{objectTitle:"",objectSubtitle:""}});o.setStatePreserverPromise(v);}function f(B,I){if(!o.isDraftEnabled()){var m=C.getModel("ui");var T=o.getTemplatePrivateModel();var q=m.getProperty("/createMode");T.setProperty("/objectPage/displayMode",q?4:1);}(v.onComponentActivate||Function.prototype)(B,I);}function u(B){var T=C.getModel("_templPrivGlobal");T.setProperty("/generic/draftIndicatorState",d.Clear);(v.applyHeaderContextToSmartTablesDynamicColumnHide||Function.prototype)(B);}function h(){return o.getDraftRootPath();}function n(){v.navigateUp();}function j(s,A){return v.oStatePreserverPromise.then(function(S){return S.getUrlParameterInfo(s,A);});}function k(O){return v.getMessageFilters(O);}function l(m){return v.getScrollFunction&&v.getScrollFunction(m);}return{init:i,onActivate:f,getTitle:o.getTitleFromTreeNode,updateBindingContext:u,currentDraftModified:h,navigateUp:n,getUrlParameterInfo:j,getMessageFilters:k,getScrollFunction:l};}function e(v,T,C){var o;var f;function G(){var R=U.getRouterFor(C);return R?R.getHashChanger():H.getInstance();}function s(i){var I=!T.oComponentUtils.isDraftEnabled();if(I||!i){var B=C.getView().getModel("ui");B.setProperty("/editable",i);}}function O(){T.oServices.oApplication.onBackButtonPressed();}function A(){var B=T.oServices.oApplication.getLinksToUpperLayers();var V=T.oComponentUtils.getViewLevel();var E;if(T.oComponentUtils.isDraftEnabled()){var I=T.oComponentUtils.getTemplatePrivateModel();E=I.getProperty("/objectPage/displayMode");}else{E=1;}v.navigateUp=B[V-1].navigate.bind(null,E,false);var J=v.aBreadCrumbs;var K=J?J.length:0;for(var i=0;i<K;i++){var Q=J[i];var R=B[i+1];R.adaptBreadCrumbLink(Q);var S=T.oCommonUtils.getControlInformation(Q,function(W){});S.navigate=R.navigate.bind(null,E,true);}}function h(i){var B=i.getBindingContext();var E=G().getHash();return T.oServices.oApplicationController.propertyChanged(E,B);}function n(){v.navigateUp();}function j(i){var B=T.oServices.oApplication.getBusyHelper();var E=C.getView().getModel("ui");var I=C.getOwnerComponent().getModel("_templPrivGlobal");var J=h(i).then(function(R){if(!o.fclInfo.isContainedInFCL||I.getProperty("/generic/FCL/isVisuallyFullScreen")){n();}},function(){B.getUnbusy().then(function(R){if(!o.fclInfo.isContainedInFCL||I.getProperty("/generic/FCL/isVisuallyFullScreen")){T.oCommonUtils.processDataLossTechnicalErrorConfirmation(function(){n();E.setProperty("/enabled",true);},Function.prototype,o.state);}else{T.oCommonUtils.processDataLossTechnicalErrorConfirmation(Function.prototype,Function.prototype,o.state,"StayOnPage");}});});B.setBusy(J);}function k(E){var i=E.getSource();o.state.CRUDActionHandler.handleCRUDScenario(2,j.bind(null,i));}var l;function m(i){l=l||new D(C,T,v,o.state);return l.discardEdit(i);}function q(){o.state.messageButtonHelper.toggleMessagePopover();}function r(i){return o.state.messageButtonHelper&&o.state.messageButtonHelper.getMessageFilters(i);}function u(){var i;return function(){i=i||new N(T,C,o.state);return i;};}function w(){var i;return function(){if(!i){var B=T.oComponentUtils.isDraftEnabled()?b:c;i=new B(T,C,o.state);}return i;};}function x(){f.handleShowNextObject();}function y(){f.handleShowPrevObject();}var G=t.testable(G,"getHashChangerInstance");var A=t.testable(A,"adaptLinksToUpperLevels");o={onInit:function(R,i,B,E){if(!R||R.footerBar){var I=T.oComponentUtils.isODataBased();var J={controller:C,prepareAllMessagesForNavigation:i,messageSorter:B,getGroupTitle:E};o.state.messageButtonHelper=new M(T,J,I);if(!T.oComponentUtils.isDraftEnabled()){var K=C.getOwnerComponent().getModel("ui");var Q=K.bindProperty("/editable");var S=sap.ui.getCore().getMessageManager();var V=S.getMessageModel();Q.attachChange(function(){if(!Q.getValue()){var W=o.state.messageButtonHelper.getContextFilter();var X=V.bindList("/",null,null,[W,p]);var Y=X.getContexts();var Z=Y.map(function($){return $.getObject();});S.removeMessages(Z);}});}o.state.CRUDActionHandler=T.oServices.oApplication.getCRUDActionHandler(C,T.oCommonUtils);T.oServices.oTemplateCapabilities.oMessageButtonHelper=o.state.messageButtonHelper;o.state.onCancel=m;}if(!R||R.paginatorButtons){f=new P(o,C,T);}v.getScrollFunction=function(W){var X=T.oCommonUtils.getPositionableControlId(W);return X&&T.oCommonUtils.focusControl.bind(null,X);};},handlers:{handleShowNextObject:x,handleShowPrevObject:y,onShowMessages:q,applyAndUp:k,onSave:function(){L.error("Save for this floorplan not implemented yet");},onBack:O},extensionAPI:{getNavigationControllerFunction:u,getTransactionControllerFunction:w},fclInfo:{isContainedInFCL:false},state:{},onComponentActivate:function(B,i){if(o.state.messageButtonHelper){o.state.messageButtonHelper.adaptToContext(B);}A();if(f){f.computeAndSetVisibleParamsForNavigationBtns();}v.oStatePreserverPromise.then(function(S){S.applyAppState(B,i);});}};v.navigateUp=n;v.setEditable=s;v.getMessageFilters=r;var z=T.oComponentUtils.getFclProxy();if(z.oActionButtonHandlers){o.handlers.fclActionButtonHandlers=z.oActionButtonHandlers;o.fclInfo.isContainedInFCL=true;}o.stateChanged=function(){v.oStatePreserverPromise.then(function(S){S.stateChanged();});};return o;}return{getComponentBase:g,getControllerBase:e};});
