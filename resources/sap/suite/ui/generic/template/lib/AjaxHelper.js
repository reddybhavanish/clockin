sap.ui.define(["sap/ui/util/XMLHelper","sap/suite/ui/generic/template/lib/testableHelper"],function(X,t){"use strict";var R={ERROR:"error",PARSING_ERROR:"parsing error",DATA_TYPE_NOT_SUPPORTED:"data type not supported",SUCCESS:"success"};var a={};var b="GET";var c=["text","json","xml","plain"];a.ajax=function(s){if(!s||typeof s!=="object"){throw new Error("send a valid setting object to call ajax");}var i=(s&&s.async)===undefined?true:s.async;var j=s.type||b;var u=s.url;if(!u||typeof u!=="string"){throw new Error("Provide a proper url to make AJAX call");}var k=g(s.data);var l=j===b;if(k&&l){u=u+"?"+k;}t.testable(h,"handelResponse");t.testable(g,"encodeData");t.testable(p,"parseJson");t.testable(f,"parseXML");var r=new XMLHttpRequest();if(i){var P=new Promise(function(o,q){r.addEventListener("load",T);r.addEventListener("error",v);r.addEventListener("abort",w);r.open(j,u,i);r.setRequestHeader('Content-Type','application/x-www-form-urlencoded');l?r.send():r.send(k);function T(x){var y=h(x,s);if(y.success){return o(y);}return q(y);}function v(x){q(d(x));}function w(x){q(e(x));}});return P;}else{var m;r.addEventListener("load",function fnTransferComplete(o){m=h(o,s);});r.addEventListener("error",function fnTransferFailed(o){m=d(o);});r.addEventListener("abort",function fnTransferCanceled(o){m=e(o);});r.open(j,u,i);r.setRequestHeader('Content-Type','application/x-www-form-urlencoded');try{l?r.send():r.send(k);}catch(n){m={};m.statusCode=r.status;m.request=r;m.success=false;m.textStatus=R.ERROR;m.error=n;}return m;}};a.getJSON=function(u){return new Promise(function(r,i){a.ajax({url:u,async:true,dataType:"json"}).then(function(j){r(j.data);}).catch(function(j){i(j.error);});});};a.sjax=function(s){if(s.async){throw new Error("AjaxHelper.sjax should not be called with async flag set");}s.async=false;return this.ajax(s);};a.syncGetJSON=function(u){return a.sjax({url:u,dataType:"json"});};function h(i,s){var j=i.target.status;var r={};var k=s.dataType;var l=(j>=200&&j<300)||j===304;if(l){if(k){switch(k){case"json":r=p(i.target.responseText);break;case"xml":r=f(i.target.responseText);break;case"text":r.data=i.target.responseText;break;default:r.success=false;r.textStatus=R.ERROR;r.error=R.DATA_TYPE_NOT_SUPPORTED;}}else{var m=i.target.getResponseHeader("content-type");if(m){var n=m.split("/")[1].split(";")[0];if(c.indexOf(n)+1){k=n;r.request=i.target;switch(k){case"json":r=p(i.target.responseText);break;case"xml":r=f(i.target.responseText);break;default:r.data=i.target.responseText;break;}}else{r.success=false;r.textStatus=R.ERROR;r.error=R.DATA_TYPE_NOT_SUPPORTED;}}}}else{r.success=false;r.textStatus=R.ERROR;r.error=i.target.statusText||R.ERROR;}r.request=i.target;r.statusCode=i.target.status;r.success=r.success!==false;if(r.success){r.textStatus=R.SUCCESS;}return r;}function d(i){var r={};r.statusCode=i.target.status;r.request=i.target;r.success=false;r.textStatus=R.ERROR;r.error=i.target.statusText||R.ERROR;return r;}function e(i){var r={};r.statusCode=i.target.status;r.request=i.target;r.success=false;r.textStatus="aborted";return r;}function p(j){var r={};try{r.data=j===""?undefined:JSON.parse(j);}catch(i){r.success=false;r.textStatus=R.PARSING_ERROR;r.error=i;}return r;}function f(x){var r={};var o=X.parse(x);if(o.parseError.errorCode!==0){r.success=false;r.textStatus=R.PARSING_ERROR;r.error=o.parseError.reason;return r;}r.data=o;return r;}function g(i){var j;if(i){j=typeof i=='string'?i:Object.keys(i).map(function(k){return encodeURIComponent(k)+'='+encodeURIComponent(i[k]);}).join('&');}return j;}return a;});
