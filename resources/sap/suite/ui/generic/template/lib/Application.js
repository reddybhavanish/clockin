sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/deletionHelper","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/CRUDActionHandler","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/StatePreserver","sap/suite/ui/generic/template/lib/testableHelper","sap/base/Log","sap/ui/core/syncStyleClass","sap/base/util/extend","sap/ui/core/Fragment"],function(B,D,J,M,A,a,P,d,r,C,b,c,S,t,L,s,e,F){"use strict";var f=(t.testableStatic(function(T,o){var i="sapUiSizeCozy",k="sapUiSizeCompact";if(o&&(o.classList.contains(i)||o.classList.contains(k))){return"";}else{return T?i:k;}},"Application_determineContentDensityClass")(D.support.touch,document.body));function g(){return f;}function h(o,p){s(f,p,o);p.addDependent(o);}var h=t.testableStatic(h,"Application_attachControlToParent");function j(T){var o=new b(T.oAppComponent);var E;var n=Object.create(null);function k(i){var t1=T.oNavigationControllerProxy.getActiveComponents();return t1.indexOf(i.getId())>=0;}var I=false;function l(i){T.fnAddSideEffectPromise(i);}function p(i,t1){if(I){return;}var u1=T.aRunningSideEffectExecutions.filter(function(v1){return!!v1;});if(u1.length){I=true;Promise.all(u1).then(function(){I=false;p(i,t1);});}else if(!(t1&&T.oBusyHelper.isBusy())){i();}}function m(i){var t1;if(i instanceof a){t1="open";}else if(i instanceof P||i instanceof A){t1="openBy";}if(t1){var u1=i[t1];i[t1]=function(){var v1=arguments;p(function(){if(!T.oBusyHelper.isBusy()){T.oBusyHelper.getUnbusy().then(function(){u1.apply(i,v1);});}});};}}var q={};function u(i,t1,u1,v1,w1){i=i||T.oNavigationHost;var x1=i.getId();var y1=q[x1]||(q[x1]={});var z1=y1[t1];if(!z1){z1=sap.ui.xmlfragment(x1,t1,u1);h(z1,i);var A1;if(v1){A1=new J();z1.setModel(A1,v1);}(w1||Function.prototype)(z1,A1);y1[t1]=z1;m(z1);}return z1;}function v(i,t1,u1,v1,w1){return new Promise(function(x1){i=i||T.oNavigationHost;var y1=i.getId();var z1=q[y1]||(q[y1]={});var A1=z1[t1];if(!A1){F.load({id:y1,name:t1,controller:u1,type:"XML"}).then(function(B1){A1=B1;h(B1,i);var C1;if(v1){C1=new J();B1.setModel(C1,v1);}(w1||Function.prototype)(B1,C1);z1[t1]=B1;m(B1);x1(A1);});return;}x1(A1);});}function w(){return new Promise(function(i){T.oNavigationObserver.getProcessFinished(true).then(function(){T.oBusyHelper.getUnbusy().then(i);});});}function O(){T.oDataLossHandler.performIfNoDataLoss(function(){T.oNavigationControllerProxy.navigateBack();},Function.prototype);}function x(i,t1,u1){var v1=c.createNonDraft(null,"/"+i,T.oAppComponent.getModel(),t1,s1());if(u1){u1.aCreateContexts=u1.aCreateContexts||[];u1.aCreateContexts.push({entitySet:i,context:v1,predefinedValues:t1});}return v1;}function N(i){T.oNavigationControllerProxy.navigateForNonDraftCreate(i.entitySet,i.predefinedValues,i.context);}function y(i,t1){T.oNavigationControllerProxy.navigateToSubContext(i,t1,0);}function z(t1){var u1=T.oNavigationControllerProxy.getActiveComponents();for(var i=0;i<u1.length;i++){var v1=T.componentRegistry[u1[i]];v1.utils.onBeforeDraftTransfer(t1);}}function G(i,t1){z(t1);o.activationStarted(i,t1);}function H(i,t1){z(t1);o.cancellationStarted(i,t1);}function K(i,t1){z(t1);o.editingStarted(i,t1);}function R(i){T.aStateChangers.push(i);}function Q(i,t1){t1.then(function(){o.adaptAfterObjectDeleted(i);});}function U(i,t1,u1){var v1=T.mEntityTree[i];var w1;if(v1.navigationProperty&&v1.parent){w1=t1?v1.entitySet:v1.navigationProperty;}else{w1=i;}if(u1.indexOf(w1)<0){u1.unshift(w1);if(v1.navigationProperty&&v1.parent){U(v1.parent,t1,u1);}}}function V(i,t1){var u1=[];U(i,t1,u1);return u1;}function W(t1){var u1=V(t1);u1.pop();var v1="";var w1="";var x1=[];for(var i=0;i<u1.length;i++){v1=v1+w1+u1[i];x1.push(v1);w1="/";}return x1;}function X(){var i=T.oNavigationControllerProxy.oHashChanger.getHash();var t1=i.split("?")[0];var u1=t1.split("/");if(u1[0]===""||u1[0]==="#"){u1.splice(0,1);}return u1;}function Y(){return T.oNavigationControllerProxy.getLinksToUpperLayers();}function Z(){var t1=T.oNavigationControllerProxy.getActiveComponents();var u1=0;var v1;for(var i=0;i<t1.length;i++){var w1=T.componentRegistry[t1[i]];if(w1.viewLevel>0&&(u1===0||w1.viewLevel<u1)){u1=w1.viewLevel;v1=w1.oComponent;}}var x1=v1?Promise.resolve(v1):T.oNavigationControllerProxy.getRootComponentPromise();return x1.then(function(y1){return y1.getModel("i18n").getResourceBundle();});}function $(){return T.oNavigationControllerProxy.getAppTitle();}function _(i){return T.oNavigationControllerProxy.getCurrentKeys(i);}function a1(){for(var i in T.componentRegistry){var t1=T.componentRegistry[i];if(t1.viewLevel===1){if(k(t1.oComponent)){var u1=t1.oComponent.getComponentContainer().getElementBinding();return u1&&u1.getPath();}else{return null;}}}return null;}var b1;function c1(t1,u1){var i=u1||0;if(i>0){return null;}var v1=t1.getEntitySet();var w1=T.mEntityTree[v1];var x1=w1&&w1.communicationObject;for(;i<0&&x1;){w1=T.mEntityTree[w1.parent];if(w1.communicationObject!==x1){i++;x1=w1.communicationObject;}}if(i<0||x1){return x1;}b1=b1||{};return b1;}function d1(i){for(var t1 in T.mEntityTree){if(T.mEntityTree[t1].navigationProperty&&(T.mEntityTree[t1].level===i+1)){return T.mEntityTree[t1].navigationProperty;}}}function e1(){return T.oFlexibleColumnLayoutHandler?T.oFlexibleColumnLayoutHandler.getMaxColumnCountInFCL():false;}function f1(){var t1=T.oNavigationControllerProxy.getActiveComponents();for(var i=0;i<t1.length;i++){var u1=t1[i];var v1=T.componentRegistry[u1];var w1=v1.methods.currentDraftModified&&v1.methods.currentDraftModified();if(w1){o.markDraftAsModified(w1);}}}function g1(){if(E!==undefined){return E;}var i,t1,u1,v1,w1,x1,y1=true;var z1=T.oAppComponent.getModel();var A1=z1.getMetaModel();var B1=z1.mContexts;for(u1 in B1){y1=false;w1=B1[u1].sPath;v1=w1&&w1.substring(1,w1.indexOf('('));x1=v1&&A1.getODataEntitySet(v1);if(x1){i=z1.getProperty(w1);t1=i&&z1.getETag(undefined,undefined,i)||null;if(t1){E=true;return E;}}}if(y1){return true;}E=false;return E;}function h1(t1){var i,u1,v1;var w1=T.oNavigationControllerProxy.getAllComponents();for(i=0;i<w1.length;i++){u1=w1[i];if(!t1||!t1[u1]){v1=T.componentRegistry[u1];v1.utils.refreshBinding(true);}}}function i1(i){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.setStoredTargetLayoutToFullscreen(i);}}function j1(){T.oPaginatorInfo={};}function k1(i){return new S(T,i);}function l1(i,t1){return new C(T,i,t1);}function m1(t1,u1){var v1=n[t1];if(!v1){v1=Object.create(null);n[t1]=v1;var w1=T.oAppComponent.getModel();var x1=w1.getMetaModel();var y1=x1.getODataEntitySet(t1);var z1=y1&&x1.getODataEntityType(y1.entityType);var A1=(z1&&z1.navigationProperty)||[];for(var i=0;i<A1.length;i++){var B1=A1[i];v1[B1.name]=B1;}}return v1[u1];}function n1(i){var t1=T.oNavigationControllerProxy.getSwitchToSiblingPromise(i,2);T.oBusyHelper.setBusy(t1.then(function(u1){u1();}));}function o1(i){var t1=T.oNavigationControllerProxy.getSpecialDraftCancelPromise(i);if(t1){return t1;}var u1=o.getDraftSiblingPromise(i);return u1.then(function(v1){var w1=v1&&v1.getObject();var x1=w1&&w1.IsActiveEntity;if(!x1){return Promise.resolve(d.getNavigateAfterDeletionOfCreateDraft(T));}return T.oNavigationControllerProxy.getSwitchToSiblingPromise(v1,1).then(function(y1){return function(){var z1=v1.getModel();z1.invalidateEntry(v1);return y1();};});});}function p1(i){return T.oNavigationControllerProxy.navigateAfterActivation(i);}function q1(i,t1,u1,v1){T.oNavigationControllerProxy.navigateToSubContext(i,t1,u1,v1);}function r1(){return!T.bCreateRequestsCanonical;}function s1(){return!T.bCreateRequestsCanonical;}T.oApplicationProxy={getDraftSiblingPromise:o.getDraftSiblingPromise,getSiblingPromise:o.getSiblingPromise,getAlternativeContextPromise:o.getAlternativeContextPromise,getPathOfLastShownDraftRoot:o.getPathOfLastShownDraftRoot,areTwoKnownPathesIdentical:o.areTwoKnownPathesIdentical,getResourceBundleForEditPromise:Z,getHierarchySectionsFromCurrentHash:X,getContentDensityClass:g,getDialogFragment:u.bind(null,null),getDialogFragmentAsync:v.bind(null,null),destroyView:function(i){delete q[i];},markCurrentDraftAsModified:f1,prepareDeletion:Q,performAfterSideEffectExecution:p,onBackButtonPressed:O,mustRequireRequestsCanonical:s1};return{createNonDraft:x,navigateToNonDraftCreateContext:N,navigateToContextArray:y,getContentDensityClass:g,attachControlToParent:h,getDialogFragmentForView:u,getDialogFragmentForViewAsync:v,getBusyHelper:function(){return T.oBusyHelper;},addSideEffectPromise:l,performAfterSideEffectExecution:p,isComponentActive:k,showMessageToast:function(){var i=arguments;var t1=function(){L.info("Show message toast");M.show.apply(M,i);};Promise.all([w(true),T.oBusyHelper.getUnbusy()]).then(t1);},registerStateChanger:R,getDraftSiblingPromise:o.getDraftSiblingPromise,registerContext:o.registerContext,activationStarted:G,cancellationStarted:H,editingStarted:K,getBreadCrumbInfo:W,getSections:V,getHierarchySectionsFromCurrentHash:X,getLinksToUpperLayers:Y,getAppTitle:$,getCurrentKeys:_,getPathForViewLevelOneIfVisible:a1,getCommunicationObject:c1,getForwardNavigationProperty:d1,getMaxColumnCountInFCL:e1,markCurrentDraftAsModified:f1,checkEtags:g1,refreshAllComponents:h1,getIsDraftModified:o.getIsDraftModified,prepareDeletion:d.prepareDeletion.bind(null,T),setStoredTargetLayoutToFullscreen:i1,invalidatePaginatorInfo:j1,getStatePreserver:k1,getCRUDActionHandler:l1,getNavigationProperty:m1,switchToDraft:n1,getNavigateAfterDraftCancelPromise:o1,navigateAfterActivation:p1,navigateToSubContext:q1,onBackButtonPressed:O,needsToSuppressTechnicalStateMessages:r1,mustRequireRequestsCanonical:s1};}return B.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(T){e(this,j(T));}});});
