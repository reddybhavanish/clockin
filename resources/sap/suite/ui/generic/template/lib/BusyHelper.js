sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/testableHelper","sap/base/Log","sap/base/util/extend","sap/base/util/isEmptyObject"],function(B,M,t,L,a,i){"use strict";function g(T){var b={};var I=false;var c=false;var d=0;T.oNavigationHost.setBusyIndicatorDelay(0);var u=Promise.resolve();var U=Function.prototype;var o={};function f(){return d!==0||!i(b);}var A;function h(e){var p=f();if(p||e){c=false;T.oNavigationHost.setBusy(p);L.info("Physical busy state has been changed to "+p);if(p!==I){I=p;if(!I){var q=T&&T.oNavigationControllerProxy&&T.oNavigationControllerProxy.getActiveComponents();if(q){for(var r=0;r<q.length;r++){var v=q[r];if(!v){continue;}var C=T.componentRegistry&&T.componentRegistry[v]&&T.componentRegistry[v].oController;C&&C.adaptTransientMessageExtension&&C.adaptTransientMessageExtension();}}u=Promise.resolve();u=M.handleTransientMessages(T.oApplicationProxy.getDialogFragment,o.actionLabel);o={};u.then(U);}}}else{var N=T.oNavigationObserver.getProcessFinished(true);N.then(A,A);}}A=h.bind(null,true);function E(e){if(e){h();}else if(!c){c=true;setTimeout(h,0);}}function j(){d--;if(!d){E(false);}}function m(){if(I){return;}I=true;u=new Promise(function(r){U=r;});M.removeTransientMessages();}function l(p,q,r){var S=[],C="",v=T.oNavigationHost.getId(),w="sap.suite.ui.generic.template.busyHandling";try{throw new Error("Get the stack");}catch(e){S=e.stack.split(p,2);if(S.length>=2){S=S[1].split("\n");S.shift();}if(S.length){C=S[0].trim();}}if(L.getLevel(w)<L.Level.INFO){L.setLevel(L.Level.INFO,w);}L.info("busyHandling: "+p,r+" called",w,function(){var x={method:p,reason:r,promise:q,promisePending:true,caller:C,callStack:S,elementId:v,type:w};function P(){x.promisePending=false;}x.promise.then(P,P);return x;});}function s(r,e,p,S){var q;if(e){a(o,S);m();if(!b[r]){q=new Promise(function(v){b[r]=v;});if(sap.ui.support){l("setBusyReason",q,r);}}}else{if(b[r]){b[r]();}delete b[r];}E(e&&p);}function k(e,p,S){a(o,S);d++;m();e.then(j,j);E(p);if(sap.ui.support){l("setBusy",e,"");}}function n(){return 0;}return{setBusyReason:s,setBusy:k,isBusy:f,getUnbusy:function(){return u;},getBusyDelay:n};}return B.extend("sap.suite.ui.generic.template.lib.BusyHelper",{constructor:function(T){a(this,(t.testableStatic(g,"BusyHelper"))(T));}});});
