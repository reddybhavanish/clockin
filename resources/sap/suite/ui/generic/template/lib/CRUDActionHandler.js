sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/extend"],function(B,F,a,e){"use strict";var A=new F({filters:[new F({path:"type",operator:a.EQ,value1:sap.ui.core.MessageType.Warning}),new F({path:"type",operator:a.EQ,value1:sap.ui.core.MessageType.Error})],and:false});var E=new F({path:"type",operator:a.EQ,value1:sap.ui.core.MessageType.Error});var l="model";function g(t,c,C){var y,n;var f;var I;var s=(function(){var o=c.getOwnerComponent();var R=t.componentRegistry[o.getId()];return!!(R.methods.showConfirmationOnDraftActivate&&R.methods.showConfirmationOnDraftActivate());})();function b(k){var m=t.oNavigationControllerProxy.getActiveComponents();var R;for(var i=0;i<m.length&&!R;i++){var o=m[i];var q=t.componentRegistry[o];R=q.viewLevel&&(q.methods.getScrollFunction||Function.prototype)(k);}return R||null;}function d(S,k){return new Promise(function(R){var o,L,m;C.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.MessageInfluencingCRUDAction",{onMessageSelect:function(){L.setProperty("/backbtnvisibility",true);},onBackButtonPress:function(){m.navigateBack();L.setProperty("/backbtnvisibility",false);},onAccept:function(){f=y;o.close();},onReject:function(){f=n;o.close();},isPositionable:function(i){return!!(i&&b(i));},titlePressed:function(i){o.close();var M=i.getParameter("item");var q=M.getBindingContext("msg").getObject();f=b(q.controlIds);o.close();},afterClose:function(){y=null;n=null;m.navigateBack();(f||Function.prototype)();f=null;}},l,function(i){m=i.getContent()[0];i.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");I=i.getContent()[0].getBinding("items");}).then(function(q){o=q;L=o.getModel(l);L.setProperty("/situation",S);L.setProperty("/backbtnvisibility",false);L.setProperty("/title",o.getModel("i18n").getProperty("ST_DETAIL_TITLE_VALIDATION"));var u=[];var v=t.oNavigationControllerProxy.getActiveComponents();var O=(S<3);for(var i=0;i<v.length;i++){var w=v[i];var x=t.componentRegistry[w];if(x.oController===c||S!==2){var z=(x.methods.getMessageFilters||Function.prototype)(O);u=z?u.concat(z):u;}}if(u.length===0){R(null);return;}var D=u.length===1?u[0]:new F({filters:u,and:false});if(S===3){E=new F({filters:[D,E],and:true});D=new F({filters:[D,A],and:true});L.setProperty("/title",o.getModel("i18n").getProperty("ST_DETAIL_TITLE_SAVE"));if(I.filter(E).getLength()===0){L.setProperty("/situation",4);L.setProperty("/CRUDAction",k);var G=(o.getModel("_templPriv").getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var J=o.getModel("_templPriv").getProperty("/objectPage/headerInfo/objectSubtitle");var P,T;if(k==="Delete"){if(G){if(J){P=[" ",G,J];T=C.getText("CONFIRMATION_POPUP_TITLE_DELETE_WITH_OBJECTINFO",P);}else{P=[G];T=C.getText("CONFIRMATION_POPUP_TITLE_DELETE_WITH_OBJECTTITLE",P);}}else{T=C.getText("CONFIRMATION_POPUP_TITLE_ST_GENERIC_DELETE_SELECTED");}L.setProperty("/title",T);}}}I.filter(D);R(I.getLength()&&o);});});}function h(i){return new Promise(function(R,k){var v;d(i?1:2).then(function(P){v=P;if(v){v.open();return k();}if(!(i&&s)){return R();}d(3).then(function(P){v=P;if(v){y=R;n=k;v.open();}else{R();}});});});}function p(i,o){t.oApplicationProxy.performAfterSideEffectExecution(function(){if(!t.oBusyHelper.isBusy()){h(i).then(o);}});}function r(o,i,k){y=o;n=i;d(3,k).then(function(w){if(w){w.open();}else{i();}});}function H(S,P,i,k){if(S===4){r(P,i,k);}else{p((S===1),P);}}function j(){return new Promise(function name(R){d(1).then(function(P){R(!!P);});});}return{handleCRUDScenario:H,hasValidationMessageOnDetailsViews:j};}return B.extend("sap.suite.ui.generic.template.lib.CRUDActionHandler",{constructor:function(t,c,C){e(this,g(t,c,C));}});});
