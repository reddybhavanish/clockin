sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/suite/ui/generic/template/js/AnnotationHelper","sap/base/util/extend","sap/base/util/isEmptyObject"],function(B,L,A,e,a){"use strict";var C={isPreliminary:function(){return false;}};function g(c,o){var t=o.oTemplateContract.mRoutingTree[o.route];var h;var H;var f;var b;var d;var I=false;var l;var j=[];var k;var n=false;var E=[];function m(){return c.getModel("_templPriv");}function p(){return m().getProperty("/generic/viewLevel");}function q(){return o.preprocessorsData;}function r(){var i=q();if(i&&i.rootContextExpand){return i.rootContextExpand.join(',');}}function s(){return o.oParameterModel;}function u(i,x1,y1){if(typeof y1!=="function"){throw new Error("Event handler must be a function");}E.push({template:i,event:x1,handler:y1});}function D(x1,y1,z1){for(var i=E.length;i--;){if(E[i].handler===z1&&E[i].event===y1&&E[i].template===x1){E.splice(i,1);}}}function F(x1,y1,z1){for(var i=0;i<E.length;i++){if(E[i].event===y1&&E[i].template===x1){E[i].handler(z1);}}}function v(i){return i.getMetadata().getName();}function w(){return o.oApplication.isComponentActive(c);}function x(){return o.oNavigationObserver.getProcessFinished(true);}function P(i,x1){var y1=x();y1.then(function(){if(w()){if(x1){V(true);}F(v(o.oController),"PageDataLoaded",{context:i});if(m1()){var z1=i.getObject();if(!z1.IsActiveEntity){o.oApplication.getDraftSiblingPromise(i);}}}});}function y(){h.then(function(i){if(i){P(i);}});}function S(){o.oHeaderLoadingObserver.startProcess();if(!d){var i=new Promise(function(x1){d=x1;});o.oApplication.getBusyHelper().setBusy(i);}}function N(){if(!H){h=new Promise(function(i){H=i;});}}if(t.getPath(3)){N();}else{h=Promise.resolve();}function z(i){L.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;N();if(!c.getComponentContainer().getElementBinding().isSuspended()){S();}}function G(){if(d){d();d=null;}o.oHeaderLoadingObserver.stopProcess();}function J(i){var x1=i.getSource().getBoundContext();if(x1){return x1;}if(c.getComponentContainer().getElementBinding().isSuspended()){x1=null;}else{x1=C;}U();return x1;}function K(){o.oTemplateContract.oNavigationControllerProxy.navigationContextNotFound();}function M(){I=false;if(!b){return;}if(b===C){K();U();}else if(!c.getComponentContainer().getElementBinding().isSuspended()){var i=c.getBindingContext();var x1=e1(i);var y1=x1.bIsDraft||n;var z1;if(y1){n=false;z1=x1.bIsCreate?4:2;}else{z1=1;}var A1=m();A1.setProperty("/objectPage/displayMode",z1);var B1=c.getModel("ui");B1.setProperty("/enabled",true);B1.setProperty("/createMode",x1.bIsCreate);B1.setProperty("/editable",y1);(o.methods.updateBindingContext||Function.prototype)(i);if(H){H(b);}}else{return;}H=null;b=null;}function O(i){L.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");f();G();if(I){b=J(i);}M();}function Q(i){f();var x1=J(i);if(x1&&x1.isPreliminary()){return;}b=x1;M();o.oHeaderLoadingObserver.stopProcess();}function R(i){var x1={createPreliminaryContext:true,canonicalRequest:!o.oTemplateContract.bCreateRequestsCanonical};var y1=q();if(y1.rootContextExpand&&y1.rootContextExpand.length){x1.expand=r();}o.oHeaderLoadingObserver.startProcess();var z1=new Promise(function(A1){f=A1;});if(o.methods.beforeRebind){o.methods.beforeRebind(z1);}N();b=null;c.getComponentContainer().bindElement({path:i,events:{dataRequested:z,dataReceived:O,change:Q},parameters:x1,batchGroupId:"Changes",changeSetId:"Changes"});l=i;if(o.methods.afterRebind){o.methods.afterRebind();}}function U(){N();var i=c.getComponentContainer();i.unbindElement();l=null;b=null;I=false;G();}function T(){var x1=g1();var y1=(x1.length===j.length);for(var i=0;i<x1.length&&y1;i++){y1=x1[i]===j[i];}j=x1;return!y1;}function V(i){o.reuseComponentsReady.then(function(x1){for(var y1 in x1){x1[y1].pathUnchangedCallBack(i);}});}function W(i,x1){var y1=Object.create(null);for(var z1 in i){var A1=i[z1];y1[z1]=x1(A1,z1);}return y1;}function X(){var i=m();for(var x1 in t.embeddedComponents){var y1=!!t.embeddedComponents[x1].definition.hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+x1+"/hidden",y1);}}function Y(i,x1){var y1=T();if(y1&&!x1){X();}if(!i){if(o.routingSpec&&o.routingSpec.noOData){P(null,y1);}return;}var z1=c.getComponentContainer();if(!z1){return;}var A1=c.getModel("ui");var B1=!!o.nonDraftCreateContext;if(B1){var C1=z1.getBindingContext();if(C1===o.nonDraftCreateContext){return;}A1.setProperty("/enabled",true);A1.setProperty("/editable",true);A1.setProperty("/createMode",true);U();if(H){H(o.nonDraftCreateContext);H=null;}else{h=Promise.resolve(o.nonDraftCreateContext);}y();z1.setBindingContext(o.nonDraftCreateContext);Promise.all([o.oViewRenderedPromise,o.viewRegistered]).then(V.bind(null,true));}else{var D1=z1.getElementBinding();if(D1){if(l===i){if(D1.isSuspended()){D1.resume();M();}if(I){S();}o.oApplication.getBusyHelper().getUnbusy().then(V.bind(null,y1&&o.routingSpec.noOData));if(!x1){y();}if(!x1&&!m1()){A1.setProperty("/editable",false);}A1.setProperty("/enabled",true);return;}else if(!x1){U();}}A1.setProperty("/enabled",false);A1.setProperty("/editable",false);A1.setProperty("/createMode",false);R(i);y();}}function Z(i,x1){return m1()?null:o.oTemplateContract.oNavigationControllerProxy.navigateForNonDraftCreate(i,x1);}function $(i,x1){n=x1;o.oTemplateContract.oNavigationControllerProxy.adaptUrlAfterNonDraftCreateSaved(i);}function _(){var i=c.getComponentContainer().getElementBinding();if(i){c.getModel().invalidateEntry(i.getBoundContext());if(i.isSuspended()){U();}else{i.refresh(true);}}}function a1(i){i=i||c.getIsRefreshRequired();if(i||!a(o.mRefreshInfos)){(o.methods.refreshBinding||Function.prototype)(i,o.mRefreshInfos);c.setIsRefreshRequired(false);o.mRefreshInfos=Object.create(null);}V(i);}function b1(){var i=c.getModel();var x1={canonicalRequest:!o.oTemplateContract.bCreateRequestsCanonical,batchGroupId:"facets"};i.read(l,x1);}function c1(i){if(m1()){var x1=c.getComponentContainer();var y1=x1.getElementBinding();if(y1&&!y1.isSuspended()){y1.suspend();i.catch(function(){y1.resume();});}}}function d1(){var i=c.getComponentContainer();if(o.nonDraftCreateContext){i.setBindingContext();delete o.nonDraftCreateContext;return;}var x1=i.getElementBinding();if(x1&&!x1.isSuspended()){if(o.oTemplateContract.oValidationMessageBinding.getLength()){U();}else{x1.suspend();}G();}}function e1(i){var x1=p();return o.oApplication.registerContext(i,x1,c.getEntitySet());}function f1(){return o.oApplication.getBreadCrumbInfo(c.getEntitySet());}function g1(){return o.oApplication.getCurrentKeys(p());}function h1(i){return o.oApplication.getCommunicationObject(c,i);}function i1(i,x1,y1,z1){o.oTemplateContract.oNavigationControllerProxy.navigateToChild(t,i,y1,x1,z1);}function j1(i,x1,y1){o.oTemplateContract.oNavigationControllerProxy.navigateFromNodeAccordingToContext(t,i,x1,y1);}function k1(){var i=c.getEntitySet();var t=o.oTemplateContract.mEntityTree[i];return t.headerTitle;}function l1(i){o.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function m1(){if(k===undefined){var i=c.getEntitySet();var t=o.oTemplateContract.mEntityTree[i];k=!!(t&&t.isDraft);}return k;}function n1(){if(m1()){var i=o.oApplication.getHierarchySectionsFromCurrentHash();return"/"+i[0];}}function o1(){return!(o.routingSpec&&o.routingSpec.noOData);}function p1(){return h;}function q1(){return o.oTemplateContract.oPaginatorInfo[p()-1];}function r1(i,x1){var y1=p();if(!x1){y1--;}o.oTemplateContract.oPaginatorInfo[y1]=i;}function s1(i,x1){o.reuseComponentsReady.then(function(y1){var z1=x1.getComponentInstance();for(var A1 in y1){if(z1===y1[A1].component){var B1=m();B1.setProperty("/generic/embeddedComponents/"+A1+"/isInVisibleArea",i);return;}}});}function t1(i){i.oStatePreserverPromise=o.reuseComponentsReady.then(function(x1){var y1={appStateName:encodeURI("sap-iapp-state-"+t.entitySet),getCurrentState:function(){var A1=i.getCurrentState?i.getCurrentState():Object.create(null);var B1=function(C1,D1){if(C1.component.stGetCurrentState){var E1=C1.component.stGetCurrentState();for(var F1 in E1){A1["$embeddedComponent$"+D1.length+"$"+D1+"$"+F1]=E1[F1];}}};W(x1,B1);return A1;},applyState:function(A1,B1){var C1=Object.create(null);var D1=Object.create(null);for(var E1 in A1){if(E1.indexOf("$embeddedComponent$")===0){var F1=E1.substring(19);var G1=F1.indexOf("$");var H1=Number(F1.substring(0,G1));var I1=F1.substring(G1+1,G1+H1+1);var J1=D1[I1];if(!J1){J1=Object.create(null);D1[I1]=J1;}var K1=F1.substring(G1+H1+2);J1[K1]=A1[E1];}else{C1[E1]=A1[E1];}}(i.applyState||Function.prototype)(C1,B1);var L1=function(M1,N1){if(M1.component.stApplyState){M1.component.stApplyState(D1[N1]||Object.create(null),B1);}};Promise.all([o.oViewRenderedPromise,h]).then(W.bind(null,x1,L1));},oComponent:c};var z1=o.oApplication.getStatePreserver(y1);o.oApplication.registerStateChanger(z1.getAsStateChanger());return z1;});o.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([o.oTemplateContract.oStatePreserversAvailablePromise,i.oStatePreserverPromise]);}function u1(){var i=o.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:Function.prototype,isListAndFirstEntryLoadedOnStartup:t.level?null:Function.prototype,isNextObjectLoadedAfterDelete:Function.prototype};}function v1(){return t.page.component.settings||{};}function w1(i){o.aUnsavedDataCheckFunctions=o.aUnsavedDataCheckFunctions||[];o.aUnsavedDataCheckFunctions.push(i);}return{getBusyHelper:function(){return o.oApplication.getBusyHelper();},attach:function(i,x1,y1){u(v(i),x1,y1);},detach:function(i,x1,y1){D(v(i),x1,y1);},fire:function(i,x1,y1){F(v(i),x1,y1);},isListReportTemplate:function(){return A.isListReportTemplate(o.routeConfig);},getPreprocessorsData:q,getRootExpand:r,getParameterModelForTemplating:s,bindComponent:Y,getNonDraftCreatePromise:Z,adaptUrlAfterNonDraftCreateSaved:$,refreshBinding:a1,refreshBindingUnconditional:_,suspendBinding:d1,messagesRefresh:b1,getTemplatePrivateModel:m,registerContext:e1,getViewLevel:p,getBreadCrumbInfo:f1,getCurrentKeys:g1,getDraftRootPath:n1,getCommunicationObject:h1,navigateRoute:i1,navigateAccordingToContext:j1,getTitleFromTreeNode:k1,setText:l1,onBeforeDraftTransfer:c1,isDraftEnabled:m1,isODataBased:o1,isComponentActive:w,navigateToDataLoadedFailedPage:K,getHeaderDataAvailablePromise:p1,getPaginatorInfo:q1,setPaginatorInfo:r1,onVisibilityChangeOfReuseComponent:s1,getNavigationFinishedPromise:x,setStatePreserverPromise:t1,unbind:U,getFclProxy:u1,getSettings:v1,registerUnsavedDataCheckFunction:w1};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(c,o){e(this,g(c,o));}});});
