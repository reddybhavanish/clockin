sap.ui.define(["sap/ui/base/Object","sap/base/util/extend"],function(B,e){"use strict";function g(a){var p={};var P=[];function c(C){var D=a.getTransactionController().getDraftController();var i=D.getDraftContext();var u=C.getObject();var I=i.hasDraft(C);var v=I&&!u.IsActiveEntity;var w=v&&!u.HasActiveEntity;var x=false;var O=u.HasDraftEntity?C.getObject("DraftAdministrativeData/DraftIsCreatedByMe"):false;if(u.DraftEntityCreationDateTime&&u.DraftEntityLastChangeDateTime){x=u.DraftEntityCreationDateTime.getTime()!==u.DraftEntityLastChangeDateTime.getTime();}return{bIsDraft:v,bIsDraftSupported:I,bIsCreate:w,bIsDraftModified:x,bOwnDraftExists:O};}function r(C,v,E){var u=C.getPath();var w=c(C);if(v===1&&!w.bIsCreate){P.push(u);}var S=null;if(w.bIsDraftSupported&&!w.bIsCreate){var M=C.getModel();var x=M.getMetaModel();var y=x.getODataEntitySet(E);var z=y&&x.getODataEntityType(y.entityType);var D=z&&z["com.sap.vocabularies.Common.v1.SemanticKey"];if(D){S=[];for(var i=0;i<D.length;i++){S.push(C.getProperty(D[i].PropertyPath));}}}var F=e(p[u]||{},{oContextInfo:w,oContext:C,aSemanticKeysValues:S});delete F.oRemovalPromise;p[u]=F;if(w.bIsDraft&&!w.bIsCreate){p[u].bReplaceByActive=false;}else if(w.bOwnDraftExists&&!w.bIsCreate){if(p[u].oEditingPromise){p[u].oEditingPromise.then(function(G){var H=G.context.getPath();p[H].bReplaceByActive=true;});}else{m(C).then(function(G){var H=G.getPath();var I=p[H];if(I){p[H].bReplaceByActive=true;}});}}return w;}function b(){for(var i=P.length-1;i>=0;i--){var C=p[P[i]].oContext;if(C){return P[i];}}}function d(C){var i=C.getPath();var R=p[i];return R;}function f(C,R,i){var u=d(C);if(!u.oContextInfo.bIsCreate||!i){u.oRemovalPromise=R;}R.then(function(v){if(!u.oContextInfo.bIsCreate||!i){var D=v.context.getPath();var w=p[D];if(w){delete w.oEditingPromise;w.oContextInfo.bOwnDraftExists=false;}}u.oContext=null;},function(){delete u.oRemovalPromise;});}function h(C,i){f(C,i,false);}function j(C,i){f(C,i,true);}function k(C,E){var i=d(C);i.oEditingPromise=new Promise(function(R,u){var N=function(){delete i.oEditingPromise;i.oContextInfo.bOwnDraftExists=false;u();};E.then(function(v){if(v.draftAdministrativeData){N();}else{i.oContextInfo.bOwnDraftExists=true;var w=v.context.getPath();p[w]={sActiveContextPath:C.getPath(),oContextInfo:{bIsDraft:true,bIsDraftSupported:true,bIsCreate:false,bIsDraftModified:false,bOwnDraftExists:false}};R(v);}},N);});i.oEditingPromise.catch(Function.prototype);}function A(i){var C=p[i];if(C){C.oContext=null;}}function l(M,i){return new Promise(function(R,u){M.read(i+"/SiblingEntity",{success:function(v){if(v){var w=M.getContext("/"+M.getKey(v));R(w);}else{u();}},error:function(E){u(E);}});});}function m(C){var i=d(C);if(i.oContextInfo.bIsCreate){return Promise.resolve();}else if(i.sActiveContextPath){var u=p[i.sActiveContextPath];return Promise.resolve(u.oContext);}var S=i.oSiblingPromise;if(!S){S=i.oContextInfo.bIsDraftSupported?l(C.getModel(),C.getPath()):Promise.resolve(C);if(i.oContextInfo.bIsDraft||!i.oContextInfo.bIsDraftSupported){i.oSiblingPromise=S;}}return S;}function n(C){var i=p[C];return i?m(i.oContext):l(a.getModel(),C);}function o(i){var C=p[i];if(!C){return Promise.resolve();}return new Promise(function(R){var u=null;var v=function(){R(u);};var H=function(E){E.then(function(w){var x=w.context.getPath();var y=p[x];if(y&&y.oContext&&!y.bReplaceByActive){u={context:w.context,iDisplayMode:2};}v();},v);};if(C.oRemovalPromise){C.oRemovalPromise.then(function(w){u={context:w.context,iDisplayMode:1};var D=w.context.getPath();var x=p[D];var E=x&&x.oEditingPromise;if(E){H(E);}else{v();}},v);}else if(C.bReplaceByActive){m(C.oContext).then(function(w){u={context:w,iDisplayMode:1};v();});}else if(C.oContextInfo&&!C.oContextInfo.bIsDraft&&C.oContextInfo.bOwnDraftExists){if(C.oEditingPromise){H(C.oEditingPromise);}else{m(C.oContext).then(function(D){var w=D.getPath();var E=p[w];if(E&&E.oContext&&!E.bReplaceByActive){u={context:D,iDisplayMode:2};}v();});}}else{v();}});}function q(u,v,I){return new Promise(function(R,w){if(u===v){R(true);return;}if(!u||!v){R(false);return;}var C=p[u];if(!C||!C.oContextInfo.bIsDraftSupported){R(false);return;}var x=p[v];if(!x||!x.oContextInfo){R(false);return;}if(!C.oContextInfo.bIsDraft&&!x.oContextInfo.bIsDraft){R(false);return;}if(C.oContextInfo.bIsCreate&&x.oContextInfo.bIsCreate){R(false);return;}if(I){o(u).then(function(z){R(!!z&&z.context.getPath()===v);},w);return;}if(C.aSemanticKeysValues){var y=!!x.aSemanticKeysValues;for(var i=0;y&&i<C.aSemanticKeysValues.length;i++){y=C.aSemanticKeysValues[i]===x.aSemanticKeysValues[i];}R(y);return;}R(false);});}function s(i){return p[i].oContextInfo.bIsDraftModified;}function t(i){if(p[i]){p[i].oContextInfo.bIsDraftModified=true;}}return{registerContext:r,adaptAfterObjectDeleted:A,activationStarted:h,cancellationStarted:j,editingStarted:k,getDraftSiblingPromise:m,getSiblingPromise:n,getAlternativeContextPromise:o,getPathOfLastShownDraftRoot:b,areTwoKnownPathesIdentical:q,markDraftAsModified:t,getIsDraftModified:s};}return B.extend("sap.suite.ui.generic.template.lib.ContextBookkeeping",{constructor:function(a){e(this,g(a));}});});
