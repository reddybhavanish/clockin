sap.ui.define(["sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library","sap/base/util/extend"],function(B,F,f,e){"use strict";var L=f.LayoutType;var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return c[i]?i:d;}function g(i){return c[t(i)]+"ColumnPages";}function a(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function b(v){return m[t(v)];}function h(i){return c[t(i)];}function j(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function k(T){var i=j(T);var R=i?i[0]:false;return R;}function l(s){return(s&&(Array.isArray(s.FCLLayout)?s.FCLLayout.sort()[0]:s.FCLLayout))||"";}function n(o,N){var T=N.oTemplateContract;var p=T.oAppComponent.getFlexibleColumnLayout();var q=F.getInstanceFor(o,p);var u;var C;var s;var M=sap.ui.Device.system.phone?1:(p.maxColumnsCount||3);var v=M>1&&p.initialColumnsCount===2;var D=(function(){var i=q.getDefaultLayouts();return[v?i.defaultTwoColumnLayoutType:i.defaultLayoutType,i.defaultTwoColumnLayoutType,i.defaultThreeColumnLayoutType];})();var w=p.displayNextObjectAfterDelete===true;function x(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&v);}function y(i){if(i.fCLLevel===3||(i.fCLLevel===0&&i.level>0)){return 1;}var s1=p.initialColumnsCount||1;var t1=Math.max(i.fCLLevel+1,s1);return sap.ui.Device.system.tablet&&t1>2?2:t1;}function A(i,s1,t1,u1){var v1=y(u1);i.showBeginColumn=u1.fCLLevel===0||v1>1;i.showMidColumn=u1.fCLLevel===1||v1>1;i.showEndColumn=u1.fCLLevel>1;if(v1===1){i.target=s1;}else if(u1.level===0){i.target=[s1,i.pages[0].entitySet];}else{i.target=t1.concat([s1]);}return g(u1.fCLLevel);}function z(i,s1){if(i===L.OneColumn&&v){return false;}var t1=s1&&T.mRoutingTree[s1];var u1=t1&&t1.defaultLayoutTypeIfExternalNavigation;if(N.isExternalNav()&&u1){return i===u1;}var v1=t1&&t1.defaultLayoutType;if(v1){return i===v1;}return i===D[0]||i===D[1]||i===D[2];}function E(i,s1,t1){var u1=T.mRouteToTemplateComponentPromise[t1];if(u1){return u1.then(function(v1){return N.activateOneComponent(s1,i,v1);});}return r;}function G(i){var s1=N.getCurrentIdentity();if(!s1){return null;}var t1={};var u1=true;for(var v1=s1.treeNode;u1;v1=T.mRoutingTree[v1.parentRoute]){var w1=v1.fCLLevel;var x1=h(w1);t1[x1]={route:v1.sRouteName,path:i?"-":v1.getPath(2,s1.keys),isVisible:w1>2||u.columnsVisibility[x1+"Column"]};u1=w1===1||w1===2;i=false;}return t1;}function H(i,s1){var t1=G(i.isNonDraftCreate);if(!t1){return Promise.resolve();}var u1=[];s1=s1||t1;for(var v1 in s1){var w1=t1[v1];if(w1.isVisible){u1.push(E(i,w1.path,w1.route));}else{var x1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var y1=T.mRoutingTree[w1.route];var z1=(x1===y1.level)?2:(3+V(C));N.setVisibilityOfRoute(w1.route,z1);}}return Promise.all(u1).then(N.afterActivation);}function I(i){var s1=N.getActivationInfo();H(s1,i);}function J(){return!(u.columnsVisibility.beginColumn?u.columnsVisibility.midColumn:u.columnsVisibility.midColumn&&u.columnsVisibility.endColumn);}function K(i){if(!u&&!i){return;}var s1=q.getCurrentUIState();var t1={};t1.end=u&&(u.columnsVisibility.endColumn!==s1.columnsVisibility.endColumn);t1.mid=u&&(u.columnsVisibility.midColumn!==s1.columnsVisibility.midColumn);t1.begin=u&&(u.columnsVisibility.beginColumn!==s1.columnsVisibility.beginColumn);u=s1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:u.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:u.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.endColumn.closeColumn!==null});var u1=N.getCurrentIdentity();var v1=u1&&u1.treeNode;if(u1){var w1=J();var x1=v1.level-(v1.fCLLevel===2&&!u.columnsVisibility.endColumn);var y1=x1-(x1>1&&!w1)-(u.columnsVisibility.endColumn&&u.columnsVisibility.beginColumn&&x1>2);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",w1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",x1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",y1);}if(u1&&C!==u.layout){var z1=z(u.layout,v1.sRouteName)?null:u.layout;N.navigateByExchangingQueryParam("FCLLayout",z1);}else if((t1.begin||t1.mid||t1.end)&&!i){I(t1);}}var S=false;function O(i){var s1=function(){if(x(i.treeNode)){C=R(i);if(!C){switch(i.treeNode.fCLLevel){case 0:var t1=q.getNextUIState(0).columnsVisibility;if(t1.midColumn){C=D[1];}else{C=D[0];N.navigateByExchangingQueryParam("FCLLayout",C);}break;case 1:C=D[1];break;case 2:C=D[2];break;default:}}}else{C=i.treeNode.fCLLevel===0?D[0]:L.EndColumnFullScreen;}o.setLayout(C);if(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2){var u1=q.getCurrentUIState();if(u1.columnsVisibility.midColumn){var v1=1-u1.columnsVisibility.beginColumn;for(var w1=i.treeNode;w1.fCLLevel>v1;){w1=T.mRoutingTree[w1.parentRoute];i.componentsDisplayed[w1.sRouteName]=1;}}}};if(S){s1();return Promise.resolve();}return q.whenReady().then(function(){S=true;s1();});}function P(i){K(true);return H(i);}function Q(i){return N.isExternalNav()&&i.treeNode.defaultLayoutTypeIfExternalNavigation;}function R(i){return l(i.appStates)||Q(i)||i.treeNode.defaultLayoutType||D[t(i.treeNode.fCLLevel)];}function U(i,s1,t1){if(!z(s1,t1)){i.FCLLayout=s1;}}function V(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function W(i){return i===L.ThreeColumnsBeginExpandedEndHidden||i===L.ThreeColumnsMidExpandedEndHidden;}function X(i,s1,t1,u1){var v1={treeNode:i,keys:s1,appStates:u1};var w1=N.getApplicableStateForIdentityAddedPromise(v1);t1.push(w1);}function Y(i,s1,t1,u1){U(i,t1,s1.sRouteName);var v1=[];if(!W(t1)){X(s1,u1,v1,i);}if(!V(t1)){for(var w1=s1;w1.fCLLevel>0;){w1=T.mRoutingTree[w1.parentRoute];X(w1,u1,v1,i);}}return Promise.all(v1);}function Z(i){return V(C)?a1(i.fCLLevel):(i.defaultLayoutType||q.getNextUIState(i.fCLLevel).layout);}function $(i,s1){var t1=(s1.treeNode.fCLLevel===1&&i&&i.treeNode.parentRoute===s1.treeNode.sRouteName&&i.treeNode.fCLLevel===2)?u.actionButtonsInfo.endColumn.closeColumn:Z(s1.treeNode);return Y(s1.appStates,s1.treeNode,t1,s1.keys);}function _(i,s1,t1){var u1;if(i.treeNode.fCLLevel===s1.treeNode.fCLLevel){u1=C;}else if(i.treeNode.fCLLevel===2){u1=u.actionButtonsInfo.endColumn.closeColumn;}else{u1=Z(s1.treeNode);}return Y(t1,s1.treeNode,u1,s1.keys);}function a1(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function b1(s1,t1){var u1=T.mRoutingTree[s1];if(!x(u1)){return null;}var v1=s||u1.defaultLayoutType||q.getNextUIState(u1.fCLLevel).layout;U(t1,v1,s1);s=null;if(V(v1)){return null;}var w1=[];for(var i=u1.fCLLevel;i>0;i--){var x1=u1.parentRoute;w1.push(N.addUrlParameterInfoForRoute(x1,t1));u1=T.mRoutingTree[x1];}return Promise.all(w1);}function c1(i,s1){if(i.treeNode.fCLLevel===0||i.treeNode.fCLLevel===3){return true;}var t1=R(i);var u1=R(s1);return V(t1)===V(u1);}function d1(i,s1,t1){var u1=function(){T.oApplicationProxy.performAfterSideEffectExecution(function(){var v1=h(i.fCLLevel);var w1=u.actionButtonsInfo[v1+"Column"][s1];var x1=t1?T.mRoutingTree[i.parentRoute]:i;var y1=N.getCurrentIdentity();var z1=Object.create(null);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",0);if(s1==="fullScreen"||s1==="exitFullScreen"){T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",1);}else{T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",0);}var A1=Y(z1,x1,w1,y1.keys);var B1=A1.then(function(){N.navigateToIdentity({treeNode:x1,keys:(x1===y1.treeNode)?y1.keys:y1.keys.slice(0,x1.level+1),appStates:z1});});T.oBusyHelper.setBusy(B1);},true);};if(t1){T.oDataLossHandler.performIfNoDataLoss(u1,Function.prototype);}else{u1();}}function e1(i){return{onCloseColumnPressed:d1.bind(null,i,"closeColumn",true),onFullscreenColumnPressed:d1.bind(null,i,"fullScreen",false),onExitFullscreenColumnPressed:d1.bind(null,i,"exitFullScreen",false)};}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function f1(i){C=q.getNextUIState(i).layout;o.setLayout(C);}function g1(){return!J();}function h1(i,s1){var t1=0;for(var u1 in s1){var v1=T.mRoutingTree[u1];if(v1.level>=i.viewLevel&&s1[u1]===1){if(v1.level===i.viewLevel){t1=v1.fCLLevel;}s1[u1]=5+(v1.level>i.viewLevel);}}f1(t1);var w1=N.oRouter.getTargets();var x1=b(t1);w1.display(x1);}function i1(i,s1){if(!x(s1)){return;}var t1=a1(s1.fCLLevel);if(z(t1,s1.sRouteName)){return;}i.FCLLayout=t1;}function j1(i,s1,t1){if(t1&&t1.appStates&&t1.appStates.FCLLayout){i.FCLLayout=t1.appStates.FCLLayout;}else{delete i.FCLLayout;}}function k1(i){return i.treeNode.fCLLevel!==0&&i.treeNode.fCLLevel!==3&&!V(R(i));}function l1(){return M;}function m1(i,s1){if(!v){return;}var t1=false;var u1=q.getNextUIState(0).columnsVisibility;if(u1.midColumn){var v1=N.getCurrentIdentity();var w1=v1&&v1.treeNode;t1=w1&&w1.level===0&&l(v1.appStates)!==L.OneColumn;}if(t1){if(i){s1(i);}else{N.navigateByExchangingQueryParam("FCLLayout",L.OneColumn);}}}function n1(){return w;}function o1(){return v;}function p1(i,s1){var t1=k(i);m1(t1,s1);}function q1(i){if(i>2){s="";}else{s=a1(i);}}function r1(i){var s1={};if(i.fCLLevel===1||i.fCLLevel===2){s1.oActionButtonHandlers=e1(i);}if(i.level===0){s1.handleDataReceived=(o1&&o1())?p1:Function.prototype;s1.isListAndFirstEntryLoadedOnStartup=o1;}s1.isNextObjectLoadedAfterDelete=n1;return s1;}o.attachStateChange(K.bind(null,false));return{adaptRoutingInfo:A,createMessagePageTargets:a,displayMessagePage:h1,handleBeforeRouteMatched:O,handleRouteMatched:P,areIdentitiesLayoutEquivalent:c1,getAppStatesPromiseForNavigation:$,getSpecialDraftCancelPromise:_,getFCLAppStatesPromise:b1,adaptBreadCrumbUrlParameters:i1,adaptPreferredLayout:j1,isAppTitlePrefered:g1,hasNavigationMenuSelfLink:k1,getMaxColumnCountInFCL:l1,isNextObjectLoadedAfterDelete:n1,getFclProxy:r1,isListAndFirstEntryLoadedOnStartup:o1,setStoredTargetLayoutToFullscreen:q1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(o,N){e(this,n(o,N));}});});
