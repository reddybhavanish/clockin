sap.ui.define(["sap/ui/base/Object","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/testableHelper",'sap/ui/core/Element',"sap/base/util/extend"],function(B,M,a,F,b,c,t,E,e){"use strict";F=t.observableConstructor(F,true);var p=new F({path:"persistent",operator:b.EQ,value1:false});var s=new F({path:"technical",operator:b.EQ,value1:false});var v=new F({path:"validation",operator:b.EQ,value1:true});var I=new F({filters:[v,new F({path:"validation",operator:b.EQ,value1:false})],and:true});function g(T,h,d){var C=h.controller;var u=C.getOwnerComponent().getModel("ui");var m=C.byId("showMessages");var f=T.oComponentUtils.isDraftEnabled();var A=false;var o;function j(i){return!!(i&&T.oCommonUtils.getPositionableControlId(i));}function k(i){if(h.getGroupTitle){return h.getGroupTitle(i);}return"";}var l;var n=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.fragments.MessagePopover",{beforeOpen:function(){var X=l.getCurrentContexts();if(h.prepareAllMessagesForNavigation){for(var i=0;i<X.length;i++){var Y=X[i].getObject();if(!j(Y.controlIds)){h.prepareAllMessagesForNavigation();return;}}}},isPositionable:j,getGroupTitle:k,titlePressed:function(i){c.navigateFromMessageTitleEvent(T.oCommonUtils,i,C);}});n.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");n.setGroupItems(true);l=n.getBinding("items");var q;(function(){var i=C.getOwnerComponent();q=new F({path:"target",operator:b.EQ,value1:"/"+i.getEntitySet()});var X=i.getModel("_templPriv");X.setProperty("/generic/messageCount",0);var Y=T.oCommonUtils.getText("MESSAGE_BUTTON_TOOLTIP_P",0);X.setProperty("/generic/messageButtonTooltip",Y);l.attachChange(function(){var Z=l.getLength();X.setProperty("/generic/messageCount",Z);Y=T.oCommonUtils.getText(Z===1?"MESSAGE_BUTTON_TOOLTIP_S":"MESSAGE_BUTTON_TOOLTIP_P",Z);X.setProperty("/generic/messageButtonTooltip",Y);});})();var L=new F({filters:[v,new F({path:"controlIds",test:function(i){return!!T.oCommonUtils.getPositionableControlId(i);},caseSensitive:true})],and:true});var r=[];var w;var x=0;var N;var y;var z;function D(X){if(Array.isArray(X)){var Y=false;for(var i=0;i<X.length;i++){Y=D(X[i])||Y;}return Y;}if(X instanceof Promise){X.then(N);return false;}z.push(X);return true;}function G(i){y=i;l.filter(y);}function H(){if(A){o=new F({filters:z,and:false});var i=[o,p];if(T.oServices.oApplication.needsToSuppressTechnicalStateMessages()){i.push(s);}var X=new F({filters:i,and:true});G(new F({filters:[X,L],and:false}));if(h.messageSorter){l.sort(h.messageSorter);}}}function R(i,X){if(i===x&&D(X)){H();}}function J(i){var X=i();return D(X);}function K(){r.forEach(J);}function O(i){w=i;x++;N=R.bind(null,x);var X=d&&!f&&u.getProperty("/createMode");z=d?[new F({path:X?"target":"fullTarget",operator:b.StartsWith,value1:w}),q]:[];K();H();}function P(i){r.push(i);if(w!==undefined&&J(i)){H();}}var S;function Q(){S=S||function(){if(l.getLength()>0){n.openBy(m);}};setTimeout(S,0);}function U(i){A=i;if(i){if(z){H();}}else{z=null;G(I);}}function V(i){return i?L:y;}function W(){return o;}return{adaptToContext:O,toggleMessagePopover:n.toggle.bind(n,m),showMessagePopover:Q,registerMessageFilterProvider:P,setEnabled:U,getMessageFilters:V,getContextFilter:W};}return B.extend("sap.suite.ui.generic.template.lib.MessageButtonHelper",{constructor:function(T,h,i){e(this,(t.testableStatic(g,"MessageButtonHelper"))(T,h,i));}});});
