/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/core/library","sap/ui/comp/library","./JSONControlFactory","./ODataControlFactory","./BindingUtil","./SideEffectUtil","./ODataHelper","sap/ui/core/Control","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/base/strings/capitalize","sap/base/Log"],function(C,c,l,J,O,B,S,a,b,P,V,d,e,f,L){"use strict";var g=c.ValueState;var T=l.smartfield.TextInEditModeSource;var h=c.TextAlign;var k=l.smartfield.ControlContextType;var m=l.smartfield.ControlProposalType;var n=b.extend("sap.ui.comp.smartfield.SmartField",{metadata:{interfaces:["sap.ui.core.IFormContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartfield/SmartField.designtime",properties:{value:{type:"any",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Misc",defaultValue:true},entitySet:{type:"string",group:"Misc",defaultValue:""},editable:{type:"boolean",group:"Misc",defaultValue:true},contextEditable:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:""},textAlign:{type:"sap.ui.core.TextAlign",group:"Misc",defaultValue:h.Initial},placeholder:{type:"string",group:"Misc",defaultValue:""},name:{type:"string",group:"Misc",defaultValue:""},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:g.None},valueStateText:{type:"string",group:"Appearance",defaultValue:""},showValueStateMessage:{type:"boolean",group:"Appearance",defaultValue:true},jsontype:{type:"sap.ui.comp.smartfield.JSONType",group:"Misc",defaultValue:null},mandatory:{type:"boolean",group:"Misc",defaultValue:false},maxLength:{type:"int",group:"Misc",defaultValue:0},showSuggestion:{type:"boolean",group:"Misc",defaultValue:true},showValueHelp:{type:"boolean",group:"Misc",defaultValue:true},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},textLabel:{type:"string",group:"Misc",defaultValue:""},tooltipLabel:{type:"string",group:"Misc",defaultValue:""},uomVisible:{type:"boolean",group:"Misc",defaultValue:true},uomEditable:{type:"boolean",group:"Misc",defaultValue:true},uomEnabled:{type:"boolean",group:"Misc",defaultValue:true},url:{type:"string",group:"Misc",defaultValue:""},uomEditState:{type:"int",group:"Misc",defaultValue:-1},controlContext:{type:"sap.ui.comp.smartfield.ControlContextType",group:"Misc",defaultValue:k.None},proposedControl:{type:"sap.ui.comp.smartfield.ControlProposalType",group:"Misc",defaultValue:m.None},wrapping:{type:"boolean",group:"Misc",defaultValue:true},clientSideMandatoryCheck:{type:"boolean",group:"Misc",defaultValue:true},fetchValueListReadOnly:{type:"boolean",group:"Misc",defaultValue:true},expandNavigationProperties:{type:"boolean",group:"Behavior",defaultValue:false},textInEditModeSource:{type:"sap.ui.comp.smartfield.TextInEditModeSource",group:"Behavior",defaultValue:T.None}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},configuration:{type:"sap.ui.comp.smartfield.Configuration",multiple:false},controlProposal:{type:"sap.ui.comp.smartfield.ControlProposal",multiple:false},_ariaLabelInvisibleText:{type:"sap.ui.core.InvisibleText",multiple:true,visibility:"hidden"},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{entitySetFound:{parameters:{entitySet:{type:"string"}}},change:{parameters:{value:{type:"string"},newValue:{type:"string"}}},changeModelValue:{parameters:{unitChanged:{type:"boolean"},unitLastValueState:{type:"sap.ui.core.ValueState"}}},initialise:{},visibleChanged:{parameters:{visible:{type:"boolean"}}},editableChanged:{parameters:{editable:{type:"boolean"}}},contextEditableChanged:{parameters:{editable:{type:"boolean"}}},innerControlsCreated:{},valueListChanged:{parameters:{changes:{type:"sap.ui.core.Control[]"}}},press:{}}},renderer:{apiVersion:2,render:function(r,o){var i,I,j,p=o.getContent();r.openStart("div",o);r.class("sapUiCompSmartField");r.openEnd();if(p&&o.getMode()==="display"&&o.isFormContextType()){I=o.getInnerControls();for(i=0;i<I.length;i++){j=I[i];if(j.isA("sap.m.Text")&&j.getText()===""||j.isA("sap.ui.comp.smartfield.DisplayComboBox")&&j.getSelectedKey()===""){r.openStart("span");r.class("sapUiPseudoInvisibleText");r.openEnd();r.text(C.getLibraryResourceBundle("sap.ui.comp").getText("NO_VALUE"));r.close("span");r.openStart("span");r.attr("aria-hidden","true");r.class("sapMText");r.class("sapUiSelectable");r.class("sapMTextMaxWidth");r.class("sapUiCompSmartFieldValue");r.class("sapUiCompEmptyValue");r.openEnd();r.close("span");break;}}}r.renderControl(p);if(o.getAggregation("_ariaLabelInvisibleText")){o.getAggregation("_ariaLabelInvisibleText").forEach(function(q){r.renderControl(q);});}r.close("div");}}});n.prototype.init=function(){this._sAnnotationLabel="";this._bInDestroy=false;this._oSideEffects=new S(this);this._oFactory=null;this._oControl={display:null,"display_uom":null,edit:null,current:null};this._oValue={display:null,edit:null,uom:null,uomset:null};this._oError={bComplex:false,bFirst:false,bSecond:false};this._sBindingContextPath="";this._oUtil=new B();this._bSuppressToggleControl=false;};n.prototype.setVisible=function(v,s){var o=this.getVisible();b.prototype.setVisible.apply(this,arguments);v=this.getVisible();if(v!==o){this.fireVisibleChanged({visible:v});}return this;};n.prototype.getComputedTextLabel=function(){return this.getProperty("textLabel")||this._sAnnotationLabel;};n.prototype.setEditable=function(E){return this.setEditableProperty("editable",E,true);};n.prototype.setContextEditable=function(i){return this.setEditableProperty("contextEditable",i,true);};n.prototype.setEditableProperty=function(p,E,s){var i=f(p),G=this["get"+i].bind(this),o=G();this.setProperty(p,E,s);E=G();this._bPendingEditableState=false;var j=E!==o,M=this.isPropertyBeingUpdatedByModel(p);if((j&&!M)||(j&&M&&this._boundEntityExists())||!this._oControl[this.getMode()]){this._toggleInnerControlIfRequired();}if(j){var q="fire"+i+"Changed";this[q]({editable:E});}return this;};n.prototype.isPropertyBeingUpdatedByModel=function(p){var o=this.getBindingInfo(p);return!!(o&&o.skipModelUpdate);};n.prototype._boundEntityExists=function(v){v=v||this.getBindingContext();return!!(v&&v.getObject());};n.prototype.setUomEditable=function(u){this.setProperty("uomEditable",u,true);var U=this._getEmbeddedSmartField();if(U){U.setEditable(this.getUomProperty("editable"));}return this;};n.prototype.setUomEnabled=function(u){this.setProperty("uomEnabled",u,true);var U=this._getEmbeddedSmartField();if(U){U.setEnabled(this.getUomEnabled());}return this;};n.prototype.setUomVisible=function(u){this.setProperty("uomVisible",u,true);var U=this._getEmbeddedSmartField();if(U){u=this.getUomProperty("visible");U.setVisible(u);var M=this._oFactory&&this._oFactory.oMeasureField;if(M){M.toggleStyleClass("smartFieldPaddingRight",u);}}return this;};n.prototype.setMandatory=function(M){this.setProperty("mandatory",M,false);this._setPropertyOnControls("required",this.getMandatory());return this;};n.prototype.setWidth=function(w){this.setProperty("width",w,true);this._setOnInnerControl();return this;};n.prototype.setWrapping=function(w){this.setProperty("wrapping",w,true);this._setOnInnerControl();return this;};n.prototype.setTextAlign=function(t){this.setProperty("textAlign",t,true);this._setOnInnerControl();return this;};n.prototype.setPlaceholder=function(p){this.setProperty("placeholder",p,true);this._setOnInnerControl();return this;};n.prototype.setName=function(N){this.setProperty("name",N,true);this._setOnInnerControl();return this;};n.prototype.setMaxLength=function(M){this.setProperty("maxLength",M,true);this._setOnInnerControl();return this;};n.prototype.setShowValueHelp=function(v){var p=this.getShowValueHelp();this.setProperty("showValueHelp",v,true);var o=this.getContent();if(o&&(typeof o.setShowValueHelp==="function")){v=this.getShowValueHelp();var i=v!==p,F=this._oFactory;if(i&&F){if(v){if(F.shouldCreateValueHelpForControl(o)){F._createValueHelp();}}else{F.destroyValueHelp();}}o.setShowValueHelp(v);}return this;};n.prototype.setShowSuggestion=function(s){var p=this.getShowSuggestion();this.setProperty("showSuggestion",s,true);var o=this.getContent();if(o&&(typeof o.setShowSuggestion==="function")){s=this.getShowSuggestion();var i=s!==p,F=this._oFactory;if(i&&F){if(s){if(F.shouldCreateValueHelpForControl(o)){F._createValueHelp();}}else{F.destroyValueHelp();}}o.setShowSuggestion(s);}return this;};n.prototype.setConfiguration=function(o){var i=this.getConfiguration(),r=this.setAggregation("configuration",o,true);o=this.getConfiguration();var j=!!((o&&(i===null))||(i&&(o===null))),H=!!this.getContent();if(H&&(j||(o&&i&&((o.getControlType()!==i.getControlType())||(o.getDisplayBehaviour()!==i.getDisplayBehaviour()))))){this._destroyControls();this._toggleInnerControlIfRequired();}return r;};n.prototype.setTextInEditModeSource=function(t){var o=this.getTextInEditModeSource();this.setProperty("textInEditModeSource",t,false);t=this.getTextInEditModeSource();if(t!==o){this._destroyControls();this._toggleInnerControlIfRequired();}return this;};n.prototype.setTooltip=function(t){this._refreshTooltipBaseDelegate(t);this.setAggregation("tooltip",t,true);var o=this.getFirstInnerControl();if(o){o.setTooltip(t);}return this;};n.prototype._setOnInnerControl=function(){var o=this.getContent();if(o){if(typeof o.setWidth==="function"){var w=this.getWidth();if(w){o.setWidth(w);}}this._setPropertyOnControls("wrapping",this.getWrapping());if(typeof o.setName==="function"){o.setName(this.getName());}if(typeof o.setPlaceholder==="function"&&this.getPlaceholder()!==""){o.setPlaceholder(this.getPlaceholder());}if(typeof o.setTextAlign==="function"){o.setTextAlign(this.getTextAlign());}this._setPropertyOnControls("required",this.getMandatory());var u=this._getEmbeddedSmartField();if(u){if(!this.isPropertyInitial("uomEditable")){u.setEditable(this.getUomProperty("editable"));}if(!this.isPropertyInitial("uomEnabled")){u.setEnabled(this.getUomEnabled());}if(!this.isPropertyInitial("uomVisible")){u.setVisible(this.getUomProperty("visible"));}}}return this;};n.prototype.getUomProperty=function(p){var u=this._getEmbeddedSmartField(),U=u&&u.getControlFactory(),o=U&&U._oFieldControl,s=f(p),i="getUom"+s,j=this[i]();if(u.isBound(p)&&o){var q=U.getMetaData();if(q){var r=o._oStoredBindings[p],t=o["_get"+s](q,r,p);t.path();var v=t.formatter.call(u,j);return v;}}return j;};n.prototype._setPropertyOnControls=function(p,v,i){i=i||this.getInnerControls();i.forEach(function(o){var M="set"+f(p);if(typeof o[M]==="function"){o[M](this._convertValueForControl(p,v,o));}},this);};n.prototype._convertValueForControl=function(p,v,o){var i;if(o){i=o.getMetadata().getProperty(p);}if(i){switch(p){case"wrapping":switch(i.type){case"boolean":return v;case"sap.ui.core.Wrapping":var w=c.Wrapping;if(v){return w.Soft;}return w.None;}}}return v;};n.prototype.setUrl=function(v){this.setProperty("url",v,true);return this;};n.prototype.setEntitySet=function(v){this.setProperty("entitySet",v,true);this.fireEntitySetFound({entitySet:v});return this;};n.prototype._setPendingEditState=function(D){this.data("pendingEditableState",!D);};n.prototype.applySettings=function(s){if(s&&s.customData){for(var i=0;i<s.customData.length;i++){var o=s.customData[i];if(o&&o.mProperties&&o.mProperties.key==="pendingEditableState"){this._bPendingEditableState=o.mProperties.value;}}}return b.prototype.applySettings.apply(this,arguments);};n.prototype.setEnabled=function(v){this.setProperty("enabled",v,true);this._toggleInnerControlIfRequired();return this;};n.prototype.setContent=function(v){return this.setAggregation("_content",v);};n.prototype.getContent=function(){return this.getAggregation("_content");};n.prototype.getControlFactory=function(){return this._oFactory;};n.prototype.getValue=function(){var p=this.getInnerValueFunction();if(p){return p();}return this.getProperty("value");};n.prototype.getInnerValueFunction=function(){if(this._oValue&&(typeof this._oValue[this.getMode()]==="function")){return this._oValue[this.getMode()];}return null;};n.prototype.getValueState=function(){var i=this.getInnerControls(),I=this._getMaxSeverity(i);if(I>-1){return i[I].getValueState();}return g.None;};n.prototype.setValueState=function(v){this.setProperty("valueState",v,true);var i=this.getInnerControls(),o,M="setSimpleClientError";if(i&&i.length){o=i[0];if(i.length>1){M="setComplexClientErrorFirstOperand";}}if(o&&(typeof o.setValueState==="function")){o.setValueState(v);this[M](v===g.Error);}return this;};n.prototype.getValueStateText=function(){var i=this.getInnerControls(),I=this._getMaxSeverity(i);if(I>-1){return i[I].getValueStateText();}return this.getProperty("valueStateText");};n.prototype.setValueStateText=function(t){this.setProperty("valueStateText",t,true);var i=this.getInnerControls(),o;if(i&&i.length){o=i[0];}if(o&&(typeof o.setValueStateText==="function")){o.setValueStateText(t);}return this;};n.prototype._getMaxSeverity=function(j){var s,o,i,p,q=0,I=-1,r={"Error":3,"Warning":2,"Success":1,"None":0};p=j.length;for(i=0;i<p;i++){o=j[i];if(o.getValueState){s=o.getValueState();if(s&&r[s]>q){q=r[s];I=i;}}}return I;};n.prototype.getFocusDomRef=function(){var i=this.getInnerControls(),o,j=i.length;if(j>0){o=i[0];}if(o&&o.getFocusDomRef){return o.getFocusDomRef();}return b.prototype.getFocusDomRef.apply(this,arguments);};n.prototype.getIdForLabel=function(){var i=this.getInnerControls(),o,j=i.length;if(j>0){o=i[0];}if(o&&(typeof o.getIdForLabel==="function")){return o.getIdForLabel();}return this.getId();};n.prototype.updateBindingContext=function(s,F,u){b.prototype.updateBindingContext.apply(this,arguments);if(this._bInDestroy){return;}this._init(F);if(this._oFactory){if(this.getBindingContext()){this._sBindingContextPath=this.getBindingContext().getPath();}if(typeof this._oFactory.bind==="function"){this._oFactory.bind();this._checkFieldGroups();}else{this._toggleInnerControlIfRequired();}}};n.prototype.bindProperty=function(p,o){var i=p==="value";if(!i||this.isPropertyInitial("value")){return b.prototype.bindProperty.apply(this,arguments);}var v=this.getBindingPath("value"),j=this.getBindingContext(),q=j&&j.getPath();b.prototype.bindProperty.apply(this,arguments);var r=this.getBindingPath("value"),s=this.getBindingContext(),t=s&&s.getPath();if((r!==v)||(t!==q)){this._destroyFactory();this._init();var F=this._oFactory;if(F&&(typeof F.bind==="function")){F.bind();}}return this;};n.prototype.unbindProperty=function(p,s){b.prototype.unbindProperty.apply(this,arguments);var i=this.getAllInnerControls();i.forEach(function(I){var j=I.getMetadata().getName();var v=O.getBoundPropertiesMapInfoForControl(j,{propertyName:p});if(Array.isArray(v)){v.forEach(function(o){I.unbindProperty(o,s);});}});return this;};n.prototype.getMode=function(){var E=this.getEditable(),i=this.getEnabled(),j=this.getContextEditable();if(this.getControlContext()==="responsiveTable"&&this.data("suppressUnit")!=="true"){if(!E||!j||!i||(this.getProperty("uomEditState")===0)){return"display_uom";}}if(j&&this.data("configdata")&&this.data("configdata").configdata.isUOM&&this.data("configdata").configdata.isInnerControl&&this.data("configdata").configdata.getContextEditable){j=this.data("configdata").configdata.getContextEditable();}return E&&i&&j?"edit":"display";};n.prototype.isInEditMode=function(){return this.getMode()==="edit";};n.prototype._toggleInnerControlIfRequired=function(){if(this._bPendingEditableState||this._bSuppressToggleControl||(!this._oFactory||this._oFactory.bPending)){return;}var M=this.getMode();if((M==="edit")||(M==="display_uom")){this._createControlIfRequired(M);}else{var v=this.getProperty("value"),i=true;var o=this.data("configdata");if(o&&o.configdata&&!o.configdata.isUOM){if(v===null||v===""){i=false;}}if(i){this._createControlIfRequired(M);}else{this.setContent(null);this._oControl.current="display";}}};n.prototype.setValue=function(v){var o=this.getProperty("value");this.setProperty("value",v,true);if(!this.isPropertyBeingUpdatedByModel("value")&&!this.getBindingContext()){var i=this.getFirstInnerControl();if(i){var s=i.getMetadata().getName();var j=O.getBoundPropertiesMapInfoForControl(s,{propertyName:"value"})[0];var I=i.getBinding(j);if((this.getMode()==="display")&&I&&(typeof I.getFormatter()==="function")&&(I.getBindingMode()===e.OneWay)){v=I.getExternalValue();}this._setPropertyOnControls(j,v,[i]);}}var F=this._oFactory;if(!F){return this;}if(!F.bPending){this._toggleInnerControlIfRequired();}v=this.getProperty("value");if(F.oTextArrangementDelegate){F.oTextArrangementDelegate.setValue(v,o);}if(v!==o){this.invalidate();}return this;};n.prototype.isTextInEditModeSourceNotNone=function(){return(this.getTextInEditModeSource()!==T.None);};n.prototype._createControlIfRequired=function(E){if(!this._oFactory){return;}var v=this._oControl[E];if((E!==this._oControl.current)||!v){if(!v){var o=this._oFactory.createControl();if(o){this._oControl[E]=o.control;this._placeCallBacks(o,E);}}this._oControl.current=E;this.setContent(this._oControl[E]);this._setOnInnerControl();this.fireInnerControlsCreated(this.getInnerControls());}else if(!this.getContent()){this.setContent(this._oControl[E]);}};n.prototype._placeCallBacks=function(o,M){if(o.params&&o.params.getValue){this._oValue[M]=o.params.getValue;}if(o.params&&o.params.uom){this._oValue.uom=o.params.uom;}if(o.params&&o.params.uomset){this._oValue.uomset=o.params.uomset;}};n.prototype._init=function(M){var o,i,j=this.getBindingContext();if(this._oFactory&&this._sBindingContextPath&&j&&(this._sBindingContextPath!==j.getPath())||(this._sBindingContextPath&&j===null)){this._destroyFactory();}if(!this._oFactory){i=this.data("configdata");if(!i){o=this.getModel(M);}var s=this.getBindingPath("value"),D=M===undefined;if(D&&s){if(i||o){this._oFactory=this._createFactory(M,o,s,i);}}else if(o&&!(o instanceof d)){if(this.getBindingInfo("url")||this.getUrl()){if(i||o){this._oFactory=this._createFactory(M,o,s,i);}}}}};n.prototype._destroyFactory=function(){this._bSuppressToggleControl=true;this._bSideEffects=false;if(this._oFactory){this._oFactory.destroy();}this._oFactory=null;this._bSuppressToggleControl=false;this._destroyControls();};n.prototype._destroyControls=function(){if(this._oControl){if(this._oControl.display){this._oControl.display.destroy();}if(this._oControl["display_uom"]){this._oControl["display_uom"].destroy();}if(this._oControl.edit){this._oControl.edit.destroy();}this._oControl.display=null;this._oControl["display_uom"]=null;this._oControl.edit=null;this._oControl.current=null;}this._oValue={display:null,edit:null,uom:null,uomset:null};this.destroyAggregation("_content");};n.prototype._createFactory=function(M,o,s,i){if(o&&o instanceof d){return new J(o,this,{model:M,path:s});}var E;if(!i){E=this._getEntitySet(M);}if(E||i){var p;if(i){p=i.configdata;}else{p={entitySet:E,model:M,path:s};}return new O(o,this,p);}return null;};n.prototype._getEntitySet=function(M){var E=this.getEntitySet(),i=E!=="";if(i&&!M){return E;}var o=this.getBindingContext(M);if(o){var s=o.getPath();if((s==="")||(s===undefined)||(s==="/undefined")){return"";}E=this._oUtil.correctPath(s);this.fireEntitySetFound({entitySet:E});return E;}return"";};n.prototype.getDataType=function(){var p;if(this._oFactory){if(this._oFactory.getDataProperty){p=this._oFactory.getDataProperty();if(p){return p.property.type;}}return this.getJsonType();}return null;};n.prototype.getDataProperty=function(){if(this._oFactory){if(this._oFactory.getDataProperty){return this._oFactory.getDataProperty();}return null;}return null;};n.prototype.getUnitOfMeasure=function(){if(this._oValue.uom){return this._oValue.uom();}return null;};n.prototype.setUnitOfMeasure=function(u){if(u&&this._oValue.uomset){this._oValue.uomset(u);}};n.prototype.setSimpleClientError=function(E){this._oError.bFirst=E;};n.prototype.setComplexClientErrorFirstOperand=function(E){this._oError.bComplex=true;this._oError.bFirst=E;};n.prototype.setComplexClientErrorSecondOperand=function(E){this._oError.bComplex=true;this._oError.bSecond=E;};n.prototype.setComplexClientErrorSecondOperandNested=function(E){var p=this.getParent().getParent();p.setComplexClientErrorSecondOperand(E);};n.prototype._hasClientError=function(){if(this._oError.bComplex){return this._oError.bFirst||this._oError.bSecond;}return this._oError.bFirst;};n.prototype.checkClientError=function(s){s=Object.assign({handleSuccess:false},s);var E="The sap.ui.comp.smartfield.SmartField#checkClientError method is deprecated. "+"Please use the sap.ui.comp.smartfield.SmartField#checkValuesValidity method instead.";L.warning(E,this.getMetadata().getName());if(this.getMode()==="display"){return false;}if(this._hasClientError()&&!s.handleSuccess){return true;}this.getInnerControls().forEach(function(i){this._checkErrors(i,{checkClientErrorsOnly:true,handleSuccess:s.handleSuccess});}.bind(this));return this._hasClientError();};n.prototype.checkValuesValidity=function(s){if(this.getMode()==="display"){return Promise.resolve();}s=s||{};var D={handleSuccess:true,innerControls:this.getInnerControls(),rawValues:[]};var u=this._getEmbeddedSmartField();s=Object.assign(D,s);if(s.rawValues.length===0&&u&&u.data("configdata")&&u.data("configdata").configdata.isUOM){this._updateCurrencyRawValues(s);}return new Promise(function(r,R){var o={rawValues:s.rawValues,handleSuccess:s.handleSuccess};var p=s.innerControls.map(function(i){return this._checkErrors(i,o);},this);Promise.all(p).then(function(){r();}).catch(function(i){R();});}.bind(this));};n.prototype._updateCurrencyRawValues=function(s){s.rawValues=s.innerControls.map(function(o){var M=o.getMetadata(),p=O.getBoundPropertiesMapInfoForControl(M.getName(),{propertyName:"value"});return M.getProperty(p).get(o);});};n.prototype._checkErrors=function(o,s){s=Object.assign({checkClientErrorsOnly:false,handleSuccess:true},s);var i,p;if(o){var v=O.getBoundPropertiesMapInfoForControl(o.getMetadata().getName(),{propertyName:"value"});p=v&&v[0];}if(p){i=o.getBinding(p);}if(!i){return Promise.resolve();}var j;function q(y){var z={element:o,property:p,type:i.getType(),newValue:j,oldValue:i.getValue(),exception:y,message:y.message};if(y instanceof P){o.fireParseError(z);}else if(y instanceof V){o.fireValidationError(z);}else{throw y;}}function r(){if(s.handleSuccess&&i.hasValidation()){var z={element:o,property:p,type:i.getType(),newValue:j,oldValue:i.getValue()};var A=false,F=true;o.fireValidationSuccess(z,A,F);}}try{var M="get"+f(p),t=i.getType(),I=i.sInternalType;j=o[M]();if(I&&t){if(s.checkClientErrorsOnly&&t.async){var E="The deprecated sap.ui.comp.smartfield.SmartField#checkClientError method can not be "+"used with async types. Please use sap.ui.comp.smartfield.SmartField#checkValuesValidity "+"method instead.";L.error(E,this.getMetadata().getName());this.setSimpleClientError(true);return Promise.reject();}if(t.async){var D=i.getDataState();var u=t.formatValue(D.getValue(),I);if(!D.isControlDirty()&&(u===j)){r();return Promise.resolve();}}var R=s.rawValues||i.getValue(),w=t.parseValue(j,i.sInternalType,R),x;if(w&&(w instanceof Promise)){x=w.then(function(z){return t.validateValue(z);}).then(r);x.catch(q);return x;}x=t.validateValue(w);if(x instanceof Promise){x.catch(q);return x.then(r);}}}catch(y){q(y);return Promise.reject();}r();return Promise.resolve();};n.prototype.isContextTable=function(){return(this.getControlContext()==="responsiveTable"||this.getControlContext()==="table");};n.prototype.isFormContextType=function(){var s=this.getControlContext(),i=l.smartfield.ControlContextType;return(s===i.Form)||(s===i.SmartFormGrid);};n.prototype.getInnerControls=function(){var o,i,j={"sap.m.HBox":function(p){var q,I,r=0;I=p.getItems();if(I){r=I.length;}if(r===0){return[];}if(r===1){return[I[0]];}q=I[1].getContent();if(q){return[I[0],q];}return[I[0]];},"sap.ui.comp.navpopover.SmartLink":function(p){var I=p.getAggregation("innerControl");if(I){return[I];}return[p];}};o=this.getContent();if(o){i=j[o.getMetadata()._sClassName];}if(i){return i(o);}if(o){return[o];}return[];};n.prototype.getAllInnerControls=function(){var i=[],o=this._oControl;if(o){for(var p in o){if(o.hasOwnProperty(p)){var j=o[p];if(j&&(j instanceof Object)){i.push(j);}}}}return i;};n.prototype._getEmbeddedSmartField=function(){var i=this.getContent();if(i){if(i.isA("sap.m.HBox")){var H=i.getItems();if(H){for(var j=0;j<H.length;j++){if(H[j]instanceof n){return H[j];}}}}}return null;};n.prototype.onAfterRendering=function(){b.prototype.onAfterRendering.apply(this,arguments);this._checkFieldGroups();};n.prototype.onBeforeRendering=function(){b.prototype.onBeforeRendering.apply(this,arguments);var F=this.getInnerControls();var t=this;if(this.getAriaLabelledBy().length>0){F.forEach(function(o){if(o.addAriaLabelledBy&&o.getAriaLabelledBy){if(o.getAriaLabelledBy().length===0){o.addAriaLabelledBy(t.getAriaLabelledBy()[0]);}}});}};n.prototype.getFirstInnerControl=function(){var i=this.getInnerControls();if(i.length){return i[0]||null;}return null;};n.prototype._checkFieldGroups=function(){var v,M,s=this.getMode();if(this.getBindingContext()&&this._oFactory&&this._oFactory.getMetaData&&(s==="edit")&&!this._bSideEffects){M=this._oFactory.getMetaData();if(M&&!M.property||(M.property&&!M.property.property)){return;}v=this._getView();if(v&&M){this._setFieldGroup(M,v);}}};n.prototype._setFieldGroup=function(M,v){var i,I=this._oSideEffects.getFieldGroupIDs(M,v);if(I){i=this.getInnerControls();if(i.length){this._bSideEffects=true;i[0].setFieldGroupIds(I);}}};n.prototype._getView=function(){var o=this.getParent();while(o){if(o.isA("sap.ui.core.mvc.View")){return o;}o=o.getParent();}return null;};n.prototype.refreshDataState=function(N,D){var o,i;if(N==="value"){if(D.isLaundering()){if(this.getEditable()){o=this.getBindingContext();if(o&&o.getObject){i=o.getObject();if(i&&i.__metadata&&i.__metadata.created){this._checkCreated=true;return;}}}}if(this._checkCreated&&!D.isLaundering()&&!D.isDirty()){this._oFactory.rebindOnCreated();delete this._checkCreated;}}};n.prototype.exit=function(){this._bInDestroy=true;var i=null;if(this._oSideEffects){this._oSideEffects.destroy();}if(this._oUtil){this._oUtil.destroy();}if(this._oFactory){this._oFactory.destroy();}var o=this._oControl;if(o){if(o.current==="edit"){i=o["display"]||o["display_uom"];}else{i=o["edit"];}if(o[o.current]&&!o[o.current].getParent()){o[o.current].destroy();}}if(i&&(typeof i.destroy==="function")){i.destroy();}this._oUtil=null;this._oError=null;this._oValue=null;this._oFactory=null;this._oControl=null;this._oSideEffects=null;this._sBindingContextPath="";this._sAnnotationLabel="";};n.getSupportedAnnotationPaths=function(M,E,v,N){var o,u,r=[],i;if(M&&E&&v){i={entitySet:E,entityType:M.getODataEntityType(E.entityType),path:v};o={helper:new a(null,null,M)};if(N){o.navigationPathOnly=N;}o.helper.getProperty(i);n._getFromEntitySet(r,i,o);n._getFromProperty(r,i,o);u=o.helper.getUnitOfMeasure2(i);if(u){n._getFromProperty(r,u,o);}o.helper.destroy();}return r;};n._getFromEntitySet=function(r,M,o){var p;if(M.entitySet){p=o.helper.oAnnotation.getUpdateEntitySetPath(M.entitySet);n._push(p,r,M,o);}};n._push=function(p,r,M,o){var i,s,j,q,R={};if(p){if(o.navigationPathOnly){i=p.split("/");j=i.length;R.entityType=M.entityType;while(j--){s=i.shift();if(s===""){continue;}R=o.helper.getNavigationProperty(R.entityType,s);if(!R.entitySet){break;}if(q){q=q+"/"+s;}else{q=s;}}}else{q=p;}}if(q){if(M.navigationPath){r.push(M.navigationPath+"/"+q);}else{r.push(q);}}};n._getFromProperty=function(r,M,o){var p;if(M.property.property){p=o.helper.oAnnotation.getText(M.property.property);n._push(p,r,M,o);p=o.helper.oAnnotation.getUnit(M.property.property);n._push(p,r,M,o);p=o.helper.oAnnotation.getFieldControlPath(M.property.property);n._push(p,r,M,o);}};n.prototype.addAssociation=function(A,i,s){if(A==="ariaLabelledBy"){this.getInnerControls().forEach(function(o){if(o.addAriaLabelledBy){o.addAriaLabelledBy(i);}});}return b.prototype.addAssociation.apply(this,arguments);};n.prototype.removeAssociation=function(A,o,s){var i=b.prototype.removeAssociation.apply(this,arguments);if(A==="ariaLabelledBy"&&i){this.getInnerControls().forEach(function(j){if(j.removeAriaLabelledBy){j.removeAriaLabelledBy(i);}});}return i;};n.prototype.getAccessibilityInfo=function(){var o=this.getContent();return o&&o.getAccessibilityInfo?o.getAccessibilityInfo():null;};n.prototype.enhanceAccessibilityState=function(E,A){var p=this.getParent();if(p&&p.enhanceAccessibilityState){p.enhanceAccessibilityState(this,A);}};n.prototype.getRequired=function(){if(this.getContextEditable()&&this.getEditable()){return this.getMandatory();}else{return false;}};n.prototype.getBindingMode=function(p){var o=this.getBindingInfo(p);return o?o.parts[0].mode:undefined;};return n;},true);
