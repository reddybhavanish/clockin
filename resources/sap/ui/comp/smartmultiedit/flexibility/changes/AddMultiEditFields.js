/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/comp/smartmultiedit/Container"],function(L,J,C){"use strict";var A={};A.applyChange=function(c,g,p){var o=c.getDefinition();if(this._checkChangeDefinition(o)){var m=p.modifier,f=o.content.field.selector,F=o.content.field.id,i=o.content.field.index,j=o.content.field.jsType,P=o.content.field.propertyName,e=o.content.field.entitySet;var G=m.createControl("sap.ui.comp.smartform.GroupElement",p.appComponent,p.view,f||F);var a=this._createGroupElementField(m,p.view,G,j,P,e,p.appComponent);m.insertAggregation(g,"groupElements",G,i,p.view);var b=this._getContainerFromGroup(g);if(b){b.indexField(a);}c.setRevertData(m.getSelector(G,p.appComponent));return true;}else{L.error("Change doesn't contain sufficient information to be applied: "+this._getChangeInfo(o));}};A.revertChange=function(c,g,p){var o=c.getDefinition(),s=c.getRevertData();if(s){var S=s.idIsLocal?p.appComponent.getId()+s.id:s.id;var G=sap.ui.getCore().byId(S);if(G){p.modifier.removeAggregation(g,"groupElements",G);var a=this._getContainerFromGroup(g);if(a){a._refreshFields();}c.resetRevertData();return true;}else{L.error("Change could not be reverted because selector '"+S+"' did not find any control: "+this._getChangeInfo(o));}}else{L.error("Change doesn't contain sufficient information to be reverted. Most Likely the Change didn't go through applyChange: "+this._getChangeInfo(o));}};A.completeChangeContent=function(c,s,p){var a=p.appComponent;var o=c.getDefinition();if(!o.content){o.content={};}if(!o.content.field){o.content.field={};}if(s.bindingPath){o.content.field.propertyName=s.bindingPath;}else{throw new Error("oSpecificChangeInfo.bindingPath or bindingPath attribute required");}if(s.newControlId){o.content.field.selector=J.getSelector(s.newControlId,a);}else{throw new Error("oSpecificChangeInfo.newControlId attribute required");}if(s.jsTypes){o.content.field.jsType=s.jsType;}else if(s.bindingPath){o.content.field.jsType="sap.ui.comp.smartmultiedit.Field";}else{throw new Error("oSpecificChangeInfo.jsTypes or bindingPath attribute required");}if(s.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required");}else{o.content.field.index=s.index;}if(s.entitySet){o.content.field.entitySet=s.entitySet;}};A._checkChangeDefinition=function(c){var b=c.content,m=false;if(b){m=c.content.field&&(c.content.field.selector||c.content.field.id)&&c.content.field.jsType&&c.content.field.propertyName;}return b&&m;};A._createGroupElementField=function(m,v,g,j,p,e,a){var V=m.createControl(j,a,v);m.setProperty(V,"propertyName",p);if(e){m.setProperty(V,"entitySet",e);}m.insertAggregation(g,"elements",V,0,v,true);return V;};A._getContainerFromGroup=function(g){if(g&&typeof g.getParent==="function"&&typeof g.getParent().getParent==="function"&&typeof g.getParent().getParent().getParent==="function"){var c=g.getParent().getParent().getParent();if(c instanceof C){return c;}}};A._getChangeInfo=function(c){return"["+c.layer+"]"+c.namespace+"/"+c.fileName+"."+c.fileType;};return A;},true);
