/*!
* OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/Utils","sap/ui/fl/registry/ExtensionPointRegistry","sap/ui/core/util/reflection/JsControlTreeModifier","sap/base/util/merge"],function(C,A,F,U,E,J,m){'use strict';var P={applyExtensionPoint:function(e){var a=U.getAppComponentForControl(e.targetControl);var c=C.getChangePersistenceForControl(e.targetControl);var p={};p.appComponent=a;p.modifier=J;p.viewId=e.view.getId();p.name=e.name;p.componentId=a.getId();var o=E.getInstance();var b=m({defaultContent:[]},e);o.registerExtensionPoints(b);var d=F.initialize(p).then(c.getChangesForExtensionPoint.bind(c,p)).then(function(f){if(f.length===0){e.createDefault().then(function(g){g.forEach(function(n,i){b.defaultContent.push(n.getId());J.insertAggregation(e.targetControl,e.aggregationName,n,e.index+i,e.view);});e.ready(g);});}else{f.forEach(function(g){if(g.isInInitialState()){g.setExtensionPointInfo(e);var s=g.getSelector();s.id=e.targetControl.getId();s.idIsLocal=false;g.setSelector(s);if(c.isChangeMapCreated()){c._addChangeAndUpdateDependencies(a,g);}}});}});o.addApplyExtensionPointPromise(d);A.setPreConditionForApplyAllChangesOnControl(o.getApplyExtensionPointsPromise());return d;}};return P;});
