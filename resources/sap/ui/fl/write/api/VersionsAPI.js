/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/write/_internal/Versions","sap/ui/fl/Utils","sap/ui/fl/apply/_internal/flexState/ManifestUtils"],function(F,V,U,M){"use strict";var a={};a.initialize=function(p){if(!p.selector){return Promise.reject("No selector was provided");}if(!p.layer){return Promise.reject("No layer was provided");}var A=U.getAppComponentForControl(p.selector);var r=U.getComponentClassName(A);if(!r){return Promise.reject("The application ID could not be determined");}return V.initialize({reference:U.normalizeReference(r),layer:p.layer});};a.isDraftAvailable=function(p){var v=a.getVersions(p);var d=v.find(function(o){return o.versionNumber===0;});return!!d;};a.getVersions=function(p){if(!p.selector){throw Error("No selector was provided");}if(!p.layer){throw Error("No layer was provided");}var A=U.getAppComponentForControl(p.selector);var r=U.getComponentClassName(A);if(!r){throw Error("The application ID could not be determined");}return V.getVersions({reference:U.normalizeReference(r),layer:p.layer});};a.loadDraftForApplication=function(p){if(!p.selector){return Promise.reject("No selector was provided");}if(!p.layer){return Promise.reject("No layer was provided");}var A=U.getAppComponentForControl(p.selector);var r=U.getComponentClassName(A);if(!r){return Promise.reject("The application ID could not be determined");}return F.clearAndInitialize({componentId:A.getId(),reference:r,draftLayer:p.layer});};a.activateDraft=function(p){if(!p.selector){return Promise.reject("No selector was provided");}if(!p.layer){return Promise.reject("No layer was provided");}if(!p.title){return Promise.reject("No version title was provided");}var A=U.getAppComponentForControl(p.selector);if(A){var m=A.getManifest();var r=M.getFlexReference({manifest:m,componentData:A.getComponentData()});var s=U.getAppVersionFromManifest(m);}if(!r){return Promise.reject("The application ID could not be determined");}return V.activateDraft({nonNormalizedReference:r,reference:U.normalizeReference(r),appVersion:s,layer:p.layer,title:p.title});};a.discardDraft=function(p){if(!p.selector){return Promise.reject("No selector was provided");}if(!p.layer){return Promise.reject("No layer was provided");}var A=U.getAppComponentForControl(p.selector);if(A){var m=A.getManifest();var r=M.getFlexReference({manifest:m,componentData:A.getComponentData()});var s=U.getAppVersionFromManifest(m);}if(!r){return Promise.reject("The application ID could not be determined");}return V.discardDraft({nonNormalizedReference:r,reference:U.normalizeReference(r),layer:p.layer,appVersion:s}).then(function(d){if(d){a.loadDraftForApplication({selector:p.selector,layer:p.layer});}return d;});};return a;});
