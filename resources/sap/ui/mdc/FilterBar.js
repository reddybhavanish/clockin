/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/library','sap/ui/mdc/p13n/AdaptationController','sap/ui/mdc/p13n/FlexUtil','sap/ui/Device','sap/ui/core/Control','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/base/Log','sap/ui/mdc/filterbar/FilterItemLayout','sap/ui/mdc/condition/ConditionModel','sap/ui/mdc/condition/Condition','sap/ui/mdc/util/IdentifierUtil','sap/ui/mdc/condition/ConditionConverter','sap/ui/layout/AlignedFlowLayout','sap/m/library','sap/m/MessageBox','sap/m/Button','sap/ui/model/json/JSONModel',"sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/mdc/p13n/StateUtil","sap/ui/mdc/condition/FilterConverter"],function(c,A,F,D,C,m,d,M,a,L,b,e,f,I,g,h,l,k,B,J,n,o,S,p){"use strict";var q=l.ButtonType;var V=c.ValueState;var r=C.extend("sap.ui.mdc.FilterBar",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/filterbar/FilterBar.designtime",defaultAggregation:"filterItems",interfaces:["sap.ui.mdc.IFilter","sap.ui.mdc.IxState"],properties:{delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/FilterBarDelegate",payload:{modelName:undefined,collectionName:""}}},liveMode:{type:"boolean",defaultValue:false},showMessages:{type:"boolean",group:"Misc",defaultValue:true},showGoButton:{type:"boolean",defaultValue:true},showAdaptFiltersButton:{type:"boolean",defaultValue:true},p13nMode:{type:"sap.ui.mdc.FilterBarP13nMode[]"},filterConditions:{type:"object",defaultValue:{}},_filterCount:{type:"string",visibility:"hidden"},_p13nModeItem:{type:"boolean",visibility:"hidden",defaultValue:false},_p13nModeValue:{type:"boolean",visibility:"hidden",defaultValue:false}},aggregations:{filterItems:{type:"sap.ui.mdc.FilterField",multiple:true},basicSearchField:{type:"sap.ui.mdc.FilterField",multiple:false},layout:{type:"sap.ui.layout.AlignedFlowLayout",multiple:false,visibility:"hidden"}},events:{search:{conditions:{type:"object"}},filtersChanged:{filtersText:{type:"string"}}}},renderer:{apiVersion:2,render:function(R,i){R.openStart("div",i);R.class("sapUiMdcBaseFilterBar");R.openEnd();R.renderControl(i.getAggregation("layout"));R.close("div");}}});r.INNER_MODEL_NAME="$sap.ui.mdc.FilterBar";r.CONDITION_MODEL_NAME="$filters";var E={NoError:-1,RequiredHasNoValue:0,FieldInErrorState:1,AsyncValidation:2};r.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._createInnerModel();this._oObserver=new a(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["filterItems"]});this._oFilterBarLayout=new h();this.setAggregation("layout",this._oFilterBarLayout,true);this._addButtons();this._aProperties=null;this._fResolveInitialFiltersApplied=undefined;this._oInitialFiltersAppliedPromise=new Promise(function(i){this._fResolveInitialFiltersApplied=i;}.bind(this));this._bIgnoreChanges=false;this._oAdaptationController=null;};r.prototype._isPhone=function(){return(D.system.phone)?true:false;};r.prototype._isLiveMode=function(){if(this._isPhone()){return false;}return this.getLiveMode();};r.prototype._getConditionModel=function(){return this._oConditionModel;};r.prototype.getConditionModelName=function(){return this._getConditionModelName();};r.prototype._getConditionModelName=function(){return r.CONDITION_MODEL_NAME;};r.prototype._createConditionModel=function(){this._oConditionModel=new e();this.setModel(this._oConditionModel,this._getConditionModelName());};r.prototype._getMetaModelName=function(){var i=this.getDelegate();if(i&&i.payload&&i.payload.hasOwnProperty("modelName")){return this.getDelegate().payload.modelName===null?undefined:this.getDelegate().payload.modelName;}return null;};r.prototype._getEntitySetName=function(){var i=this.getDelegate();if(i&&i.payload&&i.payload.collectionName){return this.getDelegate().payload.collectionName;}return null;};r.prototype.applySettings=function(s,i){var j;C.prototype.applySettings.apply(this,arguments);this._createConditionModel();this._oConditionModel.attachPropertyChange(this._handleConditionModelPropertyChange,this);this._retrieveMetadata();j=this.getFilterConditions();if(j&&Object.keys(j).length>0){this._oMetadataAppliedPromise.then(function(){this._applyInitialFilterConditions();}.bind(this));}else{this._fResolveInitialFiltersApplied();}};r.prototype.setP13nMode=function(i){var O=this.getP13nMode();this.setProperty("p13nMode",i||[],false);i&&i.forEach(function(s){if(!O||O.indexOf(s)<0){this._setP13nMode(s,true);}}.bind(this));O&&O.forEach(function(s){if(!i||i.indexOf(s)<0){this._setP13nMode(s,false);}}.bind(this));return this;};r.prototype._setP13nMode=function(s,v){switch(s){case"Item":this._setP13nModeItem(v);break;case"Value":this._setP13nModeValue(v);break;}};r.prototype._getP13nModeItem=function(){return this._oModel.getProperty("/_p13nModeItem");};r.prototype._setP13nModeItem=function(v){this._oModel.setProperty("/_p13nModeItem",v,true);};r.prototype._getP13nModeValue=function(){return this._oModel.getProperty("/_p13nModeValue");};r.prototype._setP13nModeValue=function(v){this._oModel.setProperty("/_p13nModeValue",v,false);};r.prototype._createInnerModel=function(){this._oModel=new M(this);this.setModel(this._oModel,r.INNER_MODEL_NAME);return this;};r.prototype._addButtons=function(){if(this._oFilterBarLayout){this.setProperty("_filterCount",this._oRb.getText("filterbar.ADAPT"),false);this._btnAdapt=new B(this.getId()+"-btnAdapt",{type:q.Transparent,text:"{"+r.INNER_MODEL_NAME+">/_filterCount}",press:this.onAdaptFilters.bind(this)});this._btnAdapt.setModel(this._oModel,r.INNER_MODEL_NAME);this._btnAdapt.bindProperty("visible",{parts:[{path:'/showAdaptFiltersButton',model:r.INNER_MODEL_NAME},{path:"/_p13nModeItem",model:r.INNER_MODEL_NAME}],formatter:function(v,i){return v&&i;}});this._btnAdapt.addStyleClass("sapUiMdcBaseFilterBarButtonPaddingRight");this._oFilterBarLayout.addEndContent(this._btnAdapt);this._btnSearch=new B(this.getId()+"-btnSearch",{text:this._oRb.getText("filterbar.GO"),press:this.onSearch.bind(this),type:q.Emphasized});this._btnSearch.setModel(this._oModel,r.INNER_MODEL_NAME);this._btnSearch.bindProperty("visible",{parts:[{path:'/showGoButton',model:r.INNER_MODEL_NAME},{path:"/liveMode",model:r.INNER_MODEL_NAME}],formatter:function(v,i){return v&&((this._isPhone())?true:!i);}.bind(this)});this._oFilterBarLayout.addEndContent(this._btnSearch);}};r.prototype._initializeProvider=function(){var i=this.getDelegate();if(i){var s=i.name;if(!s){return Promise.resolve(null);}return this._loadProvider(s);}else{L.error("not able to obtain the delegate.");return Promise.resolve(null);}};r.prototype._loadProvider=function(s){return new Promise(function(R){sap.ui.require([s],function(P){R(P);});});};r.prototype.onAdaptFilters=function(i){return this._oMetadataAppliedPromise.then(function(){return this._getAdaptationController().showP13n(this._btnAdapt,"Item");}.bind(this));};r.prototype.setFilterConditions=function(v,s){S.checkConditionOperatorSanity(v);this.setProperty("filterConditions",v,s);return this;};r.prototype.getCurrentState=function(){var i=this.getFilterItems();var j=[];i.forEach(function(u,v){j.push({name:u.getFieldPath()});});var s=[];var t=this.getFilterConditions();for(var K in t){if(!this._getPropertyByName(K)){s.push(K);}}s.forEach(function(K){delete t[K];});return{filter:t,items:j};};r.prototype._getAdaptationController=function(){if(!this._oAdaptationController){this._oAdaptationController=new A({liveMode:true,stateRetriever:function(i,P){return this.getCurrentState(P);},adaptationControl:this,afterChangesCreated:function(i,j){F.handleChanges(j);},retrievePropertyInfo:this._getNonHiddenPropertyInfoSet,itemConfig:{addOperation:"addFilter",removeOperation:"removeFilter",moveOperation:"moveFilter",panelPath:"sap/ui/mdc/p13n/panels/AdaptFiltersPanel",title:this._oRb.getText("filterbar.ADAPT_TITLE")}});}return this._oAdaptationController;};r.prototype._getAssignedFilterNames=function(){var N,i=null,j=this._getConditionModel();if(j){i=[];var s=j.getConditions("$search");if(s&&s.length>0){i.push(this._oRb.getText("filterbar.ADAPT_SEARCHTERM"));}this._getNonHiddenPropertyInfoSet().forEach(function(P){N=I.getPropertyKey(P);var s=j.getConditions(N);if(s&&s.length>0){i.push(P.label||N);}});}return i;};r.prototype._getAssignedFiltersText=function(j){var s,t;j=j||[];if(j.length>5){t=j.slice(0,5);t.push("...");}else{t=j;}s=Object.keys(t).map(function(i){return t[i];}).join(", ");if(j.length){return this._oRb.getText("filterbar.ADAPT_FILTERED",[j.length,s]);}return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");};r.prototype.getAssignedFiltersText=function(){return this._getAssignedFiltersText(this._getAssignedFilterNames());};r.prototype._reportModelChange=function(i){this._handleAssignedFilterNames();if(this.getLiveMode()){this.triggerSearch();}};r.prototype._isFlexSupported=function(i){return o.isFlexSupported({element:this});};r.prototype._handleConditionModelPropertyChange=function(i){if(!this._bIgnoreChanges){var P=i.getParameter("path");if(P.indexOf("/conditions/")===0){var s=P.substring("/conditions/".length);if(this._getP13nModeValue()&&this._isFlexSupported()){var O={};O[s]=this._stringifyConditions(s,i.getParameter("value"));this._cleanupConditions(O[s]);this._getAdaptationController().createConditionChanges(O);}else{this._reportModelChange();}}}};r.prototype._toExternal=function(P,i){var j=m({},i);j=g.toString(j,P.baseType);this._cleanupCondition(j);if(i.inParameters&&(Object.keys(i.inParameters).length>0)){Object.keys(i.inParameters).forEach(function(K){var s=this._getPropertyByName(K);if(s){var t=f.createCondition("EQ",[i.inParameters[K]]);var u=g.toString(t,s.baseType);if(!j.inParameters){j.inParameters={};}j.inParameters[K]=u.values[0];}else{L.error("mdc.FilterBar._toExternal: could not find property info for "+K);}}.bind(this));}if(i.outParameters&&(Object.keys(i.outParameters).length>0)){Object.keys(i.outParameters).forEach(function(K){var O=this._getPropertyByName(K);if(O){var s=f.createCondition("EQ",[i.outParameters[K]]);var t=g.toString(s,O.baseType);if(!j.outParameters){j.outParameters={};}j.outParameters[K]=t.values[0];}else{L.error("mdc.FilterBar._toExternal: could not find property info for "+K);}}.bind(this));}return j;};r.prototype._toInternal=function(P,i){var j=m({},i);j=g.toType(j,P.baseType);if(i.inParameters&&(Object.keys(i.inParameters).length>0)){Object.keys(i.inParameters).forEach(function(K){var s=this._getPropertyByName(K);if(s){var t=f.createCondition("EQ",[i.inParameters[K]]);var v=g.toType(t,s.baseType);if(!j.inParameters){j.inParameters={};}j.inParameters[K]=v.values[0];}else{L.error("mdc.FilterBar._toInternal: could not find property info for "+K);}}.bind(this));}if(i.outParameters&&(Object.keys(i.outParameters).length>0)){Object.keys(i.outParameters).forEach(function(K){var O=this._getPropertyByName(K);if(O){var s=f.createCondition("EQ",[i.outParameters[K]]);var v=g.toType(s,O.baseType);if(!j.outParameters){j.outParameters={};}j.outParameters[K]=v.values[0];}else{L.error("mdc.FilterBar._toInternal: could not find property info for "+K);}}.bind(this));}return j;};r.prototype._cleanupCondition=function(i){if(i){if(i.hasOwnProperty("isEmpty")){delete i.isEmpty;}}};r.prototype._cleanupConditions=function(i){if(i){i.forEach(function(j){this._cleanupCondition(j);},this);}};r.prototype._stringifyCondition=function(P,i){var R=i;if(i&&i.values&&i.values.length>0){R=this._toExternal(P,i);}return R;};r.prototype._stringifyConditions=function(s,i){var P=this._getPropertyByName(s);var R=i;if(P&&i){R=[];i.forEach(function(j){if(j&&j.values&&j.values.length>0){R.push(this._stringifyCondition(P,j));}},this);}return R;};r.prototype._removeSameConditions=function(s,t){var R;do{R=false;for(var i=0;i<s.length;i++){for(var j=0;j<t.length;j++){if(d(s[i],t[j])){s.splice(i,1);t.splice(j,1);R=true;break;}}if(R){break;}}}while(R);};r.prototype._handleAssignedFilterNames=function(){this._oMetadataAppliedPromise.then(function(){var O={},i=this._getAssignedFilterNames();if(i){if(this._btnAdapt){this.setProperty("_filterCount",this._oRb.getText(i.length?"filterbar.ADAPT_NONZERO":"filterbar.ADAPT",i.length),false);}O.filtersText=this._getAssignedFiltersText(i);this.fireFiltersChanged(O);}}.bind(this));};r.prototype.onReset=function(i){this._getConditionModel().oConditionModel.removeAllConditions();};r.prototype.onSearch=function(i){this.triggerSearch();};r.prototype.fireSearch=function(i){var j=this.getConditions();this.fireEvent("search",{conditions:j});};r.prototype.triggerSearch=function(){this.waitForInitialization().then(function(){if(!this._oSearchPromise){this._oSearchPromise=new Promise(function(j){this._fResolvedSearchPromise=j;}.bind(this));var i=function(){this._search();this._fResolvedSearchPromise();this._oSearchPromise=null;};setTimeout(i.bind(this),0);}return this._oSearchPromise;}.bind(this));};r.prototype._clearDelayedSearch=function(){if(this._iDelayedSearchId){clearTimeout(this._iDelayedSearchId);this._iDelayedSearchId=null;}};r.prototype._getRequiredFieldsWithoutValues=function(){var R=[];this._getRequiredPropertyNames().forEach(function(N){var i=this._getConditionModel().getConditions(N);if(!i||i.length===0){R.push(N);}}.bind(this));return R;};r.prototype._checkAsyncValidation=function(){var R=E.NoError;if(this._aFIChanges&&this._aFIChanges.length>0){R=E.AsyncValidation;}return R;};r.prototype._checkRequiredFields=function(){var R=E.NoError;var i=this._getRequiredFieldsWithoutValues();i.forEach(function(N){var j=this._getFilterField(N);if(j){if(j.getValueState()===V.None){j.setValueState(V.Error);j.setValueStateText(this._oRb.getText("filterbar.REQUIRED_FILTER_VALUE_MISSING"));}}else{L.error("Mandatory filter field '"+N+"' not visible on FilterBar has no value.");}R=E.RequiredHasNoValue;}.bind(this));return R;};r.prototype._checkFieldsInErrorState=function(){var R=E.NoError;this._getNonRequiredPropertyNames().some(function(N){var i=this._getFilterField(N);if(i&&(i.getValueState()!==V.None)){R=E.FieldInErrorState;}return R!==E.NoError;}.bind(this));return R;};r.prototype._handleFilterItemChanges=function(i){if(this._bIgnoreChanges){return;}var j=i.oSource;if(j.getRequired()&&(j.getValueState()===V.Error)&&i.getParameter("valid")){j.setValueState(V.None);return;}if(!this._aFIChanges){this._aFIChanges=[];}this._aFIChanges.push({name:j.getFieldPath(),promise:i.getParameter("promise")});};r.prototype._checkFilters=function(){var R=this._checkAsyncValidation();if(R!==E.NoError){return R;}R=this._checkRequiredFields();if(R!==E.NoError){return R;}R=this._checkFieldsInErrorState();if(R!==E.NoError){return R;}return R;};r.prototype._setFocusOnFirstErroneousField=function(){this.getFilterItems().some(function(i){if(i.getValueState()!==V.None){setTimeout(i["focus"].bind(i),0);return true;}return false;});};r.prototype._handleAsyncValidation=function(){if(this._aFIChanges&&(this._aFIChanges.length>0)){var N=this._aFIChanges.slice();this._aFIChanges=null;var i=[];N.forEach(function(j){i.push(j.promise);});Promise.all(i).then(function(j){j.forEach(function(s,t){var u=this._getFilterField(N[t].name);if(u&&u.getRequired()&&(u.getValueState()===V.Error)){u.setValueState(V.None);}},this);this._search();}.bind(this),function(j){this._search();}.bind(this));}};r.prototype._search=function(){var s,R;R=this._checkFilters();if(R===E.AsyncValidation){this._handleAsyncValidation();return;}if(R===E.NoError){this.fireSearch();}else{if(R===E.RequiredHasNoValue){s=this._oRb.getText("filterbar.REQUIRED_CONDITION_MISSING");}else{s=this._oRb.getText("filterbar.VALIDATION_ERROR");}if(this.getShowMessages()&&!this._isLiveMode()){try{k.error(s,{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":"",onClose:this._setFocusOnFirstErroneousField.bind(this)});}catch(x){L.error(x.message);}}else{L.warning("search was not triggered. "+s);}}};r.prototype.getConditions=function(){return this._getModelConditions(this._getConditionModel(),true);};r.prototype.hasProperty=function(N){return this._getPropertyByName(N);};r.prototype.waitForInitialization=function(){return Promise.all([this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]);};r.prototype._getModelConditions=function(i,j){var s={};if(i){var t=i.getAllConditions();for(var u in t){if(t[u]&&(t[u].length>0)){s[u]=m([],t[u]);if(!j&&this._getP13nModeValue()){this._cleanupConditions(s[u]);var v=this._stringifyConditions(u,s[u]);s[u]=v;}}}}return s;};r.prototype.removeCondition=function(s,x){return this.waitForInitialization().then(function(){var i=this._getConditionModel();if(i){var P=this._getPropertyByName(s);if(P){var j=this._toInternal(P,x);if(i.indexOf(s,j)>=0){i.removeCondition(s,j);}}}}.bind(this));};r.prototype.addCondition=function(s,x){return this.waitForInitialization().then(function(){var i=this._getConditionModel();if(i){var P=this._getPropertyByName(s);if(P){var j=this._toInternal(P,x);if(i.indexOf(s,j)<0){var t=[{sFieldPath:P}];S.checkConditionOperatorSanity(t);if(t&&t.length>0){i.addCondition(s,j);}}}}}.bind(this));};r.prototype.setConditions=function(i){var j=this._getConditionModel();if(j){j.setConditions(i);}};r.prototype._setXConditions=function(i,R){var P,j,s=this._getConditionModel();if(R){s.removeAllConditions();}if(i){for(var t in i){j=i[t];P=this._getPropertyByName(t);if(P){if(j.length===0){s.removeAllConditions(t);}else{j.forEach(function(u){if(P.maxConditions!==-1){s.removeAllConditions(t);}var N=this._toInternal(P,u);s.addCondition(t,N);}.bind(this));}}}}};r.prototype._storeChanges=function(i){if(i&&i.length){var H=o.hasVariantManagement({element:this});try{n.add({changes:i,ignoreVariantManagement:!H});}catch(j){L.error("error while saving changes - "+j.message);}}};r.prototype._getRequiredPropertyNames=function(){var R=[];this._getNonHiddenPropertyInfoSet().forEach(function(P){if(P.required){R.push(I.getPropertyKey(P));}});return R;};r.prototype._getNonRequiredPropertyNames=function(){var N=[];this._getNonHiddenPropertyInfoSet().forEach(function(P){if(!P.required){N.push(I.getPropertyKey(P));}});return N;};r.prototype._insertFilterFieldtoContent=function(i,j){if(!b){return;}var s=new b();s.setFilterField(i);this._oFilterBarLayout.insertContent(s,j);};r.prototype._filterItemInserted=function(i){if(!i.getVisible()){return;}if(i.setWidth){i.setWidth("");}this._applyFilterItemInserted(i);};r.prototype._applyFilterItemInserted=function(j){var s,t;t=this.indexOfAggregation("filterItems",j);if(this.getAggregation("basicSearchField")){t++;}s=t;var u=this.getFilterItems();for(var i=0;i<s;i++){if(!u[i].getVisible()){t--;}}this._insertFilterFieldtoContent(j,t);if(!this._oObserver.isObserved(j,{properties:["visible"]})){this._oObserver.observe(j,{properties:["visible"]});}};r.prototype._filterItemRemoved=function(i){this._applyFilterItemRemoved(i.getFieldPath());};r.prototype._applyFilterItemRemoved=function(s){this._removeFilterFieldFromContentByName(s);};r.prototype._removeFilterFieldFromContent=function(i){this._removeFilterFieldFromContentByName(i.getFieldPath());};r.prototype._removeFilterFieldFromContentByName=function(s){var i=this._getFilterItemLayoutByName(s);if(i){this._oFilterBarLayout.removeContent(i);i.destroy();}};r.prototype._observeChanges=function(i){if(i.type==="aggregation"&&i.name==="filterItems"){switch(i.mutation){case"insert":i.child.attachChange(this._handleFilterItemChanges,this);this._filterItemInserted(i.child);break;case"remove":i.child.detachChange(this._handleFilterItemChanges,this);this._filterItemRemoved(i.child);break;default:L.error("operation "+i.mutation+" not yet implemented");}}else if(i.type==="property"){var j;if(i.object.isA&&i.object.isA("sap.ui.mdc.FilterField")){j=i.object;if(j){if(i.current){this._filterItemInserted(j);}else{this._filterItemRemoved(j);}this._oFilterBarLayout.rerender();}}}};r.prototype._getFilterItemLayout=function(i){return this._getFilterItemLayoutByName(i.getFieldPath());};r.prototype._getFilterItemLayoutByName=function(s){var i=null;this._oFilterBarLayout.getContent().some(function(j){if(j._getFieldPath()===s){i=j;}return i!==null;});return i;};r.prototype._getFilterField=function(N){var i=null;this.getFilterItems().some(function(j){if(j&&j.getFieldPath&&(j.getFieldPath()===N)){i=j;}return i!==null;});return i;};r.prototype._retrieveMetadata=function(){if(this._oMetadataAppliedPromise){return this._oMetadataAppliedPromise;}this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=new Promise(function(i){this._fResolveMetadataApplied=i;}.bind(this));Promise.all([this._initializeProvider()]).then(function(i){if(!this._bIsBeingDestroyed){this._oDelegate=i[0];this._aProperties=[];if(this._oDelegate&&this._oDelegate.fetchProperties){try{this._oDelegate.fetchProperties(this).then(function(P){this._aProperties=P;this._fResolveMetadataApplied();}.bind(this),function(s){L.error(s);this._fResolveMetadataApplied();}.bind(this));}catch(j){L.error("Exception during fetchProperties occured: "+j.message);this._fResolveMetadataApplied();}}else{L.error("Provided delegate '"+this.getDelegate().path+"' not valid.");this._fResolveMetadataApplied();}}}.bind(this));return this._oMetadataAppliedPromise;};r.prototype.setBasicSearchField=function(i){var O=this.getAggregation("basicSearchField");if(O){this._removeFilterFieldFromContent(O);}this.setAggregation("basicSearchField",i);if(i){if(!this._oObserver.isObserved(i,{properties:["visible"]})){this._oObserver.observe(i,{properties:["visible"]});}this._insertFilterFieldtoContent(i,0);}return this;};r.prototype.getPropertyInfoSet=function(){return this._aProperties||[];};r.prototype._getNonHiddenPropertyInfoSet=function(){var v=[];this.getPropertyInfoSet().every(function(P){if(!P.hiddenFilter){if(I.getPropertyKey(P)!=="$search"){v.push(P);}}return true;});return v;};r.prototype._getNonHiddenPropertyByName=function(N){var P=null;this._getNonHiddenPropertyInfoSet().some(function(i){if(I.getPropertyKey(i)===N){P=i;}return P!=null;});return P;};r.prototype._getPropertyByName=function(N){var P=null;this.getPropertyInfoSet().some(function(i){if(I.getPropertyKey(i)===N){P=i;}return P!=null;});return P;};r.prototype._cleanUpFilterFieldsinErrorState=function(){var i=this.getFilterItems();i.forEach(function(j){if(j.getRequired()&&(j.getValueState()!==V.None)){j.setValueState(V.None);}});};r.prototype.applyConditionsAfterChangesApplied=function(){if(this._isChangeApplying()){return;}this._bIgnoreChanges=true;this._cleanUpFilterFieldsinErrorState();this._oFlexPromise=o.waitForChanges({element:this});Promise.all([this._oFlexPromise,this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]).then(function(v){this._oFlexPromise=null;this._changesApplied();}.bind(this));};r.prototype._suspendBinding=function(i){if(i){var j=i.getBinding("conditions");if(j){if(!this._aBindings){this._aBindings=[];}j.suspend();this._aBindings.push(i);}}};r.prototype._resumeBindings=function(){if(this._aBindings){this._aBindings.forEach(function(i){if(!i.bIsDestroyed){var j=i.getBinding("conditions");if(j){j.resume();}}});this._aBindings=null;}};r.prototype._isChangeApplying=function(){return!!this._oFlexPromise;};r.prototype._applyInitialFilterConditions=function(){this._bIgnoreChanges=true;this._applyFilterConditionsChanges();this._changesApplied();this._fResolveInitialFiltersApplied();};r.prototype._applyFilterConditionsChanges=function(){var i;var s=this.getProperty("filterConditions");if(Object.keys(s).length>0){i=m([],s);this._setXConditions(i,true,true);}};r.prototype._changesApplied=function(){this._bIgnoreChanges=false;this._reportModelChange();};r.prototype._getView=function(){return I.getView(this);};r.prototype.getFilters=function(){var i=function(t,u,v,P){L.info("FilterConverterCallback","convert '"+u+"' into Filter. Values="+t.values.toString());return P;};if(!this._getConditionModel()){return[];}var j=this._getConditionModel().getAllConditions(undefined);var s=p.createConditionTypesMapFromFilterBar(j,this);return p.createFilters(j,s,i);};r.prototype.getSearch=function(){var s=this._getConditionModel()?this._getConditionModel().getConditions("$search"):[];return s[0]?s[0].values[0]:"";};r.prototype.exit=function(){C.prototype.exit.apply(this,arguments);this._clearDelayedSearch();this._oFilterBarLayout=null;this._btnAdapt=undefined;this._btnSearch=undefined;this._oRb=null;if(this._oModel){this._oModel.destroy();this._oModel=null;}if(this._oAdaptationController){this._oAdaptationController.destroy();this._oAdaptationController=null;}if(this._oConditionModel){this._oConditionModel.detachPropertyChange(this._handleConditionModelPropertyChange,this);this._oConditionModel.destroy();this._oConditionModel=null;}this._oObserver.disconnect();this._oObserver=undefined;if(this._oDelegate&&this._oDelegate.cleanup){this._oDelegate.cleanup(this);}this._oDelegate=null;this._aProperties=null;this._oFlexPromise=null;this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=null;this._fResolveInitialFiltersApplied=undefined;this._oInitialFiltersAppliedPromise=null;this._fResolveSearchPromis=undefined;this._oSearchPromise=null;this._aBindings=null;};return r;});
