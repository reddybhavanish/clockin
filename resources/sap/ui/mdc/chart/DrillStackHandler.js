/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/m/ResponsivePopover","sap/m/List","sap/m/Bar","sap/m/SearchField","sap/m/StandardListItem","sap/ui/core/InvisibleText","sap/m/library","sap/ui/Device","sap/ui/mdc/chart/DimensionItem","sap/ui/mdc/chart/ChartSettings"],function(R,L,B,S,c,I,M,D,d,C){"use strict";var P=M.PlacementType;var e=M.ListType;var f=M.ListMode;function _(o){var a=o.getAggregation("_chart").getDrillStack();var s=[];a.forEach(function(b){b.dimension.forEach(function(i){if(i!=null&&i!=""&&s.indexOf(i)==-1){s.push(i);}});});return s;}function g(p){var i=p.filter(function(o){return o.kind=="Dimension";});if(i){i.sort(function(a,b){if(a.label&&b.label){return a.label.localeCompare(b.label);}});}return i;}var h=function(){};h.createDrillDownPopover=function(o){var l=new L({mode:f.SingleSelectMaster,selectionChange:function(E){if(E&&E.mParameters&&E.mParameters.listItem){var a=C._getAdaptationController(o);a.createItemChanges([{name:E.mParameters.listItem.data("dim").name,position:o.getItems().length}]);}p.close();}});var s=new B();var p=new R({contentWidth:"25rem",contentHeight:"20rem",placement:P.Bottom,subHeader:s});if(D.system.desktop){var i=new I({});p.setShowHeader(false);p.addContent(i);p.addAriaLabelledBy(i);}else{p.setTitle("View By");}p.addContent(l);o._oDrillDownPopover=p;};h.showDrillDownPopover=function(o){o.oDelegateModule.fetchProperties(o).then(function(p){var a=o._oDrillDownPopover.getContent()[1];var b,s,j,l;a.removeAllItems();b=_(o);s=g(p);for(var i=0;i<s.length;i++){j=s[i];if(b.indexOf(j.name)>-1){continue;}l=new c({title:j.label,type:e.Active});l.data("dim",j);a.addItem(l);}o._oDrillDownPopover.openBy(o._oDrillDownBtn);});};h.createDrillBreadcrumbs=function(o){sap.ui.require(["sap/m/Breadcrumbs"],function(a){var i=o.getAggregation("_chart");if(i){var b=new a();o.setAggregation("_breadcrumbs",b);this._updateDrillBreadcrumbs(o,b);}}.bind(this));};h._updateDrillBreadcrumbs=function(o,a){sap.ui.require(["sap/m/Link"],function(b){if(!a){return;}var j=o.getAggregation("_chart");if(!j){return;}var v=j.getDrillStack();var n=[];if(v){v.reverse();v.forEach(function(m,p,q){if(m.dimension.length>0&&typeof j.getDimensionByName(m.dimension[m.dimension.length-1])!='undefined'){var s=j.getDimensionByName(m.dimension[m.dimension.length-1]).getLabel();var r=j.getDimensionByName(m.dimension[m.dimension.length-1]).getName();if(p==0){a.setCurrentLocationText(s);}else{var t=new b({text:s,press:function(E){var u=a.indexOfLink(E.getSource());var w=j.getDrillStack()[j.getDrillStack().length-1].dimension;var x=w.slice(u+1);j.fireDeselectData(E);var N=[];var y=o.getItemsByName(x);y.forEach(function(z){N.push({name:z.getKey(),visible:false});});C._getAdaptationController(o).createItemChanges(N);this._updateDrillBreadcrumbs(o,a);}.bind(this)});t.data("key",r);n.push(t);}}else{if(p==0){a.setVisible(false);}}}.bind(this));}var k=a.getLinks();n.reverse();var l=false;if(k.length!==n.length){l=true;}else{for(var i=0;i<n.length;i++){if(n[i].getText()!=k[i].getText()){l=true;break;}}}if(l){if(a.getLinks()){a.removeAllLinks();}for(var i=0;i<n.length;i++){a.addLink(n[i]);}}}.bind(this));};return h;});
