/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/mdc/library','sap/ui/mdc/field/FieldHelpBase','sap/ui/mdc/condition/Condition','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/util/ConditionValidated','sap/ui/base/ManagedObjectObserver','sap/ui/base/SyncPromise','sap/base/util/ObjectPath','sap/base/util/deepEqual','sap/base/util/merge','sap/ui/model/resource/ResourceModel','sap/ui/mdc/condition/FilterConverter'],function(l,F,C,a,b,M,S,O,d,m,R,c){"use strict";var e=l.OutParameterMode;var D;var B;var V;var f;var g;var h;var k=F.extend("sap.ui.mdc.field.FieldValueHelp",{metadata:{library:"sap.ui.mdc",properties:{filterFields:{type:"string",defaultValue:""},keyPath:{type:"string",defaultValue:""},descriptionPath:{type:"string",defaultValue:""},showConditionPanel:{type:"boolean",defaultValue:false},title:{type:"string",group:"Appearance",defaultValue:""},noDialog:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{content:{type:"sap.ui.mdc.field.FieldValueHelpContentWrapperBase",multiple:false},filterBar:{type:"sap.ui.mdc.FilterBar",multiple:false},inParameters:{type:"sap.ui.mdc.field.InParameter",group:"Data",multiple:true},outParameters:{type:"sap.ui.mdc.field.OutParameter",group:"Data",multiple:true},_dialog:{type:"sap.m.Dialog",multiple:false,visibility:"hidden"}},defaultAggregation:"content",events:{dataRequested:{}}},_sDefaultDelegate:"sap/ui/mdc/field/FieldValueHelpDelegate"});k._init=function(){F._init.apply(this,arguments);D=undefined;B=undefined;V=undefined;f=undefined;g=undefined;h=undefined;};k.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver=new M(n.bind(this));this._oObserver.observe(this,{properties:["filterValue","conditions","showConditionPanel","title","filterFields"],aggregations:["content","filterBar","inParameters"]});this.setBindingContext(null);};k.prototype.exit=function(){F.prototype.exit.apply(this,arguments);if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;}if(this._oFilterConditionModel){this._oFilterConditionModel.destroy();delete this._oFilterConditionModel;}this._oObserver.disconnect();this._oObserver=undefined;};k.prototype.invalidate=function(i){if(i){var j=this.getContent();var l1=this.getAggregation("_dialog");if(j&&i===j){var m1=this.getAggregation("_popover");if(l1&&l1.isOpen()){var n1=l1.getContent()[0];n1.invalidate(i);}else if(m1&&m1.isOpen()){m1.invalidate(i);}return;}var o1=this.getFilterBar();if((l1&&i===l1)||(o1&&i===o1)){if(i.bOutput&&!this._bIsBeingDestroyed){var p1=this.getParent();if(p1){p1.invalidate(this);}}return;}}F.prototype.invalidate.apply(this,arguments);};k.prototype.connect=function(i){F.prototype.connect.apply(this,arguments);j1.call(this);e1.call(this,this.getShowConditionPanel());return this;};k.prototype.getIcon=function(){if(this.getNoDialog()){return"sap-icon://slim-arrow-down";}else{return"sap-icon://value-help";}};k.prototype._createPopover=function(){var i=F.prototype._createPopover.apply(this,arguments);if(i){var j=this.getContent();if(j){j.initialize(true);}i._getAllContent=function(){var l1=this.getParent();var m1=[];if(l1){var n1=i1.call(l1);if(n1){m1.push(n1);}}return m1;};if(this._bNavigate){this.navigate(this._iStep);}}return i;};k.prototype._handleAfterOpen=function(i){F.prototype._handleAfterOpen.apply(this,arguments);var j=this.getContent();if(j){j.fieldHelpOpen(true);}};k.prototype.open=function(i){if(this.getNoDialog()&&!i){i=true;}this._bUseFilterBar=!i;j1.call(this);var j=this.getContent();var l1=function(){if(this._bOpenAfterPromise){delete this._bOpenAfterPromise;this.open(i);}}.bind(this);var m1=this._bOpen?this._callContentRequest(!!i,l1):this._fireOpen(!!i,l1);delete this._bOpen;if(!m1){if(i){this._getPopover();}else{$.call(this);}if(j&&j.getFilterEnabled()&&!this._oFilterConditionModel){Q.call(this);}this._bOpenAfterPromise=true;return;}this._bOpenHandled=true;j=this.getContent();if(j&&j.getFilterEnabled()&&!this._bNavigateRunning){if(!j.isSuspended()||i){this._bApplyFilter=true;}if(!this._oFilterConditionModel){Q.call(this);}else{h1.call(this);}}if(this._bUpdateFilterAfterClose){this._bUpdateFilterAfterClose=false;v.call(this,this.getFilterValue());}if(i){if(!j){this._bOpenIfContent=true;}else{j.fieldHelpOpen(i);if(this._oFilterConditionModel&&!this.getFilterValue()&&!this._bNavigateRunning){this._oFilterConditionModel.checkUpdate(true,true);}F.prototype.open.apply(this,[i]);}}else{g1.call(this);var n1=this.getAggregation("_popover");if(n1){if(n1.isOpen()){this.close();}n1.$().remove();}var o1=$.call(this);if(o1){var p1=o1.getContent()[0];p1.setShowTokenizer(this.getMaxConditions()!==1&&!!j);p1.setFormatOptions(this._getFormatOptions());p1.bindProperty("conditions",{path:"$help>/conditions"});var q1=this.getFilterFields();if(q1){p1.bindProperty("filterConditions",{path:"filter>/conditions/"+q1});}if(j){j.fieldHelpOpen(false);u.call(this);}this._aOldConditions=this.getConditions();o1.open();this._bDialogOpen=true;}else{this._bOpen=true;}}this._bOpenHandled=false;return;};k.prototype.toggleOpen=function(i){if(this.getNoDialog()&&!i){i=true;}if(i){F.prototype.toggleOpen.apply(this,[i]);}else if(this._bOpen||this._bOpenIfContent||this._bOpenAfterPromise){delete this._bOpen;delete this._bSuggestion;delete this._bOpenIfContent;delete this._bOpenAfterPromise;}else{var j=$.call(this);if(j){if(j.isOpen()){var l1=j.oPopup.getOpenState();if(l1!=="CLOSED"&&l1!=="CLOSING"){this.close();}else{this._bReopen=true;}}else{this.open(i);}}else{this.open(i);}}};k.prototype.close=function(){if(!this._bDialogOpen){F.prototype.close.apply(this,arguments);}else{this._bUseFilterBar=false;var i=this.getAggregation("_dialog");if(i){this._bClosing=true;i.close();var j=i.getContent()[0];j.unbindProperty("conditions",true);j.unbindProperty("filterConditions",true);}this._bReopen=false;delete this._bOpen;delete this._bOpenAfterPromise;}};k.prototype.isOpen=function(i){var j=F.prototype.isOpen.apply(this,arguments);if(!j&&(!i||!this._bClosing)){var l1=this.getAggregation("_dialog");if(l1){j=l1.isOpen();}}return j;};function _(){if(!this._oFilterConditionModel){return;}var i=this._oFilterConditionModel.getAllConditions();var j=false;for(var l1 in i){if(i[l1].length>0){j=true;break;}}if(j){this._oFilterConditionModel.removeAllConditions();}}k.prototype._handleAfterClose=function(i){var j=this.getContent();if(j){if(!j.getAsyncKeyText()){_.call(this);}j.fieldHelpClose();}this._bApplyFilter=false;F.prototype._handleAfterClose.apply(this,arguments);};function n(i){if(i.object==this){var j;if(i.name==="content"){Z.call(this,i.mutation,i.child);}if(i.name==="filterBar"){f1.call(this,i.mutation,i.child);}if(i.name==="conditions"){t.call(this,i.current);}if(i.name==="filterValue"){if(this._bClosing){this._bUpdateFilterAfterClose=true;}else{v.call(this,i.current);}}if(i.name==="showConditionPanel"){e1.call(this,i.current);}if(i.name==="title"){j=this.getAggregation("_dialog");if(j){j.setTitle(i.current);}}if(i.name==="filterFields"){j=this.getAggregation("_dialog");if(j){var l1=j.getContent()[0];l1.setSearchEnabled(!!i.current);if(j.isOpen()){if(i.current){l1.bindProperty("filterConditions",{path:"filter>/conditions/"+i.current});}else{l1.unbindProperty("filterConditions",true);}}}}if(i.name==="inParameters"){w.call(this,i.child,i.mutation);}}else if(i.object.isA("sap.ui.mdc.field.InParameter")){if(i.name==="value"){z.call(this,i.object.getHelpPath(),i.current,i.old,i.object.getUseConditions());}if(i.name==="helpPath"){A.call(this,i.current,i.old,i.object.getValue(),i.object.getUseConditions());}}}k.prototype.openByTyping=function(){if(!this._bDetermineSearchSupportedCalled&&!this.isOpen()&&!this._bOpen&&!this._bOpenIfContent&&!this._bOpenAfterPromise){this._loadDelegate();if(this.DELEGATE){return o.call(this);}else if(this.oDelegatePromise){this._bDetermineSearchSupportedCalled=true;return this.oDelegatePromise.then(function(){return o.call(this);}.bind(this));}}return!!this.getFilterFields();};function o(){this.fireOpen({suggestion:true});this._bDetermineSearchSupportedCalled=true;var i=this.DELEGATE.determineSearchSupported(this.getDelegate().payload,this);if(i instanceof Promise){return i.then(function(){return!!this.getFilterFields();}.bind(this));}else{return!!this.getFilterFields();}}k.prototype.isFocusInHelp=function(){if(!this.getNoDialog()){var i=this.getAggregation("_dialog");if((i&&i.isOpen())||(this._bDialogRequested&&this._bOpen)){return true;}}if(this._bFocusPopover){return true;}return false;};k.prototype.navigate=function(i){var j=this.getContent();var l1=this.getAggregation("_popover");j1.call(this);if(!l1||!l1.isOpen()){var m1=function(){this.navigate(i);}.bind(this);var n1=this._bNavigate?this._callContentRequest(true,m1):this._fireOpen(true,m1);if(!n1){j=this.getContent();this._bNavigate=false;this._iStep=null;if(j){this._getPopover();if(!this._oFilterConditionModel){Q.call(this);}}return;}}this._bNavigate=false;this._iStep=null;j=this.getContent();if(j){l1=this._getPopover();this._bApplyFilter=true;this._bNavigateRunning=true;if(!this._oFilterConditionModel){Q.call(this);}else{E.call(this);}this._oFilterConditionModel.checkUpdate(true,true);}if(!l1){this._bNavigate=true;this._iStep=i;return;}if(j){j.navigate(i);}};function p(i){var j=this._getPopover();var l1=i.getParameter("key");var m1=i.getParameter("description");var n1=i.getParameter("inParameters");var o1=i.getParameter("outParameters");var p1;if(l1===undefined){this._bFocusPopover=true;}if(!j.isOpen()){this._bOpenHandled=true;this.open(true);this._bOpenHandled=false;}this._bNavigateRunning=false;if(l1===undefined){this._bFocusPopover=false;return;}p1=C.createItemCondition(l1,m1);p1.validated=b.Validated;if(n1){p1.inParameters=G.call(this,n1);}if(o1){p1.outParameters=H.call(this,o1);}this.setProperty("conditions",[p1],true);this.fireNavigate({value:m1,key:l1,condition:p1});}k.prototype._getTextOrKey=function(i,j,l1,m1,n1){var o1="";var p1=this.getContent();if(p1){var q1=p1.getListBinding();if(!q1){this.fireDataRequested();}var r1=this.getBindingContext();var s1=false;if(!this.isOpen()&&l1&&r1!==l1&&((!m1&&this.getInParameters().length>0)||(j&&!n1&&this.getOutParameters().length>0))){s1=true;this._bNoInOutFilterUpdate=true;this.setBindingContext(l1);}o1=S.resolve().then(function(){if(j){return p1.getTextForKey(i,J.call(this,m1),K.call(this,n1,true));}else{return p1.getKeyForText(i,J.call(this));}}.bind(this)).then(function(o1){return q.call(this,o1);}.bind(this)).unwrap();if(s1){j1.call(this);this._bNoInOutFilterUpdate=false;}}return o1;};function q(i){if(i&&typeof i==="object"){i=m({},i);if(i.inParameters){i.inParameters=G.call(this,i.inParameters);}if(i.outParameters){i.outParameters=H.call(this,i.outParameters);}}return i;}k.prototype.isUsableForValidation=function(){var i=this.getContent();return!!i;};function r(l1){var m1=l1.getParameter("selectedItems");var n1=l1.getParameter("itemPress");var o1;var p1=this.getConditions();var q1;var i=0;var j=0;var r1=false;var s1=this.getMaxConditions();for(i=p1.length-1;i>=0;i--){q1=p1[i];q1.inParameters=J.call(this,q1.inParameters);q1.outParameters=K.call(this,q1.outParameters);if(q1.validated===b.Validated){r1=false;for(j=0;j<m1.length;j++){o1=m1[j];if(q1.values[0]===o1.key&&(!q1.inParameters||!o1.inParameters||d(q1.inParameters,o1.inParameters))&&(!q1.outParameters||!o1.outParameters||d(q1.outParameters,o1.outParameters))){r1=true;if(q1.values[1]!==o1.description&&o1.description){if(q1.values.length===1){q1.values.push(o1.description);}else{q1.values[1]=o1.description;}}break;}}if(!r1){p1.splice(i,1);}}}for(i=0;i<m1.length;i++){o1=m1[i];r1=false;for(j=0;j<p1.length;j++){q1=p1[j];if(q1.validated===b.Validated&&q1.values[0]===o1.key&&(!q1.inParameters||d(q1.inParameters,o1.inParameters))&&(!q1.outParameters||d(q1.outParameters,o1.outParameters))){r1=true;q1.inParameters=o1.inParameters;q1.outParameters=o1.outParameters;break;}}if(!r1){q1=C.createItemCondition(o1.key,o1.description,o1.inParameters,o1.outParameters);q1.validated=b.Validated;p1.push(q1);}}if(s1>0&&p1.length>s1){p1.splice(0,p1.length-s1);}for(i=0;i<p1.length;i++){q1=p1[i];if(q1.inParameters){q1.inParameters=G.call(this,q1.inParameters);}else{delete q1.inParameters;}if(q1.outParameters){q1.outParameters=H.call(this,q1.outParameters);}else{delete q1.outParameters;}}if(this._bDialogOpen){this.setProperty("conditions",p1,true);}else{var t1=false;var u1=false;if(this.getMaxConditions()===1||n1){this.close();u1=true;}if(this.getMaxConditions()===1){t1=true;}this.setProperty("conditions",p1,true);this.fireSelect({conditions:p1,add:t1,close:u1});}}function s(i){var j=i.getParameter("contentChange");var l1=this.getContent();var m1=l1.getAsyncKeyText();if(j){var n1=this.getAggregation("_popover");var o1=this.getAggregation("_dialog");if(l1){if(l1.getFilterEnabled()&&!this._oFilterConditionModel&&((n1&&this._bOpenIfContent)||o1)){Q.call(this);}if(n1&&this._bOpenIfContent){var p1=this._getField();if(p1){l1.fieldHelpOpen(true);n1.openBy(this._getControlForSuggestion());N.call(this);}this._bOpenIfContent=false;}else if(o1){var q1=o1.getContent()[0];Y.call(this,q1,l1.getDialogContent());}}}if(!m1){this.fireDataUpdate();}}function t(j){var l1=false;for(var i=0;i<j.length;i++){var m1=j[i];if(!m1.validated){a.checkConditionValidated(m1);l1=true;}}if(l1){this.setConditions(j);}else{u.call(this);}}function u(){if(!this._oField){return;}var j=this.getContent();if(j){var l1=this.getConditions();var m1=[];for(var i=0;i<l1.length;i++){var n1=l1[i];if(n1.validated===b.Validated){m1.push({key:n1.values[0],description:n1.values[1],inParameters:J.call(this,n1.inParameters),outParameters:K.call(this,n1.outParameters)});}}if(!d(m1,j.getSelectedItems())){j.setSelectedItems(m1);}}}function v(i){if(!this._oFilterConditionModel){return;}var j=this.getFilterFields();if(!j){return;}var l1=this._oFilterConditionModel.getConditions(j);var m1=l1.length>0?l1[0].values[0]:"";if(i===m1){return;}if(i){this._bOwnFilterChange=true;}this._oFilterConditionModel.removeAllConditions(j);i=i.trim();if(i){this._bOwnFilterChange=false;var n1=C.createCondition("StartsWith",[i],undefined,undefined,b.NotValidated);this._oFilterConditionModel.addCondition(j,n1);}}function w(i,j){var l1=i.getHelpPath();var m1=false;if(j==="remove"){this._oObserver.unobserve(i);if(this._getField()&&this.isOpen()){m1=y.call(this,l1);}}else{this._oObserver.observe(i,{properties:true});if(this._getField()&&this.isOpen()){var n1=i.getValue();var o1=i.getUseConditions();m1=y.call(this,l1);m1=x.call(this,l1,n1,o1)||m1;u.call(this);}}}function x(j,l1,m1){var n1;var o1;var p1;var q1=false;if(this._oFilterConditionModel&&j&&l1){n1=this.getFilterBar();if(this._bUseFilterBar&&n1){o1=n1.getConditions();if(!o1[j]){o1[j]=[];}}if(m1){if(Array.isArray(l1)){for(var i=0;i<l1.length;i++){p1=m({},l1[i]);if(p1.inParameters){p1.inParameters=J.call(this,p1.inParameters);}if(p1.outParameters){p1.outParameters=K.call(this,p1.outParameters);}this._oFilterConditionModel.addCondition(j,p1);if(this._bUseFilterBar&&n1){o1[j].push(l1[i]);}q1=true;}}}else{p1=C.createItemCondition(l1);p1.validated=b.Validated;this._oFilterConditionModel.addCondition(j,p1);if(this._bUseFilterBar&&n1){o1[j].push(p1);}q1=true;}}if(q1&&this._bUseFilterBar&&n1){n1.setConditions(o1);}return q1;}function y(i){var j=false;if(this._oFilterConditionModel&&i&&this._oFilterConditionModel.getConditions(i).length>0){this._oFilterConditionModel.removeAllConditions(i);j=true;}var l1=this.getFilterBar();if(this._bUseFilterBar&&l1){var m1=l1.getConditions();if(m1[i]&&m1[i].length>0){m1[i]=[];l1.setConditions(m1);j=true;}}return j;}function z(i,j,l1,m1){if(this._bNoInOutFilterUpdate){return;}if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.sUpdateTimer=undefined;this.fireDataUpdate();}.bind(this),0);}if(!this._getField()||!this.isOpen()){return;}var n1=false;n1=y.call(this,i);n1=x.call(this,i,j,m1)||n1;}function A(i,j,l1,m1){if(!this._getField()||!this.isOpen()){return;}var n1=false;n1=y.call(this,j);n1=x.call(this,i,l1,m1)||n1;}function E(){var j=this.getInParameters();var l1=false;for(var i=0;i<j.length;i++){var m1=j[i];var n1=m1.getHelpPath();var o1=m1.getValue();var p1=m1.getUseConditions();l1=y.call(this,n1)||l1;l1=x.call(this,n1,o1,p1)||l1;}if(this._oFilterConditionModel&&!l1&&this._bApplyFilter&&this._bPendingFilterUpdate){this._bPendingFilterUpdate=false;this._oFilterConditionModel.checkUpdate(true,true);}}k.prototype.onFieldChange=function(){var l1=this.getOutParameters();var m1=this.getConditions();j1.call(this);for(var i=0;i<m1.length;i++){var n1=m1[i];if(n1.outParameters){for(var o1 in n1.outParameters){for(var j=0;j<l1.length;j++){var p1=l1[j];var q1=p1.getValue();var r1=p1.getUseConditions();var s1=true;if(p1.getMode()===e.WhenEmpty){if(r1){s1=!q1||(Array.isArray(q1)&&q1.length===0);}else{s1=!q1;}}if(s1){if(r1){var t1;if(!p1.getHelpPath()){t1=C.createCondition("EQ",[p1.getFixedValue()],undefined,undefined,b.NotValidated);}else if(p1.getFieldPath()===o1){t1=C.createCondition("EQ",[n1.outParameters[o1]],undefined,undefined,b.Validated);}else{continue;}if(!q1){q1=[];}if(!Array.isArray(q1)){throw new Error("Value on OutParameter must be an array "+p1);}if(a.indexOfCondition(t1,q1)<0){t1.validated=b.Validated;q1.push(t1);p1.setValue(q1);}}else{if(!p1.getHelpPath()){p1.setValue(p1.getFixedValue());}else if(p1.getFieldPath()===o1){p1.setValue(n1.outParameters[o1]);}}}}}}}};function G(i){return I.call(this,i,this.getInParameters());}function H(i){return I.call(this,i,this.getOutParameters());}function I(j,l1){if(!j||l1.length===0){return null;}var m1={};for(var i=0;i<l1.length;i++){var n1=l1[i];var o1=n1.getHelpPath();var p1=n1.getFieldPath();if(o1&&p1){for(var q1 in j){if(o1===q1){m1[p1]=j[q1];break;}}}else if(!o1&&p1&&n1.getFixedValue){m1[p1]=n1.getFixedValue();}}return m1;}function J(i){return L.call(this,i,this.getInParameters());}function K(i,j){return L.call(this,i,this.getOutParameters(),j);}function L(j,l1,m1){var n1;var o1;var p1;var q1;var i=0;if(l1.length>0){if(!j){if(!m1){for(i=0;i<l1.length;i++){o1=l1[i];p1=o1.getHelpPath();var r1=o1.getValue();if(p1&&r1){if(!n1){n1={};}if(o1.getUseConditions()){if(r1.length>0){n1[p1]=r1[0].values[0];}}else{n1[p1]=r1;}}}}}else{for(var s1 in j){for(i=0;i<l1.length;i++){o1=l1[i];p1=o1.getHelpPath();q1=o1.getFieldPath();if(q1&&q1===s1&&p1){if(!n1){n1={};}n1[p1]=j[s1];}}}}}return n1;}function N(){if(!this._oFilterConditionModel||(!this.isOpen()&&!this._bNavigateRunning&&!this._bOpen)||this._bClosing||!this._bApplyFilter){this._bPendingFilterUpdate=true;return;}var i=this.getContent();if(i){var j=this._oFilterConditionModel.getAllConditions();var l1=c.createConditionTypesMapFromFilterBar(j,this.getFilterBar());var m1=c.createFilters(j,l1);var n1=[];var o1=this._oFilterConditionModel.getConditions("$search");var p1;if(m1){n1.push(m1);}if(o1.length>0){p1=o1[0].values[0];}i.applyFilters(n1,p1);}}function P(i){if(this._bOwnFilterChange){return;}var j=this.getFilterFields();if(j&&!this._bUpdateFilterAfterClose){var l1=this._oFilterConditionModel.getConditions(j);var m1=l1.length>0?l1[0].values[0]:"";if(m1!==this.getFilterValue()){this.setProperty("filterValue",m1,true);}}N.call(this);}function Q(){if(!g&&!this._bFilterConditionModelRequested){g=sap.ui.require("sap/ui/mdc/condition/ConditionModel");if(!g){sap.ui.require(["sap/ui/mdc/condition/ConditionModel"],T.bind(this));this._bFilterConditionModelRequested=true;}}if(g){var i=this.getFilterValue();this._oFilterConditionModel=new g();if(i){v.call(this,i);}E.call(this);var j=this._oFilterConditionModel.bindProperty("/conditions",this._oFilterConditionModel.getContext("/conditions"));j.attachChange(P.bind(this));this.setModel(this._oFilterConditionModel,"filter");}}function T(i){g=i;this._bFilterConditionModelRequested=false;if(!this._bIsBeingDestroyed){Q.call(this);}}k.prototype.getMaxConditions=function(){if(this._oField&&this._oField.getMaxConditionsForHelp){return this._oField.getMaxConditionsForHelp();}else if(this._oField&&this._oField.getMaxConditions){return this._oField.getMaxConditions();}else{return 1;}};k.prototype.getDisplay=function(){if(this._oField&&this._oField.getDisplay){return this._oField.getDisplay();}};k.prototype.getRequired=function(){if(this._oField&&this._oField.getRequired){return this._oField.getRequired();}else{return false;}};k.prototype.getDataType=function(){if(this._oField.getDataType){return this._oField.getDataType();}else{return"sap.ui.model.type.String";}};k.prototype._getFormatOptions=function(){if(this._oField&&this._oField._getFormatOptions){return this._oField._getFormatOptions();}else{return{};}};k.prototype._getKeyPath=function(){var i=this.getKeyPath();if(!i&&this._oField&&this._oField.getFieldPath&&this._oField.getFieldPath()){i=this._oField.getFieldPath();}return i;};k.prototype.clone=function(i,j){var l1=this.getContent();var m1=this.getFilterBar();if(l1){l1.detachEvent("navigate",p,this);l1.detachEvent("selectionChange",r,this);l1.detachEvent("dataUpdate",s,this);}if(m1){m1.detachEvent("search",g1,this);}var n1=F.prototype.clone.apply(this,arguments);if(l1){l1.attachEvent("navigate",p,this);l1.attachEvent("selectionChange",r,this);l1.attachEvent("dataUpdate",s,this);}if(m1){m1.attachEvent("search",g1,this);}return n1;};function U(){var i;if((!D||!B||!V||!f)&&!this._bDialogRequested){D=sap.ui.require("sap/m/Dialog");B=sap.ui.require("sap/m/Button");V=sap.ui.require("sap/ui/mdc/field/ValueHelpPanel");f=sap.ui.require("sap/ui/mdc/field/DefineConditionPanel");h=sap.ui.require("sap/ui/model/base/ManagedObjectModel");if(!D||!B||!V||!f||!h){sap.ui.require(["sap/m/Dialog","sap/m/Button","sap/ui/mdc/field/ValueHelpPanel","sap/ui/mdc/field/DefineConditionPanel","sap/ui/model/base/ManagedObjectModel"],W.bind(this));this._bDialogRequested=true;}}if(D&&B&&V&&f&&h&&!this._bDialogRequested){if(!this._oResourceBundle){this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");}var j=new B(this.getId()+"-ok",{text:this._oResourceBundle.getText("valuehelp.OK"),type:sap.m.ButtonType.Emphasized,press:a1.bind(this)});var l1=new B(this.getId()+"-cancel",{text:this._oResourceBundle.getText("valuehelp.CANCEL"),press:b1.bind(this)});this._oManagedObjectModel=new h(this);var m1=X.call(this);i=new D(this.getId()+"-dialog",{contentHeight:"600px",contentWidth:"1000px",horizontalScrolling:false,verticalScrolling:false,title:this.getTitle(),resizable:true,draggable:true,content:[m1],afterOpen:c1.bind(this),afterClose:d1.bind(this),buttons:[j,l1]});this.setAggregation("_dialog",i,true);i.setModel(new R({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n");e1.call(this,this.getShowConditionPanel());}return i;}function W(i,j,l1,m1,n1){D=i;B=j;V=l1;f=m1;h=n1;this._bDialogRequested=false;if(!this._bIsBeingDestroyed){U.call(this);if(this._bOpen){this.open();}}}function X(){var i=this.getContent();var j=this.getFilterBar();var l1=new V(this.getId()+"-VHP",{height:"100%",showFilterbar:!!j,searchEnabled:!!this.getFilterFields(),formatOptions:this._getFormatOptions(),search:k1.bind(this)});l1.setModel(this._oManagedObjectModel,"$help");if(i){i.initialize(false);Y.call(this,l1,i.getDialogContent());}if(j){l1.setFilterbar(j);}return l1;}function Y(i,j){i.setTable(j);}function Z(i,j){var l1=this.getAggregation("_popover");var m1=this.getAggregation("_dialog");if(i==="remove"){j.detachEvent("navigate",p,this);j.detachEvent("selectionChange",r,this);j.detachEvent("dataUpdate",s,this);j=undefined;}else{j.attachEvent("navigate",p,this);j.attachEvent("selectionChange",r,this);j.attachEvent("dataUpdate",s,this);u.call(this);}this.fireDataUpdate();if(this._bNavigate){this.navigate(this._iStep);}else if(l1){l1.invalidate();var n1=this.getFilterValue();if(n1){v.call(this,n1);}E.call(this);if(j&&j.getFilterEnabled()&&!this._oFilterConditionModel){Q.call(this);}if(j&&this._bOpenIfContent){j.initialize(true);var o1=this._getField();if(o1){j.fieldHelpOpen(true);l1.openBy(this._getControlForSuggestion());}this._bOpenIfContent=false;}}else if(j&&this._bOpenIfContent){this._bOpenIfContent=false;this.open(true);}if(m1){if(j){j.initialize(false);if(j.getFilterEnabled()&&!this._oFilterConditionModel){Q.call(this);}var p1=m1.getContent()[0];p1.setShowTokenizer(this.getMaxConditions()!==1);Y.call(this,p1,j.getDialogContent());if(m1.isOpen()||this._bOpen){j.fieldHelpOpen(false);}}}}function $(){var i=this.getAggregation("_dialog");if(!i){i=U.call(this);}return i;}function a1(i){this.close();var j=this.getConditions();j=C._removeEmptyConditions(j);a.updateConditionsValues(j,this._getFormatOptions().operators);this._bNoConditionModelUpdate=true;this.setProperty("conditions",j,true);this._bOK=true;}function b1(i){this.close();this.setProperty("conditions",this._aOldConditions,true);}function c1(i){}function d1(i){this._bDialogOpen=false;this._aOldConditions=undefined;this._bUseFilterBar=false;this._bApplyFilter=false;this._handleAfterClose(i);if(this._bOK){var j=this.getConditions();this.fireSelect({conditions:j,add:false,close:true});}this._bOK=undefined;}function e1(i){var j=this.getAggregation("_dialog");if(j&&this._oField){var l1=j.getContent()[0];var m1=this._getFormatOptions().operators;if(i&&!a.onlyEQ(m1)){if(!l1._oDefineConditionPanel){var n1=new f(this.getId()+"-DCP");l1.setDefineConditions(n1);}}else{l1.setDefineConditions();}}}function f1(i,j){if(i==="remove"){j.detachEvent("search",g1,this);j=undefined;}else{j.attachEvent("search",g1,this);}var l1=this.getAggregation("_dialog");if(l1){var m1=l1.getContent()[0];m1.setFilterbar(j);m1.setShowFilterbar(!!j);E.call(this);g1.call(this);}}function g1(j){if(!this._oFilterConditionModel||!this._bUseFilterBar){return;}var l1=this.getFilterBar();if(l1){var m1=this._oFilterConditionModel.getAllConditions();var n1=l1.getConditions();var o1=this.getFilterFields();var i=0;var p1;var q1;for(p1 in m1){if(p1!==o1){for(i=0;i<m1[p1].length;i++){q1=m({},m1[p1][i]);if(!n1[p1]||a.indexOfCondition(q1,n1[p1])<0){this._oFilterConditionModel.removeCondition(p1,q1);}}}}for(p1 in n1){for(i=0;i<n1[p1].length;i++){q1=m({},n1[p1][i]);if(!m1[p1]||a.indexOfCondition(q1,m1[p1])<0){this._oFilterConditionModel.addCondition(p1,q1);}}}if(!this._bApplyFilter&&(j||l1.getLiveMode())){this._bApplyFilter=true;this._oFilterConditionModel.checkUpdate(true,true);}}}function h1(){if(!this._oFilterConditionModel){return;}var i=this.getFilterBar();if(i){var j=this._oFilterConditionModel.getAllConditions();var l1=i.getConditions();var m1=this.getFilterFields();var n1=false;var o1;for(o1 in l1){if(o1!==m1){if(j[o1]&&j[o1].length>0){this._oFilterConditionModel.removeAllConditions(o1);}if(l1[o1].length>0){l1[o1]=[];n1=true;}}}j=this._oFilterConditionModel.getAllConditions();for(o1 in j){if(o1!==m1){if(j[o1].length>0){this._oFilterConditionModel.removeAllConditions(o1);}}}if(n1){i.setConditions(l1);}}E.call(this);}function i1(){var i=this.getContent();if(i){return i.getSuggestionContent();}}function j1(){var i=this._oField?this._oField.getBindingContext():null;if(this.getBindingContext()!==i){this.setBindingContext(i);}}function k1(i){this._bApplyFilter=true;this._oFilterConditionModel.checkUpdate(true,true);}k.prototype.getScrollDelegate=function(){var i=this.getAggregation("_dialog");if(i&&(i.isOpen()||i.oPopup.getOpenState()==="Opening")){var j=this.getContent();var l1=j&&j.getDialogContent();if(l1&&l1.getScrollDelegate){return l1.getScrollDelegate();}else{return undefined;}}else{return F.prototype.getScrollDelegate.apply(this,arguments);}};k.prototype._fireOpen=function(i){if(!this._bOpenHandled){return F.prototype._fireOpen.apply(this,arguments);}return true;};return k;});
