/*
* ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
*/
sap.ui.define(['sap/ui/mdc/library','./AdaptationController','./FlexUtil','sap/ui/fl/apply/api/FlexRuntimeInfoAPI','sap/ui/mdc/condition/FilterOperatorUtil','sap/base/Log'],function(L,A,F,a,b,c){"use strict";var o=new A();var S={applyExternalState:function(C,s){return new Promise(function(r,d){var v=this.checkXStateInterface(C);if(!v){d("The control needs to implement IxState");}S.retrieveExternalState(C).then(function(e){var f=e.hasOwnProperty("sort");var g=e.hasOwnProperty("filter");var i=e.hasOwnProperty("items");var h,j,I,k=[];if(f&&s.sort){h=o.createSortChanges(s.sort);}if(g&&s.filter){this.checkConditionOperatorSanity(s.filter);j=o.createConditionChanges(s.filter);}if(i&&s.items&&s.items.length>0){I=o.createItemChanges(s.items);}Promise.all([h,j,I]).then(function(R){R.forEach(function(l){if(l&&l.length>0){k=k.concat(l);}});r(F.handleChanges(k));});}.bind(this),d);}.bind(this));},retrieveExternalState:function(C){return new Promise(function(r,d){o.setAdaptationControl(C);o.setStateRetriever(C.getCurrentState);o.setItemConfig(C._getAdaptationController().getItemConfig());var v=this.checkXStateInterface(C);if(!v){d("The control needs to implement then interface IxState.");}C.waitForInitialization().then(function(){a.waitForChanges({element:C}).then(function(){r(C.getCurrentState());});});}.bind(this));},checkXStateInterface:function(C){if(!C){return false;}var s=C.getMetadata().getName().substring(11);var i=Object.keys(L[s+"P13nMode"]).length;if(!C.getP13nMode()||(C.getP13nMode().length!==i)){throw new Error("Please enable all available options in the 'p13nMode' property to use StateUtil");}if(!a.isFlexSupported({element:C})){return false;}if(!C.isA("sap.ui.mdc.IxState")){return false;}return true;},checkConditionOperatorSanity:function(C){for(var f in C){var d=C[f];for(var i=0;i<d.length;i++){var e=d[i];var O=e.operator;if(!b.getOperator(O)){d.splice(i,1);if(C[f].length==0){delete C[f];}c.warning("The provided conditions for field '"+f+"' contain unsupported operators - these conditions will be neglected.");}}}}};return S;});
