/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","./Utilities","./thirdparty/three","./thirdparty/ColladaLoader","./thirdparty/DecalGeometry","./thirdparty/html2canvas"],function(q,B,U,T,C,D,h){"use strict";var t="sap.ui.vbm.adapter3d.SceneBuilder";var l=q.sap.log;var d=T.Math.degToRad;var a=T.Box3;var F=T.Face3;var M=T.Matrix4;var V=T.Vector2;var b=T.Vector3;var r="_sapRefCount";var c;var e;var f;var n;var g=U.toBoolean;var j=U.toFloat;var k=U.toVector3;var m=U.applyColor;var o=U.makeDataUri;var p=U.applyColorBorder;var s=U.base64ToArrayBuffer;var S=B.extend("sap.ui.vbm.adapter3d.SceneBuilder",{constructor:function(i,v){B.call(this);this._context=i;this._viewport=v;this._root=v.getRoot();this._scene=v.getScene();this._textureLoader=null;this._colladaLoader=null;this._glTFLoader=null;this._decalHelper=null;this._textures=new Map();this._boxGeometryWith4SidedTexture=null;this._boxGeometryWith6SidedTexture=null;this._cylinderGeometryWithCaps=null;this._cylinderGeometry=null;this._cylinderGeometryDefaultSize=0.1;}});S.prototype.destroy=function(){if(this._decalHelper){this._decalHelper.geometry.dispose();this._scene.remove(this._decalHelper);this._decalHelper=null;}this._root=null;this._scene=null;this._viewport=null;this._context=null;B.prototype.destroy.call(this);};S.prototype.synchronize=function(){var i=this;return new Promise(function(u,v){var w=new Map();var x=function(N){if(w.has(N)){w.get(N).refCount+=1;}else{w.set(N,{object3D:null,refCount:1});}};var y=new Set();var z=[];var A=[];var E=sap.ui.vbm.findInArray(i._context.windows,function(E){return E.type==="default";});var G=E&&sap.ui.vbm.findInArray(i._context.scenes,function(G){return G.id===E.refScene;});if(!G){u();return;}i._context.scene=G;if(i._context.setupView){var H=i._context.setupView;i._setupView(H.position,H.zoom,H.pitch,H.yaw,H.home,H.flyTo);i._context.setupView=undefined;}var I=i._context.voQueues.toAdd.get(G)||[];var J=i._context.voQueues.toUpdate.get(G)||[];var K=i._context.voQueues.toRemove.get(G)||[];var L=[].concat(I,J);L.forEach(function(N){if(N.isModel&&N.model&&N.model!==N._lastModel){x(N.model);}if(N.texture&&N.texture!==N._lastTexture){y.add(N.texture);}if(N.textureCap&&N.textureCap!==N._lastTextureCap){y.add(N.textureCap);}if(N.isDecal&&N.text&&(N.text!==N._lastText||N.size!==N._lastSize)){A.push(N);}});i._loadTextures(y).then(function(){return i._loadModels(w);}).then(function(){return i._renderTexts(A);}).then(function(){K.forEach(i._destroyVisualObjectInstance.bind(i));J.forEach(i._updateVisualObjectInstance.bind(i,w,z));I.forEach(i._addVisualObjectInstance.bind(i,w,z));var N=new Map();i._root.traverse(function(O){if(O._sapInstance&&O._sapInstance.dataInstance){var P=O._sapInstance.voGroup.keyAttributeName;if(P){var Q=O._sapInstance.dataInstance[P];if(Q&&!N.get(Q)){N.set(Q,O);}var R=O._sapInstance.voGroup.id+"."+Q;if(R&&!N.get(R)){N.set(R,O);}}}});z.forEach(function(O){var P=N.get(O.target);if(P){var Q=i._findMesh(P);if(Q){i._createDecal(O,Q);i._assignDecalProperties(O);if(O.object3D){i._scene.add(O.object3D);}}else{l.error("Unable to create decal: target object does not have geometry","",t);}}else{l.error("Unable to create decal: target object is missing","",t);}});i._cleanupCache();u();}).catch(function(N){v(N);});});};S.prototype._findMesh=function(i){var u=null;i.traverse(function(v){if(!u&&v.isMesh){u=v;}});return u;};S.prototype._getGeometrySize=function(){return 2.0;};S.prototype._getZoomFactor=function(i,u){var v=new b();v.subVectors(u,i);return(this._getGeometrySize()*2)/v.length();};S.prototype._setupView=function(i,z,u,y,v,w){var x=(i||"0;0;0").split(";");i=new b(parseFloat(x[0]),parseFloat(x[1]),parseFloat(x[2]));z=parseFloat(z||"1");if(z===0){z=1;}else if(z<0){z=0.1;}var A=this._getGeometrySize()*2/z;u=parseFloat(u||"0");y=parseFloat(y||"0");u=(u%180===0?u+1:u);var E=new M();E.makeRotationX(d(u+180));var G=new M();G.makeRotationZ(d(-(y+180)));var H=new M();H.multiplyMatrices(G,E);var I=new b(0,0,-5);var J=new b(0,0,0);var K=new b();K.subVectors(J,I);K.normalize();K.multiplyScalar(A);K.applyMatrix4(H);K.add(i);J.add(i);var L={zoom:1.0,target:new b(-J.x,-J.z,J.y),position:new b(-K.x,-K.z,K.y)};if(v){this._viewport._setCameraHome(L);this._viewport._applyCamera(L,w);}else{this._viewport._applyCamera(L,w);}};S.prototype._getDecalTextKey=function(i){return i.size+";"+i.text;};S.prototype._renderTexts=function(i){var u=[];i.forEach(function(v){if(!this._textures.has(this._getDecalTextKey(v))){u.push(this._renderText(v));}},this);return Promise.all(u);};S.prototype._renderText=function(i){var u=this;return new Promise(function(v,w){var x=k(i.size);x=new b(x[0],x[1],x[2]);if(x.length()<1E-6){l.error("Unable render text to html: decal size is invalid","",t);v();}else{var y=512;var z=x.x/x.y;var A=Math.ceil(z>=1?y:y*z);var E=Math.ceil(z<=1?y:y/z);var G=document.createElement("iframe");G.style.visibility="hidden";G.width=A;G.height=E;document.body.appendChild(G);var H=G.contentDocument||G.contentWindow.document;H.open();H.close();H.body.innerHTML=i.text;var I=document.createElement("canvas");I.width=G.width*window.devicePixelRatio;I.height=G.height*window.devicePixelRatio;I.style.width=G.width+"px";I.style.height=G.height+"px";var J=I.getContext("2d");J.scale(window.devicePixelRatio,window.devicePixelRatio);h(H.body,{canvas:I,width:A,height:E,backgroundColor:null}).then(function(K){if(K.width>0&&K.height>0){var L=new T.Texture(K);L.needsUpdate=true;L[r]=0;u._textures.set(u._getDecalTextKey(i),L);}else{l.error("Failed render text to html","",t);}v();});}});};S.prototype._loadTextures=function(i){var u=[];i.forEach(function(v){if(!this._textures.has(v)){u.push(this._loadTexture(v));}},this);return Promise.all(u);};S.prototype._loadTexture=function(i){var u=this;var v=this._context.resources.get(i);if(!v){l.error("Failed to get texture from context: "+i,"",t);return Promise.resolve();}return new Promise(function(w,x){u._getTextureLoader().load(o(v),function(y){y.flipY=false;y[r]=0;u._textures.set(i,y);w();},null,function(y){l.error("Failed to load texture from Data URI: "+i,"status: "+y.status+", status text: "+y.statusText,t);w();});});};S.prototype._loadModels=function(i){var u=[];i.forEach(function(v,w){u.push(this._loadModel(w,v));},this);return Promise.all(u);};S.prototype._loadModel=function(i,u){var v=this;var w=this._context.resources.get(i);if(!w){l.error("Failed to get model from context: "+i,"",t);return Promise.resolve();}function x(y){f(y.scene);u.object3D=y.scene;y.scene.scale.set(1,1,-1);}return new Promise(function(y,z){if(q.sap.startsWith(atob(w.slice(0,6)),"glTF")){try{v._getGlTFLoader().parse(s(w),"",function(E){x(E);y();});}catch(A){l.error("Failed to load glb model: "+i,"",t);y();}}else{try{x(v._getColladaLoader().parse(atob(w)));y();}catch(A){try{v._getGlTFLoader().parse(atob(w),"",function(E){x(E);y();});}catch(A){l.error("Failed to load collada/gltf model: "+i,"",t);y();}}}});};S.prototype._releaseTexture=function(i){if(i.hasOwnProperty(r)){i[r]-=1;}else{i.dispose();}return this;};S.prototype._addRefTexture=function(i){if(!i.hasOwnProperty(r)){i[r]=0;}i[r]+=1;return this;};S.prototype._releaseGeometry=function(i){if(i.hasOwnProperty(r)){i[r]-=1;}else{i.dispose();}return this;};S.prototype._addRefGeometry=function(i){if(!i.hasOwnProperty(r)){i[r]=0;}i[r]+=1;return this;};S.prototype._cleanupCache=function(){this._textures.forEach(function(i){if(i[r]===0){i.dispose();this._textures.delete(i);}},this);if(this._boxGeometryWith4SidedTexture&&this._boxGeometryWith4SidedTexture[r]===0){this._boxGeometryWith4SidedTexture.dispose();this._boxGeometryWith4SidedTexture=null;}if(this._boxGeometryWith6SidedTexture&&this._boxGeometryWith6SidedTexture[r]===0){this._boxGeometryWith6SidedTexture.dispose();this._boxGeometryWith6SidedTexture=null;}if(this._cylinderGeometryWithCaps&&this._cylinderGeometryWithCaps[r]===0){this._cylinderGeometryWithCaps.dispose();this._cylinderGeometryWithCaps=null;}if(this._cylinderGeometry&&this._cylinderGeometry[r]===0){this._cylinderGeometry.dispose();this._cylinderGeometry=null;}return this;};S.prototype._destroyVisualObjectInstance=function(i){if(i.object3D){var u=this;i.object3D.traverse(function(v){if(v.isMesh){[].concat(v.material).forEach(function(w){if(w.map){u._releaseTexture(w.map);w.map=null;}w.dispose();});v.material=null;if(v.geometry){u._releaseGeometry(v.geometry);v.geometry=null;}}});i.object3D.parent.remove(i.object3D);i.object3D=null;i._lastModel=null;i._lastTexture=null;i._lastTextureCap=null;i._lastTexture6=null;i._lastColorBorder=null;i._materials=null;}return this;};S.prototype._updateVisualObjectInstance=function(i,u,v){if(v.isModel){if(v.model!==v._lastModel){this._destroyVisualObjectInstance(v)._addVisualObjectInstance(i,u,v);}this._assignColladaModelProperties(v);}else if(v.isBox){this._assignBoxProperties(v);}else if(v.isCylinder){this._assignCylinderProperties(v);}else if(v.isPolygon){this._destroyVisualObjectInstance(v)._addVisualObjectInstance(i,u,v);}else if(v.isDecal){if(v.position!==v._lastPosition||v.direction!==v._lastDirection||v.rotation!==v._lastRotation||v.size!==v._lastSize||v.target!==v._lastTarget||v.planeOrigin!==v._lastPlaneOrigin||v.planeNormal!==v._lastPlaneNormal){this._destroyVisualObjectInstance(v)._addVisualObjectInstance(i,u,v);}else{this._assignDecalProperties(v);}}return this;};S.prototype._addVisualObjectInstance=function(i,u,v){if(v.isModel){v._lastModel=v.model;var w=i.get(v.model);var x=--w.refCount===0?w.object3D:w.object3D.clone();v.object3D=new T.Group();v.object3D.add(x);if(g(v.normalize)){n(x);}this._assignMaterials(v);this._assignColladaModelProperties(v);}else if(v.isBox){v.object3D=new T.Group();v.object3D.add(new T.Mesh(undefined,this._createMaterial()));this._assignBoxProperties(v);}else if(v.isCylinder){v.object3D=new T.Group();if(v.textureCap){v.object3D.add(new T.Mesh(undefined,[this._createMaterial(true),this._createMaterial(true)]));}else{v.object3D.add(new T.Mesh(undefined,this._createMaterial(true)));}this._assignCylinderProperties(v);}else if(v.isPolygon){v.object3D=new T.Group();v.object3D.add(new T.Mesh(undefined,this._createMaterial(true)));this._assignPolygonProperties(v);}else if(v.isDecal){if(v.target){u.push(v);}else if(v.planeOrigin&&v.planeNormal){var y=this._createPlane(v);if(y){this._root.add(y);this._createDecal(v,y);y.geometry.dispose();this._root.remove(y);this._assignDecalProperties(v);}}else{l.error("unable to create decal: no target or no plane defined","",t);}}if(v.object3D){if(v.isDecal){this._scene.add(v.object3D);}else{this._root.add(v.object3D);}}return this;};S.prototype._assignColladaModelProperties=function(i){this._assignProperties(i);return this;};S.prototype._assignDecalProperties=function(i){if((i._lastTexture&&i._lastTexture!==i.texture)||(i._lastText&&i._lastText!==i.text)){this._removeTexture(i);}if(i.texture||i.text){this._assignTexture(i,true);}i._lastText=i.text;i._lastTexture=i.texture;return this;};S.prototype._assignBoxProperties=function(i){if(i._lastTexture6!==i.texture6){var u=i.object3D.children[0];if(u.geometry){this._releaseGeometry(u.geometry);}u.geometry=this._getBoxGeometry(g(i.texture6));this._addRefGeometry(u.geometry);if(g(i.normalize)){n(u);}i._lastTexture6=i.texture6;}if(i._lastColorBorder&&i._lastColorBorder!==i.colorBorder){this._removeColorBorder(i);}if(i.colorBorder&&i._lastColorBorder!==i.colorBorder){this._assignColorBorder(i);}i._lastColorBorder=i.colorBorder;this._assignProperties(i);return this;};S.prototype._assignCylinderProperties=function(i){if(i._lastTexture!==i.texture){var u=i.object3D.children[0];if(u.geometry){this._releaseGeometry(u.geometry);}u.geometry=this._getCylinderGeometry(g(i.isOpen));this._addRefGeometry(u.geometry);if(g(i.normalize)){n(u);}i._lastTexture=i.texture;i._lastTextureCap=i.textureCap;}if(i._lastColorBorder&&i._lastColorBorder!==i.colorBorder){this._removeColorBorder(i);}if(i.colorBorder&&i._lastColorBorder!==i.colorBorder){this._assignColorBorder(i);}i._lastColorBorder=i.colorBorder;this._assignProperties(i);return this;};S.prototype._createDecal=function(i,u){this._root.updateMatrixWorld(true);var v=k(i.position);v=new b(v[0],v[1],v[2]);var w=k(i.direction);w=new b(w[0],w[1],w[2]);w.normalize();if(w.length()<1E-6){l.error("Unable create decal: direction is invalid","",t);return;}var x=d(j(i.rotation));var y=k(i.size);y=new b(y[0],y[1],y[2]);if(y.length()<1E-6){l.error("Unable create decal: size is invalid","",t);return;}v.applyMatrix4(u.matrixWorld);w.transformDirection(u.matrixWorld);var z=new T.Raycaster(v,w);var A=z.intersectObject(u);if(!A.length){l.error("Unable create decal: cannot project decal to plane","",t);return;}if(!this._decalHelper){this._decalHelper=new T.Mesh(new T.BoxBufferGeometry(1,1,5));this._decalHelper.visible=false;this._decalHelper.up.set(0,1,0);this._scene.add(this._decalHelper);}var E=A[0];var G=E.point;var H=w.clone().negate();var I=new a().setFromObject(u);var J=I.max.clone().sub(I.min).length();H.multiplyScalar(J);H.add(G);this._decalHelper.position.copy(G);this._decalHelper.lookAt(H);this._decalHelper.rotation.z+=x;var K=new T.MeshPhongMaterial({specular:0x444444,shininess:0,transparent:true,depthTest:true,depthWrite:false,polygonOffset:true,polygonOffsetUnits:0.1,polygonOffsetFactor:-1});i.object3D=new T.Mesh(new T.DecalGeometry(u,G,this._decalHelper.rotation,y),K);i._lastPosition=i.position;i._lastDirection=i.direction;i._lastRotation=i.rotation;i._lastSize=i.size;i._lastTarget=i.target;};S.prototype._createPlane=function(i){var u=k(i.planeOrigin);u=new b(u[0],u[1],u[2]);var v=k(i.planeNormal);v=new b(v[0],v[1],v[2]);v.normalize();if(v.length()<1E-6){l.error("Unable to create plane for decal: normal is invalid","",t);return null;}var w=new b(v.x===0?10:-v.x,v.y===0?-10:v.y,v.z===0?10:-v.z);var x=u.clone(u).add(w);x.sub(v.clone().multiplyScalar(v.dot(x.clone().sub(u))));var P=10000;w=x.clone().sub(u).normalize();var y=v.clone().cross(w).normalize();w.multiplyScalar(P);y.multiplyScalar(P);var z=u.clone().add(w);var A=u.clone().sub(w);var E=u.clone().add(y);var G=u.clone().sub(y);var H=new T.Geometry();H.vertices.push(z,E,A,G);H.faces.push(new F(0,1,2,v),new F(2,3,0,v));i._lastPlaneOrigin=i.planeOrigin;i._lastPlaneNormal=i.planeNormal;return new T.Mesh(H);};S.prototype._getPolygonGeometry=function(u,v){var w=v?v.split(";").map(parseFloat):[0,0,1];w=new b(w[0],w[1],w[2]).normalize();var A=u.split(";"),i;var E=[];var G=[],H=[];for(i=0;i<A.length/3;++i){var x=parseFloat(A[i*3+0]);var y=parseFloat(A[i*3+1]);var z=parseFloat(A[i*3+2]);H.push(x);H.push(y);H.push(z);G.push(new V(x,y));E.push(w.x);E.push(w.y);E.push(w.z);}var I=[];var J=T.ShapeUtils.triangulateShape(G,[]);for(i=0;i<J.length;++i){I.push(J[i][0]);I.push(J[i][1]);I.push(J[i][2]);}var K=new T.BufferGeometry();K.setIndex(I);K.addAttribute("position",new T.Float32BufferAttribute(H,3));K.addAttribute("normal",new T.Float32BufferAttribute(E,3));K.computeBoundingSphere();K.computeVertexNormals();return K;};S.prototype._assignPolygonProperties=function(i){var u=i.object3D.children[0];u.geometry=this._getPolygonGeometry(i.posarray,i.OuterNormal);if(i._lastColorBorder&&i._lastColorBorder!==i.colorBorder){this._removeColorBorder(i);}if(i.colorBorder&&i._lastColorBorder!==i.colorBorder){this._assignColorBorder(i);}i._lastColorBorder=i.colorBorder;this._assignProperties(i);return this;};S.prototype._assignProperties=function(i){if(i._lastTexture&&i._lastTexture!==i.texture){this._removeTexture(i);}if(i.texture){this._assignTexture(i);}i._lastTexture=i.texture;m(i);var u=k(i.scale);i.object3D.scale.set(u[0],u[1],u[2]);var v=k(i.rot);i.object3D.rotation.set(d(v[0]),d(v[1]),d(v[2]),"YXZ");var w;if(i.isBox||i.isCylinder){w=new b(0,0,-1);}else if(i.isPolygon){w=new b(0,0,0);}else{var x=i.object3D.children[0].vbBox;w=new b(0,0,-1.0*(x.min.z>0?x.min.z:x.max.z));}var y=new M();y.makeRotationFromEuler(new T.Euler(d(v[0]),d(v[1]),d(v[2]),"YXZ"));var z=new M();z.makeScale(u[0],u[1],u[2]);z.multiply(y);w.applyMatrix4(z);w.z=-w.z;var A=k(i.pos);var E=new b(A[0],A[1],A[2]);E.sub(w);i.object3D.position.set(E.x,E.y,E.z);i.object3D.traverse(function(G){G._sapInstance=i;});return this;};S.prototype._removeTexture=function(u){if(u.object3D){var v=this;u.object3D.traverse(function(w){if(w.isMesh&&w.material&&w.material.map){v._releaseTexture(w.material.texture);w.material.map=null;}else if(w.isMesh&&w.material&&w.material.length!=0){for(var i=0;i<w.material.length;i++){v._releaseTexture(w.material[i].texture||w.material[i].map);w.material[i].map=null;}}});}return this;};S.prototype._assignTexture=function(i,u){var v=this;var w,x;if(i.object3D){w=this._textures.get(i.texture);if(i.isDecal&&i.text){w=this._textures.get(this._getDecalTextKey(i));}if(i.isCylinder&&i.textureCap){x=this._textures.get(i.textureCap);}i.object3D.traverse(function(y){if(y.isMesh&&y.material){if(u){w.flipY=u;}if(i.isCylinder&&w&&x){y.material[0].map=w;y.material[1].map=x;v._addRefTexture(w);v._addRefTexture(x);}else if(w){y.material.map=w;v._addRefTexture(w);}}});}return this;};S.prototype._removeColorBorder=function(i){if(i.object3D){i.object3D.traverse(function(u){var w=sap.ui.vbm.findIndexInArray(u.children,function(x){return x.isLineSegments;});if(w!==-1){var v=u.children[w];u.remove(v);v.geometry.dispose();v.material.dispose();v=undefined;}});}return this;};S.prototype._assignColorBorder=function(i){var u=i.object3D.children[0];if(i.isCylinder){u.add(new T.LineSegments(new T.EdgesGeometry(u.geometry,60),this._createLineBasicMaterial()));}else{u.add(new T.LineSegments(new T.EdgesGeometry(u.geometry),this._createLineBasicMaterial()));}p(i,i.colorBorder);return this;};S.prototype._createMaterial=function(i){return new T.MeshPhongMaterial({shininess:1,specular:0x101009,side:i?T.DoubleSide:T.FrontSide});};S.prototype._createLineBasicMaterial=function(){return new T.LineBasicMaterial({linewidth:1});};S.prototype._assignMaterials=function(i){var u=new Map();i.object3D.traverse(function(v){if(v.isMesh){[].concat(v.material).forEach(function(w){if(!u.has(w)){u.set(w,new Set());}u.get(w).add(v);});}});u.forEach(function(v,w){var x=w.clone();v.forEach(function(y){if(Array.isArray(y.material)){y.material=y.material.map(function(z){return z===w?x:z;});}else{y.material=x;}});});return this;};S.prototype._getBoxGeometry=function(i){var u=i?"_boxGeometryWith6SidedTexture":"_boxGeometryWith4SidedTexture";return this[u]||(this[u]=c(i));};S.prototype._getCylinderGeometry=function(i){var u;if(i){u="_cylinderGeometryWithCaps";}else{u="_cylinderGeometry";}return this[u]||(this[u]=e(i));};S.prototype._getTextureLoader=function(){return this._textureLoader||(this._textureLoader=new T.TextureLoader());};S.prototype._getColladaLoader=function(){return this._colladaLoader||(this._colladaLoader=new T.ColladaLoader());};S.prototype._getGlTFLoader=function(){return this._glTFLoader||(this._glTFLoader=new T.GLTFLoader());};f=function(i){var u=[];i.traverse(function(v){if(v.isLight||v.isCamera){u.push(v);}});u.forEach(function(v){while(v&&v!==i){var w=v.parent;if(v.children.length===0){w.remove(v);}v=w;}});return i;};n=function(i){var u=new a().setFromObject(i);var v=u.getCenter();u.min.sub(new b(v.x,v.y,-v.z));u.max.sub(new b(v.x,v.y,-v.z));var w=Math.max(Math.abs(u.min.x),Math.abs(u.min.y),Math.abs(u.min.z),Math.abs(u.max.x),Math.abs(u.max.y),Math.abs(u.max.z));if(w){w=1/w;}u.min.set(u.min.x*w,u.min.y*w,-u.min.z*w);u.max.set(u.max.x*w,u.max.y*w,-u.max.z*w);U.swap(u,"min","max");i.vbBox=u;var x=new M().makeScale(w,w,w);var y=new M().makeTranslation(-v.x,-v.y,-v.z);i.updateMatrix();x.multiply(y);x.multiply(i.matrix);x.decompose(i.position,i.quaternion,i.scale);return i;};c=function(i){var u=new T.Geometry();var v=0.1;u.vertices.push(new b(v,v,-v),new b(v,-v,-v),new b(-v,-v,-v),new b(-v,v,-v),new b(v,v,v),new b(-v,v,v),new b(-v,-v,v),new b(v,-v,v),new b(v,v,-v),new b(v,v,v),new b(v,-v,v),new b(v,-v,-v),new b(v,-v,-v),new b(v,-v,v),new b(-v,-v,v),new b(-v,-v,-v),new b(-v,-v,-v),new b(-v,-v,v),new b(-v,v,v),new b(-v,v,-v),new b(v,v,v),new b(v,v,-v),new b(-v,v,-v),new b(-v,v,v));var w=new T.Color(0.5,0.5,0.5);u.faces.push(new F(0,2,3,new b(0,0,-1),w),new F(0,1,2,new b(0,0,-1),w),new F(4,5,6,new b(0,0,1),w),new F(4,6,7,new b(0,0,1),w),new F(8,10,11,new b(1,0,0),w),new F(8,9,10,new b(1,0,0),w),new F(12,14,15,new b(0,-1,0),w),new F(12,13,14,new b(0,-1,0),w),new F(16,18,19,new b(-1,0,0),w),new F(16,17,18,new b(-1,0,0),w),new F(20,22,23,new b(0,1,0),w),new F(20,21,22,new b(0,1,0),w));var x;if(i){x=[new V(2/3,0.5),new V(1.0,0.5),new V(1.0,1.0),new V(2/3,1.0),new V(2/3,0.5),new V(2/3,0.0),new V(1.0,0.0),new V(1.0,0.5),new V(2/3,0.5),new V(2/3,1.0),new V(1/3,1.0),new V(1/3,0.5),new V(2/3,0.0),new V(2/3,0.5),new V(1/3,0.5),new V(1/3,0.0),new V(1/3,0.5),new V(1/3,1.0),new V(0.0,1.0),new V(0.0,0.5),new V(0.0,0.5),new V(0.0,0.0),new V(1/3,0.0),new V(1/3,0.5)];}else{x=[new V(0.5,0.5),new V(1.0,0.5),new V(1.0,1.0),new V(0.5,1.0),new V(0.5,0.5),new V(1.0,0.5),new V(1.0,1.0),new V(0.5,1.0),new V(0.5,0.5),new V(0.5,1.0),new V(0.0,1.0),new V(0.0,0.5),new V(0.5,0.5),new V(0.5,0.0),new V(1.0,0.0),new V(1.0,0.5),new V(0.5,0.5),new V(0.5,1.0),new V(0.0,1.0),new V(0.0,0.5),new V(0.0,0.5),new V(0.0,0.0),new V(0.5,0.0),new V(0.5,0.5)];}u.faceVertexUvs[0].push([x[0],x[2],x[3]],[x[0],x[1],x[2]],[x[5],x[6],x[7]],[x[5],x[7],x[4]],[x[8],x[10],x[11]],[x[8],x[9],x[10]],[x[12],x[14],x[15]],[x[12],x[13],x[14]],[x[16],x[18],x[19]],[x[16],x[17],x[18]],[x[20],x[22],x[23]],[x[20],x[21],x[22]]);return u;};e=function(i){var u=0.1;var v=new T.CylinderGeometry(u,u,2*u,32,1,i);if(!i){var w=u/2;for(var z=0;z<v.faces.length;z++){var x=v.faces[z];if(x.normal.y!==0){v.faceVertexUvs[0][z][0].u=(v.vertices[x.a].x+w)/u;v.faceVertexUvs[0][z][0].v=(v.vertices[x.a].z+w)/u;v.faceVertexUvs[0][z][1].u=(v.vertices[x.b].x+w)/u;v.faceVertexUvs[0][z][1].v=(v.vertices[x.b].z+w)/u;v.faceVertexUvs[0][z][2].u=(v.vertices[x.c].x+w)/u;v.faceVertexUvs[0][z][2].v=(v.vertices[x.c].z+w)/u;x.materialIndex=1;}else{x.materialIndex=0;}}}return v;};return S;});
