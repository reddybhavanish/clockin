/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","./thirdparty/three"],function(q,B,T){"use strict";var t="sap.ui.vbm.adapter3d.Utilities";var l=q.sap.log;var C=T.Color;var V=T.Vector3;var U=B.extend("sap.ui.vbm.adapter3d.Utilities",{});U.toBoolean=function(v){var f=v.charAt(0);return f==="t"||f!==""&&f!=="f"&&f!==" "&&f!=="0";};U.toFloat=function(v){return parseFloat(v);};U.toVector3=function(v){var a=v.split(";");if(a.length!==3){return[0,0,0];}return a.map(parseFloat);};U.threeJsToVb=function(p){return new V(-p.x,p.z,-p.y);};U.vbToThreeJs=function(p){return new V(-p.x,-p.z,p.y);};U.toColor=(function(){var d="\\s*(\\d+)\\s*";var h="\\s*(?:0[xX])([\\da-fA-F]+)\\s*";var a=d+"(,|;)"+d+"\\2"+d;var f=d+"(,|;)"+d+"\\2"+d+"\\2"+d;var b=h+"(,|;)"+h+"\\2"+h;var c=h+"(,|;)"+h+"\\2"+h+"\\2"+h;var r=new RegExp("^\\s*RGB\\("+a+"\\)\\s*$");var e=new RegExp("^\\s*RGB\\("+b+"\\)\\s*$");var g=new RegExp("^\\s*RGBA\\("+f+"\\)\\s*$");var i=new RegExp("^\\s*RGBA\\("+c+"\\)\\s*$");var j=new RegExp("^\\s*ARGB\\("+f+"\\)\\s*$");var k=new RegExp("^\\s*ARGB\\("+c+"\\)\\s*$");var n=new RegExp("^\\s*HLS\\("+a+"\\)\\s*$");var o=new RegExp("^\\s*HLS\\("+b+"\\)\\s*$");var p=new RegExp("^\\s*HLSA\\("+f+"\\)\\s*$");var s=new RegExp("^\\s*HLSA\\("+c+"\\)\\s*$");var u=new RegExp("^"+d+"$");var v=new RegExp("^"+h+"$");return function(w){var m;var x;var y=1;if((m=w.match(r))){x=new C(parseInt(m[1],10)/255,parseInt(m[3],10)/255,parseInt(m[4],10)/255);}else if((m=w.match(e))){x=new C(parseInt(m[1],16)/255,parseInt(m[3],16)/255,parseInt(m[4],16)/255);}else if((m=w.match(g))){x=new C(parseInt(m[1],10)/255,parseInt(m[3],10)/255,parseInt(m[4],10)/255);y=m[5]/255;}else if((m=w.match(i))){x=new C(parseInt(m[1],16)/255,parseInt(m[3],16)/255,parseInt(m[4],16)/255);y=m[5]/255;}else if((m=w.match(j))){x=new C(parseInt(m[3],10)/255,parseInt(m[4],10)/255,parseInt(m[5],10)/255);y=m[1]/255;}else if((m=w.match(k))){x=new C(parseInt(m[3],16)/255,parseInt(m[4],16)/255,parseInt(m[5],16)/255);y=m[1]/255;}else{l.warning("Cannot convert color, use default",w,t);x=new C(0.5,0.5,0.5);}return{rgb:x,opacity:y};};})();U.toColorDelta=(function(){var f="\\s*([-+]?\\d*\\.?\\d+(?:[eE][-+]?\\d+)?)\\s*";var r=new RegExp("^\\s*RHLS\\("+f+";"+f+";"+f+"\\)\\s*$");var a=new RegExp("^\\s*RHLSA\\("+f+";"+f+";"+f+";"+f+"\\)\\s*$");return function(d){var m;var h;var o=1;if((m=d.match(r))){h=new V(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));}else if((m=d.match(a))){h=new V(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));o=parseFloat(m[4]);}else{l.warning("Cannot convert color delta, use default",d,t);h=new V(1,1,1);}return{hls:h,opacity:o};};})();U.multiplyColors=function(o,x,y){o.r=U.clamp(x.r*y.r,0.0,1.0);o.g=U.clamp(x.g*y.g,0.0,1.0);o.b=U.clamp(x.b*y.b,0.0,1.0);};U.isColorDelta=function(v){return q.sap.startsWith(v,"RHLS");};U.applyDeltaHLS=function(c,h){var a=c.getHSL({});a.h=a.h+h.x;a.s=U.clamp(a.s*h.z,0.0,1.0);a.l=U.clamp(a.l*h.y,0.0,1.0);c.setHSL(a.h,a.s,a.l);};U.applyColor=function(i,h){if(!i.object3D){return;}if(!i._materials){i._materials=new Map();i.object3D.traverse(function(n){if(n.isMesh){[].concat(n.material).forEach(function(m){i._materials.set(m,{rgb:m.color.clone(),opacity:m.opacity});});}});}var c=U.toColor(i.color);var s=(U.toBoolean(i["VB:s"]));var a=U.isColorDelta(i.hotDeltaColor);var b=a?U.toColorDelta(i.hotDeltaColor):U.toColor(i.hotDeltaColor);var d=U.isColorDelta(i.selectColor);var e=d?U.toColorDelta(i.selectColor):U.toColor(i.selectColor);i._materials.forEach(function(r,m){U.multiplyColors(m.color,r.rgb,c.rgb);m.opacity=U.clamp(r.opacity*c.opacity,0.0,1.0);if(s){if(d){U.applyDeltaHLS(m.color,e.hls);m.opacity=U.clamp(m.opacity*e.opacity,0.0,1.0);}else{m.color.copy(e.rgb);m.opacity=e.opacity;}}if(h){if(a){U.applyDeltaHLS(m.color,b.hls);m.opacity=U.clamp(m.opacity*b.opacity,0.0,1.0);}else{m.color.copy(b.rgb);m.opacity=b.opacity;}}m.transparent=m.opacity<1;});};U.applyColorBorder=function(i,v){if(v){var c=U.toColor(v);i.object3D.traverse(function(n){if(n.isLineSegments&&n.material){n.material.color=c.rgb;n.material.opacity=c.opacity;n.material.transparent=c.opacity<1;}});}return this;};U.clamp=function(v,m,a){if(v<m){return m;}if(v>a){return a;}return v;};U.swap=function(o,a,b){var c=o[a];o[a]=o[b];o[b]=c;};U.makeDataUri=function(d){return d&&"data:text/plain;base64,"+d;};U.base64ToArrayBuffer=function(s){var a=atob(s);var b=new Uint8Array(a.length);for(var i=0;i<a.length;++i){b[i]=a.charCodeAt(i);}return b.buffer;};return U;});
