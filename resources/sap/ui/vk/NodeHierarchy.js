/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/ManagedObject","./Messages","./getResourceBundle"],function(q,M,a,g){"use strict";var N=M.extend("sap.ui.vk.NodeHierarchy",{metadata:{"abstract":true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});N.prototype.findNodesById=function(b){if(b.fields.some(function(h){return!h.caseSensitive;})){b=q.extend(true,{},b);b.fields.forEach(function(h){if(!h.caseSensitive){h.value=h.value.toLowerCase();}});}var c=function(p,h,v,j){var m;p=p||"equals";j=j||"";var k=h?v:v.toLowerCase();switch(p){case"equals":m=(k===j);break;case"contains":m=(k.indexOf(j)!==-1);break;case"startsWith":m=(k.indexOf(j)===0);break;default:m=false;q.sap.log.error(g().getText(a.VIT8.summary),a.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}return m;};var i=function(l,h){return!l.some(function(v){return h.name===v.name?c(h.predicate,h.caseSensitive,v.value,h.value):false;});};var f=function(b,v){return b.source===v.source&&b.type===v.type&&!b.fields.some(i.bind(undefined,v.fields));};var d=this.findNodesByName();var e=d.filter(function(n){var h=this.createNodeProxy(n);var v=h.getVeIds();this.destroyNodeProxy(h);return v.some(f.bind(undefined,b));}.bind(this));return e;};N.prototype.findNodesByMetadata=function(b){var c=function(m,k,l,v,i,j){if(m.hasOwnProperty(k)){var n=m[k];if(n.hasOwnProperty(l)){var o=n[l];if(!j){o=o.toLowerCase();}return v.some(i.bind(undefined,o));}}return false;};var d=function(m,k){if(m==null){return false;}return m.hasOwnProperty(k);};var e=function(f,h,k,l,v,i,j){var n=this._baseNodeProxyPool.borrowObject();var r=f.filter(function(m){n.init(this,m);var o=n.getNodeMetadata();var s=h(o,k,l,v,i,j);n.reset();return s;}.bind(this));this._baseNodeProxyPool.returnObject(n);return r;};var f=this.findNodesByName(),r=[];if(b===undefined||b===null||q.isEmptyObject(b)){r=f;}else if(b.category!==null&&b.category!==undefined&&b.category!==""){var h,v,p,i,j=!!(b&&b.caseSensitive);if(b.key===undefined||b.key===null){h=d;}else{v=b.value;p=b.predicate||"equals";if(v===undefined||v===null){v="";p="contains";}if(!Array.isArray(v)){v=[v];}if(!j){v=v.map(function(k){return k.toLowerCase();});}switch(p){case"equals":i=function(m,k){return m===k;};break;case"contains":i=function(m,k){return m.indexOf(k)!==-1;};break;case"startsWith":i=function(m,k){return m.indexOf(k)===0;};break;default:q.sap.log.error(g().getText(a.VIT9.summary),a.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy");}h=c;}r=e.bind(this)(f,h,b.category,b.key,v,i,j);}else{q.sap.log.error(g().getText(a.VIT10.summary),a.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy");}return q.sap.unique(r);};N.prototype._appendAncestors=function(n,s){s=s?new Set(s):null;var b=new Set(n);n.forEach(function(d){var e=this.getAncestors(d);e.forEach(function(f){if(s===null||!s.has(f)){b.add(f);}});},this);var c=[];b.forEach(function(d){c.push(d);});return c;};return N;});
