//@ui5-bundle sap/ui/vk/library-preload.js
sap.ui.predefine('sap/ui/vk/AnimationInterpolationType',[],function(){"use strict";var A={Discrete:"Discrete",Cubic:"Cubic",Linear:"Linear"};return A;});
sap.ui.predefine('sap/ui/vk/AnimationMath',["./thirdparty/GlMatrixUtils","./AnimationTrackValueType"],function(g,A){"use strict";var a={};
a.neutralAngleAxisToGlMatrixQuat=function(v){return g.quat.setAxisAngle(g.quat.create(),g.vec3.fromValues(v[0],v[1],v[2]),v[3]);};
a.neutralEulerToGlMatrixQuat=function(v){var b=v[3]&3;var c=(v[3]>>2)&3;var d=(v[3]>>4)&3;var h=v[b];var e=v[c];var f=v[d];var i=Math.cos(h/2);var s=Math.sin(h/2);var j=Math.cos(e/2);var k=Math.sin(e/2);var l=Math.cos(f/2);var m=Math.sin(f/2);var x=s*j*l+i*k*m;var y=i*k*l-s*j*m;var z=i*j*m+s*k*l;var w=i*j*l-s*k*m;var n=g.quat.fromValues(x,y,z,w);return n;};
a.neutralQuatToNeutralEuler=function(q,o){var b=o&3;var c=(o>>2)&3;var d=(o>>4)&3;var v=[0,0,0,o];var s=2*(q.w*q.x+q.y*q.z);var e=1-2*(q.x*q.x+q.y*q.y);var h=Math.atan2(s,e);var f;var i=2*(q.w*q.y-q.z*q.x);if(Math.abs(i)>=1){if(i>0){f=Math.PI/2.0;}else{f=-Math.PI/2.0;}}else{f=Math.asin(i);}var j=2*(q.w*q.z+q.x*q.y);var k=1-2*(q.y*q.y+q.z*q.z);var l=Math.atan2(j,k);v[b]=h;v[c]=f;v[d]=l;return v;};
a.neutralQuatToGlMatrixQuat=function(v){return g.quat.fromValues(v[0],v[1],v[2],v[3]);};
a.glMatrixQuatToNeutral=function(v){return[v[0],v[1],v[2],v[3]];};
a.interpolate=function(v,b,c,k,t){var d=b.value;var e=c.value;var f={};var h;var i;var q;switch(v){case A.Quaternion:h=a.neutralQuatToGlMatrixQuat(d);i=a.neutralQuatToGlMatrixQuat(e);q=g.quat.lerp(g.quat.create(),h,i,k);f.value=a.glMatrixQuatToNeutral(q);break;case A.Euler:var r=[a.interpolateScalarLinear(d[0],e[0],k),a.interpolateScalarLinear(d[1],e[1],k),a.interpolateScalarLinear(d[2],e[2],k),d[3]];f[A.Euler]=r;q=a.neutralEulerToGlMatrixQuat(r);f.value=a.glMatrixQuatToNeutral(q);break;case A.AngleAxis:var j=new THREE.Matrix4();var l;var m;var n;var x;var y;var z;for(var o=0;o<t.getKeysCount();o++){var p=t.getKey(o);x=p.value[0];y=p.value[1];z=p.value[2];l=p.value[3];m=new THREE.Vector3(x,y,z);n=new THREE.Matrix4();n.makeRotationAxis(m,l);j.premultiply(n);if(p===b){break;}}x=e[0];y=e[1];z=e[2];l=e[3]*k;f[A.AngleAxis]=[x,y,z,r];m=new THREE.Vector3(x,y,z);var s=new THREE.Matrix4();s.makeRotationAxis(m,l);s.multiply(j);var u=new THREE.Quaternion().setFromRotationMatrix(s);f.value=u.toArray();break;case A.Vector3:f.value=[a.interpolateScalarLinear(d[0],e[0],k),a.interpolateScalarLinear(d[1],e[1],k),a.interpolateScalarLinear(d[2],e[2],k)];break;default:f.value=a.interpolateScalarLinear(d,e,k);}return f;};
a.interpolateScalarLinear=function(v,b,k){return v+k*(b-v);};
return a;});
sap.ui.predefine('sap/ui/vk/AnimationRotateType',[],function(){"use strict";var A={AngleAxis:"AngleAxis",Euler:"Euler",Quaternion:"Quaternion"};return A;});
sap.ui.predefine('sap/ui/vk/AnimationTrackType',[],function(){"use strict";var A={Rotate:"rrotate",Translate:"rtranslate",Scale:"rscale",Opacity:"ropacity",Color:"color"};return A;});
sap.ui.predefine('sap/ui/vk/AnimationTrackValueType',[],function(){"use strict";var A={Scalar:"Scalar",Vector3:"Vector3",AngleAxis:"AngleAxis",Quaternion:"Quaternion",Euler:"Euler"};return A;});
sap.ui.predefine('sap/ui/vk/DrawerToolbarButton',[],function(){"use strict";var D={CrossSection:"VIT-Cross-Section",CrossSectionAxis:"VIT-Cross-Section-Axis",Turntable:"VIT-Turntable",Orbit:"VIT-Orbit",Pan:"VIT-Pan",Zoom:"VIT-Zoom",Show:"VIT-Show",Hide:"VIT-Hide",FitToView:"VIT-Fit-To-View",RectangularSelection:"VIT-Rectangular-Selection",PredefinedViews:"VIT-Predefined-Views",FullScreen:"VIT-Fullscreen"};return D;});
sap.ui.predefine('sap/ui/vk/HighlightDisplayState',[],function(){"use strict";var H=function(){};H.playing="playing";H.pausing="pausing";H.stopped="stopped";return H;});
sap.ui.predefine('sap/ui/vk/findIndexInArray',[],function(){"use strict";var f=function(a,p,t){var r=-1;if(Array.isArray(a)&&typeof p==="function"){for(var i=0;i<a.length;i++){if(p.call(t,a[i],i,a)){r=i;break;}}}return r;};return f;});
sap.ui.predefine('sap/ui/vk/thirdparty/GlMatrixUtils',[],function(){"use strict";var G=function(){};G.AT=(typeof Float32Array==="undefined")?Array:Float32Array;G.vec3={fromValues:function(x,y,z){var o=new G.AT(3);o[0]=x;o[1]=y;o[2]=z;return o;}};G.quat={setAxisAngle:function(o,a,r){r=r*0.5;var s=Math.sin(r);o[0]=s*a[0];o[1]=s*a[1];o[2]=s*a[2];o[3]=Math.cos(r);return o;},fromValues:function(x,y,z,w){var o=new G.AT(4);o[0]=x;o[1]=y;o[2]=z;o[3]=w;return o;},lerp:function(o,a,b,t){var c=a[0];var d=a[1];var e=a[2];var f=a[3];o[0]=c+t*(b[0]-c);o[1]=d+t*(b[1]-d);o[2]=e+t*(b[2]-e);o[3]=f+t*(b[3]-f);return o;},create:function(){var o=new G.AT(4);if(G.AT!==Float32Array){o[0]=0;o[1]=0;o[2]=0;}o[3]=1;return o;},multiply:function(o,a,b){var q=a[0];var c=a[1];var d=a[2];var e=a[3];var f=b[0];var g=b[1];var h=b[2];var i=b[3];o[0]=q*i+e*f+c*h-d*g;o[1]=c*i+e*g+d*f-q*h;o[2]=d*i+e*h+q*g-c*f;o[3]=e*i-q*f-c*g-d*h;return o;},};return G;});
sap.ui.predefine('sap/ui/vk/threejs/BBoxSubdivider',[],function(){"use strict";var U=function(){this.unpack=function(p){if(!p||(p.bytelength<1)){return false;}try{this.nLevel=p[0];if(this.nLevel>5){return false;}this.numDivision=Math.pow(2,this.nLevel);this.octree=new Uint8Array(Math.pow(this.numDivision,3));this.streamOffset=1;this._decodeRecursive(p,0,0,0,0);}catch(e){return false;}return true;};this.getUnpacked=function(){return this.octree;};this._setValue=function(g,a,b,v){this.octree[b*this.numDivision*this.numDivision+a*this.numDivision+g]=v?1:0;};this._decodeRecursive=function(p,g,a,b,l){if(l===this.nLevel){this._setValue(g,a,b,true);return true;}if(this.streamOffset>=p.length){return false;}var c=p[this.streamOffset];this.streamOffset++;g*=2;a*=2;b*=2;if(l>=this.nLevel){return true;}for(var z=0;z<2;z++){for(var y=0;y<2;y++){for(var x=0;x<2;x++){if((c&(1<<(z*4+y*2+x)))!==0){if(!this._decodeRecursive(p,g+x,a+y,b+z,l+1)){return false;}}else{this._clearBitsRecursive(g+x,a+y,b+z,l+1);}}}}return true;};this._clearBitsRecursive=function(g,a,b,l){if(l===this.nLevel){this._setValue(g,a,b,false);return;}g*=2;a*=2;b*=2;if(l>=this.nLevel){return;}for(var z=0;z<2;z++){for(var y=0;y<2;y++){for(var x=0;x<2;x++){this._clearBitsRecursive(g+x,a+y,b+z,l+1);}}}};};var C=function(n){this.numDivision=n;this.xyzToIndexMap=new Map();this.points=[];this.getOrCreatePointAt=function(x,y,z,f,d){var k=x+":"+y+":"+z+":"+f+":"+d;var i=this.xyzToIndexMap.get(k);if(i){return i;}this.points.push(x/this.numDivision-0.5,y/this.numDivision-0.5,z/this.numDivision-0.5);i=this.points.length/3-1;this.xyzToIndexMap.set(k,i);return i;};};var S=function(l,n,u){this.level=l;this.numDivision=n;this.unpacked=u;this.getValue=function(g,a,b){if(g<0||a<0||b<0||g>=this.numDivision||a>=this.numDivision||b>=this.numDivision){return 0;}return this.unpacked[b*this.numDivision*this.numDivision+a*this.numDivision+g];};};var B=function(){};
B.unpackSubDividedBoundingBox=function(p){var u=new U();if(u.unpack(p)){return new S(u.nLevel,u.numDivision,u.getUnpacked());}return null;};
B.makeSubDividedBoundingBoxGeometry=function(s){if(!s){return null;}var i=[];var n=s.level;var e=Math.pow(2,n);var m=new C(e);var x,y,z,f,a,b,c,d;for(x=0;x<=e;x++){for(y=0;y<e;y++){for(z=0;z<e;z++){f=s.getValue(x,y,z)-s.getValue(x-1,y,z);if(f!==0){a=m.getOrCreatePointAt(x,y,z,0,f);b=m.getOrCreatePointAt(x,y+1,z,0,f);c=m.getOrCreatePointAt(x,y+1,z+1,0,f);d=m.getOrCreatePointAt(x,y,z+1,0,f);if(f<0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}for(y=0;y<=e;y++){for(x=0;x<e;x++){for(z=0;z<e;z++){f=s.getValue(x,y,z)-s.getValue(x,y-1,z);if(f!==0){a=m.getOrCreatePointAt(x,y,z,1,f);b=m.getOrCreatePointAt(x+1,y,z,1,f);c=m.getOrCreatePointAt(x+1,y,z+1,1,f);d=m.getOrCreatePointAt(x,y,z+1,1,f);if(f>0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}for(z=0;z<=e;z++){for(x=0;x<e;x++){for(y=0;y<e;y++){f=s.getValue(x,y,z)-s.getValue(x,y,z-1);if(f!==0){a=m.getOrCreatePointAt(x,y,z,2,f);b=m.getOrCreatePointAt(x+1,y,z,2,f);c=m.getOrCreatePointAt(x+1,y+1,z,2,f);d=m.getOrCreatePointAt(x,y+1,z,2,f);if(f<0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}var g=new THREE.BufferGeometry();var h=new THREE.BufferAttribute(new Uint16Array(i),1);var p=new THREE.BufferAttribute(new Float32Array(m.points),3);g.setIndex(h);g.setAttribute("position",p);g.computeFaceNormals();g.computeVertexNormals();g.computeBoundingSphere();return g;};
return B;});
sap.ui.predefine('sap/ui/vk/threejs/HitTester',["sap/base/Log","./thirdparty/three"],function(L,a){"use strict";var H=function(){this._maskMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,fog:false});this._depthMaterial=new THREE.ShaderMaterial({vertexShader:["#include <clipping_planes_pars_vertex>","void main() {","	#include <begin_vertex>","	#include <project_vertex>","	#include <clipping_planes_vertex>","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","void main() {","	#include <clipping_planes_fragment>","	highp vec4 value = vec4(fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * gl_FragCoord.z));","	value.xyz -= value.yzw * (1.0 / 255.0);","	gl_FragColor  = value;","}"].join("\n"),clipping:true});this._renderTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter});this._renderTarget.texture.generateMipmaps=false;this._renderTarget.depthBuffer=true;};var b;var m=new THREE.Matrix4();var f=new THREE.Frustum();var c=new THREE.Matrix4();var s=new THREE.Vector2();var r=new THREE.Raycaster();var d=new THREE.Ray();var e=new THREE.Sphere();var o=[];var g=new Uint8Array(4);var p=new THREE.Vector3();
function j(h){var i=h.parent;while(i){if(i.userData.closed){h=i;}i=i.parent;}while(h.parent&&(h.userData.skipIt||(h.layers===h.parent.layers))){h=h.parent;}return h;}
H.prototype.hitTest=function(x,y,i,k,l,n,q,t){if(!b||b.constructor!==q.constructor){b=new q.constructor();}b.copy(q);var v=q.view;if(v){var w=v.width/i;var h=v.height/k;b.setViewOffset(v.fullWidth,v.fullHeight,v.offsetX+(x-0.5)*w,v.offsetY+(y-0.5)*h,w,h);}else{b.setViewOffset(i,k,x-0.5,y-0.5,1,1);}m.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);f.setFromMatrix(m);r.setFromCamera(s.set(0,0),b);var u=l.getContext();var A=Math.min(u.getParameter(u.RED_BITS),8);var B=Math.min(u.getParameter(u.GREEN_BITS),8);var C=Math.min(u.getParameter(u.BLUE_BITS),8);var D=A+B;var E=(1<<A)-1;var F=(1<<B)-1;var M=(1<<C)-1;var G=1/E;var I=1/F;var J=1/M;var K=this._maskMaterial;var N=l.getClearColor().clone();var O=l.getClearAlpha();var P=l.autoClear;l.setRenderTarget(this._renderTarget);l.clippingPlanes=t||[];l.autoClear=false;l.setClearColor(0x000000,0);l.clear(true,true,false);var Q=K.color;var R=0;o.length=0;n.traverse(function(U){var V=U.geometry;if(V&&U.material&&U.layers.test(q.layers)&&f.intersectsObject(U)){var W=U.matrixWorld;if(V.boundingSphere===null){V.computeBoundingSphere();}e.copy(V.boundingSphere);e.applyMatrix4(W);if(r.ray.intersectsSphere(e)===false){return;}c.getInverse(W);d.copy(r.ray).applyMatrix4(c);if(V.boundingBox!==null&&d.intersectsBox(V.boundingBox)===false){return;}R+=1;o.push(U);Q.setRGB((R&E)*G,((R>>A)&F)*I,((R>>D)&M)*J);var T=U.material;U.material=K;l.render(U,b);U.material=T;}});l.readRenderTargetPixels(this._renderTarget,0,0,1,1,g);R=(g[0]>>(8-A))+((g[1]>>(8-B))<<A)+((g[2]>>(8-C))<<D);var S=R>0?o[R-1]:null;var z;if(S){var T=S.material;S.material=this._depthMaterial;l.clear(true,true,false);l.render(S,b);S.material=T;l.readRenderTargetPixels(this._renderTarget,0,0,1,1,g);z=((g[0]+(g[1]+(g[2]+g[3]/255)/255)/255)/255)*2-1;p.set(0,0,z).applyMatrix4(b.projectionMatrixInverse).applyMatrix4(b.matrixWorld);}l.setRenderTarget(null);l.clippingPlanes=[];l.setClearColor(N,O);l.autoClear=P;return S?{distance:r.ray.origin.distanceTo(p),point:p,object:j(S)}:null;};
H.prototype.hitTestPrecise=function(x,y,w,h,k,l,n){r.setFromCamera(s.set((x/w)*2-1,(y/h)*-2+1),l);if(n&&n.length>0){for(var q in n){var u=n[q];var v=u.distanceToPoint(r.ray.origin),t=-v/u.normal.dot(r.ray.direction);if(t>0){if(v<0){r.near=Math.max(r.near,t);}else{r.far=Math.min(r.far,t);}}else if(v<0){return null;}}}var z=r.intersectObjects(k.children,true);if(n&&n.length>0){r.near=0;r.far=Infinity;}if(z){for(var i in z){var A=z[i];var B=j(A.object);if(B.layers.test(l.layers)&&!B.isBillboard&&!B.isDetailView){A.object=B;return A;}}}return null;};
return H;});
sap.ui.predefine('sap/ui/vk/threejs/MarchingCubes',[],function(){"use strict";var e=new Uint32Array([0x0,0x109,0x203,0x30a,0x406,0x50f,0x605,0x70c,0x80c,0x905,0xa0f,0xb06,0xc0a,0xd03,0xe09,0xf00,0x190,0x99,0x393,0x29a,0x596,0x49f,0x795,0x69c,0x99c,0x895,0xb9f,0xa96,0xd9a,0xc93,0xf99,0xe90,0x230,0x339,0x33,0x13a,0x636,0x73f,0x435,0x53c,0xa3c,0xb35,0x83f,0x936,0xe3a,0xf33,0xc39,0xd30,0x3a0,0x2a9,0x1a3,0xaa,0x7a6,0x6af,0x5a5,0x4ac,0xbac,0xaa5,0x9af,0x8a6,0xfaa,0xea3,0xda9,0xca0,0x460,0x569,0x663,0x76a,0x66,0x16f,0x265,0x36c,0xc6c,0xd65,0xe6f,0xf66,0x86a,0x963,0xa69,0xb60,0x5f0,0x4f9,0x7f3,0x6fa,0x1f6,0xff,0x3f5,0x2fc,0xdfc,0xcf5,0xfff,0xef6,0x9fa,0x8f3,0xbf9,0xaf0,0x650,0x759,0x453,0x55a,0x256,0x35f,0x55,0x15c,0xe5c,0xf55,0xc5f,0xd56,0xa5a,0xb53,0x859,0x950,0x7c0,0x6c9,0x5c3,0x4ca,0x3c6,0x2cf,0x1c5,0xcc,0xfcc,0xec5,0xdcf,0xcc6,0xbca,0xac3,0x9c9,0x8c0,0x8c0,0x9c9,0xac3,0xbca,0xcc6,0xdcf,0xec5,0xfcc,0xcc,0x1c5,0x2cf,0x3c6,0x4ca,0x5c3,0x6c9,0x7c0,0x950,0x859,0xb53,0xa5a,0xd56,0xc5f,0xf55,0xe5c,0x15c,0x55,0x35f,0x256,0x55a,0x453,0x759,0x650,0xaf0,0xbf9,0x8f3,0x9fa,0xef6,0xfff,0xcf5,0xdfc,0x2fc,0x3f5,0xff,0x1f6,0x6fa,0x7f3,0x4f9,0x5f0,0xb60,0xa69,0x963,0x86a,0xf66,0xe6f,0xd65,0xc6c,0x36c,0x265,0x16f,0x66,0x76a,0x663,0x569,0x460,0xca0,0xda9,0xea3,0xfaa,0x8a6,0x9af,0xaa5,0xbac,0x4ac,0x5a5,0x6af,0x7a6,0xaa,0x1a3,0x2a9,0x3a0,0xd30,0xc39,0xf33,0xe3a,0x936,0x83f,0xb35,0xa3c,0x53c,0x435,0x73f,0x636,0x13a,0x33,0x339,0x230,0xe90,0xf99,0xc93,0xd9a,0xa96,0xb9f,0x895,0x99c,0x69c,0x795,0x49f,0x596,0x29a,0x393,0x99,0x190,0xf00,0xe09,0xd03,0xc0a,0xb06,0xa0f,0x905,0x80c,0x70c,0x605,0x50f,0x406,0x30a,0x203,0x109,0x0]);var t=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];var V=function(i,a,b,c,d){var m;var p=[0,0,0];if(Math.abs(i-c)<0.00001){return(a);}if(Math.abs(i-d)<0.00001){return(b);}if(Math.abs(c-d)<0.00001){return(a);}m=(i-c)/(d-c);p[0]=a[0]+m*(b[0]-a[0]);p[1]=a[1]+m*(b[1]-a[1]);p[2]=a[2]+m*(b[2]-a[2]);return(p);};var M=function(){};var v=[[],[],[],[],[],[],[],[],[],[],[],[]];var f=function(a){var b=0.75;var c=0;if(a.val[0]>b){c|=1;}if(a.val[1]>b){c|=2;}if(a.val[2]>b){c|=4;}if(a.val[3]>b){c|=8;}if(a.val[4]>b){c|=16;}if(a.val[5]>b){c|=32;}if(a.val[6]>b){c|=64;}if(a.val[7]>b){c|=128;}if(e[c]==0){return[];}if(e[c]&1){v[0]=V(b,a.pos[0],a.pos[1],a.val[0],a.val[1]);}if(e[c]&2){v[1]=V(b,a.pos[1],a.pos[2],a.val[1],a.val[2]);}if(e[c]&4){v[2]=V(b,a.pos[2],a.pos[3],a.val[2],a.val[3]);}if(e[c]&8){v[3]=V(b,a.pos[3],a.pos[0],a.val[3],a.val[0]);}if(e[c]&16){v[4]=V(b,a.pos[4],a.pos[5],a.val[4],a.val[5]);}if(e[c]&32){v[5]=V(b,a.pos[5],a.pos[6],a.val[5],a.val[6]);}if(e[c]&64){v[6]=V(b,a.pos[6],a.pos[7],a.val[6],a.val[7]);}if(e[c]&128){v[7]=V(b,a.pos[7],a.pos[4],a.val[7],a.val[4]);}if(e[c]&256){v[8]=V(b,a.pos[0],a.pos[4],a.val[0],a.val[4]);}if(e[c]&512){v[9]=V(b,a.pos[1],a.pos[5],a.val[1],a.val[5]);}if(e[c]&1024){v[10]=V(b,a.pos[2],a.pos[6],a.val[2],a.val[6]);}if(e[c]&2048){v[11]=V(b,a.pos[3],a.pos[7],a.val[3],a.val[7]);}var d=[];for(var i=0;i<t[c].length;i+=3){var g=[];g.push(v[t[c][i]]);g.push(v[t[c][i+1]]);g.push(v[t[c][i+2]]);d.push(g);}return d;};
M.march=function(s){var d=s.numDivision;var g=[];var z,y,x;for(z=0;z<d+2;z++){for(y=0;y<d+2;y++){for(x=0;x<d+2;x++){if(x===0||y===0||z===0||x===d+1||y===d+1||z===d+1){g.push(0);}else{var r=s.unpacked[(z-1)*d*d+(y-1)*d+(x-1)];g.push(Number(r));}}}}var a=d+2;var b=d+2;var c=[];for(z=0;z<d+1;z++){for(y=0;y<d+1;y++){for(x=0;x<d+1;x++){var h=g[z*a*a+y*b+x];var j=g[z*a*a+y*b+x+1];var k=g[(z+1)*a*a+y*b+x+1];var l=g[(z+1)*a*a+y*b+x];var m=g[z*a*a+(y+1)*b+x];var n=g[z*a*a+(y+1)*b+x+1];var o=g[(z+1)*a*a+(y+1)*b+x+1];var p=g[(z+1)*a*a+(y+1)*b+x];var q=x/d-0.55;var u=(x+1)/d-0.55;var w=y/d-0.55;var A=(y+1)/d-0.55;var B=z/d-0.55;var C=(z+1)/d-0.55;var D={pos:[[q,w,B],[u,w,B],[u,w,C],[q,w,C],[q,A,B],[u,A,B],[u,A,C],[q,A,C]],val:[h,j,k,l,m,n,o,p]};c=c.concat(f(D));}}}var E=new Uint16Array(c.length*3);var F=new Float32Array(c.length*9);for(var i=0;i<c.length;i++){E[i*3]=(i*3);E[i*3+1]=(i*3+1);E[i*3+2]=(i*3+2);F[i*9]=(c[i][0][0]);F[(i*9)+1]=(c[i][0][1]);F[(i*9)+2]=(c[i][0][2]);F[(i*9)+3]=(c[i][1][0]);F[(i*9)+4]=(c[i][1][1]);F[(i*9)+5]=(c[i][1][2]);F[(i*9)+6]=(c[i][2][0]);F[(i*9)+7]=(c[i][2][1]);F[(i*9)+8]=(c[i][2][2]);}var G=new THREE.BufferGeometry();var H=new THREE.BufferAttribute((E),1);var I=new THREE.BufferAttribute((F),3);G.setIndex(H);G.setAttribute("position",I);G.computeFaceNormals();G.computeVertexNormals();G.computeBoundingSphere();return G;};
return M;});
sap.ui.predefine('sap/ui/vk/threejs/OutlineRenderer',["jquery.sap.global","./thirdparty/three","sap/base/Log"],function(q,t,L){"use strict";var O=function(o){this._outlineWidth=o;this._copyMaterial=new THREE.MeshBasicMaterial({transparent:true,fog:false});this._maskMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,fog:false});this._outlineMaterial=new THREE.ShaderMaterial({uniforms:{"mask":{value:null},"offset":{value:new THREE.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","	vTC = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","float delta(vec3 c1,  vec3 c2) {","	vec3 dc = c1 - c2;","	return dot(dc, dc);","}","void main() {","	vec3 c = texture2D(mask, vTC).rgb;","	vec3 c1 = texture2D(mask, vTC + offset.xy).rgb;","	vec3 c2 = texture2D(mask, vTC - offset.xy).rgb;","	vec3 c3 = texture2D(mask, vTC + offset.zw).rgb;","	vec3 c4 = texture2D(mask, vTC - offset.yw).rgb;","	vec4 a = vec4(delta(c, c1), delta(c, c2), delta(c, c3), delta(c, c4));","	gl_FragColor = vec4(1.0, 1.0, 1.0, sign(dot(a, a)));","}"].join("\n")});this._expandMaterial=new THREE.ShaderMaterial({uniforms:{"mask":{value:null},"offset":{value:new THREE.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","	vTC = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","void main() {","	float a = texture2D(mask, vTC).a;","	a = max(a, texture2D(mask, vTC + offset.xy).a);","	a = max(a, texture2D(mask, vTC - offset.xy).a);","	a = max(a, texture2D(mask, vTC + offset.zw).a);","	a = max(a, texture2D(mask, vTC - offset.yw).a);","	gl_FragColor = vec4(1.0, 1.0, 1.0, a);","}"].join("\n")});this._screenCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this._screenMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2));};
O.prototype.setOutlineWidth=function(w){this._outlineWidth=w;};
O.prototype.render=function(r,s,c,a,o,j){if(!a||!a.length){return;}var b=r.getSize(new THREE.Vector2());var p=2;var w=b.width*p;var h=b.height*p;if(!this._renderTarget1||this._renderTarget1.width!==w||this._renderTarget1.height!==h){var d={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};this._renderTarget1=new THREE.WebGLRenderTarget(w,h,d);this._renderTarget1.texture.generateMipmaps=false;this._renderTarget2=new THREE.WebGLRenderTarget(w,h,d);this._renderTarget2.texture.generateMipmaps=false;}var n;var e;if(j){n=new Map();e=new Map();j.forEach(function(F){if(!F.node||!F.parent){return;}n.set(F.node,F);if(F.parent){var G=e.get(F.parent)||[];G.push(F);e.set(F.parent,G);}});}var f;var g=new Set();var k=function(F){if(F.isMesh){g.add({mesh:F,color:f});}};var i;for(i=0;i<a.length;i++){var l=a[i];f=new THREE.Color(((i+1)&255)/255,(((i+1)>>8)&255)/255,(((i+1)>>16)&255)/255);l._vkTraverseNodes(k,n,e);}if(g.size===0){return;}var m=r.getClearColor().clone();var u=r.getClearAlpha();var v=r.autoClear;r.autoClear=false;r.setClearColor(0x000000,0);var x;var y=this._renderTarget1;var z=this._renderTarget2;r.setRenderTarget(y);r.clear(true,true,false);var A=g.values();var B=A.next();while(!B.done){var C=B.value.mesh;this._maskMaterial.color=B.value.color;B=A.next();x=C.material;C.material=this._maskMaterial;r.render(C,c);C.material=x;}var D=new THREE.Vector4(1/w,0,0,1/h);x=this._outlineMaterial;x.uniforms.mask.value=y.texture;x.uniforms.offset.value=D;this._screenMesh.material=x;r.setRenderTarget(z);r.render(this._screenMesh,this._screenCamera);if(this._outlineWidth>1){x=this._expandMaterial;x.uniforms.offset.value=D;this._screenMesh.material=x;for(i=1;i<this._outlineWidth;i++){var E=y;y=z;z=E;x.uniforms.mask.value=y.texture;r.setRenderTarget(z);r.render(this._screenMesh,this._screenCamera);}}x=this._copyMaterial;x.map=z.texture;x.color=o;this._screenMesh.material=x;r.setRenderTarget(null);r.render(this._screenMesh,this._screenCamera);r.setClearColor(m,u);r.autoClear=v;};
return O;});
sap.ui.predefine('sap/ui/vk/threejs/UsageCounter',["./thirdparty/three"],function(t){"use strict";var U=function(){};
U.increaseMaterialUsed=function(m){if(m&&m.userData&&m.userData.materialUsed!==undefined){m.userData.materialUsed++;return true;}return false;};
U.decreaseMaterialUsed=function(m){if(m&&m.userData&&m.userData.materialUsed!==undefined){m.userData.materialUsed--;return true;}return false;};
U.increaseGeometryUsed=function(g){if(g&&g.userData&&g.userData.geometryUsed!==undefined){g.userData.geometryUsed++;return true;}return false;};
U.decreaseGeometryUsed=function(g){if(g&&g.userData&&g.userData.geometryUsed!==undefined){g.userData.geometryUsed--;return true;}return false;};
return U;});
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../threejs/thirdparty/three"],function(E,M,a,g,t){"use strict";
var A=E.extend("sap.ui.vk.tools.AnchorPointToolHandler",{
metadata:{},
constructor:function(c){this._priority=10;this._tool=c;this._gizmo=c.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._gizmoScale=1;this._matrixOrigin=new THREE.Matrix4();this._rotationOrigin=new THREE.Matrix4();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();}
});
A.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
A.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var c=this._gizmo.getTouchObject(i);var f=this._rayCaster.intersectObject(c,true);if(f.length>0){this._handleIndex=c.children.indexOf(f[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(c.matrixWorld);this._matrixOrigin.copy(c.matrixWorld);this._gizmoScale=c.scale.x;this._rotationOrigin.extractRotation(c.matrixWorld);if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex).normalize();}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex-3).normalize();}else if(this._handleIndex<9){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex-6).normalize();}}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
A.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
A.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex);e.handled|=this._handleIndex>=0;}};
var d=new THREE.Vector3();
A.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var c=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();d.copy(r.origin).sub(this._gizmoOrigin);return c.dot(d)/c.dot(this._handleAxis);};
A.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;d.copy(this._gizmoOrigin).sub(r.origin);var c=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(c).sub(d);};
A.prototype._getMouseAngle=function(){var r=this._rayCaster.ray;var d=this._rotationPoint.clone().sub(r.origin);var c=this._rotationAxis.dot(d)/this._rotationAxis.dot(r.direction);var m=r.direction.clone().multiplyScalar(c).sub(d).normalize();return Math.atan2(m.dot(this._axis2),m.dot(this._axis1));};
A.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){e.handled=true;this._gesture=true;this._mouseOrigin.copy(e);this._gizmo.selectHandle(this._handleIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset();}else if(this._handleIndex<9){this._axis1=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=new THREE.Vector3().crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=new THREE.Vector3().setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var m=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(m,0).normalize();this._axis2.setFromMatrixColumn(m,1).normalize();this._rotationAxis.setFromMatrixColumn(m,2).normalize();}var l=this._axis1.clone();var c=2;for(var i=0;i<3;i++){var f=new THREE.Vector3().setComponent(i,1);var h=this._rotationAxis.dot(f);if(c>h){c=h;l.copy(f);}}l.sub(this._rotationAxis.clone().multiplyScalar(l.dot(this._rotationAxis))).normalize();this._levelAngle=Math.atan2(l.dot(this._axis2),l.dot(this._axis1));this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0;}}}};
A.prototype._setOffset=function(o){if(this._tool.getEnableStepping()){var s=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*0.1;var m=new THREE.Matrix4().getInverse(this._rotationOrigin);var c=this._gizmoOrigin.clone().applyMatrix4(m);var p=this._gizmoOrigin.clone().add(o).applyMatrix4(m);for(var i=0;i<3;i++){var e=p.getComponent(i);if(Math.abs(e-c.getComponent(i))>s*1e-5){var f=Math.round(e/s)*s;d.setFromMatrixColumn(this._rotationOrigin,i).multiplyScalar(f-e);o.add(d);}}}this._gizmo._setOffset(o,this._gizmoIndex);};
A.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin));}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin));}}else if(this._handleIndex<9){var c=this._startAngle;var f=this._getMouseAngle()-c;if(f>Math.PI){f-=Math.PI*2;}else if(f<-Math.PI){f+=Math.PI*2;}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*f<0){f+=Math.PI*2*Math.sign(this._prevDeltaAngle);}}f=f%(Math.PI*2);var h=c+f;if(this._tool.getEnableStepping()){var s=THREE.Math.degToRad(5);var i=h-c-this._levelAngle;h+=Math.round(i/s)*s-i;}this._prevDeltaAngle=h-c;if(isFinite(c)&&isFinite(h)){this._gizmo._setRotationAxisAngle(this._handleIndex-6,c,h);}}}};
A.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
function b(v){var s=[];if(v){v.enumerateSelection(function(n){s.push(n);});}return s;}
A.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var v=this.getViewport();var m=new M({items:[new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_WORLD_ORIGIN")}),new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTION_CENTER")}),new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_SCENE_CENTER")}),new a({text:g().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTED_OBJECTS_ORIGIN")})],itemSelected:function(e){var i=e.getParameters("item").item;var c=e.getSource().indexOfItem(i);var p=new THREE.Vector3();switch(c){default:case 0:break;case 1:this._tool.moveTo(b(v._viewStateManager),false);return;case 2:var s=v.getScene()?v.getScene().getSceneRef():null;if(s){var f=new THREE.Box3();s._expandBoundingBox(f,null,true);f.getCenter(p);}break;case 3:this._tool.moveTo(b(v._viewStateManager),true);return;}this._gizmo.setPosition(p);v.setShouldRenderFrame();}.bind(this)});m.openAsContextMenu(e.event,v);}}};
A.prototype.getViewport=function(){return this._tool._viewport;};
A.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
A.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var c=document.getElementById(i);if(c===null){return false;}var o=this._getOffset(c);this._rect={x:o.x,y:o.y,w:c.offsetWidth,h:c.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return A;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../threejs/thirdparty/three","./CoordinateSystem"],function(E,M,a,g,t,C){"use strict";
var b=E.extend("sap.ui.vk.tools.MoveToolHandler",{
metadata:{},
constructor:function(c){this._priority=13;this._tool=c;this._gizmo=c.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._gizmoScale=1;this._objectSpace=new THREE.Matrix4();this._mouse=new THREE.Vector2();}
});
b.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
b.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var c=this._gizmo.getTouchObject(i);var f=this._rayCaster.intersectObject(c,true);if(f.length>0){this._handleIndex=c.children.indexOf(f[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(c.matrixWorld);this._gizmoScale=c.scale.x;this._objectSpace.extractRotation(c.matrixWorld);if(this._gizmo._coordinateSystem!==C.World){this._objectSpace.copyPosition(c.matrixWorld);}if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex).normalize();}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(c.matrixWorld,this._handleIndex-3).normalize();}}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
b.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
b.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0;}};
var d=new THREE.Vector3();
b.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var c=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();d.copy(r.origin).sub(this._gizmoOrigin);return c.dot(d)/c.dot(this._handleAxis);};
b.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;d.copy(this._gizmoOrigin).sub(r.origin);var c=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(c).sub(d);};
b.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){this._gesture=true;e.handled=true;this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset();}}}};
b.prototype._setOffset=function(o){if(this._tool.getEnableStepping()){var s=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*0.1;var m=new THREE.Matrix4().getInverse(this._objectSpace);var c=this._gizmoOrigin.clone().applyMatrix4(m);var p=this._gizmoOrigin.clone().add(o).applyMatrix4(m);for(var i=0;i<3;i++){var e=p.getComponent(i);if(Math.abs(e-c.getComponent(i))>s*1e-5){var f=Math.round(e/s)*s;d.setFromMatrixColumn(this._objectSpace,i).multiplyScalar(f-e);o.add(d);}}}if(isFinite(o.x)&&isFinite(o.y)&&isFinite(o.z)){this._gizmo._setOffset(o,this._gizmoIndex);}};
b.prototype.move=function(e){if(this._gesture){if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"move"});}e.handled=true;this._updateMouse(e);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin));}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin));}}}};
b.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
b.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var m=new M({items:[new a({text:g().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:C.World}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:C.Local}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_PARENT"),key:C.Parent}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:C.Screen}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:C.Custom})],itemSelected:function(e){var i=e.getParameters("item").item;this._tool.setCoordinateSystem(i.getKey());}.bind(this)});m.openAsContextMenu(e.event,this.getViewport());}}};
b.prototype.getViewport=function(){return this._tool._viewport;};
b.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
b.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var c=document.getElementById(i);if(c===null){return false;}var o=this._getOffset(c);this._rect={x:o.x,y:o.y,w:c.offsetWidth,h:c.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return b;});
sap.ui.predefine('sap/ui/vk/tools/RectSelectToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.tools.RectSelectToolHandler",{
metadata:{publicMethods:["beginGesture","endGesture","move","click","doubleClick","contextMenu"]},
constructor:function(T){this._tool=T;this._rect=null;this._gesture=false;this._nomenu=false;this._selectionRect=null;}
});
R.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false;};
R.prototype.activate=function(v){this._deactivate=false;if(v._loco){this._viewport=v;v._loco.addHandler(this,1);}};
R.prototype.deactivate=function(){if(this._gesture){this._deactivate=true;}else if(this._viewport){this._deactivate=false;this._viewport._loco.removeHandler(this);this._viewport=null;}};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(a){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};if(document.activeElement){try{document.activeElement.blur();}catch(e){}}d.focus();return(a.x>=this._rect.x&&a.x<=this._rect.x+this._rect.w&&a.y>=this._rect.y&&a.y<=this._rect.y+this._rect.h);};
R.prototype.beginGesture=function(e){if(e.n===1&&this._inside(e)&&!this._gesture){this._gesture=true;e.handled=true;var x=e.x-this._rect.x,y=e.y-this._rect.y;this._selectionRect={x1:x,y1:y,x2:x,y2:y};return;}};
R.prototype.move=function(e){if(this._gesture){e.handled=true;this._nomenu=true;if(this._selectionRect){this._selectionRect.x2=e.x-this._rect.x;this._selectionRect.y2=e.y-this._rect.y;if(this._viewport){this._viewport.setSelectionRect(this._selectionRect);}}}};
R.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;if(this._selectionRect){if(this._viewport){var x=e.x-this._rect.x,y=e.y-this._rect.y;if(this._tool.isViewportType("sap.ui.vk.dvl.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,x,y,null,null);}else if(this._tool.isViewportType("sap.ui.vk.threejs.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,x,y,this._viewport.getScene(),this._viewport.getCamera());}}this._viewport.setSelectionRect(null);this._selectionRect=null;}if(this._deactivate){this.deactivate();}}};
R.prototype.getViewport=function(){return this._viewport;};
return R;});
sap.ui.predefine('sap/ui/vk/tools/RotateToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../threejs/thirdparty/three","./CoordinateSystem"],function(E,M,a,g,t,C){"use strict";
var R=E.extend("sap.ui.vk.tools.RotateToolHandler",{
metadata:{},
constructor:function(b){this._priority=12;this._tool=b;this._gizmo=b.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0.2;this._handleIndex=-1;this._gizmoIndex=-1;this._matrixOrigin=new THREE.Matrix4();this._levelingQuaternion=new THREE.Quaternion();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();}
});
R.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
R.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var b=this._gizmo.getTouchObject(i);var c=this._rayCaster.intersectObject(b,true);if(c.length>0){this._handleIndex=b.children.indexOf(c[0].object);if(this._handleIndex>=0&&this._handleIndex<3){this._gizmoIndex=i;this._matrixOrigin.copy(b.matrixWorld);this._gizmo._getLevelingQuaternion(this._levelingQuaternion,i);this._objectSize=this._gizmo._getObjectSize(i)/this._gizmo._getGizmoScale(b.position);}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
R.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
R.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0;}};
R.prototype._getMouseAngle=function(){var r=this._rayCaster.ray;var d=this._rotationPoint.clone().sub(r.origin);var b=this._rotationAxis.dot(d)/this._rotationAxis.dot(r.direction);var m=r.direction.clone().multiplyScalar(b).sub(d).normalize();return Math.atan2(m.dot(this._axis2),m.dot(this._axis1));};
R.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0&&this._handleIndex<3){e.handled=true;this._gesture=true;this._mouseOrigin.copy(e);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();this._axis1=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=new THREE.Vector3().crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=new THREE.Vector3().setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var m=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(m,0).normalize();this._axis2.setFromMatrixColumn(m,1).normalize();this._rotationAxis.setFromMatrixColumn(m,2).normalize();}this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0;}}};
R.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);var b=this._startAngle;var d=this._getMouseAngle()-b;if(d>Math.PI){d-=Math.PI*2;}else if(d<-Math.PI){d+=Math.PI*2;}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*d<0){d+=Math.PI*2*Math.sign(this._prevDeltaAngle);}}d=d%(Math.PI*2);var c=b+d;if(this._tool.getEnableStepping()){var s=5;if(this._objectSize>0){var f=[0.1,1,5,15];var h=[2000,1000,300,0];for(var i=0;i<4;i++){if(this._objectSize>=h[i]){s=f[i];break;}}}s=THREE.Math.degToRad(s);var j=c-b;c+=Math.round(j/s)*s-j;}this._prevDeltaAngle=c-b;if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"rotate",handleIndex:this._handleIndex,angle1:b,angle2:c});}if(isFinite(b)&&isFinite(c)){this._gizmo._setRotationAxisAngle(this._handleIndex,b,c);}}};
R.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
R.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var m=new M({items:[new a({text:g().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:C.World}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:C.Local}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:C.Screen}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:C.Custom})],itemSelected:function(e){var i=e.getParameters("item").item;this._tool.setCoordinateSystem(i.getKey());}.bind(this)});m.openAsContextMenu(e.event,this.getViewport());}}};
R.prototype.getViewport=function(){return this._tool._viewport;};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return R;});
sap.ui.predefine('sap/ui/vk/tools/ScaleToolHandler',["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../threejs/thirdparty/three","./CoordinateSystem"],function(E,M,a,g,t,C){"use strict";
var S=E.extend("sap.ui.vk.tools.ScaleToolHandler",{
metadata:{},
constructor:function(b){this._priority=11;this._tool=b;this._gizmo=b.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._handleDirection=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();this._originScale=1;this._objectSize=1;}
});
S.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
S.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;if(e.n===1||(e.event&&e.event.type==="contextmenu")){for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var b=this._gizmo.getTouchObject(i);var c=this._rayCaster.intersectObjects(b.children,false);if(c.length>0){this._handleIndex=b.children.indexOf(c[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(b.matrixWorld);this._handleAxis.setFromMatrixColumn(b.matrixWorld,this._handleIndex%3).normalize();this._originScale=this._gizmo._getObjectScale(i).x;this._objectSize=(this._gizmo._getObjectSize(i)/b.scale.x)||1;var d=new THREE.Vector3().setFromMatrixColumn(b.matrixWorld,(this._handleIndex+1)%3).normalize();var f=new THREE.Vector3().setFromMatrixColumn(b.matrixWorld,(this._handleIndex+2)%3).normalize();this._handleDirection.addVectors(d,f).normalize();}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
S.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0;}};
S.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0;}};
S.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var d=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();var b=r.origin.clone().sub(this._gizmoOrigin);return d.dot(b)/d.dot(this._handleAxis);};
S.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;var d=this._gizmoOrigin.clone().sub(r.origin);var b=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(b).sub(d);};
S.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){this._gesture=true;e.handled=true;this._mouseOrigin.set(e.x,e.y);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._handleDirection.dot(this._getPlaneOffset());}}}};
S.prototype.move=function(e){if(this._gesture){if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"scale"});}e.handled=true;this._updateMouse(e);var s=new THREE.Vector3().setScalar(1);if(this._handleIndex<3){if(this._tool.getNonUniformScaleEnabled()){s.setComponent(this._handleIndex,this._getAxisOffset()/this._dragOrigin);}else{s.setScalar(this._getAxisOffset()/this._dragOrigin);}}else if(this._handleIndex<6){s.setScalar(this._handleDirection.dot(this._getPlaneOffset())/this._dragOrigin).setComponent(this._handleIndex-3,1);}else{var d=(this._mouseOrigin.y-e.y)/60;s.setScalar(d>=0?1+d:1/(1-d));}if(s.x&&s.y&&s.z&&isFinite(s.x)&&isFinite(s.y)&&isFinite(s.z)){if(this._tool.getEnableStepping()){var b=Math.pow(10,Math.round(Math.log10(this._originScale/this._objectSize)))/this._originScale;if(b>0&&isFinite(b)){s.setScalar(Math.max(Math.round(s.x/b),1)*b);}}this._gizmo._setScale(s);}}};
S.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
S.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return;}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var m=new M({items:[new a({text:g().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:C.World}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:C.Local}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:C.Screen}),new a({text:g().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:C.Custom})],itemSelected:function(e){var i=e.getParameters("item").item;this._tool.setCoordinateSystem(i.getKey());}.bind(this)});m.openAsContextMenu(e.event,this.getViewport());}}};
S.prototype.getViewport=function(){return this._tool._viewport;};
S.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return S;});
sap.ui.predefine('sap/ui/vk/totara/CallbackHandler',[],function(){"use strict";var C=function(){this.callbacks=[];};
C.prototype.attach=function(c){this.callbacks.push(c);};
C.prototype.detach=function(c){var i=this.callbacks.indexOf(c);if(i!==-1){this.callbacks.splice(i,1);return true;}return false;};
C.prototype.execute=function(a){for(var i=0;i<this.callbacks.length;i++){this.callbacks[i](a);}};
C.prototype.detachAll=function(){this.callbacks=[];};
return C;});
sap.ui.predefine('sap/ui/vk/totara/GeometryFactory',["./IndexCompressor"],function(I){"use strict";var a=1;var H=2;var b=4;var V=0;var c=3;var G=function(){};
G.getGeometryInfo=function(g,f){var h=new DataView(f.buffer,f.byteOffset,f.byteLength);var o=0;var k=(g.flags&H)>0;var l=(g.flags&b)>0;var m=(g.flags&a)>0;var n=false;var p=[];var q=[];var u=[];var r=[];var s=1;var t=1;var v=1;var w=new THREE.Vector3(0,0,0);var x=[w.x-s/2,w.y-t/2,w.z-v/2,w.x+s/2,w.y+t/2,w.z+v/2];var y=new I(f,f.length);y.setCurByte(o);if(!y.ReadCommand()){throw"buffer over flow";}var z=y.rvalue;var A;if(z){A=U(y,g.pointCount,z,x,p);if(A.isOk){p=A.array;n=true;}else{return false;}}var B=1;if(k){if(!y.ReadCommand()){return false;}B=y.rvalue;if(B){A=d(y,g.pointCount,B);if(A.isOk){q=A.array;}else{return false;}}}var C=1;var N=false;if(l){if(!y.ReadCommand()){return false;}C=y.rvalue;if(C){A=e(y,g.pointCount,C);if(A.isOk){N=true;u=A.array;}else{return false;}}}if(!z||!B||!C||N){if(N){o=y.getCurByte();var D=h.getFloat32(o,true);var E=h.getFloat32(o+4,true);y.moveCurByte(8);if((D!==0.0)||(E!==1.0)){var F=E-D;for(var J=0;J<g.pointCount*2;J++){u[J]=u[J]*F+D;}}}var K;if(!z){o=y.getCurByte();for(K=0;K<g.pointCount;K++){p.push(h.getFloat32(o+K*4,true));p.push(h.getFloat32(o+(K+g.pointCount)*4,true));p.push(h.getFloat32(o+(K+g.pointCount*2)*4,true));}y.moveCurByte(g.pointCount*3*4);}if(!B){o=y.getCurByte();for(K=0;K<g.pointCount;K++){q.push(h.getFloat32(o+(K)*4,true));q.push(h.getFloat32(o+(K+g.pointCount*1)*4,true));q.push(h.getFloat32(o+(K+g.pointCount*2)*4,true));}y.moveCurByte(g.pointCount*3*4);}if(!C){if(l){o=y.getCurByte();for(K=0;K<g.pointCount;K++){u.push(h.getFloat32(o+(K)*4,true));u.push(h.getFloat32(o+(K+g.pointCount*1)*4,true));}y.moveCurByte(g.pointCount*2*4);}}}var L=y.getCurByte();y.Reset();y.setCurByte(L);var M=[0,0,0];var O=m?2:3;for(var i=0;i<g.elementCount;i++){for(var j=0;j<O;j++){if(!y.ReadCommand(M[j])){throw"UIC1 Decompression error!!!";}else{r.push(y.rvalue);M[j]=y.rvalue;}}}return{id:g.id,isPolyline:m,isPositionQuantized:n,data:{indices:r,points:p,normals:q,uvs:u}};};
function U(f,p,n,g){var r={array:new Array(p*3),isOk:false};for(var x=0;x<3;x++){var v=g[V+x];var q=(g[c+x]-v)/n;for(var i=0;i<p;i++){if(!f.ReadCommand()){return r;}r.array[i*3+x]=q*f.rvalue+v;}}r.isOk=true;return r;}
function d(i,p,n){var r={array:[],isOk:false};var t=[];var f;for(f=0;f<p;f++){if(!i.ReadCommand()){return r;}t.push(i.rvalue);}var q=2*Math.PI/n;var g;var h;var k;for(f=0;f<p;f++){if(!i.ReadCommand()){return r;}g=q*t[f];h=q*i.rvalue;k=Math.sin(h);r.array.push(k*Math.cos(g));r.array.push(k*Math.sin(g));r.array.push(Math.cos(h));}r.isOk=true;return r;}
function e(f,p,n){var r={array:new Array(p*2),isOk:false};var q=1.0/n;for(var u=0;u<2;u++){for(var i=0;i<p;i++){if(!f.ReadCommand()){return false;}r.array[i*2+u]=q*f.rvalue;}}r.isOk=true;return r;}
return G;});
sap.ui.predefine('sap/ui/vk/totara/IndexCompressor',[],function(){"use strict";var I=function(b,a){var V=32;var c=16;var C=13;var e=14;var f=0;var g=1;var h=3;var i=4;var k=5;var l=6;var m=7;var n=8;var o=9;var p=10;var q=11;var r=12;var s=15;var E=0;var t=1;var u=2;var v=3;var w=4;var x=5;var y=6;var z=7;var A=8;var B=9;var D=10;var F=11;var G=12;var H=13;var J=4294967295;var K=0;this.rvalue=0;var L=0;var M=b;var N=a;var O=0;var P=new Array(V);var Q=new Array(c);var R=V-1;var S=c-1;var T=false;this.Reset=function(){K=0;this.rvalue=0;L=0;O=0;var j;for(j=0;j<V;j++){P[j]=V-j-1;}for(j=0;j<c;j++){Q[j]=1;}R=V-1;S=c-1;};this.Reset();function U(d){return P[(R>=d)?(R-d):(V+R-d)];}function W(d){return Q[(S>=d)?(S-d):(c+S-d)];}function X(d){R++;if(R>=V){R=0;}P[R]=d;}function Y(d){S++;if(S>=c){S=0;}Q[S]=d;}function Z(){if(O<N){return M[O++];}T=true;return 0;}function $(){return Z()+Z()*256;}function _(){return Z()+Z()*256+Z()*65536+Z()*16777216;}this.ReadCommand=function(j){if(j===undefined){j=J;}T=false;var a1=this.rvalue;if(K){K--;this.rvalue=U(L);}else{var b1=Z();if(T){b1=g;}var c1=b1>>>4;switch(b1&0xF){case f:this.rvalue=U(c1);break;case k:this.rvalue=U(16+c1);break;case C:this.rvalue=U(c1>>>2);L=c1&3;K=1;break;case e:this.rvalue=U(0);L=0;K=c1+2;break;case l:this.rvalue+=W(c1);break;case g:if(b1&16){this.rvalue+=(b1>>>5)+1;}else{this.rvalue-=(b1>>>5)+1;}break;case h:this.rvalue=j+(c1+1);break;case i:this.rvalue=j-(c1+1);break;case m:this.rvalue=j+(c1+17);break;case n:this.rvalue=j-(c1+17);break;case o:this.rvalue+=c1+((Z())<<4)+3;break;case p:this.rvalue-=c1+((Z())<<4)+3;break;case q:this.rvalue=c1+((Z())<<4);break;case r:var d1=$();this.rvalue=c1+(d1<<4);break;case s:switch(b1>>>4){case E:case t:case u:case v:case w:this.rvalue=b1>>>4;break;case x:this.rvalue=0x000000FF;break;case y:this.rvalue=0x0000FF00;break;case z:this.rvalue=0x00FF0000;break;case A:this.rvalue=0xFF000000;break;case B:this.rvalue=0x00FFFFFF;break;case D:this.rvalue=0xFFFFFFFF;break;case H:L=0;K=$()+36;break;case F:{var bl=Z();this.rvalue=($()<<8)+bl;}break;case G:this.rvalue=_();break;default:return false;}break;default:return false;}}if(this.rvalue>0xFFFFFFFF){this.rvalue=this.rvalue-0xFFFFFFFF-1;}X(this.rvalue);var d;if(this.rvalue!=a1){if(this.rvalue>a1){d=this.rvalue-a1;if(d<0x7FFFFFFF){Y(d);}}else{d=a1-this.rvalue;if(d<0x7FFFFFFF){Y(-d);}}}if(T){K=0;this.rvalue=0;return false;}return true;};this.getCurByte=function(){return O;};this.setCurByte=function(d){O=d;};this.moveCurByte=function(d){O=O+d;};};return I;});
sap.ui.predefine('sap/ui/vk/totara/ProgressCounter',[],function(){"use strict";
function C(){this._count=0;this._total=0;var o;this.setOnValueChanged=function(c){o=c;};this.callOnValueChanged=function(){if(o){o();}};}
var p=C.prototype;Object.defineProperty(p,"count",{get:function(){return this._count;},set:function(v){if(v!==this._count){this._count=v;this.callOnValueChanged();}}});Object.defineProperty(p,"total",{get:function(){return this._total;},set:function(v){if(v!==this._total){this._total=v;this.callOnValueChanged();}}});var P=function(){var o;function a(){if(o){o(this);}}this.mesh=new C();this.geometry=new C();this.mesh.setOnValueChanged(a);this.geometry.setOnValueChanged(a);this.setOnProgressChanged=function(c){o=c;};};return P;});
sap.ui.predefine('sap/ui/vk/totara/RequestQueue',["./TotaraUtils","./Command"],function(T,C){"use strict";
function R(b){this.batchSize=b;this.globalList=new Set();this.requestedList=[];this.waitingList=new Set();}
R.prototype.push=function(i,r){if(!this.globalList.has(i)){this.globalList.add(i);this.requestedList.push(r||i);this.waitingList.add(i);}};
R.prototype.fetchBatch=function(){return this.requestedList.splice(0,this.batchSize);};
R.prototype.pop=function(i){return this.waitingList.delete(i);};
R.prototype.isReady=function(i){return this.globalList.has(i)&&!this.waitingList.has(i);};
R.prototype.clear=function(i){this.globalList.clear();this.requestedList=[];this.waitingList.clear();};
R.prototype.isEmpty=function(){return this.requestedList.length===0;};
R.prototype.isWaiting=function(){return this.waitingList.size>0;};
function P(b,m){R.call(this,b);this.maxBatchDataSize=m;this.minBatchDataSize=m>>1;this.priorityMap=new Map();}
P.prototype=Object.create(R.prototype);P.prototype.constructor=P;
P.prototype.push=function(i,p,s){if(!this.globalList.has(i)){s=s||1;this.globalList.add(i);this.requestedList.push(i);this.waitingList.add(i);this.priorityMap.set(i,{p:p,s:s});}};
P.prototype.clear=function(){R.prototype.clear.call(this);this.priorityMap.clear();};
P.prototype.fetchBatch=function(){var p=this.priorityMap;this.requestedList.sort(function(a,b){return p.get(a).p-p.get(b).p;});var d=[];var s=0;for(var i=0;i<this.batchSize&&this.requestedList.length>0;i++){var e=this.requestedList.pop();var r=p.get(e).s;if(s>this.minBatchDataSize&&s+r>this.maxBatchDataSize){this.requestedList.push(e);break;}s+=r;p.delete(e);d.push(e);}return d;};
var c=function(a,s){this.context=a;this.sceneId=s;this.token=a.token||T.generateToken();this.meshes=new R(128);this.materials=new R(128);this.textures=new R(1);this.geometries=new P(32,0x100000);this.geomMeshes=new P(32,0x100000);this.annotations=new R(128);this.views=new R(1);this.thumbnails=new R(1);this.tracks=new R(128);this.sequences=new R(128);this.highlights=new R(1);};
c.prototype.isEmpty=function(){return this.meshes.isEmpty()&&this.annotations.isEmpty()&&this.materials.isEmpty()&&this.textures.isEmpty()&&this.geometries.isEmpty()&&this.geomMeshes.isEmpty()&&this.views.isEmpty()&&this.thumbnails.isEmpty()&&this.tracks.isEmpty()&&this.sequences.isEmpty()&&this.highlights.isEmpty();};
c.prototype.isWaitingForContent=function(){return this.meshes.isWaiting()||this.textures.isWaiting()||this.materials.isWaiting()||this.geometries.isWaiting()||this.geomMeshes.isWaiting()||this.annotations.isWaiting()||this.views.isWaiting()||this.thumbnails.isWaiting()||this.tracks.isWaiting()||this.sequences.isWaiting()||this.highlights.isWaiting();};
c.prototype.clearContent=function(){this.meshes.clear();this.annotations.clear();this.materials.clear();this.textures.clear();this.geometries.clear();this.geomMeshes.clear();this.views.clear();this.thumbnails.clear();this.tracks.clear();this.sequences.clear();this.highlights.clear();};
c.prototype.createGetContentCommand=function(a,i,e){var o={sceneId:this.sceneId,ids:i.map(function(b){return parseInt(b,10);}),token:this.token};return T.createRequestCommand(a,e?Object.assign(o,e):o);};
c.prototype.generateRequestCommand=function(){var i;var a=null;if(!this.meshes.isEmpty()){i=this.meshes.fetchBatch();a=this.createGetContentCommand(C.getMesh,i);}else if(!this.annotations.isEmpty()){i=this.annotations.fetchBatch();a=this.createGetContentCommand(C.getAnnotation,i);}else if(!this.materials.isEmpty()){i=this.materials.fetchBatch();a=this.createGetContentCommand(C.getMaterial,i);}else if(!this.geometries.isEmpty()){i=this.geometries.fetchBatch();a=this.createGetContentCommand(C.getGeometry,i);a.sceneId=this.sceneId;a.geometryIds=i;}else if(!this.geomMeshes.isEmpty()){i=this.geomMeshes.fetchBatch();a=this.createGetContentCommand(C.getMesh,i,{$expand:"geometry"});a.sceneId=this.sceneId;a.meshIds=i;}else if(!this.textures.isEmpty()){i=this.textures.fetchBatch();a=this.createGetContentCommand(C.getImage,[i[0].imageId]);a.sceneId=this.sceneId;a=Object.assign(a,i[0]);}else if(!this.sequences.isEmpty()){i=this.sequences.fetchBatch();a=this.createGetContentCommand(C.getSequence,i);}else if(!this.tracks.isEmpty()){i=this.tracks.fetchBatch();a=this.createGetContentCommand(C.getTrack,i);}else if(!this.views.isEmpty()){i=this.views.fetchBatch();var e="nodes,bounds,animation";var b=this.context.includeAnimation!==undefined?this.context.includeAnimation:true;if(!b){e="nodes,bounds";}var s="name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";a=T.createRequestCommand(C.getView,{sceneId:this.sceneId,groupId:i[0].viewGroupId,id:i[0].viewId,includeHidden:this.context.includeHidden!==undefined?this.context.includeHidden:false,$expand:e,$select:s,token:this.token});}else if(!this.highlights.isEmpty()){i=this.highlights.fetchBatch();a=T.createRequestCommand(C.getHighlightStyle,{sceneId:this.sceneId,id:i[0],token:this.token});}else if(!this.thumbnails.isEmpty()){i=this.thumbnails.fetchBatch();a=this.createGetContentCommand(C.getImage,[i[0].imageId]);a.sceneId=this.sceneId;a=Object.assign(a,i[0]);}return a;};
return c;});
sap.ui.predefine('sap/ui/vk/totara/SceneContext',["sap/base/Log","./CallbackHandler","./TotaraUtils","./GeometryFactory","./ProgressCounter","./RequestQueue","../getResourceBundle","../AnimationRotateType"],function(L,C,T,G,P,R,g,A){"use strict";var S=function(s,p,l){this.root=null;this.onActiveCameraCallbacks=new C();this.onInitialSceneFinishedCallbacks=new C();this.onPartialRetrievalFinishedCallbacks=new C();this.onSceneCompletedCallbacks=new C();this.onSetPlaybackCallbacks=new C();this.onViewFinishedCallbacks=new C();this.onViewPartialRetrievalFinishedCallbacks=new C();this.onViewGroupFinishedCallbacks=new C();this.onContentChangesProgressCallbacks=new C();Object.assign(this,p);this.sceneId=s;this.loader=l;this.sceneBuilder=l.sceneBuilder;this.requestQueue=new R(this,s);this.phase=S.Phase.Started;this.retrievalType=S.RetrievalType.Initial;this.rootNodeId=null;this.meshNodes=new Map();this.annotationNodeMap=new Map();this.leaderLineMaterialIdMap=new Map();this.imageNoteMaterialIdMap=new Map();this.thumbnailViewMap=new Map();this.viewThumbnailMap=new Map();this.viewAnimatedThumbnailMap=new Map();this.progressCount=new P();this.treeNodes=[];this.viewIdTreeNodesMap=new Map();this.nodeSidsForPartialTree=new Set();this.replacedNodes=new Map();this.updatedNodes=new Set();this.authorizationHandler=null;this.currentViewId=null;this.initialViewId=null;this.initialViewDecided=false;this.eventObject={};this.eventObject.percentage=0;this.loadingGeometry=0;};S.Phase={Started:0,FinishedHierarchy:1,FinishedMesh:2,FinishedGeometry:3};S.RetrievalType={Initial:0,Partial:1};S.ProgressPhase={FinishedTree:g().getText("SCENE_CONTEXT_FINISHED_TREE"),FinishedMeshes:g().getText("SCENE_CONTEXT_FINISHED_MESHES"),FinishedMaterials:g().getText("SCENE_CONTEXT_FINISHED_MATERIALS"),FinishedGeomMeshes:g().getText("SCENE_CONTEXT_FINISHED_GEOMETRIES"),LoadingGeomMeshes:g().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),FinishedTextures:g().getText("SCENE_CONTEXT_FINISHED_TEXTURES")};
S.prototype.setOnProgressChanged=function(c){this.progressCount.setOnProgressChanged(c);};
S.prototype.isLoadingFinished=function(){if(!this.requestQueue.isEmpty()||this.requestQueue.isWaitingForContent()||this.thumbnailViewMap.size>0||this.viewThumbnailMap.size>0||this.viewAnimatedThumbnailMap.size>0||this.meshNodes.size>0||this.annotationNodeMap.size>0||this.leaderLineMaterialIdMap.size>0||this.imageNoteMaterialIdMap.size>0||this.viewIdTreeNodesMap.size>0||this.nodeSidsForPartialTree.size>0){return false;}return true;};
S.prototype.isSceneCompleted=function(){return!this.requestQueue.meshes.isWaiting()&&!this.requestQueue.annotations.isWaiting()&&!this.requestQueue.materials.isWaiting()&&!this.requestQueue.geomMeshes.isWaiting()&&!this.requestQueue.geometries.isWaiting()&&!this.requestQueue.textures.isWaiting();};
S.prototype._checkSceneCompletion=function(){if(this.isSceneCompleted()){if(this.eventObject.percentage<100){this.eventObject.percentage=100;this.onContentChangesProgressCallbacks.execute(this.eventObject);}this.onSceneCompletedCallbacks.execute();L.info("Scene completed.");T.mark("sceneCompleted");this.logPerformance("sceneCompleted");}};
S.prototype._fireProgress=function(a){switch(a){case S.ProgressPhase.FinishedTree:this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedTree;this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case S.ProgressPhase.FinishedMeshes:if(!this.requestQueue.meshes.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedMeshes;this.onContentChangesProgressCallbacks.execute(this.eventObject);}break;case S.ProgressPhase.FinishedMaterials:if(!this.requestQueue.materials.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedMaterials;this.onContentChangesProgressCallbacks.execute(this.eventObject);}break;case S.ProgressPhase.LoadingGeomMeshes:this.eventObject.percentage+=61*(1/this.requestQueue.geomMeshes.globalList.size);if(this.eventObject.percentage>100){this.eventObject.percentage=100;}this.loadingGeometry+=61*(1/this.requestQueue.geomMeshes.globalList.size);if(this.loadingGeometry>=60){this.eventObject.phase=S.ProgressPhase.FinishedGeomMeshes;}else{this.eventObject.phase=S.ProgressPhase.LoadingGeomMeshes;}this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case S.ProgressPhase.FinishedTextures:if(!this.requestQueue.textures.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=S.ProgressPhase.FinishedTextures;this.onContentChangesProgressCallbacks.execute(this.eventObject);}break;default:}};
S.prototype.dispose=function(){this.sceneId=null;this.progressCount=null;this.requestQueue=null;this.suppressedBoundingBoxListMap=null;this.treeNodes=null;this.nodeSidsForPartialTree=null;this.meshNodes=null;this.annotationNodeMap=null;this.leaderLineMaterialIdMap=null;this.imageNoteMaterialIdMap=null;this.thumbnailViewMap=null;this.viewThumbnailMap=null;this.viewAnimatedThumbnailMap=null;this.replacedNodes=null;this.updatedNodes=null;this.viewIdTreeNodesMap=null;this.onActiveCameraCallbacks=null;this.onInitialSceneFinishedCallbacks=null;this.onPartialRetrievalFinishedCallbacks=null;this.onViewPartialRetrievalFinishedCallbacks=null;this.onSceneCompletedCallbacks=null;this.onViewFinishedCallbacks=null;this.onSetPlaybackCallbacks=null;this.onContentChangesProgressCallbacks=null;};
S.prototype.logPerformance=function(n){if(this.progressLogger&&this.token){this.progressLogger.logPerformance(n,this.token);}};
S.prototype.setCameraSingle=function(c){this.sceneBuilder.createCamera(c,this.sceneId);return this.sceneBuilder.getCamera(c.id);};
S.prototype.getPartialTreeNodes=function(t){var p=[];var a=[];var i,j,b;if(t&&t.length){for(i=0;i<t.length;i++){b=t[i];if(b==null){continue;}if(b&&b.children){if(b.entityId!=null&&b.children.length===1){var r=b.children[0];var c=t[r];if(c.entityId==null){c.name=b.name;b.visualisable=false;}}if(b.children){for(j=0;j<b.children.length;j++){var d=b.children[j];t[d].parentNode=b;if(b.renderOrder){t[d].renderOrder=b.renderOrder;}}}}}}if(t&&t.length){for(i=0;i<t.length;i++){b=t[i];if(b==null){continue;}if(b.parent){p.push(b);}else if(!b.parentNode){p.push(b);if(this.rootNodeId){b.parent=this.rootNodeId;}}if(this.nodeSidsForPartialTree.has(b.sid)){a.push(b);}}}this.nodeSidsForPartialTree.clear();if(!a.length){return p;}p=[];for(j=0;j<a.length;j++){var n=a[j];var e=n.parentNode;while(e){if(this.sceneBuilder.getNode(e.sid,this.sceneId)){n.parent=e.sid;p.push(n);break;}else{n=e;e=e.parentNode;}}}return p.length?p:a;};
S.prototype.buildTree=function(){var r={};if(!this.treeNodes||!this.treeNodes.length){r.error="no tree information";return r;}var t=this.treeNodes;var p=this.getPartialTreeNodes(t);this.replacedNodes.clear();var a=[];var i;var b;for(i=0;i<p.length;i++){b=p[i].parent;if(this.sceneBuilder.getNode(b,this.sceneId)){this.buildNode(p[i],b);}else{a.push(p[i]);}}for(i=0;i<a.length;i++){b=a[i].parent;if(this.sceneBuilder.getNode(b,this.sceneId)){this.buildNode(p[i],b);}else{r.error=(r.error||"")+"parent ${parentSid} does not exist in the scene. \n";}}if(this.retrievalType===S.RetrievalType.Partial){this.sceneBuilder.updateViewsForReplacedNodes(this.treeNodes);}this.treeNodes=[];this.progressCount.mesh.total=this.requestQueue.meshes.globalList.size;return r;};
S.prototype.buildNode=function(t,p){if(!t||!p){this.loader.reportError(this,"SceneContext - buildNode - invalid args");return;}var e=this.sceneBuilder.getNode(t.sid,this.sceneId);if(e){this.sceneBuilder.remove(t.sid,this.sceneId);}if(t.suppressed===true){return;}if(!t.sid){this.loader.reportError(this,"sid is missing in treeNode");return;}t.parentId=p;this.sceneBuilder.createNode(t,this.sceneId);if(t.meshId&&!this.sceneBuilder.hasMesh(t.meshId)){T.pushElementIntoMapArray(this.meshNodes,t.meshId,t.sid);this.requestQueue.meshes.push(t.meshId);}if(t.annotationId){this.annotationNodeMap.set(t.annotationId,t.sid);this.requestQueue.annotations.push(t.annotationId);}var n=this.sceneBuilder.getNode(t.sid,this.sceneId);if(e&&n){this.replacedNodes.set(e,n);}if(t.children){var a=this.treeNodes;for(var i=0;i<t.children.length;i++){var b=t.children[i];this.buildNode(a[b],t.sid);}}};
S.prototype.setTree=function(j){if(j.sid){var r=this.sceneBuilder.getNode(j.sid,this.sceneId);if(!r||r!==this.root){var a=this.root;a.userData.treeNode={sid:j.sid,name:this.root.name?this.root.name:"root"};a.userData.skipIt=!this.root.name;this.sceneBuilder.setRootNode(a,j.sid,this.sceneId,this.vkScene);this.rootNodeId=j.sid;}}if(j.camera){j.camera.id="initial";var c=this.setCameraSingle(j.camera);if(c){this.onActiveCameraCallbacks.execute(c);}}T.measure("setTreeMeasure-"+this.sceneId,"setTree-"+this.sceneId);};
S.prototype.setTreeNode=function(j){if(!Array.isArray(j.nodes)){return{error:"setTreeNode error: nodes are not properly defined"};}this.treeNodes=this.treeNodes.concat(j.nodes);return{};};
S.prototype.notifyFinishedTree=function(c){this.buildTree();this.phase=S.Phase.FinishedHierarchy;if(!this.loader._pushMesh){if(!this.requestQueue.meshes.isWaiting()){if(this.retrievalType===S.RetrievalType.Initial){this.onInitialSceneFinishedCallbacks.execute(this.initialView);}if(this.retrievalType===S.RetrievalType.Partial){this.onPartialRetrievalFinishedCallbacks.execute();}this.onViewPartialRetrievalFinishedCallbacks.execute();this._checkSceneCompletion();}}this._fireProgress(S.ProgressPhase.FinishedTree);return{};};
S.prototype.setViewGroup=function(j){this.sceneBuilder.insertViewGroup(j,this.sceneId);if(!Array.isArray(j.views)){return;}var v=j.id;var i,a;if(!this.currentViewGroupId){if(this.currentViewId){for(i=0;i<j.views.length;i++){a=j.views[i];if(a.id===this.currentViewId){this.currentViewGroupId=v;break;}}}else{this.currentViewGroupId=v;}}if(this.currentViewGroupId!==v){return;}if(!this.currentViewId){this.currentViewId=j.views[0].id;}for(i=0;i<j.views.length;i++){a=j.views[i];var e=this.sceneBuilder.getView(a.id,this.sceneId);for(var t=0;t<2;t++){var p=["thumbnailId","animatedThumbnailId"][t];var b=a[p];if(b!==undefined){a[p]=b=b.toString();if(this.sceneBuilder.hasImage(b)){this.sceneBuilder.setViewThumbnail(b,a.id,this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();}else{this.thumbnailViewMap.set(b,a.id);this.requestQueue.thumbnails.push(b,{imageId:b,viewId:a.id});}if(!e){this[["viewThumbnailMap","viewAnimatedThumbnailMap"][t]].set(a.id,b);}}}if(e){e.userData.viewInfo.thumbnailId=a.thumbnailId;e.userData.viewInfo.animatedThumbnailId=a.animatedThumbnailId;continue;}this.requestQueue.views.push(a.id,{viewId:a.id,viewGroupId:v});}if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();if(this.requestQueue.sequences.isEmpty()){this.onViewGroupFinishedCallbacks.execute();}}T.measure("setViewGroupMeasure-"+v,"setViewGroup-"+v);};
S.prototype.setView=function(j){var v=j.viewId;if(!v){this.setTree(j);this.initialViewDecided=true;return;}if(!this.initialViewId&&!this.initialViewDecided){this.initialViewId=v;this.currentViewId=v;this.initialViewDecided=true;}var c;if(this.initialViewId===v){if(j.camera){c=j.camera.id;}this.setTree(j);}var t=this.viewThumbnailMap.get(v);if(t){this.viewThumbnailMap.delete(v);j.thumbnailId=t;}var a=this.viewAnimatedThumbnailMap.get(v);if(a){this.viewAnimatedThumbnailMap.delete(v);j.animatedThumbnailId=a;}this.sceneBuilder.insertView(j,this.sceneId);var b=[];this.viewIdTreeNodesMap.set(v,b);if(j.camera){if(c){j.camera.id=c;}this.setCameraSingle(j.camera);this.sceneBuilder.setViewCamera(j.camera.id,v,this.sceneId);}this.logPerformance("setView");T.measure("setViewMeasure-"+v,"setView-"+v);};
S.prototype.setViewNode=function(c){var r={context:this};if(!c.viewId){this.setTreeNode(c);return r;}if(this.initialViewId===c.viewId){this.setTreeNode(c);}var v=this.sceneBuilder.getView(c.viewId,c.sceneId);if(!v){r.error="setViewNode error: setViewNode - no setView was in the chain";return r;}if(this.initialViewId===c.viewId){this.initialView=v;}var t=this.viewIdTreeNodesMap.get(c.viewId);t=t.concat(c.nodes);this.viewIdTreeNodesMap.set(c.viewId,t);return r;};
S.prototype.notifyFinishedView=function(j){var v=j.viewId;if(!v){return this.notifyFinishedTree(j);}this.requestQueue.views.pop(v);if(this.initialViewId===v){this.notifyFinishedTree(j);this.initialViewId=null;}var a=this.sceneBuilder.getView(v,this.sceneId);if(!a){return{error:"notifyFinishedView error: setViewNode - no setView was in the chain"};}if(a.activeCameraId!==undefined){a.setCamera(this.sceneBuilder.getCamera(a.activeCameraId));}this.updatedNodes.clear();var b=this.buildView(v);this.sceneBuilder.setViewNodeInfos(b.nodeInfos,v,this.sceneId);a.updatedNodes=Array.from(this.updatedNodes);if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();if(this.requestQueue.sequences.isEmpty()){this.onViewGroupFinishedCallbacks.execute();}}if(!this.requestQueue.meshes.isWaiting()){this.onViewFinishedCallbacks.execute(a);}else{var c=function(){setTimeout(function(){this.onViewPartialRetrievalFinishedCallbacks.detach(c);}.bind(this),0);this.onViewFinishedCallbacks.execute(a);}.bind(this);this.onViewPartialRetrievalFinishedCallbacks.attach(c);this.logPerformance("notifyFinishedView");}};
S.prototype.buildView=function(v){var r={};this.treeNodes=this.viewIdTreeNodesMap.get(v);if(!this.treeNodes||!this.treeNodes.length){r.error="no tree information in view";return r;}var p=this.getPartialTreeNodes(this.treeNodes);var n=[];for(var i=0;i<p.length;i++){var a=p[i].parent;this.processNode(v,p[i],n,a);}r.nodeInfos=n;this.treeNodes=[];this.viewIdTreeNodesMap.delete(v);return r;};
S.prototype.buildViewNode=function(v,t,n){if(!t){this.loader.reportError(this,"ViewBuilder - buildViewNode - invalid args");return;}var a=this.sceneBuilder.getNode(t.sid,this.sceneId);if(t.materialId){if(!this.sceneBuilder.checkMaterialExists(t.materialId,true)){this.requestQueue.materials.push(t.materialId);}}var b={target:a,visible:t.visible!==undefined?t.visible:true,materialId:t.materialId,opacity:t.opacity,meshId:t.meshId,transform:Array.isArray(t.transform)?T.arrayToColumnMajorMatrixArray16(t.transform):[1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0]};n.push(b);var c=this.treeNodes;var e=this.sceneBuilder.getChildNodeIds(t.sid,this.sceneId);var d=t.children?t.children.map(function(p){return c[p].sid;}):[];var f;var i;for(i=0;i<e.length;i++){f=e[i];for(var j=0;j<d.length;j++){if(f===d[j]){e[i]=undefined;break;}}}for(i=0;i<e.length;i++){var h=e[i];if(h!==undefined){var k=this.sceneBuilder.getNode(h,this.sceneId);var l=false;n.push({target:k,visible:l});}}if(t.children){for(i=0;i<t.children.length;i++){var m=t.children[i];var o=this.treeNodes[m];this.processNode(v,o,n,t.sid);}}};
S.prototype.processNode=function(v,t,n,p){var a=this.sceneBuilder.getNode(t.sid,this.sceneId);if(a){this.buildViewNode(v,t,n);}else{this.buildNode(t,p);var b=this.sceneBuilder.getNode(t.sid,this.sceneId);if(b){b.visible=false;n.push({target:b,visible:t.visible===undefined?true:t.visible});}}if(t.highlightStyleId){this.sceneBuilder.recordHighlightedNodeInView(t.highlightStyleId,t.sid,v,this.sceneId);if(!this.sceneBuilder.highlightStyleExists(t.highlightStyleId)){this.requestQueue.highlights.push(t.highlightStyleId);}}};
S.prototype.setAnnotationSingle=function(a){var n=this.annotationNodeMap.get(a.id);if(n){a.nodeId=n;if(a.detailView||a.cutaway){this.sceneBuilder.createDetailView(a,this.sceneId);}else if(a.labelMaterialId||(a.label&&a.label.materialId)){var m=a.labelMaterialId||a.label.materialId;if(this.sceneBuilder.checkMaterialExists(m,false)){this.sceneBuilder.createImageNote(a,this.sceneId);}else{this.requestQueue.materials.push(m);T.pushElementIntoMapArray(this.imageNoteMaterialIdMap,m,a);}}else{this.sceneBuilder.createAnnotation(a,this.sceneId);var b=a.leaderLines;if(b){for(var i=0,l=b.length;i<l;i++){var c=b[i];c.annotationId=a.id;if(this.sceneBuilder.checkMaterialExists(c.materialId,false)){this.sceneBuilder.insertLeaderLine(c,this.sceneId);}else{this.requestQueue.materials.push(c.materialId);T.pushElementIntoMapArray(this.leaderLineMaterialIdMap,c.materialId,c);}}}}this.annotationNodeMap.delete(a.id);this.requestQueue.annotations.pop(a.id);}};
S.prototype.setCamera=function(j){if(!Array.isArray(j.cameras)){return{error:"setCamera error: cameras are not properly defined"};}j.cameras.forEach(this.setCameraSingle.bind(this));};
S.prototype.setMeshSingle=function(m){var a=m.id;if(this.requestQueue.meshes.pop(a)){var b=new THREE.Box3();if(Array.isArray(m.submeshes)){var p=new THREE.Vector3();for(var i=0;i<m.submeshes.length;i++){var s=m.submeshes[i];s.meshId=a;if(!this.sceneBuilder.checkMaterialExists(s.materialId,true)){this.requestQueue.materials.push(s.materialId);}this.sceneBuilder.insertSubmesh(s);var l=s.lods;if(Array.isArray(l)){for(var c=0;c<l.length;c++){var d=l[c].boundingBox;if(Array.isArray(d)&&d.length===6){b.min.min(p.fromArray(d));b.max.max(p.fromArray(d,3));}}}}}var e=new THREE.Vector3();b.getSize(e);var t=0;var f=this.meshNodes.get(a);if(f){this.meshNodes.delete(a);f.forEach(function(h){var j=this.sceneBuilder.getNode(h,this.sceneId);t+=j?j.matrixWorld.getMaxScaleOnAxis():1;}.bind(this));}this.requestQueue.geomMeshes.push(a,(e.x*e.y+e.y*e.z+e.z*e.x)*t,m.geometrySize||0);this.progressCount.mesh.count++;if(!this.requestQueue.meshes.isWaiting()){this.phase=S.Phase.FinishedMesh;this.logPerformance("meshFinished");if(this.retrievalType===S.RetrievalType.Initial){this.onInitialSceneFinishedCallbacks.execute(this.initialView);}else if(this.retrievalType===S.RetrievalType.Partial){this.onPartialRetrievalFinishedCallbacks.execute();}this.onViewPartialRetrievalFinishedCallbacks.execute();this.progressCount.geometry.total=this.requestQueue.geometries.globalList.size;this._fireProgress(S.ProgressPhase.FinishedMeshes);}}else{this.requestQueue.geomMeshes.pop(a.toString());this._fireProgress(S.ProgressPhase.LoadingGeomMeshes);}};
S.prototype.setMesh=function(j,b){if(!Array.isArray(j.meshes)){return{error:"setMesh error: meshes are not properly defined"};}if(b){var d=new DataView(b.buffer);var a=d.getUint16(2,true),o=0;while(a-->0&&o<b.byteLength){var c={sceneId:this.sceneId,id:d.getUint32(o+4,true).toString(),box:[d.getFloat32(o+14,true),d.getFloat32(o+18,true),d.getFloat32(o+22,true),d.getFloat32(o+26,true),d.getFloat32(o+30,true),d.getFloat32(o+34,true)]};var e=d.getUint16(o+12,true);o+=38;if(e!==3){c.flags=d.getUint16(o,true);c.quality=d.getFloat32(o+4,true);c.pointCount=d.getUint16(o+8,true);c.elementCount=d.getUint16(o+10,true);o+=14;}var f=d.getUint32(o,true);var h=b.subarray(o+4,o+4+f);o+=f;this.setGeometry(c,h);}}j.meshes.forEach(this.setMeshSingle.bind(this));T.measure("setMeshMeasure-"+this.sceneId,"setMesh-"+this.sceneId);this._checkSceneCompletion();};
S.prototype.setMaterialSingle=function(m){var a=m.id;this.requestQueue.materials.pop(a);var i;var t=this.sceneBuilder.createMaterial(m);for(i=0;i<t.length;i++){var b=t[i].imageId;this.requestQueue.textures.push(b,{imageId:b,materialId:a});}var l=this.leaderLineMaterialIdMap.get(a);if(l){this.leaderLineMaterialIdMap.delete(a);for(i=0;i<l.length;i++){this.sceneBuilder.insertLeaderLine(l[i],this.sceneId);}}var c=this.imageNoteMaterialIdMap.get(a);if(c){this.imageNoteMaterialIdMap.delete(a);for(i=0;i<c.length;i++){this.sceneBuilder.createImageNote(c[i],this.sceneId);}}this.loader.onMaterialFinishedCallbacks.execute(a);};
S.prototype.setMaterial=function(j){if(!Array.isArray(j.materials)){return{error:"setMaterial error: materials are not properly defined"};}j.materials.forEach(this.setMaterialSingle.bind(this));T.measure("setMaterialMeasure-"+this.sceneId,"setMaterial-"+this.sceneId);this._fireProgress(S.ProgressPhase.FinishedMaterials);this._checkSceneCompletion();};
S.prototype.setGeometry=function(j,b){var a=j.id;this.requestQueue.geometries.pop(a);if(j.data&&!b){b=T.base64ToUint8Array(j.data);}if(!b||b.length===0){return{error:"setGeometry error: no data for geometry "+a};}var c=G.getGeometryInfo(j,b);if(!c){return{error:"setGeometry error: failed to parse geometry "+a+" data"};}this.sceneBuilder.setGeometry(c);this.loader.onSetGeometryCallbacks.execute({id:a});if(!this.requestQueue.geometries.isWaiting()){this.phase=S.Phase.FinishedGeometry;this.logPerformance("geometryFinished");}this.progressCount.geometry.count++;T.measure("setGeometryMeasure-"+a,"setGeometry-"+a);this._checkSceneCompletion();};
S.prototype.setImage=function(j,b){var i=j.id;if(!b){return{error:"setImage error: no image content for "+i};}j.binaryData=b;this.sceneBuilder.createImage(j);if(this.requestQueue.textures.pop(i)){this.loader.onImageFinishedCallbacks.execute({id:i});this._fireProgress(S.ProgressPhase.FinishedTextures);this._checkSceneCompletion();}else if(this.requestQueue.thumbnails.pop(i)){var t=j.tileWidth;if(t){this.sceneBuilder._imageIdsAndTileWidths.set(i,t);}var v=this.thumbnailViewMap.get(i);if(v){this.thumbnailViewMap.delete(i);this.sceneBuilder.setViewThumbnail(i,v,this.sceneId,t);this.loader.onViewGroupUpdatedCallbacks.execute();}}T.measure("setImageMeasure-"+i,"setImage-"+i);};
S.prototype.setAnnotation=function(j){if(!Array.isArray(j.annotations)){return{error:"setAnnotation error: annotations are not properly defined"};}j.annotations.forEach(this.setAnnotationSingle.bind(this));this._checkSceneCompletion();};
S.prototype.setHighlightStyle=function(j){j.id=j.id.toString();this.sceneBuilder.insertHighlightStyle(j);this.requestQueue.highlights.pop(j.id);};
S.prototype.setPlayback=function(a){if(!Array.isArray(a.playbacks)){return{error:"setPlayback error: playbacks are not properly defined"};}var v=this.sceneBuilder.getView(a.viewId,this.sceneId);var o=false;var i,p;if(this.playbackIds){for(i=0;i<a.playbacks.length;i++){p=a.playbacks[i];for(var j=0;j<this.playbackIds.length;j++){if(p.id===this.playbackIds[j]){p.notLoading=false;break;}}if(p.notLoading===undefined){p.notLoading=true;}}delete this.playbackIds;o=true;if(!v.sortPlaybacks(true)){v.resetPlaybacksStartTimes(true);}}if(Array.isArray(a.joints)){this.sceneBuilder.insertJoints(a.joints,this.sceneId);}for(i=0;i<a.playbacks.length;i++){p=a.playbacks[i];if(p.notLoading){continue;}if(p.id==null){p.id=a.viewId+"-playback";p.sequence.id=a.viewId+"-cont";p.sequenceId=p.sequence.id;this.setSequence({sequences:[p.sequence]});}this.sceneBuilder.insertPlayback(p,a.viewId,this.sceneId);if(p.sequenceId){var e=this.sceneBuilder.getSequence(p.sequenceId);if(e){continue;}else{this.requestQueue.sequences.push(p.sequenceId);}}}if(!this.requestQueue.sequences.isEmpty()){this.loader.hasAnimation=true;}else{this.sceneBuilder.finalizeAnimation();this.sceneBuilder.finalizePlaybacks();this.loader.hasAnimation=false;if(o){this.onSetPlaybackCallbacks.execute(v);}}};
S.prototype.setSequenceSingle=function(s,t){var a=s.id;this.requestQueue.sequences.pop(a);function i(l){for(var m in l){if(l.hasOwnProperty(m)){return false;}}return true;}if(s.nodes){var n=[];for(var b=0;b<s.nodes.length;b++){var c=s.nodes[b];if(c.rotate||c.rrotate){var r;if(c.rotate){r=c.rotate;}else{r=c.rrotate;}var d={};if(r.trackId){d.trackId=r.trackId;}else if(t&&r.track!==undefined){d.trackId=t[r.track].id;}if(d.trackId){if(!t){this.requestQueue.tracks.push(d.trackId);}}d.sid=c.sid;d.binding="ROTATE";if(r.pivot){d.pivot=r.pivot;}if(c.rotate){d.isAbsoluteValue=true;}if(i(r)){d.empty=true;}n.push(d);}if(c.translate||c.rtranslate){var e;if(c.translate){e=c.translate;}else{e=c.rtranslate;}var f={};if(e.trackId){f.trackId=e.trackId;}else if(t&&e.track!==undefined){f.trackId=t[e.track].id;}if(f.trackId){if(!t){this.requestQueue.tracks.push(f.trackId);}}f.sid=c.sid;f.binding="TRANSLATE";if(e.pivot){f.pivot=e.pivot;}if(c.translate){f.isAbsoluteValue=true;}if(i(e)){f.empty=true;}n.push(f);}if(c.scale||c.rscale){var h;if(c.scale){h=c.scale;}else{h=c.rscale;}var j={};if(h.trackId){j.trackId=h.trackId;}else if(t&&h.track!==undefined){j.trackId=t[h.track].id;}if(j.trackId){if(!t){this.requestQueue.tracks.push(j.trackId);}}j.sid=c.sid;j.binding="SCALE";if(h.pivot){j.pivot=h.pivot;}if(c.scale){j.isAbsoluteValue=true;}if(i(h)){j.empty=true;}n.push(j);}if(c.opacity!==undefined||c.ropacity!==undefined){var o;if(c.opacity){o=c.opacity;}else{o=c.ropacity;}var k={};if(o.trackId){k.trackId=o.trackId;}else if(t&&o.track!==undefined){k.trackId=t[o.track].id;}if(k.trackId){if(!t){this.requestQueue.tracks.push(k.trackId);}}k.sid=c.sid;k.binding="OPACITY";if(c.opacity){k.isAbsoluteValue=true;}if(i(o)){k.empty=true;}n.push(k);}}s.nodes=n;}this.sceneBuilder.insertSequence(s,this.sceneId);};
S.prototype.setSequence=function(j){if(!Array.isArray(j.sequences)){return{error:"setSequence error: sequences are not properly defined"};}if(Array.isArray(j.joints)){this.sceneBuilder.insertJoints(j.joints,this.sceneId);}for(var i=0;i<j.sequences.length;i++){this.setSequenceSingle(j.sequences[i],j.tracks);}if(j.tracks){this.setTrack(j);}if(this.requestQueue.tracks.isEmpty()){this.loader.hasAnimation=false;this.loader.onSetSequenceCallbacks.execute();if(!this.requestQueue.views.isWaiting()){this.onViewGroupFinishedCallbacks.execute();}}};
S.prototype.setTrack=function(j){if(!Array.isArray(j.tracks)){return{error:"setTrack error: tracks are not properly defined"};}var t=[];for(var a=0;a<j.tracks.length;a++){var b=j.tracks[a];this.requestQueue.tracks.pop(b.id);b.times=b.time;if(b.vector3){b.values=b.vector3;}else if(b.quaternion){b.values=b.quaternion;b.rotateType=A.Quaternion;for(var v=3;v<b.values.length;v=v+4){b.values[v]=-b.values[v];}}else if(b.angleAxis){b.values=b.angleAxis;b.rotateType=A.AngleAxis;}else if(b.euler){b.values=b.euler;b.rotateType=A.Euler;}else if(b.scalar){b.values=b.scalar;}b.cyclicInfo={};b.cyclicInfo.cyclicStart=b.cyclicStart;b.cyclicInfo.cyclicEnd=b.cyclicEnd;t.push(b);}this.sceneBuilder.insertTracks(t);if(!this.requestQueue.tracks.isWaiting()){this.sceneBuilder.finalizeAnimation();this.sceneBuilder.finalizePlaybacks();this.loader.onSetTrackCallbacks.execute();if(!this.requestQueue.views.isWaiting()&&!this.requestQueue.sequences.isWaiting()){this.onViewGroupFinishedCallbacks.execute();}}};
S.prototype.notifyError=function(j){if(!j.error){j.error="Unknown error";}return j;};
return S;});
sap.ui.predefine('sap/ui/vk/totara/TotaraLoader',["sap/base/Log","./SceneContext","./CallbackHandler","./Command","./TotaraUtils","../threejs/SceneBuilder","../helpers/WorkerScriptLoader"],function(L,S,C,a,T,b,W){"use strict";var c=T.mark;var d=function(){this._pushMesh=false;this._url=null;this._cid=null;this._performanceTimingMsg=[];this._isPostable=true;this.currentSceneInfo={};this.sceneBuilder=new b();this.contextMap=new Map();this.tokenContextMap=new Map();this.onErrorCallbacks=new C();this.onImageFinishedCallbacks=new C();this.onMaterialFinishedCallbacks=new C();this.onSetGeometryCallbacks=new C();this.onSetSequenceCallbacks=new C();this.onSetTrackCallbacks=new C();this.onViewGroupUpdatedCallbacks=new C();this.onLoadingFinishedCallbacks=new C();};
d.prototype.init=function(e,f){this._url=e;this._cid=f;var t=this;return new Promise(function(r){if(!t._worker){t._worker=W.loadScript("sap/ui/vk/totara/TotaraLoaderWorker.js");t._worker.onmessage=function(g){var h;var i=g.data;if(i.ready){return;}if(i.name==="getAuthorization"){if(i.sceneId){h=t.getContext(i.sceneId);}if(h&&h.authorizationHandler){h.authorizationHandler(i.jsonContent.url).then(function(j){t.postMessage({"method":"setAuthorization","authorizationToken":j});}).catch(function(j){t.postMessage({"method":"setAuthorization","authorizationToken":null,"error":j.toString()});});}else{t.postMessage({"method":"setAuthorization","authorizationToken":null});}return;}if(i.name==="protocol"){t.protocolVersion=i.jsonContent.version.split(".").map(function(s){return parseInt(s,10);});return;}h=t.processCommand(i.name,i.jsonContent,i.binaryContent);if(h){t.sendRequest(h.requestQueue);}};t._worker.onerror=function(g){};}});};
d.prototype.dispose=function(){this.contextMap.forEach(function(e){e.dispose();});this.contextMap.clear();this.tokenContextMap.clear();this.postMessage({method:"close"});this._worker=undefined;this.currentSceneInfo=null;this.sceneBuilder.cleanup();this.sceneBuilder=null;this.onErrorCallbacks=null;this.onMaterialFinishedCallbacks=null;this.onImageFinishedCallbacks=null;this.onSetGeometryCallbacks=null;this.onSetTrackCallbacks=null;this.onSetSequenceCallbacks=null;};
d.prototype.cleanup=function(){this.currentSceneInfo={};this.contextMap.clear();this.tokenContextMap.clear();this.sceneBuilder.cleanup();};
d.prototype.enablePushMesh=function(e){this._pushMesh=e;};
d.prototype.getUrl=function(){return this._url;};
d.prototype.getSceneBuilder=function(){return this.sceneBuilder;};
d.prototype.getContext=function(s){return this.contextMap.get(s);};
d.prototype.createContext=function(s,p){var e=new S(s,p,this);this.contextMap.set(s,e);this.tokenContextMap.set(e.requestQueue.token,e);if(e.onActiveCamera){e.onActiveCameraCallbacks.attach(e.onActiveCamera);delete e.onActiveCamera;}if(e.onInitialSceneFinished){e.onInitialSceneFinishedCallbacks.attach(e.onInitialSceneFinished);delete e.onInitialSceneFinished;}if(e.onPartialRetrievalFinished){e.onPartialRetrievalFinishedCallbacks.attach(e.onPartialRetrievalFinished);delete e.onPartialRetrievalFinished;}if(e.onViewPartialRetrievalFinished){e.onViewPartialRetrievalFinishedCallbacks.attach(e.onViewPartialRetrievalFinished);delete e.onViewPartialRetrievalFinished;}if(e.onViewFinished){e.onViewFinishedCallbacks.attach(e.onViewFinished);delete e.onViewFinished;}if(e.onSceneCompleted){e.onSceneCompletedCallbacks.attach(e.onSceneCompleted);delete e.onSceneCompleted;}if(e.onProgressChanged){e.setOnProgressChanged(e.onProgressChanged);delete e.onProgressChanged;}if(e.onLoadingFinished){this.onLoadingFinishedCallbacks.detachAll();this.onLoadingFinishedCallbacks.attach(e.onLoadingFinished);delete e.onLoadingFinished;}if(e.onContentChangesProgress){e.onContentChangesProgressCallbacks.attach(e.onContentChangesProgress);delete e.onContentChangesProgress;}return e;};
d.prototype.isLoadingFinished=function(){var e=this.contextMap.values();var f=e.next();while(!f.done){if(!f.value.isLoadingFinished()){return false;}f=e.next();}return true;};
d.prototype.decrementResourceCountersForDeletedTreeNode=function(e,n){if(e){this.sceneBuilder.decrementResourceCountersForDeletedTreeNode(n,e.sceneId);}};
function l(e,n){if(e.progressLogger){e.progressLogger.logPerformance(n,e.token);}}
d.prototype.request=function(s,e,f){if(!e.root){throw"context must include root where three js objects are attached to";}var g=this.createContext(s,e);g.token=g.requestQueue.token;this.currentSceneInfo.id=s;g.retrievalType=S.RetrievalType.Initial;g.authorizationHandler=f;g.initialRequestTime=Date.now();if(g.enableLogger){T.createLogger(s,g,this);}g.includeHidden=e.includeHidden;g.includeAnimation=e.includeAnimation;g.selectField=e.$select;g.pushViewGroups=e.pushViewGroups;g.pushPMI=e.pushPMI;g.metadataFilter=e.metadataFilter;g.activateView=e.activateView;var h=T.createCommand(a.getScene,{sceneId:s});l(g,"modelRequested");c("modelRequested");this.postMessage({method:"initializeConnection",url:this._url,cid:this._cid,useSecureConnection:e.useSecureConnection,token:g.token,command:h,sceneId:s});};
d.prototype.postMessage=function(m){if(this._worker){this._worker.postMessage(m);}};
d.prototype.processSetSceneCommand=function(j){var e=this.getContext(j.veid);if(e){e.defaultViewId=j.defaultViewId;e.defaultViewGroupId=j.defaultViewGroupId;e.sceneThumbnailId=j.imageId;e.dimension=j.dimension;e.defaultRootEntityId=j.defaultRootEntityId;if(e.defaultViewGroupId){e.currentViewGroupId=e.defaultViewGroupId;}var i=e.includeHidden!==undefined?e.includeHidden:true;var f=e.includeAnimation!==undefined?e.includeAnimation:true;var s=e.$select!==undefined?e.$select:"name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";var p=e.pushViewGroups!==undefined?e.pushViewGroups:true;var g="nodes,bounds,animation";if(!f){g="nodes,bounds";}var v={pushMaterials:true,pushMeshes:this._pushMesh,sceneId:e.sceneId,token:e.token,includeHidden:i,pushViewGroups:p,pushPMI:e.pushPMI||false,metadataFilter:e.metadataFilter,$select:s,$expand:g};v.context=e.sceneId;if(e.activateView){v.id=e.activateView;}else if(e.defaultViewId){v.id=e.defaultViewId;}if(v.id){e.initialViewId=v.id;e.currentViewId=v.id;e.initialViewDecided=true;}this.postMessage(T.createRequestCommand(a.getView,v));}};
d.prototype.update=function(s,e,v){this.currentSceneInfo.id=s;var f=this.getContext(s);if(!f){return Promise.reject("no context for ${sceneVeId}");}var t=this;return new Promise(function(r,g){f.nodeSidsForPartialTree=new Set(e);f.retrievalType=S.RetrievalType.Partial;var i=f.includeHidden!==undefined?f.includeHidden:true;var h=f.includeAnimation!==undefined?f.includeAnimation:true;var j=f.$select!==undefined?f.$select:"name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";var o={sceneId:s,token:f.token,pushMaterials:true,pushMeshes:t._pushMesh,filter:e.join(),includeAnimation:h,includeHidden:i,pushPMI:f.pushPMI||false,metadataFilter:f.metadataFilter,$select:j,breadcrumbs:true};if(v){o.activateView=v;}var k=T.createCommand(a.getTree,o);var m=function(){f.onPartialRetrievalFinishedCallbacks.detach(m);l(f,"updateFinished(mesh)");var n=[];var p=[];f.replacedNodes.forEach(function(w,x){p.push(w);n.push(x);});var q=n;var u=p;r({sceneVeId:s,sids:e,replacedNodeRefs:q,replacementNodeRefs:u});};f.onPartialRetrievalFinishedCallbacks.attach(m);l(f,"updateRequested");t.postMessage({method:"update",command:k});});};
d.prototype.requestViewGroup=function(s,v,i){if(!v){return Promise.reject("invalid arg: viewGroupId undefined");}var e=this.getContext(s);if(!e){return Promise.reject("no context for ${sceneVeId}");}if(i!==undefined){e.includeAnimation=i;}var t=this;var p=new Promise(function(r,f){var g=t.sceneBuilder.getViewGroup(v,s);if(g&&g.length){r(g);return;}var o={sceneId:s,id:v,token:e.token};var h=function(){e.onViewGroupFinishedCallbacks.detach(h);l(e,"onViewGroupFinished");var j=t.sceneBuilder.getViewGroup(v,s);if(j&&j.length){r(j);}else{f("no view ground data");}};e.onViewGroupFinishedCallbacks.attach(h);e.currentViewGroupId=v;t.postMessage(T.createRequestCommand(a.getViewGroups,o));});return p;};
d.prototype.requestView=function(s,v,e,p,i){this.currentSceneInfo.id=s;if(v!=="static"&&v!=="dynamic"){return Promise.reject("invalid arg: supported type - static, dynamic");}if(!e){return Promise.reject("invalid arg: viewId undefined");}var f=this.getContext(s);if(!f){return Promise.reject("no context for ${sceneVeId}");}f.currentViewId=e;var g=f.includeHidden!==undefined?f.includeHidden:false;var h;if(i){h=i;}else{h=f.includeAnimation!==undefined?f.includeAnimation:true;}var j=f.$select!==undefined?f.$select:"name,transform,meshId,annotationId,materialId,contentType,visible,opacity,renderOrder,entityId,highlightStyleId";var k="nodes,bounds,animation";if(!h){k="nodes,bounds";}this.hasAnimation=false;var t=this;var m=new Promise(function(r,n){var o,q;if(v==="static"){o=a.getView;q={sceneId:s,id:e,token:f.token,includeHidden:g,$select:j,$expand:k};if(p&&p.length){q.$expand="playback";f.playbackIds=p;}}else{o=a.getDynamicView;q={sceneId:s,type:e,token:f.token};}f.onSetPlaybackCallbacks.detachAll();var u=function(z){f.onSetPlaybackCallbacks.detach(u);l(f,"onSetPlayback");if(z){r(z);}else{n("no view data");}};f.onSetPlaybackCallbacks.attach(u);f.onViewFinishedCallbacks.detachAll();var w=function(z){f.onViewFinishedCallbacks.detach(w);l(f,"onViewFinished");if(!t.hasAnimation){if(z){r(z);}else{n("no view data");}}else{f.currentView=z;}};f.onViewFinishedCallbacks.attach(w);t.onSetSequenceCallbacks.detachAll();var x=function(){t.onSetSequenceCallbacks.detach(x);l(f,"onSetSequence");if(f.currentView){r(f.currentView);}};t.onSetSequenceCallbacks.attach(x);t.onSetTrackCallbacks.detachAll();var y=function(z){t.onSetTrackCallbacks.detach(y);l(f,"onSetTrack");if(f.currentView){r(f.currentView);}};t.onSetTrackCallbacks.attach(y);l(f,"viewRequested");t.postMessage(T.createRequestCommand(o,q));});return m;};
d.prototype.requestMaterial=function(s,e){if(!e){return Promise.reject("invalid arg: materialId undefined");}var f=this.getContext(s);if(!f){return Promise.reject("no context for ${sceneVeId}");}var t=this;var p=new Promise(function(r,g){var h=f.sceneBuilder.getMaterial(e);if(h){r(h);return;}f.requestQueue.materials.push(e);var i=function(k){var m=t.sceneBuilder.getMaterial(e);if(m&&!m.userData.imageIdsToLoad){t.onImageFinishedCallbacks.detach(i);r(m);}};var j=function(n){if(e!=n){return;}t.onMaterialFinishedCallbacks.detach(j);var m=t.sceneBuilder.getMaterial(e);if(!m){t.onImageFinishedCallbacks.detach(i);g("no material data");}if(m.userData.imageIdsToLoad){return;}t.onImageFinishedCallbacks.detach(i);r(m);};t.onMaterialFinishedCallbacks.attach(j);t.onImageFinishedCallbacks.attach(i);t.sendRequest(f.requestQueue);});return p;};
d.prototype.sendRequest=function(r){if(!this._worker){return false;}var s=false;while(!r.isEmpty()){var n=r.generateRequestCommand();this.postMessage(n);s=true;}return s;};
d.prototype.timestamp=function(j){};
d.prototype.performanceTiming=function(j){};
d.prototype.checkError=function(j){if(!j){return true;}var r=j.result==="failure";if(r){if(j.message){j.error=j.message;delete j.message;}else{j.error="Unknown error";}}return r;};
d.prototype.reportError=function(e,f){this.onErrorCallbacks.execute({error:f,context:e});};
d.prototype.processContextCommand=function(e,n,j,f){if(!e){var g=n+" error: unknown context - "+JSON.stringify(j);this.contextMap.forEach(function(e){e[n].call(e,j,f);});return{error:g};}return e[n].call(e,j,f);};
d.prototype.processCommand=function(n,j,e){if(this.checkError(j)){if(n===a.setTree){if(j.events&&j.events.length){var f=j.events[0];if(f.values&&f.values.id){this.contextMap.delete(f.values.id);}}}this.onErrorCallbacks.execute(j);return null;}var g=null;if(j.sceneId!==undefined){g=this.getContext(j.sceneId);}else if(j.token!==undefined){g=this.tokenContextMap.get(j.token);}if(g){this.currentSceneInfo.id=g.sceneId;}this.setPerformance(n,j,g?g.sceneId:null);var r;switch(n){case a.setScene:this.processSetSceneCommand(j);break;case a.setTree:case a.setTreeNode:case a.notifyFinishedTree:case a.setView:case a.setViewNode:case a.setViewGroup:case a.notifyFinishedView:case a.setCamera:case a.setMesh:case a.setMaterial:case a.setGeometry:case a.setImage:case a.setAnnotation:case a.setPlayback:case a.setHighlightStyle:case a.setSequence:case a.setTrack:r=this.processContextCommand(g,n,j,e);break;case a.notifyError:r={error:j.errorText};break;case a.timestamp:r=this.timestamp(j);break;case a.performanceTiming:r=this.performanceTiming(j);break;default:r={error:"Unknown command: "+n};break;}if(n!==a.setScene&&n!==a.setView&&n!==a.setViewNode&&n!==a.timestamp&&n!==a.performanceTiming&&this.isLoadingFinished()){this.onLoadingFinishedCallbacks.execute();L.info("Loading is finished - all streaming requests are fulfilled.");}if(r&&r.error){L.error(r.error);this.onErrorCallbacks.execute(r);}return g;};
d.prototype.setPerformance=function(n,j,s){var i;switch(n){case a.setGeometry:i=j.id;c("setGeometry-"+i);break;case a.setImage:i=j.id;c("setImage-"+i);break;case a.setView:i=j.viewId;c("setView-"+i);break;case a.setViewGroup:i=j.id;c("setViewGroup-"+i);break;case a.setMesh:c("setMesh-"+s);break;case a.setMaterial:c("setMaterial-"+s);break;case a.setTree:c("setTree-"+s);break;case a.performanceTiming:this._isPostable=true;this.postPerformanceTiming();break;default:break;}};
d.prototype.postPerformanceTiming=function(m){if(m){this._performanceTimingMsg.push(m);}if(this._isPostable&&this._performanceTimingMsg.length>0){this.postMessage(this._performanceTimingMsg.shift());this._isPostable=false;}};
d.prototype.printLogTokens=function(){this.contextMap.forEach(function(e,s){L.info("log tokens for scene => "+s);L.info("---------------------------------------");if(e.progressLogger){e.progressLogger.getTokens().forEach(function(t){L.info(t);});}L.info("---------------------------------------");});};
return d;});
sap.ui.predefine('sap/ui/vk/totara/TotaraUtils',["./Command"],function(C){"use strict";var T=function(){};
T.createCommand=function(c,o){var r=JSON.stringify(o);return c+("["+r.length+"]")+r;};
T.createRequestCommand=function(c,o){return{command:T.createCommand(c,o),method:c};};
function P(i,c,t){if(!i||!c||!t){throw"ProgressLogger: invalid args";}this.context=c;this.loader=t;var d=new Set();this.logPerformance=function(n,a){if(!n||!a){return;}d.add(a);var o={name:n,timestamp:Date.now(),token:a};var m={method:C.addClientLog,url:this.loader.getUrl(),authorizationHandler:c.authorizationHandler,token:c.token,command:T.createCommand(C.addClientLog,o)};this.loader.postMessage(m);};this.getTokens=function(){return d;};this.logPerformanceTiming=function(m,p){var e=this;m.sort(function(a,b){return a.timestamp-b.timestamp;});if(!m.length){return;}d.add(c.token);var f=[];while(m.length){f.push(m.splice(0,10));}f.forEach(function(a){var o={records:[],timestamp:Date.now()};a.forEach(function(h){o.records.push({name:h.name,timestamp:h.timestamp,uuid:h.uuid,duration:h.duration,value:h.value,parent_uuid:p});});var b=T.createCommand(C.performanceTiming,o);e.loader.postPerformanceTiming({method:C.performanceTiming,url:e.loader.getUrl(),authorizationHandler:c.authorizationHandler,token:c.token,command:b});});};}
T.mark=function(t){window.performance.mark(t);};
T.measure=function(n,s,e){var p=window.performance;if(performance.getEntriesByName(s).length!==0){if(!e){p.measure(n,s);}else{p.measure(n,s,e);}}p.clearMarks(s);if(e){p.clearMarks(e);}p.clearMeasures(n);};
T.perfObserve=function(c){if(!window.PerformanceObserver){return;}var _=[];var s;var a=performance.timing.navigationStart;var p=new window.PerformanceObserver(function(l){l.getEntries().forEach(function(e){e.uuid=T.generateToken();e.timestamp=a+e.startTime;if(e.name==="sceneMeasure"){s=e.uuid;}_.push(e);});if(_.find(function(b){return b.name==="sceneCompleted";})){T.measure("sceneMeasure","modelRequested","sceneCompleted");}if(s){_=_.filter(function(b){return b instanceof PerformanceMeasure;});c.progressLogger.logPerformanceTiming(_,s);s="";}});p.observe({entryTypes:["mark","measure"]});};
T.createLogger=function(i,c,a){if(!c){return null;}c.progressLogger=new P(i,c,a);T.perfObserve(c);return c.progressLogger;};
T.base64ToUint8Array=function(b){var a=atob(b);var l=a.length;var c=new Uint8Array(l);for(var i=0;i<l;i++){c[i]=a.charCodeAt(i);}return c;};
T.arrayToColumnMajorMatrixArray16=function(a){if(a.length===16){return[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]];}if(a.length===12){return[a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0.0,0.0,0.0,1.0];}if(a.length===3){return[1,0,0,a[0],0,1,0,a[1],0,0,1,a[2],0,0,0,1];}return null;};
T.pushElementIntoMapArray=function(m,k,e){var a=m.get(k);if(!a){a=[];m.set(k,a);}else if(a.length>0&&a[a.length-1]===e){return;}a.push(e);};
T.generateToken=function(){return g();};
function g(){function s(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s();}
return T;});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/ContainerBase',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Popup","sap/ui/core/ResizeHandler","sap/ui/core/delegate/ScrollEnablement","sap/ui/Device","sap/m/library","./ContainerBaseRenderer","./MapContainerButtonType","./getResourceBundle"],function(q,v,C,I,P,R,S,D,m,a,M,g){"use strict";
var b=C.extend("sap.ui.vk.ContainerBase",{metadata:{library:"sap.ui.vk",properties:{"showFullScreen":{type:"boolean",group:"Misc",defaultValue:true},"showSettings":{type:"boolean",group:"Misc",defaultValue:true},"showSelection":{type:"boolean",group:"Misc",defaultValue:true},"fullScreen":{type:"boolean",group:"Misc",defaultValue:false},"title":{type:"string",group:"Misc",defaultValue:""},"autoAdjustHeight":{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.vk.ContainerContent",multiple:true,singularName:"content"},"toolbar":{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}},associations:{},events:{"contentChange":{parameters:{selectedItemId:"string"}},"settingsPressed":{}}}});
b.prototype.switchContent=function(c){this.setSelectedContent(c);this.rerender();};
b.prototype.updateContainer=function(){this._contentChanged=true;this.rerender();};
b.prototype.setSelectedContent=function(c){this._oSelectedContent=c;};
b.prototype.getSelectedContent=function(){return this._oSelectedContent;};
b.prototype.init=function(){this._selectionState="SINGLE";this._firstTime=true;this._aContentIcons=[];this._selectedContent=null;this._oSelectedContent=null;this._bSegmentedButtonSaveSelectState=false;this._oMenu=null;this._customButtons=[];var l=new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High});var c=sap.m.ButtonType.Transparent;this._oFullScreenButton=new sap.m.OverflowToolbarButton({layoutData:l,type:c,icon:"sap-icon://full-screen",text:g().getText("CONTAINERBASE_FULLSCREEN"),tooltip:g().getText("CONTAINERBASE_FULLSCREEN"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._toggleFullScreen();}.bind(this)});this._oSettingsButton=new sap.m.OverflowToolbarButton({layoutData:l.clone(),type:c,icon:"sap-icon://action-settings",text:g().getText("CONTAINERBASE_SETTINGS"),tooltip:g().getText("CONTAINERBASE_SETTINGS"),press:function(){this._bSegmentedButtonSaveSelectState=true;this.fireSettingsPressed();}.bind(this)});this._oSelectionButtonSingle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-single",tooltip:g().getText("CONTAINERBASE_MENU_SINGLE"),press:this._handleSelection.bind(this,"SINGLE")});this._oSelectionButtonRectangle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-rectangle",tooltip:g().getText("CONTAINERBASE_MENU_RECT"),press:this._handleSelection.bind(this,"RECT")});this._oSelectionButtonLasso=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-lasso",tooltip:g().getText("CONTAINERBASE_MENU_LASSO"),press:this._handleSelection.bind(this,"LASSO")});this._selectionMenu=new sap.m.SegmentedButton({items:[this._oSelectionButtonSingle,this._oSelectionButtonRectangle,this._oSelectionButtonLasso]});this._oPopup=new P({modal:true,shadow:false,autoClose:false});this._oContentSegmentedButton=new sap.m.SegmentedButton({layoutData:l.clone(),select:this._onContentButtonSelect.bind(this)});this._oContTitle=new sap.m.Label();this._oToolbar=new sap.m.OverflowToolbar({width:"auto"}).addStyleClass("sapUiVkContainerBaseToolbar");this.setAggregation("toolbar",this._oToolbar);this.sResizeListenerId=null;if(D.system.desktop){this.sResizeListenerId=R.register(this,q.proxy(this._performHeightChanges,this));}else{D.orientation.attachHandler(this._performHeightChanges,this);D.resize.attachHandler(this._performHeightChanges,this);}var d=[{name:"selection-lasso",unicode:"E000"},{name:"selection-rectangle",unicode:"E001"},{name:"selection-single",unicode:"E002"}],e="map-container",f="map-container";d.forEach(function(i){I.addIcon(i.name,e,f,i.unicode);});};
b.prototype.exit=function(){if(this._oFullScreenButton){this._oFullScreenButton.destroy();this._oFullScreenButton=undefined;}if(this._oPopup){this._oPopup.destroy();this._oPopup=undefined;}if(this._oContentSegmentedButton){this._oContentSegmentedButton.destroy();this._oContentSegmentedButton=undefined;}if(this._oSelectedContent){this._oSelectedContent.destroy();this._oSelectedContent=undefined;}if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=undefined;}if(D.system.desktop&&this.sResizeListenerId){R.deregister(this.sResizeListenerId);this.sResizeListenerId=null;}else{D.orientation.detachHandler(this._performHeightChanges,this);D.resize.detachHandler(this._performHeightChanges,this);}};
b.prototype.setFullScreen=function(f){if(this._firstTime){return;}if(this.getFullScreen()==f){return;}var c=this.getProperty("fullScreen");if(c!==f){this._toggleFullScreen();}};
b.prototype.onAfterRendering=function(){var t=this;if((this.sResizeListenerId===null)&&(D.system.desktop)){this.sResizeListenerId=R.register(this,q.proxy(this._performHeightChanges,this));}if(this.getAutoAdjustHeight()||this.getFullScreen()){q.sap.delayedCall(500,this,function(){t._performHeightChanges();});}this._firstTime=false;if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){if(this._selectionState==="LASSO"){c.setLassoSelection(true);}else if(this._selectionState==="RECT"){c.setRectangularSelection(true);}else if(this._selectionState==="SINGLE"){c.setRectangularSelection(false);c.setLassoSelection(false);}}}}};
b.prototype.onBeforeRendering=function(){var t=this;if(t._contentChanged){t._contentChange();}t._oToolbar.getContent().forEach(function(e){var c=e.getId();var d=e["getPressed"]?e.getPressed():null;for(var i in t._customButtons){if(t._customButtons[i].button&&t._customButtons[i].button.getId()==c){t._customButtons[i].toggled=d;}}});t._oToolbar.removeAllContent();t._addToolbarContent();};
b.prototype.setTitle=function(V){this._oContTitle.setText(V);this.setProperty("title",V,true);};
b.prototype.addContent=function(o){this.addAggregation("content",o);this._contentChanged=true;};
b.prototype.insertContent=function(o,i){this.insertAggregation("content",o,i);this._contentChanged=true;};
b.prototype.updateContent=function(){this.updateAggregation("content");this._contentChanged=true;};
b.prototype._toggleFullScreen=function(){var f=this.getProperty("fullScreen");var s;var h;var c;if(f){this._closeFullScreen();this.setProperty("fullScreen",false,true);c=this.getSelectedContent().getContent();s=c.getId();c.setWidth("100%");h=this._contentHeight[s];if(h){c.setHeight(h);}this.invalidate();}else{var o=this.getAggregation("content");this._contentHeight={};if(o){for(var i=0;i<o.length;i++){c=o[i].getContent();s=c.getId();if(q.isFunction(c.getHeight)){h=c.getHeight();}else{h=0;}this._contentHeight[s]=h;}}this._openFullScreen(true);this.setProperty("fullScreen",true,true);}var d=(f?"sap-icon://full-screen":"sap-icon://exit-full-screen");this._oFullScreenButton.setIcon(d);this._oFullScreenButton.focus();};
b.prototype._openFullScreen=function(n){if((n!==null)&&(n===true)){this._oScrollEnablement=new S(this,this.getId()+"-wrapper",{horizontal:true,vertical:true});}this.$content=this.$();if(this.$content){this.$tempNode=q("<div></div>");this.$content.before(this.$tempNode);this._$overlay=q("<div id='"+q.sap.uid()+"'></div>");this._$overlay.addClass("sapUiVkContainerBaseOverlay");this._$overlay.append(this.$content);this._oPopup.setContent(this._$overlay);}else{q.sap.log.warn("Overlay: content does not exist or contains more than one child");}this._oPopup.open(200,undefined,undefined,q("body"));};
b.prototype._closeFullScreen=function(){if(this._oScrollEnablement!==null){this._oScrollEnablement.destroy();this._oScrollEnablement=null;}this.$tempNode.replaceWith(this.$content);this._oToolbar.setDesign(sap.m.ToolbarDesign.Auto);this._oPopup.close();this._$overlay.remove();};
b.prototype._performHeightChanges=function(){if(this.getAutoAdjustHeight()||this.getFullScreen()){var $=this.$();if(($.find(".sapUiVkContainerBaseToolbarArea").children()[0])&&($.find(".sapUiVkContainerBaseContentArea").children()[0])){var o=this.getSelectedContent().getContent();if(o.getDomRef().offsetWidth!==this.getDomRef().clientWidth){this.rerender();}}}};
b.prototype._switchContent=function(c){var o=this._findContentById(c);this.setSelectedContent(o);this.fireContentChange({selectedItemId:c});this.rerender();};
b.prototype._contentChange=function(){var c=this.getContent();this._oContentSegmentedButton.removeAllButtons();this._destroyButtons(this._aContentIcons);this._aContentIcons=[];if(c.length===0){this._oContentSegmentedButton.removeAllButtons();this._setDefaultOnSegmentedButton();this.switchContent(null);}if(c){for(var i=0;i<c.length;i++){var d=c[i].getContent();if(d.setWidth){d.setWidth("100%");}var B=new sap.m.SegmentedButtonItem({icon:c[i].getIcon(),tooltip:c[i].getTitle(),key:d.getId()});this._aContentIcons.push(B);this._oContentSegmentedButton.addItem(B);if(i===0){this.setSelectedContent(c[i]);}}}this._contentChanged=false;};
b.prototype._onContentButtonSelect=function(e){var c=e.getParameter("key");this._switchContent(c);};
b.prototype._findContentById=function(s){var c=null;var o=this.getAggregation("content");if(o){for(var i=0;!c&&i<o.length;i++){if(o[i].getContent().getId()===s){c=o[i];}}}return c;};
b.prototype._addToolbarContent=function(){this._oToolbar.addContent(new sap.m.ToolbarSpacer());if(this._aContentIcons.length>1){this._oToolbar.addContent(this._oContentSegmentedButton);}if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){this._oToolbar.addContent(this._selectionMenu);}}}this._customButtons.forEach(function(i){if(i.visible){var s={type:sap.m.ButtonType.Transparent,layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High})};if("active"in i){s.enabled=i.active;}if("icon"in i){s.icon=i.icon;}if("activeIcon"in i){s.activeIcon=i.activeIcon;}if("text"in i){s.text=i.text;}if("tooltip"in i){s.tooltip=i.tooltip;}if("press"in i){s.press=i.press;}if("toggled"in i){s.pressed=i.toggled;}if("overflow"in i){s.overflow=i.overflow;}switch(i.type){case M.Click:i.button=s.overflow?new sap.m.OverflowToolbarButton(s):new sap.m.Button(s);break;default:i.button=s.overflow?new sap.m.OverflowToolbarToggleButton(s):new sap.m.ToggleButton(s);break;}this._oToolbar.addContent(i.button);}},this);if(this.getShowSettings()){this._oToolbar.addContent(this._oSettingsButton);}if(!D.system.phone&&this.getShowFullScreen()){this._oToolbar.addContent(this._oFullScreenButton);}};
b.prototype._setDefaultOnSegmentedButton=function(){if(!this._bSegmentedButtonSaveSelectState){this._oContentSegmentedButton.setSelectedButton(null);}this._bSegmentedButtonSaveSelectState=false;};
b.prototype._destroyButtons=function(c){c.forEach(function(B){B.destroy();});};
b.prototype._handleSelection=function(c){var d=this.getSelectedContent().getContent();if(d instanceof sap.ui.vbm.GeoMap||d instanceof sap.ui.vbm.AnalyticMap){if(c==="LASSO"){d.setLassoSelection(true);this._selectionState=c;}else if(c==="RECT"){d.setRectangularSelection(true);this._selectionState=c;}else if(c==="SINGLE"){d.setRectangularSelection(false);d.setLassoSelection(false);this._selectionState=c;}}};
return b;});
sap.ui.predefine('sap/ui/vk/ContainerBaseRenderer',function(){"use strict";var C={};
C.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkContainerBase");r.writeClasses(c);r.write(">");r.write("<div");r.writeAttributeEscaped("id",c.getId()+"-wrapper");r.addClass("sapUiVkContainerBaseWrapper");r.writeClasses();r.write(">");this.writeContentArea(r,c);this.writeToolbarArea(r,c);r.write("</div>");r.write("</div>");};
C.writeContentArea=function(r,c){var s=c.getSelectedContent();r.write("<div");r.addClass("sapUiVkContainerBaseContentArea");r.writeClasses();r.write(">");if(s!==null){r.renderControl(s);}else if(c.getContent().length>0){s=c.getContent()[0];r.renderControl(s);}r.write("</div>");};
C.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkContainerBaseToolbarArea");r.writeClasses();r.write(">");r.renderControl(c._oToolbar);r.write("</div>");};
return C;},true);
sap.ui.predefine('sap/ui/vk/ContainerContent',["./library","sap/ui/core/Control","./ContainerContentRenderer"],function(v,C,a){"use strict";
var b=C.extend("sap.ui.vk.ContainerContent",{metadata:{library:"sap.ui.vk",properties:{"icon":{type:"string",group:"Misc",defaultValue:null},"title":{type:"string",group:"Misc",defaultValue:null}},aggregations:{"content":{type:"sap.ui.core.Control",multiple:false}}}});
b.prototype.setContent=function(c){if(c instanceof sap.ui.vbm.GeoMap){c.setNavcontrolVisible(false);c.setWidth("100%");c.setHeight("100%");}this.setAggregation("content",c);return this;};
return b;});
sap.ui.predefine('sap/ui/vk/ContainerContentRenderer',function(){"use strict";var C={};
C.render=function(r,c){r.renderControl(c.getContent());};
return C;},true);
sap.ui.predefine('sap/ui/vk/LegendItem',["sap/m/StandardListItem","./LegendItemRenderer"],function(S,L){"use strict";
var a=S.extend("sap.ui.vk.LegendItem",{metadata:{library:"sap.ui.vk",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},semanticSpotType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null}},aggregations:{}}});
return a;});
sap.ui.predefine('sap/ui/vk/LegendItemRenderer',["sap/m/StandardListItemRenderer","sap/ui/core/Renderer"],function(B,R){"use strict";var L=R.extend(B);
L.renderLIContent=function(r,c){var s=c.getColor();var t=c.getSemanticSpotType();var i=null;if(s){r.write("<span");r.addClass("sapUiVkLegendItemSquare");r.addStyle("background-color",s);r.writeStyles();r.writeClasses();r.write(">");r.write("</span>");}if(t){switch(t){case sap.ui.vbm.SemanticType.Error:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Red.png");break;case sap.ui.vbm.SemanticType.Warning:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Orange.png");break;case sap.ui.vbm.SemanticType.Success:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Green.png");break;case sap.ui.vbm.SemanticType.Default:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Blue.png");break;case sap.ui.vbm.SemanticType.Inactive:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Grey.png");break;default:break;}if(i){c.addStyleClass("sapUiVkLegendItemSpotType");c.setIcon(i);}}B.renderLIContent(r,c);};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanel',["./library","sap/ui/core/Control","sap/m/library","./ListPanelRenderer"],function(v,C,m,L){"use strict";
var a=C.extend("sap.ui.vk.ListPanel",{metadata:{library:"sap.ui.vk",properties:{"headerText":{type:"string",group:"Misc"},"headerIcon":{type:"sap.ui.core.URI",group:"Misc"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"selectionMode":{type:"sap.m.ListMode",group:"Misc",defaultValue:sap.m.ListMode.MultiSelect}},aggregations:{"items":{type:"sap.m.ListItemBase",multiple:true,singularName:"item"},"panel":{type:"sap.m.Panel",multiple:false,visibility:"hidden"}},events:{headerIconPress:{},expand:{},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}}}}});
a.prototype.getSelectedItem=function(){return this._oList.getSelectedItem();};
a.prototype.setSelectedItem=function(l,s,f){this._oList.setSelectedItem(l,s,f);};
a.prototype.getSelectedItems=function(){return this._oList.getSelectedItems();};
a.prototype.init=function(){this._oList=new sap.m.ListBase({mode:this.getSelectionMode(),itemPress:this.fireItemPress.bind(this),selectionChange:this.fireSelectionChange.bind(this)});this._oPanel=new sap.m.Panel({expandable:true,expanded:true,expandAnimation:true,headerToolbar:new sap.m.Toolbar({active:false}),content:[this._oList],expand:this.fireExpand.bind(this)});this._oPanel.getHeaderToolbar().addStyleClass("sapUiVkLPTb");this.setAggregation("panel",this._oPanel,true);this._oHeaderIcon=null;this._oHeaderText=null;this._bHeaderToolbarChanged=true;};
a.prototype.exit=function(){this._destroyControl(this._oList);this._destroyControl(this._oPanel);this._destroyControl(this._oHeaderIcon);this._destroyControl(this._oHeaderText);};
a.prototype.getItems=function(){return this._oList.getItems();};
a.prototype.addItem=function(o){return this._oList.addItem(o);};
a.prototype.insertItem=function(o,i){return this._oList.insertItem(o,i);};
a.prototype.removeItem=function(o){return this._oList.removeItem(o);};
a.prototype.removeAllItems=function(){return this._oList.removeAllItems();};
a.prototype.setHeaderText=function(b){if(!this._oHeaderText){this._oHeaderText=new sap.m.Title();}this._oHeaderText.setText(b);this._bHeaderToolbarChanged=true;if(this._oHeaderIcon){this._oHeaderIcon.setTooltip(b);this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText);}return this.setProperty("headerText",b);};
a.prototype.getExpanded=function(){return this._oPanel.getExpanded();};
a.prototype.setExpanded=function(b){return this._oPanel.setExpanded(b);};
a.prototype.getExpandAnimation=function(){return this._oPanel.getExpandAnimation();};
a.prototype.setExpandAnimation=function(b){return this._oPanel.setExpandAnimation(b);};
a.prototype.setHeaderIcon=function(b){if(!this._oHeaderIcon){this._oHeaderIcon=new sap.m.Button({press:this.fireHeaderIconPress.bind(this),type:sap.m.ButtonType.Transparent,tooltip:this.getHeaderText()});}this._oHeaderIcon.setIcon(b);this._bHeaderToolbarChanged=true;if(this._oHeaderText){this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText);}return this.setProperty("headerIcon",b);};
a.prototype.setSelectionMode=function(b){this._oList.setMode(b);return this.setProperty("selectionMode",b);};
a.prototype.onBeforeRendering=function(){if(this._bHeaderToolbarChanged){var t=this._oPanel.getHeaderToolbar();t.removeAllContent();if(this._oHeaderIcon){t.addContent(this._oHeaderIcon);}if(this._oHeaderText){t.addContent(this._oHeaderText);}this._bHeaderToolbarChanged=false;}};
a.prototype._destroyControl=function(c){if(c){c.destroy();c=undefined;}};
return a;});
sap.ui.predefine('sap/ui/vk/ListPanelRenderer',function(){"use strict";var L={};
L.render=function(r,c){var p=c._oPanel;p.addStyleClass("sapUiVkListPanel");r.write("<div");r.writeControlData(c);r.write(">");r.renderControl(p);r.write("</div>");};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanelStack',["./library","sap/ui/core/Control","sap/ui/layout/library","./ListPanelStackRenderer"],function(v,C,l,L){"use strict";
var a=C.extend("sap.ui.vk.ListPanelStack",{metadata:{library:"sap.ui.vk",properties:{"width":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"collapsible":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"content":{type:"sap.ui.vk.ListPanel",multiple:true,singularName:"content"},"layout":{type:"sap.ui.layout.VerticalLayout",multiple:false,visibility:"hidden"}}}});
a.prototype.init=function(){this._oLayout=new sap.ui.layout.VerticalLayout();this._oLayout.addStyleClass("sapUiVkLPSTrans");this.setAggregation("layout",this._oLayout,true);this._bFirstTime=true;};
a.prototype.exit=function(){if(this._oLayout){this._oLayout.destroy();this._oLayout=undefined;}};
a.prototype.getContent=function(){return this._oLayout.getContent();};
a.prototype.addContent=function(o){o.attachExpand(this._onContentExpand.bind(this));o.attachHeaderIconPress(this._onContentHeaderIconPress.bind(this));return this._oLayout.addContent(o);};
a.prototype.removeContent=function(o){return this._oLayout.removeContent(o);};
a.prototype.insertContent=function(o,i){return this._oLayout.insertContent(o,i);};
a.prototype.removeAllContent=function(){return this._oLayout.removeAllContent();};
a.prototype.getWidth=function(){return this._oLayout.getWidth();};
a.prototype.setWidth=function(b){this.setProperty("width",b,true);return this._oLayout.setWidth(b);};
a.prototype.setExpanded=function(b){if(b!=this.getExpanded()){if(b){this._expand();}else{this._collapse();}}return this;};
a.prototype.setExpandAnimation=function(b){this._oLayout.removeStyleClass("sapUiVkLPSTrans");if(b){this._oLayout.addStyleClass("sapUiVkLPSTrans");}return this.setProperty("expandAnimation",b,true);};
a.prototype.onBeforeRendering=function(){if(this._bFirstTime){var e=false;var c=this.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){e=true;}}this.setExpanded(e);this._bFirstTime=false;}};
a.prototype.onAfterRendering=function(){if(!this.getExpanded()){this._updateCollapsedLayoutWidth();}};
a.prototype._onContentExpand=function(e){var b=false;var c=this._oLayout.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){b=true;}}this.setExpanded(b);};
a.prototype._onContentHeaderIconPress=function(e){var b=e.oSource.getExpanded()?false:true;e.oSource.setExpanded(b);var E=false;var c=this._oLayout.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){E=true;break;}}this.setExpanded(E);};
a.prototype._expand=function(){this._oLayout.removeStyleClass("sapUiVkLPSCollapse");this._oLayout.setWidth(this.getProperty("width"));this.setProperty("expanded",true,true);};
a.prototype._collapse=function(){if(!this.getCollapsible()){return;}var c=this.getContent();for(var i=0;i<c.length;++i){c[i].setExpanded(false);}this._oLayout.addStyleClass("sapUiVkLPSCollapse");this._updateCollapsedLayoutWidth();this.setProperty("expanded",false,true);};
a.prototype._updateCollapsedLayoutWidth=function(){if(this._oLayout.$().closest(".sapUiSizeCompact").length===0){this._oLayout.setWidth("3rem");}else{this._oLayout.setWidth("2.5rem");}};
return a;});
sap.ui.predefine('sap/ui/vk/ListPanelStackRenderer',function(){"use strict";var L={};
L.render=function(r,c){c._oLayout.addStyleClass("sapUiVkListPanelStack");r.renderControl(c._oLayout);};
return L;},true);
sap.ui.predefine('sap/ui/vk/MapContainer',["jquery.sap.global","./ContainerBase","sap/ui/core/IconPool","sap/ui/vbm/lib/sapvbi","sap/ui/Device","./MapContainerRenderer","./MapContainerButtonType","./getResourceBundle"],function(q,C,I,s,D,M,a,g){"use strict";
var b=C.extend("sap.ui.vk.MapContainer",{metadata:{library:"sap.ui.vk",properties:{"showNavbar":{type:"boolean",group:"Misc",defaultValue:true},"showHome":{type:"boolean",group:"Misc",defaultValue:true},"showMapLayer":{type:"boolean",group:"Misc",defaultValue:true},"showRectangularZoom":{type:"boolean",group:"Misc",defaultValue:true},"showZoom":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"listPanelStack":{type:"sap.ui.vk.ListPanelStack",multiple:false},"scrollCont":{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"}},associations:{},events:{}}});
b.prototype.init=function(){this._currentText=new sap.m.Text({}).addStyleClass("mapLayerSelectedText");C.prototype.init.apply(this,arguments);var m=new sap.ui.model.json.JSONModel();m.setData({rectZoom:false});this.setModel(m,"rectZoom");this._oNavbar=new sap.m.Toolbar({width:"auto"});this._oScrollCont=new sap.m.ScrollContainer({horizontal:false,vertical:true,focusable:false});this.setAggregation("scrollCont",this._oScrollCont,true);this._oHomeButton=new sap.m.Button({icon:"sap-icon://home",type:sap.m.ButtonType.Transparent,tooltip:g().getText("MAPCONTAINER_HOME"),press:this._onNavbarHome.bind(this)});this._oRectZoomButton=new sap.m.ToggleButton({icon:"sap-icon://draw-rectangle",type:sap.m.ButtonType.Transparent,pressed:"{rectZoom>/rectZoom}",tooltip:g().getText("MAPCONTAINER_RECT_ZOOM")}).setModel(m,"rectZoom");this._oZoomInButton=new sap.m.Button({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,tooltip:g().getText("MAPCONTAINER_ZOOMIN"),press:this._onNavbarZoomIn.bind(this)});this._oZoomOutButton=new sap.m.Button({icon:"sap-icon://less",type:sap.m.ButtonType.Transparent,tooltip:g().getText("MAPCONTAINER_ZOOMOUT"),press:this._onNavbarZoomOut.bind(this)});if(D.system.phone){this._oMenuOpenButton=new sap.m.Button({layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),icon:"sap-icon://menu2",type:sap.m.ButtonType.Transparent,tooltip:g().getText("CONTAINERBASE_MENU"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._showListPanelStack();}.bind(this)});this._oMenuCloseButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",press:function(){this._bSegmentedButtonSaveSelectState=true;this._hideListPanelStack();}.bind(this)});}};
b.prototype.exit=function(){if(this._oNavbar){this._oNavbar.destroy();this._oNavbar=undefined;}if(this._oScrollCont){this._oScrollCont.destroy();this._oScrollCont=undefined;}C.prototype.exit.apply(this,arguments);};
b.prototype.getListPanelStack=function(){return this._oScrollCont.getContent()[0];};
b.prototype.setListPanelStack=function(p){if(D.system.phone){p.setCollapsible(false);p.setWidth("100%");}this._oScrollCont.removeAllContent();return this._oScrollCont.addContent(p);};
b.prototype.onBeforeRendering=function(){C.prototype.onBeforeRendering.apply(this,arguments);this._oNavbar.removeAllContent();var c=this.getSelectedContent();if(c!==null){var d=c.getContent();this._isInstanceGeoAnalytic=d instanceof sap.ui.vbm.GeoMap||d instanceof sap.ui.vbm.AnalyticMap;if(this._isInstanceGeoAnalytic){if(this.getShowHome()){this._oNavbar.addContent(this._oHomeButton);}if(!D.system.phone&&this.getShowRectangularZoom()){this._oNavbar.addContent(this._oRectZoomButton);}if(this.getShowZoom()){this._oNavbar.addContent(this._oZoomInButton);this._oNavbar.addContent(this._oZoomOutButton);}this._shouldRenderListPanel=true;}else{this._shouldRenderListPanel=false;}this._isSupportingMapLayerSwitch=d instanceof sap.ui.vbm.GeoMap&&!(d instanceof sap.ui.vbm.AnalyticMap);if(this._isSupportingMapLayerSwitch&&d.getMapConfiguration()!==null&&this.getShowMapLayer()){var e=d.getMapConfiguration();var l=[].concat(e.MapLayerStacks);if(l.length>1){this._box=new sap.m.HBox({}).addStyleClass("mapContainerHboxPopover");this._popover=new sap.m.Popover({enableScrolling:false,placement:sap.m.PlacementType.Horizontal,content:this._box,showHeader:false});this._selectionMap=new sap.m.Image({width:"4.7rem",press:function(f){if(this._popover.isOpen()){this._popover.close();}else{this._popover.openBy(this._selectionMap);}}.bind(this)}).addStyleClass("mapLayerPopoverItem");}this._shouldRenderMapLayerSwitch=true;}else{this._shouldRenderMapLayerSwitch=false;}}};
b.prototype.onAfterRendering=function(){if(D.system.phone){var l=document.getElementById(this.getId()+"-LPW");this.getDomRef().appendChild(l);}C.prototype.onAfterRendering.apply(this,arguments);if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(this._isSupportingMapLayerSwitch===true&&c.getMapConfiguration()){var d=c.getMapConfiguration();var e=[].concat(d.MapLayerStacks);if(e.length>1){e.forEach(function(v,i){var f=new sap.ui.layout.VerticalLayout({});var h=c.mVBIContext.GetMainScene();var j=c.mVBIContext.m_MapLayerStackManager.GetMapLayerStack(v.name);var o=new sap.m.Image({width:"4.5rem",press:function(m){this._popover.close();o.setAlt(v.name);var p=m.getSource();var t=p.getAlt();c.setRefMapLayerStack(t);this._currentText.setText(v.name);h.GetPreviewImage(j,function(r){q(".mapLayerPopoverItem").attr("src",r.src);});this._currentMapLayerStackIndex=i;}.bind(this)});var k=new sap.m.Text({text:v.name}).addStyleClass("mapLayerPopoverItemText");o.addStyleClass("layerType");h.GetPreviewImage(j,function(m){o.setSrc(m.src);});h.GetPreviewImage(h.m_MapLayerStack,function(m){q(".mapLayerPopoverItem").attr("src",m.src);});var n=e[this._currentMapLayerStackIndex||0].name;this._currentText.setText(n);this._box.addItem(f);f.addContent(o);f.addContent(k);},this);}}}};
b.prototype.setToolbarItem=function(c){if(!c||!c.id){return null;}var o;for(var i=0;i<this._customButtons.length;++i){if(c.id===this._customButtons[i].id){o=this._customButtons[i];o.index=i;this._customButtons.splice(i,1);break;}}if(!o){o={id:c.id,visible:true,active:true,index:this._customButtons.length,type:a.Click};}if("index"in c){o.index=c.index;}if("visible"in c){o.visible=c.visible;}if("overflow"in c){o.overflow=c.overflow;}if("active"in c){o.active=c.active;}if("text"in c){o.text=c.text;}if("tooltip"in c){o.tooltip=c.tooltip;}if("icon"in c){o.icon=c.icon;}if("activeIcon"in c){o.activeIcon=c.activeIcon;}if("press"in c){o.press=c.press;}if("toggled"in c){o.toggled=c.toggled;if(o.button){o.button.setPressed(c.toggled);}}if("type"in c){o.type=c.type;}if(o.index>this._customButtons.length){o.index=this._customButtons.length;}else if(o.index<0){o.index=0;}this._customButtons.splice(o.index,0,o);this.invalidate();return o;};
b.prototype.setSelectedContent=function(c){var o;if(this._oSelectedContent){if((o=this._oSelectedContent.getContent())instanceof sap.ui.vbm.GeoMap){o.unbindProperty("rectZoom","rectZoom>/rectZoom");}}C.prototype.setSelectedContent.apply(this,arguments);var n=this._oSelectedContent.getContent();if(n instanceof sap.ui.vbm.GeoMap){n.bindProperty("rectZoom","rectZoom>/rectZoom");}};
b.prototype._addToolbarContent=function(){if(D.system.phone){this._oToolbar.addContent(this._oMenuOpenButton);}C.prototype._addToolbarContent.apply(this,arguments);};
b.prototype._onNavbarZoomIn=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()+1);}};
b.prototype._onNavbarZoomOut=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()-1);}};
b.prototype._onNavbarHome=function(e){var c=this.getSelectedContent().getContent();if(c.goToStartPosition){c.goToStartPosition();}};
b.prototype._showListPanelStack=function(){q("#"+this.getId()+"-LPW").addClass("sapUiVkMapContainerLPWIn");q("#"+this.getId()+"-wrapper").addClass("sapUiVkMapContainerMapOut");};
b.prototype._hideListPanelStack=function(){q("#"+this.getId()+"-LPW").removeClass("sapUiVkMapContainerLPWIn");q("#"+this.getId()+"-wrapper").removeClass("sapUiVkMapContainerMapOut");};
return b;});
sap.ui.predefine('sap/ui/vk/MapContainerRenderer',["./ContainerBaseRenderer","sap/ui/core/Renderer","sap/ui/Device"],function(B,R,D){"use strict";var M=R.extend(B);
M.render=function(r,c){c.addStyleClass("sapUiVkMapContainer");B.render.apply(this,arguments);};
M.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkMapContainerOverlay");r.writeClasses();r.write(">");if(c.getShowNavbar()){r.write("<div");r.addClass("sapUiVkMapContainerNavbarArea");r.writeClasses();r.write(">");if(c.getShowMapLayer()&&c._shouldRenderMapLayerSwitch){r.renderControl(c._currentText);r.renderControl(c._selectionMap);}r.write("<div");r.addClass("sapUiVkMapContainerNavbarContainer");r.writeClasses();r.write(">");r.renderControl(c._oNavbar);r.write("</div>");r.write("</div>");}if(!D.system.phone&&c._shouldRenderListPanel){c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);}B.writeToolbarArea(r,c);r.write("</div>");if(D.system.phone){r.write("<div id="+c.getId()+"-LPW");r.addClass("sapUiVkMapContainerLPW");r.writeClasses();r.write(">");r.renderControl(c._oMenuCloseButton);c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);r.write("</div>");}};
return M;},true);
sap.ui.predefine('sap/ui/vk/NativeViewport',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","./Messages","./ContentConnector","./NativeViewportRenderer","./getResourceBundle"],function(q,v,C,R,L,V,M,a,N,g){"use strict";
var b=C.extend("sap.ui.vk.NativeViewport",{metadata:{library:"sap.ui.vk",properties:{limitZoomOut:{type:"boolean",group:"Behavior",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"move":{parameters:{pan:"object",zoom:"float"}}}}});
b.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}this._canvas=null;this._canvas=document.createElement("div");this._canvas.style.textAlign="left";this._canvas.id=q.sap.uid();this._resizeListenerId=null;this._viewportHandler=new V(this);this._loco=new L(this);this._loco.addHandler(this._viewportHandler,-1);this._reset();this._svgid=this.getId()+"-svg";};
b.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.call(this);}};
b.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
b.prototype.onAfterRendering=function(){if(this._canvas){var d=this.getDomRef();d.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:d.clientWidth,height:d.clientHeight}});}};
b.prototype._handleResize=function(e){this.fireResize({oldSize:e.oldSize,size:e.size});if(!e.oldSize||!e.oldSize.width||!e.oldSize.height||this._svgError){this._bestFit();}else{this._update();}};
b.prototype._reset=function(){this._img=null;this._svg=null;this._svgError=null;this._imageW=0;this._imageH=0;this._s4BestFit=1;this._s=1;this._x=0;this._y=0;this._gx=0;this._gy=0;this._canvas.style.visibility="hidden";while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}};
b.prototype._update=function(){var i=this._svgError||this._img||this._svg;if(i){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";i.style.transform=t;i.style.webkitTransform=t;i.style.msTransform=t;i.style.MozTransform=t;i.style.OTransform=t;}};
b.prototype._bestFit=function(){if(this._svgError){this._imageW=550;this._imageH=512;}else if(this._svg){this._imageW=this._svg.clientWidth;this._imageH=this._svg.clientHeight;}else if(this._img){this._imageW=this._img.width;this._imageH=this._img.height;}else{return;}if(!this._imageW||!this._imageH||!this._canvas.clientWidth||!this._canvas.clientHeight){return;}var s=Math.min(this._canvas.clientWidth/this._imageW,this._canvas.clientHeight/this._imageH);this._s4BestFit=s;this._s=s;this._x=0;this._y=0;this._update();this._canvas.style.visibility="visible";};
b.prototype.loadUrl=function(u,o,c,d,e){if(/^(svg)$/.test(e.toLowerCase())){this._reset();this._svg=document.createElement("object");this._svg.setAttribute("type","image/svg+xml");this._svg.setAttribute("data",u);this._svg.setAttribute("id",this._svgid);this._svg.setAttribute("class","SVGImage");this._canvas.appendChild(this._svg);var s=document.createElement("div");s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";this._canvas.appendChild(s);this._svg.onload=function(){this._svg.onload=null;setTimeout(function(){this._bestFit();if(o){o();}}.bind(this),0);}.bind(this);this._svg.onerror=function(){q.sap.log.error(g().getText(M.VIT1.summary),M.VIT1.code,"sap.ui.vk.NativeViewport");this._reset();if(c){c();}}.bind(this);this._svg.src=u;return this;}else if(/^(jpg|jpeg|png|gif|bmp|tif|tiff)$/.test(e.toLowerCase())){this._reset();this._img=new Image();this._img.draggable=false;this._img.onload=function(){setTimeout(function(){this._bestFit();this._canvas.appendChild(this._img);if(o){o();}}.bind(this),0);}.bind(this);this._img.onerror=function(){q.sap.log.error(g().getText(M.VIT2.summary),M.VIT2.code,"sap.ui.vk.NativeViewport");if(c){c();}};this._img.src=u;return this;}else{q.sap.log.error(g().getText(M.VIT3.summary),M.VIT3.code,"sap.ui.vk.NativeViewport");if(c){c();}}};
b.prototype.loadFailed=function(t){this._reset();this._svgError=document.createElement("div");this._svgError.className="svgErrorContainer";var s="http://www.w3.org/2000/svg";this._svgErrorElement=document.createElementNS(s,"svg");this._svgErrorElement.setAttribute("width","550px");this._svgErrorElement.setAttribute("height","512px");this._svgErrorElement.setAttribute("viewBox","-244 -244 512 512");this._svgErrorElement.setAttribute("enable-background","new -244 -244 512 512");this._svgErrorElement.setAttribute("id","SVGError");var c=document.createElementNS(s,"rect");c.setAttribute("fill","#FFFFFF");c.setAttribute("x","-244");c.setAttribute("y","-244");c.setAttribute("width","512");c.setAttribute("height","512");c.setAttribute("opacity","0.1");this._svgErrorElement.appendChild(c);var d=document.createElementNS(s,"path");d.setAttribute("fill","#474747");d.setAttribute("d","M12.833,89.742c-70.781,0-128.366-57.584-128.366-128.366c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C141.198,32.158,83.614,89.742,12.833,89.742z M12.833-146.989 c-59.753,0-108.366,48.612-108.366,108.365c0,59.752,48.613,108.366,108.366,108.366S121.198,21.129 121.198-38.624 C121.198-98.376,72.586-146.989,12.833-146.989z");d.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(d);var e=document.createElementNS(s,"rect");e.setAttribute("fill","#474747");e.setAttribute("x","-2.167");e.setAttribute("y","-120.847");e.setAttribute("width","30");e.setAttribute("height","119.447");e.setAttribute("fill","#474747");e.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(e);var f=document.createElementNS(s,"rect");f.setAttribute("fill","#474747");f.setAttribute("x","-2.167");f.setAttribute("y","13.6");f.setAttribute("width","30");f.setAttribute("height","30");f.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(f);var h=document.createElementNS(s,"path");h.setAttribute("fill","#474747");h.setAttribute("d","M10.833,87.33c-70.781,0-128.366-57.584-128.366-128.365c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C139.198,29.746,81.614,87.33,10.833,87.33z M10.833-149.4 c-59.753,0-108.366,48.612-108.366,108.365S-48.92,67.33,10.833,67.33S119.198,18.718,119.198-41.035S70.586-149.4,10.833-149.4z");this._svgErrorElement.appendChild(h);var i=document.createElementNS(s,"rect");i.setAttribute("fill","#474747");i.setAttribute("x","-4.167");i.setAttribute("y","-123.259");i.setAttribute("width","30");i.setAttribute("height","119.447");i.setAttribute("fill","#474747");this._svgErrorElement.appendChild(i);var j=document.createElementNS(s,"rect");j.setAttribute("fill","#474747");j.setAttribute("x","-4.167");j.setAttribute("y","11.188");j.setAttribute("width","30");j.setAttribute("height","30");j.setAttribute("fill","#474747");this._svgErrorElement.appendChild(j);var k=document.createElementNS(s,"text");k.setAttribute("id","textError");k.setAttribute("left","auto");k.setAttribute("right","auto");k.setAttribute("y","150");k.setAttribute("x","10");k.setAttribute("display","block");k.setAttribute("text-anchor","middle");k.setAttribute("fill","#474747");k.setAttribute("style","font-family:Arial");k.setAttribute("font-size","32");k.textContent=t?t:g().getText("VIEWPORT_MESSAGEUNSUPPORTEDFILEFORMAT");this._svgErrorElement.appendChild(k);this._svgError.appendChild(this._svgErrorElement);this._bestFit();this._canvas.appendChild(this._svgError);return this;};
b.prototype.beginGesture=function(x,y){this._gx=(x-this._canvas.clientWidth/2-this._x)/this._s;this._gy=(y-this._canvas.clientHeight/2-this._y)/this._s;return this;};
b.prototype.endGesture=function(){this._gx=0;this._gy=0;return this;};
b.prototype.pan=function(d,c){if(this._svgError){return this;}this._x+=d;this._y+=c;this._update();this.fireMove({pan:{x:d,y:c},zoom:1.0});return this;};
b.prototype.rotate=function(d,c){if(this._svgError){return this;}this._x+=d;this._y+=c;this._update();this.fireMove({pan:{x:d,y:c},zoom:1.0});return this;};
b.prototype._getZoomInLimit=function(){return 500;};
b.prototype._getZoomOutLimit=function(){return(this.getLimitZoomOut())?this._s4BestFit*0.25:0.0001;};
b.prototype._getZoomFactor=function(){return this._s;};
b.prototype.zoom=function(z){if(this._svgError){return this;}var c=this._gx*this._s;var d=this._gy*this._s;var o=this._s;this._s=Math.min(Math.max(this._s*z,this._getZoomOutLimit()),this._getZoomInLimit());z=this._s/o;var e=this._gx*this._s;var f=this._gy*this._s;var h=c-e;var i=d-f;this._x+=h;this._y+=i;this._update();this.fireMove({pan:{x:h,y:i},zoom:z});return this;};
b.prototype.tap=function(x,y,i){if(i){this._bestFit();}return this;};
b.prototype.queueCommand=function(c){c();return this;};
b.prototype.getViewInfo=function(){var c={};c.camera=[this._s,0,0,this._s,this._x,this._y];return c;};
b.prototype.setViewInfo=function(c){if(this._svgError){return this;}var d=c.camera;this._s=d[0];this._x=d[4];this._y=d[5];this._update();return this;};
b.prototype.getOutputSize=function(){var c=this.getViewInfo().camera,d=this.getDomRef().getBoundingClientRect();return{left:d.width/2+c[4],top:d.height/2+c[5],sideLength:this._canvas.children[0].getBoundingClientRect().width};};
b.prototype._onAfterUpdateContentConnector=function(){this._setImage(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setImage(null);};
b.prototype._handleContentReplaced=function(e){this._setImage(e.getParameter("newContent"));};
b.prototype._setImage=function(i){this._reset();if(i instanceof HTMLObjectElement){this._svg=i;i.setAttribute("id",this._svgid);i.onload=function(){i.onload=null;setTimeout(function(){this._bestFit();}.bind(this),0);}.bind(this);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){setTimeout(function(){this._bestFit();}.bind(this),0);}this._canvas.appendChild(i);var s=document.createElement("div");s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";this._canvas.appendChild(s);}else if(i instanceof HTMLImageElement){this._img=i;i.draggable=false;setTimeout(function(){this._bestFit();this._canvas.appendChild(i);}.bind(this),0);}};
var r=2;var p=2;[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(i){b.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.pan(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();};});[{key:"left",dx:-r,dy:0},{key:"right",dx:+r,dy:0},{key:"up",dx:0,dy:-r},{key:"down",dx:0,dy:+r}].forEach(function(i){b.prototype["onsap"+i.key+"modifiers"]=function(e){if(e.shiftKey&&!(e.ctrlKey||e.altKey||e.metaKey)){this.beginGesture(this.$().width()/2,this.$().height()/2);this.rotate(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){b.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();e.preventDefault();e.stopPropagation();};});a.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/Notifications',["sap/base/Log","./library","sap/ui/core/Control","./Messages","sap/m/ToggleButton","./NotificationsRenderer","./getResourceBundle"],function(L,v,C,M,T,N,g){"use strict";
var a=C.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});
a.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var m;var b=new T({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:g().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(b.getPressed()){m.openBy(b);}else{m.close();}}});b.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",b);m=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:g().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:g().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){m.getParent().clearAllMessages();}}),afterClose:b.setPressed.bind(b,false)});m.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",m);L.addLogListener(this);};
a.prototype.exit=function(){L.removeLogListener(this);if(C.prototype.exit){C.prototype.exit.call(this);}};
a.prototype.onLogEntry=function(e){if(e.component.startsWith("sap.ui.vk")&&(e.level===L.Level.WARNING||e.level===L.Level.ERROR||e.level===L.Level.FATAL)){var m=e.details,c,r,b;if(M[e.details]){m=g().getText(M[e.details].summary);c=g().getText(M[e.details].cause);r=g().getText(M[e.details].resolution);b=g().getText("ERROR_DESCRIPTION_CODE");}var d=g().getText("ERROR_DESCRIPTION_COMPONENT");var f=g().getText("ERROR_DESCRIPTION_DATE");var t=g().getText("ERROR_DESCRIPTION_TIME");var l=g().getText("ERROR_DESCRIPTION_LEVEL");var h=g().getText("ERROR_DESCRIPTION_MESSAGE");var i=g().getText("ERROR_DESCRIPTION_CAUSE");var j=g().getText("ERROR_DESCRIPTION_RESOLUTION");var k="<div><b>"+d+":</b><br>"+e.component+"</div><br>"+"<div><b>"+f+":</b><br>"+e.date+"</div><br>"+(b?"<div><b>"+b+":</b><br>"+e.details+"</div><br>":"")+"<div><b>"+t+":</b><br>"+e.time.slice(0,e.time.indexOf("."))+"</div><br>"+"<div><b>"+l+":</b><br>"+e.level+"</div><br>"+"<div><b>"+h+":</b><br>"+m+"</div><br>"+(c?"<div><b>"+i+":</b><br>"+c+"</div><br>":"")+(r?"<div><b>"+j+":</b><br>"+r+"</div>":"");var n=new sap.m.MessagePopoverItem({markupDescription:true,title:e.message,description:k});var o=this.getAggregation("_messagePopover");o.addItem(n);this.getAggregation("_messagePopoverToggleButton").setText(o.getItems().length);this.fireMessageAdded();}};
a.prototype.clearAllMessages=function(){var m=this.getAggregation("_messagePopover");m.removeAllItems();m.close();this.getAggregation("_messagePopoverToggleButton").setText(m.getItems().length);this.fireAllMessagesCleared();return this;};
return a;});
sap.ui.predefine('sap/ui/vk/Overlay',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/vbm/library","sap/ui/vbm/lib/sapvbi","./Messages","./OverlayRenderer","./getResourceBundle","./OverlayArea"],function(q,v,C,a,b,M,O,g,c){"use strict";
var d=C.extend("sap.ui.vk.Overlay",{metadata:{library:"sap.ui.vk",properties:{zoomOnResize:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{areas:{type:"sap.ui.vk.OverlayArea",multiple:true,singularName:"area"}},associations:{target:{type:"sap.ui.core.Control",cardinality:"0..1"}},events:{click:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},contextMenu:{parameters:{pos:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});
d.prototype.getPositionInteractive=function(p,e){if(!this.mIACreateCB&&e&&typeof(e)==="function"){this.mIACreateCB=e;var t="POS";if(p){t+="ARRAY";}var l={"SAPVB":{"Automation":{"Call":{"handler":"OBJECTCREATIONHANDLER","name":"CreateObject","object":"MainScene","scene":"MainScene","instance":"","Param":{"name":"data","#":"{"+t+"}"}}}}};this._load(l);return true;}else{return false;}};
d.prototype.openContextMenu=function(m){this._openContextMenu("Overlay",this,m);};
d.prototype.setPanAndZoom=function(n,e,z){if(n===0&&e===0&&z===1){return;}var s=this.mVBIContext.GetMainScene();this.totalCenterOffset.dx+=n;this.totalCenterOffset.dy+=e;if(z===1){s.MoveMap(n,e);}else{var f=s.m_Canvas[0];var h=f.m_nExactLOD+Math.log(z)*Math.LOG2E;s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),h);s.MoveMap(this.totalCenterOffset.dx,this.totalCenterOffset.dy);}};
d.prototype.reset=function(){this.totalCenterOffset.dx=this.totalCenterOffset.dy=0;var s=this.mVBIContext.GetMainScene();if(s){s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),this.initialZoom);}return this;};
d.prototype.init=function(){this.aLoadQueue=null;this.oTargetDomRef=null;this.mVBIContext=new VBI.VBIContext(this);this.resizeID="";this.resizeIDTarget="";this.bVosDirty=true;this.bWindowsDirty=true;this.bSceneDirty=true;this.bDataDeltaUpdate=false;this.bHandleDataChangeActive=false;this.bForceDataUpdate=false;this.mAddMenuItems=[];this.totalCenterOffset={dx:0,dy:0};this.initialZoom=10;};
d.prototype.exit=function(){if(this.mVBIContext){this.mVBIContext.clear();}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID="";}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}};
d.prototype.resize=function(e){var f=(this.oControl!=undefined)?this.oControl:this;var h=f.mVBIContext;if(h){var s=h.GetMainScene();if(s){if(f.getZoomOnResize()&&e&&e.oldSize.width>0){var z=Math.log(e.size.width/e.oldSize.width)*Math.LOG2E;s.ZoomToGeoPosition(s.GetCenterPos(),s.GetCurrentZoomlevel()+z,false,true,true);}s.resizeCanvas(e,true,true);}}};
d.prototype.setTarget=function(t){if(!t){return;}this.setAssociation("target",t);this.reset();if(t instanceof sap.m.Image){t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this.oTargetDomRef.addEventListener("load",q.proxy(this._adaptSizeOfTarget,this));}.bind(this)});}else{t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this._adaptSizeOfTarget();}.bind(this)});}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}this.resizeIDTarget=sap.ui.core.ResizeHandler.register(t,this._adaptSizeOfTarget.bind(this));};
d.prototype._adaptSizeOfTarget=function(){var t=this.oTargetDomRef;var f=this.getDomRef();if(t){try{var T=q(t);var p={top:T.offset().top,left:T.offset().left,width:T.outerWidth(),height:T.outerHeight()};q(f).width(p.width).height(p.height).css("position","absolute");q(f).css("top","0px").css("left","0px").css("visibility","");}catch(e){q.sap.log.error(e);}}else{q(f).css("position","fixed").width("0px").height("0px").css("top","0px").css("left","0px").css("visibility","hidden");}};
d.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent);}this._adaptSizeOfTarget();if(this.aLoadQueue){var n;for(n=0;n<this.aLoadQueue.length;++n){this._load(this.aLoadQueue[n]);}this.aLoadQueue=null;}if(this.resizeID==""){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize);}var o=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(o);}};
d.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId());};
d.prototype.invalidate=function(s){this.bSceneDirty=true;if(s instanceof c){this.bVosDirty=true;this.bDataDeltaUpdate=this.bHandleDataChangeActive;}sap.ui.core.Control.prototype.invalidate.apply(this,arguments);};
d.prototype._load=function(e){if(!this.isRendered()){if(!this.aLoadQueue){this.aLoadQueue=[];}this.aLoadQueue.push(e);return;}this._loadHtml(e);};
d.prototype._loadHtml=function(e){var o=this.getId();var f=null;if(typeof e=="string"){f=JSON.parse(e.indexOf("{")?e.substr(e.indexOf("{")):e);}else if(typeof e=="object"){f=e;}if(!f){return;}if(!f["SAPVB"]){var m;if(this.mVBIContext&&(m=(new VBI.Adaptor(this.mVBIContext)).CreateLoadData(f))){this.loadHtml(m);return;}else{return;}}var h=false;var i=false;var j=false;if(q.type(f)=="object"){if(f.SAPVB){if(f.SAPVB.Config){this.mVBIContext.GetConfig().load(f.SAPVB.Config,this.mVBIContext);}if(f.SAPVB.Resources){this.mVBIContext.GetResources().load(f.SAPVB.Resources,this.mVBIContext);}if(f.SAPVB.DataTypes){if(!this.mVBIContext["m_DataTypeProvider"]){this.mVBIContext["m_DataTypeProvider"]=new VBI.DataTypeProvider();}this.mVBIContext["m_DataTypeProvider"].load(f.SAPVB.DataTypes,this.mVBIContext);}if(f.SAPVB.Data){if(!this.mVBIContext["m_DataProvider"]){this.mVBIContext["m_DataProvider"]=new VBI.DataProvider();}this.mVBIContext["m_DataProvider"].load(f.SAPVB.Data,this.mVBIContext);h=true;}if(f.SAPVB.Windows){if(!this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"]=new VBI.Windows();}this.mVBIContext["m_Windows"].load(f.SAPVB.Windows,this.mVBIContext);j=true;}if(f.SAPVB.Actions){if(!this.mVBIContext["m_Actions"]){this.mVBIContext["m_Actions"]=new VBI.Actions();}this.mVBIContext["m_Actions"].load(f.SAPVB.Actions,this.mVBIContext);}if(f.SAPVB.Automation){if(!this.mVBIContext["m_Automations"]){this.mVBIContext["m_Automations"]=new VBI.Automations();}this.mVBIContext["m_Automations"].load(f.SAPVB.Automation,this.mVBIContext);}if(f.SAPVB.Menus){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new VBI.Menus();}this.mVBIContext["m_Menus"].load(f.SAPVB.Menus,this.mVBIContext);}if(f.SAPVB.Scenes){if(!this.mVBIContext["m_SceneManager"]){this.mVBIContext["m_SceneManager"]=new VBI.SceneManager();}this.mVBIContext["m_SceneManager"].load(f.SAPVB.Scenes,this.mVBIContext);i=true;}}if(h){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].NotifyDataChange();}}if(i||j){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].Awake(o);}}if(i||h){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].RenderAsync();}}}};
d.prototype._openContextMenu=function(t,i,m){if(m&&m.vbi_data&&m.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new window.VBI.Menus();}for(var n=0;n<this.mAddMenuItems.length;++n){m.addItem(this.mAddMenuItems[n]);}this.mVBIContext.m_Menus.m_menus.push(m);this._loadHtml({"SAPVB":{"version":"2.0","Automation":{"Call":{"earliest":"0","handler":"CONTEXTMENUHANDLER","instance":i.sId,"name":"SHOW","object":t,"refID":"CTM","Param":[{"name":"x","#":i.mClickPos[0]},{"name":"y","#":i.mClickPos[1]},{"name":"scene","#":"MainScene"}]}}}});}this.mAddMenuItems=[];};
d.prototype._update=function(){var A={SAPVB:{}};if(this.bSceneDirty){this._updateScene(A);}this._updateWindows(A);if(A.SAPVB.Actions){Array.prototype.push.apply(A.SAPVB.Actions.Set.Action,this._getActionArray());}return this._minimizeApp(A);};
d.prototype._minimizeApp=function(A){var t,s;var e;s=null;if(!this.bWindowsDirty){e=(t=A)&&(t=t.SAPVB)&&(t=t.Windows)&&(s=JSON.stringify(t))&&(s==this.mCurWindows)&&(delete A.SAPVB.Windows);if(!e){this.mCurWindows=s?s:this.mCurWindows;}}else{this.bWindowsDirty=false;}s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.Scenes)&&(s=JSON.stringify(t))&&(s==this.mCurScenes)&&(delete A.SAPVB.Scenes);if(!e){this.mCurScenes=s?s:this.mCurScenes;}s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.Actions)&&(s=JSON.stringify(t))&&(s==this.mCurActions)&&(delete A.SAPVB.Actions);if(!e){this.mCurActions=s?s:this.mCurActions;}s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(s=JSON.stringify(t))&&(s==this.mCurDataTypes)&&(delete A.SAPVB.DataTypes);if(!e){this.mCurDataTypes=s?s:this.mCurDataTypes;}if(!this.bForceDataUpdate){s=null;e=(t=A)&&(t=t.SAPVB)&&(t=t.Data)&&(s=JSON.stringify(t))&&(s==this.mCurData)&&(delete A.SAPVB.Data);if(!e){this.mCurData=s?s:this.mCurData;}}else{this.bForceDataUpdate=false;}return A;};
d.prototype._updateWindows=function(A){A.SAPVB.Windows={"Set":[{"name":"Main","Window":{"id":"Main","caption":"MainWindow","type":"geo","refParent":"","refScene":"MainScene","modal":"true"}}]};};
d.prototype._updateScene=function(A){var s=[];var e=[];var f=[];var h=[];this._updateVOData(s,e,f,h);var _=JSON.stringify(s);var m=true;if(!this.saVO){((((A.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",scaleVisible:"false",navControlVisible:"false",VisualFrame:{minLOD:5},NavigationDisablement:{move:"true",zoom:"true"},initialZoom:this.initialZoom.toString(),initialStartPosition:"0.5;0.5;0"}).VO=s);}else if(this.bRefMapLayerStackDirty||!(this.saVO===_)){(A.SAPVB.Scenes=this._getSceneVOdelta(JSON.parse(this.m_saVO),s));}else{m=false;}this.saVO=_;if(this.bDataDeltaUpdate){A.SAPVB.Data=[];for(var n=0;n<e.length;++n){A.SAPVB.Data.push({Set:{name:e[n].name,type:"N",N:e[n]}});}}else{((A.SAPVB.Data={}).Set={}).N=e;}if(m){(((A.SAPVB.DataTypes={}).Set={}).N=f);}(((A.SAPVB.Actions={}).Set={}).Action=h);this.bSceneDirty=this.bVosDirty=this.bDataDeltaUpdate=false;};
d.prototype._isEventRegistered=function(A,e){var f=this.getAggregation(A);if(!f){return false;}for(var n=0;n<f.length;++n){var i=f[n];if(i.hasListeners(e)){return true;}}return false;};
d.prototype._getTemplateBindingInfo=function(A){var B=this.getBindingInfo(A);if(B&&B.template){return B.template.mBindingInfos;}};
d.prototype._getBindInfo=function(A){var B={};var t=this._getTemplateBindingInfo(A);B.C=(t)?t.hasOwnProperty("color"):true;B.CB=(t)?t.hasOwnProperty("colorBorder"):true;B.DCH=(t)?t.hasOwnProperty("deltaColorHot"):true;B.CS=(t)?t.hasOwnProperty("colorSelect"):true;B.CNS=(t)?t.hasOwnProperty("colorNonSelect"):true;B.TT=(t)?t.hasOwnProperty("tooltip"):true;B.M=(t)?t.hasOwnProperty("changeable"):true;B.hasTemplate=(t)?true:false;return B;};
d.prototype._updateVOData=function(s,e,f,h){var B,V;this.AreaBindInfo=B=(this.AreaBindInfo)?this.AreaBindInfo:this._getBindInfo("areas");V=(B.hasTemplate)?this.getBindingInfo("areas").template:null;var o={id:"OverlayArea",datasource:"OverlayArea",type:"{00100000-2012-0004-B001-F311DE491C77}"};o["posarray.bind"]=o.id+".P";if(B.C){o["color.bind"]=o.id+".C";}else{o.color=V.getColor();}if(B.CB){o["colorBorder.bind"]=o.id+".C";}else{o.colorBorder=V.getColorBorder();}if(B.DCH){o["hotDeltaColor.bind"]=o.id+".DCH";}else{o.hotDeltaColor=V.getDeltaColorHot();}if(B.CS){o["colorSelect.bind"]=o.id+".C";}else{o.colorSelect=V.getColorSelect();}if(B.CNS){o["colorNonSelect.bind"]=o.id+".C";}else{o.colorNonSelect=V.getColorNonSelect();}if(!B.M){o["VB:c"]=V.getChangeable();}s.push(o);var i={name:o.id,key:"K"};i.A=[{"name":"K","alias":"K","type":"string"},{"name":"VB:s","alias":"VB:s","type":"boolean"},{"name":"P","alias":"P","type":"vectorarray","changeable":"true"}];if(B.C){i.A.push({"name":"C","alias":"C","type":"color"});}if(B.CB){i.A.push({"name":"CB","alias":"CB","type":"string"});}if(B.DCH){i.A.push({"name":"DCH","alias":"DCH","type":"string"});}if(B.CS){i.A.push({"name":"CS","alias":"CS","type":"string"});}if(B.CNS){i.A.push({"name":"CNS","alias":"CNS","type":"string"});}if(B.TT){i.A.push({"name":"TT","alias":"TT","type":"string"});}f.push(i);var j=o.id;if(this._isEventRegistered("areas","click")){h.push({"id":j+"1","name":"click","refScene":"MainScene","refVO":j,"refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this._isEventRegistered("areas","contextMenu")){h.push({"id":j+"2","name":"contextMenu","refScene":"MainScene","refVO":j,"refEvent":"ContextMenu"});}if(this._isEventRegistered("areas","edgeClick")){h.push({"id":j+"7","name":"edgeClick","refScene":"MainScene","refVO":j,"refEvent":"EdgeClick"});}h.push({"id":j+"4","name":"handleMoved","refScene":"MainScene","refVO":j,"refEvent":"HandleMoved"});h.push({"id":j+"5","name":"handleContextMenu","refScene":"MainScene","refVO":j,"refEvent":"HandleContextMenu"});h.push({"id":j+"8","name":"edgeContextMenu","refScene":"MainScene","refVO":j,"refEvent":"EdgeContextMenu"});if(this._isEventRegistered("areas","handleClick")){h.push({"id":j+"6","name":"handleClick","refScene":"MainScene","refVO":j,"refEvent":"HandleClick"});}var k={name:o.id,E:[]};var l=this.getAreas();for(var n=0;n<l.length;++n){k.E.push(l[n].getDataElement());}e.push(k);};
d.prototype._getSceneVOdelta=function(o,n){var V=[];var r=[];var e={};for(var f=0,l=o.length;f<l;++f){e[o[f].id]=o[f];}for(var h=0;h<n.length;++h){if(e[n[h].id]){if(JSON.stringify(n[h])!=JSON.stringify(e[n[h].id])){r.push({"id":n[h].id,"type":"VO"});V.push(n[h]);}}else{V.push(n[h]);}delete e[n[h].id];}for(var i in e){r.push({"id":i,"type":"VO"});}var j={"Merge":{"name":"MainScene","type":"SceneGeo","SceneGeo":{"id":"MainScene"}}};if(r.length){j.Merge.SceneGeo.Remove=r;}if(V.length){j.Merge.SceneGeo.VO=V;}return j;};
d.prototype._getActionArray=function(){var A=[];if(this.mEventRegistry["click"]){A.push({"id":"Overlay1","name":"click","refScene":"MainScene","refVO":"Map","refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this.mEventRegistry["contextMenu"]){A.push({"id":"Overlay2","name":"contextMenu","refScene":"MainScene","refVO":"Map","refEvent":"ContextMenu","AddActionProperty":[{"name":"pos"}]});}A.push({"id":"Overlay3","name":"GetPosComplete","refScene":"MainScene","refVO":"General","refEvent":"CreateComplete"});return A;};
d.prototype._handleChangedData=function(n){try{this.bHandleDataChangeActive=true;if(n&&n.length){for(var e=0,N;e<n.length;++e){N=n[e];if(N.E&&N.E.length){for(var f=0,E,i;f<N.E.length;++f){E=N.E[f];i=this._findInstance(E.K);if(i){i.handleChangedData(E);}}}}}this.bHandleDataChangeActive=false;}catch(h){this.bHandleDataChangeActive=false;throw h;}};
d.prototype._findInstance=function(i){var I=(i.indexOf(".")!==-1)?i.split(".")[1]:i;var A=this.getAreas();for(var n=0;n<A.length;++n){var e=A[n];if(e.getId()===I){return e;}}return null;};
d.prototype._handleAggregationEvent=function(e){var E;if((E=this._findInstance(e.Action.instance))){try{E.handleEvent(e);}catch(f){q.sap.log.error(g().getText(M.VIT11.summary),M.VIT11.code,"sap.ui.vk.Overlay");}}};
d.prototype.isRendered=function(){return this.getDomRef()?true:false;};
d.prototype.fireSubmit=function(e){var f=JSON.parse(e.data);if(f.Data&&f.Data.Merge){this._handleChangedData(f.Data.Merge.N);}if(f.Action.object==="OverlayArea"){this._handleAggregationEvent(f);}else{var A=f.Action.name,h;if(A==="click"||A==="contextMenu"){h=[f.Action.Params.Param[0]["#"],f.Action.Params.Param[1]["#"]];}switch(A){case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(f.Action.Params.Param[0]["#"]);this.mIACreateCB=null;}catch(i){this.mIACreateCB=null;throw i;}}break;case"click":this.fireClick({clientX:h[0],clientY:h[1],pos:f.Action.AddActionProperties.AddActionProperty[0]["#"]});break;case"contextMenu":if(this.mVBIContext.m_Menus){this.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";this.mClickPos=h;this.fireContextMenu({pos:f.Action.AddActionProperties.AddActionProperty[0]["#"],menu:m});break;default:break;}}};
d.prototype.fireRender=function(e){};
d.prototype.fireMove=function(e){};
d.prototype.fireZoom=function(e){};
d.prototype.fireOpenWindow=function(e){};
d.prototype.fireCloseWindow=function(e){};
return d;});
sap.ui.predefine('sap/ui/vk/OverlayArea',["sap/ui/core/Element","./getResourceBundle"],function(E,g){"use strict";
var O=E.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});
O.prototype.openContextMenu=function(m){this.getParent().openContextMenu("OverlayArea",this,m);};
O.prototype.getDataElement=function(){var e={};var b=this.getParent().AreaBindInfo;e.K=this.getId();if(b.C){e.C=this.getColor();}if(b.CB){e.CB=this.getColorBorder();}if(b.DCH){e.DCH=this.getDeltaColorHot();}if(b.CS){e.CS=this.getColorSelect();}if(b.CNS){e.CNS=this.getColorNonSelect();}if(b.TT){e.TT=this.getTooltip();}e["VB:s"]=this.getSelect();e.P=this.getPosition();if(b.M){e["VB:c"]=this.getChangeable();}return e;};
O.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P);}};
O.prototype.handleEvent=function(e){var a=e.Action.name;var f="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var p=this.getParent();this.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(p.mVBIContext.m_Menus){p.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";if(this.getChangeable()){if(a==="edgeContextMenu"){var s=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:g().getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",s)}));}else if(a==="handleContextMenu"){var h=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:g().getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",h)}));}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:m});}else{this[f]({index:e.Action.Params.Param[2]["#"],menu:m});}}else{p._openContextMenu(e.Action.object,this,m);}}else if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];this.fireClick({clientX:e.Action.Params.Param[0]["#"],clientY:e.Action.Params.Param[1]["#"]});}else if(a.indexOf("Click")>-1){this[f]({index:e.Action.Params.Param[2]["#"]});}else{this[f]();}};
O.prototype.getKey=function(){var k=this.getProperty("key");if(!k){k=this.getId();}return k;};
O.prototype._handleCtxFunction=function(f,c){var p=this.getPosition().split(";");var o=c*3;if(f==="REMOVE"){p.splice(o,3);}else if(f==="SPLIT"){var s=[p[o],p[o+1]];var e=(o+3<p.length)?[p[o+3],p[o+4]]:[p[0],p[1]];var m=[parseFloat(s[0])+(e[0]-s[0])/2,parseFloat(s[1])+(e[1]-s[1])/2];p.splice(o+3,0,m[0].toString(),m[1].toString(),"0");}this.setPosition(p.toString().replace(/,/g,";"));};
return O;});
sap.ui.predefine('sap/ui/vk/OverlayRenderer',function(){"use strict";var O={};
O.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkOverlay");r.writeClasses(c);r.write(">");r.write("</div>");var a;if((a=c._update())){c._load(a);}};
return O;},true);
sap.ui.predefine('sap/ui/vk/ViewGalleryThumbnail',["sap/m/Image"],function(I){"use strict";
var V=I.extend("sap.ui.vk.ViewGalleryThumbnail",{metadata:{associations:{viewGallery:{type:"sap.ui.vk.ViewGallery"}},properties:{enabled:{type:"boolean",defaultValue:true},thumbnailWidth:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},thumbnailHeight:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},source:{type:"string",defaultValue:""},tooltip:{type:"string",defaultValue:""},selected:{type:"boolean",defaultValue:false},processing:{type:"boolean",defaultValue:false},animated:{type:"boolean",defaultValue:false}}}});
V.prototype.init=function(){};
V.prototype.getViewGallery=function(){var v=sap.ui.getCore().byId(this.getAssociation("viewGallery"));if(v instanceof sap.ui.vk.ViewGallery){return v;}};
V.prototype._getIndex=function(){var v=this.getViewGallery();var i=v._viewItems.indexOf(this);return i;};
return V;});
sap.ui.predefine('sap/ui/vk/Viewer',["jquery.sap.global","./library","sap/ui/core/Control","./Scene","./ContentResource","./ContentConnector","./dvl/ContentManager","./FlexibleControl","sap/m/VBox","sap/m/FlexItemData","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./DvlException","./Messages","./ProgressIndicator","./Notifications","./ViewStateManager","./Toolbar","./SceneTree","./StepNavigation","./ViewGallery","./ViewManager","./AnimationPlayer","./Viewport","./NativeViewport","./RedlineDesign","./ViewerRenderer","./SelectionMode","./getResourceBundle","./cssColorToColor","./colorToCSSColor","./abgrToColor","./colorToABGR"],function(q,v,C,S,a,b,D,F,V,c,d,e,f,M,P,N,g,T,h,j,k,m,A,n,o,R,p,r,s,t,u,w,x){"use strict";var y=q.sap.log;
var z=C.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableOverlay:{type:"boolean",defaultValue:false},enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},overlayStepNavigation:{type:"boolean",defaultValue:false},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},width:{type:"sap.ui.core.CSSSize",defaultValue:null},height:{type:"sap.ui.core.CSSSize",defaultValue:null},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"}},aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",forwarding:{getter:"_getContentConnector",aggregation:"contentResources"}},overlay:{type:"sap.ui.vk.Overlay",multiple:false},progressIndicator:{type:"sap.ui.vk.ProgressIndicator",multiple:false,visibility:"hidden"},layout:{type:"sap.m.VBox",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}}});
z.prototype.applySettings=function(i){this._inApplySettings=true;C.prototype.applySettings.apply(this,arguments);delete this._inApplySettings;if(this._viewStateManager){this._viewStateManager.setShouldTrackVisibilityChanges(this.getShouldTrackVisibilityChanges());this._viewStateManager.setRecursiveSelection(this.getRecursiveSelection());}this._componentsState={sceneTree:{defaultEnable:this.getEnableSceneTree(),shouldBeEnabled:true,userInteractionShow:this.getShowSceneTree()},stepNavigation:{defaultEnable:this.getEnableStepNavigation(),userInteractionShow:this.getShowStepNavigation()},progressIndicator:{defaultEnable:this.getEnableProgressIndicator()},messagePopover:{defaultEnable:this.getEnableNotifications()}};this.setEnableSceneTree(false);this.setEnableStepNavigation(false);};
z.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._contentConnector=new b(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._viewStateManager=new g(this.getId()+"-viewstatemanager",{contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);y.debug("sap.ui.vk.Viewer.init() called.");this._animationPlayer=new A({viewStateManager:this._viewStateManager});this._viewManager=new m({contentConnector:this._contentConnector,animationPlayer:this._animationPlayer});this._viewStateManager.setViewManager(this._viewManager);this._mainScene=null;this._busyIndicatorCounter=0;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._overlayManager={initialized:false,changed:false,control:null,onNativeViewportMove:function(i){var l=i.getParameter("pan");var E=i.getParameter("zoom");this.control.setPanAndZoom(l.x,l.y,E);},onViewportZoom:function(i){var l=i.getParameter("zoomFactor");this.control.setPanAndZoom(0,0,l);},onViewportPan:function(i){var l=i.getParameter("dx");var E=i.getParameter("dy");this.control.setPanAndZoom(l,E,1);}};this._overlayManager.delegate={onAfterRendering:this._onAfterRenderingOverlay.bind(this,this._viewport,this._nativeViewport,this._overlayManager)};this._toolbar=new T({title:this.getToolbarTitle(),visible:this.getEnableToolbar(),viewer:this});this._stackedViewport=new F(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new e({size:"auto",minSize:200})});this._splitter=new d(this.getId()+"-splitter",{layoutData:new sap.m.FlexItemData({growFactor:1,minHeight:"200px"}),contentAreas:[this._stackedViewport]}).addStyleClass("sapUiVizKitSplitter");this._messagePopover=new N({visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this._layout=new V(this.getId()+"-vbox",{height:"100%",items:[this._toolbar,this._splitter,this._messagePopover]}).addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this.setTooltip(s().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new P({visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator);}};
z.prototype.exit=function(){y.debug("sap.ui.vk.Viewer.exit() called.");if(this._viewport){this._viewport.detachEvent("viewActivated",this._onViewportViewActivated,this);this._viewport.destroy();this._viewport=null;}if(this._nativeViewport){this._nativeViewport.destroy();this._nativeViewport=null;}this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._stepNavigation=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;this._viewManager=null;if(C.prototype.exit){C.prototype.exit.apply(this);}};
z.prototype._setMainScene=function(i){if(i){if(i!==this._mainScene){this._mainScene=i;this._showViewport();if(this._componentsState.sceneTree.defaultEnable){this._instantiateSceneTree();this.setEnableSceneTree(true);if(this._componentsState.sceneTree.userInteractionShow&&this._componentsState.sceneTree.shouldBeEnabled){this.setShowSceneTree(true);this._sceneTree.setVisible(true);}else{this.setShowSceneTree(false);}}else if(this._sceneTree&&this._viewStateManager){this._sceneTree.setScene(i,this._viewStateManager);}this.setEnableStepNavigation(this.getEnableStepNavigation()||this._componentsState.stepNavigation.defaultEnable);if(this.getEnableStepNavigation()){this._instantiateStepNavigation();this.setShowStepNavigation(this._componentsState.stepNavigation.userInteractionShow);}}if(this._stepNavigation){this._stepNavigation.refresh(i);}}else{this._mainScene=null;this.setEnableSceneTree(false);this.setEnableStepNavigation(false);}return this;};
z.prototype.getGraphicsCore=function(){return this._mainScene instanceof v.dvl.Scene?this._mainScene.getGraphicsCore():null;};
z.prototype.getScene=function(){return this._mainScene;};
z.prototype.getViewStateManager=function(){return this._viewStateManager;};
z.prototype.getViewport=function(){if(!this._viewport){this._viewport=new n(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:r.Exclusive,contentConnector:this._contentConnector});this._viewport.attachEvent("viewActivated",this._onViewportViewActivated,this);}return this._viewport;};
z.prototype.getNativeViewport=function(){return this._nativeViewport;};
z.prototype.getToolbar=function(){return this._toolbar;};
z.prototype.getSceneTree=function(){return this._sceneTree;};
z.prototype.getRedlineDesign=function(){return this._redlineDesign;};
z.prototype.getOverlay=function(){return this._overlayManager.control;};
z.prototype.setEnableOverlay=function(i){if(i!==this.getProperty("enableOverlay")){this.setProperty("enableOverlay",i);this._overlayManager.changed=true;}return this;};
z.prototype.setEnableSceneTree=function(i){this.setProperty("enableSceneTree",i,true);if(!i){this.setProperty("showSceneTree",false);}this._updateLayout();return this;};
z.prototype.setEnableNotifications=function(i){this.setProperty("enableNotifications",i,true);this._messagePopover.setVisible(false);this._updateLayout();return this;};
z.prototype.setShowSceneTree=function(i){this.setProperty("showSceneTree",i,true);this._updateLayout();return this;};
z.prototype.setEnableStepNavigation=function(i){this.setProperty("enableStepNavigation",i,true);if(!i){this.setProperty("showStepNavigation",false);}this._updateLayout();return this;};
z.prototype.setShowStepNavigation=function(i){this.setProperty("showStepNavigation",i,true);this._updateLayout();return this;};
z.prototype.setEnableToolbar=function(i){this.setProperty("enableToolbar",i,true);this._toolbar.setVisible(i);return this;};
z.prototype.setRecursiveSelection=function(i){this.setProperty("recursiveSelection",i,true);if(this._viewStateManager){this._viewStateManager.setRecursiveSelection(i);}return this;};
z.prototype.setToolbarTitle=function(i){this.setProperty("toolbarTitle",i);this._toolbar.setTitle(i);return this;};
z.prototype.activateFullScreenMode=function(i){var l=function(H){return!!(H.fullScreen||H.webkitIsFullScreen||H.mozFullScreen||H.msFullscreenElement);};if(i){if(!l(document)){if(!this._fullScreenHandler){var E=this;this._fullScreenHandler=function(H){var I=l(document);if(!I){E.removeStyleClass("sapVizKitViewerFullScreen");document.removeEventListener("fullscreenchange",E._fullScreenHandler);document.removeEventListener("mozfullscreenchange",E._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",E._fullScreenHandler);document.removeEventListener("MSFullscreenChange",E._fullScreenHandler);}E.fireFullScreen({isFullScreen:I});};}var G=document.getElementsByTagName("body")[0];if(G.requestFullScreen){document.addEventListener("fullscreenchange",this._fullScreenHandler);G.requestFullScreen();}else if(G.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",this._fullScreenHandler);G.webkitRequestFullScreen();}else if(G.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",this._fullScreenHandler);G.mozRequestFullScreen();}else if(G.msRequestFullscreen){document.addEventListener("MSFullscreenChange",this._fullScreenHandler);G.msRequestFullscreen();}}this.addStyleClass("sapVizKitViewerFullScreen");}else{if(l(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}}this.removeStyleClass("sapVizKitViewerFullScreen");}return this;};
function B(i){if(!i){return false;}return i instanceof v.dvl.Viewport;}
z.prototype.getShowAllHotspots=function(){var i=this.getViewport().getImplementation();return B(i)?i.getShowAllHotspots():this.getProperty("showAllHotspots");};
z.prototype.setShowAllHotspots=function(i){this.setProperty("showAllHotspots",i,true);var l=this.getViewport().getImplementation();if(B(l)){l.setShowAllHotspots(i);}return this;};
z.prototype.getHotspotColorABGR=function(){var i=this.getViewport().getImplementation();return B(i)?i.getHotspotColorABGR():this.getProperty("hotspotColorABGR");};
z.prototype.setHotspotColorABGR=function(i){this.setProperty("hotspotColorABGR",i,true);this.setProperty("hotspotColor",u(w(i)),true);var l=this.getViewport().getImplementation();if(B(l)){l.setHotspotColorABGR(i);}return this;};
z.prototype.getHotspotColor=function(){var i=this.getViewport().getImplementation();return B(i)?i.getHotspotColor():this.getProperty("hotspotColor");};
z.prototype.setHotspotColor=function(i){this.setProperty("hotspotColor",i,true);this.setProperty("hotspotColorABGR",x(t(i)),true);var l=this.getViewport().getImplementation();if(B(l)){l.setHotspotColor(i);}return this;};
z.prototype.setRuntimeSettings=function(i){if(this._inApplySettings){this.setProperty("runtimeSettings",i,true);D.setRuntimeSettings(i);}else{y.error(s().getText(M.VIT29.summary),M.VIT29.code,"sap.ui.vk.Viewer");}return this;};
z.prototype.setWebGLContextAttributes=function(i){if(this._inApplySettings){this.setProperty("webGLContextAttributes",i,true);D.setWebGLContextAttributes(i);}else{y.error(s().getText(M.VIT30.summary),M.VIT30.code,"sap.ui.vk.Viewer");}return this;};
z.prototype.invalidate=function(i){if(i instanceof a){this._contentConnector.invalidate(i);return;}C.prototype.invalidate.apply(this,arguments);};
z.prototype._getContentConnector=function(){return this._contentConnector;};
z.prototype.onBeforeRendering=function(){this._showOverlay();};
z.prototype.isTreeBinding=function(i){return i==="contentResources";};
z.prototype.setBusy=function(i){if(i){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);C.prototype.setBusy.call(this,true);}this._busyIndicatorCounter+=1;}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){C.prototype.setBusy.call(this,false);}}};
z.prototype._updateLayout=function(){if(this._sceneTree){if(this.getShowSceneTree()&&this.getEnableSceneTree()){this._sceneTree.setVisible(true);if(this._splitter.indexOfContentArea(this._sceneTree)<0){this._splitter.insertContentArea(this._sceneTree,0);}}else{if(this._splitter.indexOfContentArea(this._sceneTree)>=0){this._splitter.removeContentArea(this._sceneTree);}this._sceneTree.setVisible(false);}}if(this._stepNavigation){this._stepNavigation.setVisible(this.getShowStepNavigation()&&this.getEnableStepNavigation());}if(this._messagePopover){this._messagePopover.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0);}if(this._toolbar){this._toolbar.refresh();}};
z.prototype._instantiateSceneTree=function(){if(!this._sceneTree){this._sceneTree=new h({layoutData:new e({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector});}return this;};
z.prototype._instantiateStepNavigation=function(){if(this._stepNavigation){this._layout.removeItem(this._stepNavigation);this._viewport.removeContent(this._stepNavigation);this._splitter.detachResize(this._handleSplitterResize,this);this._stepNavigation=null;}if(this._mainScene instanceof v.dvl.Scene){this._stepNavigation=new j({showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this._layout.insertItem(this._stepNavigation,3);}else if(this._mainScene instanceof v.threejs.Scene){this._stepNavigation=new k({host:this.getViewport(),contentConnector:this._contentConnector,viewManager:this._viewManager});if(!this.getOverlayStepNavigation()){this._layout.insertItem(this._stepNavigation,3);}else{this._stepNavigation.addStyleClass("sapVizKitViewGallery");this._viewport.addContent(this._stepNavigation);this._splitter.attachResize(this._handleSplitterResize,this);}this._stepNavigation.setAnimationPlayer(this._animationPlayer);}return this;};
z.prototype._handleSplitterResize=function(){this._stepNavigation.resizeToolbarSpacer();};
z.prototype._showViewport=function(){var i=this.getViewport().getImplementation();if(B(i)){i.setHotspotColor(this.getProperty("hotspotColor"));i.setHotspotColorABGR(this.getProperty("hotspotColorABGR"));i.setShowAllHotspots(this.getProperty("showAllHotspots"));}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._viewport);this._viewport.setVisible(true);return this;};
z.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new o(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector});}if(this._viewport){this._viewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this;};
z.prototype._showOverlay=function(){var O=this._overlayManager;if(O.changed){var i;if(this.getEnableOverlay()){sap.ui.require(["sap/ui/vk/Overlay"],function(l){if(!O.initialized){if(!(i=this.getAggregation("overlay"))){i=new l();}i.setZoomOnResize(false);O.control=i;O.initialized=true;}else{i=O.control;i.reset();}if(this._nativeViewport&&this._nativeViewport.getVisible()){i.setTarget(this._nativeViewport);O.savedLimitZoomOutState=this._nativeViewport.getLimitZoomOut();this._nativeViewport.setLimitZoomOut(true);this._nativeViewport.attachEvent("move",O.onNativeViewportMove,O);}else if(this._viewport&&this._viewport.getVisible()){i.setTarget(this._viewport);O.savedLimitZoomOutState=false;this._viewport.attachEvent("zoom",O.onViewportZoom,O);this._viewport.attachEvent("pan",O.onViewportPan,O);}this._stackedViewport.addContent(i);this._stackedViewport.addDelegate(O.delegate);}.bind(this));}else{this._nativeViewport.detachEvent("move",O.onNativeViewportMove,O);this._stackedViewport.removeDelegate(O.delegate);this._stackedViewport.removeContent(O.control);this._nativeViewport.setLimitZoomOut(O.savedLimitZoomOutState);}O.changed=false;}};
z.prototype._onAfterRenderingOverlay=function(E){var i=this._overlayManager.control.getDomRef();if(i&&(this._nativeViewport||this._viewport)){var l=this._nativeViewport&&this._nativeViewport.getVisible()?this._nativeViewport.getDomRef():this._viewport.getDomRef();if(i.parentNode!==l){i.parentNode.style.display="none";}l.appendChild(i);i.style.width="100%";i.style.height="100%";}};
z.prototype.setDecryptionHandler=function(i){this._contentConnector.setDecryptionHandler(i);return this;};
z.prototype.setAuthorizationHandler=function(i){this._contentConnector.setAuthorizationHandler(i);return this;};
z.prototype._instantiateRedlineDesign=function(i){var l=this.getViewport().getImplementation();if((l&&l.getVisible())||(this.getNativeViewport()&&this.getNativeViewport().getVisible())){var E=l&&l.getVisible()?l:this.getNativeViewport();var G=E.getOutputSize();this._redlineDesign=new R({visible:false,virtualTop:G.top,virtualLeft:G.left,virtualSideLength:G.sideLength,redlineElements:i});this._redlineDesign._setTargetViewport(E);}return this;};
z.prototype.activateRedlineDesign=function(i){var l=this.getViewport().getImplementation();if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._activateRedline();}if(l instanceof v.dvl.Viewport&&l.getViewInfo().camera&&l.getViewInfo().camera.projectionType==="perspective"){l._activateRedline();}i=i||[];this._instantiateRedlineDesign(i);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var E=function(L){var O=L.getParameter("deltaX"),Q=L.getParameter("deltaY");l.queueCommand(function(O,Q){l.pan(O,Q);l.endGesture();}.bind(this,O,Q));};var G=function(L){var O=L.getParameter("originX"),Q=L.getParameter("originY"),U=L.getParameter("zoomFactor");l.queueCommand(function(O,Q,U){l.beginGesture(O,Q);l.zoom(U);l.endGesture();}.bind(this,O,Q,U));};var H=function(L){var O=L.getParameter("deltaX"),Q=L.getParameter("deltaY");this.getNativeViewport().queueCommand(function(){this.getNativeViewport().pan(O,Q);this.getNativeViewport().endGesture();}.bind(this));};var I=function(L){var O=L.getParameter("originX"),Q=L.getParameter("originY"),U=L.getParameter("zoomFactor");this.getNativeViewport().queueCommand(function(O,Q,U){this.getNativeViewport().beginGesture(O,Q);this.getNativeViewport().zoom(U);this.getNativeViewport().endGesture();}.bind(this,O,Q,U));};var J=function(L){var O=L.getParameter("deltaX"),Q=L.getParameter("deltaY");l.queueCommand(function(O,Q){l._viewportGestureHandler._cameraController.beginGesture(O,Q);l._viewportGestureHandler._cameraController.pan(O,Q);l._viewportGestureHandler._cameraController.endGesture();}.bind(this,O,Q));};var K=function(L){var O=L.getParameter("originX"),Q=L.getParameter("originY"),U=L.getParameter("zoomFactor");l.queueCommand(function(O,Q,U){l._viewportGestureHandler._cameraController.beginGesture(O,Q);l._viewportGestureHandler._cameraController.zoom(U);l._viewportGestureHandler._cameraController.endGesture();}.bind(this,O,Q,U));};if(this.getNativeViewport()&&this.getNativeViewport().getVisible()){this.getRedlineDesign().attachEvent("pan",H.bind(this));this.getRedlineDesign().attachEvent("zoom",I.bind(this));}else if(l&&B(l)&&l.getVisible()){this.getRedlineDesign().attachEvent("pan",E.bind(this));this.getRedlineDesign().attachEvent("zoom",G.bind(this));}else if(l instanceof v.threejs.Viewport&&l.getVisible()){this.getRedlineDesign().attachEvent("pan",J.bind(this));this.getRedlineDesign().attachEvent("zoom",K.bind(this));}else{q.sap.log.Error("Error: Viewport not supported");}return this;};
z.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){var i=this.getViewport().getImplementation();if(i instanceof v.dvl.Viewport){i._deactivateRedline();}else if(i instanceof v.threejs.Viewport){i._viewportGestureHandler._deactivateRedline();}this.getRedlineDesign().destroy();this._redlineDesign=null;}return this;};
z.prototype._onViewportViewActivated=function(i){this._componentsState.sceneTree.shouldBeEnabled=i.getParameter("type")==="3D";};
z.prototype._removeProgressIndicator=function(i){setTimeout(function(){this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0);}.bind(this),i);};
z.prototype._handleContentReplaced=function(i){var l=i.getParameter("newContent");if(l&&l instanceof v.Scene){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio();}this._setMainScene(l);}else if(l instanceof HTMLImageElement||l instanceof HTMLObjectElement){this._setMainScene(null);this._showNativeViewport();if(this.getEnableOverlay()){this._overlayManager.changed=true;this._showOverlay();}}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false);}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();}};
z.prototype._handleContentChangesStarted=function(i){this.setBusy(true);if(this._componentsState.progressIndicator.defaultEnable){this._progressIndicator.setPercentValue(0.0);this._progressIndicator.setVisible(true);this.getViewport().stopAnimation();}};
z.prototype._handleContentChangesFinished=function(i){y.info("Finished");this.setBusy(false);var l=i.getParameter("content");if(l){this.fireSceneLoadingSucceeded({scene:l});}var E=i.getParameter("failureReason");if(E){this.fireSceneLoadingFailed({reason:E});this._showNativeViewport();var G=s().getText("VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE");if(E.errorMessage===G){this._nativeViewport.loadFailed();}else{var H=s().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(H);}(Array.isArray(E)?E:[E]).forEach(function(I){y.error(s().getText(M.VIT13.summary),I.errorMessage,"sap.ui.vk.Viewer");});}if(E||this._progressIndicator.getPercentValue()===0){this._removeProgressIndicator(0);}this.fireContentResourceChangesProcessed();};
z.prototype._handleContentChangesProgress=function(E){function G(O,H){for(var i=0,l=O.length;i<l;i++){var Q=O[i];var U=Q.getSource();if((U===H)||(U instanceof File&&U.name===H)){return Q;}Q=G(Q.getContentResources(),H);if(Q){return Q;}}return null;}if(this._progressIndicator.getVisible()){var H=E.getParameter("source")||"",I=E.getParameter("percentage"),J=E.getParameter("phase");var K=G(this.getContentResources(),H);if(K&&K.getName()!==undefined){H=K.getName();}else{if(H instanceof File){H=H.name;}var L=H.match(/\..{3,4}$/);H=L&&L[0]?H.split(/\\|\//).pop():"";}this._progressIndicator.setPercentValue(I);this._progressIndicator.setDisplayValue(H+" "+J+" / "+s().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE")+": "+(I?Math.floor(I)+"%":""));if(I>=100){this._removeProgressIndicator(0);}}};
z.prototype._handleContentDestroying=function(i){this.fireSceneDestroying({scene:i.getParameter("content").scene,preventGarbageCollection:i.getParameter("preventGarbageCollection")});};
return z;});
sap.ui.predefine('sap/ui/vk/library',["sap/base/util/ObjectPath","./BillboardBorderLineStyle","./BillboardCoordinateSpace","./BillboardHorizontalAlignment","./BillboardStyle","./BillboardTextEncoding","./CameraFOVBindingType","./CameraProjectionType","./ContentResourceSourceCategory","./ContentResourceSourceTypeToCategoryMap","./DetailViewShape","./DetailViewType","./DvlException","./LeaderLineMarkStyle","./MapContainerButtonType","./Redline","./RenderMode","./SelectionMode","./TransformationMatrix","./VisibilityMode","./ZoomTo","./abgrToColor","./colorToABGR","./cssColorToColor","./colorToCSSColor","./getResourceBundle","./utf8ArrayBufferToString","./dvl/GraphicsCoreApi","./dvl/checkResult","./dvl/getJSONObject","./dvl/getPointer","./tools/AxisColours","./tools/CoordinateSystem","./tools/HitTestClickType","./tools/HitTestIdMode","./tools/PredefinedView"],function(O){"use strict";sap.ui.getCore().initLibrary({name:"sap.ui.vk",dependencies:["sap.ui.core"],interfaces:["sap.ui.vk.AuthorizationHandler","sap.ui.vk.DecryptionHandler","sap.ui.vk.IPlaybackCollection"],types:[],controls:["sap.ui.vk.AnimationTimeSlider","sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DrawerToolbar","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.ProgressIndicator","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.ViewGallery","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.tools.AnchorPointToolGizmo","sap.ui.vk.tools.CrossSectionToolGizmo","sap.ui.vk.tools.Gizmo","sap.ui.vk.tools.MoveToolGizmo","sap.ui.vk.tools.RotateToolGizmo","sap.ui.vk.tools.ScaleToolGizmo","sap.ui.vk.tools.SceneOrientationToolGizmo","sap.ui.vk.tools.TooltipToolGizmo"],elements:["sap.ui.vk.ContentConnector","sap.ui.vk.FlexibleControlLayoutData","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.RedlineElementText","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.NodesTransitionHelper","sap.ui.vk.threejs.ViewStateManager","sap.ui.vk.tools.AnchorPointTool","sap.ui.vk.tools.CrossSectionTool","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.Tool","sap.ui.vk.tools.TooltipTool"],noLibraryCSS:false,version:"1.78.0",designtime:"sap/ui/vk/designtime/library.designtime"});var v=O.get("sap.ui.vk");var s={};s["sap/ui/vk/threejs/thirdparty/three"]={exports:"THREE",amd:true};s["sap/ui/vk/ve/thirdparty/html2canvas"]={exports:"html2canvas",amd:true};s["sap/ui/vk/threejs/thirdparty/totara"]={exports:"Totara",amd:true};s["sap/ui/vk/thirdparty/gl-matrix"]={exports:"glMatrix",amd:true};s["sap/ui/vk/thirdparty/GlMatrixUtils"]={exports:"GlMatrixUtils",amd:true};sap.ui.loader.config({shim:s});var l=function(a,b){var m="new extend getMetadata";if(b){m+=" "+b;}sap.ui.lazyRequire("sap.ui.vk."+a,m);};l("AnimationPlayback");l("AnimationSequence");l("BaseNodeProxy");l("Camera");l("ContentConnector","registerSourceType");l("ContentManager");l("ContentResource");l("Core");l("DownloadManager");l("ImageContentManager");l("LayerProxy");l("Loco");l("Material");l("NodeHierarchy");l("NodeProxy");l("OrthographicCamera");l("PerspectiveCamera");l("RedlineDesignHandler");l("RedlineGesturesHandler");l("Scene");l("Smart2DHandler");l("Texture");l("View");l("ViewportHandler");l("dvl.BaseNodeProxy");l("dvl.ContentManager","getRuntimeSettings setRuntimeSettings getWebGLContextAttributes setWebGLContextAttributes getDecryptionHandler setDecryptionHandler");l("dvl.GraphicsCore");l("dvl.LayerProxy");l("dvl.NodeHierarchy");l("dvl.NodeProxy");l("dvl.Scene");l("helpers.RotateOrbitHelperDvl");l("helpers.RotateOrbitHelperThree");l("helpers.RotateTurntableHelperDvl");l("helpers.RotateTurntableHelperThree");l("Highlight");l("threejs.AnimationSequence");l("threejs.BaseNodeProxy");l("threejs.Billboard");l("threejs.Callout");l("threejs.ContentDeliveryService");l("threejs.ContentManager","registerLoader");l("threejs.DetailView");l("threejs.LayerProxy");l("threejs.Material");l("threejs.NodeHierarchy");l("threejs.NodeProxy");l("threejs.OrthographicCamera");l("threejs.PerspectiveCamera");l("threejs.Scene");l("threejs.Texture");l("threejs.Thrustline");l("threejs.ViewportGestureHandler");l("tools.AnchorPointToolHandler");l("tools.CrossSectionToolHandler");l("tools.HitTestToolHandler");l("tools.MoveToolHandler");l("tools.RectSelectToolHandler");l("tools.RotateToolHandler");l("tools.ScaleToolHandler");l("tools.TooltipToolHandler");return v;});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/AnimationPlayback',["sap/ui/base/EventProvider","./AnimationSequence"],function(E,A){"use strict";
var a=E.extend("sap.ui.vk.AnimationPlayback",{constructor:function(i,p){var u=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:(r&0x3|0x8);return v.toString(16);});};if(typeof i==="object"){p=i;i=undefined;}if(i==null){i=u();}this._sequence=p&&p.sequence?p.sequence:undefined;this._jsonData={};this._jsonData.id=i;this._jsonData.startTime=p&&p.startTime?p.startTime:0;this._jsonData.sequence=this._sequence?this._sequence.getJSONData():undefined;this._jsonData.timeScale=p&&p.timeScale?p.timeScale:1.0;this._jsonData.preDelay=p&&p.preDelay?p.preDelay:0.0;this._jsonData.postDelay=p&&p.postDelay?p.postDelay:0.0;this._jsonData.repeats=p&&p.repeats?p.repeats:1;this._jsonData.reversed=p&&p.reversed?p.reversed:false;this._jsonData.infinite=p&&p.infinite?p.infinite:false;}});
a.prototype.setJSONModel=function(m){this._model=m;if(this._sequence){this._sequence.setJSONModel(m);}return this;};
a.prototype.getId=function(){return this._jsonData.id;};
a.prototype.getStartTime=function(){return this._jsonData.startTime;};
a.prototype.setStartTime=function(s){this._jsonData.startTime=s;if(this._model){this._model.updateBindings();}return this;};
a.prototype.getSequence=function(){return this._sequence;};
a.prototype.setSequence=function(s){this._sequence=s;this._jsonData.sequence=s.getJSONData();if(this._model){this._model.updateBindings();}return this;};
a.prototype.getTimeScale=function(){return this._jsonData.timeScale;};
a.prototype.setTimeScale=function(t){this._jsonData.timeScale=t;if(this._model){this._model.updateBindings();}return this;};
a.prototype.getPreDelay=function(){return this._jsonData.preDelay;};
a.prototype.setPreDelay=function(p){this._jsonData.preDelay=p;if(this._model){this._model.updateBindings();}return this;};
a.prototype.getPostDelay=function(){return this._jsonData.postDelay;};
a.prototype.setPostDelay=function(p){this._jsonData.postDelay=p;if(this._model){this._model.updateBindings();}return this;};
a.prototype.getRepeats=function(){return this._jsonData.repeats;};
a.prototype.setRepeats=function(r){this._jsonData.repeats=r;if(this._model){this._model.updateBindings();}return this;};
a.prototype.getReversed=function(){return this._jsonData.reversed;};
a.prototype.setReversed=function(r){this._jsonData.reversed=r;if(this._model){this._model.updateBindings();}return this;};
a.prototype.getInfinite=function(){return this._jsonData.infinite;};
a.prototype.setInfinite=function(i){this._jsonData.infinite=i;if(this._model){this._model.updateBindings();}return this;};
a.prototype.getDuration=function(){var s=this._sequence?this._sequence.getDuration():0;return this._jsonData.preDelay+this._jsonData.postDelay+s*this._jsonData.repeats*this._jsonData.timeScale;};
a.prototype.getJSONData=function(){return this._jsonData;};
return a;});
sap.ui.predefine('sap/ui/vk/AnimationPlayer',["sap/ui/core/Element","./Core","./AnimationMath","./AnimationTrackType","./AnimationTrackValueType","./thirdparty/GlMatrixUtils"],function(E,v,A,a,b,g){"use strict";
var c=E.extend("sap.ui.vk.AnimationPlayer",{metadata:{associations:{viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{viewActivated:{type:"sap.ui.vk.View"},timeChanged:{time:{type:"float"},currentPlayback:{type:"sap.ui.vk.AnimationPlayback"}},stateChanged:{playing:{type:"boolean"},stopped:{type:"boolean"},endOfAnimation:{type:"boolean"}}}}});
c.prototype._getViewStateManager=function(){var d=this.getViewStateManager();return d?sap.ui.getCore().byId(d):undefined;};
c.prototype.init=function(){this._step=this._step.bind(this);this._playbackCollection=null;this._currentPlayback=null;this._time=0;this._nodeChanges=new Map();v.getEventBus().subscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);v.getEventBus().subscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);v.getEventBus().subscribe("sap.ui.vk","playbacksChanged",this._resetSequenceBoundaryProperties,this);v.getEventBus().subscribe("sap.ui.vk","trackChanged",this._resetSequenceBoundaryProperties,this);v.getEventBus().subscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this);};
c.prototype.exit=function(){this._playbackCollection=null;this._currentPlayback=null;v.getEventBus().unsubscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);v.getEventBus().unsubscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);v.getEventBus().unsubscribe("sap.ui.vk","playbacksChanged",this._resetSequenceBoundaryProperties,this);v.getEventBus().unsubscribe("sap.ui.vk","trackChanged",this._resetSequenceBoundaryProperties,this);v.getEventBus().unsubscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this);};
c.prototype._onViewApplied=function(d,e,f){if(f.source.getId()!=this.getViewStateManager()){return;}var h=f.view;var i=f.ignoreAnimationPosition;this.activateView(h,i);};
c.prototype._onSequenceChanged=function(d,e,f){if(this._currentPlayback){var h=this._getViewStateManager();var s=this._currentPlayback.getSequence();if(h&&s){if(s.getId()===f.sequenceId){h.setJoints(s.getJoint(),s);}}}var t=this._time;this._setSequenceBoundaryProperties(true);this._time=t;this.setTime(this._time,null,true);};
c.prototype._resetSequenceBoundaryProperties=function(d,e,f){var t=this._time;this._setSequenceBoundaryProperties(true);this._time=t;this.setTime(this._time,null,true);};
c.prototype._onNodeAnimationRemoved=function(d,e,f){if(this._currentPlayback){var h=this._getViewStateManager();var s=this._currentPlayback.getSequence();if(h&&s){if(s.getId()===f.sequenceId){h.setJoints(s.getJoint(),s);f.nodeRefs.forEach(function(n){if(f.property){h.resetNodeProperty(n,f.property);}else{h.resetNodeProperty(n);h.resetNodeProperty(n,a.Opacity);}});}}}var t=this._time;this._setSequenceBoundaryProperties(true);this._time=t;this.setTime(this._time,null,true);};
c.prototype.getAnimatedProperty=function(n,p){var r={};var d=this._getViewStateManager();if(!d){return null;}if(p!==a.Opacity){var w=d.getTransformationWorld(n);if(p===a.Rotate){r.world=w.quaternion;}else if(p===a.Translate){r.world=w.translation;}else{r.world=w.scale;}}var e=this._nodeChanges.get(n);if(!e||e[p]===undefined){r.offsetToPrevious=null;r.offsetToRest=null;if(p===a.Opacity){r.absolute=d.getOpacity(n);r.totalOpacity=d.getTotalOpacity(n);}else{var t=d.getTransformation(n);if(p===a.Rotate){r.absolute=t.quaternion;}else if(p===a.Translate){r.absolute=t.translation;}else{r.absolute=t.scale;}}return r;}if(p===a.Opacity){var o=e[p];r.offsetToRest=o;r.offsetToPrevious=e.offsetToPrevious[p];r.opacity=e.absolute.opacity;r.totalOpacity=e["totalOpacity"];return r;}var f=e[p];r.offset=f;if(p===a.Rotate){r.absolute=e.absolute.quaternion;}else if(p===a.Translate){r.absolute=e.absolute.translate;}else{r.absolute=e.absolute.scale;}r.offsetToPrevious=e.offsetToPrevious[p];r.offsetToRest=e[p];return r;};
c.prototype.setTime=function(t,p,d){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){this._currentPlayback=undefined;this._time=0;}else{if(p!=null){t=this._getAbsoluteTime(t,p);}var e=this._getViewStateManager();this._time=t;if(t>=0&&t<=this.getTotalDuration()){var f=this._currentPlayback;var n;if(p!=null){n=this._playbackCollection.getPlayback(p);}else{n=this._findPlaybackByAbsoluteTime(t);}this._currentPlayback=n;if(e&&this._currentPlayback&&f!==this._currentPlayback){var s=this._currentPlayback.getSequence();if(s){e.setJoints(s.getJoint(),s);}}else if(!this._currentPlayback||!this._currentPlayback.getSequence()){e.setJoints(undefined);}}else if(e){e.setJoints(undefined);}if(e){var h={nodeRefs:[],positions:[]};var i=false;if(this._currentPlayback){i=this._currentPlayback.getReversed();}this._collectNodeChanges();this._nodeChanges.forEach(function(j,k){var l=e.addToRestTransformation(k,j.rtranslate,j.rrotate,j.rscale,j.originalRotationType);if(l){h.nodeRefs.push(k);h.positions.push(l);j.absolute={};j.absolute.translate=l.translation;j.absolute.scale=l.scale;j.absolute.quaternion=l.quaternion;}if(j[a.Opacity]!==undefined){var r=e.getRestOpacity(k);if(r===0){var s=this._currentPlayback.getSequence();if(s._convertedFromAbsolute){r=1;}}if(i){var m=e._getEndPropertyInLastSequence(k,a.Opacity);if(m){r/=m;}}e.setOpacity(k,j[a.Opacity]*r);k.userData.animatedOpacity=true;j.absolute={};j.absolute.opacity=j[a.Opacity]*r;j.totalOpacity=e.getTotalOpacity(k);}},this);e.setTransformation(h.nodeRefs,h.positions);e._setJointNodeMatrix();}}if(!d){this.fireTimeChanged({time:this._time,currentPlayback:this._currentPlayback});}return this;};
c.prototype.getTime=function(){return this._time;};
c.prototype.getCurrentPlayback=function(){return this._currentPlayback;};
c.prototype.getCurrentPlaybackTime=function(){var t=this._time;var p=this._playbackCollection.getPlaybacks();if(!Array.isArray(p)||!this.getCurrentPlayback()){return-1;}var i=0;while(p[i]!=this.getCurrentPlayback()){t-=p[i].getDuration();i++;}return t;};
c.prototype.getStartTime=function(p){if(!this._playbackCollection){return undefined;}if(typeof p==="number"){p=this._playbackCollection.getPlayback(p);}return p?p.getStartTime():undefined;};
c.prototype.getTotalDuration=function(){if(!this._playbackCollection){return 0;}var t=0;this._playbackCollection.getPlaybacks().forEach(function(p){t+=p.getDuration();});return t;};
c.prototype._step=function(t){if(!this._lastFrameTimestamp){this._lastFrameTimestamp=t;}var p=t-this._lastFrameTimestamp;this._lastFrameTimestamp=t;var n=this.getTime()+p/1000;var r=n>=0&&n<=this.getTotalDuration();if(n>this.getTotalDuration()){n=this.getTotalDuration();}this.setTime(n);if(r){this._frameId=window.requestAnimationFrame(this._step);}else{this.stop();}};
c.prototype._interpolate=function(d,e,t,f){var r={};var q;if(!e.before&&!e.after){return undefined;}else if(!e.before){if(d===b.Euler){r[b.Euler]=[0.0,0.0,0.0];r.value=[0.0,0.0,0.0,1.0];}else if(d===b.AngleAxis){r[b.AngleAxis]=[1.0,0.0,0.0,0.0];r.value=[0.0,0.0,0.0,1.0];}else if(d===b.Quaternion){r.value=[0.0,0.0,0.0,1.0];}else if(f===a.Translate){r.value=[0.0,0.0,0.0];}else if(f===a.Scale){r.value=[1.0,1.0,1.0];}else{r.value=1;}return r;}else if(!e.after){if(d===b.Euler){r[b.Euler]=e.before.value;q=A.neutralEulerToGlMatrixQuat(e.before.value);r.value=A.glMatrixQuatToNeutral(q);}else if(d===b.AngleAxis){r[b.AngleAxis]=e.before.value;q=A.neutralAngleAxisToGlMatrixQuat(e.before.value);r.value=A.glMatrixQuatToNeutral(q);}else if(d===b.Quaternion){q=A.neutralQuatToGlMatrixQuat(e.before.value);r.value=A.glMatrixQuatToNeutral(q);}else{r.value=e.before.value;}return r;}var k=0;if(e.before.time!==e.after.time){k=(e.time-e.before.time)/(e.after.time-e.before.time);}return A.interpolate(d,e.before,e.after,k,t);};
c.getBoundaryKey=function(t,i){var d=t.getKeysCount();if(!d){return null;}var e;if(i){e=t.getKey(0);}else{e=t.getKey(d-1);}var f=t.getKeysType();var q,r={};if(f===b.Euler){r[f]=e.value;q=A.neutralEulerToGlMatrixQuat(e.value);r.value=A.glMatrixQuatToNeutral(q);r.time=e.time;}else if(f===b.Quaternion){q=A.neutralQuatToGlMatrixQuat(e.value);r.value=A.glMatrixQuatToNeutral(q);r.time=e.time;}else if(f!==b.AngleAxis){r.value=e.value;r.time=e.time;}else{var h;var k=0;if(i){h=e;if(d>1){h=t.getKey(1);}k=0;}else{h=e;if(d>1){e=t.getKey(d-2);k=1;}}r=A.interpolate(f,e,h,k,t);r.time=i?e.time:h.time;}return r;};
c.prototype._getKeyFramesBracket=function(t,d){var k=d.getKeysCount();if(!k){return null;}var r={time:t,before:undefined,after:undefined};for(var i=0;i<k;i++){var e=d.getKey(i);if(e.time===t){r.before=r.after=e;}else if(e.time>t){r.before=(i===0?undefined:d.getKey(i-1));r.after=e;break;}}if(!r.before&&!r.after&&k>0){r.before=d.getKey(k-1);}if(k>1&&(!r.after||!r.before)&&(d.isCycleForward()||d.isCycleBackward())){var f=d.getKey(0).time;var h=d.getKey(k-1).time-f;var j=Math.floor((t-f)/h);var l=t-h*j;return this._getKeyFramesBracket(l,d);}return r;};
c.prototype._collectNodeChangesFromSequenceBoundaryKeys=function(n,s,i){var d=s.getNodeAnimation();if(!d){return;}var e=this._getViewStateManager();var f=this._currentPlayback.getSequence();var h=function(k,p,l){if(!k||!p||l===undefined||l===null){return;}var m=n.get(k);if(m&&m.hasOwnProperty(p)){return;}if(!m){m={};n.set(k,m);}if(!m.offsetToPrevious){m.offsetToPrevious={};}if(p===a.Opacity){m[p]=l;if(!m.offsetToPrevious[p]){var o=e.getOpacity(k);var r=e.getRestOpacity(k);if(!r&&s._convertedFromAbsolute){r=1;}if(r>0&&(o!==undefined||o!==null)){if(f){var q=e._getEndPropertyInPreviousSequence(k,p,f);if(q){o/=q;}}m.offsetToPrevious[p]=o/r;}else{m.offsetToPrevious[p]=1;}}}else{m[p]=l.slice();var t=e.getRelativeTransformation(k);if(p===a.Scale){if(!m.offsetToPrevious[p]){m.offsetToPrevious[p]=t.scale.slice();if(f){var u=e._getEndPropertyInPreviousSequence(k,p,f);if(u){m.offsetToPrevious[p][0]/=u[0];m.offsetToPrevious[p][1]/=u[1];m.offsetToPrevious[p][2]/=u[2];}}}}if(p===a.Translate){if(!m.offsetToPrevious[p]){m.offsetToPrevious[p]=t.translation.slice();if(f){var w=e._getEndPropertyInPreviousSequence(k,p,f);if(w){m.offsetToPrevious[p][0]-=w[0];m.offsetToPrevious[p][1]-=w[1];m.offsetToPrevious[p][2]-=w[2];}}}}else if(!m.offsetToPrevious[p]){m.offsetToPrevious[p]=[0,0,0];}}};var j;if(i){j=s._getNodeEndPropertiesMap();}else{j=s._getNodeStartPropertiesMap();}if(!j){return;}j.forEach(function(k,l){for(var p in k){if(f._isNodePropertyDefined(l,p)){continue;}h(l,p,k[p]);}},this);};
c.prototype._collectNodeChangesFromPlaybackBoundaryKeys=function(n,p,i){var s=p.getSequence();if(!s){return;}this._collectNodeChangesFromSequenceBoundaryKeys(n,s,i);};
c.prototype._collectSequenceNodeChanges=function(t,n,s,i){var d=s.getNodeAnimation();if(!d){return;}var e=this._getViewStateManager();var f=function(h,p,r,j){if(!h||!p||!r||r.value===undefined||r.value===null){return;}var k=n.get(h);if(!k){k={};n.set(h,k);}if(!k.animationProperties){k.animationProperties={};}k.animationProperties[p]=true;if(j){k.originalRotationType=j;}if(!k.offsetToPrevious){k.offsetToPrevious={};}var o=e._getEndPropertyInPreviousSequence(h,p,s);if(p===a.Opacity){k[p]=r.value;k.offsetToPrevious[p]=r.value;if(o){k[p]*=o;}}else{k[p]=r.value.slice();k.offsetToPrevious[p]=r.value.slice();if(o){if(p===a.Translate){k[p][0]+=o[0];k[p][1]+=o[1];k[p][2]+=o[2];}else if(p===a.Scale){k[p][0]*=o[0];k[p][1]*=o[1];k[p][2]*=o[2];}}}if(j===b.Euler||j===b.AngleAxis){k[j]=r[j].slice();k.offsetToPrevious[p]=r[j].slice();if(j===b.Euler&&o){var l=A.neutralQuatToGlMatrixQuat(o);var m=A.neutralQuatToGlMatrixQuat(k[p]);var q=g.quat.multiply(g.quat.create(),m,l);k[p]=A.glMatrixQuatToNeutral(q);}}};d.forEach(function(h){var k;for(var j in a){var l=a[j];var m=h[l];if(m&&m.getKeysCount()&&(!i||(i&&m.isInfinite()))){k=this._getKeyFramesBracket(t,m);if(!k){return;}var o=m.getKeysType();var r=this._interpolate(o,k,m,l);if(l===a.Rotate){f(h.nodeRef,l,r,o);}else{f(h.nodeRef,l,r);}}}},this);};
c.prototype._collectPlaybackNodeChanges=function(d,n,p){var s=p.getSequence();if(!s){return;}var t=d-p.getStartTime();if(t<0){return;}var e=s.getDuration()*p.getTimeScale()*p.getRepeats();var f=(t-p.getPreDelay())/p.getTimeScale();var h=0.0001;if(f>0&&f%s.getDuration()===0){f=s.getDuration();}else if(f>s.getDuration()+h){f=f%s.getDuration();}else if(f>s.getDuration()){f=s.getDuration();}f=p.getReversed()?p.getSequence().getDuration()-f:f;if(t<p.getPreDelay()){}else if(t>p.getPreDelay()+e+h){this._collectSequenceNodeChanges(f,n,p.getSequence(),true);}else{this._collectSequenceNodeChanges(f,n,p.getSequence(),false);}};
c.prototype._collectNodeChanges=function(){this._nodeChanges.clear();if(!this._currentPlayback){return;}var p=this._playbackCollection.getPlaybacks();var d=this.getTime();var i;var e=0;for(i=0;i<p.length;i++){if(this._currentPlayback&&this._currentPlayback!==p[i]){continue;}this._collectPlaybackNodeChanges(d,this._nodeChanges,p[i]);e=i;}if(!this._currentPlayback.getReversed()){for(i=e-1;i>=0;i--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],true);}for(i=e+1;i<p.length;i++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],false);}}else{for(i=e+1;i<p.length;i++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],false);}for(i=e-1;i>=0;i--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,p[i],true);}}};
c.prototype._setSequenceBoundaryProperties=function(f){if(!this._playbackCollection){return;}var p=this._playbackCollection.getPlaybacks();var n=false;if(p&&p.length&&p[0].getReversed()){n=true;this._playbackCollection.setPlaybacksReversed(false,true);}var i;var t=0;var d,s;if(f){for(i=0;i<p.length;i++){d=p[i];if(!d){continue;}s=d.getSequence();if(s){s._clearNodesBoundaryProperties();}}}for(i=0;i<p.length;i++){d=p[i];if(!d){continue;}var e=this._getViewStateManager();s=d.getSequence();if(e&&s){if(!f&&s._hasCompleteNodesBoundaryProperties()){continue;}t=d.getPreDelay();this.setTime(t,i,true);s._setCurrentNodesPropertiesAsBoundary(e,false,f);t+=s.getDuration();this.setTime(t,i,true);s._setCurrentNodesPropertiesAsBoundary(e,true,f);}}if(n){this._playbackCollection.setPlaybacksReversed(true,true);}};
c.prototype.play=function(){this._lastFrameTimestamp=undefined;this._frameId=window.requestAnimationFrame(this._step);v.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:true,stopped:false,endOfAnimation:false});this.fireStateChanged({playing:true,stopped:false});return this;};
c.prototype.stop=function(){if(this._frameId){window.cancelAnimationFrame(this._frameId);this._frameId=undefined;}this._lastFrameTimestamp=undefined;this.fireStateChanged({playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});v.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});return this;};
c.prototype.activateView=function(d,p){this.stop();var e=this._getViewStateManager();var f=d.getPlaybacks();if(f&&f.length>0){for(var i=0;i<f.length;i++){var h=f[i];var s=h.getSequence();if(s){e._convertTracksToRelative(s,h.getReversed());}}}if(!p){this._playbackCollection=d;}else{this._playbackCollection=undefined;}this._setSequenceBoundaryProperties();this._currentPlayback=undefined;this.setTime(0);if(p){this._playbackCollection=d;}this.fireViewActivated({view:d});return this;};
c.prototype._getAbsoluteTime=function(t,p){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return-1;}var d=this._playbackCollection.getPlaybacks();if(p<0||p>=d.length){return-1;}var e=this._playbackCollection.getPlayback(p);if(!e||e.getDuration()<t||t<0){return-1;}var f=t;var i=0;while(i<p){var h=d[i].getDuration();f+=h;i++;}return f;};
c.prototype._findPlaybackByAbsoluteTime=function(t){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return undefined;}var p=this._playbackCollection.getPlaybacks();var l=-1;var d=-1;p.forEach(function(f,h){if(f.getStartTime()>d){l=h;d=f.getStartTime();}});var i=0;while(i<p.length){var e=p[i].getDuration();var s=p[i].getStartTime();if((i!==l&&t>=s&&t<(s+e))||(i===l&&t>=s&&t<=(s+e))){return p[i];}i++;}return undefined;};
return c;});
sap.ui.predefine('sap/ui/vk/AnimationSequence',["sap/ui/base/Object","./AnimationTrackType","./findIndexInArray","./AnimationPlayer","./AnimationTrack","./Core"],function(B,A,f,a,b,v){"use strict";
var c=B.extend("sap.ui.vk.AnimationSequence",{constructor:function(i,p){this._jsonData={};this._jsonData.id=i;this._jsonData.name=p&&p.name?p.name:"";this._jsonData.duration=p&&p.duration?p.duration:1.0;this._jsonData.joints=[];this._jsonData.nodes=[];this._trackMap=new Map();}});
c.prototype.setJSONModel=function(m){this._model=m;return this;};
c.prototype.getId=function(){return this._jsonData.id;};
c.prototype.getName=function(){return this._jsonData.name;};
c.prototype.setName=function(n){this._jsonData.name=n;if(this._model){this._model.updateBindings();}return this;};
c.prototype.getDuration=function(){return this._jsonData.duration;};
c.prototype.setDuration=function(d,e){this._jsonData.duration=d;if(this._model){this._model.updateBindings();}if(!e){this._fireSequenceChanged();}return this;};
c.prototype._findJointIndex=function(p,n){var j=this._jsonData.joints.filter(function(d){return d.node&&d.parent;});return f(j,function(d){return(p?d.parent==p:true)&&(n?d.node==n:true);});};
c.prototype.setJoint=function(j,d){if(!Array.isArray(j)){j=[j];}j.forEach(function(e){var i=this._findJointIndex(e.parent,e.node);if(i<0){if(!e.parentSid&&e.parent&&e.parent.userData&&e.parent.userData.treeNode){e.parentSid=e.parent.userData.treeNode.sid;}if(!e.nodeSid&&e.node&&e.node.userData&&e.node.userData.treeNode){e.nodeSid=e.node.userData.treeNode.sid;}e.type="RELATIVE";this._jsonData.joints.push(e);}},this);if(this._model){this._model.updateBindings();}if(!d){this._fireSequenceChanged();}return this;};
c.prototype.getJoint=function(j){var r;if(!j||(!j.parent&&!j.node)){r=this._jsonData.joints;}else if(j&&j.node){r=this._jsonData.joints.filter(function(i){return i.node==j.node&&(j.parent?i.parent==j.parent:true);});}else if(j&&j.parent&&!j.node){r=this._jsonData.joints.filter(function(i){return i.parent==j.parent;});}return r;};
c.prototype.removeJoint=function(j){var n=[];if(!j){this._jsonData.forEach(function(d){n.push(d.node);});this._jsonData.joints.splice(0);}else if(j&&(j.node||j.parent)){var i;do{i=this._findJointIndex(j.parent,j.node);if(i>=0){n.push(this._jsonData.joints[i].node);this._jsonData.joints.splice(i,1);}}while(i>=0);}if(this._model){this._model.updateBindings();}if(n.length){v.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:n,sequenceId:this._jsonData.id});}return this;};
c.prototype._findNodeIndex=function(n){return f(this._jsonData.nodes,function(d){return(d?d.nodeRef==n:true);});};
c.prototype.getNodeAnimation=function(n,p){var d=function(n,p){var i=this._findNodeIndex(n);var e,r;if(i!==-1){e=this._jsonData.nodes[i];}if(e){if(p){if(e[p]){r=this._trackMap.get(e[p]);}}else{r={nodeRef:n};for(var t in A){var g=A[t];if(e[g]){r[g]=this._trackMap.get(e[g]);}}}}return r;}.bind(this);var r;if(n&&!Array.isArray(n)){return d(n,p);}else if(!n){r=[];this._jsonData.nodes.forEach(function(e){r.push(d(e.nodeRef,p));},this);}else{r=[];n.forEach(function(e){r.push(d(e,p));},this);}return r;};
c.prototype.setNodeAnimation=function(n,p,t,d){var i=this._findNodeIndex(n);var e;if(i!==-1){e=this._jsonData.nodes[i];}if(!e){e={};e.nodeRef=n;if(n.userData&&n.userData.treeNode){e.sid=n.userData.treeNode.sid;}this._jsonData.nodes.push(e);}e[p]=t.getJSONData();this._trackMap.set(t.getJSONData(),t);t.setJSONModel(this._model);if(this._model){this._model.updateBindings();}if(!d){this._fireSequenceChanged();}return this;};
c.prototype.removeNodeAnimation=function(n,d,e){var i=this._findNodeIndex(n);if(i===-1){return this;}var g=this._jsonData.nodes[i];var t;if(!d){for(var p in g){t=this._trackMap.get(g[p]);if(t){t.setJSONModel(null);this._trackMap.delete(g[p]);}}this._jsonData.nodes.splice(i,1);}else{t=this._trackMap.get(g[d]);if(t){t.setJSONModel(null);this._trackMap.delete(g[d]);delete g[d];}}if(this._model){this._model.updateBindings();}if(!e){v.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:[n],property:d,sequenceId:this._jsonData.id});}return this;};
c.prototype.resetDuration=function(d){var m=0;this._jsonData.nodes.forEach(function(n){var t;for(var e in n){if(e==="sid"){continue;}var g=this._trackMap.get(n[e]);if(g){if(g.getKeysCount()){var k=g.getKey(g.getKeysCount()-1);t=k.time;}if(t&&t>m){m=t;}}}},this);if(m>0.0){this._duration=m;if(this._model){this._model.updateBindings();}}if(!d){this._fireSequenceChanged();}return this;};
c.prototype.getNodesBoundaryValues=function(i){var r=new Map();var s=function(n,p,d){var e=r.get(n);if(!e){e={};r.set(n,e);}e[p]=d;};this._jsonData.nodes.forEach(function(n){for(var t in n){if(t==="sid"){continue;}var d=this._trackMap.get(n[t]);if(d&&d.getKeysCount()){var e=a.getBoundaryKey(d,i);s(n.nodeRef,t,e.value);}}}.bind(this));return r;};
c.prototype._fireSequenceChanged=function(){v.getEventBus().publish("sap.ui.vk","sequenceChanged",{sequenceId:this._jsonData.id});};
c.prototype.getNodeBoundaryProperty=function(n,t,i){var p;var d;if(i){d=this._nodeEndPropertiesMap;}else{d=this._nodeStartPropertiesMap;}if(d){var e=d.get(n);if(e){p=e[t];}}return p;};
c.prototype._isNodePropertyDefined=function(n,p){var t=this.getNodeAnimation(n,p);if(t&&t.getKeysCount()){return true;}var j={node:n};var d=this.getJoint(j);if(d&&d.length){return true;}return false;};
c.prototype._hasCompleteNodesBoundaryProperties=function(){if(!this._nodeEndPropertiesMap||!this._nodeEndPropertiesMap.size||!this._nodeStartPropertiesMap||!this._nodeStartPropertiesMap.size){return false;}return true;};
c.prototype._clearNodesBoundaryProperties=function(){if(this._nodeEndPropertiesMap){this._nodeEndPropertiesMap.clear();}if(this._nodeStartPropertiesMap){this._nodeStartPropertiesMap.clear();}};
c.prototype._setCurrentNodesPropertiesAsBoundary=function(d,i,e){if(!e&&((this._nodeEndPropertiesMap&&i)||(this._nodeStartPropertiesMap&&!i))){return;}var n;if(i){if(!this._nodeEndPropertiesMap){this._nodeEndPropertiesMap=new Map();}else{this._nodeEndPropertiesMap.clear();}n=this._nodeEndPropertiesMap;}else{if(!this._nodeStartPropertiesMap){this._nodeStartPropertiesMap=new Map();}else{this._nodeStartPropertiesMap.clear();}n=this._nodeStartPropertiesMap;}this._jsonData.nodes.forEach(function(g){var h={};var t=d.getRelativeTransformation(g.nodeRef);for(var p in g){if(p===A.Rotate){h[A.Rotate]=t.quaternion.slice();}else if(p===A.Translate){h[A.Translate]=t.translation.slice();}else if(p===A.Scale){h[A.Scale]=t.scale.slice();}else if(p===A.Opacity){var o=d.getOpacity(g.nodeRef);var r=d.getRestOpacity(g.nodeRef);if(o!==null&&o!==undefined){if(!r){r=1;}h[A.Opacity]=o/r;}}}n.set(g.nodeRef,h);});this._jsonData.joints.forEach(function(j){if(!j.node||!j.parent){return;}var g={};var t=d.getRelativeTransformation(j.node);g[A.Rotate]=t.quaternion.slice();g[A.Translate]=t.translation.slice();g[A.Scale]=t.scale.slice();var o=d.getOpacity(j.node);var r=d.getRestOpacity(j.node);if(o!==null&&o!==undefined){if(!r){r=1;}g[A.Opacity]=o/r;}n.set(j.node,g);});};
c.prototype._getNodeEndPropertiesMap=function(){return this._nodeEndPropertiesMap;};
c.prototype._getNodeStartPropertiesMap=function(){return this._nodeStartPropertiesMap;};
c.prototype.getJSONData=function(){return this._jsonData;};
return c;});
sap.ui.predefine('sap/ui/vk/AnimationTimeSlider',["sap/m/Slider","./AnimationTimeSliderRenderer"],function(S,A){"use strict";
var a=S.extend("sap.ui.vk.AnimationTimeSlider",{metadata:{library:"sap.ui.vk"}});
a.prototype.init=function(){if(S.prototype.init){S.prototype.init.call(this);}};
a.prototype.handleAnimationStarted=function(e){this.setProgress(true);this.setValue(0);this.setStep(0.1);};
a.prototype.handleAnimationUpdated=function(e){var v=e.getParameter("value");this.setValue(v);};
a.prototype.handleAnimationFinished=function(e){this.setValue(100);};
return a;});
sap.ui.predefine('sap/ui/vk/AnimationTimeSliderRenderer',["sap/m/SliderRenderer"],function(S){"use strict";return S;},true);
sap.ui.predefine('sap/ui/vk/AnimationTrack',["sap/ui/base/Object","./AnimationTrackValueType","./findIndexInArray","./Core"],function(B,A,f,v){"use strict";
var c=B.extend("sap.ui.vk.AnimationTrack",{constructor:function(i,p){this._jsonData={};this._jsonData.id=i;this._jsonData.type=p&&p.trackValueType?p.trackValueType:A.Scalar;this._jsonData.keys=[];this._jsonData.cycleForward=!!(p&&p.cycleForward);this._jsonData.cycleBackward=!!(p&&p.cycleBackward);this._jsonData.infinite=!!(p&&p.infinite);this._jsonData._isAbsoluteValue=p&&p.isAbsoluteValue?p.isAbsoluteValue:false;}});
c.prototype.setJSONModel=function(m){this._model=m;return this;};
c.prototype.getIsAbsoluteValue=function(){return this._jsonData._isAbsoluteValue;};
c.prototype.setIsAbsoluteValue=function(i){this._jsonData._isAbsoluteValue=i;};
c.prototype.getId=function(){return this._jsonData.id;};
c.prototype.getKeysType=function(){return this._jsonData.type;};
c.prototype.isCycleForward=function(){return this._jsonData.cycleForward;};
c.prototype.setCycleForward=function(a){this._jsonData.cycleForward=a;if(this._model){this._model.updateBindings();}return this;};
c.prototype.isCycleBackward=function(){return this._jsonData.cycleBackward;};
c.prototype.setCycleBackward=function(a){this._jsonData.cycleBackward=a;if(this._model){this._model.updateBindings();}return this;};
c.prototype.isInfinite=function(){return this._jsonData.infinite;};
c.prototype.setInfinite=function(i){this._jsonData.infinite=i;if(this._model){this._model.updateBindings();}return this;};
c.prototype.getKeysCount=function(){return this._jsonData.keys.length;};
c.prototype.getKey=function(i){if(i<0||i>=this._jsonData.keys.length){return undefined;}return this._jsonData.keys[i];};
c.prototype.updateKey=function(i,a,b){if(i>=0||i<this._jsonData.keys.length){this._jsonData.keys[i].value=a;if(this._model){this._model.updateBindings();}}if(!b){this._fireTrackChanged();}return this;};
c.prototype.removeKey=function(i,b){if(i>=0||i<this._jsonData.keys.length){this._jsonData.keys.splice(i,1);if(this._model){this._model.updateBindings();}}if(!b){this._fireTrackChanged();}return this;};
c.prototype.findKeyIndex=function(t){var i=-1;if(this._jsonData.keys.length===1){i=0;}else if(this._jsonData.keys.length>1){for(var a=1;a<this._jsonData.keys.length;a++){var l=this.getKey(a-1);var r=this.getKey(a);if(t>=l.time&&t<=r.time){i=t-l.time<r.time-t?a-1:a;break;}}}return i;};
c.prototype.insertKey=function(t,d,e){var i=f(this._jsonData.keys,function(k){return k.time===t;});if(i<0){this._jsonData.keys.push({time:t,value:d});this._jsonData.keys.sort(function(a,b){return a.time-b.time;});}else{this.updateKey(i,d,true);if(this._model){this._model.updateBindings();}}if(!e){this._fireTrackChanged();}return this;};
c.prototype._fireTrackChanged=function(){v.getEventBus().publish("sap.ui.vk","trackChanged",{trackId:this._jsonData.id});};
c.prototype.getJSONData=function(){return this._jsonData;};
return c;});
sap.ui.predefine('sap/ui/vk/AnimationTrackValueTypeSize',["./AnimationTrackValueType"],function(A){"use strict";var a={};
a.get=function(v){switch(v){case A.Vector3:return 3;case A.AngleAxis:return 4;case A.Quaternion:return 4;case A.Euler:return 4;default:return 1;}};
return a;},true);
sap.ui.predefine('sap/ui/vk/Annotation',["sap/ui/core/Control","./Core","./AnnotationStyle","./NodeUtils","sap/m/FormattedText","sap/ui/richtexteditor/RichTextEditor","sap/ui/richtexteditor/EditorType","./AnnotationRenderer"],function(C,v,A,N,F,R,E,c){"use strict";
var d=C.extend("sap.ui.vk.Annotation",{
metadata:{properties:{annotationId:"string",name:"string",nodeRef:"any",text:{type:"string",defaultValue:""},style:{type:"sap.ui.vk.AnnotationStyle",defaultValue:A.Default},display:{type:"boolean",defaultValue:false},animate:{type:"boolean",defaultValue:true},selected:{type:"boolean",defaultValue:false},editable:{type:"boolean",defaultValue:false},xCoordinate:{type:"float"},yCoordinate:{type:"float"},height:{type:"float"},width:{type:"float"}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false}},aggregations:{textEditor:{type:"sap.ui.core.Control",multiple:false}}},
constructor:function(i,S){C.apply(this,arguments);this._viewport=sap.ui.getCore().byId(this.getViewport());}
});
d.prototype._firePositionChanged=function(a){v.getEventBus().publish("sap.ui.vk","annotationPositionChanged",{annotation:a,x:a.getXCoordinate(),y:a.getYCoordinate()});};
d.prototype._fireSizeChanged=function(a,b,e){v.getEventBus().publish("sap.ui.vk","annotationSizeChanged",{annotation:a,width:b,height:e});};
d.prototype.getTargetNodes=function(){this._targetNodes=this._targetNodes||[];return this._targetNodes;};
d.prototype.getAttachmentNode=function(){return this._attachmentNode;};
d.prototype.getDisplay=function(){if(this.getNodeRef()){var a=sap.ui.getCore().byId(this._viewport.getViewStateManager());return a.getVisibilityState(this.getNodeRef());}return this.getProperty("display");};
d.prototype.setDisplay=function(a){this.setProperty("display",a,true);var b=sap.ui.getCore().byId(this._viewport.getViewStateManager());var n=this.getNodeRef();if(b.getVisibilityState(n)!==a){b.setVisibilityState(n,a);}var e=this.getDomRef();if(e){e.style.visibility=a?"visible":"hidden";}return this;};
d.prototype.getSelected=function(){if(this.getNodeRef()){var a=sap.ui.getCore().byId(this._viewport.getViewStateManager());return a.getSelectionState(this.getNodeRef());}return this.getProperty("selected");};
d.prototype.setSelected=function(a){this.setProperty("selected",a,!this.getEditable());if(a){this._setMaxZ();}var b=sap.ui.getCore().byId(this._viewport.getViewStateManager());var n=this.getNodeRef();if(b.getSelectionState(n)!==a){b.setSelectionState(n,a);}this._moving=false;return this;};
d.prototype.setAnnotationId=function(n){this.setProperty("annotationId",n,true);if(this._viewport){this._viewport.getScene().setAnnotationPersistentId(this.sourceData.annotation,n);}};
d.prototype._getNodeRefScreenCenter=function(a,n){var b=N.centerOfNodes([n]);return a.projectToScreen(b[0],b[1],b[2],a.getCamera());};
d.prototype._getSortIndex=function(a){this.zIndex=this.zIndex||"auto";var n=this.getTargetNodes()[0];if(n){var b=N.centerOfNodes([n]);var e=a.projectToScreen(b[0],b[1],b[2],a.getCamera());this.zIndex=Math.floor(10000*(1-e.depth));}return this.zIndex;};
d.prototype._getOpacity=function(){if(this._viewport){var z=this.zIndex;var a=[];this._viewport.getAnnotations().forEach(function(g){if(g.getDisplay()===true){a.push(g);}});if(a.length>1){var b=Array.from(a,function(g){return g.zIndex;});var e=Math.max.apply(null,b);var f=Math.min.apply(null,b);return 0.7+(z-f)*0.3/(e-f);}}return 1;};
d.prototype._updateBlocked=function(){var t=this.getTargetNodes()[0];if(this.getDisplay()&&t){var a=this._viewport;var b=a.getDomRef().getBoundingClientRect();var n=this._getNodeRefScreenCenter(a,t);var h=a.hitTest(n.x,b.height-n.y);var e=this.getDomRef();if(h&&e){var f=[];t._vkTraverseMeshNodes(function(k){f.push(k);});if(f.indexOf(h.object)>=0){var g=this.getEditable()&&this.getSelected()?"Editing":this.getStyle();e.className="sapUiVizKitAnnotation"+g;}else{var i=sap.ui.getCore().byId(a.getViewStateManager());var w=i.getTransformationWorld(h.object).translation;var j=a.projectToScreen(w[0],w[1],w[2],a.getCamera());if(j.depth<n.depth){e.className="sapUiVizKitAnnotationHidden";}}}}return this.getDisplay();};
d.prototype._getDelay=function(){if(this._viewport){var z=this.zIndex;var e=[];this._viewport.getAnnotations().forEach(function(a){if(a.getDisplay()===true){e.push(a);}});if(e.length<=1){return 0;}var f=Array.from(e,function(a){return a.zIndex;}).sort(function(a,b){return b-a;});return f.indexOf(z);}return 0;};
d.prototype.setName=function(n){this.setProperty("name",n);if(this.getNodeRef()){this.getNodeRef().name=n;}};
d.prototype.getName=function(){if(this.getNodeRef()){return this.getNodeRef().name;}return this.getProperty("name");};
d.prototype.setText=function(t){this.setProperty("text",t);if(this.sourceData){this.sourceData.annotation.text={html:t};}if(this.getTextEditor()){this._textDiv.value=t;return this;}if(this._textDiv==null){this._textDiv=new F({width:this._textWidth?this._textWidth+"px":"auto",height:this._textHeight?this._textHeight+"px":"auto"});this._textDiv.addStyleClass("sapUiVizKitAnnotationText");}if(this.getStyle()===A.Random&&this.getAnimate()){this._setRandomText(t);}else{this._textDiv.setHtmlText(t);}return this;};
d.prototype._setRandomText=function(t){if(this.getTextEditor()){return this;}var n="";for(var i=0;i<t.length;i++){if(t[i]==="<"){n+="<";while(t[i]!==">"){i++;n+=t[i];}}if(t[i]!==">"){var r=(this._getDelay()+Math.random())+"s";var a=this.getAnimate()?"annotationRandomTextSpan":"annotationStatic";n+="<span style='animation: "+a+" 4s linear "+r+" 1 alternate both;'>";n+=t[i];n+="</span>";}}this._textDiv.setHtmlText(n);return this;};
d.prototype.setStyle=function(a){this.setProperty("style",a);if(this.sourceData){this.sourceData.annotation.style=a;}this.setText(this.getText());};
d.prototype.setAnimate=function(a){this.setProperty("animate",a);if(this.sourceData){this.sourceData.annotation.animate=a;}this.setText(this.getText());};
d.prototype._setMaxZ=function(){var a=this.getDomRef();if(a){var m=Math.max.apply(null,this._viewport.getAnnotations().map(function(b){return b.zIndex||1;}));if(!this.zIndex||this.zIndex<m){this.zIndex=m+1;}a.style.zIndex=this.zIndex;}};
d.prototype.onclick=function(e){if(this.getTextEditor()==null&&!this._moving){if(this._firstClick){v.getEventBus().publish("sap.ui.vk","annotationDoubleClicked",{annotation:this});this._firstClick=false;}else{this._firstClick=true;setTimeout(function(){if(this._firstClick){this._firstClick=false;this._viewport.tapObject(this.getNodeRef());}}.bind(this),250);}}e.stopPropagation();};
d.prototype.openEditor=function(){if(!this.getEditable()){return null;}var r=new R({editorType:E.TinyMCE4,width:this._textDiv.getWidth(),height:this._textDiv.getHeight(),value:this.getText()});if(this._textDiv){this._textDiv.destroy();}this._textDiv=r;this.setTextEditor(r);return r;};
d.prototype.closeEditor=function(){if(this.getTextEditor()==null){return;}var t=this._textDiv.getValue();this.destroyTextEditor();this._textDiv=null;this.setText(t);};
d.prototype.onAfterRendering=function(){var a=this.getDomRef();if(a){this._initialOffsetWidth=a.offsetWidth;this._initialOffsetHeight=a.offsetHeight;if(!this.getDisplay()){a.style.visibility="hidden";}this.setXCoordinate(this.getXCoordinate());this.setYCoordinate(this.getYCoordinate());this.setWidth(this.getWidth());this.setHeight(this.getHeight());this.update();}this.setEditableState(this.getEditable()&&this.getSelected());if(this.zIndex){a.style.zIndex=this.zIndex;}};
d.prototype.setEditable=function(e){if(this.getEditable()==e){return;}this.setProperty("editable",e);if(this.sourceData){this.sourceData.annotation.editable=e;}this._previousState=this._previousState||{};var a=this.getDomRef();if(a&&e){var b=a.getBoundingClientRect();this._previousState.x=b.x;this._previousState.y=b.y;}};
d.prototype.setHeight=function(h){if(h<0){return;}this.setProperty("height",h,true);if(this.getNodeRef()){this.getNodeRef().scale.setY(h);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var n=this._viewport.deNormalizeRectangle(0,0,0,h);this._textDiv.getDomRef().style.height="calc("+n.height+"px - 1rem)";}};
d.prototype.setWidth=function(w){if(w<0){return;}this.setProperty("width",w,true);if(this.getNodeRef()){this.getNodeRef().scale.setX(w);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var n=this._viewport.deNormalizeRectangle(0,0,w,0);var t=this._textDiv.getDomRef();t.style.width="calc("+n.width+"px - 1rem)";t.style.maxWidth=t.style.width;}};
d.prototype.setXCoordinate=function(x){this.setProperty("xCoordinate",x,true);if(this.getNodeRef()){this.getNodeRef().position.setX(x);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var n=this._viewport.deNormalizeRectangle(x,0,0,0);this.getDomRef().style.left=n.x+"px";}};
d.prototype.setYCoordinate=function(y){this.setProperty("yCoordinate",y,true);if(this.getNodeRef()){this.getNodeRef().position.setY(y);}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var n=this._viewport.deNormalizeRectangle(0,y,0,0);this.getDomRef().style.top=n.y+"px";}};
d.prototype._resizeEnd=function(){this._handleViewportStop();var t=this._textDiv.getDomRef();var r=this._viewport.normalizeRectangle(0,0,t.clientWidth,t.clientHeight);this.setWidth(r.width);this.setHeight(r.height);this._fireSizeChanged(this,r.width,r.height);};
d.prototype.setEditableState=function(e){if(!e){this.ontouchstart=null;return;}var a=new Map();var b=[];var f=this._viewport;var g=function(){b=f.getAnnotations().filter(function(k){return k.getEditable()&&k.getSelected();});b.forEach(function(h){var k=window.getComputedStyle(h._textDiv.getDomRef());var l=parseInt(k.width.slice(0,-2),10);var m=parseInt(k.height.slice(0,-2),10);var n=parseInt(k.maxWidth.slice(0,-2),10);a.set(h.getAnnotationId(),{width:l,height:m,maxWidth:n});});};var t=this;var h=this.getDomRef();var i=h.childNodes;this.ontouchstart=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();t._previousState.offsetTop=t._offsetTop;t._previousState.offsetLeft=t._offsetTop;b.forEach(function(h){h._initialX=o.clientX;h._initialY=o.clientY;});var l=function(k){o=k||event;t._viewport._viewportGestureHandler._gesture=false;o.stopPropagation();b.forEach(function(h){h._moving=true;h._currentX=o.clientX-h._initialX;h._currentY=o.clientY-h._initialY;s(h._currentX,h._currentY,h.getDomRef());h.update();});};var m=function(k){o=k||event;o.stopPropagation();b.forEach(function(h){h._handleViewportStop();});document.removeEventListener("mousemove",l);document.removeEventListener("mouseup",m);};document.addEventListener("mousemove",l);document.addEventListener("mouseup",m);t.update();}};var j=function(h,w,m,k){var l=h._textDiv.getDomRef();if(w){h._textWidth=w;l.style.width=h._textWidth+"px";h._textDiv.setWidth(l.style.width);}if(m){h._textMaxWidth=m;l.style.maxWidth=h._textMaxWidth+"px";}if(k){h._textHeight=k;l.style.height=h._textHeight+"px";h._textDiv.setHeight(l.style.height);}};i[0].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientX-i[0].offsetLeft;var m=o.clientY-i[0].offsetTop;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var n=o.clientX-l;var p=o.clientY-m;b.forEach(function(h){h._moving=true;j(h,a.get(h.getAnnotationId()).width-n,a.get(h.getAnnotationId()).maxWidth-n,a.get(h.getAnnotationId()).height-p);h._currentX=n;h._currentY=p;s(n,p,h.getDomRef());h.update();});};document.onmouseup=function(){b.forEach(function(h){var n=a.get(h.getAnnotationId());n.width=h._textWidth;n.height=h._textHeight;n.maxWidth=h._textMaxWidth;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};i[1].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientY-i[0].offsetTop;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var m=o.clientY-l;b.forEach(function(h){h._moving=true;j(h,null,null,a.get(h.getAnnotationId()).height-m);h._currentX=0;h._currentY=m;s(0,m,h.getDomRef());h.update();});};document.onmouseup=function(){b.forEach(function(h){var m=a.get(h.getAnnotationId());m.height=h._textHeight;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};i[2].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientX-i[0].offsetLeft;var m=o.clientY-i[0].offsetTop;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var n=o.clientX-l;var p=o.clientY-m;b.forEach(function(h){h._moving=true;j(h,a.get(h.getAnnotationId()).width+n,a.get(h.getAnnotationId()).maxWidth+n,a.get(h.getAnnotationId()).height-p);h._currentX=0;h._currentY=p;s(0,p,h.getDomRef());h.update();});};document.onmouseup=function(){b.forEach(function(h){var n=a.get(h.getAnnotationId());n.width=h._textWidth;n.height=h._textHeight;n.maxWidth=h._textMaxWidth;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};i[3].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientX-i[0].offsetLeft;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var m=o.clientX-l;b.forEach(function(h){h._moving=true;j(h,a.get(h.getAnnotationId()).width+m,a.get(h.getAnnotationId()).maxWidth+m,null);h.update();});};document.onmouseup=function(){b.forEach(function(h){var m=a.get(h.getAnnotationId());m.width=h._textWidth;m.maxWidth=h._textMaxWidth;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};i[4].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientX-i[0].offsetLeft;var m=o.clientY-i[0].offsetTop;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var n=o.clientX-l;var p=o.clientY-m;b.forEach(function(h){h._moving=true;j(h,a.get(h.getAnnotationId()).width+n,a.get(h.getAnnotationId()).maxWidth+n,a.get(h.getAnnotationId()).height+p);h.update();});};document.onmouseup=function(){b.forEach(function(h){var n=a.get(h.getAnnotationId());n.width=h._textWidth;n.height=h._textHeight;n.maxWidth=h._textMaxWidth;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};i[5].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientY-i[0].offsetTop;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var m=o.clientY-l;b.forEach(function(h){h._moving=true;j(h,null,null,a.get(h.getAnnotationId()).height+m);h.update();});};document.onmouseup=function(){b.forEach(function(h){var m=a.get(h.getAnnotationId());m.height=h._textHeight;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};i[6].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientX-i[0].offsetLeft;var m=o.clientY-i[0].offsetTop;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var n=o.clientX-l;var p=o.clientY-m;b.forEach(function(h){h._moving=true;j(h,a.get(h.getAnnotationId()).width-n,a.get(h.getAnnotationId()).maxWidth-n,a.get(h.getAnnotationId()).height+p);h._currentX=n;h._currentY=0;s(n,0,h.getDomRef());h.update();});};document.onmouseup=function(){b.forEach(function(h){var n=a.get(h.getAnnotationId());n.width=h._textWidth;n.height=h._textHeight;n.maxWidth=h._textMaxWidth;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};i[7].onmousedown=function(k){var o=k||event;if(o.button===0){o.stopPropagation();g();var l=o.clientX-i[7].offsetLeft;document.onmousemove=function(k){t._viewport._viewportGestureHandler._gesture=false;var o=k||event;var m=o.clientX-l;b.forEach(function(h){h._moving=true;j(h,a.get(h.getAnnotationId()).width-m,a.get(h.getAnnotationId()).maxWidth-m,null);h._currentX=m;h._currentY=0;s(m,0,h.getDomRef());h.update();});};document.onmouseup=function(){b.forEach(function(h){var m=a.get(h.getAnnotationId());m.width=h._textWidth;m.maxWidth=h._textMaxWidth;h._resizeEnd();});document.onmousemove=null;document.onmouseup=null;};}};};
d.prototype.update=function(){var a=this.getDomRef();if(!a){return;}var i=this._updateBlocked();if(this.getProperty("display")!=i){this.setDisplay(i);}var b=this.getSelected();if(this.getProperty("selected")!=b){this.setSelected(b);}if(!i){return;}var e=a.childNodes[8];var f=a.childNodes[9];if(this.getWidth()&&!this._moving){this.setWidth(this.getWidth());}if(this.getHeight()&&!this._moving){this.setHeight(this.getHeight());}if(!this.getAnimate()){a.style.setProperty("--animation-name","annotationStatic");}var n=this.getTargetNodes()[0];var g=n?this._getNodeRefScreenCenter(this._viewport,n):{x:0,y:0,depth:0};var h=this._viewport.getDomRef().getBoundingClientRect();var j=this._viewport.deNormalizeRectangle(this.getXCoordinate(),this.getYCoordinate(),0,0);if(this.getEditable()&&this.getSelected()){a.style.left=this._previousState.x-h.x+"px";a.style.top=this._previousState.y-h.y+"px";}else{switch(this.getStyle()){case A.Default:a.childNodes[0].style.visibility="hidden";a.childNodes[1].style.visibility="hidden";a.childNodes[2].style.visibility="hidden";a.childNodes[3].style.visibility="hidden";a.childNodes[4].style.visibility="hidden";break;case A.Explode:a.childNodes[0].style.visibility="hidden";a.childNodes[1].style.visibility="hidden";a.childNodes[2].style.visibility="hidden";break;case A.Square:a.childNodes[0].style.visibility="hidden";a.childNodes[1].style.visibility="hidden";a.childNodes[2].style.visibility="hidden";break;case A.Random:a.childNodes[0].style.visibility="hidden";break;default:break;}}if(n){var p=g.x-j.x;var k=h.height-g.y-j.y;if(this._moving){p-=this._currentX;k-=this._currentY;}e.style.left=p+"px";e.style.top=k+"px";this.setLeaderLine(e,a,f);}else{e.style.visibility="hidden";f.style.visibility="hidden";}this.setXCoordinate(this.getProperty("xCoordinate"));this.setYCoordinate(this.getProperty("yCoordinate"));};
d.prototype._handleViewportStop=function(){setTimeout(function(){this._moving=false;this.update();}.bind(this),300);var a=this.getDomRef();var b=window.getComputedStyle(a);var t=a.style.transform;a.style.transform="";this._currentX=0;this._currentY=0;var x=parseFloat(t.substring(t.indexOf("(")+1,t.indexOf(",")));var y=parseFloat(t.substring(t.indexOf(",")+1,t.indexOf(")")));if(x||y){a.style.left=(parseFloat(b.left)+x)+"px";a.style.top=(parseFloat(b.top)+y)+"px";this._offsetTop=a.offsetTop;this._offsetLeft=a.offsetLeft;var n=this._viewport.normalizeRectangle(this._offsetLeft,this._offsetTop,0,0);this.setXCoordinate(n.x);this.setYCoordinate(n.y);this._firePositionChanged(this);}};
function s(x,y,a){a.style.transform="translate("+x+"px, "+y+"px)";}
d.prototype.setLeaderLine=function(f,t,l){var a=t.getBoundingClientRect();var T=f.offsetTop+f.offsetHeight/2;var b=a.height/2;var L=f.offsetLeft+f.offsetWidth/2;var e=0;if(L>e){e=a.width;}var g=Math.abs(b-T);var h=Math.abs(e-L);var i=Math.sqrt(g*g+h*h);var j=180/Math.PI*Math.acos(g/i);var k,m;if(b>T){k=(b-T)/2+T;}else{k=(T-b)/2+b;}if(e>L){m=(e-L)/2+L;}else{m=(L-e)/2+e;}if((T<b&&L<e)||(b<T&&e<L)||(T>b&&L>e)||(b>T&&e>L)){j*=-1;}k-=i/2;l.style.transform="rotate("+j+"deg)";l.style.top=k+"px";l.style.left=m+"px";l.style.height=i+"px";};
d.prototype.getTransform=function(){var a=this.getNodeRef();a.updateMatrix();return sap.ui.vk.TransformationMatrix.convertTo4x3(a.matrix.elements);};
d.prototype.setTransform=function(t){var a=this.getNodeRef();a.position.set(t[9],t[10],t[11]);a.scale.set(t[0],t[4],t[8]);a.updateMatrix();this.setXCoordinate(a.position.x);this.setYCoordinate(a.position.y);this.setWidth(a.scale.x);this.setHeight(a.scale.y);this.update();return this;};
d.prototype.updateNodeId=function(n){var a=this.getNodeRef();a.userData.nodeId=n;this.sourceData.annotation.nodeId=n;this._viewport.getScene().setNodePersistentId(a,n);return this;};
d.prototype.setInitialOffset=function(){var t=this.getTargetNodes().values().next().value;var n={x:0,y:0,width:0.1,height:0.08};if(t&&this.getXCoordinate()===0&&this.getYCoordinate()===0){var a=this._getNodeRefScreenCenter(this._viewport,t);var b=this._viewport.getDomRef().getBoundingClientRect();var i=a.x>=b.width/2?a.x-150:a.x+50;var e=a.y>=b.height/2?e=b.height-a.y+20:b.height-a.y-120;n=this._viewport.normalizeRectangle(i,e,0,0);}this.setTransform([0.1,0,0,0,0.08,0,0,0,1,n.x,n.y,0]);return this;};
d.getStyles=function(){var a=[{style:A.Default,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjIzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MmZhNTI3NDEtOGZkZi00NTM0LWE0N2UtMWRmZWMyOTc3NTliIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDRkNjFiNzktZDUxMC01MDQwLThjNjYtYjk4ZWIyZWMxOWI0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJmYTUyNzQxLThmZGYtNDUzNC1hNDdlLTFkZmVjMjk3NzU5YiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ZojRogAABeNJREFUeJztnD1MHEcUx/9vdD6wZURcGFzFBZGSCndxZUp3HE3iYCkHrJlxFXd2FUtRJFK5tKsc6IRoiNMdVRASkqloEU2kKAqWIhmQJZ9BOmxgXorsntbLzd7u7e7tHuxPGrG3HzPz5r35ePMBMTOEEKy1JhhwPy/Y9y4LIfpNH7gjE96HSqmG6UMAADODiPrd4cGDB8r9m5nhBLJlMGbHztKRc+3IcKS1Nn4ghIDznJjZN8tnPjbFaIKIKLAOAFuGNkJfNmaprQ7sPLG7zKWUjycmJoa9eiAitv8Se5P1orU+cmQpODdML3tLTPiVkB3Zpx+0i9H1IQFo2lJbOQLQ0rzMJhASk+0WWt71UCqVBq9fv/6IiAbn5+efhEk4tiJya95t3rEVkUnZjt35mlIUQrcXYQlURIeHh3x8fNxRTtxK7rio/PqVQI12EEztR2xWZCK9BKanp8eUUg0p5ar7vpTyZZgEfHVgdxGvT05OHgshbgohysxcn5+fv+t916SDtm0RM+8IIW4JIcYBjBLR69gkCMP5taLmYAcwdxrt8B26ZKKxSzwBpzFMJAG7fP/2K2c/2urAHs0ygI6a8mYCMY2N4sB3+O4lcSNKmswJELYtyZwAYYkkgNvjmp2dfTo5OXnTuQYAy7LKlmWVlVJ/RsummVg0oJRqENHY1atXK1LKZwsLC3NKqcbbt29r1Wp1iZl3ImfU1NY2XX6Paxo2TE1NfW165nVx/YJ7GuKTKQnbJT5zP2vNqHHcYxi6X+xKnARhu/zmmDpJBzZJMqeBsMQqQJRhZTtMFpJrAPi/4o2MjPD79+8xMjKSrA/jTTuuiJgZxWIRSftgXrwdGYDut0jeuhMmfbcAABB5BiEGGmEEyCtx2jQF6HRWJW3OjwZ6lZ4XINBqkxfv6mOlUjE6QpZljVer1ZVO0gmEx20L5UZKKeeIqP/+/ftfOtczMzN3HfdSSjn38OHDHedZwNDSdTSFWExoYGBg03HkFxcXX/X3928qpd7s7+8/Z+adhYWFuTjSaUVkAaanp8cA1KWUq8y8AQBa6ycA6rVarR41/nZEFmBxcfEVgM8PDw8VEd0BACHEU631kmVZ40BTyGSIUgfcYWZm5m4nUy5R68An099xLAfFQD6Y6ynOjwCdriGlTW/m2oV3LBRpxbVTomg/8ZXcpOl5E8oFSJtcgLTpeQE68om9eNvxbvYjcWngm7W1NV5bW2MA92KKMxCxdGRCiA9a66J9/VFr3Rc50oDEYkIAvl9fX39pm9JUTHEG4owG7Ln6lh5Rr86fBsVnTOa75z8KfhZ0xj3uVZchIsZzB3FwIUs0S7RUwHlvasKQdFnkNSBlcgWkTK6AlIlrHN2WUqk0eO3atVum51rrd0tLS1vdyk9WSK0GFIvFPy5dulSOIy4p5ar3rFWv0NIR01pT0stkSqmG1voXZ+nYsqzxQqHgHFDbAjDKzBt7e3vfXrly5bOBgYFNADuVSuW28y4zvwAAIioDADNvtTp/FgX3geQ443XoWhPkR6lUGrQLf0tr7eymWBFC/Dg0NPS7Xag3pJQv7d0Z9aOjo9tOkyWlvAUAcRe+mxA7YT9orQMbbyYUUKvV6kopMHPdvZlidnb2ndZ6BwDK5fIoEY0x8wYR3enr63sEQHUrj0FrQNgty5lQAADs7u7eGB4eXnXtP6oz80q1Wn0hpXxGRD+cnJzcc/YbKaU2lVJvDg4Obp+eni4VCoVflVKNg4ODr5aXlyMfc+kWqfUBvULYPiBsf5H7ASmTKyBlcgWkTOj/SHTRSLos8pJOmVwBKWPyA1o6E716ujUoSZ77NHFGAee9kP1IQ/a8CUqZXAEpk5m5IC9CiH8B7AMwLuJklH/CvJzZPd5JzsFnibwJSplcASmTGQU4Lr8Q4p4QYhvARyHEthCiq9uVu06Ys5VJBiICEW2vr6+zm42NDSai7bTzl1TITA1wOD099f193sjMKMj5L/NCiO8A/ATgCwB/AfhZa/1burlLjv8A3MQpISu2+rQAAAAASUVORK5CYII="},{style:A.Explode,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM0OjQyKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTkxNWVjMTctNGM5Mi00YzljLWE0MTUtMjA0NDFhMmQwNTFhIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDNjNTE2ZDgtOTgxOC1hYzQwLWJiM2EtNmNiYjI5Nzg3NTcwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjYzNzdjM2ExLTQ0OGQtNDVmOC05YmRjLTdlZmZmZjMxM2Y5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjE5MTVlYzE3LTRjOTItNGM5Yy1hNDE1LTIwNDQxYTJkMDUxYSIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjYzNzdjM2ExLTQ0OGQtNDVmOC05YmRjLTdlZmZmZjMxM2Y5OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+jDd+1gAABfdJREFUeJztnDtsFEccxr//6DAHwnJQZEwVykQKgi5UuKTzuQmOKQ578QwSUuigSSidijJIJ+VsnSw3iHTnKi5x5ZQWUZTSVDxkhZORzihmJoV3zHrvZp+zt3vH/qSR73b3Zuabb2bnsbMmpRQYY0pKSTDgPV9xj51hjFVNP/BGxvwnhRBd0w8BAEopEFHVG+7cuSO835VS0IFcDcbsuFk60J+1hgMppfEHjH3KOXNjCMy2e74B4ChL/WL0R+Km0iAiiuwBAFSklBQi+syJCLxfQj0Aen3gnD+YnZ2dsuZDFNEnvvct1qAf9VQ+f4x+tAYFX/EloG/10lXJqDkqpupY6XvUR61Wm5icnLxPRBMrKysP4yR8bEKY1WF4q4IX5kYebnUIRrO9tTZtIKIGEcEbbCegw6eEIjaEpEX4p7cdJK6uQf1KpJtFFAJrUZbkl8DCwsK0EKLLOd/0HuecP4uTQKAHbhfx8vDw8AFj7BJjrK6U6qysrNzwX2vyIPRepJTaZYxdZYzNALhCRC+tKYjD6NYiXUQAwscwJkx3UilltHtR0kSklCPgQWg78EpP4lGkTh+A8icWEfJ2+jbGRjYIHL77ydzjrDkWYGPwaIO49XR0HEiCd8a1tLT0aH5+/pL+DACO49Qdx6kLIf5Jl00zVhwQQnSJaPrcuXNNzvnj1dXVZSFEd29vr91qtdaVUrs20umLb1xcTRpu3779nemcf4obFGKP5b19pY1xS1pM4x4To9OIbUwwbRC3N7Y23LIJY6wB4F7YdQMZziVEZ74RdmFRBWhChRRdgMYoxEobcBueNyJKOj/yxBdEA8A9a3Mm2wLi4J8PABj8yNR/C4+TvlcAAOTeEwPoxhEwLI3YyOgIGFSjCyNu+xsdB4aVoRcQdeHpBP6nj81m07ie5DjOTKvV2kiSTiTSTCk558tEVL1169bX+vPi4uINPb3knC/fvXt3V5/LYkpppQqNj49v64n82tra82q1ui2EePX27dtflVK7q6uryzbS6UdqAQsLC9MAOpzzTaXUFgBIKR8C6LTb7U7a+MNILWBtbe05gK/ev38viOg6ADDGHkkp1x3HmQGORWaDrWWVxcXFG0mWXMpllawyMihKAXnjXdjKMx/HxF1gK0auU+CfUgIY/NzA574CEDon0Hks3NKiK+ZLAHtB12kBRa1CezgSEUpRBQARRRRZABBBRNEFACEihkEAECBiWAQABhFWBDDGToQM6RFhK7XvcdQBKQBzluI0cUKEreX1DwDG3K+RetK0HK/gWdo4epOIlBt+sLkpNdaMzC1NYwkWZf00KwLab+D29zQELcz1TI+LMmUYMLGm6HH5LEu0SPS0AN3UPtPa3oN7282sUytLOWdKA3KmNCBnEj2eTEKtVps4f/78VdN5KeW79fX1nUHlpyjk1gLGxsb+OHXqVN1GXJzzTf+7VsOCcSqc9WMyIURXSvmLfnTsOM5MpVLRL6jtALiilNp68+bNzbNnz34xPj6+DWC32Wxe09cqpZ4AABHVAUAptdPv/bM0xH1UF5eB3YKCqNVqE27h70gp9W6KDcbYzxcuXPjdLdSLnPNn7u6MzsHBwTV9y+KcXwUA24U/CAphQLvd7gghoJTqeDdTLC0tvZNS7gJAvV6/QkTTSqktIrp++vTp+wBEbpm2RCEMAIDXr19fnJqa2vTsP+oopTZardYTzvljIvrx8PBwTu83EkJsCyFe7e/vX/v48eN6pVL5TQjR3d/f/+bp06fZveZimdz6gGEh6z6gnAfkTGlAzpQG5ExPJxz0QOZzRL9Nk9UDmbIF5ExpQM6Y5gF9x6ZF+S8HWRG0O5IxFrrlLSreZ+s9LUBKSaZgI/EiE6CbcFT4DUTctheV8hYUj3uwbERpQDKsGVEakI7URpQG2CGxEaUBdoltRGlANkQ2ojAGePZXzzHGXjDGPrh/5waw7zorQo0ozHs+bgG/APBtn9N/Abic1+Zgi+Y3APwkpfxXHyjME7EiY9H4nv9LVbR2fRnAPIC/Afzn/p13j48k/wOvLDJRx+b4hQAAAABJRU5ErkJggg=="},{style:A.Square,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjA4KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTk0ZjlmZWYtYzE5MS00Nzc3LWFhZjgtZDEyYTdkNjhmZWJiIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YmUxMTFiMDktOWRjOC03YjQ4LTllYzQtMTBmNDYxNjllZTY5IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmJlMjcwOTQwLWZlNjctNGQyMS04ZTI5LWE5MzIzMzM1YjliZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjU5NGY5ZmVmLWMxOTEtNDc3Ny1hYWY4LWQxMmE3ZDY4ZmViYiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmJlMjcwOTQwLWZlNjctNGQyMS04ZTI5LWE5MzIzMzM1YjliZCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+RxTC0wAABwBJREFUeJztnE9o21gawH9ytFM3MyyZeFm8zcwgSreTpWCI5JRODrn42lz2kEsuvSxiCN0umNI5DGt6KF0IJYSllFIC7TXTQg+FOYVAB0LpHwVy8i5tcWAp2s4mdUvauDOO3h5kaVw3tiVLjuWpfvCILT2/933v0/vzve8pkhACP8heMyYSCYBUwkfhKWBTBhBt5KrdllyRJElqWbQQAsuybNEab1YqFQAuX76854+lWnUtRbIsi0Qi8YtIfppW8pP55U1JeLJDzQZYlpD82MH5cUK0Q1XVYecHnuwASE3tsLy8TD6fb/FTSWorkqZpKSEEQgjPdnAz+LKDXzzbzSuOfal1HcsSkgyQzWY/Bw4GLH/34MGD2zs7O/8FNt2rQghPhmjH7u7uO8ZyUssntVQqUSqV3rnWrNs2o2UFiqKgKAq6rnPnzh0AJiYmfFXQ9SaSAVRV/SKbzQY2MvCy8WLX+sHLm5KANjYIg9A6Wl0nqyFJlmV1X4OuVyBpmjYIfBa0HOBHwzC26i9aloUMfPbgwYN/BayA8fHxSeCHxutepxwvVJ1pqZ7eGblUKrG0tNS9ChRFIZVKMTc3h67rXL9+PdwK6snlcpw4cYJ8Po+u6/5q0DTtaOChVAihadpXjSOpaDfhhIHv5WC7sva6+J/x8fEvAxYuAT/ueaNb80E3ceYaCHE6CJP3p5ZGpN+9WBKbEFELtFAgRW3N2HS1H1FStb+bjTeirkBTwV2EEGia9rkkSSIKqfwdovwdQtO0TyRJoll6Z9lLza/Za7rebyzL4vjx4xPAAcuyttvlj/oj1JaOhtFGf01RlBBE6YyOFHAEXl5eJpfLoes6R44cYXBwkJmZGa5du8bU1BSPHz9mZWWFw4cPMzs7G6bcLqE8QplMhrNnzzI2NsbQ0BCmaTI/P8/Jkye7KjzgjkJHw3CQw6DmZH+1l6O9V+r7Ttz3CjideAe8LKL2B1VV3wJvveSN5GLOD32nwMubEtRt9EbjmQlA3ysQOY/Mgzd25cWScDebItcH2ihwBfga+s8jgzrh6+kXBfYUHvpDgabCQ/QVaCk8RFuBtsKDvYkvA78FPsUeVns9LO2sra39XQjxl1aZnFFIBpKAYhjGo30Qri0vlgS5f2hfGIbhKb8MfAR8XK1WwwpGBGJgYABV9R79TWDv/FaBpnsw+5kcVFXFsqymqV6BviZWoNf4Xo1WKhVM03S/J5NJ0ul0qEL5oWMLXLx40VM+v6cs/OJbgWQy6e7MKYpCuVxG13V0XadSqbgniZyTHE+fPg1V4EYCOzTz8/NMT08DsLi4yKVLl9B1nfPnz5NOp9nY2AgsZCtC8chyuRwAIyMjmKZJJpPh7t27rmLdJPAotLCwgK7r5PN5RkdHKRQKzM7OsrGxQblcZn19nXK5HIKoeyNpmpYCjt6/f381ChtbiUQCVVW/BP798OHD9vm7L1J3iRXoNX2vgOOBhXnqY1+RgZ+A17IcqU26Ha8ZZaAClFRVPUJEfGJaReYbiNzWol/6XoF+oDGmUU/fj6L9TmwADyQSiUCpFfEQ5IGAPsYV4FsaDvq5ZQcpOaYlV7DP+31Ni1VFbIDw8dTwDrEBwsNXwzvEBghORw3vEBugcwI1vIMkhCCbzUrAQC39BtslduJ+HzICsLBjnz8Du4Zh/JO6VY1fGldBzg7KR8DH2HH6YeBA3b1qJxX9CpABlr95dNe58Ke//uGPqqr+zTAMT+coPVeC/dLAp8DvDcNYffXqlZCiEKuPANXvP3E/Hzp0SGC3VegGGKh9lgEGBwelKAQ4ooD1511kWUZV1Uns9hlQVRUvARcv1Ley4MMdbrxQpQtbxfFj3mNiA/SY2AA9Zl8CeaVSqeVxokwm0/GrZcVikXv37nHq1KkOpest+2IARVG4evWq+13Xdaanp91DOQDlcplHj+yTtpqmMTQ0BNjGe/LkCceOHXMPsq2trbG1tcXw8DC3b98GfnkJst+IRCi7UCiwvb3NhQsXSCaTFItFzp075xrp2bNnFAoFpqamWFlZIZ1Oc/r0aZLJJKurqwB92fgQAQOUSiVM0ySdTrO4uOhez2Qy7OzYpwucf/V048aNdxr/10DPJ2FFUchkMpimydjYGDMzM4yOjrK+vs7IyAgAc3Nz3Lp1i4WFBSYnJzlz5gzFYtEt4/nz5++9UN4vOJtxKeydvZRhGKvVarUn77CapkmlUvH9Nn6lUqFcLnflsLNlWY4nPIG9AbcJbIblCfd8CKqn0wbs9UnzIPR8CPrQiQ3QY2ID9Jh6A0hEbE6IGDJdiBA6Db6Lvd1aBXjz5k0ckKkh7JNrziuZVey2Cg1nGXqAOCTZSL3+b4Et4BXwGngb9jL0J2zLvgb+RxyUd3gvKE83ekBM7/g/nE5w7+aEM3oAAAAASUVORK5CYII="},{style:A.Random,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM0OjU0KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OWZkYTc5MGItNmU4NC00ZWY1LWE0ZjEtODRlYWIwYjA1YmM4IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+COBQAABfZJREFUeJztnD1sE0kYht9vZCBBRL7oBLnqKO+q0B0VKeniNFwEhUmWzCAhHR1UR5mrKO8kS2dHUZQGOVSmupRQpU13ZahOoMixguQU0XxXsBPWm/2b9dq7TvaRRnK865l5552Znb8NMTOEEKy1JoTgvV5xv5sWQkyF/cAbmfBfVEr1w34IAGBmENGUNzx58kR5/2ZmmECuhtDsuFk6MZ+NhhOtdegPhPiWc+HGEJlt93oDwNcsJcFNpUFElNgDwNUQI3p6IALvH7EeAAARsbfMpZQvlpaW5kJ9ICL2J+vH60MS0YM5SlKs54yzwdSlWB0JCKxe1jkKI6w6VgCg22bMLoeWK2q1WvXmzZvPiajaarVeBt3Te0sMgKoPBss8syLyVgUvmRWRv/qc4a21wwYiahARvCHrBEz4llDS/iVNMXXbzF6TEdVEYyIObd6JOu0kjLwWhZFfAisrKwtKqb6Uctf7vZSybZNApAfuI+Lj6enpCyHEbSFEnZl7rVbrvv/ebpv71Qd8zuiK/ws/zHwghLgjhFgEME9EH4PuC4o8VoENF7cWmSICED+GCSOsJ9VaZ9cXBSWitb4AHozH5CwIehYMJJDR2CgLIofvfkZuwagpnADbvqRwAmwZSoB3xrW2tvbq4cOHt81nAHAcp+44Tl0p9W/SOHtv6SwkIRMHlFJ9Ilq4ceNGU0r5emNjY10p1T88POxsbm5uM/NBFukE4hkTD0xNbcPjx49/Cbvmn+JGBeuxfNG60bBxTxiXuxGPgtBJagiZTv2yQgjRAPAs7r6xDOdSYjLfiLuxqAIMsUKKLsAQKqSobSDyuhlKAwV1QGsdGbz4H2QmglTrRGnxpm2bvlcAAAy9gpABfRsBhaxCNlwcAWlXVfLm4jgwqUy8gNgV3iD8u4/NZjN0IuQ4zuLm5ua7NOkkgplxtAMc7eDcrnNckFKuE9HUo0ePfjKfV1dX75vppZRy/enTpwfmWsLARzvJt5BMFWI3pGJmZmbPTOS3trbeT01N7Sml/vv8+fOfzHywsbGxnjSubtsuG0YAucGalZWVBQA9KeUuM38AAK31SwC9TqfTs40vauM0CAEA1QcM/05pUra2tt4D+PHLly+KiO4BgBDildZ623GcReBMZGKs8uLbbky9rLK6uno/zZJLUBtItazillw5mBs3pYC8ORNgu6BUFCYz1x78U0oA458b+NxnJHiomjwWblnFFfM9gMOo+4yAolahQ3wVEUtRBQAJRRRZAJBARNEFADEiJkEAECFiUgQAISImSQAQIKKoz4FQ3ClnsZfXbSicAJu9ASCgCrlr9YFjkUldP01KRPWNPP4+DFELc+emx5M6ZRgSq5MPtlzKEi0SgQZc9K7GhlGXRdkCcqY0IGdKA3Im1fZkGmq1WnV2dvZO2HWt9dH29vb+uPJTFHJrAVevXv3nypUr9SziklLu+t+1mhQGJmLuK50AgNllGunpY6VUX2v9h9k6dhxnsVKpmBfU9gHMM/OHT58+/Xr9+vXvZmZm9gAcNJvNu+ZeZv4LAIioDgDMvB/0/tkwdNvsPYxAgOXmaQxj64KiqNVqVbfw97XW5jTFOyHE77du3dpxC/UHKWXbPZ3ROzk5uWu6LCnlHQDIuvDHgd8Aml0m7raZMMZTf51Op6eUAjP3vIcp1tbWjrTWBwBQr9fniWiBmT8Q0b1r1649B6DGkD1vmWQfedBakNaaRr1T7++CarVadW5ubhfAvHtLj5nftVotJaV8TUS/nZ6eLpvzRkqpPQC3j4+P705PTy9UKpW/AeD4+PjnN2/eZPaai9b6JO5/cAxDbgZMCqM2oJwH5ExpQM6UBuRMoAGXdN0/kFGXRVnSOVMakDNhM+HAufa43yUbN/5313zXYo+8JcW7yXOuBWitKSxkkXiRidBN+Fr4DSQ8tpeUsguy4xkyNqI0IB2ZGVEaMBxDG1EakA2pjSgNyBZrI0oDRkNiIwp3vLiIZLAc0QDwqtvmc/OI0oAEDGuA/0z6QNxDxXxJiDtybnsk3UtpQM78D6oZB7/ZFWiVAAAAAElFTkSuQmCC"}];return a;};
d.createAnnotation=function(a,b){var e=new d({viewport:b,annotationId:a.annotation.id,nodeRef:a.node,style:a.annotation.style,animate:a.annotation.animate===undefined?true:a.annotation.animate,editable:!!a.annotation.editable,name:a.node.name,text:a.annotation.text?a.annotation.text.html:"",xCoordinate:a.node.position.x,yCoordinate:a.node.position.y,width:a.node.scale.x,height:a.node.scale.y});e._attachmentNode=a.attachment;if(a.targetNodes){a.targetNodes.forEach(function(t){e.getTargetNodes().push(t);});}e.sourceData=a;return e;};
d.prototype._getBackgroundColor=function(){var a="rgba(221, 221, 221, 0.5)";var b=this.sourceData.annotation;if(b.label&&b.label.colour){var e=b.label.colour;a="rgba("+e[0]*255+", "+e[1]*255+", "+e[2]*255+", "+e[3]+")";}return a;};
return d;});
sap.ui.predefine('sap/ui/vk/AnnotationRenderer',[],function(){"use strict";var A={};
A.render=function(r,c){r.write("<div");r.writeControlData(c);var s=c.getEditable()&&c.getSelected()?"Editing":c.getStyle();r.addClass("sapUiVizKitAnnotation"+s);r.writeClasses();r.write(">");for(var i=0;i<8;i++){r.write("<div");r.addClass("sapUiVizKitAnnotationElement"+i);r.writeClasses();r.write(">");r.write("</div>");}r.write("<div");r.addClass("sapUiVizKitAnnotationNode"+s);r.writeClasses();r.write(">");r.write("</div>");r.write("<div");r.addClass("sapUiVizKitAnnotationLeader"+s);r.writeClasses();r.write(">");r.write("</div>");if(c._textDiv){r.renderControl(c._textDiv);}r.write("</div>");};
return A;},true);
sap.ui.predefine('sap/ui/vk/AnnotationStyle',[],function(){"use strict";var A={Default:"Default",Explode:"Explode",Square:"Square",Random:"Random"};return A;},true);
sap.ui.predefine('sap/ui/vk/BaseNodeProxy',["sap/ui/base/Object"],function(B){"use strict";
var a=B.extend("sap.ui.vk.BaseNodeProxy",{metadata:{"abstract":true}});
return a;});
sap.ui.predefine('sap/ui/vk/BillboardBorderLineStyle',[],function(){"use strict";var B={None:"None",Solid:"Solid",Dash:"Dash",Dot:"Dot",DashDot:"DashDot",DashDotDot:"DashDotDot"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardCoordinateSpace',[],function(){"use strict";var B={Viewport:"Viewport",Screen:"Screen",World:"World"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardHorizontalAlignment',[],function(){"use strict";var B={Left:"left",Center:"center",Right:"right"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardStyle',[],function(){"use strict";var B={RectangularShape:"RectangularShape",CircularShape:"CircularShape",None:"None",TextGlow:"TextGlow"};return B;},true);
sap.ui.predefine('sap/ui/vk/BillboardTextEncoding',[],function(){"use strict";var B={PlainText:"PlainText",HtmlText:"HtmlText"};return B;},true);
sap.ui.predefine('sap/ui/vk/Camera',["sap/ui/base/ManagedObject"],function(M){"use strict";
var C=M.extend("sap.ui.vk.Camera",{metadata:{properties:{"position":{type:"float[]"},"targetDirection":{type:"float[]"},"upDirection":{type:"float[]"},"nearClipPlane":{type:"float"},"farClipPlane":{type:"float"}}}});
C.prototype.getCameraRef=function(){return null;};
C.prototype.getIsModified=function(){return!!this._isModified;};
C.prototype.setIsModified=function(v){this._isModified=v;};
return C;});
sap.ui.predefine('sap/ui/vk/CameraFOVBindingType',[],function(){"use strict";var C={Minimum:"minimum",Maximum:"maximum",Horizontal:"horizontal",Vertical:"vertical"};return C;},true);
sap.ui.predefine('sap/ui/vk/CameraProjectionType',[],function(){"use strict";var C={Perspective:"perspective",Orthographic:"orthographic"};return C;},true);
sap.ui.predefine('sap/ui/vk/ContentConnector',["jquery.sap.global","sap/ui/base/ManagedObjectObserver","sap/ui/core/Element","./Messages","./Core","./getResourceBundle","./ContentResource"],function(q,M,E,a,v,g,C){"use strict";var l=q.sap.log;
var b=E.extend("sap.ui.vk.ContentConnector",{metadata:{library:"sap.ui.vk",aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",bindable:"bindable"},viewStateManagers:{type:"sap.ui.vk.ViewStateManager"},contentManagers:{type:"sap.ui.vk.ContentManager",visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"any"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentReplaced:{parameters:{newContent:{type:"any"},oldContent:{type:"any"}}},contentDestroying:{parameters:{content:{type:"any"},preventGarbageCollection:{type:"function"}}}}}});
v.registerClass(b);var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.isTreeBinding=function(n){return n==="contentResources";};
b.prototype.init=function(){if(c.init){c.init.call(this);}this._inLoading=false;this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdateTimerId=null;this._content=null;this._contentManager=null;this._decryptionHandler=null;this._authorizationHandler=null;this._selfObserver=new M(this._observeChanges.bind(this));this._selfObserver.observe(this,{aggregations:["contentResources","viewStateManagers"]});};
b.prototype.exit=function(){b._cleanAssociatedLoaders();this._selfObserver.disconnect();this._selfObserver=null;if(this._scheduleContentResourcesUpdateTimerId){q.sap.clearDelayedCall(this._scheduleContentResourcesUpdateTimerId);this._scheduleContentResourcesUpdateTimerId=null;}this._delayContentResourcesUpdate=false;this._setContent(null,null);if(c.exit){c.exit.call(this);}};
b.prototype._observeChanges=function(e){if(e.name==="contentResources"){this._scheduleContentResourcesUpdate();}else if(e.name==="viewStateManagers"){if(e.mutation==="insert"){e.child.setContentConnector(this);}else if(e.mutation==="remove"){e.child.setContentConnector(null);}}};
b.prototype.invalidate=function(o){if(o instanceof C){this._scheduleContentResourcesUpdate();return;}c.invalidate.apply(this,arguments);};
b.prototype._scheduleContentResourcesUpdate=function(){if(this._inLoading){this._delayContentResourcesUpdate=true;return this;}if(!this._scheduleContentResourcesUpdateTimerId){this._scheduleContentResourcesUpdateTimerId=q.sap.delayedCall(0,this,function(){this._scheduleContentResourcesUpdateTimerId=null;var e=this.getContentResources();if(e.length>0){this._collectContentResourceSourceTypeInformation(e).then(function(i){if(i.dimensions.length>1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText(a.VIT17.cause)}});l.error(g().getText(a.VIT17.summary),a.VIT17.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length>1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText(a.VIT35.cause)}});l.error(g().getText(a.VIT35.summary),a.VIT35.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length===0){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText(a.VIT36.cause)}});l.error(g().getText(a.VIT36.summary),a.VIT36.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length===1){var t=this;this._getContentManagerByClassName(i.contentManagerClassNames[0]).then(function(h){if(t._contentManager&&h!==t._contentManager){t.fireContentChangesStarted();t._setContent(null,null);t.fireContentChangesFinished({content:null});}h.loadContent(t._content,e);});}}.bind(this));}else{q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null});});}});}return this;};
b.prototype._handleContentChangesStarted=function(e){this._inLoading=true;this.fireContentChangesStarted();};
b.prototype._handleContentChangesFinished=function(e){var h=e.getParameter("content");this._setContent(h,e.getSource());this.fireContentChangesFinished({content:h,failureReason:e.getParameter("failureReason")});this._inLoading=false;if(this._delayContentResourcesUpdate){this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdate();}};
b.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")});};
b.prototype._getContentManagerByClassName=function(e){var h,j=this.getAggregation("contentManagers",[]);for(var i=0,k=j.length;i<k;++i){h=j[i];if(h.getMetadata().getName()===e){return Promise.resolve(h);}}var t=this;return new Promise(function(n,o){sap.ui.require([e.replace(/\./g,"/")],function(p){var h=new p();t.addAggregation("contentManagers",h);h.attachContentChangesStarted(t._handleContentChangesStarted,t);h.attachContentChangesFinished(t._handleContentChangesFinished,t);h.attachContentChangesProgress(t._handleContentChangesProgress,t);t._assignDecryptionHandler([h]);t._assignAuthorizationHandler([h]);n(h);});});};
b.prototype.getContent=function(){return this._content;};
b.prototype.getContentManager=function(){return this._contentManager;};
b.prototype._assignDecryptionHandler=function(e){for(var i=0;i<e.length;i++){e[i].setDecryptionHandler(this._decryptionHandler);}};
b.prototype._assignAuthorizationHandler=function(e){for(var i=0;i<e.length;i++){e[i].setAuthorizationHandler(this._authorizationHandler);}};
b.prototype.setDecryptionHandler=function(h){this._decryptionHandler=h;this._assignDecryptionHandler(this.getAggregation("contentManagers",[]));return this;};
b.prototype.setAuthorizationHandler=function(h){this._authorizationHandler=h;this._assignAuthorizationHandler(this.getAggregation("contentManagers",[]));return this;};
b.prototype._setContent=function(n,e){var o=this._content,h=this._contentManager;if(o!==n){this._content=n;this._contentManager=e;this.fireContentReplaced({oldContent:o,newContent:n});if(o){var p=false;this.fireContentDestroying({content:o,preventGarbageCollection:function(i){p=i;}});h.destroyContent(o);if(!p){h.collectGarbage();}}}return this;};
var r=[{pattern:/(^threejs[:.])|(^(threejs|stream|vds4)$)/,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"},{pattern:/^vdsl?$/,dimension:3,contentManagerClassName:"sap.ui.vk.dvl.ContentManager"},{pattern:/^(png|jpg|jpeg|gif|bmp|tiff?|svg)$/,dimension:2,contentManagerClassName:"sap.ui.vk.ImageContentManager"}];var d=function(e){return new Promise(function(h,i){var j=r.slice();var t=function(k){if(k>=j.length){i();return;}var n=j[k];(function(){var s=e.getSourceType();if(s){s=s.toLowerCase();}if(typeof n==="function"){return n(e);}else if(typeof n.pattern==="string"){var p=n.pattern.toLowerCase();if(p===s){return Promise.resolve(n);}}else if(n.pattern instanceof RegExp){if(n.pattern.test(s)){return Promise.resolve(n);}}return Promise.reject();})().then(function(o){h({dimension:o.dimension,contentManagerClassName:o.contentManagerClassName,settings:o.settings});},function(){t(k+1);});};t(0);});};
b.addContentManagerResolver=function(e){if(typeof e==="function"){r.unshift(e);}else{r.unshift({pattern:e.pattern,dimension:e.dimension,contentManagerClassName:e.contentManagerClassName,settings:e.settings});}return this;};
b.removeAllContentManagerResolvers=function(){r=[];return this;};
b.removeContentManagerResolver=function(e){var h=typeof e==="function",j=typeof e==="string",k=e instanceof RegExp;for(var i=0,n=r.length;i<n;++i){if(h||j){if(r[i]===e){r.splice(i,1);return true;}}else if(k){if(typeof r[i]==="object"&&r[i].pattern instanceof RegExp&&r[i].pattern.source===e.source){r.splice(i,1);return true;}}}return false;};
b._cleanAssociatedLoaders=function(){for(var i=0,e=r.length;i<e;++i){var h=r[i];if(h.settings&&h.settings.loader&&h.settings.loader.exit){h.settings.loader.exit();}}};
b.prototype._collectContentResourceSourceTypeInformation=function(e){var n=false,u=false,h={},j={},k=[];e.forEach(function flatten(i){k.push(i);i.getContentResources().forEach(flatten);});return Promise.all(k.map(function(i){return d(i).then(function(o){h[o.dimension]=true;j[o.contentManagerClassName]=true;return o;},function(){if(i.getSourceType()){u=true;}else{n=true;}return false;});})).then(function(o){for(var i=0,p=k.length;i<p;++i){if(o[i]){k[i]._contentManagerResolver=o[i];}}return{noSourceTypes:n,unknownSourceTypes:u,dimensions:Object.getOwnPropertyNames(h).sort(),contentManagerClassNames:Object.getOwnPropertyNames(j)};});};
var f=b.getMetadata().getName();var m={init:function(){this._contentConnector=null;v.attachEvent(f+"-created",this._handleContentConnectorCreated,this).attachEvent(f+"-destroying",this._handleContentConnectorDestroying,this);},exit:function(){this.setContentConnector(null);v.detachEvent(f+"-destroying",this._handleContentConnectorDestroying,this).detachEvent(f+"-created",this._handleContentConnectorCreated,this);},setContentConnector:function(e){this.setAssociation("contentConnector",e,true);this._updateContentConnector();return this;},_updateContentConnector:function(){var n=this.getContentConnector(),e=n&&sap.ui.getCore().byId(n)||null;if(this._contentConnector!==e){this._clearContentConnector();if(e){if(this._handleContentChangesStarted){e.attachContentChangesStarted(this._handleContentChangesStarted,this);}if(this._handleContentChangesFinished){e.attachContentChangesFinished(this._handleContentChangesFinished,this);}if(this._handleContentChangesProgress){e.attachContentChangesProgress(this._handleContentChangesProgress,this);}if(this._handleContentReplaced){e.attachContentReplaced(this._handleContentReplaced,this);}if(this._handleContentDestroying){e.attachContentDestroying(this._handleContentDestroying,this);}this._contentConnector=e;if(this._onAfterUpdateContentConnector){this._onAfterUpdateContentConnector();}}}return this;},_clearContentConnector:function(){if(this._contentConnector){if(this._onBeforeClearContentConnector){this._onBeforeClearContentConnector();}if(this._handleContentDestroying){this._contentConnector.detachContentDestroying(this._handleContentDestroying,this);}if(this._handleContentReplaced){this._contentConnector.detachContentReplaced(this._handleContentReplaced,this);}if(this._handleContentChangesProgress){this._contentConnector.detachContentChangesProgress(this._handleContentChangesProgress,this);}if(this._handleContentChangesFinished){this._contentConnector.detachContentChangesFinished(this._handleContentChangesFinished,this);}if(this._handleContentChangesStarted){this._contentConnector.detachContentChangesStarted(this._handleContentChangesStarted,this);}this._contentConnector=null;}return this;},_handleContentConnectorCreated:function(e){if(this.getContentConnector()===e.getParameter("object").getId()){this._updateContentConnector();}},_handleContentConnectorDestroying:function(e){if(this.getContentConnector()===e.getParameter("object").getId()){this._clearContentConnector();}}};
b.injectMethodsIntoClass=function(e){var p=e.prototype,i=p.init,h=p.exit;p.init=function(){if(i){i.call(this);}m.init.call(this);};p.exit=function(){m.exit.call(this);if(h){h.call(this);}};p.setContentConnector=m.setContentConnector;p._updateContentConnector=m._updateContentConnector;p._clearContentConnector=m._clearContentConnector;p._handleContentConnectorCreated=m._handleContentConnectorCreated;p._handleContentConnectorDestroying=m._handleContentConnectorDestroying;};
return b;});
sap.ui.predefine('sap/ui/vk/ContentManager',["sap/ui/base/ManagedObject"],function(M){"use strict";
var C=M.extend("sap.ui.vk.ContentManager",{metadata:{"abstract":true,library:"sap.ui.vk",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"object"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}}}}});
var b=C.getMetadata().getParent().getClass().prototype;
C.prototype.init=function(){if(b.init){b.init.call(this);}this._decryptionHandler=null;this._authorizationHandler=null;};
C.prototype.destroyContent=function(c){return this;};
C.prototype.collectGarbage=function(){return this;};
C.prototype.createOrthographicCamera=function(){return null;};
C.prototype.createPerspectiveCamera=function(){return null;};
C.prototype.destroyCamera=function(c){return this;};
C.prototype.setDecryptionHandler=function(h){this._decryptionHandler=h;return this;};
C.prototype.setAuthorizationHandler=function(h){this._authorizationHandler=h;return this;};
return C;});
sap.ui.predefine('sap/ui/vk/ContentResource',["sap/ui/base/ManagedObject","./ContentResourceSourceTypeToCategoryMap"],function(M,C){"use strict";
var a=M.extend("sap.ui.vk.ContentResource",{
metadata:{properties:{source:"any",sourceType:"string",sourceId:"string",localMatrix:"sap.ui.vk.TransformationMatrix",name:"string",password:"string",useSecureConnection:{type:"boolean",defaultValue:true},veid:"string",includeHidden:"boolean",includeAnimation:"boolean",pushPMI:"boolean",metadataFilter:"string",activateView:"string",enableLogger:"boolean",pushViewGroups:"boolean"},aggregations:{contentResources:"sap.ui.vk.ContentResource"}},
constructor:function(i,s,S){M.apply(this,arguments);}
});
a.prototype.isTreeBinding=function(n){return n==="contentResources";};
a.prototype.destroy=function(){M.prototype.destroy.call(this);};
a.prototype.setLocalMatrix=function(v){var n=this.getNodeProxy();if(n){n.setLocalMatrix(v);}this.setProperty("localMatrix",v,true);return this;};
a.prototype.getSourceProperties=function(){return this._shadowContentResource&&this._shadowContentResource.sourceProperties||{};};
a.prototype.getNodeProxy=function(){return this._shadowContentResource&&this._shadowContentResource.nodeProxy||null;};
a.collectCategories=function(r){var c=[];var m={};function g(b){var s=(b.getSourceType()||"").toLowerCase();if(s){var d=C[s]||"unknown";if(!m.hasOwnProperty(d)){m[d]=true;c.push(d);}}b.getContentResources().forEach(g);}r.forEach(g);return c;};
return a;});
sap.ui.predefine('sap/ui/vk/ContentResourceSourceCategory',[],function(){"use strict";var C={"3D":"3D","2D":"2D"};return C;},true);
sap.ui.predefine('sap/ui/vk/ContentResourceSourceTypeToCategoryMap',["./ContentResourceSourceCategory"],function(C){"use strict";var a={"vds":C["3D"],"vdsl":C["3D"],"cgm":C["3D"],"png":C["2D"],"jpg":C["2D"],"jpeg":C["2D"],"gif":C["2D"],"bmp":C["2D"],"tiff":C["2D"],"tif":C["2D"],"svg":C["2D"]};return a;},true);
sap.ui.predefine('sap/ui/vk/Core',["sap/ui/base/ManagedObject","sap/ui/core/EventBus","./library"],function(M,E,v){"use strict";
var C=M.extend("sap.ui.vk.Core",{
metadata:{aggregations:{eventBus:{type:"sap.ui.core.EventBus",multiple:false,hidden:true}},publicMethods:["registerClass"]},
constructor:function(){if(v.getCore){return v.getCore();}M.call(this);var t=this;v.getCore=function(){return t;};this._classes=[];this.setAggregation("eventBus",new E());}
});
C.prototype.registerClass=function(c){if(this._classes.indexOf(c)>=0){return this;}var t=this,f=c.getMetadata().getName(),e=f+"-created",a=f+"-destroying",b=c.prototype.register,d=c.prototype.deregister;c.prototype.register=function(){if(b){b.call(this);}t.fireEvent(e,{object:this});};c.prototype.deregister=function(){t.fireEvent(a,{object:this});if(d){d.call(this);}};this._classes.push(c);return this;};
C.prototype.getEventBus=function(){return this.getAggregation("eventBus");};
return new C();});
sap.ui.predefine('sap/ui/vk/DetailViewShape',[],function(){"use strict";var D={Box:"Box",Circle:"Circle",CircleLine:"CircleLine",CirclePointer:"CirclePointer",CircleArrow:"CircleArrow",CircleBubbles:"CircleBubbles",BoxLine:"BoxLine",BoxNoOutline:"BoxNoOutline",SolidPointer:"SolidPointer",SolidArrow:"SolidArrow"};return D;},true);
sap.ui.predefine('sap/ui/vk/DetailViewType',[],function(){"use strict";var D={DetailView:"DetailView",Cutaway:"Cutaway"};return D;},true);
sap.ui.predefine('sap/ui/vk/DownloadManager',["jquery.sap.global","sap/ui/base/EventProvider","./Messages","./getResourceBundle"],function(q,E,M,g){"use strict";
var D=E.extend("sap.ui.vk.DownloadManager",{
metadata:{events:{itemSucceeded:{parameters:{source:{type:"any"},response:{type:"object"}}},itemProgress:{parameters:{source:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},itemFailed:{parameters:{source:{type:"any"},status:{type:"any"},statusText:{type:"string"}}},allItemsCompleted:{}}},
constructor:function(s,m,a){E.apply(this);this._maxParallelTasks=m||5;this._sourcesToProcess=s.slice();this._sourcesBeingProcessed=[];this._authorizationHandler=a;}
});
D.prototype.start=function(){while(this._pickAndDispatchTask()){}return this;};
D.prototype.queue=function(s){this._sourcesToProcess.push(s);this._pickAndDispatchTask();return this;};
D.prototype._pickAndDispatchTask=function(){if(this._sourcesToProcess.length>0&&this._sourcesBeingProcessed.length<this._maxParallelTasks){var s=this._sourcesToProcess.shift();this._sourcesBeingProcessed.push(s);var t=this;if(this._authorizationHandler){this._authorizationHandler(s).then(function(a){var b=null;if(a!=null){b=a.token_type+" "+a.access_token;}var c=a?a.tenant_uuid:null;t._runTask(s,b,c);}).catch(function(r){t.fireItemFailed({source:s,status:0,statusText:r});t._taskFinished(s);if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}});}else{this._runTask(s);}return true;}return false;};
D.prototype._taskFinished=function(s){var i=this._sourcesBeingProcessed.indexOf(s);if(i>=0){this._sourcesBeingProcessed.splice(i,1);}return this;};
D.prototype._queueIsEmpty=function(){return this._sourcesToProcess.length===0&&this._sourcesBeingProcessed.length===0;};
D.prototype._runTask=function(s,a,t){var b=this;if(typeof s==="string"){var x=new(typeof sinon==="object"&&sinon.xhr&&sinon.xhr.XMLHttpRequest||XMLHttpRequest);x.onerror=function(e){b._taskFinished(s);b._pickAndDispatchTask();b.fireItemFailed({source:s,status:x.status,statusText:x.statusText});if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};x.onload=function(e){b._taskFinished(s);b._pickAndDispatchTask();if(x.status===200||x.status===0){b.fireItemSucceeded({source:s,response:x.response});}else{b.fireItemFailed({source:s,status:x.status,statusText:x.statusText});}if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};x.onprogress=function(e){b.fireItemProgress({source:s,loaded:e.loaded,total:e.total});};x.open("GET",s,true);x.responseType="arraybuffer";if(a){x.setRequestHeader("Authorization",a);}if(t){x.setRequestHeader("X-TenantUuid",t);}x.send(null);}else if(s instanceof File){var f=new FileReader();f.onload=function(e){b._taskFinished(s);b._pickAndDispatchTask();b.fireItemSucceeded({source:s,response:f.result});if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};f.onerror=function(e){b._taskFinished(s);b._pickAndDispatchTask();b.fireItemFailed({source:s,status:f.error.name,statusText:f.error.message});if(b._queueIsEmpty()){b._asyncFireAllItemsCompleted();}};f.onprogress=function(e){b.fireItemProgress({source:s.name,loaded:e.loaded,total:e.total});};f.readAsArrayBuffer(s);}else{q.sap.log.error(g().getText(M.VIT5.summary),M.VIT5.code,"sap.ui.vk.DownloadManager");}return this;};
D.prototype._asyncFireAllItemsCompleted=function(){q.sap.delayedCall(0,this,this.fireAllItemsCompleted);};
D.prototype.attachItemSucceeded=function(d,f,l){return this.attachEvent("itemSucceeded",d,f,l);};
D.prototype.detachItemSucceeded=function(f,l){return this.detachEvent("itemSucceeded",f,l);};
D.prototype.fireItemSucceeded=function(p,a,e){return this.fireEvent("itemSucceeded",p,a,e);};
D.prototype.attachItemFailed=function(d,f,l){return this.attachEvent("itemFailed",d,f,l);};
D.prototype.detachItemFailed=function(f,l){return this.detachEvent("itemFailed",f,l);};
D.prototype.fireItemFailed=function(p,a,e){return this.fireEvent("itemFailed",p,a,e);};
D.prototype.attachAllItemsCompleted=function(d,f,l){return this.attachEvent("allItemsCompleted",d,f,l);};
D.prototype.detachAllItemsCompleted=function(f,l){return this.detachEvent("allItemsCompleted",f,l);};
D.prototype.fireAllItemsCompleted=function(p,a,e){return this.fireEvent("allItemsCompleted",p,a,e);};
D.prototype.attachItemProgress=function(d,f,l){return this.attachEvent("itemProgress",d,f,l);};
D.prototype.detachItemProgress=function(f,l){return this.detachEvent("itemProgress",f,l);};
D.prototype.fireItemProgress=function(p,a,e){return this.fireEvent("itemProgress",p,a,e);};
return D;});
sap.ui.predefine('sap/ui/vk/DrawerToolbar',["./library","./DrawerToolbarRenderer","./threejs/thirdparty/three","sap/ui/core/Control","sap/m/VBox","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/Button","sap/m/ToolbarSeparator","sap/m/ToggleButton","sap/m/MenuButton","./tools/Tool","./tools/RotateTurntableTool","./tools/RotateOrbitTool","./tools/RectSelectTool","./tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem","./ZoomTo","./getResourceBundle","./threejs/Viewport","./Viewport","./DrawerToolbarButton","sap/ui/base/ManagedObjectObserver"],function(v,D,t,C,V,F,O,I,B,T,a,M,b,R,c,d,e,f,g,Z,h,j,k,l,m){"use strict";
var n=C.extend("sap.ui.vk.DrawerToolbar",{
metadata:{properties:{expanded:{type:"boolean",defaultValue:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},
constructor:function(i,S){C.apply(this,arguments);}
});
var o=[{name:"show",unicode:"e000"},{name:"hide",unicode:"e001"},{name:"turntable",unicode:"e002"},{name:"orbit",unicode:"e003"},{name:"pan",unicode:"e004"},{name:"zoom",unicode:"e005"},{name:"fit-to-view",unicode:"e006"},{name:"rectangular-selection",unicode:"e007"},{name:"structure-browser",unicode:"e008"},{name:"configuration",unicode:"e009"},{name:"setting",unicode:"e00a"},{name:"full-screen",unicode:"e00b"},{name:"predefined-views",unicode:"e00c"},{name:"authoring-app",unicode:"e00d"},{name:"dot",unicode:"e00e"},{name:"empty",unicode:"e00f"},{name:"right-panel-menu",unicode:"e010"},{name:"viewer-app",unicode:"e011"},{name:"hide-association",unicode:"e012"},{name:"cross-section",unicode:"e013"},{name:"cross-section-x",unicode:"e014"},{name:"cross-section-z",unicode:"e015"},{name:"cross-section-y",unicode:"e016"},{name:"reverse-direction",unicode:"e017"},{name:"create-editable-visualisation",unicode:"e018"},{name:"cross-section-z-",unicode:"e019"}],q="vk-icons",r="vk-icons";o.forEach(function(i){sap.ui.core.IconPool.addIcon(i.name,q,r,i.unicode);});var s="sap-icon://vk-icons/";
n.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._toolbar=new O({width:"auto",design:sap.m.ToolbarDesign.Solid,layoutData:new F({growFactor:0,shrinkFactor:0}),content:this.createButtons()});this._toolbar.ontouchstart=function(i){i.setMarked();};this._toolbarObserver=new m(this._toolbarContentChanged.bind(this));this._toolbarObserver.observe(this._toolbar,{aggregations:["content"]});this._container=new V({renderType:sap.m.FlexRendertype.Bare,alignContent:sap.m.FlexAlignContent.Center,alignItems:sap.m.FlexAlignItems.Center,items:[this._toolbar,new I({src:"sap-icon://navigation-up-arrow",noTabStop:true,press:function(i){this._toggleExpanded();}.bind(this),layoutData:new F({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]});};
n.prototype._toolbarContentChanged=function(){var p=this._toolbar.getContent();for(var i=0;i<p.length;i++){if(p[i].getMetadata().getName()=="sap.m.ToolbarSeparator"){if(p[i-1]==undefined||p[i+1]==undefined||p[i-1].getMetadata().getName()=="sap.m.ToolbarSeparator"){this._toolbar.removeContent(i);}}}};
n.prototype._getViewport=function(){var i=sap.ui.getCore().byId(this.getViewport());if(i instanceof j){return i;}if(i instanceof k&&i._implementation instanceof j){return i._implementation;}return null;};
var u=[null,new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2)];
n.prototype.createButtons=function(){var i=this;var p,y;function z(U,W,X){p.setPressed(true);if(i._crossSectionTool){i._crossSectionTool.setActive(true,U);if(W!==undefined){i._crossSectionTool.setAxis(W);y.setIcon(s+"cross-section-"+["x","y","z"][W]);}}}p=new a({icon:s+"cross-section",type:sap.m.ButtonType.Transparent,tooltip:"Cross Section",press:function(U){var W=i._getViewport();if(W){if(this.getPressed()){z(W);}else if(i._crossSectionTool){i._crossSectionTool.setActive(false,W);}}}});p.vitId=l.CrossSection;y=new M({type:sap.m.ButtonType.Transparent,tooltip:"Cross Section Axis",icon:s+"cross-section-x",menu:new f({items:[new g({icon:s+"cross-section-x",text:"X",press:function(U){var W=i._getViewport();if(W){z(W,0,false);}}}),new g({icon:s+"cross-section-y",text:"Y",press:function(U){var W=i._getViewport();if(W){z(W,1,false);}}}),new g({icon:s+"cross-section-z",text:"Z",press:function(U){var W=i._getViewport();if(W){z(W,2,false);}}}),new g({icon:s+"reverse-direction",text:"Flip",startsSection:true,press:function(U){var W=i._getViewport();if(W&&i._crossSectionTool&&i._crossSectionTool.getActive()){i._crossSectionTool.setFlip(!i._crossSectionTool.getFlip());}}})]})});y.vitId=l.CrossSectionAxis;var A=new a({icon:s+"turntable",type:sap.m.ButtonType.Transparent,tooltip:"Turntable",press:function(U){var W=i._getViewport();if(W){i._activateGesture(W,0);}}});A.vitId=l.Turntable;var E=new a({icon:s+"orbit",type:sap.m.ButtonType.Transparent,tooltip:"Orbit",pressed:false,press:function(U){var W=i._getViewport();if(W){i._activateGesture(W,1);}}});E.vitId=l.Orbit;var G=new a({icon:s+"pan",type:sap.m.ButtonType.Transparent,tooltip:"Pan",press:function(U){var W=i._getViewport();if(W){i._activateGesture(W,2);}}});G.vitId=l.Pan;var H=new a({icon:s+"zoom",type:sap.m.ButtonType.Transparent,tooltip:"Zoom",press:function(){var U=i._getViewport();if(U){i._activateGesture(U,3);}}});H.vitId=l.Zoom;this._gestureButtons=[A,E,G,H];var J=new B({icon:s+"show",type:sap.m.ButtonType.Transparent,tooltip:"Show",press:function(){var U=i._getViewport();if(U){var W=U._viewStateManager;var X=[];W.enumerateSelection(function(Y){X.push(Y);});W.setVisibilityState(X,true,true);}}});J.vitId=l.Show;var K=new B({icon:s+"hide",type:sap.m.ButtonType.Transparent,tooltip:"Hide",press:function(){var U=i._getViewport();if(U){var W=U._viewStateManager;var X=[];W.enumerateSelection(function(Y){X.push(Y);});W.setVisibilityState(X,false,true);}}});K.vitId=l.Hide;var L=new B({icon:s+"fit-to-view",type:sap.m.ButtonType.Transparent,tooltip:"Fit to View",press:function(){var U=i._getViewport();if(U){U.zoomTo(Z.All,null,0.5,0);}}});L.vitId=l.FitToView;var N=new a({icon:s+"rectangular-selection",type:sap.m.ButtonType.Transparent,tooltip:"Rectangular Selection",press:function(U){var W=i._getViewport();if(W&&i._rectSelectTool){i._rectSelectTool.setActive(this.getPressed(),W);}}});N.vitId=l.RectangularSelection;var P=new M({icon:s+"predefined-views",activeIcon:s+"predefined-views",type:sap.m.ButtonType.Transparent,tooltip:h().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new f({items:[new g({text:h().getText("PREDEFINED_VIEW_INITIAL")}),new g({text:h().getText("PREDEFINED_VIEW_FRONT"),startsSection:true}),new g({text:h().getText("PREDEFINED_VIEW_BACK")}),new g({text:h().getText("PREDEFINED_VIEW_LEFT")}),new g({text:h().getText("PREDEFINED_VIEW_RIGHT")}),new g({text:h().getText("PREDEFINED_VIEW_TOP")}),new g({text:h().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(U){var W=i._getViewport();if(W){var X=U.getParameters("item").item;var Y=this.indexOfItem(X);W._viewportGestureHandler.setView(u[Y],1000);}})});P.vitId=l.PredefinedViews;var Q=new a({icon:s+"full-screen",type:sap.m.ButtonType.Transparent,tooltip:h().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:function(U){var W=i._getViewport();var X=function($){return!!($.fullScreen||$.webkitIsFullScreen||$.mozFullScreen||$.msFullscreenElement);};if(this.getPressed()){if(!X(document)){if(!i._fullScreenHandler){i._fullScreenHandler=function(U){var $=X(document);if(!$){document.removeEventListener("fullscreenchange",i._fullScreenHandler);document.removeEventListener("mozfullscreenchange",i._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",i._fullScreenHandler);document.removeEventListener("MSFullscreenChange",i._fullScreenHandler);this.setPressed(false);W.removeStyleClass("sapVizKitViewerFullScreen");}}.bind(this);}var Y=document.getElementsByTagName("body")[0];if(Y.requestFullscreen){document.addEventListener("fullscreenchange",i._fullScreenHandler);Y.requestFullscreen();}else if(Y.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",i._fullScreenHandler);Y.webkitRequestFullscreen();}else if(Y.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",i._fullScreenHandler);Y.mozRequestFullScreen();}else if(Y.msRequestFullscreen){document.addEventListener("MSFullscreenChange",i._fullScreenHandler);Y.msRequestFullscreen();}}W.addStyleClass("sapVizKitViewerFullScreen");}else{if(X(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}}W.removeStyleClass("sapVizKitViewerFullScreen");}}});Q.vitId=l.FullScreen;var S=[J,K,new T(),this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],new T(),L,new T(),N,new T(),p,y,new T(),P,new T(),Q];return S;};
var w=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"];var x=function(i,p){this.viewport=i;this._toolbar=p;this._mode=1;this._gesture=false;this._x=0;this._y=0;};
x.prototype.beginGesture=function(i){this._gesture=true;if(this._mode<3){this._x=i.points[0].x;this._y=i.points[0].y;}else{this._x=i.x;this._y=i.y;}if(i.event&&(sap.ui.Device.os.macintosh?i.event.metaKey:i.event.ctrlKey)&&this._toolbar._rectSelectTool){var p=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect={x1:this._x-p.left,y1:this._y-p.top,x2:this._x-p.left,y2:this._x-p.top};}};
x.prototype.endGesture=function(){this._gesture=false;if(this._selectionRect){this._toolbar._rectSelectTool._select(this._selectionRect.x1,this._selectionRect.y1,this._selectionRect.x2,this._selectionRect.y2,this.viewport,this.viewport.getScene(),this.viewport.getCamera());this._selectionRect=null;this.viewport.setSelectionRect(null);}else{this.viewport.removeStyleClass(w[this._mode]);}};
x.prototype.move=function(i){if(this._gesture&&i.n==1){var p=i.points[0];if(this._selectionRect){var y=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect.x2=p.x-y.left;this._selectionRect.y2=p.y-y.top;this.viewport.setSelectionRect(this._selectionRect);}else{this.viewport.addStyleClass(w[this._mode]);var z=p.x-this._x;var A=p.y-this._y;var E=this.viewport._viewportGestureHandler._cameraController;switch(this._mode){case 0:E.rotate(z,A,true);break;case 1:E.rotate(z,A,false);break;case 2:E.pan(z,A);break;case 3:E.zoom(1+A*0.005);break;default:break;}this._x=p.x;this._y=p.y;}i.handled=true;}};
x.prototype.hover=function(){};
x.prototype.getViewport=function(){return this.viewport;};
n.prototype._activateGesture=function(i,p){this._gestureButtons.forEach(function(y,z){y.setPressed(z===p);});if(!this._cameraHandler||this._cameraHandler.getViewport()!=i){this._cameraHandler=new x(i,this);i._loco.addHandler(this._cameraHandler,0);}this._cameraHandler._mode=p;};
n.prototype._getToolbar=function(){return this._toolbar;};
n.prototype._toggleExpanded=function(){var i=!this.getExpanded();this.setExpanded(i);this.fireExpanded({expand:i});};
n.prototype.setExpanded=function(E){this.setProperty("expanded",E,true);var i=this.getDomRef();if(i){if(!E){i.classList.add("drawerToolbarCollapsed");i.classList.remove("drawerToolbarExpanded");this._container.addStyleClass("vboxCollapsed");}else{i.classList.add("drawerToolbarExpanded");i.classList.remove("drawerToolbarCollapsed");this._container.removeStyleClass("vboxCollapsed");}}return this;};
n.prototype.onAfterRendering=function(){var i=this._getViewport();if(i){this._activateGesture(i,1);if(!this._crossSectionTool){this._crossSectionTool=new e();i.addTool(this._crossSectionTool);}if(!this._rectSelectTool){this._rectSelectTool=new d();}}};
return n;});
sap.ui.predefine('sap/ui/vk/DrawerToolbarRenderer',[],function(){"use strict";var D={};
D.render=function(r,d){r.write("<div ");r.writeControlData(d);r.addClass("drawerToolbar");if(!d.getExpanded()){r.addClass("drawerToolbarCollapsed");}else{r.addClass("drawerToolbarExpanded");}r.writeClasses();r.write(">");r.renderControl(d._container);r.write("</div>");};
return D;},true);
sap.ui.predefine('sap/ui/vk/DvlException',["sap/ui/base/Exception"],function(E){"use strict";var D=function(c,m){this.name="DvlException";this.code=c;this.message=m;};D.prototype=Object.create(E.prototype);return D;});
sap.ui.predefine('sap/ui/vk/FlexibleControl',["./library","sap/ui/core/Control","sap/ui/core/EnabledPropagator","./FlexibleControlRenderer"],function(v,C,E,F){"use strict";
var a=C.extend("sap.ui.vk.FlexibleControl",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},layout:{type:"string",group:"Behavior",defaultValue:"Stacked"},enabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},designTime:true}});
E.call(a.prototype);return a;});
sap.ui.predefine('sap/ui/vk/FlexibleControlLayoutData',["sap/ui/core/LayoutData"],function(L){"use strict";
var F=L.extend("sap.ui.vk.FlexibleControlLayoutData",{metadata:{library:"sap.ui.vk",properties:{size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},minSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginTop:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginBottom:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"}}}});
return F;});
sap.ui.predefine('sap/ui/vk/FlexibleControlRenderer',[],function(){"use strict";var F={};
F.render=function(r,f){var a=r;a.write("<div");a.writeControlData(f);a.addClass("sapUiFlexControl");if(f.getWidth()&&f.getWidth()!=""){a.addStyle("width",f.getWidth());}if(f.getHeight()&&f.getHeight()!=""){a.addStyle("height",f.getHeight());}a.writeStyles();a.writeClasses();a.write(">");var c=f.getContent();var l=f.getLayout();var b="sapUiFlexCellStacked";if(l=="Vertical"){b="sapUiFlexCellVertical";}for(var i=0;i<c.length;i++){var d=c[i];a.write("<div id=\""+f.getId()+"Content_"+i+"\" class=\""+b+"\"");var e=d.getLayoutData();if(e&&l!="Stacked"){a.write(" style=\"");if(e.getSize()&&e.getSize()!=""){a.write("height: "+e.getSize()+";");}if(e.getMinSize()&&e.getMinSize()!=""){a.write("min-height: "+e.getMinSize()+";");}if(e.getMarginTop()&&e.getMarginTop()!=""){a.write("margin-top: "+e.getMarginTop()+";");}if(e.getMarginBottom()&&e.getMarginBottom()!=""){a.write("margin-bottom: "+e.getMarginBottom()+";");}a.write("\"");}a.write(">");a.renderControl(d);a.write("</div>");}a.write("</div>");};
return F;},true);
sap.ui.predefine('sap/ui/vk/Highlight',["sap/ui/base/Object"],function(B){"use strict";
var H=B.extend("sap.ui.vk.Highlight",{constructor:function(i,p){this._id=i;this._name=p&&p.name?p.name:"";this._duration=p&&p.duration?p.duration:0.0;this._cycles=p&&p.cycles?p.cycles:0;this._colours=p&&p.colours?p.colours:[];this._opacities=p&&p.opacities?p.opacities:[];this._fadeOut=p&&p.fadeOut?p.fadeOut:false;this._reset();}});
H.prototype.getId=function(){return this._id;};
H.prototype.getName=function(){return this._name;};
H.prototype.setName=function(n){this._name=n;return this;};
H.prototype.getDuration=function(){return this._duration;};
H.prototype.setDuration=function(d){this._duration=d;this._reset();return this;};
H.prototype.getCycles=function(){return this._cycles;};
H.prototype.setCycles=function(c){this._cycles=c;this._reset();return this;};
H.prototype.getOpacities=function(){return this._opacities;};
H.prototype.setOpacities=function(o){this._opacities=o;this._reset();return this;};
H.prototype.getColours=function(){return this._colours;};
H.prototype.setColours=function(c){this._colours=c;this._reset();return this;};
H.prototype._reset=function(){var k,o,t;var n=false;if(this._opacities&&this._opacities.length){for(var i=0;i<this._opacities.length;i++){if(this._opacities[i]<0.999){n=true;break;}}}if(n){if(Math.abs(this._duration-0.0)<0.000000001||this._opacities.length===1){this._adjustedOpacities=[this._opacities[0]];this._opacityTimes=[0.0];}else if(this._cycles>0){t=this._duration/this._opacities.length;this._adjustedOpacities=[];this._opacityTimes=[];for(k=0;k<this._cycles;k++){for(o=0;o<this._opacities.length;o++){this._adjustedOpacities.push(this._opacities[o]);this._opacityTimes.push(t*(k*this._opacities.length+o));}}}else{t=this._duration/this._opacities.length;this._adjustedOpacities=[];this._opacityTimes=[];for(o=0;o<this._opacities.length;o++){this._adjustedOpacities.push(this._opacities[o]);this._opacityTimes.push(t*o);}this._adjustedOpacities.push(this._opacities[0]);this._opacityTimes.push(t*this._opacities.length);}}else{this._adjustedOpacities=[];this._opacityTimes=[];}var a=true;if(this._colours&&this._colours.length){for(var j=0;j<this._colours.length;j++){if(this._colours[j][3]<0){a=false;break;}}}else{a=false;}if(a){if(this._cycles===0&&this._duration>0.0){if(this._colours.length===1){this._colours.push([0,0,0,0]);}}if(Math.abs(this._duration-0.0)<0.000000001||this._colours.length===1){this._adjustedColours=[this._colours[0]];this._colourTimes=[0.0];}else if(this._cycles>0){t=this._duration/this._colours.length;this._adjustedColours=[];this._colourTimes=[];for(k=0;k<this._cycles;k++){for(o=0;o<this._colours.length;o++){this._adjustedColours.push(this._colours[o]);this._colourTimes.push(t*(k*this._colours.length+o));}}}else{t=this._duration/this._colours.length;this._adjustedColours=[];this._colourTimes=[];for(o=0;o<this._colours.length;o++){this._adjustedColours.push(this._colours[o]);this._colourTimes.push(t*o);}this._adjustedColours.push(this._colours[0]);this._colourTimes.push(t*this._colours.length);}}else{this._adjustedColours=[];this._colourTimes=[];}};
H.prototype.getOpacity=function(t){var r={};if(!this._adjustedOpacities||!this._adjustedOpacities.length){return r;}if(this._adjustedOpacities.length===1){r.opacity=this._adjustedOpacities[0];r.isCompleted=true;return r;}var d=this._opacityTimes[this._opacityTimes.length-1];var c=t;if(this._cycles===0){while(c>d){c-=d;}}if(c>=d){if(this._cycles>0){r.isCompleted=true;r.opacity=undefined;}else{r.isCompleted=false;r.opacity=this._adjustedOpacities[this._adjustedOpacities.length-1];}return r;}var a=this._opacityTimes[1]-this._opacityTimes[0];var b=c/a;var i=Math.floor(b);var e=b-i;r.opacity=this._adjustedOpacities[i]*(1-e)+this._adjustedOpacities[i+1]*e;r.isCompleted=false;return r;};
H.prototype.getColour=function(t){var c={};if(!this._adjustedColours||!this._adjustedColours.length){return c;}if(this._adjustedColours.length===1){c.colour=this._adjustedColours[0];c.isCompleted=true;return c;}var d=this._colourTimes[this._colourTimes.length-1];var e=t;if(this._cycles===0){while(e>d){e-=d;}}if(e>=d){if(this._cycles>0){c.isCompleted=true;c.colour=undefined;}else{c.isCompleted=false;c.colour=this._adjustedColours[this._adjustedColours.length-1];}return c;}var f=this._colourTimes[1]-this._colourTimes[0];var h=e/f;var i=Math.floor(h);var j=h-i;var r=this._adjustedColours[i][0]*(1-j)+this._adjustedColours[i+1][0]*j;var g=this._adjustedColours[i][1]*(1-j)+this._adjustedColours[i+1][1]*j;var b=this._adjustedColours[i][2]*(1-j)+this._adjustedColours[i+1][2]*j;var a=this._adjustedColours[i][3]*(1-j)+this._adjustedColours[i+1][3]*j;c.colour=[r,g,b,a];c.isCompleted=false;return c;};
H.prototype.getLastOpacity=function(){var r;if(this._opacities&&this._opacities.length>0){r=this._opacities[this._opacities.length-1];}return r;};
H.prototype.isFadeOut=function(){return this._fadeOut;};
return H;});
sap.ui.predefine('sap/ui/vk/ImageContentManager',["jquery.sap.global","./Messages","./ContentManager","./getResourceBundle"],function(q,M,C,g){"use strict";
var I=C.extend("sap.ui.vk.ImageContentManager",{metadata:{library:"sap.ui.vk"}});
var b=I.getMetadata().getParent().getClass().prototype;
I.prototype.init=function(){if(b.init){b.init.call(this);}this._handleLoadSucceededProxy=this._handleLoadSucceeded.bind(this);this._handleLoadFailedProxy=this._handleLoadFailed.bind(this);};
I.prototype.exit=function(){if(b.exit){b.exit.call(this);}};
I.prototype.loadContent=function(c,a){if(a.length!==1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_ONLY_LOAD_SINGLE_IMAGE")}});});}else if(a[0].getContentResources().length>0){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_CANNOT_LOAD_IMAGE_HIERARCHY")}});});}else{var d=a[0],s=d.getSource(),e=d.getSourceType(),l=null;if(d._contentManagerResolver&&d._contentManagerResolver.settings&&d._contentManagerResolver.settings.loader){l=d._contentManagerResolver.settings.loader;}if(s instanceof File){var f=new FileReader();f.onload=function(h){this._loadImageFromUrl(c,f.result,e,l);}.bind(this);f.readAsDataURL(s);}else{var t=new sap.m.Image({src:s});s=t.getSrc();t.destroy();this._loadImageFromUrl(c,s,e,l);}}};
I.prototype._addEventListeners=function(h){h.addEventListener("load",this._handleLoadSucceededProxy);h.addEventListener("error",this._handleLoadFailedProxy);};
I.prototype._removeEventListeners=function(h){h.removeEventListener("error",this._handleLoadFailedProxy);h.removeEventListener("load",this._handleLoadSucceededProxy);};
I.prototype._addSvgQuirks=function(h){h.style.setProperty("visibility","collapse");h.style.setProperty("width","0");h.style.setProperty("height","0");h.style.setProperty("position","absolute");document.body.appendChild(h);return this;};
I.prototype._removeSvgQuirks=function(h){h.parentElement.removeChild(h);h.style.removeProperty("visibility");h.style.removeProperty("width");h.style.removeProperty("height");h.style.removeProperty("position");return this;};
I.prototype._loadImageFromUrl=function(c,u,s,l){this.fireContentChangesStarted();switch(s.toLowerCase()){case"svg":var a=document.createElement("object");this._addEventListeners(a);a.type="image/svg+xml";a.data=u;a.className="SVGImage";this._addSvgQuirks(a);break;case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"tif":case"tiff":var i=document.createElement("img");this._addEventListeners(i);if(l){var t=this;l(u).then(function(r){i.src=r;},function(e){t.fireContentChangesFinished({content:null,failureReason:{errorMessage:e}});});}else{i.src=u;}break;default:q.sap.delayedCall(0,this,function(){this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_UNSUPPORTED_IMAGE_TYPE"),sourcesFailedToDownload:[{source:u}]}});});break;}};
I.prototype._handleLoadSucceeded=function(e){var c=e.target;this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:c});};
I.prototype._handleLoadFailed=function(e){var c=e.target;this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:null,failureReason:{errorMessage:g().getText("IMAGECONTENTMANAGER_IMAGE_LOAD_FAILED"),sourcesFailedToDownload:[{source:c instanceof HTMLImageElement?c.src:c.data}]}});};
return I;});
sap.ui.predefine('sap/ui/vk/JointUtils',["./thirdparty/gl-matrix"],function(g){"use strict";var m=g.mat4;var A=g.glMatrix.ARRAY_TYPE;var J={recalculateJoints:function(j,n,t){var w;if(t.length===16){w=t;}else{w=new A(16);m.fromRotationTranslationScale(w,t.quaternion||[0,0,0,1],t.translation||[0,0,0],t.scale||[1,1,1]);}var i=new A(16);m.invert(i,w);var a=new A(16);var b=[];j.forEach(function(c){if(!c.node||!c.parent){return;}if(c.parent===n){m.multiply(a,i,c.node.matrixWorld.elements);}else if(c.node===n){m.invert(a,c.parent.matrixWorld.elements);m.multiply(a,a,w);}else{return;}m.getTranslation(c.translation,a);m.getScaling(c.scale,a);m.scale(a,a,[1/c.scale[0],1/c.scale[1],1/c.scale[2]]);m.getRotation(c.quaternion,a);b.push(c);});return b;}};return J;});
sap.ui.predefine('sap/ui/vk/LayerProxy',["sap/ui/base/Object"],function(B){"use strict";
var L=B.extend("sap.ui.vk.LayerProxy",{metadata:{"abstract":true}});
return L;});
sap.ui.predefine('sap/ui/vk/LeaderLineMarkStyle',[],function(){"use strict";var L={None:"None",Point:"Point",Arrow:"Arrow"};return L;},true);
sap.ui.predefine('sap/ui/vk/Loco',["sap/ui/base/EventProvider"],function(E){"use strict";
var L=E.extend("sap.ui.vk.Loco",{
metadata:{publicMethods:["addHandler","removeHandler"]},
constructor:function(v){if(L._instance&&this.viewport===v){return L._instance;}E.apply(this);this._handlers=[];this._gesture=false;this._n=0;this._touchStart=0;this._touchOrigin={x:0,y:0};this._touchMoved=false;this._clickTimer=0;if(v){this.attachViewportEventHandlers(v);}L._instance=this;}
});
L.prototype.destroy=function(){};
function e(a){var p=[];var b={points:p,buttons:a.buttons||0,handled:false,event:a,timeStamp:a.timeStamp,scroll:a.wheelDelta};if(a.touches&&a.touches.length>0){for(var i=0;i<a.touches.length;i++){var t=a.touches[i];p.push({x:t.pageX,y:t.pageY});}}else if(a.pageX!==undefined){p.push({x:a.pageX,y:a.pageY});}else{p.push({x:a.originalEvent.pageX,y:a.originalEvent.pageY});}if((a.buttons&2)&&p.length===1){p.push(p[0]);}b.n=p.length;if(b.n===2){var d=p[0].x-p[1].x,c=p[0].y-p[1].y;b.x=(p[0].x+p[1].x)*0.5;b.y=(p[0].y+p[1].y)*0.5;b.d=Math.sqrt(d*d+c*c);}else{b.x=p[0].x;b.y=p[0].y;b.d=0;}return b;}
L.prototype.attachViewportEventHandlers=function(v){this.viewport=v;v.ontouchstart=function(a){if(!a.isMarked()){var i=e(a);if(this._gesture){this._endGesture(i);i.handled=false;}this._beginGesture(i);}}.bind(this);v.ontouchend=function(a){var i=e(a);this._endGesture(i);if(a.touches.length>0){i.handled=false;this._beginGesture(i);}}.bind(this);if(sap.ui.Device.support.touch){v.attachBrowserEvent("touchmove",function(a){this._move(e(a));}.bind(this));}v.attachBrowserEvent("mousemove",function(a){this._move(e(a));}.bind(this));v.ontap=function(a){if(!a.isMarked()&&!this._touchMoved){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._click(e(a),true);}else{this._clickTimer=setTimeout(function(l){l._click(e(a),false);},250,this);}}}.bind(this);v.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",function(a){if(!a.isMarked()){var o=a.originalEvent;var i={x:o.pageX,y:o.pageY,d:0,buttons:a.buttons,scroll:o.detail?o.detail*(-40):o.wheelDelta,n:2,points:[{x:o.pageX,y:o.pageY},{x:o.pageX,y:o.pageY}],handled:false};this._beginGesture(i);i.points[0].y-=i.scroll*0.2;i.points[1].y+=i.scroll*0.2;i.d=Math.abs(i.scroll)*0.4;i.handled=false;this._move(i);i.handled=false;this._endGesture(i);if(i.handled){a.setMarked();a.preventDefault();}}},this);v.oncontextmenu=function(a){var i=e(a);this._contextMenu(i);}.bind(this);v.attachBrowserEvent("keyup",function(a){this._keyEventHandler(a);},this);};
L.prototype.addHandler=function(h,p){if(!this.viewport){this.attachViewportEventHandlers(h.getViewport());}h.priority=p|0;if(this._handlers.indexOf(h)===-1){this._handlers.push(h);}this._handlers.sort(function(a,b){return a.priority-b.priority;});};
L.prototype.removeHandler=function(h){var i=this._handlers.indexOf(h);if(i>=0){this._handlers.splice(i,1);}};
L.prototype._handleInput=function(h,a){for(var i=this._handlers.length-1;i>=0&&!a.handled;i--){if(this._handlers[i][h]){this._handlers[i][h](a);}}if(a.handled&&a.event){a.event.preventDefault();}};
L.prototype._beginGesture=function(i){this._handleInput("beginGesture",i);this._touchStart=i.timeStamp;this._touchMoved=false;this._gesture=true;this._touchOrigin.x=i.x;this._touchOrigin.y=i.y;this._n=i.n;};
L.prototype._move=function(i){if(this._gesture&&this._n===i.n){if(!this._touchMoved){this._touchMoved=(i.timeStamp-this._touchStart>200)&&(Math.abs(this._touchOrigin.x-i.x)>3||Math.abs(this._touchOrigin.y-i.y)>3);}this._handleInput("move",i);}else{this._handleInput("hover",i);}};
L.prototype._endGesture=function(i){if(!this._gesture){return;}this._handleInput("endGesture",i);this._gesture=false;};
L.prototype._click=function(i,a){this._clickTimer=0;this._handleInput(a?"doubleClick":"click",i);};
L.prototype._contextMenu=function(i){this._handleInput("contextMenu",i);};
L.prototype._keyEventHandler=function(a){this._handleInput("keyEventHandler",a);};
return L;});
sap.ui.predefine('sap/ui/vk/MapContainerButtonType',[],function(){"use strict";var M={Click:"Click",Toggle:"Toggle"};return M;},true);
sap.ui.predefine('sap/ui/vk/Material',["sap/ui/base/ManagedObject"],function(M){"use strict";
var a=M.extend("sap.ui.vk.Material",{metadata:{properties:{"id":{type:"string"},"name":{type:"string"},"ambientColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"diffuseColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"specularColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"emissiveColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"opacity":{type:"float",defaultValue:1.0},"glossiness":{type:"float",defaultValue:0.0},"lineColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"lineWidth":{type:"float",defaultValue:0.0},"textureDiffuse":{type:"sap.ui.vk.Texture",defaultValue:null},"textureBump":{type:"sap.ui.vk.Texture",defaultValue:null},"textureOpacity":{type:"sap.ui.vk.Texture",defaultValue:null},"textureReflection":{type:"sap.ui.vk.Texture",defaultValue:null},"textureEmissive":{type:"sap.ui.vk.Texture",defaultValue:null},"textureAmbientOcclusion":{type:"sap.ui.vk.Texture",defaultValue:null}}}});
a.prototype.getMaterialRef=function(){return null;};
return a;});
sap.ui.predefine('sap/ui/vk/Messages',[],function(){"use strict";var M={VIT1:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT1"},VIT2:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT2"},VIT3:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT3"},VIT4:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT4"},VIT5:{summary:"DOWNLOADMANAGER_MSG_NOTBELOADED_SUMMARY",cause:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CAUSE",resolution:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CHECKSOURCEISURLORFILE_RESOLUTION",code:"VIT5"},VIT6:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_SPECIFYVALUEPROPERTY_RESOLUTION",code:"VIT6"},VIT7:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_SPECIFYPREDICATE_RESOLUTION",code:"VIT7"},VIT8:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT8"},VIT9:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT9"},VIT10:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_SPECIFYMETADATACATEGORY_RESOLUTION",code:"VIT10"},VIT11:{summary:"OVERLAY_MSG_EVENTHANDLERFAILED_SUMMARY",cause:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CAUSE",resolution:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CHECKEVENTTYPE_RESOLUTION",code:"VIT11"},VIT12:{summary:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_SUMMARY",cause:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CAUSE",resolution:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CHECKSTEPEVENTTYPEVALUE_RESOLUTION",code:"VIT12"},VIT13:{summary:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_SUMMARY",cause:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CAUSE",resolution:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CHECKFILEEXISTSANDIFSUPPORT_RESOLUTION",code:"VIT13"},VIT14:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_RELOADORSELECTANOTHERFILE_RESOLUTION",code:"VIT14"},VIT15:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_LOADONE2D_RESOLUTION",code:"VIT15"},VIT16:{summary:"VIEWER_MSG_NOTBELOADED_SUMMARY",cause:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CAUSE",resolution:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CHECKFILEFORMATSUPPORT_RESOLUTION",code:"VIT16"},VIT17:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_MULTIPLESUPPORTFOR3DONLY_RESOLUTION",code:"VIT17"},VIT18:{summary:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_SUMMARY",cause:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_CAUSE",resolution:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_ONEINSTANCEOFVIEWPORTSUPPORTED_RESOLUTION",code:"VIT18"},VIT19:{summary:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SUMMARY",cause:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CAUSE",resolution:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CHECKPROJECTIONTYPESUPPORTED_RESOLUTION",code:"VIT19"},VIT20:{summary:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_SUMMARY",cause:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_CAUSE",resolution:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_RESOLUTION",code:"VIT20"},VIT21:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_PROVIDEPASSWORD_RESOLUTION",code:"VIT21"},VIT22:{summary:"GRAPHICSCORE_MSG_VDSL_NOFILEPROPERTY_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_EMPTY_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT22"},VIT23:{summary:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT23"},VIT24:{summary:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_RESOLUTION",code:"VIT24"},VIT25:{summary:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_SUMMARY",cause:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_CAUSE",resolution:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_RESOLUTION",code:"VIT25"},VIT26:{summary:"VIEWPORT_UNSUPPORTED_STEP_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_STEP_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_STEP_INDEX_RESOLUTION",code:"VIT26"},VIT27:{summary:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_RESOLUTION",code:"VIT27"},VIT28:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_RESOLUTION",code:"VIT28"},VIT29:{summary:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_RESOLUTION",code:"VIT29"},VIT30:{summary:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_RESOLUTION",code:"VIT30"},VIT31:{summary:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_RESOLUTION",code:"VIT31"},VIT32:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_RESOLUTION",code:"VIT32"},VIT33:{summary:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_RESOLUTION",code:"VIT33"},VIT34:{summary:"VIEWER_SOURCE_FAILED_TO_LOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_LOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_LOAD_RESOLUTION",code:"VIT34"},VIT35:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_MULTIPLESUPPORTFORSAMECONTENTMANAGER_RESOLUTION",code:"VIT35"},VIT36:{summary:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_SUMMARY",cause:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE",resolution:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_RESOLUTION",code:"VIT36"},VIT37:{summary:"VIEWER_MSG_FAILEDTOLOADCONTENT_SUMMARY",cause:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_CAUSE",resolution:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_RESOLUTION",code:"VIT37"}};return M;},true);
sap.ui.predefine('sap/ui/vk/NativeViewportRenderer',[],function(){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNativeViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.write(">");r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/NodeContentType',[],function(){"use strict";var N={Regular:"Regular",Reference:"Reference",Annotation:"Annotation"};return N;},true);
sap.ui.predefine('sap/ui/vk/NodeHierarchy',["jquery.sap.global","sap/ui/base/ManagedObject","./Messages","./getResourceBundle"],function(q,M,a,g){"use strict";
var N=M.extend("sap.ui.vk.NodeHierarchy",{metadata:{"abstract":true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});
N.prototype.findNodesById=function(b){if(b.fields.some(function(h){return!h.caseSensitive;})){b=q.extend(true,{},b);b.fields.forEach(function(h){if(!h.caseSensitive){h.value=h.value.toLowerCase();}});}var c=function(p,h,v,j){var m;p=p||"equals";j=j||"";var k=h?v:v.toLowerCase();switch(p){case"equals":m=(k===j);break;case"contains":m=(k.indexOf(j)!==-1);break;case"startsWith":m=(k.indexOf(j)===0);break;default:m=false;q.sap.log.error(g().getText(a.VIT8.summary),a.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}return m;};var i=function(l,h){return!l.some(function(v){return h.name===v.name?c(h.predicate,h.caseSensitive,v.value,h.value):false;});};var f=function(b,v){return b.source===v.source&&b.type===v.type&&!b.fields.some(i.bind(undefined,v.fields));};var d=this.findNodesByName();var e=d.filter(function(n){var h=this.createNodeProxy(n);var v=h.getVeIds();this.destroyNodeProxy(h);return v.some(f.bind(undefined,b));}.bind(this));return e;};
N.prototype.findNodesByMetadata=function(b){var c=function(m,k,l,v,i,j){if(m.hasOwnProperty(k)){var n=m[k];if(n.hasOwnProperty(l)){var o=n[l];if(!j){o=o.toLowerCase();}return v.some(i.bind(undefined,o));}}return false;};var d=function(m,k){if(m==null){return false;}return m.hasOwnProperty(k);};var e=function(f,h,k,l,v,i,j){var n=this._baseNodeProxyPool.borrowObject();var r=f.filter(function(m){n.init(this,m);var o=n.getNodeMetadata();var s=h(o,k,l,v,i,j);n.reset();return s;}.bind(this));this._baseNodeProxyPool.returnObject(n);return r;};var f=this.findNodesByName(),r=[];if(b===undefined||b===null||q.isEmptyObject(b)){r=f;}else if(b.category!==null&&b.category!==undefined&&b.category!==""){var h,v,p,i,j=!!(b&&b.caseSensitive);if(b.key===undefined||b.key===null){h=d;}else{v=b.value;p=b.predicate||"equals";if(v===undefined||v===null){v="";p="contains";}if(!Array.isArray(v)){v=[v];}if(!j){v=v.map(function(k){return k.toLowerCase();});}switch(p){case"equals":i=function(m,k){return m===k;};break;case"contains":i=function(m,k){return m.indexOf(k)!==-1;};break;case"startsWith":i=function(m,k){return m.indexOf(k)===0;};break;default:q.sap.log.error(g().getText(a.VIT9.summary),a.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy");}h=c;}r=e.bind(this)(f,h,b.category,b.key,v,i,j);}else{q.sap.log.error(g().getText(a.VIT10.summary),a.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy");}return q.sap.unique(r);};
N.prototype._appendAncestors=function(n,s){s=s?new Set(s):null;var b=new Set(n);n.forEach(function(d){var e=this.getAncestors(d);e.forEach(function(f){if(s===null||!s.has(f)){b.add(f);}});},this);var c=[];b.forEach(function(d){c.push(d);});return c;};
return N;});
sap.ui.predefine('sap/ui/vk/NodeProxy',["sap/ui/base/ManagedObject"],function(M){"use strict";
var N=M.extend("sap.ui.vk.NodeProxy",{metadata:{properties:{nodeRef:"any",veIds:"object[]",name:"string",localMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},worldMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},material:{type:"sap.ui.vk.Material"},opacity:{type:"float",bindable:"bindable"},tintColorABGR:{type:"int",bindable:"bindable"},tintColor:{type:"sap.ui.core.CSSColor",bindable:"bindable"},nodeMetadata:"object",hasChildren:"boolean",closed:"boolean"}}});
N.prototype.setClosed=function(v){return this;};
N.prototype.setHasChildren=function(v){return this;};
N.prototype.setName=function(v){return this;};
N.prototype.setNodeId=function(v){return this;};
N.prototype.setNodeMetadata=function(v){return this;};
N.prototype.setVeIds=function(v){return this;};
N.prototype.assignMaterial=function(v){return this;};
N.prototype.getLocalTranslate=function(){return[0,0,0];};
N.prototype.getLocalScale=function(){return[1,1,1];};
N.prototype.getLocalRotationInQuaternion=function(){return[1,0,0,1];};
N.prototype.getLocalRotationInAngleAxis=function(){return[1,0,0,0];};
N.prototype.getLocalRotationInEuler=function(){return[0,0,0,0];};
return N;});
sap.ui.predefine('sap/ui/vk/NodeUtils',["./thirdparty/gl-matrix"],function(g){"use strict";var N={centerOfNodes:function(n,v){function u(c,t){var d=c.min.x;var e=c.min.y;var f=c.min.z;var h=c.max.x;var i=c.max.y;var j=c.max.z;var p=[];p.push(g.vec3.fromValues(d,e,f));p.push(g.vec3.fromValues(d,e,j));p.push(g.vec3.fromValues(d,i,f));p.push(g.vec3.fromValues(d,i,j));p.push(g.vec3.fromValues(h,e,f));p.push(g.vec3.fromValues(h,e,j));p.push(g.vec3.fromValues(h,i,f));p.push(g.vec3.fromValues(h,i,j));var k=Number.MAX_SAFE_INTEGER;var l=Number.MAX_SAFE_INTEGER;var o=Number.MAX_SAFE_INTEGER;var q=-Number.MAX_SAFE_INTEGER;var r=-Number.MAX_SAFE_INTEGER;var s=-Number.MAX_SAFE_INTEGER;var w=g.vec3.create();p.forEach(function(x){g.vec3.transformMat4(w,x,t);if(w[0]<k){k=w[0];}if(w[1]<l){l=w[1];}if(w[2]<o){o=w[2];}if(w[0]>q){q=w[0];}if(w[1]>r){r=w[1];}if(w[2]>s){s=w[2];}});return[k,l,o,q,r,s];}var m={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY};var a={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY};var b=false;n.forEach(function(c){c.traverse(function(d){var e=d.userData.boundingBox;if(!e&&d.geometry){e=d.geometry.boundingBox;}if(e){var f=u(e,d.matrixWorld.elements);a.x=Math.min(a.x,f[0]);a.y=Math.min(a.y,f[1]);a.z=Math.min(a.z,f[2]);m.x=Math.max(m.x,f[3]);m.y=Math.max(m.y,f[4]);m.z=Math.max(m.z,f[5]);b=true;}});});if(!b){return[0,0,0];}return[Math.abs(m.x-a.x)/2+a.x,Math.abs(m.y-a.y)/2+a.y,Math.abs(m.z-a.z)/2+a.z];}};return N;});
sap.ui.predefine('sap/ui/vk/NotificationsRenderer',[],function(){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNotifications");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_messagePopoverToggleButton"));r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/ObjectType',[],function(){"use strict";var O={PMI:0,Hotspot:1};return O;},true);
sap.ui.predefine('sap/ui/vk/OrthographicCamera',["./Camera"],function(C){"use strict";
var O=C.extend("sap.ui.vk.OrthographicCamera",{metadata:{properties:{"zoomFactor":{type:"float"}}}});
return O;});
sap.ui.predefine('sap/ui/vk/PerspectiveCamera',["./Camera"],function(C){"use strict";
var P=C.extend("sap.ui.vk.PerspectiveCamera",{metadata:{properties:{"fov":{type:"float"}}}});
return P;});
sap.ui.predefine('sap/ui/vk/ProgressIndicator',["jquery.sap.global","sap/m/ProgressIndicator","./ProgressIndicatorRenderer"],function(q,M,P){"use strict";
var a=M.extend("sap.ui.vk.ProgressIndicator");
a.prototype.setPercentValue=function(p){var i=function i(v){return(typeof(v)==="number")&&!isNaN(v)&&v>=0&&v<=100;};var t=this,$,f,b=this.$(),A,u=false;if(!i(p)){p=0;q.sap.log.warning(this+": percentValue ("+p+") is not correct! Setting the default percentValue:0.");}if(this.getPercentValue()!==p){f=this.getPercentValue()-p;this.setProperty("percentValue",p,true);if(!b.length){return this;}["sapMPIValueMax","sapMPIValueMin","sapMPIValueNormal","sapMPIValueGreaterHalf"].forEach(function(c){b.removeClass(c);});b.addClass(this._getCSSClassByPercentValue(p));b.addClass("sapMPIAnimate").attr("aria-valuenow",p).attr("aria-valuetext",this._getAriaValueText({fPercent:p}));A=u?Math.abs(f)*20:0;$=this.$("bar");$.animate({"flex-basis":p+"%"},A,"linear",function(){t._setText.apply(t);t.$().removeClass("sapMPIAnimate");});}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/ProgressIndicatorRenderer',["sap/m/ProgressIndicatorRenderer"],function(P){"use strict";return P;},true);
sap.ui.predefine('sap/ui/vk/Redline',[],function(){"use strict";var R={ElementType:{Line:"line",Rectangle:"rectangle",Ellipse:"ellipse",Freehand:"freehand",Text:"text"},svgNamespace:"http://www.w3.org/2000/svg"};return R;},true);
sap.ui.predefine('sap/ui/vk/RedlineDesign',["sap/ui/core/Control","./RedlineSurface","./RedlineElement","./RedlineGesturesHandler","./RedlineDesignHandler","./Loco","./RedlineDesignRenderer"],function(C,R,a,b,c,L,d){"use strict";
var e=R.extend("sap.ui.vk.RedlineDesign",{metadata:{library:"sap.ui.vk",events:{elementCreated:{parameters:{element:"object"}}},aggregations:{activeElementInstance:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});
e.prototype.init=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this._gestureHandler=new b(this);this._designHandler=new c(this);this._loco=new L(this);};
e.prototype.onBeforeRendering=function(){if(this._loco){this._loco.removeHandler(this._gestureHandler);this._loco.removeHandler(this._designHandler);}};
e.prototype.onAfterRendering=function(){var f=this.getDomRef();f.style.width="100%";f.style.height="100%";if(this._isAddingModeActive){this._loco.addHandler(this._designHandler);}else{this._loco.addHandler(this._gestureHandler);}this.updatePanningRatio();};
e.prototype.startAdding=function(f){this._isAddingModeActive=true;this._activeElementInstance=f;this.setAggregation("activeElementInstance",this._activeElementInstance);this.addStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");return this;};
e.prototype.stopAdding=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this.setAggregation("activeElementInstance",null);this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this.removeStyleClass("sapUiVizkitRedlineDesignMode");return this;};
e.prototype._getOffset=function(o){var r=o.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
e.prototype._getTargetViewport=function(){return this._targetViewport;};
e.prototype._setTargetViewport=function(v){this._targetViewport=v;this._targetViewport.attachEvent("resize",this,this._onresize,this);};
e.prototype._onresize=function(f){var v=f.oSource.getOutputSize();this.setProperty("virtualLeft",v.left,true);this.setProperty("virtualTop",v.top,true);this.setProperty("virtualSideLength",v.sideLength,true);this.invalidate();};
return e;});
sap.ui.predefine('sap/ui/vk/RedlineDesignHandler',["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(E,R){"use strict";
var a=E.extend("sap.ui.vk.RedlineDesignHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._gesture=false;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)&&v._activeElementInstance){this._gesture=true;this._x=e.x;this._y=e.y;v._isDrawingOn=true;var d=v.getDomRef();var t=v._toVirtualSpace(e.x-d.getBoundingClientRect().left-window.pageXOffset,e.y-d.getBoundingClientRect().top-window.pageYOffset);v._activeElementInstance.setOriginX(t.x);v._activeElementInstance.setOriginY(t.y);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){v.invalidate();}else{var r=sap.ui.getCore().createRenderManager();v._activeElementInstance.render(r);r.flush(v.getDomRef(),false,true);r.destroy();var x=v.$();x.html(x.html());}e.handled=true;}return this;};
a.prototype.move=function(e){var v=this.getViewport();if(v._activeElementInstance&&v._isDrawingOn){var b=v.getDomRef().getBoundingClientRect(),o=e.x-b.left-window.pageXOffset,c=e.y-b.top-window.pageYOffset;v._activeElementInstance.edit(o,c);e.handled=true;}return this;};
a.prototype.endGesture=function(e){var v=this.getViewport();this._gesture=false;if(v._activeElementInstance){v.addRedlineElement(v._activeElementInstance);v.fireElementCreated({element:v._activeElementInstance});v.stopAdding();e.handled=true;}return this;};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineDesignRenderer',["./RedlineSurfaceRenderer","sap/ui/core/Renderer"],function(R,a){"use strict";var b=a.extend(R);
b.render=function(r,c){R.render.call(this,r,c);};
b.renderAfterRedlineElements=function(r,c){if(c._activeElementInstance&&c._isDrawingOn){c._activeElementInstance.render(r);}};
return b;},true);
sap.ui.predefine('sap/ui/vk/RedlineElement',["sap/ui/core/Element"],function(E){"use strict";
var R=E.extend("sap.ui.vk.RedlineElement",{metadata:{library:"sap.ui.vk",properties:{elementId:{type:"string"},originX:{type:"float",defaultValue:0},originY:{type:"float",defaultValue:0},opacity:{type:"float",defaultValue:1},strokeWidth:{type:"float",defaultValue:2},strokeColor:{type:"sap.ui.core.CSSColor",defaultValue:"#e6600d"},strokeDashArray:{type:"float[]",defaultValue:[]},halo:{type:"boolean",defaultValue:false}}}});
R.prototype.init=function(){var g=function(){var s=function(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);};return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s();};this.setElementId(g());};
R.prototype.applyZoom=function(){};
R.prototype.render=function(r){this.renderElement(r,this.getHalo());};
R.prototype.renderElement=function(r,h){};
R.prototype.exportJSON=function(){var j={originX:this.getOriginX(),originY:this.getOriginY(),opacity:this.getOpacity(),strokeColor:this.getStrokeColor(),strokeWidth:this.getStrokeWidth(),elementId:this.getElementId(),halo:this.getHalo()};if(this.getStrokeDashArray().length>0){j["strokeDashArray"]=this.getStrokeDashArray();}return j;};
R.prototype.importJSON=function(j){if(j.hasOwnProperty("originX")){this.setOriginX(j.originX);}if(j.hasOwnProperty("originY")){this.setOriginY(j.originY);}if(j.hasOwnProperty("opacity")){this.setOpacity(j.opacity);}if(j.hasOwnProperty("strokeColor")){this.setStrokeColor(j.strokeColor);}if(j.hasOwnProperty("strokeWidth")){this.setStrokeWidth(j.strokeWidth);}if(j.hasOwnProperty("strokeDashArray")){this.setStrokeDashArray(j.strokeDashArray);}if(j.hasOwnProperty("elementId")){this.setElementId(j.elementId);}if(j.hasOwnProperty("halo")){this.setHalo(j.halo);}return this;};
R.prototype.exportSVG=function(){return null;};
R.prototype.importSVG=function(s){if(s.getAttribute("x")){this.setOriginX(parseFloat(s.getAttribute("x")));}if(s.getAttribute("y")){this.setOriginY(parseFloat(s.getAttribute("y")));}if(s.getAttribute("opacity")){this.setOpacity(parseFloat(s.getAttribute("opacity")));}if(s.getAttribute("stroke")){this.setStrokeColor(s.getAttribute("stroke"));}if(s.getAttribute("stroke-width")){this.setStrokeWidth(parseFloat(s.getAttribute("stroke-width")));}if(s.getAttribute("stroke-dasharray")){this.setStrokeDashArray(s.getAttribute("stroke-dasharray").split(",").map(parseFloat));}if(s.getAttribute("data-sap-element-id")){this.setElementId(s.getAttribute("data-sap-element-id"));}this.setHalo(s.getAttribute("data-sap-halo")==="true");return this;};
return R;});
sap.ui.predefine('sap/ui/vk/RedlineElementEllipse',["jquery.sap.global","./RedlineElement","./Redline"],function(q,R,a){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementEllipse",{metadata:{library:"sap.ui.vk",properties:{radiusX:{type:"float",defaultValue:0.0001},radiusY:{type:"float",defaultValue:0.0001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
b.prototype.edit=function(o,c){var p=this.getParent(),t=p._toVirtualSpace(o,c),r=t.x-this.getOriginX(),d=t.y-this.getOriginY();this.setRadiusX(r>0?r:-r);this.setRadiusY(d>0?d:-d);return this;};
b.prototype.applyZoom=function(z){this.setProperty("radiusX",this.getRadiusX()*z,true);this.setProperty("radiusY",this.getRadiusY()*z,true);return this;};
b.prototype.setRadiusX=function(r){this.setProperty("radiusX",r,true);var d=this.getDomRef();if(d){d.setAttribute("rx",this.getParent()._toPixelSpace(r));}};
b.prototype.setRadiusY=function(r){this.setProperty("radiusY",r,true);var d=this.getDomRef();if(d){d.setAttribute("ry",this.getParent()._toPixelSpace(r));}};
b.prototype.renderElement=function(r,h){var p=this.getParent();r.write("<ellipse");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("cx",o.x);r.writeAttribute("cy",o.y);r.writeAttribute("rx",p._toPixelSpace(this.getRadiusX()));r.writeAttribute("ry",p._toPixelSpace(this.getRadiusY()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write("></ellipse>");};
b.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Ellipse,version:1,radiusX:this.getRadiusX(),radiusY:this.getRadiusY(),fillColor:this.getFillColor()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Ellipse){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("radiusX")){this.setRadiusX(j.radiusX);}if(j.hasOwnProperty("radiusY")){this.setRadiusY(j.radiusY);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"ellipse");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("rx",this.getRadiusX());e.setAttribute("ry",this.getRadiusY());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="ellipse"){R.prototype.importSVG.call(this,s);if(s.getAttribute("rx")){this.setRadiusX(parseFloat(s.getAttribute("rx")));}if(s.getAttribute("ry")){this.setRadiusY(parseFloat(s.getAttribute("ry")));}if(s.getAttribute("fill")){this.setFillColor(s.getAttribute("fill"));}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementFreehand',["jquery.sap.global","./RedlineElement","./Redline"],function(q,R,a){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementFreehand",{metadata:{library:"sap.ui.vk",properties:{path:{type:"float[]",defaultValue:null}}}});
b.prototype.setPath=function(p){this.setProperty("path",p,true);var d=this.getDomRef();if(d){d.setAttribute("d",this._getProcessedPath());}};
b.prototype.edit=function(o,c){var p=this.getParent();var t=p._toVirtualSpace(o,c);var d=this.getPath()||[];d.push(t.x-this.getOriginX(),t.y-this.getOriginY());this.setPath(d);var e=this.getDomRef();if(e){e.setAttribute("d",this._getProcessedPath());}return this;};
b.prototype.applyZoom=function(z){this.setProperty("path",this.getPath().map(function(v){return v*z;}),true);return this;};
b.prototype._getProcessedPath=function(){var p=this.getParent(),o=p._toPixelSpace(this.getOriginX(),this.getOriginY());var d="";(this.getPath()||[]).forEach(function(e,i){e=p._toPixelSpace(e);if(i===0){d+="M "+(o.x+e);}else if(i===1){d+=" "+(o.y+e);}else{d+=" "+(i%2===0?"L "+(o.x+e):(o.y+e));}});return d;};
b.prototype.renderElement=function(r,h){r.write("<path");r.writeElementData(this);r.writeAttribute("d",this._getProcessedPath());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());r.writeAttribute("fill","none");if(h){r.writeAttribute("filter","url(#halo)");}r.write("></path>");};
b.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Freehand,version:1,path:(this.getPath()||[]).slice()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Freehand){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("path")){this.setPath(j.path.slice());}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"path");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("d",this.getPath());e.setAttribute("fill","none");e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="path"){R.prototype.importSVG.call(this,s);if(s.getAttribute("d")){this.setPath(s.getAttribute("d").split(",").map(parseFloat));}}else{q.sap.log.error("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementLine',["jquery.sap.global","./RedlineElement","./Redline"],function(q,R,a){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementLine",{metadata:{library:"sap.ui.vk",properties:{deltaX:{type:"float",defaultValue:0},deltaY:{type:"float",defaultValue:0}}}});
b.prototype.edit=function(o,c){var p=this.getParent(),t=p._toVirtualSpace(o,c);this.setDeltaX(t.x-this.getOriginX());this.setDeltaY(t.y-this.getOriginY());return this;};
b.prototype.applyZoom=function(z){this.setProperty("deltaX",this.getDeltaX()*z);this.setProperty("deltaY",this.getDeltaY()*z);return this;};
b.prototype.getP2=function(v){return this.getParent()._toPixelSpace(this.getOriginX()+this.getDeltaX(),this.getOriginY()+this.getDeltaY());};
b.prototype.setDeltaX=function(v){this.setProperty("deltaX",v);var d=this.getDomRef();if(d){d.setAttribute("x2",this.getP2().x);}};
b.prototype.setDeltaY=function(v){this.setProperty("deltaY",v);var d=this.getDomRef();if(d){d.setAttribute("y2",this.getP2().y);}};
b.prototype.renderElement=function(r,h){var p=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());var c=this.getP2();r.write("<line");r.writeElementData(this);r.writeAttribute("x1",p.x);r.writeAttribute("y1",p.y);r.writeAttribute("x2",c.x);r.writeAttribute("y2",c.y);r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write("></line>");};
b.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Line,version:1,deltaX:this.getDeltaX(),deltaY:this.getDeltaY()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Line){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("deltaX")){this.setDeltaX(j.deltaX);}if(j.hasOwnProperty("deltaY")){this.setDeltaY(j.deltaY);}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"line");e.setAttribute("x1",this.getOriginX());e.setAttribute("y1",this.getOriginY());e.setAttribute("x2",this.getOriginX()+this.getDeltaX());e.setAttribute("y2",this.getOriginY()+this.getDeltaY());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="line"){R.prototype.importSVG.call(this,s);if(s.getAttribute("x1")){this.setOriginX(parseFloat(s.getAttribute("x1")));}if(s.getAttribute("y1")){this.setOriginY(parseFloat(s.getAttribute("y1")));}if(s.getAttribute("x2")){this.setDeltaX(parseFloat(s.getAttribute("x2"))-this.getOriginX());}if(s.getAttribute("y2")){this.setDeltaY(parseFloat(s.getAttribute("y2"))-this.getOriginY());}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementRectangle',["jquery.sap.global","./RedlineElement","./Redline"],function(q,R,a){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementRectangle",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float",defaultValue:0.001},height:{type:"float",defaultValue:0.001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
b.prototype.init=function(){R.prototype.init.apply(this);this._originX=0;this._originY=0;};
b.prototype.setOriginX=function(o){this.setProperty("originX",o);this._originX=o;};
b.prototype.setOriginY=function(o){this.setProperty("originY",o);this._originY=o;};
b.prototype.edit=function(o,c){var p=this.getParent(),t=p._toVirtualSpace(o,c),w=t.x-this._originX,h=t.y-this._originY;this.setProperty("originX",w<0?t.x:this._originX);this.setProperty("originY",h<0?t.y:this._originY);this.setWidth(Math.abs(w));this.setHeight(Math.abs(h));this.rerender();return this;};
b.prototype.applyZoom=function(z){this.setProperty("width",this.getWidth()*z,true);this.setProperty("height",this.getHeight()*z,true);return this;};
b.prototype.setWidth=function(w){this.setProperty("width",w,true);var d=this.getDomRef();if(d){d.setAttribute("width",this.getParent()._toPixelSpace(w));}};
b.prototype.setHeight=function(h){this.setProperty("height",h,true);var d=this.getDomRef();if(d){d.setAttribute("height",this.getParent()._toPixelSpace(h));}};
b.prototype.renderElement=function(r,h){var p=this.getParent();r.write("<rect");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("x",o.x);r.writeAttribute("y",o.y);r.writeAttribute("width",p._toPixelSpace(this.getWidth()));r.writeAttribute("height",p._toPixelSpace(this.getHeight()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write("></rect>");};
b.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Rectangle,version:1,width:this.getWidth(),height:this.getHeight(),fillColor:this.getFillColor()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Rectangle){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("width")){this.setWidth(j.width);}if(j.hasOwnProperty("height")){this.setHeight(j.height);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log("wrong version number");}}else{q.sap.log("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"rect");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("height",this.getHeight());e.setAttribute("width",this.getWidth());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());return e;};
b.prototype.importSVG=function(s){if(s.tagName==="rect"){R.prototype.importSVG.call(this,s);if(s.getAttribute("width")){this.setWidth(parseFloat(s.getAttribute("width")));}if(s.getAttribute("height")){this.setHeight(parseFloat(s.getAttribute("height")));}if(s.getAttribute("fill")){this.setFillColor(s.getAttribute("fill"));}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineElementText',["jquery.sap.global","./RedlineElement","./Redline"],function(q,R,a){"use strict";
var b=R.extend("sap.ui.vk.RedlineElementText",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:"Text"},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:32},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0,0,0,0)"}}}});
b.prototype.edit=function(p,c){var d=this.getParent(),e=d._toVirtualSpace(p,c);this.setOriginX(e.x);this.setOriginY(e.y);this.rerender();return this;};
b.prototype.applyZoom=function(z){this.setFontSize(this.getFontSize()*z);return this;};
b.prototype.renderElement=function(r,h){var p=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());r.write("<text");r.writeElementData(this);r.writeAttribute("x",p.x);r.writeAttribute("y",p.y);if(this.getFont()){r.writeAttribute("font-family",this.getFont());}r.writeAttribute("font-size",this.getFontSize());r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());if(h){r.writeAttribute("filter","url(#halo)");}r.write(">");r.write(this.getText());r.write("</text>");};
b.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Text,version:1,text:this.getText(),font:this.getFont(),fontSize:this.getFontSize(),fillColor:this.getFillColor()});};
b.prototype.importJSON=function(j){if(j.type===a.ElementType.Text){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("text")){this.setText(j.text);}if(j.hasOwnProperty("font")){this.setFont(j.font);}if(j.hasOwnProperty("fontSize")){this.setFontSize(j.fontSize);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"text");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());if(this.getFont()){e.setAttribute("font-family",this.getFont());}e.setAttribute("font-size",this.getFontSize());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());e.textContent=this.getText();return e;};
b.prototype.importSVG=function(e){if(e.tagName==="text"){R.prototype.importSVG.call(this,e);if(e.getAttribute("x")){this.setOriginX(parseFloat(e.getAttribute("x")));}if(e.getAttribute("y")){this.setOriginY(parseFloat(e.getAttribute("y")));}if(e.getAttribute("text")){this.setText(e.getAttribute("text"));}if(e.getAttribute("font-family")){this.setFont(e.getAttribute("font-family"));}if(e.getAttribute("font-size")){this.setFontSize(parseFloat(e.getAttribute("font-size")));}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"));}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/RedlineGesturesHandler',["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","./NativeViewport"],function(E,R,N){"use strict";
var a=E.extend("sap.ui.vk.RedlineGesturesHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._d=0;this._zoomFactor=1;this._gesture=false;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)){this._gesture=true;this._x=e.x;this._y=e.y;this._d=e.d;this._initd=e.d;e.handled=true;}return this;};
a.prototype._pan=function(e){var v=this.getViewport(),d=e.x-this._x,b=e.y-this._y;if(d||b){this._x=e.x;this._y=e.y;var p=v.getPanningRatio();v.firePan({deltaX:d*p,deltaY:b*p});v.getRedlineElements().forEach(function(c){c.setOriginX(c.getOriginX()+v._toVirtualSpace(d));c.setOriginY(c.getOriginY()+v._toVirtualSpace(b));});this._manualRender(v);}};
a.prototype._zoom=function(e){var v=this.getViewport(),z=1;var d=e.d-this._d;this._d=e.d;if(this._initd>0){z=1+d*(1/this._initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=Math.max(1-d*0.005,0.333);}else{z=Math.min(1+d*0.005,3);}}z=Math.min(Math.max(z,0.88),1.12);var t=v._getTargetViewport();var b=32;var c=1/8;if(t instanceof N){b=t._getZoomInLimit();c=t._getZoomOutLimit();this._zoomFactor=t._getZoomFactor();}z=Math.min(Math.max(this._zoomFactor*z,c),b)/this._zoomFactor;this._zoomFactor*=z;var o=this._getOffset(v.getDomRef());var s=1-z,p=v._toVirtualSpace(e.x-o.x,e.y-o.y);v.getRedlineElements().forEach(function(f){f.applyZoom(z);var g=f.getOriginX(),h=f.getOriginY();g+=(p.x-g)*s;h+=(p.y-h)*s;f.setOriginX(g);f.setOriginY(h);});this._manualRender(v);v.fireZoom({originX:e.x-o.x,originY:e.y-o.y,zoomFactor:z});};
a.prototype.move=function(e){if(this.getViewport().getDomRef()){if(e.n===1||e.n===2){this._pan(e);}if(e.n===2&&!e.buttons){this._zoom(e);}}e.handled=true;return this;};
a.prototype._manualRender=function(r){if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){r.invalidate();}else{var b=sap.ui.getCore().createRenderManager();r.getRedlineElements().forEach(function(e){e.render(b);});b.flush(r.getDomRef(),false,false);b.destroy();var x=r.$();x.html(x.html());}};
a.prototype.endGesture=function(e){this._gesture=false;e.handled=true;return this;};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineSurface',["jquery.sap.global","./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler","./RedlineSurfaceRenderer","./Redline"],function(q,v,C,L,R,a,b){"use strict";
var c=C.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});
c.prototype.init=function(){};
c.prototype.onAfterRendering=function(){};
c.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON();});};
c.prototype.importJSON=function(j){if(!q.isArray(j)){j=[j];}j.forEach(function(d){var E;switch(d.type){case b.ElementType.Rectangle:E=sap.ui.vk.RedlineElementRectangle;break;case b.ElementType.Ellipse:E=sap.ui.vk.RedlineElementEllipse;break;case b.ElementType.Freehand:E=sap.ui.vk.RedlineElementFreehand;break;case b.ElementType.Line:E=sap.ui.vk.RedlineElementLine;break;case b.ElementType.Text:E=sap.ui.vk.RedlineElementText;break;default:q.sap.log.warning("Unsupported JSON element type "+d.type);}if(E!=null){this.addRedlineElement(new E().importJSON(d));}}.bind(this));return this;};
c.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this.getVirtualSideLength();}else{return{x:(x-this.getVirtualLeft())/this.getVirtualSideLength(),y:(y-this.getVirtualTop())/this.getVirtualSideLength()};}};
c.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this.getVirtualSideLength();}else{return{x:x*this.getVirtualSideLength()+this.getVirtualLeft(),y:y*this.getVirtualSideLength()+this.getVirtualTop()};}};
c.prototype.setPanningRatio=function(p){this.setProperty("panningRatio",p,true);};
c.prototype.updatePanningRatio=function(){var d=this.getVirtualLeft(),e=this.getVirtualTop(),r=this.getDomRef(),f=r.getBoundingClientRect(),h=f.height,w=f.width,p;if(d===0&&(h<w&&e<0||(h>w&&e>0))){p=h/w;}else{p=1;}this.setPanningRatio(p);return this;};
c.prototype.exportSVG=function(){var s=document.createElementNS(b.svgNamespace,"svg");this.getRedlineElements().map(function(e){s.appendChild(e.exportSVG());});return s;};
c.prototype.importSVG=function(s){s.childNodes.forEach(function(t){if(t.getAttribute){var E;switch(t.tagName){case"rect":E=sap.ui.vk.RedlineElementRectangle;break;case"ellipse":E=sap.ui.vk.RedlineElementEllipse;break;case"path":E=sap.ui.vk.RedlineElementFreehand;break;case"line":E=sap.ui.vk.RedlineElementLine;break;case"text":E=sap.ui.vk.RedlineElementText;break;default:q.sap.log.warning("Unsupported SVG element type "+E);}if(E){this.addRedlineElement(new E().importSVG(t));}}}.bind(this));return this;};
return c;});
sap.ui.predefine('sap/ui/vk/RedlineSurfaceRenderer',[],function(){"use strict";var R={};
R.render=function(r,c){r.write("<svg");r.writeControlData(c);r.addClass("sapUiVizkitRedlineSurface");r.writeClasses();r.write(">");r.write("			<defs>				<filter id='halo' filterUnits='userSpaceOnUse' >					<feGaussianBlur in='SourceAlpha' stdDeviation='4' result='blur' />					<feMerge>						<feMergeNode in='blur' />						<feMergeNode in='SourceGraphic' />					</feMerge>				</filter>			</defs>		");c.getRedlineElements().forEach(function(a){a.render(r);});this.renderAfterRedlineElements(r,c);r.write("</svg>");};
R.renderAfterRedlineElements=function(r,c){};
return R;},true);
sap.ui.predefine('sap/ui/vk/RenderMode',[],function(){"use strict";var R={Default:"Default",XRay:"XRay",LineIllustration:"LineIllustration",ShadedIllustration:"ShadedIllustration",SolidOutline:"SolidOutline"};return R;},true);
sap.ui.predefine('sap/ui/vk/RotationType',[],function(){"use strict";var R={Quaternion:"Quaternion",AngleAxis:"AngleAxis",Euler:"Euler"};return R;},true);
sap.ui.predefine('sap/ui/vk/SafeArea',["sap/ui/core/Control","sap/ui/vk/SafeAreaRenderer"],function(C,S){"use strict";
var a=C.extend("sap.ui.vk.SafeArea",{
metadata:{aggregations:{settingsControl:{type:"sap.ui.core.Control",multiple:false}}},
constructor:function(i,s){C.apply(this,arguments);}
});
a.prototype.onAfterRendering=function(){this.resize();};
a.prototype.resize=function(){var s=this.getDomRef();var v=this.getParent();if(!s||!v){return;}var b=v.getDomRef().getBoundingClientRect();var c=b.width/b.height;var d=c;var e=v.getCurrentView();if(e&&e.getAspectRatio()&&e.getAspectRatio()>0&&e.getAspectRatio()<25){d=e.getAspectRatio();}var h=b.height;var w=b.width;if(c>d){s.style.height=(h-4)+"px";s.style.width=(h*d-4)+"px";s.style.left=(w-(h*d-4))/2+"px";s.style.top="";}else if(c<d){s.style.height=(w/d-4)+"px";s.style.width=(w-4)+"px";s.style.top=(h-(w/d-4))/2+"px";s.style.left="";}else{s.style.height=(h-4)+"px";s.style.width=(w-4)+"px";}if(this.getSettingsControl()){var f=this.getSettingsControl().getDomRef();var g=window.getComputedStyle(document.getElementById(this.getSettingsControl().sId));var i=g.height;f.style.position="absolute";if(c<d&&((h-parseFloat(s.style.height))/2)>parseFloat(i)){f.style.bottom=(parseFloat(s.style.height)+2)+"px";f.style.left="-2px";f.style.top="";}else{f.style.top="0px";f.style.left="0px";f.style.bottom="";}}};
return a;});
sap.ui.predefine('sap/ui/vk/SafeAreaRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);var v=c.getParent();if(v){if(v.getShowSafeArea()){r.addClass("sapVizKitSafeAreaVisible");}else{r.addClass("sapVizKitSafeAreaNotVisible");}}r.writeClasses();r.write(">");if(c.getSettingsControl()){r.renderControl(c.getSettingsControl());}r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/Scene',["sap/ui/base/ManagedObject","./AnimationSequence","./AnimationTrack","./ViewGroup","./View","./Highlight","./Annotation"],function(M,A,a,V,b,H,c){"use strict";
var S=M.extend("sap.ui.vk.Scene",{metadata:{"abstract":true,properties:{doubleSided:{type:"boolean",defaultValue:false},autoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceView:{type:"boolean",defaultValue:false},autoAdvanceViewTimeout:{type:"int",defaultValue:5000}},associations:{animationPlayer:{type:"sap.ui.vk.AnimationPlayer",multiple:false}}}});
S.prototype.getInitialView=function(){return null;};
S.prototype.createSequence=function(i,p){var s=new A(i,p);this.addSequence(s);return s;};
S.prototype.getSequences=function(){if(!this._sequences){this._sequences=[];}return this._sequences;};
S.prototype.findSequence=function(s){if(!this._sequences){return undefined;}return this._sequences.find(function(d){return d.getId()===s;});};
S.prototype.addSequence=function(s){if(!this._sequences){this._sequences=[];}this._sequences.push(s);return this;};
S.prototype.insertSequence=function(s,i){if(!this._sequences){this._sequences=[];}if(i<0){i=0;}else if(i!==0&&i>=this._sequences.length){i=this._sequences.length;}this._sequences.splice(i,0,s);return this;};
S.prototype.indexOfSequence=function(s){if(!this._sequences){return-1;}return this._sequences.find(function(i){return i==s;});};
S.prototype.removeSequence=function(s){if(this._sequences){var i=this.indexOfSequence(s);if(i>=0){this._sequences.splice(i,1);}}return this;};
S.prototype.removeSequences=function(){if(this._sequences){this._sequences.splice(0);}return this;};
S.prototype.createTrack=function(i,p){var t=new a(i,p);this.addTrack(t);return t;};
S.prototype.getTracks=function(){if(!this._tracks){this._tracks=[];}return this._tracks;};
S.prototype.findTrack=function(t){if(!this._tracks){return undefined;}return this._tracks.find(function(d){return d.getId()===t;});};
S.prototype.addTrack=function(t){if(!this._tracks){this._tracks=[];}this._tracks.push(t);return this;};
S.prototype.insertTrack=function(t,i){if(!this._tracks){this._tracks=[];}if(i<0){i=0;}else if(i!==0&&i>=this._tracks.length){i=this._tracks.length;}this._tracks.splice(i,0,t);return this;};
S.prototype.indexOfTrack=function(t){if(!this._tracks){return-1;}return this._tracks.findIndex(function(i){return i==t;});};
S.prototype.removeTrack=function(t){if(this._tracks){var i=this.indexOfTrack(t);if(i>=0){this._tracks.splice(i,1);}}return this;};
S.prototype.removeTracks=function(){if(this._tracks){this._tracks.splice(0);}return this;};
S.prototype.getViewGroups=function(){if(!this._viewGroups){this._viewGroups=[];}return this._viewGroups;};
S.prototype.createViewGroup=function(p){if(!this._viewGroups){this._viewGroups=[];}var v=new V(p);this._viewGroups.push(v);return v;};
S.prototype.indexOfViewGroup=function(v){if(!this._viewGroups){return-1;}return this._viewGroups.find(function(i){return i==v;});};
S.prototype.insertViewGroup=function(v,i){if(!this._viewGroups){this._viewGroups=[];}if(i<0){i=0;}else if(i!==0&&i>=this._viewGroups.length){i=this._viewGroups.length;}this._viewGroups.splice(i,0,v);return this;};
S.prototype.removeViewGroup=function(v){var i=this.indexOfViewGroup(v);if(i>=0){this._viewGroups.splice(i,1);}return this;};
S.prototype.removeViewGroups=function(){this._viewGroups.splice(0);return this;};
S.prototype.findViewGroupByView=function(v){var r;if(this._viewGroups){for(var i=0;i<this._viewGroups.length;i++){if(this._viewGroups[i].indexOfView(v)>=0){r=this._viewGroups[i];break;}}}return r;};
S.prototype.getViews=function(){if(!this._views){this._views=[];}return this._views;};
S.prototype.createView=function(p){if(!this._views){this._views=[];}var v=new b(p);this._views.push(v);return v;};
S.prototype.removeView=function(v){if(!this._views){return this;}var d=this.getViewGroups();if(Array.isArray(d)){d.forEach(function(e){e.removeView(v);});}var i=this._views.indexOf(v);if(i>=0){this._views.splice(i,1);}return this;};
S.prototype.createHighlight=function(i,p){var h=new H(i,p);if(!this._highlights){this._highlights=new Map();}this._highlights.set(i,h);return h;};
S.prototype.getHighlight=function(i){var h;if(this._highlights){h=this._highlights.get(i);}return h;};
S.prototype.removeHighlight=function(i){if(this._highlights){this._highlights.delete(i);}return this;};
return S;});
sap.ui.predefine('sap/ui/vk/SceneTree',["./library","sap/ui/core/Control","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/json/JSONModel","sap/ui/core/ResizeHandler","sap/m/Title","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/ui/core/Icon","./ContentConnector","./ViewStateManager","./SceneTreeRenderer","./getResourceBundle"],function(v,C,T,a,J,R,b,S,c,d,e,f,I,g,V,h,j){"use strict";
var k=C.extend("sap.ui.vk.SceneTree",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",defaultValue:j().getText("SCENETREE_TITLE")},showTitle:{type:"boolean",defaultValue:true},showSearchField:{type:"boolean",defaultValue:true}},aggregations:{treeTable:{type:"sap.ui.table.TreeTable",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}}});
var m="sap-icon://show",n="sap-icon://hide";var t=j().getText("SCENETREE_VISIBILITYSTATEVISIBLE"),o=j().getText("SCENETREE_VISIBILITYSTATEHIDDEN");
k.prototype._createNodeForSceneTree=function(i,l,p){var q=p.getVisibilityState(l);return{name:i,id:l,visible:q};};
k.prototype.setScene=function(s,i){this.setViewStateManager(i);this._setScene(s);};
k.prototype._setScene=function(s){this._scene=s;this.refresh();};
k.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var i=this;this._title=new b({width:"100%",textAlign:sap.ui.core.TextAlign.Center,text:this.getTitle()});this._searchField=new S({layoutData:new d({shrinkable:true,maxWidth:"400px"}),search:function(p){var q=p.getParameter("query"),r=i._scene.getDefaultNodeHierarchy(),s=i._viewStateManager;if(r&&s){var u=!q?[]:r.findNodesByName({value:q,predicate:"contains"});var w=new Set(u);var x=[];s.enumerateSelection(function(y){if(!w.has(y)){x.push(y);}});s.setSelectionState(x,false,false);s.setSelectionState(u,true,false);}}});this._toolbar=new c({content:[this._title,new e(),this._searchField]});var l=new I({src:m,tooltip:t,width:"2em",height:"1.3em",size:"1.2em",press:function(p){var q=this.getSrc()!==m;this.setSrc(q?m:n);this.setTooltip(q?t:o);i._toggleVisibilityForAllChildren(i._model.getData(),q);}});this._tree=new T({title:this._toolbar,columnHeaderHeight:32,columns:[new a({label:j().getText("SCENETREE_NAME"),tooltip:j().getText("SCENETREE_NAME"),template:new f({text:"{name}",maxLines:1,tooltip:"{name}"}),resizable:false}),new a(this.getId()+"-visibilityColumn",{label:l,template:new I({src:{path:"",formatter:function(p){if(!p){return null;}return p.visible?m:n;}},tooltip:{path:"",formatter:function(p){if(!p){return null;}return p.visible?t:o;}},height:"1.3em",size:"1.2em",press:function(p){var q=i._tree.getContextByIndex(this.getParent().getIndex());var r=q?q.getObject():null;if(r){i._viewStateManager.setVisibilityState(r.id,!r.visible,true);}}}),width:"2.5em",resizable:false,hAlign:"Center"})],enableSelectAll:false,selectionMode:"MultiToggle",selectionBehavior:"RowSelector",visibleRowCountMode:"Fixed",expandFirstLevel:false,collapseRecursive:false,rowHeight:32});this.setAggregation("treeTable",this._tree);this.attachContentChanged(function(p){l.setSrc(m);l.setTooltip(t);});this._scene=null;this._syncing=false;this._updateSelectionTimer=0;this._updateVisibilityTimer=0;this._model=new J();this._tree.setModel(this._model);this._tree.bindRows({path:"/"});this._tree.attachRowSelectionChange(this._handleRowSelectionChange.bind(this));this._tree.attachFirstVisibleRowChanged(this._updateSelection.bind(this));this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));};
k.prototype.setTitle=function(i){this.setProperty("title",i,true);this._title.setText(i);return this;};
k.prototype.setShowTitle=function(i){this.setProperty("showTitle",i,true);this._title.setVisible(i);this._updateTitleBar();return this;};
k.prototype.setShowSearchField=function(i){this.setProperty("showSearchField",i,true);this._searchField.setVisible(i);this._updateTitleBar();return this;};
k.prototype._updateTitleBar=function(){this._tree.setTitle(this.getShowTitle()||this.getShowSearchField()?this._toolbar:null);this._handleResize();};
k.prototype.onBeforeRendering=function(){this._tree.setVisible(true);if(!this._resizeListenerId){this._resizeListenerId=R.register(this,this._handleResize.bind(this));}};
k.prototype._handleRowSelectionChange=function(l){if(this._syncing||this._tree.getBinding("rows")._aSelectedContexts!=undefined){return;}var s=[];var p=[];var r=l.getParameter("rowIndices");for(var i in r){var q=r[i];var u=this._tree.getContextByIndex(q);var w=u?u.getObject().id:null;if(w){(this._tree.isIndexSelected(q)?s:p).push(w);}}if(s.length>0){this._viewStateManager.setSelectionState(s,true);}if(p.length>0){this._viewStateManager.setSelectionState(p,false);}};
k.prototype._handleSelectionChanged=function(p){if(this._syncing){return;}function q(r,u){var w=r.getBinding("rows");if(w){for(var i=r.getFirstVisibleRow(),l=Math.min(i+r.getVisibleRowCount(),w.getLength());i<l;i++){var x=w.getContextByIndex(i);if(x&&x.getObject().id===u){return true;}}}return false;}var s=p.getParameter("selected");if(s.length===1&&!q(this._tree,s[0])){if(this._updateSelectionTimer>0){clearTimeout(this._updateSelectionTimer);this._updateSelectionTimer=0;}this._expandToNode(s[0],this._updateSelection.bind(this));}else if(this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0);}};
k.prototype._updateSelection=function(){this._updateSelectionTimer=0;if(this._syncing){return;}this._syncing=true;var p=this._viewStateManager,q=this._tree,r=q.getBinding("rows");if(p&&r){for(var i=q.getFirstVisibleRow(),l=Math.min(i+q.getVisibleRowCount(),r.getLength());i<l;i++){var s=r.getContextByIndex(i);if(s){var u=s.getObject().id;if(u){var w=p.getSelectionState(u);if(w!=q.isIndexSelected(i)){q[w?"addSelectionInterval":"removeSelectionInterval"](i,i);}}}}}this._syncing=false;};
k.prototype._expandToNode=function(i,l){var p={tree:this._tree,rows:this._tree.getBinding("rows"),index:0,nodeRef:i,ancestors:new Set(this._scene.getDefaultNodeHierarchy().getAncestors(i)),callback:l};function s(r,u,w){var x=r.getFirstVisibleRow(),y=r.getVisibleRowCount();if((u<x)||(u>=(x+y))){x=Math.min(Math.max(u-(y>>1),0),w-y);setTimeout(function(){r.setFirstVisibleRow(x);},0);}}function q(p,r){if(r&&r.getParameter("reason")!=="expand"){return;}var u=p.rows.getLength();while(p.index<u){var w=p.rows.getContextByIndex(p.index);if(!w){break;}var i=w.getObject().id;if(i===p.nodeRef){s(p.tree,p.index,u);break;}if(p.ancestors.has(i)&&!p.tree.isExpanded(p.index)){p.tree.expand(p.index++);return;}p.index++;}p.rows.detachChange(p.expandHandlerProxy);p.callback();}p.expandHandlerProxy=q.bind(this,p);p.rows.attachChange(p.expandHandlerProxy);q(p);};
k.prototype._dataChange=function(i){var r=i.getParameter("reason");if((r==="expand"||r==="collapse")&&this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0);}};
k.prototype._toggleVisibilityForAllChildren=function(l,p){var q=l.hasOwnProperty("children")?l.children:l;for(var i=0;q[i]!=null;i++){this._viewStateManager.setVisibilityState(q[i].id,p,true);}};
k.prototype._handleVisibilityChanged=function(i){if(this._updateVisibilityTimer===0){this._updateVisibilityTimer=setTimeout(this._updateVisibility.bind(this),0);}};
k.prototype._updateVisibility=function(){this._updateVisibilityTimer=0;this._getNodeVisibilityRecursive(this._model.getData());this._tree.getModel().refresh(true);};
k.prototype._getNodeVisibilityRecursive=function(l){if(l.id!=null){l.visible=this._viewStateManager.getVisibilityState(l.id);}var p=l.hasOwnProperty("children")?l.children:l;for(var i=0;p[i]!=null;i++){this._getNodeVisibilityRecursive(p[i]);}};
k.prototype._handleResize=function(i){var l=i?i.size.height:this.getDomRef().clientHeight;var p=this._tree.getTitle()?2.1:1.1;this._tree.setVisibleRowCount(Math.max(Math.floor(l/(this._tree.getRowHeight()+1)-p),0));this._updateSelection();};
k.prototype.refresh=function(){if(!this._scene||!this._viewStateManager||!this._viewStateManager.getNodeHierarchy()){this._model.setData([]);return;}var i=this._scene.getDefaultNodeHierarchy();var l=[];var p=function(l,q){q.forEach(function(r){if(r.userData&&r.userData.skipIt){p(l,i.getChildren(r));}else{var s=i.createNodeProxy(r);var u=this._createNodeForSceneTree(s.getName(),s.getNodeRef(),this._viewStateManager);l.push(u);i.destroyNodeProxy(s);u.children=[];p(u.children,i.getChildren(r));}}.bind(this));}.bind(this);p(l,i.getChildren());this._model.setData(l);this._tree.setModel(this._model);this._tree.bindRows({path:"/",parameters:{arrayNames:["children"]}});this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this.fireContentChanged();};
k.prototype._onBeforeClearContentConnector=k.prototype._onBeforeClearViewStateManager=function(){this._setScene(null);};k.prototype._onAfterUpdateContentConnector=k.prototype._onAfterUpdateViewStateManager=function(){if(this._contentConnector){this._setContent(this._contentConnector.getContent());}};
k.prototype._setContent=function(i){this._setScene(i);};
k.prototype._handleContentReplaced=function(i){this._setContent(i.getParameter("newContent"));};
k.prototype._handleNodeHierarchyReplaced=function(i){this._setScene(this._scene);};
k.prototype._handleContentChangesFinished=function(i){this.refresh();};
g.injectMethodsIntoClass(k);V.injectMethodsIntoClass(k);return k;});
sap.ui.predefine('sap/ui/vk/SceneTreeRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiSizeCompact");r.addClass("sapUiVkSceneTree");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("treeTable"));r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/SelectionDisplayMode',[],function(){"use strict";var S={Highlight:"Highlight",Outline:"Outline"};return S;},true);
sap.ui.predefine('sap/ui/vk/SelectionMode',[],function(){"use strict";var S={None:"none",Exclusive:"exclusive",Sticky:"sticky"};return S;},true);
sap.ui.predefine('sap/ui/vk/Smart2DHandler',["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(E,R){"use strict";
var S=E.extend("sap.ui.vk.Smart2DHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(v,a){this._viewport=v;this._rect=null;this._x=0;this._y=0;this._gesture=false;this._hitEndTimer=0;this._lastRender=0;this._viewport.attachEvent("resize",this,this._onresize);this._viewStateManager=a;this._previousColoring={nodeRef:null,nodeId:null,color:null};}
});
S.prototype.destroy=function(){this._viewport=null;this._rect=null;this._gesture=false;this._viewport.detachEvent("resize",this,this._onresize);this._viewStateManager=null;this._previousColoring=null;};
S.prototype._getOffset=function(d){var r=d.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){var v=this._viewport.getDomRef();if(v==null){return false;}var a=this._getOffset(v);this._rect={x:a.x,y:a.y,w:v.offsetWidth,h:v.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
S.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
S.prototype.beginGesture=function(e){if(this._inside(e)){this._gesture=true;this._x=e.x;this._y=e.y;}};
S.prototype.callbackHover=function(){var n=this._viewStateManager.getNodeHierarchy();this._lastRender=Date.now();this._hitEndTimer=0;var h=this._viewport.hitTest(this._x,this._y);if(this._highlightedNodeRef!==h){if(this._highlightedNodeRef!==sap.ve.dvl.DVLID_INVALID){var t=this._highlightedNodeRef===this._previousColoring.nodeRef?this._previousColoring.color:0;this._viewport.showHotspots(this._highlightedNodeRef,true,t);}if(n.getHotspotNodeIds().indexOf(h)!==-1){var a=n.createNodeProxy(h);this._previousColoring={nodeRef:h,nodeId:h,color:a.getTintColorABGR()};n.destroyNodeProxy(a);this._viewport.showHotspots(h,true);}this._highlightedNodeRef=h;}this._viewport.renderFrame();};
S.prototype.hover=function(e){if(e.n==1&&this._inside(e)){this._x=e.x-this._rect.x;this._y=e.y-this._rect.y;if(!this.getViewport().getShowAllHotspots()){var t=Date.now();if(t-this._lastRender>20){this.callbackHover();}if(this._hitEndTimer!=0){clearTimeout(this._hitEndTimer);}this._hitEndTimer=setTimeout(this.callbackHover.bind(this),20);}e.handled=true;}};
S.prototype.move=function(e){if(this._gesture&&e.n==1){this._viewport.pan(e.x-this._x,e.y-this._y);this._x=e.x;this._y=e.y;e.handled=true;}};
S.prototype.endGesture=function(e){this._gesture=false;};
S.prototype.click=function(e){};
S.prototype.doubleClick=function(e){};
S.prototype.contextMenu=function(e){};
S.prototype.getViewport=function(){return this._viewport;};
return S;});
sap.ui.predefine('sap/ui/vk/StepNavigation',["jquery.sap.global","sap/ui/core/Control","./library","./Messages","./DvlException","./ContentConnector","./StepNavigationRenderer","./dvl/GraphicsCoreApi","./dvl/getPointer","./dvl/getJSONObject","./dvl/Scene","./getResourceBundle"],function(q,C,v,M,D,a,S,G,g,b,c,d){"use strict";
var f=C.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.ScrollContainer",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"stepChanged":{parameters:{clientId:"object",type:"object",stepId:"object"}}}}});
f.prototype._onStepEvent=function(p){var s=this.getSettings();this.instanceSettings.currentStepId=p.stepId;switch(p.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:s.currentStepFinished=true;s.currentStepPaused=false;s.playAllActive=false;s.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:s.currentStepId=p.stepId;s.currentStepFinished=false;this._highlightStep(p.stepId);if(s.currentStepPaused){this.pauseStep();}break;default:q.sap.log.error(d().getText(M.VIT12.summary),M.VIT12.code,"sap.ui.vk.StepNavigation");}this.fireStepChanged({clientId:p.clientId,type:p.type,stepId:p.stepId});};
f.prototype.setScene=function(s){if(this._scene){this.oDvl.Client.detachStepEvent(this._onStepEvent,this);this.oDvl=null;}if(s){var e=s.getMetadata().getName();if(e!=="sap.ui.vk.dvl.Scene"){return;}}this._scene=s;this.instanceSettings={};if(this._scene){this.oDvl=s.getGraphicsCore().getApi(G.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this);}delete this._procedures;var p=this.getProcedureList();var o=this.getSettings();o.reset();p.unbindItems();p.setSelectedItem(p.getFirstItem());if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(d().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}var i=this._getStepThumbnails();this.oModel.setData(i);this._togglePlayPause(true);this._refreshControl();this.refresh();};
f.prototype.init=function(){this._emptyThumbnail="iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";if(C.prototype.init){C.prototype.init.call(this);}if(this.getSettings()==undefined){this.setSettings(new this._settings());}this._scene=null;this.oModel=new sap.ui.model.json.JSONModel();this.setModel(this.oModel);this._layout=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true});this.setAggregation("thumbnailsContainer",this._thumbnailsScroller);}this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:d().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(e){var s=this.getSettings();var p=this.getPreviousStep(s.currentProcedureIndex);if(p){s.currentStepPaused=false;this.playStep(p.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:d().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(e){var s=this.getSettings();var n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepPaused=false;this.playStep(n.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:d().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var k=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var i=null;switch(k){case"0":if(!s.currentStepId){i=this.getNextStep(s.currentProcedureIndex);if(i){s.currentStepId=i.id;}else{return;}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){i=this.getNextStep(s.currentProcedureIndex);if(i){s.currentStepId=i.id;}else{return;}}s.playAllActive=true;var p=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,p,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break;}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:d().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(o){var p=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=p.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var i=0;i<this.oModel.oData.procedures.length;i++){if(this.oModel.oData.procedures[i].id==s.currentProcedureId){s.currentProcedureIndex=i;s.currentProcedure=this.oModel.oData.procedures[i];break;}}if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;}this._refreshItems();}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem().bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name")));this.playMenuButton=(new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:d().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:d().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:d().getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:d().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:d().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:d().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:d().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]}));this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:d().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var s=this.getSettings();this.pauseStep();s.currentStepPaused=true;s.isPlaying=false;this._togglePlayPause(true);}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:d().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:d().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(d().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(d().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));}}.bind(this)});this._layout.addContent(this.playPreviousButton).addContent(this.playOptionButton).addContent(this.pauseButton).addContent(this.playMenuButton).addContent(this.procedureList).addContent(this.showStepInfoButton).addContent(new sap.m.ToolbarSpacer()).addContent(this.playNextButton);};
f.prototype.destroy=function(){return C.prototype.destroy.call(this);};
f.prototype.getScroller=function(){return this._thumbnailsScroller;};
f.prototype.getProcedureList=function(){var i=this.getId()+"-procedureList";var e=this._layout;var j=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(j)];};
f.prototype.getPlayMenuButton=function(){var i=this.getId()+"-playMenuButtonIcon";var e=this._layout;var j=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(j)];};
f.prototype.getPlayOptionButton=function(){var i=this.getId()+"-playOptionButton";var e=this._layout;var j=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(j)];};
f.prototype.getPauseButton=function(){var i=this.getId()+"-pauseButton";var e=this._layout;var j=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(j)];};
f.prototype.getPlayNextButton=function(){var i=this.getId()+"-playNextButton";var e=this._layout;var j=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(j)];};
f.prototype.getPlayPreviousButton=function(){var i=this.getId()+"-playPreviousButton";var e=this._layout;var j=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(j)];};
f.prototype.getShowStepInfoButton=function(){var i=this.getId()+"-showStepInfoButton";var e=this._layout;var j=sap.ui.getCore().byId(i);return e.getContent()[e.indexOfContent(j)];};
f.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(k,p,o,e){if(!this.targets[k]){this.targets[k]={"type":"css","property":p,"onValue":o,"offValue":e};}},addMethod:function(t,m,o,e,u){var k=t.getId();if(!this.targets[k]){this.targets[k]={"type":"method","target":t,"method":m,"onValue":o,"offValue":e,"useJQuery":u};}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false;},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(p,t,e,i){this._customHeaderText=this._customHeaderText||new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(p);this._customHeaderText.setTooltip(p);this._customHeader=this._customHeader||new sap.m.Bar({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new sap.m.Text({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new sap.m.ResponsivePopover({placement:i,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(e);}}};};
f.prototype.refresh=function(s){q.sap.log.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var p=this.getProcedureList();var o=this.getSettings();o.reset();p.setSelectedItem(p.getFirstItem());var e=this._getStepThumbnails();if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;}this.oModel.setData(e);this._togglePlayPause(true);this._refreshControl();}else if(this.getVisible()){this._refreshControl();}return true;};
f.prototype.clear=function(){q.sap.log.info("StepNavigation clear() called.");return true;};
f.prototype.onBeforeRendering=function(){if(this.getShowToolbar()){var p=this.getProcedureList();p.setModel(this.oModel);var P=this.getProcedureItemTemplate();p.bindItems("/procedures",P);}};
f.prototype.onAfterRendering=function(){var s=this.getSettings();this._togglePlayPause(!s.isPlaying);if(s.currentStepId){this._highlightStep(s.currentStepId);}};
var h={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this);}};
f.prototype._togglePlayPause=function(p){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var e=this.getPlayOptionButton(),i=this.getPauseButton();if(p){if(sap.ui.getCore().getCurrentFocusedControlId()===i.getId()){e.addEventDelegate(h);}i.setVisible(false);e.setVisible(true);}else{if(sap.ui.getCore().getCurrentFocusedControlId()===e.getId()){i.addEventDelegate(h);}e.setVisible(false);i.setVisible(true);}}};
f.prototype._refreshControl=function(){if(!this.oModel.oData.procedures){return;}var p=this.getProcedureList();var P=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(d().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}p.unbindItems();if(this.oModel.oData.procedures.length>0){var e=this.oModel.oData.procedures[0];if(this.getShowToolbar()){p.bindItems("/procedures",P);p.selectedKey=e.id;p.enabled=true;}this._refreshItems();}else{if(this.getShowToolbar()){p.bindItems("/procedures",P);p.enabled=false;}if(this.getShowThumbnails()){var o=this.getScroller();o.destroyContent();}}};
f.prototype._refreshItems=function(){var t=this;var s=[];var p=this.getProcedureList();var o=t.getSettings();var e=new sap.m.HBox();if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[o.currentProcedureIndex];p.setSelectedItem(p.getFirstItem());}if(o.currentProcedureId!=""||t.oModel.oData.procedures.length>0){if(t.getShowThumbnails()){var j=t.getScroller();j.removeAllContent();s=t.oModel.oData.procedures[o.currentProcedureIndex].steps;var k=function(n){o.currentStepPaused=false;var r=sap.ui.getCore().byId(n.getSource().getId());t.playStep(r.getCustomData()[0].getValue("stepId"));o.playAllActive=false;t._togglePlayPause(false);};var l=function(n){var r=80;var m=n.getSource();var u=m.getDomRef().width;var w=m.getDomRef().height;var x=u/w;if(u>w){m.setWidth(r+"px");m.setHeight(r/x+"px");}else{m.setHeight(r+"px");m.setWidth(r*x+"px");}};for(var i=0;i<s.length;i++){var m=new sap.m.Image({alt:s[i].name,src:"data:image/"+s[i].thumbnailType+";base64,"+s[i].thumbnailData,densityAware:false,tooltip:s[i].name,press:k.bind(t),load:l,layoutData:new sap.m.FlexItemData({shrinkFactor:0})});m.data("stepId",s[i].id);m.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:s[i].id}));m.addStyleClass("sapVizKitStepNavigationStepItem");e.addItem(m);}j.addContent(e);}}};
f.prototype._getPopupPlacement=function(e){var p=null;var y=0;while(e){y+=e.offsetTop;e=e.offsetParent;}if(y>200){p=sap.m.PlacementType.Top;}else{p=sap.m.PlacementType.Bottom;}return p;};
f.prototype._isScrollingNecessary=function(i,s){var e;if(i&&s){var j=q(i).offset().left+q(i).width();var t=q(s).width();if(j-q(i).width()<0){e=true;}else if((t-j)<q(i).width()){e=true;}else{e=false;}}else{e=false;}return e;};
f.prototype._scrollToItem=function(i,s){var p={},o=q(i).offset(),e=q(s).scrollLeft();p.scrollLeft=o.left+(e-q(s).offset().left);p.scrollLeft-=parseInt(q(i).css("marginLeft"),10)||0;p.scrollLeft-=parseInt(q(i).css("borderLeftWidth"),10)||0;q(s).animate(p,50);};
f.prototype._highlightStep=function(s){var t=this;if(t.getVisible()){var o=t.getSettings();var e=t.getStep(0,o.currentProcedureIndex,s);if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex];}var j=t.getShowStepInfoButton();var p;var k=document.getElementById(j.getId());p=t._getPopupPlacement(k);if(t.getShowStepInfo()){o.stepInfo.openPopup.call(this,e.name,e.description,j,p);}else if(o.stepInfo.stepMessagePopup&&o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}if(t.getShowThumbnails()){var l=t.getScroller();var T=l.getContent()[0].getItems();for(var i=0;i<T.length;i++){if(T[i].getCustomData()[0].getValue("stepId")==s){T[i].addStyleClass("selected");if(t._isScrollingNecessary(T[i].$()[0],q("#"+l.sId)[0])){t._scrollToItem(T[i].$()[0],q("#"+l.sId)[0]);}}else{T[i].removeStyleClass("selected");}}}}};
f.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails();};
f.prototype._getStepThumbnails=function(){var p=function(s,i,j){var t,k,l;try{var m=i.Scene.RetrieveThumbnail(s,j.id);if(m===sap.ve.dvl.DVLRESULT.NOTFOUND){t=this._emptyThumbnail;}else{t=g(m);}l=t.substring(0,3);if(l==="iVB"){k="png";}else{k="jpg";}j.thumbnailData=t;j.thumbnailType=k;}catch(n){if(n.code!==sap.ve.dvl.DVLRESULT.NOTFOUND){q.sap.log.error(n.message,n.code,"sap.ui.vk.StepNavigation");}j.thumbnailData=null;j.thumbnailType=null;}};var e=this._retrieveProcedures();if(e.sceneId!=null){e.procedures.forEach(function(i){i.steps.forEach(p.bind(this,e.sceneId,this.oDvl));},this);e.portfolios.forEach(function(i){i.steps.forEach(p.bind(this,e.sceneId,this.oDvl));},this);e.hasThumbnails=true;}this._procedures=e;return e;};
f.prototype._retrieveProcedures=function(i){var t=this;var p={};if(!t._procedures){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};}else{p=t._procedures;}if(t._scene&&(p.sceneId!=(i||t._scene._dvlSceneRef))){var s=i||t._scene._dvlSceneRef;if(s!=null){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};try{var j=b(t.oDvl.Scene.RetrieveProcedures(s));if(j!=null){p.hasThumbnails=false;p.sceneId=t._scene._dvlSceneRef;p.procedures=j.procedures;p.portfolios=j.portfolios;}}catch(e){if(!(e instanceof D&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e;}}}}return p;};
f.prototype.getStep=function(r,e,s){var t=this;var i=t.oDvl.Settings.LastLoadedSceneId;var j=null;if(i!=null){e=e!=null?e:0;var k=s?s:t.instanceSettings.currentStepId;var p=t._retrieveProcedures(i);var l=p.procedures[e];if(l&&l.steps.length>0){j=l.steps[0];}else{return null;}if(k!=""){for(var m=0;m<l.steps.length;m++){var _=l.steps[m];if(_.id==k){var x=m+r;if(x<l.steps.length&&x>=0){j=l.steps[x];}else{j=null;}break;}}}}return j;};
f.prototype.pauseStep=function(){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.oDvl.Scene.PauseCurrentStep(s);}};
f.prototype._stepCount=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var i=0;if(s!=null){var p=t._retrieveProcedures(s);for(var j=0;j<p.procedures.length;j++){if(p.procedures[j].id==e){i=p.procedures[j].steps.length;break;}else if(e==null){i+=p.procedures[j].steps.length;}}}return i;};
f.prototype.getPreviousStep=function(p){var t=this;return t.getStep(-1,p);};
f.prototype.getNextStep=function(p){var t=this;return t.getStep(1,p);};
f.prototype.playStep=function(e,i,j){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.instanceSettings.currentStepId=e;t.oDvl.Scene.ActivateStep(s,e,i!=null?i:true,j!=null?j:false);}};
f.prototype.playAllSteps=function(p){var t=this;var e=t.oDvl.Settings.LastLoadedSceneId;if(e!=null){var i=t._retrieveProcedures(e);var j=0;if(p!=null&&i.procedures.length>1){for(var k=0;k<i.procedures.length;k++){if(i.procedures[k].id==p){j=k;break;}}}if(i.procedures.length>0){var s=i.procedures[j].steps[0];if(s){t.instanceSettings.currentStepId=s.id;t.oDvl.Scene.ActivateStep(e,s.id,true,true);}}}};
f.prototype._setContent=function(e){var s=null;if(e&&e instanceof c){s=e;}this.setScene(s);};
f.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
f.prototype._onBeforeClearContentConnector=function(){this.setScene(null);};
f.prototype._handleContentReplaced=function(e){var i=e.getParameter("newContent");this._setContent(i);};
a.injectMethodsIntoClass(f);return f;});
sap.ui.predefine('sap/ui/vk/StepNavigationRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){if(!c.getVisible()){return;}if(c.getShowToolbar()||c.getShowThumbnails){var w=c.getWidth()!=="auto"?c.getWidth():"100%";var h=c.getHeight()!=="auto"?c.getHeight():"auto";r.write("<div");r.addStyle("width",w);r.addStyle("height",h);r.writeControlData(c);r.addClass("sapVizKitStepNavigation");r.writeClasses();var t=c.getTooltip_AsString();if(t){r.writeAttributeEscaped("title",t);}if(!c.getVisible()){r.addStyle("visibility","hidden");}r.writeStyles();r.write(">");r.renderControl(c.getAggregation("layout"));if(c.getShowThumbnails()){S._renderScrollerDiv(r,c);}r.write("</div>");}};
S._renderScrollerDiv=function(r,c){r.renderControl(c.getAggregation("thumbnailsContainer"));};
return S;},true);
sap.ui.predefine('sap/ui/vk/Texture',["sap/ui/base/ManagedObject"],function(M){"use strict";
var T=M.extend("sap.ui.vk.Texture",{metadata:{properties:{"id":{type:"string"},"filterMode":{type:"int",defaultValue:0},"uvRotationAngle":{type:"float",defaultValue:0.0},"uvHorizontalOffset":{type:"float",defaultValue:0.0},"uvVerticalOffset":{type:"float",defaultValue:0.0},"uvHorizontalScale":{type:"float",defaultValue:0.0},"uvVerticalScale":{type:"float",defaultValue:0.0},"uvHorizontalTilingEnabled":{type:"boolean",defaultValue:true},"uvVerticalTilingEnabled":{type:"boolean",defaultValue:true}}}});
T.prototype.load=function(i){return this;};
T.prototype.getTextRef=function(){return null;};
return T;});
sap.ui.predefine('sap/ui/vk/Toolbar',["./library","sap/ui/core/Control","./ToolbarRenderer","./getResourceBundle"],function(v,C,T,g){"use strict";
var a=C.extend("sap.ui.vk.Toolbar",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",group:"Appearance",defaultValue:""}},events:{},associations:{viewer:{type:"sap.ui.vk.Viewer",cardinality:"0..1"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}},_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},_helpButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_stepNavigationButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_sceneTreeButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_enterFullScreenButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_exitFullScreenButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_toolbarTitle:{type:"sap.m.Title",multiple:false,visibility:"hidden"}}}});
a.prototype._getToolbar=function(){return this._toolbar;};
a.prototype._onSceneTree=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.sceneTree.userInteractionShow=this._sceneTreeButton.getPressed();this.oViewer.setShowSceneTree(this.oViewer._componentsState.sceneTree.userInteractionShow);}};
a.prototype._onStepNavigation=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.stepNavigation.userInteractionShow=this._stepNavigationButton.getPressed();this.oViewer.setShowStepNavigation(this.oViewer._componentsState.stepNavigation.userInteractionShow);}};
a.prototype._onFullScreen=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){var n=this._enterFullScreenButton.getPressed();this.oViewer.activateFullScreenMode(n);}};
a.prototype._fullScreenHandler=function(e){var f=e.mParameters.isFullScreen;this._enterFullScreenButton.setPressed(f);if(f){this._enterFullScreenButton.setIcon("sap-icon://exit-full-screen");}else{this._enterFullScreenButton.setIcon("sap-icon://full-screen");}};
a.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var _=new sap.m.Button({icon:"sap-icon://sys-help",type:sap.m.ButtonType.Transparent,tooltip:g().getText("VIEWER_HELPBUTTONTOOLTIP")});this.setAggregation("_helpButton",_);this._stepNavigationButton=new sap.m.ToggleButton({icon:"sap-icon://step",type:sap.m.ButtonType.Transparent,enabled:false,tooltip:g().getText("STEP_NAV_MENUBUTTONTOOLTIP"),press:this._onStepNavigation.bind(this)});this.setAggregation("_stepNavigationButton",this._stepNavigationButton);this._sceneTreeButton=new sap.m.ToggleButton({icon:"sap-icon://tree",type:sap.m.ButtonType.Transparent,tooltip:g().getText("SCENETREE_MENUBUTTONTOOLTIP"),press:this._onSceneTree.bind(this)});this.setAggregation("_sceneTreeButton",this._sceneTreeButton);this._toolbarTitle=new sap.m.Title();this.setAggregation("_toolbarTitle",this._toolbarTitle);this._enterFullScreenButton=new sap.m.ToggleButton({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,tooltip:g().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:this._onFullScreen.bind(this)});this.setAggregation("_enterFullScreenButton",this._enterFullScreenButton);var b=new sap.m.Button({icon:"sap-icon://exit-full-screen",type:sap.m.ButtonType.Transparent,tooltip:g().getText("VIEWER_FULLSCREENBUTTONTOOLTIP")});this.setAggregation("_exitFullScreenButton",b);var t=t=[new sap.m.ToolbarSpacer(),this._toolbarTitle,new sap.m.ToolbarSpacer(),new sap.m.ToolbarSeparator(),this._sceneTreeButton,new sap.m.ToolbarSeparator(),this._stepNavigationButton,new sap.m.ToolbarSeparator(),this._enterFullScreenButton];this._toolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:t});this.setAggregation("_toolbar",this._toolbar,true);};
a.prototype.exit=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer){this.oViewer.detachFullScreen(this._fullScreenHandler.bind(this));}};
a.prototype.onBeforeRendering=function(){this._toolbar.setVisible(true);this._toolbarTitle.setText(this.getTitle());};
a.prototype.refresh=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());this._stepNavigationButton.setPressed(this.oViewer.getShowStepNavigation());this._stepNavigationButton.setEnabled(this.oViewer.getEnableStepNavigation());this._sceneTreeButton.setPressed(this.oViewer.getShowSceneTree());this._sceneTreeButton.setEnabled(this.oViewer.getEnableSceneTree());this.oViewer.attachFullScreen(this._fullScreenHandler.bind(this));return true;};
a.prototype.onAfterRendering=function(){this.refresh();};
return a;});
sap.ui.predefine('sap/ui/vk/ToolbarRenderer',[],function(){"use strict";var T={};
T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitToolbar");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_toolbar"));r.write("</div>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/TransformationMatrix',["jquery.sap.global","sap/ui/base/DataType"],function(q,D){"use strict";var T=D.getType("float[]");
T.parseValue=function(v){var c=T.getComponentType();return v.split(/\s*,\s*|\s+/).map(c.parseValue.bind(c));};
T.convertTo4x4=function(a){var m=a;return[m[0],m[1],m[2],0,m[3],m[4],m[5],0,m[6],m[7],m[8],0,m[9],m[10],m[11],1];};
T.convertTo4x3=function(a){var m=a;return[m[0],m[1],m[2],m[4],m[5],m[6],m[8],m[9],m[10],m[12],m[13],m[14]];};
return T;},true);
sap.ui.predefine('sap/ui/vk/View',["sap/ui/base/ManagedObject","sap/ui/model/json/JSONModel","./findIndexInArray","./AnimationPlayback","./Core"],function(M,J,f,A,v){"use strict";
var V=M.extend("sap.ui.vk.View",{metadata:{library:"sap.ui.vk",interfaces:["sap.ui.vk.IPlaybackCollection"],properties:{viewId:{type:"string"},name:{type:"string"},description:{type:"string"},aspectRatio:{type:"float"}}}});
V.prototype.init=function(){this._playbacks=[];this._playbacksJSONData=[];this._model=new J({playbacks:this._playbacksJSONData});this._model.setSizeLimit(1000*1000);this._highlightIdNodesMap=new Map();};
V.prototype.exit=function(){this._playbacks=undefined;this._playbacksJSONData=undefined;this._highlightIdNodesMap=undefined;};
V.prototype.getCamera=function(){return this._camera;};
V.prototype.setCamera=function(c){this._camera=c;return this;};
V.prototype.hasHighlight=function(){return this._highlightIdNodesMap&&this._highlightIdNodesMap.size;};
V.prototype.getHighlightIdNodesMap=function(){return this._highlightIdNodesMap;};
V.prototype.addHighlightedNodes=function(h,n){var a=this._highlightIdNodesMap.get(h);if(!Array.isArray(n)){n=[n];}if(!a){this._highlightIdNodesMap.set(h,n);}else{a=a.concat(n.filter(function(i){return a.indexOf(i)<0;}));this._highlightIdNodesMap.set(h,a);}};
V.prototype.hasAnimation=function(){return this._playbacks&&this._playbacks.length;};
V.prototype.getPlaybacks=function(){return this._playbacks;};
V.prototype.getPlayback=function(i){if(i<0||i>=this._playbacks.length){return undefined;}return this._playbacks[i];};
V.prototype.indexOfPlayback=function(p){return f(this._playbacks,function(i){return i===p;});};
V.prototype.addPlayback=function(p){this._playbacks.push(p);this._playbacksJSONData.push(p.getJSONData());if(this._model){this._model.updateBindings();}p.setJSONModel(this._model);return this;};
V.prototype.insertPlayback=function(p,i,b){if(i<0){i=0;}else if(i!==0&&i>=this._playbacks.length){i=this._playbacks.length;}this._playbacks.splice(i,0,p);this._playbacksJSONData.splice(i,0,p.getJSONData());if(this._model){this._model.updateBindings();}if(!b){this._firePlaybacksChanged();}return this;};
V.prototype.sortPlaybacks=function(p,a,b){this._playbacks.sort(function(e,g){return e.getStartTime()-g.getStartTime();});this._playbacksJSONData=[];this._playbacks.forEach(function(p){this._playbacksJSONData.push(p.getJSONData());}.bind(this));var c=true;for(var i=0;i<this._playbacks.length-1;i++){var s=this._playbacks[i].getStartTime();var d=this._playbacks[i+1].getStartTime();if(d-s<0.00001){c=false;break;}}if(!b){this._firePlaybacksChanged();}return c;};
V.prototype.removePlayback=function(o,b){var i;if(typeof o==="number"){i=o;}else if(typeof o==="string"){i=f(this._playbacks,function(a){return a.getId()===o;});}else{i=f(this._playbacks,function(a){return a===o;});}if(i!=null&&i>=0&&i<this._playbacks.length){this._playbacks.splice(i,1);this._playbacksJSONData.splice(i,1);if(this._model){this._model.updateBindings();}}if(!b){this._firePlaybacksChanged();}return this;};
V.prototype.removePlaybacks=function(b){this._playbacks.splice(0);this._playbacksJSONData.splice(0);if(this._model){this._model.updateBindings();}if(!b){this._firePlaybacksChanged();}return this;};
V.prototype.switchPlaybacks=function(p,a,b){var c,d;for(var i=0;i<this._playbacks.length;i++){if(this._playbacks[i]===p){c=i;}else if(this._playbacks[i]===a){d=i;}}if(c!==undefined&&d!==undefined){var t=this._playbacks[c];var e=this._playbacksJSONData[c];this._playbacks[c]=this._playbacks[d];this._playbacksJSONData[c]=this._playbacksJSONData[d];this._playbacks[d]=t;this._playbacksJSONData[d]=e;}this.resetPlaybacksStartTimes(true);if(!b){this._firePlaybacksChanged();}return this;};
V.prototype.resetPlaybacksStartTimes=function(b){if(this._playbacks.length===0){return this;}var r=this._playbacks[0].getReversed();var s=0;var i;if(!r){for(i=0;i<this._playbacks.length;i++){this._playbacks[i].setStartTime(s);s+=this._playbacks[i].getDuration();}}else{for(i=this._playbacks.length-1;i>-1;i--){this._playbacks[i].setStartTime(s);s+=this._playbacks[i].getDuration();}}if(!b){this._firePlaybacksChanged();}return this;};
V.prototype._firePlaybacksChanged=function(){v.getEventBus().publish("sap.ui.vk","playbacksChanged",{viewId:this.getViewId()});};
V.prototype.setPlaybacksReversed=function(r,b){for(var i=0;i<this._playbacks.length;i++){this._playbacks[i].setReversed(r);}this.resetPlaybacksStartTimes(true);if(!b){this._firePlaybacksChanged();}return this;};
V.prototype.getNodeInfos=function(){return this._nodeInfos;};
V.prototype.setNodeInfos=function(i){this._nodeInfos=i;return this;};
V.prototype.updateNodeInfos=function(u){var c=this.getNodeInfos();if(!c){return this.setNodeInfos(u);}var i=new Map();c.forEach(function(d,a){i.set(d.target,a);});var m=function(d,s){for(var p in s){d[p]=s[p];}};u.forEach(function(d){var a=i.get(d.target);if(a==null){c.push(d);}else{m(c[a],d);}});this.setNodeInfos(c);return this;};
V.prototype.getModel=function(){return this._model;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewGallery',["sap/ui/core/Control","./library","./Core","./ContentConnector","sap/m/Slider","./ViewGalleryRenderer","./getResourceBundle","./ViewGalleryThumbnail","sap/m/HBox","sap/m/VBox","sap/m/FormattedText","sap/m/FlexItemData","sap/m/Image","sap/m/ScrollContainer","sap/m/Button","sap/m/ToggleButton","sap/m/Toolbar","sap/m/Popover","sap/m/Title","sap/m/SelectList","sap/m/ToolbarSpacer","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragInfo"],function(C,v,a,b,A,V,g,c,H,d,F,e,I,S,B,T,f,P,h,l,m,J,D,o){"use strict";
var p=C.extend("sap.ui.vk.ViewGallery",{metadata:{library:"sap.ui.vk",properties:{showAnimationTimeSlider:{type:"boolean",defaultValue:true},showToolbar:{type:"boolean",defaultValue:true},showThumbnailContainer:{type:"boolean",defaultValue:true},selectedViewIndex:{type:"int",defaultValue:-1},selectedViewGroupIndex:{type:"int",defaultValue:-1},enableViewReordering:{type:"boolean",defaultValue:false},transparency:{type:"float",defaultValue:1}},associations:{host:{type:"sap.ui.core.Control"},contentConnector:{type:"sap.ui.vk.ContentConnector"},viewManager:{type:"sap.ui.vk.ViewManager"}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},container:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"},animationTimeSlider:{type:"sap.m.Slider",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{item:"sap.ui.core.Control"}},viewOrderChange:{parameters:{view:"sap.ui.vk.View",viewIndex:"int"}}}}});
p.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var t=this;window.addEventListener("resize",function(){t.resizeToolbarSpacer();},true);this._scene=null;this._vkScene=null;this._viewItems=[];this._cdsLoader=null;this._selectedGroupIndex=-1;this._previousOrientationVertical=false;this._playingAnimation=true;this._draggedModelView={};this._animationPlayer=null;this._manualTimeChange=false;sap.ui.core.IconPool.addIcon("landscape-text","vk-icons","vk-icons","e019");sap.ui.core.IconPool.addIcon("portrait-text","vk-icons","vk-icons","e01a");this.oModel=new J();if(this.getShowThumbnailContainer()){this.createThumbnailContainer();}if(this.getShowToolbar()){this.createToolbar();}if(this.getShowAnimationTimeSlider()){this.setAggregation("animationTimeSlider",new A());this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}a.getEventBus().subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);a.getEventBus().subscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);};
p.prototype.exit=function(){a.getEventBus().unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);a.getEventBus().unsubscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);};
p.prototype._getViewManager=function(){var i=this.getViewManager();if(i){return sap.ui.getCore().byId(i);}return undefined;};
p.prototype._getSelectedViewGroup=function(){var i=this.getSelectedViewGroupIndex();var r;if(this._vkScene){var j=this._vkScene.getViewGroups();if(i>=0&&i<j.length){r=j[i];}}return r;};
p.prototype._getSelectedView=function(){var r;var i=this.getSelectedViewIndex();var j=this._getViews();if(j&&i>=0&&i<j.length){r=j[i];}return r;};
p.prototype._getViewGroups=function(){var r;if(this._vkScene){r=this._vkScene.getViewGroups();}return r;};
p.prototype._getViews=function(){var i=this._getSelectedViewGroup();var j;if(i){j=i.getViews();}else if(this._vkScene){j=this._vkScene.getViews();}return j;};
p.prototype._getViewIndex=function(i){var r=-1;var j=this._getViews();if(Array.isArray(j)){r=j.indexOf(i);}return r;};
p.prototype._getViewAnimationDuration=function(i){i=i||this._getSelectedView();var r;if(i){var j=i.getPlaybacks();if(Array.isArray(j)&&j.length){r=j.reduce(function(k,n){return k+n.getDuration();},0);}}return r;};
p.prototype.setVisible=function(i){if(C.prototype.setVisible){C.prototype.setVisible.call(this,i);}this.setDescription();};
p.prototype.resizeToolbarSpacer=function(){if(this.getDomRef()){var i=this._nextItemButton.getDomRef().getBoundingClientRect().width;i+=this._playButton.getDomRef().getBoundingClientRect().width;i+=this._previousItemButton.getDomRef().getBoundingClientRect().width;var t=this.toolbar.getDomRef().getBoundingClientRect().width;var w=(i/t)*100;var j=50-w;this._toolbarSpacer.setWidth(j+"%");}};
p.prototype.onAfterRendering=function(){this.resizeToolbarSpacer();if(document.getElementById("body")){var i=window.getComputedStyle(document.getElementById("body"));var j=i.getPropertyValue("background-color");var t;var k=this.getDomRef();if(j){if(j.indexOf("a")===-1){t=j.replace("rgb","rgba").replace(")",", "+this.getTransparency()+")");k.style.backgroundColor=t;}else{var r=new RegExp("([^,]*)$");t=j.replace(r," "+this.getTransparency()+")");k.style.backgroundColor=t;}}if(this.toolbar){var n=this.toolbar.getDomRef();n.style.backgroundColor="rgba(0, 0, 0, 0)";}}var s=null;if(this.getHost()){s=sap.ui.getCore().byId(this.getHost());if(s.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes();}}};
p.prototype.setShowAnimationTimeSlider=function(i){this.setProperty("showAnimationTimeSlider",i);if(i){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAggregation("animationTimeSlider",new A());this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}else{this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.destroyAggregation("animationTimeSlider");}this._setupAnimationSlider();};
p.prototype.getAnimationTimeSlider=function(){return this.getAggregation("animationTimeSlider");};
p.prototype.destroyToolbar=function(){this.destroyAggregation("toolbar");};
p.prototype.destroyThumbnailContainer=function(){this.destroyAggregation("container");};
p.prototype.createThumbnailContainer=function(){var t=this;this._hbox=new H();if(this.getEnableViewReordering()){this._hbox.addDragDropConfig(new D({dropEffect:sap.ui.core.dnd.DropEffect.Move,dropPosition:sap.ui.core.dnd.DropPosition.On,targetAggregation:"items",drop:function(E){var i=E.getParameter("droppedControl");t.reorderViews(i);t.fireViewOrderChange({view:t._draggedModelView,viewIndex:t._viewItems.indexOf(i)});}}));this._hbox.getMetadata().getAggregation().dnd.droppable=true;}this._scrollContainer=new S(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true,content:[this._hbox]});this._scrollContainer.addStyleClass("sapVizKitViewGalleryScrollContainer");this.setAggregation("container",this._scrollContainer);};
p.prototype.reorderViews=function(i){var j=this._modelViews.indexOf(this._draggedModelView);this._modelViews.splice(j,1);var k=this._viewItems.indexOf(i);this._modelViews.splice(k,0,this._draggedModelView);this._refreshItems();};
p.prototype.createToolbar=function(){var t=this;this.toolbar=new f({design:sap.m.ToolbarDesign.Auto});this.setAggregation("toolbar",this.toolbar);this._previousItemButton=new B(this.getId()+"-previousItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://close-command-field",tooltip:g().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(j){var i=t.getSelectedViewIndex();if(i>0){t.setSelectedItem(t._viewItems[i-1]);}}});this._nextItemButton=new B(this.getId()+"-nextItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://open-command-field",tooltip:g().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(j){var i=t.getSelectedViewIndex();if(i>=0&&i+1<t._viewItems.length){t.setSelectedItem(t._viewItems[i+1]);}}});this._viewGroupSelector=new P({showHeader:false,contentWidth:"20%",placement:sap.m.PlacementType.Top,horizontalScrolling:false,verticalScrolling:false,content:[new S({horizontal:false,vertical:true,content:[this._procedureList=new l({width:"100%",itemPress:function(i){t._clearUI();var j=this.indexOfItem(i.getParameter("item"));t.setSelectedViewGroupIndex(j);}})]})]});this._playButton=new T(this.getId()+"-playButton",{type:sap.m.ButtonType.Transparent,pressed:false,icon:"sap-icon://media-play",visible:true,tooltip:g().getText("STEP_NAV_PLAYMENU_PLAY"),press:function(E){this._setPlayState(E.getSource().getPressed());if(E.getSource().getPressed()){this._playProcedure();}else{this._pauseAnimation();}}.bind(this)});this._stepCount=new h({textAlign:sap.ui.core.TextAlign.Right,level:"H5",titleStyle:"H5"});this._currentGroupTitle=new h({text:g().getText("STEP_NAV_PROCEDURES"),tooltip:g().getText("STEP_NAV_PROCEDURES"),level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentGroupTitle");this._separatorTitle=new h({width:(5/1920)*100+"%",level:"H5",titleStyle:"H5"});this._currentStepTitle=new h({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentStepTitle");this._currentGroupTitle.addEventDelegate({ontap:function(){this._viewGroupSelector.openBy(this._currentGroupTitle);}.bind(this)});this._toolbarSpacer=new m();this.toolbar.addContent(this._currentGroupTitle).addContent(this._separatorTitle).addContent(this._currentStepTitle).addContent(new m()).addContent(this._stepCount).addContent(this._toolbarSpacer).addContent(this._previousItemButton).addContent(this._playButton).addContent(this._nextItemButton);};
p.prototype._setPlayState=function(i){if(this.getAggregation("toolbar")){this._playButton.setPressed(i);if(i){this._playButton.setIcon("sap-icon://media-pause");this._playButton.setTooltip(g().getText("STEP_NAV_PLAYMENU_PAUSE"));}else{this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(g().getText("STEP_NAV_PLAYMENU_PLAY"));}}};
p.prototype._createStepDescriptionBoxes=function(){this._stepDescription=new d({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionToolbar=new f({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-up-arrow",press:function(i){this._toggleViewDescription();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionIcon sapVizKitViewGalleryStepDescriptionIconTransform"),new m(),this._stepDescriptionOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/landscape-text",press:function(i){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionOrientationIcon")],layoutData:new e({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionToolbar"),this._stepDescriptionScroll=new S({horizontal:false,vertical:true,content:[this._stepDescriptionText=new F({visible:true}).addStyleClass("sapVizKitViewGalleryStepDescriptionText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionScroll")]}).addStyleClass("sapVizKitViewGalleryStepDescription");this._stepDescription.vitId="VIT-StepDescription";this._stepDescriptionVertical=new H({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionVerticalScroll=new S({horizontal:false,vertical:true,content:[this._stepDescriptionVerticalText=new F({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalScroll"),this._stepDescriptionVerticalToolbar=new f({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionVerticalIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-right-arrow",press:function(i){this._toggleViewDescriptionVertical();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalIcon sapVizKitViewGalleryStepDescriptionIconTransform"),this._stepDescriptionVerticalOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/portrait-text",press:function(i){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalOrientationIcon")],layoutData:new e({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalToolbar")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVertical");this._stepDescriptionVertical.vitId="VIT-StepDescriptionVertical";};
p.prototype.adjustStepDescriptionBoxes=function(){if(this._stepDescription.getDomRef()){var i=this.getDomRef().getBoundingClientRect().height;var s=this._stepDescription.getDomRef().id;var j=this._stepDescriptionVertical.getDomRef().id;document.getElementById(s).style.bottom=i+"px";document.getElementById(j).style.bottom=i+"px";var k=sap.ui.getCore().byId(this.getHost());var n=k.getDomRef().getBoundingClientRect().height;document.getElementById(j).style.height=n-i+"px";}};
p.prototype._toggleOrientation=function(){if(this._stepDescriptionToolbar.getVisible()){this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;if(this._stepDescriptionText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);}this._stepDescriptionText.setVisible(false);}else{this._stepDescriptionToolbar.setVisible(true);this._previousOrientationVertical=false;if(this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionText.setVisible(true);}this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionVerticalText.setVisible(false);}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();var i=null;if(this.getHost()){i=sap.ui.getCore().byId(this.getHost());if(i.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes();}}};
p.prototype._toggleViewDescription=function(){if(!this._stepDescriptionText.getVisible()){this._stepDescriptionText.setVisible(true);this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionText.rerender();};
p.prototype._toggleViewDescriptionVertical=function(){if(!this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionVerticalText.rerender();};
p.prototype._getHBox=function(){return this._hbox;};
p.prototype._playProcedure=function(){this._manualTimeChange=false;var i=this._getViewManager();if(i){var s=this._getSelectedView();if(!s){var j=this._getViews();if(j&&j.length){s=j[0];}}if(s){i.playViewGroup(s,this._getSelectedViewGroup());}}};
p.prototype._pauseAnimation=function(){var i=this._getViewManager();if(i){i.stopPlayingViewGroup();}};
p.prototype.setPlayingAnimation=function(i){this._playingAnimation=i;};
p.prototype.setAnimationPlayer=function(i){if(this._animationPlayer){this._animationPlayer.detachTimeChanged(this._onAnimationPlayerTimeChanged,this);this._animationPlayer.detachStateChanged(this._onAnimationPlayerStateChanged,this);}this._animationPlayer=i;if(this._animationPlayer){this._animationPlayer.attachTimeChanged(this._onAnimationPlayerTimeChanged,this);this._animationPlayer.attachStateChanged(this._onAnimationPlayerStateChanged,this);}this._setupAnimationSlider();};
p.prototype._setupAnimationSlider=function(){var i=this.getAnimationTimeSlider();if(i&&this._animationPlayer){var j=this._getViewAnimationDuration();if(j){i.setMax(j);i.setStep(j/100);i.setValue(this._animationPlayer.getTime());}}};
p.prototype._onAnimationPlayerTimeChanged=function(i){var t=i.getParameter("time");var j=this.getAnimationTimeSlider();if(j){j.setValue(t);}};
p.prototype._onAnimationPlayerStateChanged=function(i){var j=i.getParameter("playing");this._setPlayState(j);};
p.prototype._onProcedureFinished=function(i){this._setPlayState(false);};
p.prototype.setScene=function(s){if(s&&s.getSceneRef()===this._scene){return;}if(s&&s.loaders){for(var i=0;i<s.loaders.length;i++){var j=s.loaders[i];if(j&&j.getMetadata&&j.getMetadata().getName()==="sap.ui.vk.threejs.ContentDeliveryService"){this._cdsLoader=j;this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this);this._cdsLoader.attachLoadingFinished(this._handleCdsViewGroupUpdate,this);break;}}}this._vkScene=s;this._scene=s?s.getSceneRef():null;this._refreshProcedures();this._resetCurrentView();};
p.prototype._onViewActivated=function(n,r,s){var t;var u=s.view;var w=this._getViewGroups();if(w&&w.length>0){var x=w[this.getSelectedViewGroupIndex()];if(x&&x.getViewGroupId()!=u.viewGroupId){for(var i=0;i<w.length;i++){if(w[i].getViewGroupId()===u.viewGroupId){for(var k=0;k<w[i].getViews().length;k++){if(w[i].getViews()[k]===u){t=k;this.setSelectedViewGroupIndex(i,t);break;}}}}}else{for(var j=0;x&&j<x.getViews().length;j++){if(x.getViews()[j]===u){t=j;this.viewActivated(t,u);break;}}}}};
p.prototype.setHost=function(j){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAssociation("host",j,true);if(j){if(j.getContent()){var k=function(n){var r=j.getContent();for(var i=0;i<r.length;i++){if(r[i].vitId==n){return i;}}};j.removeContent(k("VIT-StepDescription"));j.removeContent(k("VIT-StepDescriptionVertical"));}this._createStepDescriptionBoxes();j.addContent(this._stepDescription);j.addContent(this._stepDescriptionVertical);this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}};
p.prototype._attachAnimationTimeSlider=function(i){if(!i){return;}i.attachChange(this._onSliderValueChange,this);i.attachLiveChange(this._onSliderValueLiveChange,this);};
p.prototype._detachAnimationTimeSlider=function(i){if(!i){return;}i.detachChange(this._onSliderValueChange,this);i.detachLiveChange(this._onSliderValueLiveChange,this);};
p.prototype._onSliderValueLiveChange=function(i){var j=i.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==j){this._animationPlayer.setTime(j);}};
p.prototype._onSliderValueChange=function(i){var j=i.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==j){this._animationPlayer.setTime(j);}};
p.prototype._refreshProcedures=function(i){if(this.getAggregation("toolbar")){this._procedureList.removeAllItems();}this._modelViews=null;if(this._scene&&this._scene.userData){var j=this._getViewGroups();if(j&&j.length>0){this._selectedGroupIndex=0;var k=0;j.forEach(function(n){if(this.getAggregation("toolbar")){this._procedureList.addItem(new sap.ui.core.Item({key:n.getViewGroupId(),text:n.getName()}));}if(i&&n.getViewGroupId()===i){this._selectedGroupIndex=k;}k++;}.bind(this));this._modelViews=this._getViews();if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(j[this._selectedGroupIndex].getName()).setTooltip(j[this._selectedGroupIndex].getName());}}else if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(g().getText("STEP_NAV_PROCEDURES"));}}this._refreshItems();};
p.prototype.refresh=function(s){this.setScene(s);};
var q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";
p.prototype._clearUI=function(){if(this.getAggregation("toolbar")){this._currentStepTitle.setText("");this._separatorTitle.setText("");this._viewGroupSelector.close();this._nextItemButton.setEnabled(false);this._previousItemButton.setEnabled(false);this._stepCount.setText("");this._stepDescriptionText.setHtmlText("");this._stepDescriptionVerticalText.setHtmlText("");}if(this.getAggregation("container")){this._hbox.removeAllItems();}this._viewItems=[];this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);};
p.prototype._refreshItems=function(){this._clearUI();var t=this;if(this._modelViews){var j=function(i){this.setSelectedItem(i.getSource());}.bind(this);this._modelViews.forEach(function(k){var n=true;var r=k.name||k.getName&&k.getName();var s=new c({alt:r,densityAware:false,tooltip:r,viewGallery:this,source:k.thumbnailData||q,press:function(i){s.detachBrowserEvent("mouseenter",function(i){t.startAnimate();});s.setSource(k.thumbnailData||q);clearInterval(i.getSource().interval);j(i);},layoutData:new e({shrinkFactor:0})});var u=function(w,y){var z=w.width/y;var E=w.height;var G=y;var K=E;var L=document.createElement("canvas");var M=L.getContext("2d");var N=[];L.width=G;L.height=K;for(var i=0;i<z;i++){var x=G*i;M.clearRect(0,0,G,K);M.drawImage(w,x,0,G,K,0,0,G,K);N.push(L.toDataURL());}t.startAnimate=function(){if(n){n=false;s.detachBrowserEvent("mouseenter",function(Q){t.startAnimate();});var i=0;var O=function(){if(i<z){s.setSource(N[i]);i++;}else{s.setSource(N[0]);i=0;}};s.interval=setInterval(function(){O();},250);}};s.attachBrowserEvent("mouseenter",function(O){t.startAnimate();});s.attachBrowserEvent("mouseout",function(O){n=true;s.attachBrowserEvent("mouseenter",function(O){t.startAnimate();});clearInterval(s.interval);s.setSource(k.thumbnailData);});};if(k.animatedThumbnailData!==undefined){var w=document.createElement("img");w.onload=function(){u(w,k.tileWidth);};w.src=k.animatedThumbnailData;}if(this.getEnableViewReordering()){s.addDragDropConfig(new o({dragStart:function(){t._draggedModelView=k;}}));s.getMetadata().dnd.draggable=true;}s.data("modelView",k);this._viewItems.push(s);if(this.getAggregation("container")){this._hbox.addItem(s);}}.bind(this));this.rerender();}};
p.prototype.setSelectedItem=function(i){if(i.getCustomData().length>0){var j=i.getCustomData()[0].getValue();var k=this._getViewManager();if(k){k.activateView(j);}}return this;};
p.prototype.setDescription=function(){if(!this._selectedItem){return;}if(!this.getVisible()){this._stepDescription.setVisible(false);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVertical.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);return;}if(this._selectedItem.getCustomData().length>0){var i=this._selectedItem.getCustomData()[0].getValue();var j=i.getDescription();if(j){if(this._previousOrientationVertical===false){this._stepDescription.setVisible(true);this._stepDescriptionToolbar.setVisible(true);this._stepDescriptionVerticalToolbar.setVisible(false);}else{this._stepDescriptionVertical.setVisible(true);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;}}else if(this._previousOrientationVertical===true){this._stepDescriptionVertical.setVisible(false);}else{this._stepDescription.setVisible(false);this._previousOrientationVertical=false;}if(j!=null){this._stepDescriptionText.setHtmlText(j);this._stepDescriptionVerticalText.setHtmlText(j);}}};
p.prototype.viewActivated=function(i){if(this._selectedItem){if(this.getSelectedViewIndex()!==i){this._selectedItem.removeStyleClass("selected");}}this._selectedItem=this._viewItems[i];if(!this._selectedItem){return this;}if(this.getAggregation("toolbar")){var t=g().getText("VIEWS_TITLE_WITH_COUNT",[i+1,this._viewItems.length]);this._stepCount.setText(t);this._previousItemButton.setEnabled(this._selectedItem!==this._viewItems[0]&&this._viewItems.length>1);this._nextItemButton.setEnabled(this._selectedItem!==this._viewItems[this._viewItems.length-1]&&this._viewItems.length>1);this._setPlayState(true);}this._selectedItem.addStyleClass("selected");if(this._isScrollingNecessary(this._selectedItem.getDomRef(),this._scrollContainer.getDomRef())){this._scrollContainer.scrollToElement(this._selectedItem,500);}if(this._selectedItem.getCustomData().length>0){var j=this._selectedItem.getCustomData()[0].getValue();var k=j.getPlaybacks();var s=this.getAnimationTimeSlider();if(s){if(!k||k.length===0){s.setEnabled(false);s.setValue(0);}else{s.setEnabled(true);}}var n=j.name||j.getName&&j.getName();if(this.getAggregation("toolbar")){this._separatorTitle.setText("/");this._currentStepTitle.setText(n).setTooltip(n);}}this.setDescription();this.fireSelectionChange({item:this._selectedItem});this._setupAnimationSlider();return this;};
p.prototype.getSelectedItem=function(){return this._selectedItem;};
p.prototype.getSelectedViewIndex=function(){for(var n=0;n<this._viewItems.length;n++){if(this._viewItems[n]===this.getSelectedItem()){return n;}}return-1;};
p.prototype.setSelectedViewIndex=function(i){if(this._viewItems.length>i){this.setSelectedItem(this._viewItems[i]);}};
p.prototype.getSelectedViewGroupIndex=function(){return this._selectedGroupIndex;};
p.prototype.setSelectedViewGroupIndex=function(i,j){var k=this._getViewGroups();if(k&&k.length>i){this._selectedGroupIndex=i;if(j==null){j=0;}this._currentGroupTitle.setText(k[i].getName()).setTooltip(k[i].getName());this._separatorTitle.setVisible(true);this._modelViews=this._getViews();if((!this._modelViews||this._modelViews.length===0)&&this._cdsLoader){var n=k[i].getViewGroupId();var s=k[i].sceneId;var t=this;this._cdsLoader.loadViewGroup(s,n).then(function(r){t._refreshItems();t.setSelectedViewIndex(j);});}else{this._refreshItems();this.setSelectedViewIndex(j);}}};
p.prototype._isScrollingNecessary=function(i,s){if(i&&s){var r=i.getBoundingClientRect();return r.left<0||r.right>s.clientWidth;}return false;};
p.prototype._setContent=function(j){var k=j&&j.getMetadata&&j.getMetadata().getName()==="sap.ui.vk.threejs.Scene";this.setScene(k?j:null);if(k&&j.builders){for(var i=0;i<j.builders.length;i++){j.builders[i]._fireThumbnailLoaded=function(r){var s=null;for(var n=0;n<this._viewItems.length;n++){if(this._viewItems[n].data("modelView")==r.modelView){s=this._viewItems[n];break;}}if(s){s.setSource(r.modelView.thumbnailData);}}.bind(this);}}this._attachAnimationTimeSlider(this.getAnimationTimeSlider());};
p.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
p.prototype._handleContentChangesStarted=function(){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setScene(null);};
p.prototype._handleContentReplaced=function(i){var j=i.getParameter("newContent");this._setContent(j);};
p.prototype._handleCdsViewGroupUpdate=function(i){var j=i.getParameter("currentViewGroupId");if(this._modelViews&&this._modelViews.length){this._refreshItems();}else{this._refreshProcedures(j);}this._resetCurrentView();};
p.prototype._resetCurrentView=function(){var j=this._getViewManager();if(j){var k=j.getActiveView();if(k&&this._viewItems){for(var i=0;i<this._viewItems.length;i++){var n=this._viewItems[i];var r=n.getCustomData()[0].getValue();if(r===k){if(this._selectedItem!==n){this.viewActivated(i);break;}}}}if(this._selectedGroupIndex!==-1){var s=this._getViewGroups();if(s&&s.length){this._procedureList.setSelectedKey(s[0].getViewGroupId());}}}};
b.injectMethodsIntoClass(p);return p;});
sap.ui.predefine('sap/ui/vk/ViewGalleryRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.writeClasses();r.write(">");r.renderControl(c.getAggregation("animationTimeSlider"));r.renderControl(c.getAggregation("toolbar"));r.renderControl(c.getAggregation("container"));r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/ViewGalleryThumbnailRenderer',["./library","sap/ui/Device"],function(l,D){"use strict";var V={};
V.render=function(r,i){r.write("<div ");r.writeControlData(i);r.addStyle("height",i.getThumbnailHeight());r.addStyle("width",i.getThumbnailWidth());r.addStyle("background-image","url("+i.getSource()+")");r.writeStyles();r.addClass("sapVizKitViewGalleryThumbnail");r.writeClasses();var t=i.getTooltip();if(t){r.attr("title",t);}r.write(">");var a=i._getIndex()+1;if(a>0){r.write("<div class='sapVizKitViewGalleryStepNumberText'>");r.writeEscaped(a.toString());r.write("</div>");}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/ViewGroup',["sap/ui/base/ManagedObject","./findIndexInArray"],function(M,f){"use strict";
var V=M.extend("sap.ui.vk.ViewGroup",{metadata:{properties:{viewGroupId:{type:"string"},name:{type:"string"},description:{type:"string"}},associations:{}}});
V.prototype.init=function(){this._views=[];};
V.prototype.exit=function(){this._views=null;};
V.prototype.getViews=function(){return this._views;};
V.prototype.addView=function(v){this._views.push(v);return this;};
V.prototype.insertView=function(v,i){if(i<0){i=0;}else if(i!==0&&i>=this._views.length){i=this._views.length;}this._views.splice(i,0,v);return this;};
V.prototype.indexOfView=function(v){return f(this._views,function(i){return i==v;});};
V.prototype.removeView=function(v){var i=this.indexOfView(v);if(i>=0){this._views.splice(i,1);}return this;};
V.prototype.removeViews=function(){if(this._views){this._views.splice(0);}return this;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewManager',["sap/ui/core/Element","./Core","./ContentConnector","./Scene"],function(E,v,C,S){"use strict";
var V=E.extend("sap.ui.vk.ViewManager",{metadata:{interfaces:["sap.ui.vk.IViewManager"],properties:{autoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceViewTimeout:{type:"int",defaultValue:1000}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}}});
V.prototype._setScene=function(s){if(this._scene!==s){this._scene=s;if(this._scene){var i=s.getInitialView();if(i){this.activateView(i);}}}return this;};
V.prototype.getScene=function(){return this._scene;};
V.prototype.getActiveView=function(){return this._activeView;};
V.prototype.getNextView=function(a,b){var s=this.getScene();if(!b){b=s.findViewGroupByView(a);}var c;var i=-1;if(!b){c=s.getViews();i=c.indexOf(a);}else{c=b.getViews();i=b.indexOfView(a);}if(i<0){return undefined;}else if(i>=c.length-1){return undefined;}i++;return c[i];};
V.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);};
V.prototype._handleContentChangesFinished=function(){this._setContent(this._contentConnector.getContent());};
V.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
V.prototype.activateView=function(a,n){return this._activateView(a,null,!this.getAutoPlayAnimation(),false,n);};
V.prototype.playViewGroup=function(a,b){this._cancelPlayingViewGroup=false;if(a===this.getActiveView()){var c=sap.ui.getCore().byId(this.getAnimationPlayer());if(c){if(c.getTime()>=c.getTotalDuration()){c.setTime(0);}}return this._autoPlay(a,b,false,true);}this._activateView(a,b,false,true);return this;};
V.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var a=sap.ui.getCore().byId(this.getAnimationPlayer());if(a){a.stop();}};
V.prototype._autoPlay=function(a,b,s,c){var e=v.getEventBus();var d=sap.ui.getCore().byId(this.getAnimationPlayer());var f=function(){if(this._cancelPlayingViewGroup){return;}var n=this.getNextView(a,b);if(n){this._activateView(n,b,s,c);}else{e.publish("sap.ui.vk","procedureFinished");}}.bind(this);var o=function(h,i,j){if(j.source!==d){return;}if(j.stopped){e.unsubscribe("sap.ui.vk","animationPlayStateChanged",o,this);if(j.endOfAnimation){f();}}};var g=function(){if(c){if(d&&a.hasAnimation()){e.subscribe("sap.ui.vk","animationPlayStateChanged",o,this);}else{setTimeout(function(){f();},this.getAutoAdvanceViewTimeout());}}if((!s||c)&&a.hasAnimation()){if(d){d.play();}else{}}}.bind(this);g();};
V.prototype._activateView=function(a,b,s,c,n){var d=sap.ui.getCore().byId(this.getAnimationPlayer());if(d){d.stop();}this._cancelPlayingViewGroup=false;var t=this;return new Promise(function(r,e){var f=v.getEventBus();t._activeView=a;var o=function(g,h,i){f.unsubscribe("sap.ui.vk","readyForAnimation",o,t);if(i.view!==a){return;}if(t._cancelPlayingViewGroup){return;}t._autoPlay(a,b,s,c,true);r({view:i.view});return;};f.subscribe("sap.ui.vk","readyForAnimation",o,t);f.publish("sap.ui.vk","activateView",{source:t,view:a,notAnimateCameraChange:n,playViewGroup:c});});};
C.injectMethodsIntoClass(V);return V;});
sap.ui.predefine('sap/ui/vk/ViewStateManager',["sap/base/util/ObjectPath","./ContentConnector","./Scene","./ViewStateManagerBase","./Core"],function(O,C,S,V,v){"use strict";
var a=V.extend("sap.ui.vk.ViewStateManager",{metadata:{}});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}this._implementation=null;};
a.prototype.exit=function(){this._destroyImplementation();if(b.exit){b.exit.call(this);}};
a.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};
a.prototype.getImplementation=function(){return this._implementation;};
a.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);};
a.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
a.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
a.prototype._handleContentReplaced=function(e){this._setContent(e.getParameter("newContent"));};
a.prototype._setScene=function(s){if(s&&s instanceof S){var c=s.getMetadata().getName(),i=this._implementation&&this._implementation.getMetadata().getName(),r=c==="sap.ui.vk.dvl.Scene"&&i==="sap.ui.vk.dvl.ViewStateManager"||c==="sap.ui.vk.threejs.Scene"&&i==="sap.ui.vk.threejs.ViewStateManager";if(!r){this._destroyImplementation();var n;if(c==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.ViewStateManager";}else if(c==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.ViewStateManager";}if(n){var t=this;var d=O.get(n);this._implementation=new d({shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection(),contentConnector:this.getContentConnector(),viewManager:this.getViewManager(),visibilityChanged:function(h){t.fireVisibilityChanged({visible:h.getParameter("visible"),hidden:h.getParameter("hidden")});},selectionChanged:function(h){t.fireSelectionChanged({selected:h.getParameter("selected"),unselected:h.getParameter("unselected")});},outliningChanged:function(h){t.fireOutliningChanged({outlined:h.getParameter("outlined"),unoutlined:h.getParameter("unoutlined")});},opacityChanged:function(h){t.fireOpacityChanged({changed:h.getParameter("changed"),opacity:h.getParameter("opacity")});},tintColorChanged:function(h){t.fireTintColorChanged({changed:h.getParameter("changed"),tintColor:h.getParameter("tintColor"),tintColorABGR:h.getParameter("tintColorABGR")});},nodeHierarchyReplaced:function(h){t.fireNodeHierarchyReplaced({oldNodeHierarchy:h.getParameter("oldNodeHierarchy"),newNodeHierarchy:h.getParameter("newNodeHierarchy")});},viewStateApplying:function(h){t.fireViewStateApplying({view:h.getParameter("view")});},viewStateApplied:function(h){t.fireViewStateApplied({view:h.getParameter("view")});},transformationChanged:function(h){t.fireTransformationChanged(h.getParameters());},highlightColorChanged:function(h){t.fireHighlightColorChanged(h.getParameters());}});var e=sap.ui.getCore().byId(this.getViewManager());if(e){var g=sap.ui.getCore().byId(e.getAnimationPlayer());if(g){g.setViewStateManager(this._implementation);}}}}}else{this._destroyImplementation();}return this;};
a.prototype.getAnimationPlayer=function(){var c;var d=sap.ui.getCore().byId(this.getViewManager());if(d){c=sap.ui.getCore().byId(d.getAnimationPlayer());}return c;};
a.prototype.getNodeHierarchy=function(){return this._implementation&&this._implementation.getNodeHierarchy();};
a.prototype.getVisibilityChanges=function(){return this._implementation&&this._implementation.getVisibilityChanges();};
a.prototype.getVisibilityComplete=function(){return this._implementation&&this._implementation.getVisibilityComplete();};
a.prototype.getVisibilityState=function(n){return this._implementation&&this._implementation.getVisibilityState(n);};
a.prototype.setVisibilityState=function(n,c,r){if(this._implementation){this._implementation.setVisibilityState(n,c,r);}return this;};
a.prototype.resetVisibility=function(){return this._implementation&&this._implementation.resetVisibility();};
a.prototype.enumerateSelection=function(c){if(this._implementation){this._implementation.enumerateSelection(c);}return this;};
a.prototype.enumerateOutlinedNodes=function(c){if(this._implementation&&this._implementation.enumerateOutlinedNodes){this._implementation.enumerateOutlinedNodes(c);}return this;};
a.prototype.setShowSelectionBoundingBox=function(c){if(this._implementation){this._implementation.setShowSelectionBoundingBox(c);}};
a.prototype.getShowSelectionBoundingBox=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBox();}};
a.prototype.getSelectionState=function(n){return this._implementation&&this._implementation.getSelectionState(n);};
a.prototype.setSelectionState=function(n,s,r){if(this._implementation){this._implementation.setSelectionState(n,s,r);}return this;};
a.prototype.setSelectionStates=function(s,u,r){if(this._implementation){this._implementation.setSelectionStates(s,u,r);}return this;};
a.prototype.getOutliningState=function(n){if(this._implementation&&this._implementation.getOutliningState){return this._implementation.getOutliningState(n);}else{return false;}};
a.prototype.setOutliningStates=function(o,u,r){if(this._implementation&&this._implementation.setOutliningStates){this._implementation.setOutliningStates(o,u,r);}return this;};
a.prototype.getJoints=function(){if(this._implementation&&this._implementation.getJoints){return this._implementation.getJoints();}return undefined;};
a.prototype.setJoints=function(j,s){if(this._implementation&&this._implementation.setJoints){this._implementation.setJoints(j,s);}return this;};
a.prototype.getOpacity=function(n){return this._implementation&&this._implementation.getOpacity(n);};
a.prototype.setOpacity=function(n,o,r){if(this._implementation){this._implementation.setOpacity(n,o,r);}return this;};
a.prototype.getTotalOpacity=function(n){if(this._implementation&&this._implementation.getTotalOpacity){return this._implementation.getTotalOpacity(n);}return 1;};
a.prototype.setTotalOpacity=function(n,t){if(this._implementation&&this._implementation.setTotalOpacity){return this._implementation.setTotalOpacity(n,t);}return null;};
a.prototype.getRestOpacity=function(n){if(this._implementation&&this._implementation.getRestOpacity){return this._implementation.getRestOpacity(n);}return null;};
a.prototype.setRestOpacity=function(n,o){if(this._implementation&&this._implementation.setRestOpacity){this._implementation.setRestOpacity(n,o);}return this;};
a.prototype.restoreRestOpacity=function(n){if(this._implementation&&this._implementation.restoreRestOpacity){this._implementation.restoreRestOpacity(n);}return this;};
a.prototype.updateRestOpacity=function(n){if(this._implementation&&this._implementation.updateRestOpacity){this._implementation.updateRestOpacity(n);}return this;};
a.prototype.getTintColor=function(n,i){return this._implementation&&this._implementation.getTintColor(n,i);};
a.prototype.setTintColor=function(n,t,r){if(this._implementation){this._implementation.setTintColor(n,t,r);}return this;};
a.prototype.setHighlightColor=function(c){if(this._implementation&&this._implementation.setHighlightColor){this._implementation.setHighlightColor(c);}return this;};
a.prototype.getHighlightColor=function(i){if(this._implementation&&this._implementation.getHighlightColor){return this._implementation.getHighlightColor(i);}};
a.prototype.setOutlineColor=function(c){if(this._implementation&&this._implementation.setOutlineColor){this._implementation.setOutlineColor(c);}return this;};
a.prototype.getOutlineColor=function(i){if(this._implementation&&this._implementation.getOutlineColor){return this._implementation.getOutlineColor(i);}else{return null;}};
a.prototype.setOutlineWidth=function(w){if(this._implementation&&this._implementation.setOutlineWidth){this._implementation.setOutlineWidth(w);}return this;};
a.prototype.getOutlineWidth=function(){if(this._implementation&&this._implementation.getOutlineWidth){return this._implementation.getOutlineWidth();}else{return 0.0;}};
a.prototype.setRecursiveOutlining=function(p){this.setProperty("recursiveOutlining",p,true);if(this._implementation&&this._implementation.setRecursiveOutlining){this._implementation.setRecursiveOutlining(p);}return this;};
a.prototype.setRecursiveSelection=function(p){this.setProperty("recursiveSelection",p,true);if(this._implementation){this._implementation.setRecursiveSelection(p);}return this;};
a.prototype.setHighlightDisplayState=function(s){if(this._implementation&&this._implementation.setHighlightDisplayState){this._implementation.setHighlightDisplayState(s);}return this;};
a.prototype.setTransformation=function(n,t){if(this._implementation&&this._implementation.setTransformation){this._implementation.setTransformation(n,t);}return this;};
a.prototype.getTransformation=function(n){if(this._implementation&&this._implementation.getTransformation){return this._implementation.getTransformation(n);}return null;};
a.prototype.getTransformationWorld=function(n){if(this._implementation&&this._implementation.getTransformationWorld){return this._implementation.getTransformationWorld(n);}return null;};
a.prototype.getRestTransformationWorld=function(n){if(this._implementation&&this._implementation.getRestTransformationWorld){return this._implementation.getRestTransformationWorld(n);}return null;};
a.prototype.getRestTransformationUsingJoint=function(n){if(this._implementation&&this._implementation.getRestTransformationUsingJoint){return this._implementation.getRestTransformationUsingJoint(n);}return null;};
a.prototype.updateRestTransformation=function(n){if(this._implementation&&this._implementation.updateRestTransformation){this._implementation.updateRestTransformation(n);}return this;};
a.prototype.restoreRestTransformation=function(n){if(this._implementation&&this._implementation.restoreRestTransformation){this._implementation.restoreRestTransformation(n);}return this;};
a.prototype.setRestTransformation=function(n,t,q,s){if(this._implementation&&this._implementation.setRestTransformation){this._implementation.setRestTransformation(n,t,q,s);}return this;};
a.prototype.getRelativeTransformation=function(n){if(this._implementation&&this._implementation.getRelativeTransformation){return this._implementation.getRelativeTransformation(n);}return null;};
a.prototype.getRestTransformation=function(n){if(this._implementation&&this._implementation.getRestTransformation){return this._implementation.getRestTransformation(n);}return null;};
a.prototype.addToRestTransformation=function(n,t,q,s,o){if(this._implementation&&this._implementation.addToRestTransformation){return this._implementation.addToRestTransformation(n,t,q,s,o);}return null;};
a.prototype._getEndPropertyInLastSequence=function(n,p){if(this._implementation&&this._implementation._getEndPropertyInLastSequence){return this._implementation._getEndPropertyInLastSequence(n,p);}return null;};
a.prototype._getEndPropertyInPreviousSequence=function(n,p,s){if(this._implementation&&this._implementation._getEndPropertyInPreviousSequence){return this._implementation._getEndPropertyInPreviousSequence(n,p,s);}return null;};
a.prototype._convertTracksToRelative=function(s){if(this._implementation&&this._implementation._convertTracksToRelative){this._implementation._convertTracksToRelative(s);}return this;};
a.prototype._setJointNodeOffsets=function(n,t){if(this._implementation&&this._implementation._setJointNodeOffsets){this._implementation._setJointNodeOffsets(n,t);}return this;};
a.prototype._setJointNodeMatrix=function(){if(this._implementation&&this._implementation._setJointNodeMatrix){this._implementation._setJointNodeMatrix();}return this;};
a.prototype.setTranslationKey=function(n,t,s){if(this._implementation&&this._implementation.setTranslationKey){this._implementation.setTranslationKey(n,t,s);}return this;};
a.prototype.setScaleKey=function(n,t,s){if(this._implementation&&this._implementation.setScaleKey){this._implementation.setScaleKey(n,t,s);}return this;};
a.prototype.setRotationKey=function(n,t,e,s){if(this._implementation&&this._implementation.setRotationKey){this._implementation.setRotationKey(n,t,e,s);}return this;};
a.prototype.setOpacityKey=function(n,t,s){if(this._implementation&&this._implementation.setOpacityKey){this._implementation.setOpacityKey(n,t,s);}return this;};
var f=a.getMetadata().getName();var m={init:function(){this._viewStateManager=null;v.attachEvent(f+"-created",this._handleViewStateManagerCreated,this).attachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this);},exit:function(){this.setViewStateManager(null);v.detachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this).detachEvent(f+"-created",this._handleViewStateManagerCreated,this);},setViewStateManager:function(c){this.setAssociation("viewStateManager",c,true);this._updateViewStateManager();return this;},_updateViewStateManager:function(){var n=this.getViewStateManager(),c=n&&sap.ui.getCore().byId(n)||null;if(this._viewStateManager!==c){this._clearViewStateManager();if(c){if(this._handleNodeHierarchyReplaced){c.attachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}if(this._handleVisibilityChanged){c.attachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleSelectionChanged){c.attachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleOutliningChanged){c.attachOutliningChanged(this._handleOutliningChanged,this);}if(this._handleOutlineColorChanged){c.attachOutlineColorChanged(this._handleOutlineColorChanged,this);}if(this._handleOutlineWidthChanged){c.attachOutlineWidthChanged(this._handleOutlineWidthChanged,this);}if(this._handleOpacityChanged){c.attachOpacityChanged(this._handleOpacityChanged,this);}if(this._handleHighlightColorChanged){c.attachHighlightColorChanged(this._handleHighlightColorChanged,this);}if(this._handleTintColorChanged){c.attachTintColorChanged(this._handleTintColorChanged,this);}if(this._handleTransformationChanged){c.attachTransformationChanged(this._handleTransformationChanged,this);}if(this._handleViewStateApplied){c.attachViewStateApplied(this._handleViewStateApplied,this);}this._viewStateManager=c;if(this._onAfterUpdateViewStateManager){this._onAfterUpdateViewStateManager();}}}return this;},_clearViewStateManager:function(){if(this._viewStateManager){if(this._onBeforeClearViewStateManager){this._onBeforeClearViewStateManager();}if(this._handleTransformationChanged){this._viewStateManager.detachTransformationChanged(this._handleTransformationChanged,this);}if(this._handleTintColorChanged){this._viewStateManager.detachTintColorChanged(this._handleTintColorChanged,this);}if(this._handleHighlightColorChanged){this._viewStateManager.detachHighlightColorChanged(this._handleHighlightColorChanged,this);}if(this._handleSelectionChanged){this._viewStateManager.detachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleOutliningChanged){this._viewStateManager.detachOutliningChanged(this._handleOutliningChanged,this);}if(this._handleOutlineColorChanged){this._viewStateManager.detachOutlineColorChanged(this._handleOutlineColorChanged,this);}if(this._handleOutlineWidthChanged){this._viewStateManager.detachOutlineWidthChanged(this._handleOutlineWidthChanged,this);}if(this._handleVisibilityChanged){this._viewStateManager.detachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleNodeHierarchyReplaced){this._viewStateManager.detachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}if(this._handleViewStateApplied){this._viewStateManager.detachViewStateApplied(this._handleViewStateApplied,this);}this._viewStateManager=null;}return this;},_handleViewStateManagerCreated:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._updateViewStateManager();}},_handleViewStateManagerDestroying:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._clearViewStateManager();}}};
a.injectMethodsIntoClass=function(c){var p=c.prototype,i=p.init,e=p.exit;p.init=function(){if(i){i.call(this);}m.init.call(this);};p.exit=function(){m.exit.call(this);if(e){e.call(this);}};p.setViewStateManager=m.setViewStateManager;p._updateViewStateManager=m._updateViewStateManager;p._clearViewStateManager=m._clearViewStateManager;p._handleViewStateManagerCreated=m._handleViewStateManagerCreated;p._handleViewStateManagerDestroying=m._handleViewStateManagerDestroying;};
v.registerClass(a);C.injectMethodsIntoClass(a);return a;});
sap.ui.predefine('sap/ui/vk/ViewStateManagerBase',["sap/ui/core/Element"],function(E){"use strict";
var V=E.extend("sap.ui.vk.ViewStateManagerBase",{metadata:{"abstract":true,properties:{shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},recursiveOutlining:{type:"boolean",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},viewManager:{type:"sap.ui.vk.ViewManager"}},events:{visibilityChanged:{parameters:{visible:{type:"any[]"},hidden:{type:"any[]"}},enableEventBubbling:true},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}},enableEventBubbling:true},outliningChanged:{parameters:{outlined:{type:"any[]"},unoutlined:{type:"any[]"}},enableEventBubbling:true},opacityChanged:{parameters:{changed:{type:"any[]"},opacity:{type:"any"}},enableEventBubbling:true},tintColorChanged:{parameters:{changed:{type:"any[]"},tintColor:{type:"any"},tintColorABGR:{type:"any"}},enableEventBubbling:true},nodeHierarchyReplaced:{parameters:{oldNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"},newNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"}}},highlightColorChanged:{parameters:{highlightColor:{type:"sap.ui.core.CSSColor"},highlightColorABGR:{type:"int"}},enableEventBubbling:true},transformationChanged:{parameters:{changed:{type:"any"},transformation:{type:"any"}}},viewStateApplying:{parameters:{view:{type:"sap.ui.vk.View"}}},viewStateApplied:{parameters:{view:{type:"sap.ui.vk.View"}}},readyForAnimation:{parameters:{view:{type:"sap.ui.vk.View"}}},outlineColorChanged:{parameters:{outlineColor:{type:"sap.ui.core.CSSColor"},outlineColorABGR:{type:"int"}},enableEventBubbling:true},outlineWidthChanged:{parameters:{width:{type:"float"}},enableEventBubbling:true}}}});
return V;});
sap.ui.predefine('sap/ui/vk/ViewerRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewer");r.writeClasses();if(c.getWidth()){r.addStyle("width",c.getWidth());}if(c.getHeight()){r.addStyle("height",c.getHeight());}r.writeStyles();r.write(">");r.renderControl(c._layout);r.renderControl(c._progressIndicator);r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/Viewport',["jquery.sap.global","sap/base/util/ObjectPath","./ViewportBase","./ContentConnector","./ViewStateManager","./ViewportRenderer","./VisibilityMode","./RenderMode","./Scene","./Camera"],function(q,O,V,C,a,b,d,R,S,e){"use strict";
var f=V.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk",designtime:"sap/ui/vk/designtime/Viewport.designtime"}});
var g=f.getMetadata().getParent().getClass().prototype;
f.prototype.init=function(){if(g.init){g.init.call(this);}this._implementation=null;};
f.prototype.exit=function(){this._destroyImplementation();if(g.exit){g.exit.call(this);}};
f.prototype.getImplementation=function(){return this._implementation;};
f.prototype._destroyImplementation=function(){if(this._implementation){var m=this.removeAllContent();var t=this;m.forEach(function(c){t.addAggregation("content",c);});this.setAggregation("safeArea",this._implementation.getSafeArea());this._implementation.destroy();this._implementation=null;}return this;};
f.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo();}return g.getShowDebugInfo.call(this);};
f.prototype.setShowDebugInfo=function(v){g.setShowDebugInfo.call(this,v);if(this._implementation){this._implementation.setShowDebugInfo(v);}return this;};
f.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop();}return g.getBackgroundColorTop.call(this);};
f.prototype.setBackgroundColorTop=function(v){g.setBackgroundColorTop.call(this,v);if(this._implementation){this._implementation.setBackgroundColorTop(v);}return this;};
f.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom();}return g.getBackgroundColorBottom.call(this);};
f.prototype.setBackgroundColorBottom=function(v){g.setBackgroundColorBottom.call(this,v);if(this._implementation){this._implementation.setBackgroundColorBottom(v);}return this;};
f.prototype.setWidth=function(v){g.setWidth.call(this,v);if(this._implementation){this._implementation.setWidth(v);}return this;};
f.prototype.setHeight=function(v){g.setHeight.call(this,v);if(this._implementation){this._implementation.setHeight(v);}return this;};
f.prototype.setSelectionMode=function(v){g.setSelectionMode.call(this,v);if(this._implementation){this._implementation.setSelectionMode(v);}return this;};
f.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode();}return g.getSelectionMode.call(this);};
f.prototype.setSelectionDisplayMode=function(v){g.setSelectionDisplayMode.call(this,v);if(this._implementation){this._implementation.setSelectionDisplayMode(v);}return this;};
f.prototype.getSelectionDisplayMode=function(){if(this._implementation){return this._implementation.getSelectionDisplayMode();}return g.getSelectionDisplayMode.call(this);};
f.prototype.setShowSafeArea=function(v){g.setShowSafeArea.call(this,v);if(this._implementation){this._implementation.setShowSafeArea(v);}return this;};
f.prototype.getShowSafeArea=function(){if(this._implementation){return this._implementation.getShowSafeArea();}return g.getShowSafeArea.call(this);};
f.prototype.setCamera=function(v){g.setCamera.call(this,v);if(this._implementation){this._implementation.setCamera(v);return this;}return this;};
f.prototype.getCamera=function(){if(this._implementation){return this._implementation.getCamera();}return g.getCamera.call(this);};
f.prototype.setShouldRenderFrame=function(){if(this._implementation){this._implementation.setShouldRenderFrame();}return this;};
f.prototype.shouldRenderFrame=function(){if(this._implementation){this._implementation.shouldRenderFrame();}};
f.prototype.setRenderMode=function(v){if(this._implementation&&this._implementation.setRenderMode){this._implementation.setRenderMode(v);}return this;};
f.prototype.getRenderMode=function(){if(this._implementation&&this._implementation.getRenderMode){return this._implementation.getRenderMode();}return R.Default;};
f.prototype.setFreezeCamera=function(v){g.setFreezeCamera.call(this,v);if(this._implementation){this._implementation.setFreezeCamera(v);}return this;};
f.prototype.showHotspots=function(n,c,m){if(this._implementation&&this._implementation.showHotspots){this._implementation.showHotspots(n,c,m);}return this;};
f.prototype.addTool=function(t){this.addAssociation("tools",t);if(this._implementation){this._implementation.addTool(t);}};
f.prototype.removeTool=function(t){this.removeAssociation("tools",t);if(this._implementation){this._implementation.removeTool(t);}};
f.prototype.getTools=function(){if(this._implementation){return this._implementation.getTools();}return this.getAssociation("tools",[]);};
f.prototype.removeAllTools=function(){this.removeAllAssociation("tools");if(this._implementation){this._implementation.removeAllTools();}};
f.prototype.addContent=function(c){if(this._implementation){this._implementation.addContent(c);}else{this.addAggregation("content",c);}};
f.prototype.removeContent=function(c){if(this._implementation){return this._implementation.removeContent(c);}return this.removeAggregation("content",c);};
f.prototype.getContent=function(){if(this._implementation){return this._implementation.getContent();}return this.getAggregation("content");};
f.prototype.removeAllContent=function(){if(this._implementation){return this._implementation.removeAllContent();}return this.removeAggregation("content");};
f.prototype.setSafeArea=function(c){if(this._implementation){this._implementation.setSafeArea(c);}else{this.setAggregation("safeArea",c);}};
f.prototype.getSafeArea=function(){if(this._implementation){return this._implementation.getSafeArea();}return this.getAggregation("safeArea");};
f.prototype.removeSafeArea=function(){if(this._implementation){return this._implementation.removeAggregation("safeArea");}return this.removeAggregation("safeArea");};
f.prototype.addAnnotation=function(c){if(this._implementation){this._implementation.addAnnotation(c);}else{this.addAggregation("annotations",c);}};
f.prototype.destroyAnnotations=function(){if(this._implementation){return this._implementation.destroyAnnotations();}return this.destroyAggregation("annotations");};
f.prototype.getAnnotations=function(){if(this._implementation){return this._implementation.getAnnotations();}return this.getAggregation("annotations");};
f.prototype.indexOfAnnotation=function(c){if(this._implementation){return this._implementation.indexOfAnnotation(c);}return this.indexOfAggregation("annotations",c);};
f.prototype.removeAllAnnotations=function(){if(this._implementation){return this._implementation.removeAllAnnotations();}return this.removeAggregation("annotations");};
f.prototype.removeAnnotation=function(c){if(this._implementation){return this._implementation.removeAnnotation(c);}return this.removeAggregation("annotations",c);};
f.prototype.insertAnnotation=function(c,m){if(this._implementation){return this._implementation.insertAnnotation(c,m);}return this.insertAggregation("annotations",c,m);};
f.prototype.startAnimation=function(p){if(this._implementation&&this._implementation.startAnimation){this._implementation.startAnimation(p);}};
f.prototype.stopAnimation=function(){if(this._implementation&&this._implementation.stopAnimation){this._implementation.stopAnimation();}};
f.prototype.playProcedure=function(m,v,n){if(this._implementation&&this._implementation.playProcedure){this._implementation.playProcedure(m,v,n);}};
f.prototype.getCurrentView=function(){if(this._implementation&&this._implementation.getCurrentView){return this._implementation.getCurrentView();}return null;};
f.prototype.pan=function(c,m){if(this._implementation&&this._implementation.pan){this._implementation.pan(c,m);}};
f.prototype.rotate=function(c,m){if(this._implementation&&this._implementation.rotate){this._implementation.rotate(c,m);}};
f.prototype.zoom=function(c){if(this._implementation&&this._implementation.zoom){this._implementation.zoom(c);}};
f.prototype.pauseAnimation=function(){if(this._implementation&&this._implementation.pauseAnimation){return this._implementation.pauseAnimation();}};
f.prototype.resumeAnimation=function(){if(this._implementation&&this._implementation.resumeAnimation){return this._implementation.resumeAnimation();}};
f.prototype.handleDragAnimation=function(c){if(this._implementation&&this._implementation.handleDragAnimation){this._implementation.handleDragAnimation(c);}};
f.prototype.handleCompleteDraggingAnimation=function(c){if(this._implementation&&this._implementation.handleCompleteDraggingAnimation){this._implementation.handleCompleteDraggingAnimation(c);}};
f.prototype.AddHandlersToAnimationSequenceEvents=function(c){if(this._implementation&&this._implementation.AddHandlersToAnimationSequenceEvents){this._implementation.AddHandlersToAnimationSequenceEvents(c);}};
f.prototype._setContent=function(c){var m=null;var n=null;if(c){m=c;if(!(m instanceof S)){m=null;}n=c.camera;if(!(n instanceof e)){n=null;}}this._setScene(m);if(n){this.setCamera(n);}};
f.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
f.prototype._onBeforeClearContentConnector=function(){if(g._onBeforeClearContentConnector){g._onBeforeClearContentConnector.call(this);}this._setScene(null);};
f.prototype._handleContentReplaced=function(c){var m=c.getParameter("newContent");this._setContent(m);};
f.prototype._setScene=function(c){if(c instanceof S){var m=c.getMetadata().getName(),n=this._implementation&&this._implementation.getMetadata().getName(),r=m==="sap.ui.vk.dvl.Scene"&&n==="sap.ui.vk.dvl.Viewport"||m==="sap.ui.vk.threejs.Scene"&&n==="sap.ui.vk.threejs.Viewport";if(!r){this._destroyImplementation();var o;var p=this.getCamera();if(m==="sap.ui.vk.dvl.Scene"){o="sap.ui.vk.dvl.Viewport";}else if(m==="sap.ui.vk.threejs.Scene"){o="sap.ui.vk.threejs.Viewport";}if(o){var t=O.get(o);this._implementation=new t({viewStateManager:this.getViewStateManager(),tools:this.getAssociation("tools"),content:this.getContent(),safeArea:this.getSafeArea(),showSafeArea:this.getShowSafeArea(),showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),freezeCamera:this.getFreezeCamera(),contentConnector:this.getContentConnector()});if(p){this._camera=null;this._implementation.setCamera(p);}this._implementation.setParent(this);}this.invalidate();}}else{this._destroyImplementation();this.invalidate();}return this;};
f.prototype._onAfterUpdateViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(this._viewStateManager);}};
f.prototype._onBeforeClearViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(null);}};
f.prototype.activateView=function(v,p,n){if(this._implementation){this._implementation.activateView(v,p,n);return this;}else{q.sap.log.error("no implementation");return this;}};
f.prototype.resetCurrentView=function(){if(this._implementation&&this._implementation.resetCurrentView){this._implementation.resetCurrentView();return this;}else{q.sap.log.error("no implementation");return this;}};
f.prototype.zoomTo=function(w,n,c,m){if(this._implementation){this._implementation.zoomTo(w,n,c,m);}else{q.sap.log.error("zoomTo: no implementation");}return this;};
f.prototype.tap=function(x,y,c){if(this._implementation){this._implementation.tap(x,y,c);}return this;};
f.prototype.tapObject=function(n){if(this._implementation&&this._implementation.tapObject){this._implementation.tapObject(n);}return this;};
var s=function(c){c.camera={};};var h=function(c){if(typeof c.camera==="object"&&c.camera!==null){c.camera.matrices=false;}};var i=function(c){if(typeof c.camera==="object"&&c.camera!==null){c.camera.useTransitionCamera=false;}};var j=function(c){c.animation=true;};var k=function(c){c.visibility=false;};var l=function(c){if(typeof c.visibility==="object"&&c.visibility!==null){c.visibility.mode=d.Complete;}};
f.prototype.getViewInfo=function(c){if(!this._implementation){q.sap.log.error("no implementation");return null;}var m={};if(typeof c!=="object"||c===null){s(m);h(m);i(m);j(m);k(m);l(m);}else{if(typeof c.camera==="object"&&c.camera!==null){m.camera={};if(typeof c.camera.matrices==="boolean"){m.camera.matrices=c.camera.matrices;}else if("matrices"in c.camera){m.camera.matrices=false;}else{h(m);}if(typeof c.camera.useTransitionCamera==="boolean"){m.camera.useTransitionCamera=c.camera.useTransitionCamera;}else if("useTransitionCamera"in c.camera){m.camera.useTransitionCamera=false;}else{i(m);}}else if(typeof c.camera==="boolean"){if(c.camera===true){m.camera={};h(m);i(m);}else{m.camera=false;}}else if("camera"in c){m.camera=false;}else{s(m);h(m);i(m);}if(typeof c.animation==="boolean"){m.animation=c.animation;}else if("animation"in c){m.animation=false;}else{j(m);}if(typeof c.visibility==="object"&&c.visibility!==null){m.visibility={};if(c.visibility.mode===d.Complete||c.visibility.mode===d.Differences){m.visibility.mode=c.visibility.mode;}else{l(m);}}else if(typeof c.visibility==="boolean"){if(c.visibility===true){m.visibility={};l(m);}else{m.visibility=false;}}else if("visibility"in c){m.visibility=false;}else{k(m);l(m);}}return this._implementation.getViewInfo(m);};
f.prototype.setViewInfo=function(v,c){if(this._implementation){this._implementation.setViewInfo(v,c);}else{q.sap.log.error("no implementation");}return this;};
f.prototype.getImage=function(w,c,t,m,n){if(this._implementation&&this._implementation.getImage){return this._implementation.getImage(w,c,t,m,n);}return null;};
f.prototype.projectToScreen=function(x,y,z,c){if(this._implementation&&this._implementation.projectToScreen){return this._implementation.projectToScreen(x,y,z,c);}return g.projectToScreen(x,y,z,c);};
f.prototype.normalizeRectangle=function(x,y,w,c){if(this._implementation&&this._implementation.normalizeRectangle){return this._implementation.normalizeRectangle(x,y,w,c);}return g.normalizeRectangle(x,y,w,c);};
f.prototype.deNormalizeRectangle=function(x,y,w,c){if(this._implementation&&this._implementation.deNormalizeRectangle){return this._implementation.deNormalizeRectangle(x,y,w,c);}return g.deNormalizeRectangle(x,y,w,c);};
C.injectMethodsIntoClass(f);a.injectMethodsIntoClass(f);return f;});
sap.ui.predefine('sap/ui/vk/ViewportBase',["sap/ui/core/Control","./tools/Tool","./library","./SelectionMode","./SelectionDisplayMode","./RenderMode","./SafeArea"],function(C,T,v,S,a,R,b){"use strict";
var V=C.extend("sap.ui.vk.ViewportBase",{metadata:{library:"sap.ui.vk","abstract":true,properties:{showDebugInfo:{type:"boolean",defaultValue:false},backgroundColorTop:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(50, 50, 50, 1)"},backgroundColorBottom:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},selectionMode:{type:"sap.ui.vk.SelectionMode",defaultValue:S.Sticky},selectionDisplayMode:{type:"sap.ui.vk.SelectionDisplayMode",defaultValue:a.Highlight},freezeCamera:{type:"boolean",defaultValue:false},renderMode:{type:"sap.ui.vk.RenderMode",defaultValue:R.Default},showSafeArea:{type:"boolean",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false},tools:{type:"sap.ui.vk.tools.Tool",multiple:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true},safeArea:{type:"sap.ui.vk.SafeArea",multiple:false},annotations:{type:"sap.ui.vk.Annotation",multiple:true}},events:{urlClicked:{parameters:{nodeRef:"any",url:"string"},enableEventBubbling:true},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"},enableEventBubbling:true},resize:{parameters:{size:"object"},enableEventBubbling:true},nodesPicked:{parameters:{picked:{type:"any[]"}},enableEventBubbling:true},nodeZoomed:{parameters:{zoomed:{type:"any"},isZoomIn:{type:"boolean"}},enableEventBubbling:true},viewActivated:{parameters:{viewIndex:"int",view:"sap.ui.vk.View",type:{type:"string"}},enableEventBubbling:true},procedureFinished:{enableEventBubbling:true},viewFinished:{parameters:{viewIndex:"int"},enableEventBubbling:true}}}});
var c=V.getMetadata().getParent().getClass().prototype;
V.prototype.init=function(){if(c.init){c.init.call(this);}if(this.getSafeArea()==null){this.setSafeArea(new b());}this._camera=null;};
V.prototype.exit=function(){if(this._camera){if(this._contentConnector){var d=this._contentConnector.getContentManager();if(d){d.destroyCamera(this._camera);}this._camera=null;}}if(c.exit){c.exit.call(this);}};
V.prototype.addTool=function(t){this.addAssociation("tools",t);t=t instanceof T?t:sap.ui.getCore().byId(t);t.setViewport(this);};
V.prototype.getImage=function(w,h){return null;};
V.prototype.stickySelectionHandler=function(n){if(this._viewStateManager==null){return;}if(n.length===0){var d=[];if(this.getSelectionDisplayMode()===a.Outline){this._viewStateManager.enumerateOutlinedNodes(function(g){d.push(g);});if(d.length>0){this._viewStateManager.setOutliningStates([],d);}}else{this._viewStateManager.enumerateSelection(function(g){d.push(g);});if(d.length>0){this._viewStateManager.setSelectionStates([],d);}}}else{var s=[];var e=[];var i,f;if(this.getSelectionDisplayMode()===a.Outline){i=this._viewStateManager.getOutliningState(n);for(f=0;f<i.length;f++){if(i[f]){e.push(n[f]);}else{s.push(n[f]);}}this._viewStateManager.setOutliningStates(s,e);}else{i=this._viewStateManager.getSelectionState(n);for(f=0;f<i.length;f++){if(i[f]){e.push(n[f]);}else{s.push(n[f]);}}this._viewStateManager.setSelectionStates(s,e);}}};
V.prototype.exclusiveSelectionHandler=function(n){if(this._viewStateManager==null){return;}var d=true;if(n.length===1){d=!this._viewStateManager.getSelectionState(n[0]);}else if(n.length>1){var i;if(this.getSelectionDisplayMode()===a.Outline){i=this._viewStateManager.getOutliningState(n);}else{i=this._viewStateManager.getSelectionState(n);}for(var e=0;e<i.length;e++){if(i[e]){d=false;break;}}}var u=[];if(n.length===0||d){if(this.getSelectionDisplayMode()===a.Outline){this._viewStateManager.enumerateOutlinedNodes(function(s){u.push(s);});}else{this._viewStateManager.enumerateSelection(function(s){u.push(s);});}}if(this.getSelectionDisplayMode()===a.Outline){this._viewStateManager.setOutliningStates(n,u);}else{this._viewStateManager.setSelectionStates(n,u);}};
V.prototype.setCamera=function(d){if(d!==this._camera){if(this._camera&&this._contentConnector){var e=this._contentConnector.getContentManager();if(e){e.destroyCamera(this._camera);}}}this._camera=d;return this;};
V.prototype.getCamera=function(){return this._camera;};
V.prototype._onBeforeClearContentConnector=function(){this.setCamera(null);};
V.prototype.activateView=function(d,p,n){return this;};
V.prototype.pan=function(d,e){return this;};
V.prototype.rotate=function(d,e){return this;};
V.prototype.zoom=function(d){return this;};
V.prototype.projectToScreen=function(x,y,z,d){return{x:0,y:0,depth:0};};
V.prototype.normalizeRectangle=function(x,y,w,h){return{x:0,y:0,width:0,height:0};};
V.prototype.deNormalizeRectangle=function(x,y,w,h){return{x:0,y:0,width:0,height:0};};
return V;});
sap.ui.predefine('sap/ui/vk/ViewportHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var V=E.extend("sap.ui.vk.ViewportHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(a){this._viewport=a;this._rect=null;this._evt={x:0,y:0,z:0,d:0,tdx:0,tdy:0,tdd:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;}
});
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect==null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.tdx=0;this._evt.tdy=0;this._evt.tdd=0;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;q.sap.log.debug("Loco: beginGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.beginGesture(x,y);}.bind(this));a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.tdx=this._evt.tdx+d;this._evt.tdy=this._evt.tdy+a;this._evt.tdd=this._evt.tdd+b;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n==2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);q.sap.log.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;this._evt.n=e.n;switch(e.n){case 1:q.sap.log.debug("Loco: Rotate: "+(d)+", "+(a));this._viewport.queueCommand(function(){this._viewport.rotate(d,a);}.bind(this));break;case 2:q.sap.log.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){q.sap.log.debug("Loco: Zoom: "+(z));}this._viewport.queueCommand(function(){if(this._evt.tdx!==0&&this._evt.tdy!==0){this._viewport.pan(d,a);}if((d<10&&a<10&&z!=0&&z!=1.0)&&this._evt.tdd!==0){this._viewport.zoom(z);}}.bind(this));break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: endGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.endGesture();}.bind(this));this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: click: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,false);}.bind(this));e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: doubleClick: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,true);}.bind(this));e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons==5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewportRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();if(c._implementation){r.writeAttribute("tabindex",-1);}else{r.writeAttribute("tabindex",0);}r.writeAttribute("aria-label","Image");var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");if(c._implementation){r.renderControl(c._implementation);}else if(c.getContent()){var C=c.getContent();for(var i=0,l=C.length;i<l;i++){r.renderControl(C[i]);}}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/VisibilityMode',[],function(){"use strict";var V={Complete:"complete",Differences:"differences"};return V;},true);
sap.ui.predefine('sap/ui/vk/ZoomTo',[],function(){"use strict";var Z={All:"all",Visible:"visible",Selected:"selected",Node:"node",NodeSetIsolation:"node_setisolation",Restore:"restore",RestoreRemoveIsolation:"restore_removeisolation",ViewLeft:"view_left",ViewRight:"view_right",ViewTop:"view_top",ViewBottom:"view_bottom",ViewBack:"view_back",ViewFront:"view_front"};return Z;},true);
sap.ui.predefine('sap/ui/vk/abgrToColor',[],function(){"use strict";var a=function(b){return{red:b&0xff,green:b>>>8&0xff,blue:b>>>16&0xff,alpha:(b>>>24&0xff)/255};};return a;},true);
sap.ui.predefine('sap/ui/vk/colorToABGR',[],function(){"use strict";var c=function(a){return(a.alpha*255<<24|a.blue<<16|a.green<<8|a.red)>>>0;};return c;},true);
sap.ui.predefine('sap/ui/vk/colorToCSSColor',[],function(){"use strict";var c=function(a){return"rgba("+a.red+","+a.green+","+a.blue+","+a.alpha+")";};return c;},true);
sap.ui.predefine('sap/ui/vk/cssColorToColor',[],function(){"use strict";var c=(function(){var i=false;var d=document.createElement("div");d.id="sap.ui.vk.colorConverter";d.style.setProperty("display","none","important");return function(a){if(!i){if(document.body){document.body.appendChild(d);i=true;}else{return{red:0,green:0,blue:0,alpha:1};}}d.style.setProperty("color","rgba(0, 0, 0, 0)","important");d.style.setProperty("color",a,"important");var e=window.getComputedStyle(d).color;if(e==="transparent"){return{red:0,green:0,blue:0,alpha:0};}else{var b=e.split("(")[1].split(")")[0].split(",");return{red:parseInt(b[0],10),green:parseInt(b[1],10),blue:parseInt(b[2],10),alpha:b.length===4?parseFloat(b[3]):1};}};})();return c;},true);
sap.ui.predefine('sap/ui/vk/dvl/BaseNodeProxy',["../BaseNodeProxy","./getJSONObject"],function(B,g){"use strict";
var a=B.extend("sap.ui.vk.dvl.BaseNodeProxy",{metadata:{}});
a.prototype.init=function(n,b){this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=b;};
a.prototype.reset=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;};
a.prototype.getNodeRef=function(){return this._dvlNodeRef;};
a.prototype.getNodeId=function(){return this._dvlNodeRef;};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
a.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
a.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
a.prototype.getSceneRef=function(){return this._dvlNodeRef;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ContentManager',["../ContentManager","../getResourceBundle"],function(C,g){"use strict";
var a=C.extend("sap.ui.vk.dvl.ContentManager",{metadata:{library:"sap.ui.vk"}});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}this._handleDownloadingProgressProxy=this._handleDownloadingProgress.bind(this);this._graphicsCore=null;this._failedSources=[];};
a.prototype.exit=function(){if(this._graphicsCore){this._graphicsCore.destroy();this._graphicsCore=null;}if(b.exit){b.exit.call(this);}};
var r={},w={antialias:true,alpha:true,premultipliedAlpha:true};
a.getRuntimeSettings=function(){return r;};
a.setRuntimeSettings=function(s){r=s;};
a.getWebGLContextAttributes=function(){return w;};
a.setWebGLContextAttributes=function(c){w=Object.assign(w,c);};
a.prototype._getGraphicsCore=function(){var t=this;return new Promise(function(c,d){if(t._graphicsCore){c(t._graphicsCore);}else{sap.ui.require(["sap/ui/vk/dvl/GraphicsCore"],function(G){G.create(r,w).then(function(e){t._graphicsCore=e;t._graphicsCore.attachSceneLoadingStarted(t._handleDvlSceneLoadingStarted,t);t._graphicsCore.attachSceneLoadingFinished(t._handleDvlSceneLoadingFinished,t);t._graphicsCore.attachSceneLoadingProgress(t._handleDvlSceneLoadingProgress,t);c(t._graphicsCore);});});}});};
a.prototype._handleDownloadingProgress=function(e){var s=e.getParameter("source"),l=e.getParameter("loaded"),t=e.getParameter("total"),v=t?l/t*50:0;this.fireContentChangesProgress({phase:g().getText("PROGRESS_INDICATOR_DOWNLOADING"),source:s,percentage:v});};
a.prototype._handleDvlSceneLoadingProgress=function(e){this.fireContentChangesProgress({phase:g().getText("PROGRESS_INDICATOR_RENDERING"),source:e.getParameter("source"),percentage:50+e.getParameter("percentage")*50});};
a.prototype._handleDvlSceneLoadingStarted=function(e){};
a.prototype._handleDvlSceneLoadingFinished=function(e){};
a.prototype.loadContent=function(c,d){this.fireContentChangesStarted();var t=this;this._getGraphicsCore().then(function(e){e.setDecryptionHandler(t._decryptionHandler);e.setAuthorizationHandler(t._authorizationHandler);e.loadContentResourcesAsync(d,function(s){var f=[];if(s){s.forEach(function(i){f.push({error:i,errorMessage:"Failed to download source '"+((i.source instanceof File)?i.source.name:i.source)+"'."});});}var l=c?c:undefined;e.updateSceneTreeAsync(l,d).then(function(h){var i={content:h.scene};if(h.failureReason){f=f.concat(h.failureReason);}if(f.length>0){i.failureReason=f;}sap.ui.require(["sap/ui/vk/dvl/Viewport","sap/ui/vk/dvl/ViewStateManager"],function(){t.fireContentChangesFinished(i);});}).catch(function(h){if(typeof h==="string"){f.push({error:h,errorMessage:h});}else{f.push({error:h,errorMessage:h.message?h.message:h.errorMessage});}t.fireContentChangesFinished({content:null,failureReason:f});});},t._handleDownloadingProgressProxy);},function(e){t.fireContentChangesFinished({content:null,failureReason:{error:e,errorMessage:"Failed to create DVL graphics core object."}});});return this;};
a.prototype.destroyContent=function(c){if(c){this._graphicsCore.destroyScene(c);}return this;};
a.prototype.collectGarbage=function(){this._graphicsCore.collectGarbage();return this;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/GraphicsCoreApi',[],function(){"use strict";var G={LegacyDvl:"LegacyDvl"};return G;},true);
sap.ui.predefine('sap/ui/vk/dvl/LayerProxy',["../LayerProxy","./getJSONObject"],function(L,g){"use strict";
var a=L.extend("sap.ui.vk.dvl.LayerProxy",{
metadata:{publicMethods:["getDescription","getLayerId","getLayerMetadata","getName","getNodes","getVeIds"]},
constructor:function(n,l){L.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlLayerId=l;}
});
a.prototype.destroy=function(){this._dvlLayerId=null;this._dvlSceneRef=null;this._dvl=null;L.prototype.destroy.call(this);};
a.prototype.getLayerId=function(){return this._dvlLayerId;};
a.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlLayerId));};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).name;};
a.prototype.getDescription=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).description;};
a.prototype.getLayerMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlLayerId)).metadata;};
a.prototype.getNodes=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).nodes;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/NodeHierarchy',["jquery.sap.global","../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","./LayerProxy","../Messages","../DvlException","./checkResult","./getJSONObject","../getResourceBundle"],function(q,N,O,B,a,L,M,D,c,g,b){"use strict";var l=q.sap.log;var s={modeDictionary:{equals:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL_CASE_INSENSITIVE;},contains:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING_CASE_INSENSITIVE;},startsWith:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH_CASE_INSENSITIVE;}}};
var d=N.extend("sap.ui.vk.dvl.NodeHierarchy",{
metadata:{},
_baseNodeProxyPool:new O(B),
constructor:function(e){N.call(this);this._graphicsCore=e.getGraphicsCore();this._scene=e;this._dvlSceneRef=this._scene.getSceneRef();this._dvl=this._graphicsCore._getDvl();this._nodeProxies=[];this._layerProxies=[];}
});
d.prototype.destroy=function(){this._layerProxies.slice().forEach(this.destroyLayerProxy,this);this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._dvl=null;this._dvlSceneRef=null;this._scene=null;this._graphicsCore=null;N.prototype.destroy.call(this);};
d.prototype.getGraphicsCore=function(){return this._graphicsCore;};
d.prototype.getScene=function(){return this._scene;};
d.prototype.getSceneRef=function(){return this._dvlSceneRef;};
d.prototype.enumerateChildren=function(n,e,f,p){if(typeof n==="function"){p=f;f=e;e=n;n=undefined;}var h;if(n){if(f||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){h=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{h=[];}}else{h=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}if(p){h.forEach(e);}else{var i=this._baseNodeProxyPool.borrowObject();try{h.forEach(function(n){i.init(this,n);e(i);i.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(i);}}return this;};
d.prototype.enumerateAncestors=function(n,e,p){var f=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;if(p){f.forEach(e);}else{var h=this._baseNodeProxyPool.borrowObject();try{f.forEach(function(n){h.init(this,n);e(h);h.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(h);}}return this;};
d.prototype.createNodeProxy=function(n){var e=new a(this,n);this._nodeProxies.push(e);return e;};
d.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
d.prototype.getChildren=function(n,e){if(typeof n==="boolean"){e=n;n=undefined;}if(n){if(e||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{return[];}}else{return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}};
d.prototype.getAncestors=function(n){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;};
d.prototype.findNodesByName=function(e){var f=sap.ve.dvl.DVLFINDNODETYPE.DVLFINDNODETYPE_NODE_NAME,h=[],j,k;if(e===undefined||e===null||q.isEmptyObject(e)){j=s.modeDictionary.contains(false);k=[""];}else{if(e.value===undefined||e.value===null||e.value===""){q.sap.log.error(b().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}var p=e.hasOwnProperty("predicate")?e.predicate:"equals";if(p===undefined||p===null||p===""){q.sap.log.error(b().getText(M.VIT7.summary),M.VIT7.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}else if(["equals","contains","startsWith"].indexOf(p)===-1){q.sap.log.error(b().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}j=s.modeDictionary[p](e.caseSensitive);k=(typeof e.value==="string")?[e.value]:e.value;}for(var i=0;i<k.length;i++){h=h.concat(g(this._dvl.Scene.FindNodes(this._dvlSceneRef,f,j,k[i])).nodes);}return q.sap.unique(h);};
d.prototype.createLayerProxy=function(e){var f=new L(this,e);this._layerProxies.push(f);return f;};
d.prototype.destroyLayerProxy=function(e){var i=this._layerProxies.indexOf(e);if(i>=0){this._layerProxies.splice(i,1)[0].destroy();}return this;};
d.prototype.getLayers=function(){return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_LAYERS)).Layers;};
d.prototype.getHotspotNodeIds=function(){var h=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return h.length>0?h:this._getLegacyHotspotNodeIds();};
d.prototype._getLegacyHotspotNodeIds=function(){var e=this.getLayers(),h=[];for(var i=0;i<e.length;i++){var f=this.createLayerProxy(e[i]),j=f.getName();if(j.toLowerCase()==="hotspots"){h=f.getNodes();this.destroyLayerProxy(f);break;}this.destroyLayerProxy(f);}return h;};
d.prototype.createNode=function(p,n,i){var e=this._dvl.Scene.CreateNode(this._dvlSceneRef,p,n,i);this.fireNodeCreated({nodeRef:e,nodeId:e});this.fireChanged();return e;};
d.prototype.createNodeCopy=function(n,p,e,i){var f=this._dvl.Scene.CreateNodeCopy(this._dvlSceneRef,n,p,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,e,i);this.fireNodeCreated({nodeRef:f,nodeId:f});this.fireChanged();return f;};
d.prototype.removeNode=function(n){var f=[].concat(n);f.forEach(function(n){this.fireNodeRemoving({nodeRef:n,nodeId:n});try{c(this._dvl.Scene.DeleteNode(this._dvlSceneRef,n));}catch(e){var m="Failed to delete node with ID = "+n+".";if(e instanceof D){m+=" Error code: "+e.code+". Message: "+e.message+".";}l.error(m);}}.bind(this));this.fireChanged();return this;};
return d;});
sap.ui.predefine('sap/ui/vk/dvl/NodeProxy',["../NodeProxy","./getJSONObject","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix"],function(N,g,c,a,b,d,T){"use strict";
var e=N.extend("sap.ui.vk.dvl.NodeProxy",{
metadata:{},
constructor:function(n,f){N.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=f;}
});
e.prototype.destroy=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;N.prototype.destroy.call(this);};
e.prototype.getNodeRef=function(){return this._dvlNodeRef;};
e.prototype.getNodeId=function(){return this._dvlNodeRef;};
e.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlNodeRef));};
e.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
e.prototype.getLocalMatrix=function(){return T.convertTo4x3(g(this._dvl.Scene.GetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
e.prototype.setLocalMatrix=function(v){this._dvl.Scene.SetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&T.convertTo4x4(v));this.setProperty("localMatrix",v,true);return this;};
e.prototype.getWorldMatrix=function(){return T.convertTo4x3(g(this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
e.prototype.setWorldMatrix=function(v){this._dvl.Scene.SetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&T.convertTo4x4(v));this.setProperty("worldMatrix",v,true);return this;};
e.prototype.getOpacity=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_OPACITY)).Opacity;};
e.prototype.setOpacity=function(v){this._dvl.Scene.SetNodeOpacity(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("opacity",v,true);return this;};
e.prototype.getTintColorABGR=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_HIGHLIGHT_COLOR)).HighlightColor;};
e.prototype.setTintColorABGR=function(v){this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",a(b(v)),true);return this;};
e.prototype.getTintColor=function(){return a(b(this.getTintColorABGR()));};
e.prototype.setTintColor=function(v){var f=d(c(v));this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,f);this.setProperty("tintColorABGR",f,true);this.setProperty("tintColor",v,true);return this;};
e.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
e.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
e.prototype.getClosed=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)!==0;};
return e;});
sap.ui.predefine('sap/ui/vk/dvl/Scene',["jquery.sap.global","../Scene","./NodeHierarchy"],function(q,S,N){"use strict";
var a=S.extend("sap.ui.vk.dvl.Scene",{
metadata:{},
constructor:function(g,d){S.call(this);this._id=q.sap.uid();this._graphicsCore=g;this._dvlSceneRef=d;this._defaultNodeHierarchy=null;}
});
a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._dvlSceneRef=null;this._graphicsCore=null;S.prototype.destroy.call(this);};
a.prototype.getId=function(){return this._id;};
a.prototype.getGraphicsCore=function(){return this._graphicsCore;};
a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
a.prototype.getSceneRef=function(){return this._dvlSceneRef;};
a.prototype.setDoubleSided=function(v){this.setProperty("doubleSided",v,true);this._graphicsCore._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_BACKFACING,v);return this;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ViewStateManager',["jquery.sap.global","sap/ui/core/Element","../ContentConnector","../ViewStateManagerBase","./GraphicsCoreApi","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene"],function(q,E,C,V,G,c,a,b,d,S){"use strict";var e;
var f=V.extend("sap.ui.vk.dvl.ViewStateManager",{metadata:{}});
var g=f.getMetadata().getParent().getClass().prototype;
f.prototype.init=function(){if(g.init){g.init.call(this);}this._nodeHierarchy=null;this._dvl=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._visibilityTracker=new e();this._closedNodeProcessed=false;};
f.prototype._setContent=function(i){var j=null;if(i&&i instanceof S){j=i;}this._setScene(j);};
f.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
f.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
f.prototype._handleContentReplaced=function(i){var j=i.getParameter("newContent");this._setContent(j);};
f.prototype._setScene=function(i){if(i){this._setNodeHierarchy(i.getDefaultNodeHierarchy());}else{this._setNodeHierarchy(null);}return this;};
f.prototype._setNodeHierarchy=function(n){var o=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy.detachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.detachNodeRemoving(this._handleNodeRemoving,this);this._dvl.Client.detachStepEvent(this._handleStepEvent,this);this._nodeHierarchy=null;this._dvl=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear();}if(n){var i=n.getScene(),j=i.getSceneRef();this._nodeHierarchy=n;this._dvl=i.getGraphicsCore().getApi(G.LegacyDvl);this._dvl.Client.attachStepEvent(this._handleStepEvent,this);this._nodeHierarchy.attachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._populateNodeStates(this._dvl.Scene.RetrieveSceneInfo(j,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN|sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);}if(n!==o){this.fireNodeHierarchyReplaced({oldNodeHierarchy:o,newNodeHierarchy:n});}return this;};
f.prototype._populateNodeStates=function(n){var t=this,v=[],i=[],j=[],u=[],k=this._nodeHierarchy.getScene(),l=k.getSceneRef();n.forEach(function addNodeRecursive(m){var o=t._dvl.Scene.RetrieveNodeInfo(l,m,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS|sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN);t._nodeStates.set(m,{flags:o.Flags});if(o.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){t._selectedNodes.add(m);}(o.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE?v:i).push(m);(o.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED?j:u).push(m);o.ChildNodes.forEach(addNodeRecursive);});this.fireSelectionChanged({selected:j,unselected:u});this.fireVisibilityChanged({visible:v,hidden:i});return this;};
f.prototype._handleNodeCreated=function(i){this._populateNodeStates([i.getParameter("nodeRef")]);};
f.prototype._handleNodeRemoving=function(i){var n=i.getParameter("nodeRef"),t=this;var r=function(n){t._nodeHierarchy.enumerateChildren(n,r,true,true);t._nodeStates.delete(n);};r(n);};
f.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
f.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
f.prototype.getVisibilityComplete=function(){var n=this.getNodeHierarchy(),i=n.findNodesByName(),v=[],j=[];i.forEach(function(k){var l=n.createNodeProxy(k),m=q.grep(l.getVeIds(),function(m){return m.type==="VE_LOCATOR";});m=Array.isArray(m)&&m.length>0?m[0].fields[0].value:null;n.destroyNodeProxy(l);if(m){if(this.getVisibilityState(k)){v.push(m);}else{j.push(m);}}},this);return{visible:v,hidden:j};};
f.prototype.resetVisibility=function(){this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY,this._scene);return this;};
var h=function(n,i,j){return n.has(j)&&(n.get(j).flags&i)!==0;};
f.prototype._getVisibilityFlagState=function(n){return h(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE,n);};
f.prototype._getSelectionFlagState=function(n){return h(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED,n);};
var s=function(n,i,j,k){if(n.has(k)){var l=n.get(k);l.flags=l.flags&~j|i&j;}else{n.set(k,{flags:i&j});}};
f.prototype._setFlags=function(n,i,j){if(j&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE){this.setVisibilityState(n,(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0,false);}if(j&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){this.setSelectionState(n,(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0,false);}s(this._nodeStates,i,j&~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED),n);return this;};
f.prototype._getFlags=function(n,i){var j=this._nodeStates.get(n),k=j&&j.flags;return k!==undefined?k&i:null;};
f.prototype.getVisibilityState=function(n){return Array.isArray(n)?n.map(this._getVisibilityFlagState,this):this._getVisibilityFlagState(n);};
f.prototype.setVisibilityState=function(n,v,r){if(!Array.isArray(n)){n=[n];}var i=q.sap.unique(r?this._collectNodesRecursively(n,true):n).filter(function(j){return j&&this._getVisibilityFlagState(j)!==v;},this);if(i.length>0){i.forEach(function(j){var k=this._nodeStates.get(j);if(k){if(k.flags===undefined){k.flags=0;}if(v){k.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;}else{k.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;}}else{this._nodeStates.set(j,{flags:v?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE:0});}},this);if(this.getShouldTrackVisibilityChanges()){i.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged({visible:v?i:[],hidden:v?[]:i});}return this;};
f.prototype.enumerateSelection=function(i){this._selectedNodes.forEach(i);return this;};
f.prototype.getSelectionState=function(n){return Array.isArray(n)?n.map(this._getSelectionFlagState,this):this._getSelectionFlagState(n);};
f.prototype.setSelectionState=function(n,i,r,j){if(!Array.isArray(n)){n=[n];}var k=q.sap.unique(r||this.getRecursiveSelection()?this._collectNodesRecursively(n):n);if(this.getRecursiveSelection()&&!i){k=this._nodeHierarchy._appendAncestors(k);}k=k.filter(function(l){return l&&this._getSelectionFlagState(l)!==i;},this);if(k.length>0){k.forEach(function(l){var m=this._nodeStates.get(l);if(m){if(m.flags===undefined){m.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),l,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}if(i){m.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{m.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}}else{var o=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),l,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(l,{flags:o|(i?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED:0)});}this._selectedNodes[i?"add":"delete"](l);},this);if(!j){this.fireSelectionChanged({selected:i?k:[],unselected:i?[]:k});}}return this;};
f.prototype.setSelectionStates=function(i,u,r,j){if(!Array.isArray(i)){i=[i];}if(!Array.isArray(u)){u=[u];}var k=q.sap.unique(r||this.getRecursiveSelection()?this._collectNodesRecursively(i):i);var l=q.sap.unique(r||this.getRecursiveSelection()?this._collectNodesRecursively(u):u);if(this.getRecursiveSelection()){l=this._nodeHierarchy._appendAncestors(l,k);}k=k.filter(function(n){return n&&this._getSelectionFlagState(n)===false;},this);l=l.filter(function(n){return n&&this._getSelectionFlagState(n)===true;},this);if(k.length>0){k.forEach(function(n){var m=this._nodeStates.get(n);if(m){if(m.flags===undefined){m.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}m.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{var o=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(n,{flags:o|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED});}this._selectedNodes["add"](n);},this);}if(l.length>0){l.forEach(function(n){var m=this._nodeStates.get(n);if(m){if(m.flags===undefined){m.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}m.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{var o=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(n,{flags:o});}this._selectedNodes["delete"](n);},this);}if(!j){if(k.length>0||l.length>0){this.fireSelectionChanged({selected:k,unselected:l});}}return this;};
f.prototype._handleStepEvent=function(i){if(i.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._visibilityTracker.clear();}};
f.prototype._collectNodesRecursively=function(n,i){var r=[],t=this;if(i===undefined){i=false;}n.forEach(function collectChildNodes(j){r.push(j);t._nodeHierarchy.enumerateChildren(j,collectChildNodes,i,true);});return r;};
f.prototype._getOpacity=function(n){if(this._nodeStates.has(n)){var o=this._nodeStates.get(n).opacity;return o===undefined?null:o;}else{return null;}};
f.prototype.getOpacity=function(n){if(Array.isArray(n)){return n.map(this._getOpacity,this);}else{return this._getOpacity(n);}};
f.prototype.setOpacity=function(n,o,r){if(!Array.isArray(n)){n=[n];}var i=q.sap.unique(r?this._collectNodesRecursively(n,true):n).filter(function(j){return j&&this._getOpacity(j)!==o;},this);if(i.length>0){i.forEach(function(j){var k=this._nodeStates.get(j);if(k){if(o===null){delete k.opacity;}else{k.opacity=o;}}else if(o!==null){this._nodeStates.set(j,{opacity:o});}},this);this.fireOpacityChanged({changed:i,opacity:o});}return this;};
f.prototype._getTintColorABGR=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:t;}else{return null;}};
f.prototype._getTintColor=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:a(b(t));}else{return null;}};
f.prototype.getTintColor=function(n,i){var j=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(n)){return n.map(this[j],this);}else{return this[j](n);}};
f.prototype.setTintColor=function(n,t,r){if(!Array.isArray(n)){n=[n];}var i=null;switch(typeof t){case"number":i=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){i=d(c(t));}break;default:t=null;break;}var j=q.sap.unique(r?this._collectNodesRecursively(n,true):n).filter(function(k){return k&&this._getTintColorABGR(k)!==i;},this);if(j.length>0){j.forEach(function(k){var l=this._nodeStates.get(k);if(l){if(i===null){delete l.tintColorABGR;}else{l.tintColorABGR=i;}}else if(i!==null){this._nodeStates.set(k,{tintColorABGR:i});}},this);this.fireTintColorChanged({changed:j,tintColor:t,tintColorABGR:i});}return this;};
e=function(){this._visibilityChanges=new Set();};
e.prototype.getInfo=function(n){var i=function(v){return v.type==="VE_LOCATOR";};var j=[];this._visibilityChanges.forEach(function(k){var l=n.createNodeProxy(k),v=q.grep(l.getVeIds(),i);v=Array.isArray(v)&&v.length>0?v[0].fields[0].value:null;n.destroyNodeProxy(l);if(v){j.push(v);}});return j;};
e.prototype.clear=function(){this._visibilityChanges.clear();};
e.prototype.trackNodeRef=function(n){if(this._visibilityChanges.has(n)){this._visibilityChanges.delete(n);}else{this._visibilityChanges.add(n);}};
C.injectMethodsIntoClass(f);return f;});
sap.ui.predefine('sap/ui/vk/dvl/Viewport',["jquery.sap.global","sap/ui/core/ResizeHandler","../abgrToColor","../CameraFOVBindingType","../CameraProjectionType","../colorToABGR","../colorToCSSColor","../ContentConnector","../cssColorToColor","../getResourceBundle","../Loco","../Messages","../SelectionMode","../Smart2DHandler","../ViewportBase","../ViewportHandler","../ViewStateManager","../VisibilityMode","../ZoomTo","./getJSONObject","./Scene","./ViewportRenderer"],function(q,R,a,C,b,c,d,e,g,h,L,M,S,k,V,l,n,o,Z,p,r,s){"use strict";var t;var u=function(){if(t){return;}t={encodedProjectionType:{},decodedProjectionType:{},encodedBindingType:{},decodedBindingType:{},decodedZoomTo:{}};t.decodedProjectionType[b.Perspective]=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;t.decodedProjectionType[b.Orthographic]=sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;t.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE]=b.Perspective;t.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC]=b.Orthographic;t.decodedBindingType[C.Minimum]=sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;t.decodedBindingType[C.Maximum]=sap.ve.dvl.DVLCAMERAFOVBINDING.Max;t.decodedBindingType[C.Horizontal]=sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ;t.decodedBindingType[C.Vertical]=sap.ve.dvl.DVLCAMERAFOVBINDING.VERT;t.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MIN]=C.Minimum;t.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MAX]=C.Maximum;t.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ]=C.Horizontal;t.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.VERT]=C.Vertical;t.decodedZoomTo[Z.All]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_ALL;t.decodedZoomTo[Z.Visible]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_VISIBLE;t.decodedZoomTo[Z.Selected]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_SELECTED;t.decodedZoomTo[Z.Node]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE;t.decodedZoomTo[Z.NodeSetIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE_SETISOLATION;t.decodedZoomTo[Z.Restore]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE;t.decodedZoomTo[Z.RestoreRemoveIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE_REMOVEISOLATION;t.decodedZoomTo[Z.ViewLeft]=sap.ve.dvl.DVLZOOMTO.VIEW_LEFT;t.decodedZoomTo[Z.ViewRight]=sap.ve.dvl.DVLZOOMTO.VIEW_RIGHT;t.decodedZoomTo[Z.ViewTop]=sap.ve.dvl.DVLZOOMTO.VIEW_TOP;t.decodedZoomTo[Z.ViewBottom]=sap.ve.dvl.DVLZOOMTO.VIEW_BOTTOM;t.decodedZoomTo[Z.ViewBack]=sap.ve.dvl.DVLZOOMTO.VIEW_BACK;t.decodedZoomTo[Z.ViewFront]=sap.ve.dvl.DVLZOOMTO.VIEW_FRONT;};
var v=V.extend("sap.ui.vk.dvl.Viewport",{metadata:{library:"sap.ui.vk",properties:{showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"},backgroundColorTopABGR:{type:"int",defaultValue:0xff000000},backgroundColorBottomABGR:{type:"int",defaultValue:0xffffffff}},events:{pan:{parameters:{dx:"int",dy:"int"}},zoom:{parameters:{zoomFactor:"float"}},rotate:{parameters:{dx:"int",dy:"int"}},frameRenderingFinished:{}}}});
var w=v.getMetadata().getParent().getClass().prototype;
v.prototype.init=function(){u();if(w.init){w.init.call(this);}this._graphicsCore=null;this._dvl=null;this._dvlRendererId=null;this._viewStateManager=null;this._canvas=null;this._resizeListenerId=null;this._is2D=false;this._viewportHandler=new l(this);this._loco=new L(this);this._loco.addHandler(this._viewportHandler,-1);this._smart2DHandler=null;this._lastPlayedStep=null;this._contentConnector=null;};
v.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._clearContentConnector();this.setViewStateManager(null);this.setScene(null);this.setGraphicsCore(null);if(w.exit){w.exit.call(this);}};
v.prototype.setGraphicsCore=function(f){if(f!=this._graphicsCore){if(this._graphicsCore){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);this._dvl.Client.detachStepEvent(this._updateLastPlayedStep,this);this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);this._graphicsCore._deregisterViewport(this);this._dvl=null;}this._graphicsCore=f;if(this._graphicsCore){this._dvl=this._graphicsCore._getDvl();this._graphicsCore._registerViewport(this);this.setShowDebugInfo(this.getShowDebugInfo());this._dvl.Client.attachStepEvent(this._updateLastPlayedStep,this);this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId);}}return this;};
v.prototype.getGraphicsCore=function(){return this._graphicsCore;};
v.prototype._setCanvas=function(f){var i=this.getDomRef()&&this._canvas!==f;this._canvas=f;if(i){this.invalidate();}return this;};
v.prototype._setRenderer=function(f){this._dvlRendererId=f;return this;};
v.prototype._updateLastPlayedStep=function(f){if(f.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._lastPlayedStep=f.stepId;}};
v.prototype.setScene=function(f){if(this._dvlRendererId){this._dvl.Renderer.AttachScene(f&&f.getSceneRef()||null,this._dvlRendererId);this._dvlSceneRef=f?f.getSceneRef():null;if(f){this._dvl.Client.attachUrlClicked(this._fireUrlClicked,this);var i=this._isSmart2DContent()||this._isSmart2DContentLegacy();if(i){this._dvl.Renderer.SetBackgroundColor(1,1,1,1,1,1,1,1,this._dvlRendererId);}else{var j=this._getDecomposedABGR(this.getBackgroundColorTopABGR());var m=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(j.red,j.green,j.blue,j.alpha,m.red,m.green,m.blue,m.alpha,this._dvlRendererId);}this.fireViewActivated({type:i?"2D":"3D"});}else{this._dvl.Client.detachUrlClicked(this._fireUrlClicked,this);if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler);}this.invalidate();}}return this;};
v.prototype._isSmart2DContent=function(){var f=p(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return f&&f.length>0;};
v.prototype._isSmart2DContentLegacy=function(){var f=this._dvl.Scene.GetCurrentCamera(this._dvlSceneRef),i=this._dvl.Camera.GetRotation(f),j=this._dvl.Camera.GetProjection(f);return i[0]===90&&i[1]===-90&&i[2]===0&&j===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;};
v.prototype._initializeSmart2DHandler=function(){if(this._viewStateManager){if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler);}this._smart2DHandler=new k(this,this._viewStateManager);this._loco.addHandler(this._smart2DHandler,0);}if(this.getShowAllHotspots()){var f=this._viewStateManager.getNodeHierarchy(),i=f.getHotspotNodeIds();this.showHotspots(i,true);}};
v.prototype._fireUrlClicked=function(f){this.fireUrlClicked({url:f.url,nodeRef:f.nodeId});};
v.prototype.setHotspotColorABGR=function(f){this.setProperty("hotspotColorABGR",f,true);this.setProperty("hotspotColor",d(a(this.getProperty("hotspotColorABGR"))),true);return this;};
v.prototype.setHotspotColor=function(f){this.setProperty("hotspotColor",f,true);this.setProperty("hotspotColorABGR",c(g(this.getProperty("hotspotColor"))),true);return this;};
v.prototype._getStepAndProcedureIndexes=function(f,m){var x=-1,y=-1,N=false;for(var i=0;i<f.length;i++){if(!N){for(var j=0;j<f[i].steps.length;j++){if(f[i].steps[j].id===m){y=j;x=i;N=true;break;}}}else{break;}}return{stepIndex:y,procedureIndex:x};};
v.prototype._getStepVeIdById=function(f){if(f){var i=this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,f);if(Array.isArray(i)){for(var j=0,m=i.length;j<m;++j){var x=i[j];if(x.source==="SAP"&&x.type==="VE_VIEWPORT"&&Array.isArray(x.fields)){for(var y=0,N=x.fields.length;y<N;++y){var O=x.fields[y];if(O.name==="ID"){return O.value;}}}}}}return null;};
v.prototype._getStepIdByVeId=function(f,i){for(var j=0,m=f.length;j<m;++j){var x=f[j].steps;for(var y=0,N=x.length;y<N;++y){var O=x[y].id;if(this._getStepVeIdById(O)===i){return O;}}}return null;};
var z=function(f){f.camera={};};var A=function(f){if(typeof f.camera==="object"&&f.camera!==null){f.camera.matrices=false;}};var B=function(f){if(typeof f.camera==="object"&&f.camera!==null){f.camera.useTransitionCamera=false;}};var D=function(f){f.animation=true;};var E=function(f){f.visibility=false;};var F=function(f){if(typeof f.visibility==="object"&&f.visibility!==null){f.visibility.mode=o.Complete;}};
v.prototype.getViewInfo=function(f){if(!this._dvlSceneRef){return null;}var i={};if(typeof f!=="object"||f===null){z(i);A(i);B(i);D(i);E(i);F(i);}else{if(typeof f.camera==="object"&&f.camera!==null){i.camera={};if(typeof f.camera.matrices==="boolean"){i.camera.matrices=f.camera.matrices;}else if("matrices"in f.camera){i.camera.matrices=false;}else{A(i);}if(typeof f.camera.useTransitionCamera==="boolean"){i.camera.useTransitionCamera=f.camera.useTransitionCamera;}else if("useTransitionCamera"in f.camera){i.camera.useTransitionCamera=false;}else{B(i);}}else if(typeof f.camera==="boolean"){if(f.camera===true){i.camera={};A(i);B(i);}else{i.camera=false;}}else if("camera"in f){i.camera=false;}else{z(i);A(i);B(i);}if(typeof f.animation==="boolean"){i.animation=f.animation;}else if("animation"in f){i.animation=false;}else{D(i);}if(typeof f.visibility==="object"&&f.visibility!==null){i.visibility={};if(f.visibility.mode===o.Complete||f.visibility.mode===o.Differences){i.visibility.mode=f.visibility.mode;}else{F(i);}}else if(typeof f.visibility==="boolean"){if(f.visibility===true){i.visibility={};F(i);}else{i.visibility=false;}}else if("visibility"in f){i.visibility=false;}else{E(i);F(i);}}var j={};if(i.camera){var m=null;if(i.camera.useTransitionCamera){m=this._dvl.Renderer.GetTransitionCamera(this._dvlRendererId);if(m===sap.ve.dvl.DVLID_INVALID){m=null;}}if(m===null){m=this._dvl.Renderer.GetCurrentCamera(this._dvlRendererId);}var x=this._dvl.Camera.GetRotation(m),y=this._dvl.Camera.GetOrigin(m);j.camera={rotation:{yaw:x[0],pitch:x[1],roll:x[2]},position:{x:y[0],y:y[1],z:y[2]},projectionType:t.encodedProjectionType[this._dvl.Camera.GetProjection(m)],bindingType:t.encodedBindingType[this._dvl.Camera.GetFOVBinding(m)]};if(this._matView){j.viewMatrix=this._matView.slice();}if(this._matProj){j.projectionMatrix=this._matProj.slice();}if(j.camera.projectionType===b.Perspective){j.camera.fieldOfView=this._dvl.Camera.GetFOV(m);}else if(j.camera.projectionType===b.Orthographic){j.camera.zoomFactor=this._dvl.Camera.GetOrthoZoomFactor(m);}if(i.camera.matrices){var N=this._dvl.Renderer.GetCameraMatrices(this._dvlRendererId);j.camera.matrices={view:N.view,projection:N.projection};}}if(i.animation){var O=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO),P=O.StepId!==sap.ve.dvl.DVLID_INVALID;var Q=P?O.StepId:this._lastPlayedStep,T=P?O.StepTime:0,U=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),W=this._getStepAndProcedureIndexes(U.procedures,Q),X=this._getStepVeIdById(Q);j.animation={animationTime:T,stepIndex:W.stepIndex,procedureIndex:W.procedureIndex};if(X){j.animation.stepVeId=X;}}if(i.visibility&&this._viewStateManager){j.visibility={mode:i.visibility.mode};if(i.visibility.mode===o.Complete){var Y=this._viewStateManager.getVisibilityComplete();j.visibility.visible=Y.visible;j.visibility.hidden=Y.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){j.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{q.sap.log.warning(h().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.dvl.Viewport");}}return j;};
v.prototype.setViewInfo=function(f,i){var j=false;if(f.animation){var m=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),x=f.animation.procedureIndex,y=f.animation.stepIndex,N=f.animation.stepVeId,O,P=f.animation.animationTime||0;if(N||y>=0&&x>=0){if(N){O=this._getStepIdByVeId(m.procedures,f.animation.stepVeId);}else if(x>=0&&x<m.procedures.length){if(y>=0&&y<m.procedures[x].steps.length){O=m.procedures[x].steps[y].id;}else{q.sap.log.error(h().getText(M.VIT26.summary),M.VIT26.code,"sap.ui.vk.dvl.Viewport");}}else{q.sap.log.error(h().getText(M.VIT27.summary),M.VIT27.code,"sap.ui.vk.dvl.Viewport");}if(O){this._dvl.Renderer.ActivateStep(this._dvlRendererId,O,false,false,P);this._dvl.Renderer.PauseCurrentStep(this._dvlRendererId);}}else{j=true;}}if(f.camera){var Q;if(f.camera.projectionType===b.Perspective||f.camera.projectionType===b.Orthographic){Q=t.decodedProjectionType[f.camera.projectionType];}else{q.sap.log.error(h().getText(M.VIT19.summary),M.VIT19.code,"sap.ui.vk.dvl.Viewport");Q=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;}var T=this._dvl.Scene.CreateCamera(this._dvlSceneRef,Q,sap.ve.dvl.DVLID_INVALID);if(Q===sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE){this._dvl.Camera.SetFOV(T,f.camera.fieldOfView);}else if(Q===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC){this._dvl.Camera.SetOrthoZoomFactor(T,f.camera.zoomFactor);}if(f.camera.position){this._dvl.Camera.SetOrigin(T,f.camera.position.x,f.camera.position.y,f.camera.position.z);}if(f.camera.rotation){this._dvl.Camera.SetRotation(T,f.camera.rotation.yaw,f.camera.rotation.pitch,f.camera.rotation.roll);}if(f.camera.bindingType){var U=t.decodedBindingType[f.camera.bindingType]||sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;this._dvl.Camera.SetFOVBinding(T,U);}i=i||0;this._dvl.Renderer.ActivateCamera(this._dvlRendererId,T,i);this._dvl.Scene.DeleteNode(this._dvlSceneRef,T);}if(f.viewMatrix){this._matView=f.viewMatrix.slice();}if(f.projectionMatrix){this._matProj=f.projectionMatrix.slice();}if(f.visibility){var W=this._viewStateManager.getNodeHierarchy(),X=new Map(),Y=W.findNodesByName();Y.forEach(function(a1){var b1=W.createNodeProxy(a1),c1=q.grep(b1.getVeIds(),function(c1){return c1.type==="VE_LOCATOR";});c1=Array.isArray(c1)&&c1.length>0?c1[0].fields[0].value:null;W.destroyNodeProxy(b1);if(c1){X.set(c1,a1);}});switch(f.visibility.mode){case o.Complete:var $=f.visibility.visible,_=f.visibility.hidden;$.forEach(function(a1){this._viewStateManager.setVisibilityState(X.get(a1),true,false);},this);_.forEach(function(a1){this._viewStateManager.setVisibilityState(X.get(a1),false,false);},this);break;case o.Differences:if(j){this.resetView({camera:false,visibility:true,transition:false});}f.visibility.changes.forEach(function(a1){var b1=X.get(a1);if(b1){this._viewStateManager.setVisibilityState(b1,!this._viewStateManager.getVisibilityState(b1),false);}},this);break;default:q.sap.log.error(h().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.dvl.Viewport");break;}}return this;};
v.prototype.setSelectionRect=function(f){if(!f){this._dvl.Renderer.DrawSelectionRect(0,0,0,0,this._dvlRendererId);}else{this._dvl.Renderer.DrawSelectionRect(f.x1,f.y1,f.x2,f.y2,this._dvlRendererId);}};
v.prototype.getOutputSize=function(){var f=this.getViewInfo().camera.bindingType,i=this.getDomRef().getBoundingClientRect(),j=i.width,m=i.height,x;switch(t.decodedBindingType[f]){case sap.ve.dvl.DVLCAMERAFOVBINDING.MIN:x=Math.min(j,m);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.MAX:x=Math.max(j,m);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ:x=j;break;case sap.ve.dvl.DVLCAMERAFOVBINDING.VERT:x=m;break;default:break;}return{left:(j-x)/2,top:(m-x)/2,sideLength:x};};
v.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
v.prototype.onAfterRendering=function(){var f=this.getDomRef();if(this._canvas){f.appendChild(this._canvas);}this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:f.clientWidth,height:f.clientHeight}});};
v.prototype._handleResize=function(f){if(this._dvlRendererId&&this._canvas){var i=f.size.width*window.devicePixelRatio;var j=f.size.height*window.devicePixelRatio;if(this._matProj){var m=this._matProj[0];var x=this._matProj[5];var y=Math.max(m,x);if(i>j){m=y*j/i;x=y;}else{m=y;x=y*i/j;}this._matProj[8]*=m/this._matProj[0];this._matProj[9]*=x/this._matProj[5];this._matProj[0]=m;this._matProj[5]=x;}this._dvl.Renderer.SetDimensions(i,j,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,this._dvlRendererId);this._canvas.width=i;this._canvas.height=j;this._canvas.style.width=f.size.width+"px";this._canvas.style.height=f.size.height+"px";this.fireResize({size:{width:f.size.width,height:f.size.height}});return true;}};
v.prototype._handleVisibilityChanged=v.prototype._handleSelectionChanged=v.prototype._handleOpacityChanged=v.prototype._handleTintColorChanged=function(f){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}};
v.prototype.showHotspots=function(f,i,j){var m=sap.ui.vk.dvl.NodeProxy.prototype[typeof j==="string"?"setTintColor":"setTintColorABGR"];var x=function(N,j,T){var U=N.createNodeProxy(T);m.call(U,j);N.destroyNodeProxy(U);};if(!Array.isArray(f)){f=[f];}var y=j===undefined?this.getHotspotColorABGR():j;if(!i){y=0;}var N=this._viewStateManager.getNodeHierarchy();if(this._isSmart2DContent()){var O=[];f.forEach(function(T){var U=p(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,T,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN).ChildNodes);Array.prototype.push.apply(O,U);}.bind(this));Array.prototype.push.apply(O,f);O.forEach(x.bind(null,N,y));}else{var P=[];var Q=function(T){var O=N.getChildren(T);Array.prototype.push.apply(P,O);O.forEach(Q);};f.forEach(Q);Array.prototype.push.apply(P,f);P.forEach(x.bind(null,N,y));}return this;};
v.prototype._getDecomposedABGR=function(i){return{red:(i>>>0&0xff)/255,green:(i>>>8&0xff)/255,blue:(i>>>16&0xff)/255,alpha:(i>>>24&0xff)/255};};
v.prototype._setBackgroundColor=function(){if(this._dvl){var f=this._getDecomposedABGR(this.getBackgroundColorTopABGR()),i=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(f.red,f.green,f.blue,f.alpha,i.red,i.green,i.blue,i.alpha,this._dvlRendererId);}};
v.prototype.setBackgroundColorTopABGR=function(i){this.setProperty("backgroundColorTopABGR",i,true);this._setBackgroundColor();return this;};
v.prototype.setBackgroundColorTop=function(f){this.setProperty("backgroundColorTop",f,true);return this.setBackgroundColorTopABGR(c(g(f)));};
v.prototype.setBackgroundColorBottomABGR=function(i){this.setProperty("backgroundColorBottomABGR",i,true);this._setBackgroundColor();return this;};
v.prototype.setBackgroundColorBottom=function(f){this.setProperty("backgroundColorBottom",f,true);return this.setBackgroundColorBottomABGR(c(g(f)));};
v.prototype.setShouldRenderFrame=function(){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}return this;};
v.prototype.shouldRenderFrame=function(){return this._dvlRendererId&&this._dvl.Renderer.ShouldRenderFrame(this._dvlRendererId);};
v.prototype.renderFrame=function(){if(this._dvlRendererId){if(this._matView&&this._matProj){this.renderFrameEx(this._matView,this._matProj,this._dvlRendererId);}else{this._dvl.Renderer.RenderFrame(this._dvlRendererId);}}return this;};
v.prototype.renderFrameEx=function(f,i){if(this._dvlRendererId){this._dvl.Renderer.RenderFrameEx.apply(this,[].concat(f,i),this._dvlRendererId);}return this;};
v.prototype.resetView=function(f){if(f!==undefined&&!q.isPlainObject(f)){q.sap.log.error(h().getText(M.VIT31.summary),M.VIT31.code,"sap.ui.vk.dvl.Viewport");}var i={camera:true,transition:true,visibility:false};q.extend(i,f);if(i.camera||i.visibility){var j=(i.camera?sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA:0)|(i.transition?sap.ve.dvl.DVLRESETVIEWFLAG.SMOOTHTRANSITION:0)|(i.visibility?sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY:0);if(this._dvlRendererId){this._dvl.Renderer.ResetView(j,this._dvlRendererId);this._lastPlayedStep=null;}}return this;};
v.prototype.canIsolateNode=function(f){if(this._dvlRendererId){return this._dvl.Renderer.CanIsolateNode(f,this._dvlRendererId);}else{return false;}};
v.prototype.setIsolatedNode=function(f){if(this._dvlRendererId){this._dvl.Renderer.SetIsolatedNode(f,this._dvlRendererId);}return this;};
v.prototype.getIsolatedNode=function(){if(this._dvlRendererId){return this._dvl.Renderer.GetIsolatedNode(this._dvlRendererId);}else{return sap.ve.dvl.DVLID_INVALID;}};
v.prototype.hitTest=function(x,y){if(this._dvlRendererId){var f=this._dvl.Renderer.HitTest(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId).id;this.setShouldRenderFrame();return f;}else{return null;}};
v.prototype.setShowDebugInfo=function(f){this.setProperty("showDebugInfo",f,true);if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_DEBUG_INFO,f,this._dvlRendererId);}return this;};
v.prototype._handleFrameFinished=function(f){if(f.rendererId===this._dvlRendererId){this.fireFrameRenderingFinished();}};
v.prototype.beginGesture=function(x,y){if(this._dvlRendererId){this._gesturePoint={x:x,y:y};this._dvl.Renderer.BeginGesture(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId);}return this;};
v.prototype.endGesture=function(){if(this._dvlRendererId){this._dvl.Renderer.EndGesture(this._dvlRendererId);}return this;};
v.prototype._activateRedline=function(){this.renderFrame();var m=this._dvl.Renderer.GetCameraMatrices();this._matView=m.view;this._matProj=m.projection;};
v.prototype._deactivateRedline=function(){this._matView=null;this._matProj=null;};
v.prototype.pan=function(f,i){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._matProj){var j=this.getDomRef();this._matProj[8]-=f*2/j.clientWidth;this._matProj[9]+=i*2/j.clientHeight;this.setShouldRenderFrame();}else{this._dvl.Renderer.Pan(f*window.devicePixelRatio,i*window.devicePixelRatio,this._dvlRendererId);}this.firePan({dx:f,dy:i});}return this;};
v.prototype.rotate=function(f,i){if(this._dvlRendererId&&!this.getFreezeCamera()){this._dvl.Renderer.Rotate(f*window.devicePixelRatio,i*window.devicePixelRatio,this._dvlRendererId);this.fireRotate({dx:f,dy:i});}return this;};
function G(f){var m=f;var i=m[15]===1;var j=2/m[0];var x=2/m[5];var y,N;if(i){y=-m[12]*j;N=-m[13]*x;}else{y=m[8]*j;N=m[9]*x;}var O=(j+y)*0.5;var P=y-O;var Q=(x+N)*0.5;var T=N-Q;return{left:P,top:Q,right:O,bottom:T};}
function H(f,i){var m=f;var j=m[15]===1;m[0]=2/(i.right-i.left);m[5]=2/(i.top-i.bottom);if(j){m[12]=-(i.right+i.left)/(i.right-i.left);m[13]=-(i.top+i.bottom)/(i.top-i.bottom);}else{m[8]=(i.right+i.left)/(i.right-i.left);m[9]=(i.top+i.bottom)/(i.top-i.bottom);}}
v.prototype.zoom=function(i){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._matProj){var j=this.getDomRef();var m=G(this._matProj);var x=m.left+(m.right-m.left)*this._gesturePoint.x/j.clientWidth;var y=m.top+(m.bottom-m.top)*this._gesturePoint.y/j.clientHeight;var f=1/i;m.left=x+(m.left-x)*f;m.right=x+(m.right-x)*f;m.top=y+(m.top-y)*f;m.bottom=y+(m.bottom-y)*f;H(this._matProj,m);this.setShouldRenderFrame();}else{this._dvl.Renderer.Zoom(i,this._dvlRendererId);}this.fireZoom({zoomFactor:i});}return this;};
v.prototype.zoomTo=function(f,j,m,x){if(this._dvlRendererId){var y=0;if(Array.isArray(f)){for(var i in f){y|=t.decodedZoomTo[f[i]];}}else{y=t.decodedZoomTo[f];}this._dvl.Renderer.ZoomTo(y,j,m,x,this._dvlRendererId);}return this;};
v.prototype.tap=function(x,y,i){if(this._dvlRendererId){var f=x*window.devicePixelRatio,j=y*window.devicePixelRatio;if(!i){var m=this.hitTest(x,y);var N={picked:m===sap.ve.dvl.DVLID_INVALID||m==null?[]:[m]};this.fireNodesPicked(N);if(this.getSelectionMode()===S.Exclusive){this.exclusiveSelectionHandler(N.picked);}else if(this.getSelectionMode()===S.Sticky){this.stickySelectionHandler(N.picked);}if(m!==sap.ve.dvl.DVLID_INVALID){this.fireNodeClicked({nodeRef:m,nodeId:m,x:x,y:y},true,true);}this._dvl.Renderer.Tap(f,j,false,false,this._dvlRendererId);}else if(!this.getFreezeCamera()){this._dvl.Renderer.Tap(f,j,true,false,this._dvlRendererId);}}return this;};
v.prototype.rectSelect=function(x,y,f,i){var j=[];if(this._dvlRendererId){var m=p(this._dvl.Renderer.RectSelect(x,y,f,i,this._dvlRendererId));if(m.SelectedNodes){j=m.SelectedNodes;}}return j;};
v.prototype.queueCommand=function(f){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(f,this._dvlRendererId);}return this;};
v.prototype._setContent=function(f){var i=null;if(f&&f instanceof r){i=f;}this._setScene(i);};
v.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
v.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
v.prototype._handleContentReplaced=function(f){var i=f.getParameter("newContent");this._setContent(i);};
v.prototype._setScene=function(f){var i=f&&f.getGraphicsCore();this.setGraphicsCore(i);this.setScene(f);if(f&&(this._isSmart2DContent()||this._isSmart2DContentLegacy())){this._initializeSmart2DHandler();}};
v.prototype._handleContentChangesFinished=function(f){if(f.getSource().getContentResources().length>1){this.zoomTo(Z.Visible,sap.ve.dvl.DVLID_INVALID,0,0);}this.setShouldRenderFrame();};
v.prototype._onAfterUpdateViewStateManager=function(){if(this._dvl){this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId);}};
v.prototype._onBeforeClearViewStateManager=function(){if(this._dvl){this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);}};
var I={x:-2,y:-2};var J=2;var K=5;[{key:"left",dx:-J,dy:0},{key:"right",dx:+J,dy:0},{key:"up",dx:0,dy:-J},{key:"down",dx:0,dy:+J}].forEach(function(i){v.prototype["onsap"+i.key]=function(f){this.beginGesture(I.x,I.y);this.rotate(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();};});[{key:"left",dx:-K,dy:0},{key:"right",dx:+K,dy:0},{key:"up",dx:0,dy:-K},{key:"down",dx:0,dy:+K}].forEach(function(i){v.prototype["onsap"+i.key+"modifiers"]=function(f){if(f.shiftKey&&!(f.ctrlKey||f.altKey||f.metaKey)){this.beginGesture(I.x,I.y);this.pan(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){v.prototype["onsap"+i.key]=function(f){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();};});e.injectMethodsIntoClass(v);n.injectMethodsIntoClass(v);return v;});
sap.ui.predefine('sap/ui/vk/dvl/ViewportRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.writeAttribute("aria-label","Image");var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");var i,l;var t=c.getTools();for(i=0,l=t.length;i<l;i++){var _=sap.ui.getCore().byId(t[i]);var b=_.getGizmoForContainer(c);if(b&&b.render===undefined){r.renderControl(b);}}var C=c.getContent();for(i=0,l=C.length;i<l;i++){r.renderControl(C[i]);}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/dvl/checkResult',["sap/base/Log","../DvlException"],function(L,D){"use strict";var c=function(r){if(r<0){var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";L.error(m,JSON.stringify({errorCode:r}),"sap.ve.dvl");throw new D(r,m);}return r;};return c;},true);
sap.ui.predefine('sap/ui/vk/dvl/getJSONObject',["sap/base/Log","../DvlException"],function(L,D){"use strict";var g=function(o){if(typeof o==="number"){var r=o;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";L.error(m,JSON.stringify({errorCode:r}),"sap.ve.dvl");throw new D(r,m);}return o;};return g;},true);
sap.ui.predefine('sap/ui/vk/dvl/getPointer',["sap/base/Log","../DvlException"],function(L,D){"use strict";var g=function(p){if(typeof p==="number"){var r=p;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";L.error(m,JSON.stringify({errorCode:r}),"sap.ve.dvl");throw new D(r,m);}return p;};return g;},true);
sap.ui.predefine('sap/ui/vk/getResourceBundle',["sap/ui/core/Core","sap/base/util/ObjectPath"],function(c,O){"use strict";var g=function(){var r=c.getLibraryResourceBundle("sap.ui.vk.i18n");O.get("sap.ui.vk").getResourceBundle=function(){return r;};return r;};return g;},true);
sap.ui.predefine('sap/ui/vk/helpers/RotateOrbitHelperDvl',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateOrbitHelperDvl",{
metadata:{publicMethods:["rotate"]},
constructor:function(a,D){this._tool=a;this._dvl=D;this._dvlRendererId=this._tool._viewport._dvlRendererId;}
});
R.prototype.destroy=function(){this._rotateOrbitTool=null;};
R.prototype.activateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true);}return this;};
R.prototype.deactivateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false);}return this;};
R.prototype.rotate=function(d,a){if(this._dvlRendererId){this._dvl.Renderer.Rotate(d*window.devicePixelRatio,a*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:d,dy:a});}return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/RotateOrbitHelperThree',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateOrbitHelperThree",{
metadata:{publicMethods:["rotate"]},
constructor:function(r){this._tool=r;}
});
R.prototype.destroy=function(){this._tool=null;};
R.prototype.activateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this;};
R.prototype.deactivateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this;};
R.prototype.rotate=function(d,a){this._tool._viewport._viewportGestureHandler._cameraController.rotate(d,a,false);return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/RotateTurntableHelperDvl',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateTurntableHelperDvl",{
metadata:{publicMethods:["rotate"]},
constructor:function(a,D){this._tool=a;this._dvl=D;this._dvlRendererId=this._tool._viewport._dvlRendererId;}
});
R.prototype.destroy=function(){this._rotateOrbitTool=null;};
R.prototype.activateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false);}return this;};
R.prototype.deactivateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true);}return this;};
R.prototype.rotate=function(d,a){if(this._dvlRendererId){this._dvl.Renderer.Rotate(d*window.devicePixelRatio,a*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:d,dy:a});}return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/RotateTurntableHelperThree',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateTurntableHelperThree",{
metadata:{publicMethods:["rotate"]},
constructor:function(r){this._tool=r;}
});
R.prototype.destroy=function(){this._tool=null;};
R.prototype.activateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this;};
R.prototype.deactivateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this;};
R.prototype.rotate=function(d,a){this._tool._viewport._viewportGestureHandler._cameraController.rotate(d,a,true);this._tool.fireRotate({dx:d,dy:a});return this;};
return R;});
sap.ui.predefine('sap/ui/vk/helpers/WorkerScriptLoader',["sap/ui/thirdparty/URI"],function(U){"use strict";var W={};
W.absoluteUri=function(s){var u=new U(sap.ui.require.toUrl(s));if(u.is("relative")){u=u.absoluteTo(new U(document.baseURI));}return u;};
W.loadScript=function(w,a){var u=this.absoluteUri(w);var s=[];if(a&&a.length>0){a.forEach(function(b){s.push("'"+this.absoluteUri(b)+"'");},this);}if(sap.ui.Device.browser.internet_explorer){s.push("'"+this.absoluteUri("sap/ui/thirdparty/es6-promise.js")+"'");s.push("'"+this.absoluteUri("sap/ui/thirdparty/es6-string-methods.js")+"'");s.push("'"+this.absoluteUri("sap/ui/vk/thirdparty/ie-polyfills.js")+"'");}s.push("'"+u.toString()+"'");return new Worker((window.URL||window.webkitURL).createObjectURL(new Blob(["importScripts("+s.join()+");"],{"type":"application/javascript"})));};
return W;});
sap.ui.predefine('sap/ui/vk/threejs/AnimationHelper',["./thirdparty/three","../View","../AnimationPlayback","../AnimationTrackType","../AnimationTrackValueType","../AnimationTrackValueTypeSize","../AnimationRotateType","../AnimationMath"],function(t,V,A,a,b,c,d,e){"use strict";var f=function(){};
f.prototype._getChildNodesWithMaterial=function(p,g){for(var h=0;p.children&&h<p.children.length;h++){var i=p.children[h];if(i&&i.material&&i.material.color){g.push(i);}this._getChildNodesWithMaterial(i,g);}};
f.prototype._getVkTrackType=function(g){switch(g.type){case"TRANSLATE":return a.Translate;case"ROTATE":return a.Rotate;case"SCALE":return a.Scale;case"OPACITY":return a.Opacity;case"COLOR":return a.Color;default:}};
f.prototype._getVkTrackValueType=function(g,r){switch(g.type){case"TRANSLATE":return b.Vector3;case"ROTATE":if(r===d.Quaternion){return b.Quaternion;}else if(r===d.AngleAxis){return b.AngleAxis;}else{return b.Euler;}break;case"SCALE":return b.Vector3;case"OPACITY":return b.Scalar;case"COLOR":return b.Vector3;default:}};
f.prototype.insertEmptyTrack=function(g,s,n,h){var i=this._getVkTrackValueType(g);var v=h.createTrack(null,{trackValueType:i,isAbsoluteValue:g.isAbsoluteValue});if(s&&n){s.setNodeAnimation(n,this._getVkTrackType(g),v,true);}};
f.prototype.insertTracks=function(g,h,n,s){g.forEach(function(i){var k=h.get(i.id);var v=s.findTrack(i.id.toString());if(Array.isArray(k)&&k.length){if(!v){var l=this._getVkTrackValueType(k[0],i.rotateType);var m=c.get(l);v=s.createTrack(i.id.toString(),{trackValueType:l,cycleForward:i.cyclicInfo.cyclicEnd,cycleBackward:i.cyclicInfo.cyclicStart,infinite:i.infinite,isAbsoluteValue:k[0].isAbsoluteValue});if(i.times){i.times.forEach(function(o,p){var q;if(l===b.Scalar){q=i.values[p];}else{q=[];for(var j=0;j<m;j++){q.push(i.values[p*m+j]);}}v.insertKey(o,q,true);});}}k.forEach(function(j){var o=s.findSequence(j.sequenceId);var p=n.get(j.targetId);if(o&&p){o.setNodeAnimation(p,this._getVkTrackType(j),v,true);}},this);}},this);return this;};
f.prototype.setInitialNodePositionsFromSubsequentViews=function(v,s,o){if(!v||!v.length){return;}var g;var n;var h;var i=new Map();for(var j=v.length-1;j>0;j--){var k=v[j];var l;if(k){l=k.getPlaybacks();}if(l){for(var p=l.length-1;p>=0;p--){var m=l[p];if(m){g=s.findSequence(m.getSequence().getId());if(g){if(o&&!g.hasHighlight()){continue;}if(!m.getReversed()){n=g.getNodesBoundaryValues(true).entries();}else{n=g.getNodesBoundaryValues(false).entries();}h=n.next();while(!h.done){i.set(h.value[0],h.value[1]);h=n.next();}}}}}var q=v[j-1];if(q){if(!q.userData){q.userData={};}if(!q.userData.nodeStartDataByAnimation){q.userData.nodeStartDataByAnimation=new Map();}n=i.entries();h=n.next();while(!h.done){q.userData.nodeStartDataByAnimation.set(h.value[0],h.value[1]);h=n.next();}}}};
f.prototype.setInitialNodePositionsFromPreviousViews=function(v,s,o){if(!v||!v.length){return;}var g;var n;var h;var i=new Map();for(var j=0;j<v.length-1;j++){var p=v[j];var k;if(p){k=p.getPlaybacks();}if(k){for(var l=0;l<k.length;l++){var m=k[l];if(m){g=s.findSequence(m.getSequence().getId());if(g){if(o&&!g.hasHighlight()){continue;}if(!m.getReversed()){n=g.getNodesBoundaryValues(false).entries();}else{n=g.getNodesBoundaryValues(true).entries();}h=n.next();while(!h.done){i.set(h.value[0],h.value[1]);h=n.next();}}}}}var q=v[j+1];if(q){if(!q.userData){q.userData={};}if(!q.userData.nodeStartDataByAnimation){q.userData.nodeStartDataByAnimation=new Map();}n=i.entries();h=n.next();while(!h.done){q.userData.nodeStartDataByAnimation.set(h.value[0],h.value[1]);h=n.next();}}}};
f.prototype.setInitialNodePositionsOnView=function(v,s,o){if(!v){return;}var n;var g;var h=0;var i=null;i=v.getPlaybacks();if(!i||!i.length){return;}if(!v.userData){v.userData={};}if(!v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation=new Map();}for(var j=i.length-1;j>=h;j--){var p=i[j];var k=s.findSequence(p.getSequence().getId());if(k){if(o&&!k.hasHighlight()){continue;}if(p.getReversed()){n=k.getNodesBoundaryValues(false).entries();}else{n=k.getNodesBoundaryValues(true).entries();}g=n.next();while(!g.done){v.userData.nodeStartDataByAnimation.set(g.value[0],g.value[1]);g=n.next();}}}};
f.prototype.setInitialNodePositionsFromCurrenetViews=function(v,s,o){if(!v||!v.length){return;}for(var g=0;g<v.length;g++){var h=v[g];if(!h){continue;}this.setInitialNodePositionsOnView(h,s,o);}};
f.prototype.setPlaybackStartTimes=function(v,s){if(!v||!v.length){return;}for(var g=0;g<v.length;g++){var h=v[g];if(!h){continue;}var i=null;if(h){i=h.getPlaybacks();}if(!i||!i.length){continue;}var j=0;for(var k=0;k<i.length;k++){var p=i[k];var l=p.getSequence();if(l){l.resetDuration(true);}p.setStartTime(j);j+=p.getDuration();}}};
f.prototype.prepareViewForAnimation=function(v){var n=v.getNodeInfos();if(!n){return;}if(!v.userData){v.userData={};}if(!v.userData.nodesDataByView){v.userData.nodesDataByView=new Map();}else{return;}function g(l){return new THREE.Matrix4().set(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],0,0,0,1);}for(var h=0;h<n.length;h++){var i=n[h];if(!i||!i.target){continue;}var j={};if(i.transform){j.position=new THREE.Vector3();j.scale=new THREE.Vector3();j.quaternion=new THREE.Quaternion();var k=g(i.transform);k.decompose(j.position,j.quaternion,j.scale);v.userData.nodesDataByView.set(i.target,j);}}};
f.prototype.getNodePositionByView=function(v,n){var g;if(!v){return g;}if(!v.userData||!v.userData.nodesDataByView){this.prepareViewForAnimation(v);}if(v.userData&&v.userData.nodesDataByView){g=v.userData.nodesDataByView.get(n);}return g;};
f.prototype.getNodePositionFromNearestPlayback=function(s,v,g,n){var h;if(!v||!s){return h;}var p=v.getPlaybacks();if(!p){return h;}var i;var j;var k=0;for(i=0;i<p.length;i++){j=p[i];if(g==j.getSequenceId()){k=j.getStartTime();break;}}var m=0;for(i=0;i<p.length;i++){j=p[i];var l=j.getStartTime();if(k<=l){continue;}if(g==j.getSequenceId()){continue;}var o=s.findSequence(j.getSequenceId());if(o){var q;if(j.getReversed()){q=o.getNodesStartValues();}else{q=o.getNodesEndValues();}var r=q.get(n);if(r&&l>=m){h=r;m=l;}}}return h;};
f.prototype._buildViewInitialState=function(v,g,s){var h=g.indexOf(v);if(h<0){return undefined;}var i;var j;var p;var k=new Map();var l=function(n,o,q){var r=k.get(n);if(!r){r={target:n};k.set(n,r);}r[o]=q;};var m=function(n,u){if(!n){return;}var o=n.getNodeAnimation();if(o){o.forEach(function(q){var r=q.nodeRef;for(var w in a){var x=a[w];var y=q[x];if(y&&y.getKeysCount()){var z=u?0:y.getKeysCount()-1;var B=y.getKey(z);var C=y.getKeysType();var D=e.interpolate(C,B,B,0,y);l(r,x,D.value);}}});}};for(i=g.length-1;i>=h;i--){p=g[i].getPlaybacks();if(Array.isArray(p)){for(j=p.length-1;j>=0;j--){m(p[j].getSequence(),true);}}}for(i=0;i<h;i++){p=g[i].getPlaybacks();if(Array.isArray(p)){for(j=0;j<p.length;j++){m(p[j].getSequence(),false);}}}return k;};
f.prototype.buildViewsInitialState=function(v,s){if(!Array.isArray(v)){return;}var g=function(n){var r=[];n.forEach(function(h,i){r.push(h);});return r;};v.forEach(function(h){var n=this._buildViewInitialState(h,v,s);if(n){h.updateNodeInfos(g(n));}},this);};
return f;});
sap.ui.predefine('sap/ui/vk/threejs/BaseNodeProxy',["../BaseNodeProxy"],function(B){"use strict";
var a=B.extend("sap.ui.vk.threejs.BaseNodeProxy",{metadata:{}});
a.prototype.init=function(n,b){this._object3D=b;};
a.prototype.reset=function(){this._object3D=null;};
a.prototype.getNodeRef=function(){return this._object3D;};
a.prototype.getNodeId=function(){return this._object3D;};
a.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
a.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata;};
a.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
a.prototype.getSceneRef=function(){return this._object3D;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/Billboard',["./thirdparty/three","sap/ui/base/ManagedObject","../ve/thirdparty/html2canvas","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment"],function(t,B,h,b,c,d,e,f){"use strict";
var g=B.extend("sap.ui.vk.threejs.Billboard",{metadata:{properties:{node:{type:"any",defaultValue:new THREE.Group()},text:{type:"string",defaultValue:""},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:20},fontWeight:{type:"string",defaultValue:"normal"},fontItalic:{type:"boolean",defaultValue:false},textColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderOpacity:{type:"float",defaultValue:1},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},backgroundOpacity:{type:"float",defaultValue:0.5},encoding:{type:"sap.ui.vk.BillboardTextEncoding",defaultValue:c.PlainText},width:{type:"float",defaultValue:100},height:{type:"float",defaultValue:100},style:{type:"sap.ui.vk.BillboardStyle",defaultValue:d.None},borderLineStyle:{type:"sap.ui.vk.BillboardBorderLineStyle",defaultValue:e.Solid},borderWidth:{type:"float",defaultValue:2},horizontalAlignment:{type:"sap.ui.vk.BillboardHorizontalAlignment",defaultValue:f.Left},texture:{type:"any",defaultValue:null},material:{type:"any"},link:{type:"string",defaultValue:""},coordinateSpace:{type:"sap.ui.vk.BillboardCoordinateSpace",defaultValue:b.Viewport},position:{type:"any",defaultValue:new THREE.Vector3(0,0,0)},renderOrder:{type:"int",defaultValue:0}}}});
g.prototype.init=function(){if(B.prototype.init){B.prototype.init.call(this);}var a=new THREE.BufferGeometry();a.setIndex([0,1,2,2,1,3]);a.setAttribute("position",new THREE.Float32BufferAttribute([-0.5,-0.5,0,0.5,-0.5,0,-0.5,0.5,0,0.5,0.5,0],3));a.setAttribute("normal",new THREE.Float32BufferAttribute([0,0,1,0,0,1,0,0,1,0,0,1],3));a.setAttribute("uv",new THREE.Float32BufferAttribute([0,0,1,0,0,1,1,1],2));var i=new THREE.MeshBasicMaterial({depthTest:false,depthWrite:false,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide});this.setProperty("material",i,true);this._billboard=new THREE.Mesh(a,i);this._needUpdateTexture=true;};
g.prototype.setNode=function(n){if(n instanceof THREE.Object3D){this.setProperty("node",n,true);n.add(this._billboard);n.matrixAutoUpdate=false;n.isBillboard=true;n.userData.billboard=this;this._traverse(function(a){a.layers=n.layers;});}return this;};
g.prototype._traverse=function(a){a(this._billboard);};
g.prototype.setEncoding=function(v){this.setProperty("encoding",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setText=function(v){this.setProperty("text",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFont=function(v){this.setProperty("font",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFontSize=function(v){this.setProperty("fontSize",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFontWeight=function(v){this.setProperty("fontWeight",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setFontItalic=function(v){this.setProperty("fontItalic",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setStyle=function(v){this.setProperty("style",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setWidth=function(v){this.setProperty("width",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setHeight=function(v){this.setProperty("height",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setTextColor=function(v){this.setProperty("textColor",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBackgroundColor=function(v){this.setProperty("backgroundColor",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBackgroundOpacity=function(v){this.setProperty("backgroundOpacity",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderWidth=function(v){this.setProperty("borderWidth",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderLineStyle=function(v){this.setProperty("borderLineStyle",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderColor=function(v){this.setProperty("borderColor",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setBorderOpacity=function(v){this.setProperty("borderOpacity",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setHorizontalAlignment=function(v){this.setProperty("horizontalAlignment",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setLink=function(v){this.setProperty("link",v,true);this._needUpdateTexture=true;return this;};
g.prototype.setTexture=function(v){this.setProperty("texture",v,true);this._billboard.material.map=v;return this;};
g.prototype.setMaterial=function(v){this.setProperty("material",v,true);this._billboard.material=v;return this;};
g.prototype.setRenderOrder=function(v){this.setProperty("renderOrder",v,true);this._traverse(function(a){a.renderOrder=v;});return this;};
g.prototype._renderBackground=function(a,w,i,n){a.fillStyle=this.getBackgroundColor();a.strokeStyle=this.getBorderColor();a.lineWidth=n;switch(this.getBorderLineStyle()){default:a.setLineDash([]);break;case e.Dash:a.setLineDash([n*5,n]);break;case e.Dot:a.setLineDash([n*2,n]);break;case e.DashDot:a.setLineDash([n*5,n,n*2,n]);break;case e.DashDotDot:a.setLineDash([n*5,n,n*2,n,n*2,n]);break;}var o=n/2;if(this.getStyle()===d.RectangularShape){a.globalAlpha=this.getBackgroundOpacity();if(a.globalAlpha>0){a.fillRect(0,0,w,i);}a.globalAlpha=n>0?this.getBorderOpacity():0;if(a.globalAlpha>0){a.strokeRect(o,o,w-n,i-n);}}else if(this.getStyle()===d.CircularShape){var x=w/2;var y=i/2;var r=w/2;a.beginPath();a.arc(x,y,r-o,0,2*Math.PI);a.closePath();a.globalAlpha=this.getBackgroundOpacity();if(a.globalAlpha>0){a.fill();}a.globalAlpha=n>0?this.getBorderOpacity():0;if(a.globalAlpha>0){a.stroke();}}a.globalAlpha=1;a.setLineDash([]);};
g.prototype._getFont=function(a){return(this.getFontItalic()?"italic ":"")+this.getFontWeight()+" "+(this.getFontSize()*a)+"px "+(this.getFont()||"Arial");};
g.prototype._renderPlainText=function(n){var o=document.createElement("canvas");var r=o.getContext("2d");var s=this.getFontSize()*n;var u=this._getFont(n);r.font=u;var v=Math.ceil(s);var w=this.getBorderLineStyle()!==e.None?this.getBorderWidth()*n:0;var z=Math.ceil(s*0.2+w);var A=this.getText().split("\n");var C=0;A.forEach(function(I){C=Math.max(C,r.measureText(I).width);});var D=this.getLink();if(D.length>0){C=Math.max(C,r.measureText(D).width);}C=Math.ceil(C*0.5)*2;var E=A.length+(D.length>0?1:0);var F=Math.ceil(v*E*0.5)*2;var G=C+z*2;var H=F+z*2;if(this.getStyle()===d.CircularShape){G=H=Math.max(G,H);}this._width=G/n;this._height=H/n;o.width=THREE.Math.ceilPowerOfTwo(G);o.height=THREE.Math.ceilPowerOfTwo(H);this._renderBackground(r,G,H,w);r.font=u;r.textAlign=this.getHorizontalAlignment();r.textBaseline="middle";var a=["left","center","right"].indexOf(r.textAlign);var x=(G+C*(a-1))>>1;var y=(H-(E-1)*v)>>1;r.fillStyle=this.getTextColor();r.filter="blur(0px)";for(var i in A){r.fillText(A[i],x,y+v*i);}if(D.length>0){r.fillStyle="#00f";r.textAlign="right";r.textBaseline="bottom";r.fillText(D,G-z,H-z);}this._setBillboardTexture(o,G,H);};
g.prototype._renderHtmlText=function(a){var i=document.createElement("canvas");var n=i.getContext("2d");var o=this.getBorderLineStyle()!==e.None?this.getBorderWidth()*a:0;var r=Math.ceil(o);var w=Math.ceil(this.getWidth()*a)+r*2;var s=Math.ceil(this.getHeight()*a)+r*2;if(this.getStyle()===d.CircularShape){w=s=Math.max(w,s);}this._width=w/a;this._height=s/a;i.width=THREE.Math.ceilPowerOfTwo(w);i.height=THREE.Math.ceilPowerOfTwo(s);this._renderBackground(n,w,s,o);var u=this.getLink();if(u.length>0){n.font=this._getFont(a);n.fillStyle="#00f";n.textAlign="right";n.textBaseline="bottom";n.fillText(u,w-r,s-r);}var v=document.createElement("iframe");v.style.visibility="hidden";v.width=(w-r*2)/a;v.height=(s-r*2)/a;document.body.appendChild(v);var x=v.contentDocument||v.contentWindow.document;x.open();x.close();x.body.innerHTML=this.getText();var y=document.createElement("canvas");y.width=v.width*a;y.height=v.height*a;y.style.width=v.width+"px";y.style.height=v.height+"px";var z=y.getContext("2d");z.scale(a,a);this._billboard.material.visible=false;h(x.body,{canvas:y,backgroundColor:null}).then(function(y){if(y.width>0&&y.height>0){i.getContext("2d").drawImage(y,r,r);}setTimeout(this._setBillboardTexture.bind(this,i,w,s),0);document.body.removeChild(v);}.bind(this));};
g.prototype._setBillboardTexture=function(a,w,i){var u=w/a.width,v=i/a.height;this._billboard.geometry.setAttribute("uv",new THREE.Float32BufferAttribute([0,1-v,u,1-v,0,1,u,1],2));var n=new THREE.CanvasTexture(a);n.magFilter=THREE.NearestFilter;this._billboard.material.map=n;this._billboard.material.needsUpdate=true;this._billboard.material.visible=true;};
var p=new THREE.Vector4(),j=new THREE.Vector3(),k=new THREE.Vector3(),l=new THREE.Vector3(),q=new THREE.Quaternion(),m=new THREE.Vector3();
g.prototype._updateTexture=function(){this._width=this.getWidth();this._height=this.getHeight();if(this.getText()&&!this.getTexture()){switch(this.getEncoding()){default:case c.PlainText:this._renderPlainText(window.devicePixelRatio);break;case c.HtmlText:this._renderHtmlText(window.devicePixelRatio);break;}}};
g.prototype._update=function(r,a,v){if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture();}var n=this.getNode();n.matrix.getInverse(n.parent.matrixWorld);n.matrix.decompose(n.position,n.quaternion,n.scale);n.matrixWorld.identity();this._billboard.quaternion.copy(a.quaternion);var s=this.getPosition(),i=this._billboard.position,o=1;if(s){i.copy(s);}else{i.setScalar(0);}var u=this.getCoordinateSpace();if(u===b.Screen){o=THREE.Math.lerp(a.near,a.far,1e-4);i.multiplyScalar(2/a.projectionMatrix.elements[5]);i.z=-1;i.multiplyScalar(o).applyMatrix4(a.matrixWorld);}else if(u===b.Viewport){if(v.x>v.y){i.x*=v.y/v.x;}else{i.y*=v.x/v.y;}i.z=-0.9999;i.unproject(a);p.copy(i).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);var w=(p.x/p.w)*0.5*v.x,x=(p.y/p.w)*0.5*v.y;o=p.w*2/(v.x*a.projectionMatrix.elements[0]);j.setFromMatrixColumn(a.matrixWorld,0).multiplyScalar(o*(Math.round(w)-w));k.setFromMatrixColumn(a.matrixWorld,1).multiplyScalar(o*(Math.round(x)-x));i.add(j).add(k);}this._billboard.scale.set(this._width*o,this._height*o,1);this._billboard.updateMatrix();this._billboard.updateMatrixWorld();};
g.prototype._ortho2DUpdate=function(r,a){var o=this.userData.originalTransform;var z=Math.min(a.near*(1+o.s.length()),(a.near+a.far)*0.5);this.position.copy(o.p).multiplyScalar(2/a.projectionMatrix.elements[5]);this.position.z=-1;this.position.multiplyScalar(z).applyMatrix4(a.matrixWorld);this.quaternion.copy(a.quaternion).multiply(o.q);this.scale.copy(o.s).multiplyScalar(z*0.5);this.scale.z=Math.min(z-a.near,this.scale.z*0.001);this.matrixWorld.compose(this.position,this.quaternion,this.scale);this.matrix.getInverse(this.parent.matrixWorld).multiply(this.matrixWorld);this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true);};
g.prototype._billboardViewUpdate=function(r,a){this.parent.matrixWorld.decompose(l,q,m);q.inverse().multiply(a.quaternion);this.quaternion.copy(q);this.updateMatrix();this.updateMatrixWorld();};
g.prototype._lockToViewportUpdate=function(r,a){var s=THREE.Math.lerp(a.near,a.far,1e-4);this.position.setFromMatrixColumn(a.matrixWorld,2).multiplyScalar(-s);this.position.add(a.position);this.scale.setScalar(s*2/a.projectionMatrix.elements[5]);this.matrixWorld.compose(this.position,a.quaternion,this.scale);if(this.parent){this.matrix.getInverse(this.parent.matrixWorld).multiply(this.matrixWorld);}else{this.matrix.copy(this.matrixWorld);}this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true);};
return g;});
sap.ui.predefine('sap/ui/vk/threejs/Callout',["./thirdparty/three","sap/ui/base/ManagedObject","./Billboard","../ve/thirdparty/html2canvas","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../BillboardStyle","../LeaderLineMarkStyle"],function(a,B,b,c,P,d,e,f,L){"use strict";
var C=b.extend("sap.ui.vk.threejs.Callout",{metadata:{properties:{anchorNode:{type:"any",defaultValue:null},depthTest:{type:"boolean",defaultValue:true}}}});
C.prototype.init=function(){if(b.prototype.init){b.prototype.init.call(this);}this._lines=[];this._heads=[];};
C.prototype._traverse=function(h){b.prototype._traverse.call(this,h);this._lines.forEach(h);this._heads.forEach(h);};
C.prototype.setDepthTest=function(h){this.setProperty("depthTest",h,true);this._traverse(function(i){i.material.depthTest=h;});return this;};
var g=new THREE.Vector4(),j=new THREE.Vector4(),k=new THREE.Vector4(),m=new THREE.Vector2(),n=new THREE.Vector2(),o=new THREE.Vector2(),q=new THREE.Quaternion(),r=new THREE.Matrix4(),u=new THREE.Vector2(),v=new THREE.Vector3(),w=new THREE.Vector3(),z=new THREE.Vector3(0,0,1),A=new THREE.Matrix4(),D=new THREE.Matrix4();
C.prototype._update=function(h,i,l){if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture();}var s=this.getNode();s.matrix.getInverse(s.parent.matrixWorld);s.matrix.decompose(s.position,s.quaternion,s.scale);s.matrixWorld.identity();var x=this.getPosition(),y=this._billboard.position;if(x){y.copy(x);}else{y.setScalar(0);}var E=this.getAnchorNode();if(E){y.applyMatrix4(E.matrixWorld);}this._billboard.quaternion.copy(i.quaternion);A.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse);g.copy(y).applyMatrix4(A);m.copy(g).multiplyScalar(1/g.w).multiply(l);var F=g.w*2/(l.x*i.projectionMatrix.elements[0]);this._billboard.scale.set(F*this._width,F*this._height,1);v.setFromMatrixColumn(i.matrixWorld,0).multiplyScalar(F*(Math.round(m.x*0.5)-m.x*0.5));w.setFromMatrixColumn(i.matrixWorld,1).multiplyScalar(F*(Math.round(m.y*0.5)-m.y*0.5));y.add(v).add(w);this._billboard.updateMatrix();this._billboard.updateMatrixWorld();var G=this.getStyle()===f.CircularShape;var H=i.near;function I(p,t,J){if(p<t){return p-t;}else if(p>J){return p-J;}return 0;}this._lines.forEach(function(p){if(p.userData.targetNode){p.matrix.copy(p.userData.targetNode.matrixWorld);}else{p.matrix.identity();}p.matrixWorld.copy(p.matrix);if(p.isPolylineMesh){p.material.resolution.copy(l);}if(p.isHaloMesh){return;}var J=p.geometry.vertices;var K=J[0];var M=J[J.length-2];var N=J[J.length-1];var O=p.userData.startPointMesh;var Q=false;var R=[0,J.length-1];if(O!==undefined){K.copy(O.userData.targetVertex);}D.multiplyMatrices(A,p.matrixWorld);if(p.userData.extensionLength>0&&J.length>2){R.push(J.length-2);g.copy(J[J.length-3]).applyMatrix4(D);n.copy(g).multiplyScalar(1/g.w).multiply(l);M.set(Math.sign(n.x-m.x)*0.5*(1+p.userData.extensionLength/this._width),0,0);M.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(r.getInverse(p.matrixWorld));}g.copy(M).applyMatrix4(D);n.copy(g).multiplyScalar(1/g.w).multiply(l);if(G){var S=u.copy(n).sub(m).length();Q=S<this._width;u.multiplyScalar(0.5/S);N.set(u.x,u.y,0);}else{var T=I(n.x,m.x-this._width,m.x+this._width),U=I(n.y,m.y-this._height,m.y+this._height);Q=(T===0&&U===0);if(Math.abs(T)>Math.abs(U)){N.set(Math.sign(T)*0.5,0,0);}else{N.set(0,Math.sign(U)*0.5,0);}}if(Q){N.copy(M);}else{N.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(r.getInverse(p.matrixWorld));}p.geometry.verticesNeedUpdate=true;if(O!==undefined){O.position.copy(O.userData.targetVertex).applyMatrix4(p.matrixWorld);g.copy(O.position).applyMatrix4(A);var V=g.w/(l.x*i.projectionMatrix.elements[0]);O.scale.setScalar(V);O.visible=false;var W=false;if(g.w>=H){j.copy(g);k.copy(J[1]).applyMatrix4(D);if(k.w<H){var t=(j.w-H)/(j.w-k.w);k.sub(j).multiplyScalar(t).add(j);}o.copy(j).multiplyScalar(1/j.w);n.copy(k).multiplyScalar(1/k.w);u.copy(n).sub(o).multiply(l);W=u.length()<O.userData.lineOffset;q.setFromAxisAngle(z,Math.atan2(u.y,u.x));O.quaternion.copy(i.quaternion).multiply(q);O.updateMatrix();O.matrixWorld.copy(O.matrix);O.matrixWorldNeedsUpdate=false;o.multiply(l).sub(m);O.visible=G?o.length()>this._width:Math.abs(o.x)>this._width||Math.abs(o.y)>this._height;if(W||!O.visible){K.copy(J[1]);}else{K.set(O.userData.lineOffset,0,0).applyMatrix4(O.matrixWorld).applyMatrix4(r.getInverse(p.matrixWorld));}}}p.geometry._updateVertices(R);p.computeLineDistances(D,l,i instanceof THREE.PerspectiveCamera?H:undefined);if(p.userData.haloMesh){p.userData.haloMesh.material.lineLength=p.material.lineLength;}}.bind(this));};
C.prototype._createMarkMesh=function(p,t,E,F){var G=E===L.Arrow;var H=window.devicePixelRatio;var I=t.width;var J=I*t.haloWidth;F=(Array.isArray(F)||F instanceof Float32Array)&&F.length===2?F:[1,1];var K,M;if(G){K=Math.max(35*F[0],I*5);M=Math.max(15*F[1],I*2);}else{K=M=Math.max(2*F[0],I*2);}K=Math.ceil(K+J*2);M=Math.ceil(M+J*2);var N=document.createElement("canvas");N.width=THREE.Math.ceilPowerOfTwo(K*H);N.height=THREE.Math.ceilPowerOfTwo(M*H);var O=N.getContext("2d");var x=K/2,y=M/2;O.fillStyle="#FFF";O.scale(H,H);if(G){O.beginPath();O.moveTo(0,y);O.lineTo(K,0);O.lineTo(K,M);O.closePath();O.fill();var h=K*y/Math.sqrt(K*K+y*y),s=(h-J)/h;var Q=K-K*s,R=y*(K*s-J)/K;O.fillStyle=p.getStyle();O.beginPath();O.moveTo(Q,y);O.lineTo(K-J,y-R);O.lineTo(K-J,y+R);O.closePath();O.fill();}else{var S=K*0.5,T=S-J;O.beginPath();O.ellipse(x,y,S,S,0,0,Math.PI*2);O.fill();O.fillStyle=p.getStyle();O.beginPath();O.ellipse(x,y,T,T,0,0,Math.PI*2);O.fill();}O.fillRect(K-J,y-I*0.5,J,I);var U=new THREE.MeshBasicMaterial({map:new THREE.CanvasTexture(N),flatShading:true,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide,depthTest:this.getDepthTest()});var V=new THREE.PlaneBufferGeometry(K*2,M*2);if(G){V.translate(K,0,0);}var W=new THREE.Mesh(V,U);W.userData.lineOffset=(G?K*2-1:K-J*2);var X=new THREE.Vector2(K*H/N.width,M*H/N.height);var Y=W.geometry.attributes.uv.array;for(var i=0,l=Y.length;i<l;i+=2){Y[i]*=X.x;Y[i+1]=1-(1-Y[i+1])*X.y;}return W;};
C.prototype.addLeaderLine=function(h,t,i,s,l,p,x){var y=this.getNode();if(x>0&&h.length<3){h.push(h[h.length-1].clone());}var E=i.userData.lineStyle||{};E.width=E.width||1;E.haloWidth=E.haloWidth||0;E.endCapStyle=E.endCapStyle||0;var F=E.endCapStyle||h.length>2?1:0;var G=(F&&(s!==L.None||E.endCapStyle===0)?1:0)|(F&&(l!==L.None||E.endCapStyle===0)?2:0);var H=new P();H.setVertices(h);var I;if(E.haloWidth>0){var J=new d({color:0xFFFFFF,lineColor:0xFFFFFF,linewidth:E.width*(E.haloWidth*2+1),dashCapStyle:E.endCapStyle,segmentCapStyle:F,trimStyle:G,transparent:true,depthTest:this.getDepthTest()});I=new e(H,J);I.userData.targetNode=t;I.matrixAutoUpdate=false;I.renderOrder=this.getRenderOrder();I.layers=y.layers;I.isHaloMesh=true;y.add(I);this._lines.push(I);}var K=new d({color:0xFFFFFF,lineColor:i.color,linewidth:E.width,dashCapStyle:E.endCapStyle,segmentCapStyle:F,trimStyle:G,dashPattern:E.dashPattern||[],dashScale:E.dashPatternScale||1,transparent:true,depthTest:this.getDepthTest()});var M=new e(H,K);M.userData.targetNode=t;M.userData.extensionLength=x;M.userData.haloMesh=I;M.matrixAutoUpdate=false;M.renderOrder=this.getRenderOrder();M.layers=y.layers;y.add(M);this._lines.push(M);if(s!==L.None){var N=this._createMarkMesh(i.color,E,s,p);N.userData.targetVertex=H.vertices[0].clone();N.matrixAutoUpdate=false;N.renderOrder=this.getRenderOrder();N.layers=y.layers;M.userData.startPointMesh=N;y.add(N);this._heads.push(N);}return M;};
return C;});
sap.ui.predefine('sap/ui/vk/threejs/ContentDeliveryService',["jquery.sap.global","sap/base/Log","sap/ui/base/ManagedObject","../totara/TotaraLoader","./Material","./thirdparty/three","../getResourceBundle","../ObjectType"],function(q,L,M,T,a,t,g,O){"use strict";
var C=M.extend("sap.ui.vk.threejs.ContentDeliveryService",{metadata:{properties:{authorizationHandler:"any"},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},viewGroupUpdated:{parameters:{currentViewGroupId:"string"},enableEventBubbling:true},sceneCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true},loadingFinished:{parameters:{currentViewId:"string",currentViewGroupId:"string"},enableEventBubbling:true},contentChangesProgress:{parameters:{percent:"float"}},errorReported:{parameters:{error:{type:"any"}}}}}});
var b=C.getMetadata().getParent().getClass().prototype;
C.prototype.init=function(){if(b.init){b.init.call(this);}this._loader=null;this._transientSceneMap=new Map();this._currentNodeHierarchy=null;};
C.prototype.initUrl=function(u,k,c){var d=this;function n(){d.fireSceneUpdated({});}function e(){var h;if(d._loader&&d._loader.currentSceneInfo){var i=d._loader.getContext(d._loader.currentSceneInfo.id);if(i){h=i.currentViewGroupId;}}d.fireViewGroupUpdated({currentViewGroupId:h});}if(!this._loader||this._loader.getUrl()!==u){if(this._loader){this._loader.dispose();}this._loader=new T();this._loader.onErrorCallbacks.attach(this._reportError.bind(d));this._loader.onMaterialFinishedCallbacks.attach(n);this._loader.onImageFinishedCallbacks.attach(n);this._loader.onSetGeometryCallbacks.attach(n);this._loader.onViewGroupUpdatedCallbacks.attach(e);var f=c?c:THREE.Math.generateUUID().toLowerCase();return this._loader.init(u,f);}else if(!k){this._loader.cleanup();}return Promise.resolve("Loader is ready");};
C.prototype._reportError=function(e){this.fireErrorReported(e);};
C.prototype._createLoadParam=function(r,c,p,d){var e=this;var i;var s=false;var f;if(this._currentNodeHierarchy){f=this._currentNodeHierarchy.getScene();}var h={root:p,includeHidden:d.getIncludeHidden(),includeAnimation:d.getIncludeAnimation(),pushPMI:d.getPushPMI(),metadataFilter:d.getMetadataFilter(),useSecureConnection:d.getUseSecureConnection(),activateView:d.getActivateView(),enableLogger:d.getEnableLogger()===true,pushViewGroups:d.getPushViewGroups(),vkScene:f,onActiveCamera:function(n){var k=false;var l=e._loader.getContext(d.getVeid());if(l&&l.phase<2){i=n;k=true;}if(!k){e.fireCameraChanged({sceneId:d.getVeid(),camera:n});}},onInitialSceneFinished:function(k){s=true;r({node:p,camera:i,contentResource:d,initialView:k,annotations:e.getSceneBuilder()._annotations,loader:e});},onSceneCompleted:function(){e.fireSceneCompleted({sceneId:d.getVeid()});},onLoadingFinished:function(){var k,l;if(e._loader&&e._loader.currentSceneInfo){var m=e._loader.getContext(e._loader.currentSceneInfo.id);if(m){k=m.currentViewId;l=m.currentViewGroupId;}}e.fireLoadingFinished({currentViewId:k,currentViewGroupId:l});},onContentChangesProgress:function(k){e.fireContentChangesProgress({source:k.source,phase:k.phase,percentage:k.percentage});}};var j=function(k){L.warning("Content loading error reported:",JSON.stringify(k.getParameters()));var l;if(k.getParameter("errorText")){l=k.getParameter("errorText");}else if(k.getParameter("error")){l=k.getParameter("error");}else if(k.getParameter("reason")){l=k.getParameter("reason");}else{l="failed to load: unknown reason";}if(s){var m=k.getParameter("error");if(m&&m===4){e.initUrl(this._loader.getUrl(),true);}}else{e.detachErrorReported(j);if(k.getParameter("events")){l=l+"\n"+JSON.stringify(k.getParameter("events"));}c(l);}};e.attachErrorReported(j);return h;};
C.prototype.load=function(p,c,d){var e=this;var n=c.getNodeProxy();if(n){this._currentNodeHierarchy=n.getNodeHierarchy();}return new Promise(function(r,f){if(!c.getSource()||!c.getVeid()){f(g().getText("CONTENTDELIVERYSERVICE_MSG_NOURLORVEID"));return;}e.initUrl(c.getSource(),true);var h=e._createLoadParam(r,f,p,c);if(e._loader){e._loader.request(c.getVeid(),h,d);}});};
C.prototype.getSceneBuilder=function(){if(this._loader){return this._loader.getSceneBuilder();}return null;};
C.prototype.decrementResourceCountersForDeletedTreeNode=function(s){var c=this._loader.getContext(this._loader.currentSceneInfo.id);this._loader.decrementResourceCountersForDeletedTreeNode(c,s);};
C.prototype.loadTransientScene=function(s,p,u){var c=this;return new Promise(function(r,d){if(!s||!p){d(g().getText("CONTENTDELIVERYSERVICE_MSG_INVALIDARGUMENTS"));return;}if(c._transientSceneMap.has(s)){var e=c._transientSceneMap.get(s).clone();p.add(e);r({nodeRef:e});return;}if(!c._loader){d(g().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return;}var f=new THREE.Object3D();f.name="transient";var o=function(){var i=c._loader.getContext(s);i.onSceneCompletedCallbacks.detach(o);c._transientSceneMap.set(s,f);var e=f.clone();p.add(e);r({nodeRef:e});};var h={root:f,onSceneCompleted:o,useSecureConnection:u};c._loader.request(s,h);});};
C.prototype.update=function(s,c,v){var d=this;return new Promise(function(r,e){if(!d._loader){e(g().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return;}d._loader.update(s,c,v).then(function(f){if(d._currentNodeHierarchy){for(var i=0;i<f.replacedNodeRefs.length;i++){d._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:f.replacedNodeRefs[i],ReplacementNodeRef:f.replacementNodeRefs[i],ReplacedNodeId:f.replacedNodeRefs[i],ReplacementNodeId:f.replacementNodeRefs[i]});}}r({sceneVeId:f.sceneVeId,sids:f.sidArray});}).catch(function(f){return e(f);});});};
C.prototype.exit=function(){if(b.exit){b.exit.call(this);}if(this._loader){this._loader.dispose();this._loader=null;}this._transientSceneMap=null;};
C.prototype.loadView=function(s,v,c,d){if(typeof c==="undefined"){c="static";}var e=this;return this._loader.requestView(s,c,v,null,d).then(function(f){if(e._currentNodeHierarchy&&f.updatedNodes){for(var i=0;i<f.updatedNodes.length;i++){e._currentNodeHierarchy.fireNodeUpdated({nodeRef:f.updatedNodes[i]});}}e.fireSceneUpdated({});return f;}).catch(function(f){q.sap.log.error(f);return null;});};
C.prototype.updatePlaybacks=function(s,v,p){var c=this;return this._loader.requestView(s,"static",v,p,true).then(function(d){if(c._currentNodeHierarchy&&d.updatedNodes){for(var i=0;i<d.updatedNodes.length;i++){c._currentNodeHierarchy.fireNodeUpdated({nodeRef:d.updatedNodes[i]});}}c.fireSceneUpdated({});return d;}).catch(function(e){q.sap.log.error(e);return null;});};
C.prototype.loadViewGroup=function(s,v,i){var c=this;return this._loader.requestViewGroup(s,v,i).then(function(d){c.fireSceneUpdated({});return d;}).catch(function(e){q.sap.log.error(e);return null;});};
C.prototype.assignMaterialToNodes=function(s,m,n,c){var d=this;return this._loader.requestMaterial(s,m).then(function(e){function f(e,l,r){if(!l){return;}if(l.userData.markedForNotAssigningMaterial){delete l.userData.markedForNotAssigningMaterial;return;}if(d._currentNodeHierarchy){var o=d._currentNodeHierarchy.createNodeProxy(l);var p=new a();p.setMaterialRef(e);o.assignMaterial(p);d._currentNodeHierarchy.destroyNodeProxy(o);}if(r){l.children.forEach(function(u){if(!u||u.userData.objectType===O.PMI||u.userData.objectType===O.Hotspot){return;}f(e,u,r);});}}if(!c){for(var i=0;i<n.length;i++){f(e,n[i],true);}}else{for(var j=0;j<n.length;j++){n[j].userData.markedForNotAssigningMaterial=true;}var h=d._loader.getContext(s);var k=h.root;f(e,k,true);}d.fireSceneUpdated({});return true;}).catch(function(e){q.sap.log.error(e);return false;});};
C.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true;}else{return false;}};
return C;});
sap.ui.predefine('sap/ui/vk/threejs/ContentManager',["sap/base/Log","./thirdparty/three","../ContentManager","./Scene","../TransformationMatrix","./PerspectiveCamera","./OrthographicCamera","../Messages","../getResourceBundle","./ContentDeliveryService","./Viewport","./ViewStateManager"],function(L,t,C,S,T,P,O,M,g,a){"use strict";
var b=C.extend("sap.ui.vk.threejs.ContentManager",{metadata:{library:"sap.ui.vk"}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}};
b.prototype.exit=function(){if(this.defaultCdsLoader){this.defaultCdsLoader.destroy();this.defaultCdsLoader=null;}if(this.defaultMataiLoader){this.defaultMataiLoader.destroy();this.defaultMataiLoader=null;}if(c.exit){c.exit.call(this);}};
b.prototype._handleContentChangesProgress=function(d){this.fireContentChangesProgress({phase:d.getParameter("phase"),source:d.getParameter("source"),percentage:d.getParameter("percentage")});};
function s(o){if(o&&o.isMesh){o.castShadow=true;o.receiveShadow=false;}if(o&&o.children){for(var n=0;n<o.children.length;n++){s(o.children[n]);}}}
function e(n,f){if(n){var h=new THREE.Group();n.add(h);h.name="DefaultLights";h.private=true;var i=new THREE.Box3().setFromObject(n);var j=new THREE.Vector3();i.getSize(j);var m=j.length();var p=new THREE.PointLight();p.color.setRGB(0.72,0.72,0.81);i.getCenter(p.position);p.visible=true;p.private=true;h.add(p);var k=[new THREE.Color(0.2,0.2,0.2),new THREE.Color(0.32,0.32,0.36),new THREE.Color(0.36,0.36,0.36)];var o=[new THREE.Vector3(2.0,1.5,0.5),new THREE.Vector3(-2.0,-1.1,2.5),new THREE.Vector3(-0.04,-0.01,-2.0)];for(var l=0,q=k.length;l<q;l++){var r=new THREE.DirectionalLight();r.color.copy(k[l]);r.position.copy(o[l]);r.private=true;h.add(r);}if(f){s(n);var u=new THREE.DirectionalLight();u.color.setRGB(0.5,0.5,0.5);u.position.set(0,1,0);u.castShadow=true;u.shadow.mapSize.width=512;u.shadow.mapSize.height=512;var d=2000;u.shadow.camera.left=-d;u.shadow.camera.right=d;u.shadow.camera.top=d;u.shadow.camera.bottom=-d;u.shadow.camera.far=3500;u.shadow.bias=-0.0001;u.private=true;h.add(u);var v=new THREE.PlaneBufferGeometry(i.getSize().x,i.getSize().z);var w=new THREE.ShadowMaterial();w.opacity=0.2;var x=new THREE.Mesh(v,w);x.rotation.x=-Math.PI/2;x.position.x=i.getCenter().x;x.position.y=i.min.y-m*0.1;x.position.z=i.getCenter().z;n.add(x);x.receiveShadow=true;}}}
b.prototype.loadContent=function(d,f){var h=this;var l=function(){h.fireContentChangesStarted();var j=new THREE.Scene(),k=new S(j);h._loadContentResources(k,f).then(function(v){L.info("Content loading resolved");if(v&&v.length>0&&v[0].initialView){k.setInitialView(v[0].initialView);}for(var n=0;n<v.length;n++){if(v[n].camera){k.camera=v[n].camera;break;}}if(v.length>0){var m=v[0];k.backgroundTopColor=m.backgroundTopColor;k.backgroundBottomColor=m.backgroundBottomColor;k.renderMode=m.renderMode;k.upAxis=m.upAxis;k.annotations=m.annotations;}for(var i=0;i<v.length;i++){if(v[i].loader){k.loaders=k.loaders||[];k.loaders.push(v[i].loader);}if(v[i].builder){k.builders=k.builders||[];k.builders.push(v[i].builder);}}if(k.loaders){h._initSceneWithCDSLoaderIfExists(k,k.loaders);}e(k.getSceneRef(),false);h.fireContentChangesFinished({content:k});},function(r){L.info("Content loading rejected:",r);var i;if(typeof r==="string"){i=r;}else if(r.errorText){i=r.errorText;}else if(r.message){i=r.message;}i=i||g().getText(M.VIT37.summary);L.error(g().getText("CONTENTMANAGER_MSG_CONTENTRESOURCESFAILEDTOLOAD"),i);h.fireContentChangesFinished({content:null,failureReason:[{error:r,errorMessage:i}]});});};l();return this;};
b.prototype._findLoader=function(d){if(d._contentManagerResolver&&d._contentManagerResolver.settings&&d._contentManagerResolver.settings.loader){return Promise.resolve(d._contentManagerResolver.settings.loader);}if(d.getSource()){var f=d.getSourceType().toLowerCase();var h=this;switch(f){case"stream":{if(this.defaultCdsLoader==null){return new Promise(function(r){var i="sap/ui/vk/threejs/ContentDeliveryService";sap.ui.require([i],function(j){r(h.defaultCdsLoader=new j({authorizationHandler:h._authorizationHandler}));});});}return Promise.resolve(this.defaultCdsLoader);}case"vds4":{if(this.defaultMataiLoader==null){return new Promise(function(r){var m="sap/ui/vk/threejs/MataiLoader";sap.ui.require([m],function(i){r(h.defaultMataiLoader=new i());});});}return Promise.resolve(this.defaultMataiLoader);}default:break;}}return Promise.resolve(null);};
b.prototype._loadContentResources=function(d,f){var p=[];f.forEach(function loadContentResource(h,i){var n=new THREE.Group();n.name=i.getName();n.sourceId=i.getSourceId();i._shadowContentResource={nodeProxy:d.getDefaultNodeHierarchy().createNodeProxy(n)};var l=i.getLocalMatrix();if(l){n.applyMatrix(new THREE.Matrix4().fromArray(T.convertTo4x4(l)));}h.add(n);var j=this;p.push(this._findLoader(i).then(function(k){if(k&&k.attachContentChangesProgress){k.attachContentChangesProgress(j._handleContentChangesProgress,j);}if(typeof k==="function"){return k(n,i,j._authorizationHandler);}else if(k&&k.load){return k.load(n,i,j._authorizationHandler);}else{return Promise.resolve({node:n,contentResource:i});}}));i.getContentResources().forEach(loadContentResource.bind(this,n));}.bind(this,d.getSceneRef()));return Promise.all(p);};
b.prototype._initSceneWithCDSLoaderIfExists=function(d,l){if(l){var f;for(var i=0;i<l.length;i++){if(l[i]instanceof a){f=l[i].getSceneBuilder();break;}}if(f){d.setSceneBuilder(f);d.getDefaultNodeHierarchy().attachNodeRemoving(function(h){var r=h.getParameter("nodeRef");if(r.userData.treeNode&&r.userData.treeNode.sid){f.decrementResourceCountersForDeletedTreeNode(r.userData.treeNode.sid);}});return true;}}return false;};
b.prototype.createOrthographicCamera=function(){return new O();};
b.prototype.createPerspectiveCamera=function(){return new P();};
return b;});
sap.ui.predefine('sap/ui/vk/threejs/DetailView',["./thirdparty/three","sap/ui/base/ManagedObject","../ve/thirdparty/html2canvas","../DetailViewType","../DetailViewShape","./OrthographicCamera","./PerspectiveCamera"],function(t,B,c,D,d,O,P){"use strict";
var e=B.extend("sap.ui.vk.threejs.DetailView",{metadata:{properties:{name:{type:"string",defaultValue:""},camera:{type:"any",defaultValue:null},type:{type:"sap.ui.vk.DetailViewType",defaultValue:D.DetailView},shape:{type:"sap.ui.vk.DetailViewShape",defaultValue:d.Box},borderWidth:{type:"float",defaultValue:2},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#000"},origin:{type:"any",defaultValue:new THREE.Vector2(0,0)},size:{type:"any",defaultValue:new THREE.Vector2(0.5,0.5)},attachmentPoint:{type:"any",defaultValue:null},metadata:{type:"any",defaultValue:{}},veId:{type:"any",defaultValue:{}},visibleNodes:{type:"any",defaultValue:null},targetNodes:{type:"any",defaultValue:null}}}});
e.prototype.init=function(){if(B.prototype.init){B.prototype.init.call(this);}this._backgroundColor=new THREE.Color();this._node=new THREE.Group();var b=new THREE.MeshBasicMaterial({depthTest:false});this._line=new THREE.Mesh(new THREE.BufferGeometry(),b);this._line.renderOrder=0;this._node.add(this._line);var a=new THREE.BufferGeometry();a.setIndex([0,1,2]);var f=new THREE.MeshBasicMaterial({color:this._backgroundColor,depthTest:false});this._triangle=new THREE.Mesh(a,f);this._triangle.renderOrder=1;this._node.add(this._triangle);this._billboard=new THREE.Mesh(new THREE.BufferGeometry(),new THREE.MeshBasicMaterial({depthTest:false}));this._billboard.renderOrder=2;this._node.add(this._billboard);this._border=new THREE.Mesh(new THREE.BufferGeometry(),b);this._border.renderOrder=3;this._node.add(this._border);};
e.prototype.setCamera=function(a){if(a instanceof P||a instanceof O){this.setProperty("camera",a,true);}return this;};
e.prototype.setShape=function(a){this.setProperty("shape",a,true);return this;};
e.prototype.setBackgroundColor=function(a){this.setProperty("backgroundColor",a,true);this._backgroundColor.setStyle(a);this._triangle.material.color.copy(this._backgroundColor);return this;};
e.prototype.setBorderColor=function(a){this.setProperty("borderColor",a,true);this._border.material.map=null;return this;};
e.prototype.setBorderWidth=function(a){this.setProperty("borderWidth",a,true);this._border.material.map=null;return this;};
e.prototype.setOrigin=function(a){if(a instanceof THREE.Vector2){this.setProperty("origin",a,true);}return this;};
e.prototype.setSize=function(a){if(a instanceof THREE.Vector2){this.setProperty("size",a,true);}return this;};
var g=-0.5,j=1.5,p=new THREE.Vector4(),k=new THREE.Vector3(),n=new THREE.Vector3(),o=new THREE.Vector3(),q=new THREE.Vector2(),s=new THREE.Vector2(),r=new THREE.Vector2(),v=new THREE.Matrix4();
function z(a,b){return Math.PI*(3*(a+b)-Math.sqrt((3*a+b)*(a+3*b)));}
function A(a,b,h,i,l,m){var u=a[b],w=a[b+1],x=a[l],y=a[l+1],J=a[m],K=a[m+1],L=i-w,M=u-h;var f=((x-u)*L+(y-w)*M)/((x-J)*L+(y-K)*M);a[l]=x+(J-x)*f;a[l+1]=y+(K-y)*f;}
function C(f,a,b,h){q.set(f[b+1]-f[a+1],f[a]-f[b]).normalize().multiplyScalar(h);f[a]+=q.x;f[a+1]+=q.y;f[b]+=q.x;f[b+1]+=q.y;}
function E(a,b){var f=a.length;for(var h=0;h<6;h+=3){var l=h===0?b*g:b*j;var m=a[h],u=a[h+1];for(var i=h;i<f-6;i+=6){var w=a[i],x=a[i+1];a[i]=m;a[i+1]=u;m=a[i+6];u=a[i+7];C(a,i,i+6,l);if(i>h){A(a,i-6,w,x,i,i+6);}}}}
e.prototype._createBoxViewport=function(a,b,f,h){var l=[-a,-b,0,a,-b,0,a,b,0,-a,b,0];var m=this._billboard.geometry;m.setIndex([0,1,2,0,2,3]);m.setAttribute("position",new THREE.Float32BufferAttribute(l,3));m.setAttribute("uv",new THREE.Float32BufferAttribute([0,0,1,0,1,1,0,1],2));if(this._border.visible){var u=[],i;for(i=0;i<l.length;i+=3){var x=l[i],y=l[i+1];u.push(x,y,0,x,y,0);}u.push(u[0],u[1],0,u[0],u[1],0);E(u,this._borderWidth);i=u.length-6;u[0]=u[i];u[i+1]=u[1];u[3]=u[i+3];u[i+4]=u[4];this._createBorderGeometry(this._border.geometry,u);}};
e.prototype._createCircleViewport=function(b,f,h,l){var m=[0,0,0],u=[0.5,0.5],w=[];var x=THREE.Math.clamp(Math.round(z(b,f)/24),32,256);var y=2*Math.PI/x;for(var i=0;i<x;i++){var a=i*y,J=Math.cos(a),K=Math.sin(a);m.push(J*b,K*f,0);u.push(J*0.5+0.5,K*0.5+0.5);w.push(0,i+1,i+1<x?i+2:1);}var L=this._billboard.geometry;L.setIndex(w);L.setAttribute("position",new THREE.Float32BufferAttribute(m,3));L.setAttribute("uv",new THREE.Float32BufferAttribute(u,2));var M=this._borderWidth*j;this._createCircleBorder(m,b,f,h&&q.set(h.x/(b+M),h.y/(f+M)).length()>1?h:null,l);};
e.prototype._createCircleBorder=function(b,f,h,m,u){var w=this._borderWidth,J=[],i,x,y;if(m&&(u!==d.Circle&&u!==d.CircleLine)){J.push(m.x,m.y,0,m.x,m.y,0);var K=Math.PI*0.05;var L=Math.atan2(m.y*f,m.x*h)+K;var M=(b.length/3)-3;K=2*(Math.PI-K)/M;for(i=0;i<=M;i++){var a=L+i*K;x=Math.cos(a)*f;y=Math.sin(a)*h;J.push(x,y,0,x,y,0);}var N=[m.x,m.y,0,J[6],J[7],0,J[J.length-3],J[J.length-2],0];J.push(m.x,m.y,0,m.x,m.y,0);E(J,w);i=J.length-6;var Q=q.set(J[9],J[10]).sub(m).length();var R=q.set(J[9]-J[i-3],J[10]-J[i-2]).length()*0.5;var l=m.length();l=1-w*2*Q/(R*l);J[i+0]=J[0]=m.x*l;J[i+1]=J[1]=m.y*l;J[i+3]=J[3]=m.x;J[i+4]=J[4]=m.y;var S=this._triangle.geometry;l=(1+l)*0.5;N[0]*=l;N[1]*=l;S.setAttribute("position",new THREE.Float32BufferAttribute(N,3));this._triangle.visible=true;this._triangle.material.color.set(u===d.SolidPointer||u===d.SolidArrow?this.getBorderColor():this._backgroundColor);}else{this._line.visible=this._line.visible&&m!==null;for(i=3;i<b.length;i+=3){x=b[i];y=b[i+1];J.push(x,y,0,x,y,0);}J.push(J[0],J[1],0,J[0],J[1],0);E(J,w);i=J.length-6;J[i]=J[0]=b[3]+w*g;J[i+3]=J[3]=b[3]+w*j;J[i+1]=J[1]=b[4];J[i+4]=J[4]=b[4];}this._createBorderGeometry(this._border.geometry,J);};
e.prototype._createBorderGeometry=function(a,b){var i,f=b.length/3;var h=[];for(i=2;i<f;i+=2){h.push(i-1,i,i-2,i+1,i,i-1);}var l=[];var u=this._borderU;for(i=0;i<f;i+=2){l.push(0,0.5,u,0.5);}a.setIndex(h);a.setAttribute("position",new THREE.Float32BufferAttribute(b,3));a.setAttribute("uv",new THREE.Float32BufferAttribute(l,2));};
e.prototype._createLine=function(a){var b=[0,0,0,0,0,0,a.x,a.y,0,a.x,a.y,0];C(b,0,6,-this._borderWidth);C(b,3,9,this._borderWidth);this._createBorderGeometry(this._line.geometry,b);};
e.prototype._updateGeometry=function(s,I,a){var b=this.getShape(),f=this.getAttachmentPoint(),h=this.getOrigin();this._border.visible=b!==d.BoxNoOutline;this._line.visible=b===d.BoxLine||b===d.CircleLine;this._triangle.visible=false;if(f){p.copy(f).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);f=p.w>0?f:null;var i=(p.x/p.w)*I.x/I.y,l=p.y/p.w;o.set(i-h.x,l-h.y,0).multiplyScalar(I.y);}switch(b){default:case d.Box:case d.BoxLine:case d.BoxNoOutline:this._createBoxViewport(s.x,s.y,f?o:null,b);break;case d.Circle:case d.CircleLine:case d.CirclePointer:case d.CircleArrow:case d.CircleBubbles:case d.SolidPointer:case d.SolidArrow:this._createCircleViewport(s.x,s.y,f?o:null,b);break;}if(this._line.visible){this._createLine(o);}};
e.prototype._updateBorderTexture=function(a){var b=Math.round(this.getBorderWidth()*a);this._borderWidth=b+2;var f=THREE.Math.ceilPowerOfTwo(this._borderWidth);this._borderU=this._borderWidth/f;this._borderWidth/=a;var h=new ArrayBuffer(f*4);var l=new Uint32Array(h);var m=new THREE.Color(this.getBorderColor());m=(m.r*255)|((m.g*255)<<8)|((m.b*255)<<16)|0xFF000000;l.fill(m&0xFFFFFF);for(var i=1;i<=b;i++){l[i]=m;}var u=new THREE.DataTexture(new Uint8Array(h),f,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter);u.needsUpdate=true;this._border.material.map=u;this._border.material.needsUpdate=true;this._line.material=this._border.material;};
function F(a){var m=a.elements;var i=m[15]===1;var b=2/m[0];var f=2/m[5];var h,l;if(i){h=-m[12]*b;l=-m[13]*f;}else{h=m[8]*b;l=m[9]*f;}var u=(b+h)*0.5;var w=h-u;var x=(f+l)*0.5;var y=l-x;return{left:w,top:x,right:u,bottom:y};}
function G(a,b){var m=a.elements;var i=m[15]===1;m[0]=2/(b.right-b.left);m[5]=2/(b.top-b.bottom);if(i){m[12]=-(b.right+b.left)/(b.right-b.left);m[13]=-(b.top+b.bottom)/(b.top-b.bottom);}else{m[8]=(b.right+b.left)/(b.right-b.left);m[9]=(b.top+b.bottom)/(b.top-b.bottom);}}
function H(a,b,s,I){var w=s.x/I.x;var h=s.y/I.y;p.copy(b).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);var x=((p.x/p.w)-w)*0.5+0.5;var y=((p.y/p.w)-h)*0.5+0.5;var f=F(a.projectionMatrix);var i={};i.left=THREE.Math.lerp(f.left,f.right,x);i.right=THREE.Math.lerp(f.left,f.right,x+w);i.top=THREE.Math.lerp(f.top,f.bottom,1-y-h);i.bottom=THREE.Math.lerp(f.top,f.bottom,1-y);G(a.projectionMatrix,i);}
var I=new THREE.Vector2();
e.prototype._render=function(a,b,f,h,i){a.getSize(I);var l=a.getPixelRatio(),m=this.getOrigin(),u=this._node,w=u.position;if(!this._border.material.map){this._updateBorderTexture(l);}s.copy(this.getSize()).multiplyScalar(I.y*0.5);s.set(Math.round(s.x)<<1,Math.round(s.y)<<1);w.set(m.x*I.y/I.x,m.y,0).unproject(b);p.copy(w).applyMatrix4(b.matrixWorldInverse).applyMatrix4(b.projectionMatrix);var x=((p.x/p.w)*0.5+0.5)*I.x,y=((p.y/p.w)*0.5+0.5)*I.y;var J=p.w/(I.x*b.projectionMatrix.elements[0]);u.scale.setScalar(J);k.setFromMatrixColumn(b.matrixWorld,0).multiplyScalar(J*2*(Math.round(x)-x));n.setFromMatrixColumn(b.matrixWorld,1).multiplyScalar(J*2*(Math.round(y)-y));w.add(k).add(n);u.quaternion.copy(b.quaternion);u.updateMatrix();u.updateMatrixWorld();this._updateGeometry(s,I,b);r.copy(s).multiplyScalar(l);if(!this._renderTarget||this._renderTarget.width!==r.x||this._renderTarget.height!==r.y){this._renderTarget=new THREE.WebGLRenderTarget(r.x,r.y,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat});this._billboard.material.map=this._renderTarget.texture;this._billboard.material.needsUpdate=true;}var K;if(this.getType()===D.Cutaway){K=b;v.copy(K.projectionMatrix);H(K,w,s,I);}else{K=this.getCamera();K.adjustClipPlanes(h);K.update(s.x,s.y);K=K.getCameraRef();}f.children.forEach(function(R){if(R.userData._vkDynamicObjects){R.userData._vkDynamicObjects.forEach(function(S){if(S.layers.test(b.layers)){if(S.isBillboard){S.visible=false;}else{S._vkUpdate(a,K,s);}}});}});if(i){i.position.copy(K.position);i.updateMatrix();i.updateMatrixWorld();}var L=b.layers.mask,M=~L;var N=this.getTargetNodes();var Q=this.getTargetNodes();if(Array.isArray(Q)){N.forEach(function(u){u.userData.mask=u.layers.mask;u.layers.mask|=L;});}if(Array.isArray(Q)){Q.forEach(function(u){u.userData.mask=u.layers.mask;u.layers.mask&=M;});}a.setClearColor(this._backgroundColor,1);a.setRenderTarget(this._renderTarget);a.clear();a.render(f,K);if(K===b){b.projectionMatrix.copy(v);}if(Array.isArray(N)){N.forEach(function(u){u.layers.mask=u.userData.mask;});}if(Array.isArray(Q)){Q.forEach(function(u){u.layers.mask=u.userData.mask;});}a.setRenderTarget(null);a.render(this._node,b);f.children.forEach(function(R){if(R.userData._vkDynamicObjects){R.userData._vkDynamicObjects.forEach(function(S){if(S.layers.test(b.layers)&&S.isBillboard){S.visible=true;}});}});};
return e;});
sap.ui.predefine('sap/ui/vk/threejs/HighlightPlayer',["sap/ui/base/Object","./thirdparty/three","../HighlightDisplayState"],function(B,t,H){"use strict";
var a=B.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=H.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map();}});
a.prototype.reset=function(v,s){this.stop();this._highlightsNodesMap.clear();this._state=H.stopped;if(v&&s){var h=v.getHighlightIdNodesMap();var b=this;h.forEach(function(c,k){var d=s.getHighlight(k);b.addHighlights(d,c);});}return this;};
a.prototype.setViewStateManager=function(v){this._viewStateManager=v;};
a.prototype.addHighlights=function(h,n){if(!h||!n||!n.length){return;}var g=function(n,b){if(!n||!n.length){return;}for(var i=0;i<n.length;i++){var c=n[i];if(c.type==="Mesh"){b.push(c);}g(c.children,b);}};var m=[];g(n,m);if(m.length){this._highlightsNodesMap.set(h,m);}};
a.prototype.start=function(b){if(this._state===H.pausing){this._startTime=b-this._timeElapsed;}else{this._startTime=b;this._timeElapsed=0;}this._state=H.playing;};
a.prototype.play=function(b){if(this._state!==H.playing){return false;}this._timeElapsed=b-this._startTime;var c=this;var i=true;var s=false;this._highlightsNodesMap.forEach(function(n,h){var r=h.getColour(c._timeElapsed/1000.0);var d;if(r!==undefined){for(d=0;d<n.length;d++){if(!s&&n[d].userData.highlightingColor!==r.colour){s=true;}n[d].userData.highlightingColor=r.colour;n[d]._vkUpdateMaterialColor();}if(!r.isCompleted){i=false;}}r=h.getOpacity(c._timeElapsed/1000.0);if(r!==undefined){if(c._viewStateManager&&r.opacity>0&&h.isFadeOut()){c._viewStateManager.setVisibilityState(n,true,false);}for(d=0;d<n.length;d++){if(!s&&n[d].userData.opacity!==r.opacity){s=true;}n[d].userData.opacity=r.opacity;n[d]._vkUpdateMaterialOpacity();}if(c._viewStateManager&&r.opacity===undefined&&h.getLastOpacity()<0.000001&&h.isFadeOut()){c._viewStateManager.setVisibilityState(n,false,false);}if(!r.isCompleted){i=false;}}});if(i){this._state=H.stopped;}return!i||s;};
a.prototype.stop=function(b){this._timeElapsed=0;this._startTime=0;var c=this;this._highlightsNodesMap.forEach(function(n,h){for(var d=0;d<n.length;d++){delete n[d].userData.highlightingColor;n[d]._vkUpdateMaterialColor();delete n[d].userData.opacity;n[d]._vkUpdateMaterialOpacity();if(c._viewStateManager&&h.isFadeOut()){c._viewStateManager.setVisibilityState(n,false,false);}}});this._state=H.stopped;return this;};
a.prototype.pause=function(b){if(this._state===H.stopped){return this;}this._timeElapsed=b-this._startTime;this._state=H.pausing;return this;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/MataiLoader',["sap/base/Log","sap/ui/base/ManagedObject","../getResourceBundle","./SceneBuilder","../helpers/WorkerScriptLoader"],function(L,M,g,S,W){"use strict";var P={FinishedTree:g().getText("SCENE_CONTEXT_FINISHED_TREE"),LoadingGeometries:g().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),LoadingTextures:g().getText("SCENE_CONTEXT_LOADING_TEXTURES"),LoadingModelViews:g().getText("SCENE_CONTEXT_LOADING_MODEL_VIEWS")};
var a=M.extend("sap.ui.vk.threejs.MataiLoader",{metadata:{events:{contentChangesProgress:{parameters:{source:"any",phase:"string",percent:"float"}}}}});
function u(s){var p=s._progress;var c=40+60*(p.totalCount?p.count/p.totalCount:1);s._loader.fireContentChangesProgress({source:s._countentResource.getSource(),phase:p.phase,percentage:Math.min(c,100)});}
var b=(function(){var p;return function(){return p||(p=new Promise(function(r,c){var w=W.loadScript("sap/ui/vk/threejs/MataiLoaderWorker.js",["sap/ui/vk/threejs/thirdparty/matai.js"]);w.onmessage=function(e){var f=e.data;if(f.ready){r(w);}else{var s=S.getById(f.sceneBuilderId);s[f.method].apply(s,f.args);switch(f.method){case"setScene":var i=f.args[0];s._progress={phase:P.FinishedTree,totalCount:i.meshCount+i.imageCount+i.modelViewCount,count:0};u(s);break;case"setGeometry":if(s._progress){s._progress.phase=P.LoadingGeometries;s._progress.count++;u(s);}break;case"createImage":if(s._progress){s._progress.phase=P.LoadingTextures;s._progress.count++;u(s);}break;case"createThumbnail":if(s._progress){s._progress.phase=P.LoadingModelViews;s._progress.count++;u(s);}break;default:break;}}};w.onerror=function(e){c(e);};var d=W.absoluteUri("sap/ui/vk/threejs/thirdparty").toString()+"/";w.postMessage({method:"createRuntime",scriptDirectory:d});}));};})();
function l(c,d,e,p,f,r,h){b().then(function(w){w.onerror=function(i){L.error("Error in WebWorker",i);h(g().getText("LOADER_ERRORREADINGFILE"));};var s=new S(p,f,r,h,c);s._loader=c;w.postMessage({method:"loadSceneFromArrayBuffer",sceneBuilderId:s.getId(),buffer:d,fileName:e,sourceLocation:"remote"},[d]);},function(i){h(i);});}
a.prototype.load=function(p,c){var t=this;return new Promise(function(r,d){if(typeof c.getSource()==="string"){var f=c.getSource();fetch(f).then(function(e){if(e.ok){return e.arrayBuffer();}throw(new Error(e.statusText));}).then(function(e){l(t,e,f,p,c,r,d);}).catch(function(e){d(e);});}else if(c.getSource()instanceof File){var h=new FileReader();h.onload=function(e){l(t,e.target.result,c.getSource().name,p,c,r,d);};h.onerror=function(e){d(e);};h.readAsArrayBuffer(c.getSource());}});};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/Material',["../Material","./thirdparty/three","./Texture","../cssColorToColor","../colorToCSSColor"],function(M,t,T,a,b){"use strict";
var d=M.extend("sap.ui.vk.threejs.Material",{
metadata:{},
constructor:function(i){if(i){this._nativeMaterial=new THREE.LineBasicMaterial({color:0xaaaaaa});}else{this._nativeMaterial=new THREE.MeshPhongMaterial({color:0xaaaaaa});}M.call(this);}
});
var e=d.getMetadata().getParent().getClass().prototype;
d.prototype.init=function(){if(e.init){e.init.call(this);}};
d.prototype.getMaterialRef=function(){return this._nativeMaterial;};
d.prototype.setMaterialRef=function(m){this._nativeMaterial=m;return this;};
d.prototype.getId=function(){if(this._nativeMaterial.userData&&this._nativeMaterial.userData.materialId){return this._nativeMaterial.userData.materialId;}};
d.prototype.setId=function(v){this._nativeMaterial.userData.materialId=v;return this;};
d.prototype.getName=function(){if(this._nativeMaterial.userData&&this._nativeMaterial.userData.name){return this._nativeMaterial.userData.name;}};
d.prototype.setName=function(v){this._nativeMaterial.userData.name=v;return this;};
d.prototype.getAmbientColour=function(){};
d.prototype.setAmbientColour=function(v){return this;};
d.prototype.getDiffuseColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.color){var c={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1.0};return b(c);}};
d.prototype.setDiffuseColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=a(v);this._nativeMaterial.color=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
d.prototype.getEmissiveColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.emissive){var c={red:Math.round(this._nativeMaterial.emissive.r*255),green:Math.round(this._nativeMaterial.emissive.g*255),blue:Math.round(this._nativeMaterial.emissive.b*255),alpha:1.0};return b(c);}};
d.prototype.setEmissiveColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=a(v);this._nativeMaterial.emissive=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
d.prototype.getSpecularColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.specular){var c={red:Math.round(this._nativeMaterial.specular.r*255),green:Math.round(this._nativeMaterial.specular.g*255),blue:Math.round(this._nativeMaterial.specular.b*255),alpha:1.0};return b(c);}};
d.prototype.setSpecularColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=a(v);this._nativeMaterial.specular=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
d.prototype.getOpacity=function(){if(this._nativeMaterial.opacity!==undefined){return this._nativeMaterial.opacity;}};
d.prototype.setOpacity=function(v){if(v>=0.0&&v<=1.0){this._nativeMaterial.opacity=v;this._nativeMaterial.transparent=this._nativeMaterial.opacity<1;}return this;};
d.prototype.getGlossness=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.shininess){return this._nativeMaterial.shininess/100.0;}};
d.prototype.setGlossness=function(v){if(this._nativeMaterial.isMeshPhongMaterial){this._nativeMaterial.shininess=v*100.0;}return this;};
d.prototype.getLineColour=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.color){var c={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1.0};return b(c);}};
d.prototype.setLineColour=function(v){if(this._nativeMaterial.isLineBasicMaterial){var c=a(v);this._nativeMaterial.color=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
d.prototype.getLineWidth=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.linewidth!==undefined){return this._nativeMaterial.linewidth;}};
d.prototype.setLineWidth=function(v){if(this._nativeMaterial.isLineBasicMaterial){this._nativeMaterial.linewidth=v;}return this;};
d.prototype.getTextureDiffuse=function(){if(this._nativeMaterial.map){var c=new T();c.setTextureRef(this._nativeMaterial.map);return c;}};
d.prototype.setTextureDiffuse=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.map=v.getTextureRef();}return this;};
d.prototype.getTextureBump=function(){if(this._nativeMaterial.bumpMap){var c=new T();c.setTextureRef(this._nativeMaterial.bumpMap);return c;}};
d.prototype.setTextureBump=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.bumpMap=v.getTextureRef();}return this;};
d.prototype.getTextureOpacity=function(){if(this._nativeMaterial.alphaMap){var c=new T();c.setTextureRef(this._nativeMaterial.alphaMap);return c;}};
d.prototype.setTextureOpacity=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.alphaMap=v.getTextureRef();}return this;};
d.prototype.getTextureReflection=function(){if(this._nativeMaterial.envMap){var c=new T();c.setTextureRef(this._nativeMaterial.envMap);return c;}};
d.prototype.setTextureReflection=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.envMap=v.getTextureRef();if(this._nativeMaterial.envMap){this._nativeMaterial.envMap.mapping=THREE.SphericalReflectionMapping;this._nativeMaterial.combine=THREE.AddOperation;}}return this;};
d.prototype.getTextureEmissive=function(){if(this._nativeMaterial.emissiveMap){var c=new T();c.setTextureRef(this._nativeMaterial.emissiveMap);return c;}};
d.prototype.setTextureEmissive=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.emissiveMap=v.getTextureRef();}return this;};
d.prototype.getTextureAmbientOcclusion=function(){if(this._nativeMaterial.aoMap){var c=new T();c.setTextureRef(this._nativeMaterial.aoMap);return c;}};
d.prototype.setTextureAmbientOcclusion=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.aoMap=v.getTextureRef();}return this;};
return d;});
sap.ui.predefine('sap/ui/vk/threejs/NodeHierarchy',["jquery.sap.global","../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid"],function(q,N,O,B,a,M,g,b,u){"use strict";var s={equals:function(d,e){return d===e;},contains:function(d,e){return d.indexOf(e)!==-1;},startsWith:function(d,e){return d.indexOf(e)===0;}};
var c=N.extend("sap.ui.vk.threejs.NodeHierarchy",{
metadata:{},
_baseNodeProxyPool:new O(B),
constructor:function(d){N.call(this);this._scene=d;this._nodeProxies=[];}
});
c.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;N.prototype.destroy.call(this);};
c.prototype.getScene=function(){return this._scene;};
c.prototype.getSceneRef=function(){return this._scene.getSceneRef();};
c.prototype.enumerateChildren=function(n,d,e,p){if(typeof n==="function"){p=e;e=d;d=n;n=undefined;}var f=this.getChildren(n,e);if(p){f.forEach(d);}else{var h=this._baseNodeProxyPool.borrowObject();try{f.forEach(function(n){h.init(this,n);d(h);h.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(h);}}return this;};
c.prototype.enumerateAncestors=function(n,d,p){var e=this.getAncestors(n);if(p){e.forEach(d);}else{var f=this._baseNodeProxyPool.borrowObject();try{e.forEach(function(n){f.init(this,n);d(f);f.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(f);}}return this;};
c.prototype.createNodeProxy=function(n){var d=new a(this,n);this._nodeProxies.push(d);return d;};
c.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
c.prototype.getChildren=function(n,d){if(typeof n==="boolean"){d=n;n=undefined;}if(!n){n=this._scene.getSceneRef();}var e=[];if(d||!n.userData.closed){n.children.forEach(function(f){if(!f.private&&(f.geometry===undefined||f.layers!==n.layers)){e.push(f);}});}return e;};
c.prototype.getAncestors=function(n){var d=[];n.traverseAncestors(function(p){d.unshift(p);});if(d.length>0&&d[0]===this._scene.getSceneRef()){d.shift();}return d;};
c.prototype.findNodesByName=function(d){var r=[];if(d===undefined||d===null||d===""||q.isEmptyObject(d)){this._scene.getSceneRef().children.forEach(function(h){h.traverse(function(o){if(!o.private&&(o.geometry===undefined||o.layers!==o.parent.layers)){r.push(o);}});});}else{var e=s[d.predicate||"equals"];if(e===undefined){q.sap.log.error(g().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy");}else if(!Array.isArray(d.value)&&typeof d.value!=="string"){q.sap.log.error(g().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy");}else{var f=Array.isArray(d.value)?d.value:[d.value];if(!d.caseSensitive){for(var i in f){f[i]=f[i].toLowerCase();}}this._scene.getSceneRef().children.forEach(function(h){h.traverse(function(o){if(!o.private&&(o.geometry===undefined||o.layers!==o.parent.layers)){var n=o.name||"";if(!d.caseSensitive){n=n.toLowerCase();}for(var i in f){if(e(n,f[i])){r.push(o);break;}}}});});}}return r;};
c.prototype.createLayerProxy=function(l){return null;};
c.prototype.destroyLayerProxy=function(l){return this;};
c.prototype.getLayers=function(){return[];};
c.prototype.getHotspotNodeIds=function(){return null;};
c.prototype.attachChanged=function(d,f,l){return this.attachEvent("changed",d,f,l);};
c.prototype.detachChanged=function(d,f,l){return this.detachEvent("changed",d,f,l);};
c.prototype.fireChanged=function(p,d,e){return this.fireEvent("changed",p,d,e);};
c.prototype.attachNodeCreated=function(d,f,l){return this.attachEvent("nodeCreated",d,f,l);};
c.prototype.detachNodeCreated=function(d,f,l){return this.detachEvent("nodeCreated",d,f,l);};
c.prototype.fireNodeCreated=function(p,d,e){return this.fireEvent("nodeCreated",p,d,e);};
c.prototype.attachNodeRemoving=function(d,f,l){return this.attachEvent("nodeRemoving",d,f,l);};
c.prototype.detachNodeRemoving=function(d,f,l){return this.detachEvent("nodeRemoving",d,f,l);};
c.prototype.fireNodeRemoving=function(p,d,e){return this.fireEvent("nodeRemoving",p,d,e);};
c.prototype.attachNodeReplaced=function(d,f,l){return this.attachEvent("nodeReplaced",d,f,l);};
c.prototype.detachNodeReplaced=function(d,f,l){return this.detachEvent("nodeReplaced",d,f,l);};
c.prototype.fireNodeReplaced=function(p,d,e){return this.fireEvent("nodeReplaced",p,d,e);};
c.prototype.attachNodeUpdated=function(d,f,l){return this.attachEvent("nodeUpdated",d,f,l);};
c.prototype.detachNodeUpdated=function(d,f,l){return this.detachEvent("nodeUpdated",d,f,l);};
c.prototype.fireNodeUpdated=function(p,d,e){return this.fireEvent("nodeUpdated",p,d,e);};
c.prototype.createNode=function(p,n,i,d,e){var f=this.getScene().getSceneBuilder();var o=null;if(f){e=e||{};e.name=e.name||n;e.sid=e.sid||u();o=f.createNode(e);if(!p){p=o.parent;}}else{if(!p){p=this._scene.getSceneRef();}o=new THREE.Group();o.name=n;p.add(o);}var h=p.children.indexOf(i);if(h>=0){p.children.splice(h,0,p.children.pop());}if(d){o._vkSetNodeContentType(d);}else{o._vkSetNodeContentType(b.Regular);}if(e&&f){switch(o._vkGetNodeContentType()){case b.Annotation:e.node=o;e.nodeId=o._vkPersistentId();f.createAnnotation(e);break;default:}}this.fireNodeCreated({nodeRef:o,nodeId:o});this.fireChanged();return o;};
c.prototype.getNodeContentType=function(n){if(n==null){return b.Regular;}var d=n._vkGetNodeContentType();if(!d){d=b.Regular;}return d;};
c.prototype.createNodeCopy=function(n,p,d,i){if(!p){p=this._scene.getSceneRef();}var e=p.children.indexOf(i);var f=n.clone(true);f.name=d;p.add(f);if(e>=0){p.children.splice(e,0,p.children.pop());}this.fireNodeCreated({nodeRef:f,nodeId:f});this.fireChanged();return f;};
c.prototype.removeNode=function(n){var d=[].concat(n);d.forEach(function(n){if(n&&n.parent){this.fireNodeRemoving({nodeRef:n,nodeId:n});n.parent.remove(n);}}.bind(this));var e=this.getScene().getSceneBuilder();if(e){e.removeNode(n);}this.fireChanged();return this;};
return c;});
sap.ui.predefine('sap/ui/vk/threejs/NodeProxy',["../NodeProxy","./Material","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./ThreeExtensions","../ObjectType"],function(N,M,a,b,d,e,T,f,O){"use strict";
var g=N.extend("sap.ui.vk.threejs.NodeProxy",{
metadata:{},
constructor:function(n,o){N.call(this);this._object3D=o;this._nodeHierarchy=n;}
});
g.prototype.destroy=function(){this._object3D=null;N.prototype.destroy.call(this);};
g.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
g.prototype.getNodeRef=function(){return this._object3D;};
g.prototype.getNodeId=function(){return this._object3D;};
g.prototype.getVeIds=function(){return this._object3D.userData.veids||[];};
g.prototype.getVeId=function(){return this._object3D.userData.treeNode?this._object3D.userData.treeNode.sid:null;};
g.prototype.getMaterialId=function(){var r=this._object3D;if(this._object3D&&!this._object3D.geometry){if(this._object3D.children.length===1&&this._object3D.children[0].geometry&&(this._object3D.children[0].name===""||this._object3D.children[0].name===undefined)){r=this._object3D.children[0];}}if(r.material!==undefined&&r.material.userData!==undefined&&r.material.userData.materialId!==undefined){return r.material.userData.materialId;}else if(r.userData.originalMaterial!==undefined&&r.userData.originalMaterial.userData!==undefined&&r.userData.originalMaterial.userData.materialId!==undefined){return r.userData.originalMaterial.userData.materialId;}return undefined;};
g.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
g.prototype._updateAncestorsBoundingBox=function(){var p=this._object3D.parent;while(p){if(p.userData.boundingBox!==undefined){p._vkCalculateObjectOrientedBoundingBox();}p=p.parent;}};
g.prototype.getLocalMatrix=function(){return T.convertTo4x3(this._object3D.matrix.elements);};
g.prototype.setLocalMatrix=function(v){if(v){var o=this._object3D;o.matrix.fromArray(T.convertTo4x4(v));o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);this._updateAncestorsBoundingBox();}this.setProperty("localMatrix",v,true);return this;};
g.prototype.setLocalMatrixNotUpdatingBBox=function(v){if(v){var o=this._object3D;o.matrix.fromArray(T.convertTo4x4(v));o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);}this.setProperty("localMatrix",v,true);return this;};
g.prototype.getWorldMatrix=function(){return T.convertTo4x3(this._object3D.matrixWorld.elements);};
g.prototype.setWorldMatrix=function(v){if(v){var o=this._object3D;o.matrixWorld.fromArray(T.convertTo4x4(v));if(o.parent){o.matrix.multiplyMatrices(new THREE.Matrix4().getInverse(o.parent.matrixWorld),o.matrixWorld);}else{o.matrix.copy(o.matrixWorld);}o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);this._updateAncestorsBoundingBox();}this.setProperty("worldMatrix",v,true);return this;};
g.prototype.getOpacity=function(){return this._object3D.userData.opacity;};
g.prototype.setOpacity=function(v){var c=this._nodeHierarchy.getScene().getViewStateManager();if(c){c.setOpacity(this._object3D,v);}else{this._object3D._vkSetOpacity(v);}this.setProperty("opacity",v,true);return this;};
g.prototype.getTintColorABGR=function(){return this._object3D.userData.tintColor;};
g.prototype.setTintColorABGR=function(v){var c=this._nodeHierarchy.getScene().getViewStateManager();if(c){c.setTintColor(this._object3D,v);}else{this._object3D._vkSetTintColor(v);}this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",b(d(v)),true);return this;};
g.prototype.getTintColor=function(){return b(d(this._object3D.userData.tintColor));};
g.prototype.setTintColor=function(v){var c=e(a(v));var h=this._nodeHierarchy.getScene().getViewStateManager();if(h){h.setTintColor(this._object3D,c);}else{this._object3D._vkSetTintColor(c);}this.setProperty("tintColorABGR",c,true);this.setProperty("tintColor",v,true);return this;};
g.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata;};
g.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
g.prototype.getClosed=function(){return!!this._object3D.userData.closed;};
g.prototype.assignMaterial=function(v){var s=function(m,n){var h;if(m.userData){h=m.userData.materialId;n.userData.materialId=h;}if(n.material!==undefined){if(n.userData.highlightColor!==undefined){if(n.userData.originalMaterial.side){m.side=n.userData.originalMaterial.side;}n.userData.originalMaterial=m;m.userData.materialUsed++;n.material=m.clone();var c=d(n.userData.highlightColor);n.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(m.userData.defaultHighlightingEmissive){n.material.emissive.copy(m.userData.defaultHighlightingEmissive);}if(m.userData.defaultHighlightingSpecular){n.material.specular.copy(m.userData.defaultHighlightingSpecular);}}else{if(n.material.side){m.side=n.material.side;}n.material=m;m.userData.materialUsed++;delete n.userData.originalMaterial;}n._vkUpdateMaterialOpacity();}};s(v.getMaterialRef(),this._object3D);if(!this._object3D.children){return this;}this._object3D.children.forEach(function(c){if(!c||c.userData.objectType===O.PMI||c.userData.objectType===O.Hotspot){return;}s(v.getMaterialRef(),c);});return this;};
g.prototype.enumerateMaterials=function(r){var c=function(n,l,r){if(n){if(n.userData.originalMaterial){l.add(n.userData.originalMaterial);}else if(n.material){l.add(n.material);}if(n.children){n.children.forEach(function(o){if(o){if(r){c(o,l,r);}else if(o.userData.originalMaterial){l.add(o.userData.originalMaterial);}else if(o.material){l.add(o.material);}}});}}};var m=new Set();c(this._object3D,m,r);var h=[];m.forEach(function(v){h.push(v);});var j=[];for(var i=0;i<h.length;i++){var k=new M();k.setMaterialRef(h[i]);j.push(k);}return j;};
g.prototype.replaceMaterial=function(m,c){var h=m.getMaterialRef();var i=c.getMaterialRef();if(this._object3D.userData.originalMaterial&&this._object3D.userData.originalMaterial===h){this._object3D.userData.originalMaterial=i;}else if(this._object3D.material&&this._object3D.material===h){this._object3D.material=i;}if(!this._object3D.children){return this;}this._object3D.children.forEach(function(j){if(j&&j.userData.originalMaterial&&j.userData.originalMaterial===h){j.userData.originalMaterial=i;}else if(j&&j.material&&j.material===h){j.material=i;}});return this;};
g.prototype.getLocalTranslate=function(){var o=this._object3D;return[o.position.x,o.position.y,o.position.z];};
g.prototype.getLocalScale=function(){var o=this._object3D;return[o.scale.x,o.scale.y,o.scale.z];};
g.prototype.getLocalRotationInQuaternion=function(){var o=this._object3D;return[o.quaternion.x,o.quaternion.y,o.quaternion.z,o.quaternion.w];};
g.prototype.getLocalRotationInAngleAxis=function(){var o=this._object3D;var q=o.quaternion;if(q.w>1){q.normalise();}var c=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);var x,y,z;if(s<0.001){x=q.x;y=q.y;z=q.z;}else{x=q.x/s;y=q.y/s;z=q.z/s;}return[x,y,z,c];};
g.prototype.getLocalRotationInEuler=function(){var o=this._object3D;var q=o.quaternion;if(q.w>1){q.normalise();}var c=26;var t=q.x*q.y+q.z*q.w;var h,i,j;if(t>0.499){h=2*Math.atan2(q.x,q.w);i=Math.PI/2;j=0;}if(t<-0.499){h=-2*Math.atan2(q.x,q.w);i=-Math.PI/2;j=0;}else{var s=q.x*q.x;var k=q.y*q.y;var l=q.z*q.z;h=Math.atan2(2*q.y*q.w-2*q.x*q.z,1-2*k-2*l);i=Math.asin(2*t);j=Math.atan2(2*q.x*q.w-2*q.y*q.z,1-2*s-2*l);}return[h,i,j,c];};
return g;});
sap.ui.predefine('sap/ui/vk/threejs/NodesTransitionHelper',["./thirdparty/three","sap/ui/core/Element","../TransformationMatrix"],function(t,E,T){"use strict";
var N=E.extend("sap.ui.vk.threejs.NodesTransitionHelper",{metadata:{properties:{},publicMethods:["setViewStateManager","setNodeForDisplay","setDisappearingNode","setAppearingNode","clear","startDisplay","displayNodesMoving"],events:{displaying:{},displayed:{}}}});
N.prototype.init=function(){this._viewStateManager=null;this._nodeLocalmMatrixMap=new Map();this._nodeLocalMatrixMapForVisibility=new Map();this._timeIntervalForDisplay=500;this._startTimeForDisplay=0;};
N.prototype.destroy=function(){this._viewStateManager=null;this._nodeLocalmMatrixMap=null;this._nodeLocalMatrixMapForVisibility=new Map();};
N.prototype.setViewStateManager=function(v){this._viewStateManager=v;};
N.prototype.setNodeForDisplay=function(n,a){this._nodeLocalmMatrixMap.set(n,{oldMatrix:n.getLocalMatrix(),newMatrix:a?T.convertTo4x3(a.elements):null});};
N.prototype.setDisappearingNode=function(n){var o=n.getLocalMatrix();var a=[o[0]*0.0001,o[1],o[2],o[3],o[4]*0.0001,o[5],o[6],o[7],o[8]*0.0001,o[9],o[10],o[11]];this._nodeLocalMatrixMapForVisibility.set(n,{oldMatrix:o,newMatrix:a,visible:false});this._viewport.getViewStateManager().setVisibilityState(n.getNodeRef(),true,false);};
N.prototype.setAppearingNode=function(n){var o=n.getLocalMatrix();var a=[o[0]*0.0001,o[1],o[2],o[3],o[4]*0.0001,o[5],o[6],o[7],o[8]*0.0001,o[9],o[10],o[11]];this._nodeLocalMatrixMapForVisibility.set(n,{oldMatrix:a,newMatrix:o,visible:true});};
N.prototype._interpolateNodePositionForVisibility=function(n,d,i){var a=n.getNodeRef();return(i>=1)?d.visible:a.visible;};
N.prototype._interpolateNodePosition=function(n,o,a,i){var b=new THREE.Matrix4().fromArray(T.convertTo4x4(o));var c=new THREE.Vector3();var d=new THREE.Quaternion();var e=new THREE.Vector3();b.decompose(c,d,e);var f=new THREE.Matrix4().fromArray(T.convertTo4x4(a));var g=new THREE.Vector3();var h=new THREE.Quaternion();var j=new THREE.Vector3();f.decompose(g,h,j);var p=new THREE.Vector3().lerpVectors(c,g,i);var q=new THREE.Quaternion().copy(d).slerp(h,i);var s=new THREE.Vector3().lerpVectors(e,j,i);return{translation:p.toArray(),quaternion:q.toArray(),scale:s.toArray()};};
N.prototype.startDisplay=function(a){if(this._nodeLocalmMatrixMap.size===0){return;}this._timeIntervalForDisplay=a!==undefined?a:500;this._startTimeForDisplay=Date.now();this._nodeLocalmMatrixMap.forEach(function(m,n){if(!m.newMatrix){m.newMatrix=n.getLocalMatrix();}});this.fireDisplaying();};
N.prototype.displayNodesMoving=function(){if(this._startTimeForDisplay===0||this._nodeLocalmMatrixMap===null||this._nodeLocalmMatrixMap.size===0){return;}var i=Math.min((Date.now()-this._startTimeForDisplay)/this._timeIntervalForDisplay,1);i=1-Math.pow(1-i,3);var a={nodeRefs:[],positions:[]};this._nodeLocalmMatrixMap.forEach(function(m,n){if(n&&m.oldMatrix&&m.newMatrix){var b=this._interpolateNodePosition(n,m.oldMatrix,m.newMatrix,i);a.nodeRefs.push(n.getNodeRef());a.positions.push(b);}}.bind(this));if(a.nodeRefs.length){this._viewStateManager.setTransformation(a.nodeRefs,a.positions);}var v={nodeRefs:[],values:[]};this._nodeLocalMatrixMapForVisibility.forEach(function(d,n){if(n&&d){var b=this._interpolateNodePositionForVisibility(n,d,i);v.nodeRefs.push(n.getNodeRef());v.values.push(b);}}.bind(this));this._viewStateManager.setVisibilityState(v.nodeRefs,v.values);if(i===1){this.clear();this.fireDisplayed();}};
N.prototype.clear=function(){this._nodeLocalmMatrixMap.clear();this._nodeLocalMatrixMapForVisibility.clear();this._startTimeForDisplay=0;};
return N;});
sap.ui.predefine('sap/ui/vk/threejs/OrthographicCamera',["../OrthographicCamera","./thirdparty/three"],function(O,t){"use strict";
var T=O.extend("sap.ui.vk.threejs.OrthographicCamera",{metadata:{}});
var b=O.getMetadata().getParent().getClass().prototype;
T.prototype.init=function(){if(b.init){b.init.call(this);}var n=1;var f=200000;this._nativeCamera=new THREE.OrthographicCamera(-1,1,1,-1,n,f);this._nativeCamera.position.set(0,0,10000);this._nativeCamera.zoom=-1;this.setUsingDefaultClipPlanes(true);};
T.prototype.update=function(w,h){var f=1/Math.min(w,h);this.setLeft(w*-f);this.setRight(w*f);this.setTop(h*f);this.setBottom(h*-f);this._nativeCamera.updateProjectionMatrix();};
T.prototype.exit=function(){if(b.exit){b.exit.call(this);}this._nativeCamera=null;};
T.prototype.getLeft=function(){return this._nativeCamera.left;};
T.prototype.setLeft=function(v){this._nativeCamera.left=v;return this;};
T.prototype.getRight=function(){return this._nativeCamera.right;};
T.prototype.setRight=function(v){this._nativeCamera.right=v;return this;};
T.prototype.getTop=function(){return this._nativeCamera.top;};
T.prototype.setTop=function(v){this._nativeCamera.top=v;return this;};
T.prototype.getBottom=function(){return this._nativeCamera.bottom;};
T.prototype.setBottom=function(v){this._nativeCamera.bottom=v;return this;};
T.prototype.getZoomFactor=function(){return this._nativeCamera.zoom;};
T.prototype.setZoomFactor=function(v){this._nativeCamera.zoom=v;return this;};
T.prototype.getCameraRef=function(){return this._nativeCamera;};
T.prototype.setCameraRef=function(c){this._nativeCamera=c;return this;};
T.prototype.getNearClipPlane=function(){return this._nativeCamera.near;};
T.prototype.setNearClipPlane=function(v){this._nativeCamera.near=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getFarClipPlane=function(){return this._nativeCamera.far;};
T.prototype.setFarClipPlane=function(v){this._nativeCamera.far=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getPosition=function(){return this._nativeCamera.position.toArray();};
T.prototype.setPosition=function(v){this._nativeCamera.position.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray();};
T.prototype.setUpDirection=function(v){this._nativeCamera.up.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getTargetDirection=function(){var d=new THREE.Vector3();this._nativeCamera.getWorldDirection(d);return d.toArray();};
T.prototype.setTargetDirection=function(v){var a=new THREE.Vector3().fromArray(v);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this;};
T.prototype.setUsingDefaultClipPlanes=function(v){this._nativeCamera.userData.usingDefaultClipPlanes=v;return this;};
T.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes;};
T.prototype.adjustClipPlanes=function(a){var c=this._nativeCamera;c.updateMatrixWorld();a=a.clone().applyMatrix4(c.matrixWorldInverse);c.near=-a.max.z;c.far=-a.min.z;var e=Math.max((c.far-c.near)*0.0025,0.001);c.near-=e;c.far+=e;var p=1.0/(c.far-c.near);var z=(c.far+c.near)*p;c.projectionMatrix.elements[10]=-2*p;c.projectionMatrix.elements[14]=-z;c.projectionMatrixInverse.getInverse(c.projectionMatrix);return this;};
T.prototype.adjustZoom=function(a){var c=this._nativeCamera;c.updateMatrixWorld();a=a.clone().applyMatrix4(c.matrixWorldInverse);c.zoom=1/Math.max(a.min.x/c.left,a.max.y/c.top,a.max.x/c.right,a.min.y/c.bottom);c.updateProjectionMatrix();return this;};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/PerspectiveCamera',["../PerspectiveCamera","./thirdparty/three"],function(P,t){"use strict";
var T=P.extend("sap.ui.vk.threejs.PerspectiveCamera",{metadata:{}});
var b=P.getMetadata().getParent().getClass().prototype;
T.prototype.init=function(){if(b.init){b.init.call(this);}var n=1;var f=10000;this._nativeCamera=new THREE.PerspectiveCamera(30,1,n,f);this._nativeCamera.position.set(0,0,100);this.setUsingDefaultClipPlanes(true);};
T.prototype.update=function(w,h){var o=this._nativeCamera.aspect;var a=this._nativeCamera.zoom;this._nativeCamera.aspect=w/h;this._nativeCamera.zoom=Math.min(this._nativeCamera.aspect,1);var v=this._nativeCamera.view;if(v&&v.enabled){var s=w/v.fullWidth;var c=h/v.fullHeight;var d=this._nativeCamera.zoom/a;var e=d*o/this._nativeCamera.aspect;v.offsetX=(v.offsetX*e+(v.fullWidth-v.width)*(1-e)*0.5)*s;v.offsetY=(v.offsetY*d+(v.fullHeight-v.height)*(1-d)*0.5)*c;v.width*=s;v.height*=c;v.fullWidth=w;v.fullHeight=h;}this._nativeCamera.updateProjectionMatrix();};
T.prototype.exit=function(){if(b.exit){b.exit.call(this);}this._nativeCamera=null;};
T.prototype.getFov=function(){return this._nativeCamera.fov;};
T.prototype.setFov=function(v){this._nativeCamera.fov=v;this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getCameraRef=function(){return this._nativeCamera;};
T.prototype.setCameraRef=function(c){this._nativeCamera=c;return this;};
T.prototype.getNearClipPlane=function(){return this._nativeCamera.near;};
T.prototype.setNearClipPlane=function(v){this._nativeCamera.near=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getFarClipPlane=function(){return this._nativeCamera.far;};
T.prototype.setFarClipPlane=function(v){this._nativeCamera.far=v;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this;};
T.prototype.getPosition=function(){return this._nativeCamera.position.toArray();};
T.prototype.setPosition=function(v){this._nativeCamera.position.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray();};
T.prototype.setUpDirection=function(v){this._nativeCamera.up.fromArray(v);this._nativeCamera.updateMatrixWorld();return this;};
T.prototype.getTargetDirection=function(){return this._nativeCamera.getWorldDirection().toArray();};
T.prototype.setTargetDirection=function(v){var a=new THREE.Vector3().fromArray(v);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this;};
T.prototype.setUsingDefaultClipPlanes=function(v){this._nativeCamera.userData.usingDefaultClipPlanes=v;return this;};
T.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes;};
T.prototype.adjustClipPlanes=function(a){var e=this._nativeCamera;e.updateMatrixWorld();a=a.clone().applyMatrix4(e.matrixWorldInverse);e.near=-a.max.z;e.far=-a.min.z;var f=Math.max((e.far-e.near)*0.0025,0.001);e.far=Math.max(e.far,0.1);f=Math.max(f,e.far*0.0025);e.near-=f;e.far+=f;e.near=Math.max(e.near,e.far*0.0025);var c=-(e.far+e.near)/(e.far-e.near);var d=-2*e.far*e.near/(e.far-e.near);e.projectionMatrix.elements[10]=c;e.projectionMatrix.elements[14]=d;e.projectionMatrixInverse.getInverse(e.projectionMatrix);return this;};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/PolylineGeometry',["./thirdparty/three"],function(t){"use strict";
function P(){THREE.InstancedBufferGeometry.call(this);this.type="PolylineGeometry";var p=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0];var u=[2,-1,2,1,1,-1,1,1,-1,-1,-1,1,-2,-1,-2,1];var i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i);this.setAttribute("position",new THREE.Float32BufferAttribute(p,3));this.setAttribute("uv",new THREE.Float32BufferAttribute(u,2));}
P.prototype=Object.assign(Object.create(THREE.InstancedBufferGeometry.prototype),{constructor:P,isPolylineGeometry:true,setVertices:function(v){this.vertices=v;var l=v.length-1;var d=new Float32Array(6*l);for(var i=0,c=0;i<l;i++){var a=v[i],b=v[i+1];d[c++]=a.x;d[c++]=a.y;d[c++]=a.z;d[c++]=b.x;d[c++]=b.y;d[c++]=b.z;}var e=new THREE.InstancedInterleavedBuffer(d,6,1);this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(e,3,0));this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(e,3,3));var f=new THREE.InstancedInterleavedBuffer(new Float32Array(2*l),2,1);this.setAttribute("instanceDistance",new THREE.InterleavedBufferAttribute(f,2,0));this.computeBoundingBox();this.computeBoundingSphere();return this;},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3();}this.boundingBox.setFromPoints(this.vertices);},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere();}this.boundingSphere.setFromPoints(this.vertices);},_updateVertices:function(a){var b=this.vertices;var d=this.attributes.instanceStart.data;var c=d.array;a.forEach(function(e){var v=b[e];var i=e*6-3;if(i>=0){c[i+0]=v.x;c[i+1]=v.y;c[i+2]=v.z;}if(i+5<c.length){c[i+3]=v.x;c[i+4]=v.y;c[i+5]=v.z;}});d.needsUpdate=true;this.computeBoundingBox();this.computeBoundingSphere();}});return P;});
sap.ui.predefine('sap/ui/vk/threejs/PolylineMaterial',["./thirdparty/three"],function(t){"use strict";var p={lineColor:{value:new THREE.Color(1,1,1)},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashScale:{value:1},dashPeriod:{value:new THREE.Vector3(1,1,1)},dashAtlas:{value:null},lineLength:{value:1e5}};var u=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,p]);var v=["#include <common>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","","uniform float linewidth;","uniform vec2 resolution;","","attribute vec3 instanceStart;","attribute vec3 instanceEnd;","","varying vec2 vTC;","","#if defined(USE_DASH) || TRIM_STYLE","attribute vec2 instanceDistance;","varying float vLineDistance;","#endif","","void trimSegment(const in vec4 start, inout vec4 end) {","	// trim end segment so it terminates between the camera plane and the near plane","","	// conservative estimate of the near plane","	float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column","	float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column","	float nearEstimate = -0.5 * b / a;","","	float t = (nearEstimate - start.z) / (end.z - start.z);","","	end.xyz = mix(start.xyz, end.xyz, t);","}","","void main() {","	vTC = uv * linewidth;","","	// camera space","	vec4 start = modelViewMatrix * vec4(instanceStart, 1.0);","	vec4 end = modelViewMatrix * vec4(instanceEnd, 1.0);","","	// special case for perspective projection, and segments that terminate either in, or behind, the camera plane","	// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space","	// but we need to perform ndc-space calculations in the shader, so we must address this issue directly","	// perhaps there is a more elegant solution -- WestLangley","","	bool perspective = (projectionMatrix[ 2 ][ 3 ] == -1.0); // 4th entry in the 3rd column","	if (perspective) {","		if (start.z < 0.0 && end.z >= 0.0) {","			trimSegment(start, end);","		} else if (end.z < 0.0 && start.z >= 0.0) {","			trimSegment(end, start);","		}","	}","","	// clip space","	vec4 clipStart = projectionMatrix * start;","	vec4 clipEnd = projectionMatrix * end;","","	// ndc space","	vec2 ndcStart = clipStart.xy / clipStart.w;","	vec2 ndcEnd = clipEnd.xy / clipEnd.w;","","	// direction","	vec2 dir = (ndcEnd - ndcStart) * resolution;","	float l = length(dir);","	dir = normalize(dir);","","	// perpendicular to dir","	vec2 offset = vec2(dir.y, -dir.x) * position.x;","","#if defined(USE_DASH) || TRIM_STYLE","	vLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y);","#endif","","	// endcaps","	if ( position.y < 0.0 ) {","		offset -= dir;","#if defined(USE_DASH)","		vLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y * linewidth / l);","#endif","	} else if ( position.y > 1.0 ) {","		offset += dir;","#if defined(USE_DASH)","		vLineDistance = mix(instanceDistance.x, instanceDistance.y, 1.0 + (position.y - 1.0) * linewidth / l);","#endif","	}","","	// select end","	vec4 clip = (position.y < 0.5) ? clipStart : clipEnd;","	clip /= clip.w; // remove perspective correction","","	clip.xy += offset * (linewidth / resolution);","","	gl_Position = clip;","","	vec4 mvPosition = (position.y < 0.5) ? start : end; // this is an approximation","","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>","}"].join("\n");var f=["uniform vec3 diffuse;","uniform vec3 lineColor;","uniform float opacity;","uniform float linewidth;","","#ifdef USE_DASH","uniform float dashScale;","uniform vec3 dashPeriod;","uniform sampler2D dashAtlas;","#endif","","#if (TRIM_STYLE & 2)","uniform float lineLength;","#endif","","varying float vLineDistance;","","#include <common>","#include <color_pars_fragment>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","","varying vec2 vTC;","","void main() {","","#include <clipping_planes_fragment>","","	vec4 diffuseColor = vec4(diffuse * lineColor, opacity);","","	vec2 uv = abs(vTC);","	diffuseColor.a *= clamp(linewidth + 0.5 - uv.y, 0.0, 1.0); // line antialiasing","","#if (TRIM_STYLE & 1)","	if (vLineDistance < 0.0)","		discard;","#endif","","#if (TRIM_STYLE & 2)","	if (vLineDistance > lineLength)","		discard;","#endif","","	if (uv.x > linewidth) { // apply segment cap","#if (SEGMENT_CAP_STYLE == 1) // round cap","		vec2 delta = vec2(uv.y, uv.x - linewidth);","		diffuseColor.a *= clamp(linewidth - length(delta), 0.0, 1.0);","#else","		diffuseColor.a *= clamp(linewidth + 1.0 - uv.x, 0.0, 1.0);","#endif","	}","","#include <logdepthbuf_fragment>","#include <color_fragment>","","#ifdef USE_DASH","	float x = fract(vLineDistance * dashPeriod.y / dashScale);","	vec4 dash = texture2D(dashAtlas, vec2(x * dashPeriod.z, 0.5));","	dash.zw *= 255.0;","	x *= dashPeriod.x;","	dash.zw = vec2(dash.z - x, x - dash.w);","	x = min(dash.z, dash.w) * dashScale;","#if (DASH_CAP_STYLE == 1) // round cap","	vec2 delta = vec2(x * 2.0, uv.y);","	diffuseColor.a *= max(step(x / linewidth, 0.0), clamp(linewidth + 0.5 - length(delta), 0.0, 1.0));","#else // no cap","	diffuseColor.a *= clamp(0.5 - x, 0.0, 1.0);","#endif","#endif","","	gl_FragColor = diffuseColor;","","#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","}"].join("\n");
function P(a){THREE.ShaderMaterial.call(this,{type:"PolylineMaterial",uniforms:THREE.UniformsUtils.clone(u),vertexShader:v,fragmentShader:f});this.defines.DASH_CAP_STYLE=0;this.defines.SEGMENT_CAP_STYLE=0;this.defines.TRIM_STYLE=0;this._dashPattern=[];Object.defineProperties(this,{color:{enumerable:true,get:function(){return this.uniforms.diffuse.value;},set:function(b){this.uniforms.diffuse.value=b;}},lineColor:{enumerable:true,get:function(){return this.uniforms.lineColor.value;},set:function(b){this.uniforms.lineColor.value=b;}},linewidth:{enumerable:true,get:function(){return this.uniforms.linewidth.value;},set:function(b){this.uniforms.linewidth.value=b;}},dashCapStyle:{enumerable:true,get:function(){return this.defines.DASH_CAP_STYLE;},set:function(b){this.defines.DASH_CAP_STYLE=b;}},segmentCapStyle:{enumerable:true,get:function(){return this.defines.SEGMENT_CAP_STYLE;},set:function(b){this.defines.SEGMENT_CAP_STYLE=b;}},trimStyle:{enumerable:true,get:function(){return this.defines.TRIM_STYLE;},set:function(b){this.defines.TRIM_STYLE=b;}},dashScale:{enumerable:true,get:function(){return this.uniforms.dashScale.value;},set:function(b){this.uniforms.dashScale.value=b;}},dashPattern:{enumerable:true,get:function(){return this._dashPattern;},set:function(b){this._dashPattern=b;this._updateDashAtlas();}},resolution:{enumerable:true,get:function(){return this.uniforms.resolution.value;},set:function(b){this.uniforms.resolution.value.copy(b);}},lineLength:{enumerable:true,get:function(){return this.uniforms.lineLength.value;},set:function(b){this.uniforms.lineLength.value=b;}}});this.setValues(a);}
P.prototype=Object.create(THREE.ShaderMaterial.prototype);P.prototype.constructor=P;P.prototype.isLineMaterial=true;
P.prototype._updateDashAtlas=function(){if(!this._dashPattern.length){delete this.defines.USE_DASH;this.uniforms.dashAtlas.value=null;this.needsUpdate=true;return;}var d=Array.from(this._dashPattern);if(d.length&1){d=d.concat(d);}var a=d.reduce(function(l,n){return l+Math.ceil(n);});var b=THREE.Math.ceilPowerOfTwo(a);this.uniforms.dashPeriod.value.set(a,1/a,a/b);var e=new Uint8Array(b*4);for(var i=0,x=0,c=0;i<d.length;i++){var w=d[i];var g=(i&1)?x+w:x;var h=(i&1)?x:x+w;var j=(i&1)?0:255;while(w-->0){e[c++]=j;e[c++]=0;e[c++]=g;e[c++]=h;x++;}}var k=new THREE.DataTexture(e,b,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);k.needsUpdate=true;this.defines.USE_DASH="";this.uniforms.dashAtlas.value=k;this.needsUpdate=true;};
P.prototype.copy=function(s){THREE.ShaderMaterial.prototype.copy.call(this,s);this.color.copy(s.color);this.lineColor.copy(s.lineColor);this.linewidth=s.linewidth;this.dashCapStyle=s.dashCapStyle;this.segmentCapStyle=s.segmentCapStyle;this.trimStyle=s.trimStyle;this.dashPattern=s.dashPattern;this.resolution=s.resolution;this.lineLength=s.lineLength;return this;};
return P;});
sap.ui.predefine('sap/ui/vk/threejs/PolylineMesh',["./thirdparty/three","./PolylineGeometry","./PolylineMaterial"],function(c,P,d){"use strict";
function e(g,m){THREE.Mesh.call(this);this.type="PolylineMesh";this.geometry=g!==undefined?g:new P();this.material=m!==undefined?m:new d();}
e.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:e,isPolylineMesh:true,computeLineDistances:(function(){var a=new THREE.Vector4();var b=new THREE.Vector4();var f=new THREE.Vector2();var g=new THREE.Vector2();return function(m,v,n){var h=this.geometry;var k=h.attributes.instanceDistance.data;var o=k.array;var p=h.vertices;var q=0,t;a.copy(p[0]).applyMatrix4(m);for(var i=0,j=0,l=k.count;i<l;i++,j+=2){b.copy(p[i+1]).applyMatrix4(m);if(n!==undefined){if(a.w>=n){f.copy(a).multiplyScalar(1/a.w);if(b.w>=n){g.copy(b).multiplyScalar(1/b.w);}else{t=(a.w-n)/(a.w-b.w);g.copy(b).sub(a).multiplyScalar(t).add(a).multiplyScalar(1/n);}}else if(b.w>=n){g.copy(b).multiplyScalar(1/b.w);t=(b.w-n)/(b.w-a.w);f.copy(a).sub(b).multiplyScalar(t).add(b).multiplyScalar(1/n);}else{f.set(0,0,0);g.set(0,0,0);}}else{f.copy(a);g.copy(b);}o[j]=q;q+=g.sub(f).multiply(v).length()*0.5;o[j+1]=q;a.copy(b);}this.material.lineLength=q;k.needsUpdate=true;return this;};}())});return e;});
sap.ui.predefine('sap/ui/vk/threejs/Scene',["jquery.sap.global","../Scene","./NodeHierarchy","../RenderMode","./ThreeExtensions"],function(q,S,N,R,T){"use strict";
var c=S.extend("sap.ui.vk.threejs.Scene",{
metadata:{},
constructor:function(a){S.call(this);this._id=q.sap.uid();this._scene=a;this._sceneBuilder=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null;this._animationSequenceMap=new Map();this._initialView=null;this._materialMap=new Map();this._layersMask=(1|0);}
});
c.prototype.init=function(){this._outlineColor=new THREE.Vector4(0,0,0,1);this._outlineMaterial=new THREE.ShaderMaterial({uniforms:{color:{value:this._outlineColor}},vertexShader:["attribute vec3 normal1;","attribute vec3 normal2;","#include <clipping_planes_pars_vertex>","uniform vec4 color;","varying vec4 vColor;","void main() {","	#include <begin_vertex>","	#include <project_vertex>","	#include <clipping_planes_vertex>","	vec3 eyeDirection = mvPosition.xyz;","	vec3 n1 = normalMatrix * normal1;","	vec3 n2 = normalMatrix * normal2;","	vColor = color;","	vColor.a *= step(dot(eyeDirection, n1) * dot(eyeDirection, n2), 0.0);","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","varying vec4 vColor;","void main() {","	#include <clipping_planes_fragment>","	if (vColor.a < ALPHATEST) discard;","	gl_FragColor = vColor;","}"].join("\n"),depthWrite:false,depthFunc:THREE.LessEqualDepth,polygonOffset:true,polygonOffsetFactor:-4,blending:THREE.NormalBlending,alphaTest:0.01,clipping:true});this._solidWhiteMaterial=new THREE.MeshBasicMaterial({color:0xFFFFFF});};
c.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._sceneBuilder=null;this._scene=null;this._animationSequenceMap.clear();S.prototype.destroy.call(this);};
c.prototype.setDoubleSided=function(v){this.setProperty("doubleSided",v,true);this._scene.traverse(function(a){if(a.material!==undefined){var u=a.userData;var b=THREE.FrontSide;var e;if(u.originalMaterial){if(u.originalMaterial.userData===undefined){u.originalMaterial.userData={};}e=u.originalMaterial.userData;if(e.originalMaterialSide===undefined){e.originalMaterialSide=u.originalMaterial.side;}b=e.originalMaterialSide;}else{if(a.material.userData===undefined){a.material.userData={};}e=a.material.userData;if(e.originalMaterialSide===undefined){e.originalMaterialSide=a.material.side;}b=e.originalMaterialSide;}a.material.side=v?THREE.DoubleSide:b;}});return this;};
c.prototype.setViewStateManager=function(v){this._currentViewStateManager=v;return this;};
c.prototype.getViewStateManager=function(){return this._currentViewStateManager;};
c.prototype.getId=function(){return this._id;};
c.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
c.prototype._computeBoundingBox=function(v,i,a){var b=new THREE.Box3();if(this._scene){this._scene._expandBoundingBox(b,v,i,a);}return b;};
c.prototype.getSceneRef=function(){return this._scene;};
c.prototype.setSceneBuilder=function(a){this._sceneBuilder=a;};
c.prototype.getSceneBuilder=function(){return this._sceneBuilder;};
c.prototype.nodeRefToPersistentId=function(a){return Array.isArray(a)?a.map(function(b){return b._vkPersistentId();}):a._vkPersistentId();};
c.prototype.persistentIdToNodeRef=function(a){var b=this._sceneBuilder;if(Array.isArray(a)){return a.map(function(e){return b?b.getNode(e):null;});}else{return b?b.getNode(a):null;}};
c.prototype.setNodePersistentId=function(a,b,e){return this._sceneBuilder?this._sceneBuilder.setNodePersistentId(a,b,e):false;};
c.prototype.setAnnotationPersistentId=function(a,b,e){return this._sceneBuilder?this._sceneBuilder.setAnnotationPersistentId(a,b,e):false;};
c.prototype.enumerateMaterials=function(){if(!this._defaultNodeHierarchy){return[];}var t=this._defaultNodeHierarchy.createNodeProxy(this._scene);if(t){return t.enumerateMaterials(true);}else{return[];}};
var d=0;
function f(a,b){var e=a.x-b.x;if(e<-d){return true;}if(e>d){return false;}var i=a.y-b.y;if(i<-d){return true;}if(i>d){return false;}return a.z-b.z<-d;}
function g(a,b,e){if(b<e){var i=p(a,b,e);g(a,b,i-1);g(a,i+1,e);}return a;}
function p(a,b,e){var j=a[e],l=b;for(var i=b;i<e;i++){if(f(a[i],j)){s(a,i,l);l++;}}s(a,e,l);return l;}
function s(a,i,j){if(i!=j){var t=a[i];a[i]=a[j];a[j]=t;}}
var h=new THREE.Vector3();
function m(a){a.computeBoundingBox();a.boundingBox.getSize(h);d=Math.max(h.x,h.y,h.z)*1e-4;var v=a.vertices,b=v.length,e=a.faces.length;if(b===0||e===0){return;}var i,j;for(i=0;i<b;i++){v[i].index=i;}g(v,0,v.length-1);var u=[],l=[];u.push(v[0]);l[v[0].index]=u.length-1;for(i=1;i<b;i++){if(f(u[u.length-1],v[i])){u.push(v[i]);}l[v[i].index]=u.length-1;}a.vertices=u;for(i=0,e=a.faces.length,j=0;i<e;i++){var t=a.faces[i];var w=a.faces[j];w.a=l[t.a];w.b=l[t.b];w.c=l[t.c];if(w.a!==w.b&&w.b!==w.c&&w.c!==w.a){j++;}}a.faces.length=j;}
function O(a,t){THREE.BufferGeometry.call(this);this.type="OutlineGeometry";var b=Math.cos(THREE.Math.DEG2RAD*((t!==undefined)?t:1));var u={},w,x;var y,z=["a","b","c"];var v=new THREE.Vector3();var A;if(a.isBufferGeometry){A=new THREE.Geometry();A.fromBufferGeometry(a);}else{A=a.clone();}m(A);A.computeFaceNormals();var B=A.vertices;var C=A.faces;for(var D=0,l=C.length;D<l;D++){var E=C[D];for(var i=0,j=2;i<3;j=i++){w=E[z[j]];x=E[z[i]];y=Math.min(w,x)+","+Math.max(w,x);if(u[y]===undefined){u[y]={index1:w,index2:x,face1:D,face2:undefined};}else{u[y].face2=D;}}}var F=[];var G=[];var H=[];for(y in u){var e=u[y];if(e.face2===undefined||(C[e.face1].normal.dot(C[e.face2].normal)<=b&&v.copy(B[e.index2]).sub(B[e.index1]).cross(C[e.face1].normal).dot(C[e.face2].normal)>0)){var I=B[e.index1];F.push(I.x,I.y,I.z);I=B[e.index2];F.push(I.x,I.y,I.z);var J=C[e.face1].normal;G.push(J.x,J.y,J.z);G.push(J.x,J.y,J.z);if(e.face2!==undefined){var K=C[e.face2].normal;H.push(K.x,K.y,K.z);H.push(K.x,K.y,K.z);}else{H.push(0,0,0);H.push(0,0,0);}}}this.setAttribute("position",new THREE.Float32BufferAttribute(F,3));this.setAttribute("normal1",new THREE.Float32BufferAttribute(G,3));this.setAttribute("normal2",new THREE.Float32BufferAttribute(H,3));}
O.prototype=Object.create(THREE.BufferGeometry.prototype);O.prototype.constructor=O;
function k(b){return(b===null)||(b.min.x>=b.max.x&&b.min.y>=b.max.y&&b.min.z>=b.max.z);}
function n(a){var b=null;if(a.isMesh&&a.geometry&&!k(a.geometry.boundingBox)&&(a.layers!==a.parent.layers)){b=a.geometry;if(b.isBufferGeometry){b=new THREE.Geometry().fromBufferGeometry(b);}}for(var i=0,l=a.children.length;i<l;i++){var e=a.children[i];if(e.isMesh&&e.geometry&&!k(e.geometry.boundingBox)&&e.layers===a.layers){if(b===null){b=new THREE.Geometry();}var j=e.geometry;if(j.isBufferGeometry){j=new THREE.Geometry().fromBufferGeometry(j);}b.merge(j,e.matrix);}}return b;}
function o(a,b){var u=a.userData;if(u.defaultMaterial===undefined){u.defaultMaterial=u.originalMaterial||a.material;}a.material=b;u.originalMaterial=null;a._vkUpdateMaterialColor();a._vkUpdateMaterialOpacity();}
function r(a){var u=a.userData;if(u.defaultMaterial){a.material=u.defaultMaterial;delete u.defaultMaterial;u.originalMaterial=null;a._vkUpdateMaterialColor();a._vkUpdateMaterialOpacity();}}
c.prototype._createOutlineGeometry=function(a){if(this._scene){this._scene._vkTraverseMeshNodes(function(b){if(b.isOutline){b.visible=true;}else{if(!b.hasOutline){var e;try{e=n(b);}catch(i){e=null;}if(e!==null){b.hasOutline=true;var j=new O(e);j.boundingBox=new THREE.Box3();var l=new THREE.LineSegments(j,this._outlineMaterial);l.isOutline=true;l.renderOrder=b.renderOrder+0.5;l.layers=b.layers;b.add(l);}}if(b.isMesh&&b.material&&!b.material.isLineBasicMaterial&&!b.material.isLineMaterial){switch(a){case R.LineIllustration:o(b,this._solidWhiteMaterial);break;case R.ShadedIllustration:var t=(b.userData.defaultMaterial||b.userData.originalMaterial||b.material).clone();if(t.emissive){t.color.multiplyScalar(0.5);t.emissive.multiplyScalar(0.5).addScalar(0.5);}else{t.color.multiplyScalar(0.5).addScalar(0.5);}o(b,t);break;default:r(b);break;}}}}.bind(this));}};
c.prototype._hideOutlineGeometry=function(){if(this._scene){this._scene._vkTraverseMeshNodes(function(a){if(a.isOutline){a.visible=false;}if(a.isMesh){r(a);}});}};
c.prototype.getInitialView=function(){return this._initialView;};
c.prototype.setInitialView=function(v){this._initialView=v;};
c.prototype.getMaterial=function(a){return this._materialMap.get(a);};
c.prototype.setMaterial=function(a,b){this._materialMap.set(a,b);};
c.prototype.clearMaterials=function(){this._materialMap.clear();};
c.prototype._getNativeMaterial=function(a){var b=a?this._materialMap.get(a):null;return b?b.getMaterialRef():null;};
c.prototype._setNodeMaterial=function(a,b){var e=this._getNativeMaterial(b);a.children.forEach(function(i){if(i.material){if(e){if(i.userData.materialId!==b){this._sceneBuilder._setSubmeshMaterial(i,e,b);}}else{var j=i.userData.initialMaterialId;if(j&&i.userData.materialId!==j){var l=this._getNativeMaterial(j);if(l){this._sceneBuilder._setSubmeshMaterial(i,l,j);}}}}}.bind(this));};
c.prototype._allocateLayersChannel=function(){for(var a=0;a<32;a++){if((this._layersMask&(1<<a|0))===0){this._layersMask|=(1<<a|0);return a;}}return-1;};
c.prototype._freeLayersChannel=function(a){this._layersMask&=~(1<<a|0);};
return c;});
sap.ui.predefine('sap/ui/vk/threejs/SceneBuilder',["jquery.sap.global","./thirdparty/three","sap/base/Log","./BBoxSubdivider","./UsageCounter","../totara/TotaraUtils","./OrthographicCamera","./PerspectiveCamera","./DetailView","./AnimationHelper","./Thrustline","../View","./Billboard","./Callout","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment","../LeaderLineMarkStyle","../DetailViewType","../DetailViewShape","../AnimationPlayback","../AnimationRotateType","../RenderMode","./Material","../ObjectType","../getResourceBundle","./MarchingCubes","../NodeContentType","./ThreeExtensions","../thirdparty/ie-polyfills","sap/base/util/uid"],function(q,t,L,B,U,T,O,P,D,A,a,V,b,C,c,d,f,g,h,n,o,p,r,s,R,M,u,v,w,N,x,y,z){"use strict";var S=function(e,i,j,k){this._id=S._nextId++;S._add(this);this._callouts=new Map();this._cameras=new Map();this._images=new Map();this._imageIdsAndTileWidths=new Map();this._imageTextures=new Map();this._geometries=new Map();this._meshNodes=new Map();this._meshSubmeshes=new Map();this._geometryMeshes=new Map();this._materialMeshes=new Map();this._materialClones=new Map();this._joints=[];this._annotations=new Map();if(e){this._rootNode=e;this._nodes=new Map();this._tracks=new Map();this._trackIdSequenceNodeMap=new Map();this._viewGroups=new Map();this._views=new Map();}else{this._rootNode=null;this._nodes=null;this._tracks=null;this._trackIdSequenceNodeMap=null;this._viewGroups=null;this._views=null;}this._currentSceneId=null;this._sceneIdTreeNodesMap=new Map();this._sceneIdRootNodeMap=new Map();this._sceneIdViewGroupMap=new Map();this._sceneIdViewMap=new Map();this._animationHelper=new A(this);if(i){this._countentResource=i;var l=i.getNodeProxy();var m=l.getNodeHierarchy();this._vkScene=m.getScene();var l1=i.getSource();if(l1&&l1.name){this._sceneIdTreeNodesMap.set(l1.name,this._nodes);this._sceneIdRootNodeMap.set(l1.name,e);this._sceneIdViewGroupMap.set(l1.name,this._viewGroups);this._sceneIdViewMap.set(l1.name,this._views);this._currentSceneId=l1.name;}if(this._rootNode){if(!this._rootNode.userData){this._rootNode.userData={};}this._rootNode.userData.skipIt=!i.name;}}this._viewThumbnails=new Map();this._thrustlines=new Map();this._animations=new Map();this._animationTracks=new Map();this._jointNodesMap=new Map();this._jointParentsMap=new Map();this._resolve=j;this._reject=k;};S._nextId=1;S._map=new Map();
S.prototype.getId=function(){return this._id;};
S.getById=function(i){return this._map.get(i);};
S._add=function(e){S._map.set(e.getId(),e);return this;};
var E=[R.Default,R.Default,R.Default,R.LineIllustration,R.SolidOutline,R.ShadedIllustration];
S.prototype.setScene=function(i){if(i.result!==1){var e={status:i.result};switch(i.result){case-1:e.errorText=v().getText("LOADER_FILENOTFOUND");break;case-2:e.errorText=v().getText("LOADER_WRONGFILEFORMAT");break;case-3:e.errorText=v().getText("LOADER_WRONGPASSWORD");break;case-4:e.errorText=v().getText("LOADER_ERRORREADINGFILE");break;case-5:e.errorText=v().getText("LOADER_FILECONTENT");break;default:e.errorText=v().getText("LOADER_UNKNOWNERROR");}this._reject(e);}else{this._vkScene.setSceneBuilder(this);var j=this._cameras.get(i.cameraId);this._resolve({node:this._parentNode,camera:j,backgroundTopColor:i.backgroundTopColor,backgroundBottomColor:i.backgroundBottomColor,upAxis:i.upAxis,annotations:this._annotations,contentResource:this._contentResource,builder:this});}};
S.prototype.setRootNode=function(e,i,j,k){this._rootNode=e;this._nodes=new Map();this._nodes.set(i,e);if(!this._rootNode.userData){this._rootNode.userData={};}this._tracks=new Map();this._trackIdSequenceNodeMap=new Map();this._sequenceIdToPlaybacks=new Map();this._viewGroups=new Map();this._views=new Map();if(j){this._sceneIdTreeNodesMap.set(j,this._nodes);this._sceneIdRootNodeMap.set(j,e);this._sceneIdViewGroupMap.set(j,this._viewGroups);this._sceneIdViewMap.set(j,this._views);this._currentSceneId=j;}if(k){this._vkScene=k;}return this;};
S.prototype._resetCurrentScene=function(e){if(e&&e!==this._currentSceneId){var i=this._sceneIdTreeNodesMap.get(e);if(i){this._nodes=i;}else{this._nodes=null;}var j=this._sceneIdRootNodeMap.get(e);if(j){this._rootNode=j;}else{this._rootNode=null;}this._currentSceneId=e;}};
S.prototype.getNode=function(e,i){if(i){this._resetCurrentScene(i);if(this._nodes){return this._nodes.get(e);}}else{var j=this._sceneIdTreeNodesMap.values();var k=j.next();while(!k.done){var l=k.value.get(e);if(l){return l;}k=j.next();}}return null;};
S.prototype.hasMesh=function(m){return this._meshSubmeshes.has(m);};
S.prototype.hasImage=function(i){return this._images.has(i);};
S.prototype.setNodePersistentId=function(e,i,j){if(!e.userData.treeNode){e.userData.treeNode={};}var k=null;if(e.userData.treeNode.sid){k=e.userData.treeNode.sid;delete(e.userData.treeNode.sid);}this._resetCurrentScene(j);e.userData.treeNode.sid=i;if(this._nodes){if(k){this._nodes.delete(k);}this._nodes.set(i,e);return true;}return false;};
S.prototype.setAnnotationPersistentId=function(e,i,j){this._resetCurrentScene(j);if(this._annotations){var k=this._annotations.get(e.id);if(k){this._annotations.delete(e.id);k.annotation.id=i;this._annotations.set(i,k);return true;}}return false;};
var F=function(e){var m=new THREE.Matrix4();if(e.length===3){m.setPosition(new THREE.Vector3().fromArray(e));}else if(e.length===12){m.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0.0,0.0,0.0,1.0);}else if(e.length===16){m.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]);}else{throw"Invalid matrix format";}return m;};var G={r:0.0235,g:0.0235,b:0.0235};var H={r:0.0602,g:0.0602,b:0.0602};
S.prototype._createTemporaryMaterial=function(m){var e=new M();var i=e.getMaterialRef();i.userData.defaultHighlightingEmissive=G;i.userData.defaultHighlightingSpecular=H;i.userData.materialUsed=0;i.userData.materialId=m;i.userData.toBeUpdated=true;this._vkScene.setMaterial(m,e);return i;};
S.prototype._getMaterialRef=function(m){var e=this._vkScene.getMaterial(m);return e?e.getMaterialRef():null;};
S.prototype.checkMaterialExists=function(m,e){if(this._getMaterialRef(m)===null){if(e){this._createTemporaryMaterial(m);}return false;}return true;};
S.prototype._attachMaterialClone=function(m,e){T.pushElementIntoMapArray(this._materialClones,m,e);};
S.prototype._addDynamicObject=function(e,i,j){var k=this._rootNode.userData;if(!k._vkDynamicObjects){k._vkDynamicObjects=[];}if(k._vkDynamicObjects.indexOf(e)<0){k._vkDynamicObjects.push(e);}e._vkUpdate=i;if(j){e.userData.is2D=true;}};
S.prototype.createNode=function(e,j){this._resetCurrentScene(j);var k=new THREE.Group();this._nodes.set(e.sid,k);var i;var l=this._jointNodesMap.get(e.sid);if(l&&l.length){for(i=0;i<l.length;i++){l[i].node=k;}}var m=this._jointParentsMap.get(e.sid);if(m&&m.length){for(i=0;i<m.length;i++){m[i].parent=k;}}var l1=this._nodes.get(e.parentId);(l1||this._rootNode).add(k);var m1=k.userData;m1.treeNode=e;if(e.closed){m1.closed=true;}if(e.selectable===false){m1.selectable=false;}if(e.visualisable===false){m1.skipIt=true;}if(e.metadata){m1.metadata=e.metadata;}if(e.veids){m1.veids=e.veids;}if(e.sid){m1.nodeId=e.sid;}if(e.name){k.name=e.name;}if(e.visible!==undefined){k.layers.mask=e.visible?(1|0):0;}if(l1&&l1.name&&k.name&&k.name===l1.name+" offset geometry"){k.layers=l1.layers;}else{var n1=l1;while(n1){if(n1.userData.closed){k.layers=n1.layers;break;}n1=n1.parent;}}if(j){var o1=l1;while(o1){if((o1.layers.mask&1)===0){k.layers.mask&=~1;break;}o1=o1.parent;}}if(e.renderOrder){k.renderOrder=e.renderOrder;}m1.opacity=e.opacity;if(e.transform){k.applyMatrix(F(e.transform));if(!isFinite(k.quaternion.x)||!isFinite(k.quaternion.y)||!isFinite(k.quaternion.z)||!isFinite(k.quaternion.w)){k.quaternion.set(0,0,0,1);}}k.updateMatrixWorld(true);if(e.transformType){m1.transformType=e.transformType;switch(e.transformType){case"ORTHO2D":m1.originalTransform={p:k.position.clone(),q:k.quaternion.clone(),s:k.scale.clone()};this._addDynamicObject(k,b.prototype._ortho2DUpdate,true);break;case"BILLBOARD_VIEW":this._addDynamicObject(k,b.prototype._billboardViewUpdate,false);break;case"LOCK_TOVIEWPORT":this._addDynamicObject(k,b.prototype._lockToViewportUpdate,true);break;default:break;}}if(e.materialId){m1.materialId=e.materialId;}if(e.meshId){this.setMeshNode(e.sid,e.meshId);}if(k.parent.userData.objectType===u.Hotspot){m1.objectType=u.Hotspot;}else if(k.parent.userData.objectType===u.PMI){m1.objectType=u.PMI;}else if(e.contentType==="HOTSPOT"){m1.objectType=u.Hotspot;}else if(e.contentType==="PMI"){m1.objectType=u.PMI;}if(e.contentType==="REFERENCE"){k._vkSetNodeContentType(N.Reference);}else if(e.contentType==="ANNOTATION"){k._vkSetNodeContentType(N.Annotation);}return k;};
S.prototype.removeNode=function(e){this._nodes.delete(e._vkPersistentId());this._annotations.forEach(function(i){if(i.node===e){this._annotations.delete(i.annotation.id);}}.bind(this));};
function I(e,m,l){var i;if(e.isPolyline){var j=new THREE.LineBasicMaterial({color:0xff0000,linewidth:1});if(m){j.color.copy(m.color);}i=new THREE.LineSegments(e,j);}else{i=new THREE.Mesh(e,m);}if(e.isPositionQuantized){Q(i,l.boundingBox);}U.increaseGeometryUsed(e);return i;}
S.prototype.getChildNodeIds=function(e,j,k){this._resetCurrentScene(j);var l=this._nodes.get(e);var m=[];if(!l){return m;}if(l&&l.children){for(var i=0;i<l.children.length;i++){var l1=l.children[i];if(l1.userData.treeNode&&l1.userData.treeNode.sid){m.push(l1.userData.treeNode.sid);}else if(k&&l1.userData.submeshInfo&&l1.userData.submeshInfo.id){m.push(l1.userData.submeshInfo.id);}}}return m;};
function J(l){for(var i=0;i<l.length;i++){if(l[i].type==="box"&&l[i].data){return l[i];}}return null;}
function K(l){if(Array.isArray(l)){for(var i=0;i<l.length;i++){if(l[i].type===undefined||l[i].type==="mesh"||l[i].type==="line"){return l[i];}}}return null;}
function Q(m,e){if(e&&e.length===6){m.position.set((e[3]+e[0])*0.5,(e[4]+e[1])*0.5,(e[5]+e[2])*0.5);m.scale.set(Math.max(e[3]-e[0],Number.EPSILON),Math.max(e[4]-e[1],Number.EPSILON),Math.max(e[5]-e[2],Number.EPSILON));}}
S.prototype.insertSubmesh=function(e){var m=this._getMaterialRef(e.materialId)||this._createTemporaryMaterial(e.materialId);var i,j;if(e.lods){var l=K(e.lods);if(!l){return false;}j=this._geometries.get(l.id);if(j){i=I(j,m,l);if(j.userData&&j.userData.noNormal&&e.materialId){this.updateMaterialForGeometryWithoutNormal(e.materialId);}}else{var k;var l1=J(e.lods);if(l1&&l1.data){var m1=T.base64ToUint8Array(l1.data);var n1=B.unpackSubDividedBoundingBox(m1);k=w.march(n1);}i=new THREE.Mesh(k?k:new THREE.BoxBufferGeometry(1,1,1),m);var o1=l.boundingBox;if(o1&&o1.length===6){var p1=new THREE.Matrix4();p1.scale(new THREE.Vector3(Math.max(o1[3]-o1[0],Number.EPSILON),Math.max(o1[4]-o1[1],Number.EPSILON),Math.max(o1[5]-o1[2],Number.EPSILON)));p1.setPosition(new THREE.Vector3((o1[3]+o1[0])*0.5,(o1[4]+o1[1])*0.5,(o1[5]+o1[2])*0.5));i.geometry.applyMatrix(p1);}i.userData.geometryId=l.id;i.userData.lodInfo=l;T.pushElementIntoMapArray(this._geometryMeshes,l.id,e.meshId);}}else{return false;}if(e.transform){i.applyMatrix(F(e.transform));}i.userData.submeshId=e.id;i.userData.initialMaterialId=e.materialId;i.userData.meshId=e.meshId;i.userData.materialId=e.materialId;i.userData.submeshInfo=e;T.pushElementIntoMapArray(this._materialMeshes,e.materialId,e.meshId);T.pushElementIntoMapArray(this._meshSubmeshes,e.meshId,i);var q1=this._meshNodes.get(e.meshId);if(q1){q1.forEach(function(r1){var s1=i.clone();s1.layers=r1.layers;if(r1.userData.materialId){s1.material=this._getMaterialRef(r1.userData.materialId)||i.material;}r1.add(s1);X(r1,e.materialId,this._materialClones);}.bind(this));}return true;};
function W(e,j,k,m){for(var i=0;i<e.length;i++){var l=e[i];if(j&&l.userData.geometryId===j&&l.geometry!==k){if(l.type==="Mesh"&&!k.isPolyline){l.geometry=k;if(k.isPositionQuantized){Q(l,l.userData.lodInfo.boundingBox);}U.increaseGeometryUsed(k);}else{var l1=I(k,l.material,l.userData.lodInfo);l1.userData=l.userData;l1.layers=l.layers;l1.parent=l.parent;e[i]=l1;l.parent=null;}}}}
S.prototype._setSubmeshMaterial=function(e,m,i){U.increaseMaterialUsed(m);e.material=m;e.userData.materialId=i;delete e.userData.originalMaterial;e._vkUpdateMaterialOpacity();if(e.material!==m){T.pushElementIntoMapArray(this._materialClones,i,e.material);}};
S.prototype._updateMaterial=function(e,m,i){e.children.forEach(function(j){if(j.material&&j.userData.materialId===m){this._setSubmeshMaterial(j,i,m);}}.bind(this));};
function X(e,m,i){e.children.forEach(function(j){if(j.material&&(!m||m===j.material.userData.materialId)){var k=j.material;j._vkUpdateMaterialOpacity();if(j.material!==k){T.pushElementIntoMapArray(i,j.material.userData.materialId,j.material);}}});}
function Y(e,l){var m=new Float32Array(e.length);var p0=new THREE.Vector3();var p1=new THREE.Vector3();var p2=new THREE.Vector3();var l1=new THREE.Vector3();var i,m1;for(i=0,m1=l.length;i<m1;i+=3){var pi=[l[i]*3,l[i+1]*3,l[i+2]*3];p0.fromArray(e,pi[0]);p1.fromArray(e,pi[1]).sub(p0);p2.fromArray(e,pi[2]).sub(p0);l1.crossVectors(p1,p2).normalize();for(var j=0;j<3;j++){var k=pi[j];m[k]+=l1.x;m[k+1]+=l1.y;m[k+2]+=l1.z;}}for(i=0,m1=m.length;i<m1;i+=3){l1.fromArray(m,i).normalize().toArray(m,i);}return m;}
S.prototype.setGeometry=function(e){var i=new THREE.BufferGeometry();var j=e.data;var k=new THREE.BufferAttribute(new Uint16Array(j.indices),1);var l=new THREE.BufferAttribute(new Float32Array(j.points),3);i.setIndex(k);i.setAttribute("position",l);if(!e.isPolyline){if(!j.normals||j.normals.length!==l.array){j.normals=Y(l.array,k.array);}var m=new THREE.BufferAttribute(new Float32Array(j.normals),3);i.setAttribute("normal",m);if(j.uvs&&j.uvs.length*3===j.points.length*2){i.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(e.data.uvs),2));}}else{i.isPolyline=true;}i.computeBoundingBox();i.computeBoundingSphere();i.isPositionQuantized=e.isPositionQuantized;i.userData.geometryId=e.id;i.userData.geometryUsed=0;this._geometries.set(e.id,i);var l1=this._geometryMeshes.get(e.id);if(l1){for(var mi=0;mi<l1.length;mi++){var n1=l1[mi];var o1=this._meshNodes.get(n1);if(o1){for(var ni=0;ni<o1.length;ni++){W(o1[ni].children,e.id,i);}}var q1=this._meshSubmeshes.get(n1);if(q1){W(q1,e.id,i);}}}if(this._fireSceneUpdated){this._fireSceneUpdated();}return this;};
S.prototype.setMeshNode=function(e,m){var i=this._nodes.get(e);if(i){T.pushElementIntoMapArray(this._meshNodes,m,i);var j=this._meshSubmeshes.get(m);if(j){j.forEach(function(k){var l=k.clone();l.layers=i.layers;if(i.userData.materialId){l.material=this._getMaterialRef(i.userData.materialId)||k.material;}i.add(l);}.bind(this));X(i,null,this._materialClones);}}};
S.prototype.progress=function(e){L.log("reading progress:",e);};
S.prototype.loadingFinished=function(i){if(this._fireLoadingFinished){this._fireLoadingFinished(i);}};
S.prototype.getGeometry=function(e){return this._geometries.get(e);};
var Z={rect:f.RectangularShape,circle:f.CircularShape,none:f.None,textGlow:f.TextGlow};var $={none:g.None,solid:g.Solid,dash:g.Dash,dot:g.Dot,dashdot:g.DashDot,dashdotdot:g.DashDotDot};var _={left:h.Left,center:h.Center,right:h.Right};var a1={none:n.None,point:n.Point,arrow:n.Arrow};var b1=new THREE.Color();
S.prototype.createAnnotation=function(e,i){this._resetCurrentScene(i);var j=this._nodes.get(e.nodeId);if(!j){L.warning("Annotation node not found",e);return;}var k=e.type;if(k===undefined){this.createLegacyAnnotation(e,j);return;}if(k==="html"){e.id=e.id||z();var l=[];if(e.leaderLines){e.leaderLines.forEach(function(t1){if(t1.start&&t1.start.sid){l.push(this._nodes.get(t1.start.sid));}},this);}this._annotations.set(e.id,{annotation:e,node:this._nodes.get(e.nodeId),attachment:(e.attachment&&e.attachment.sid)?this._nodes.get(e.attachment.sid):null,targetNodes:l});return;}var m=e.label||{};var l1=e.text||{};var m1=m.colour||[1,1,1,1];var n1=m.borderColour||[0,0,0,1];var o1={node:j,renderOrder:j.renderOrder||0,style:Z[m.shape]||f.RectangularShape,width:m.width||64,height:m.height||64,backgroundColor:b1.fromArray(m1).getStyle(),backgroundOpacity:m1[3],borderColor:b1.fromArray(n1).getStyle(),borderOpacity:n1[3],borderWidth:m.borderColour?(m.borderWidth||0):0,borderLineStyle:$[m.borderLineStyle]||g.Solid,horizontalAlignment:_[l1.align]};if(l1.html){o1.encoding=d.HtmlText;o1.text=l1.html;}else{o1.encoding=d.PlainText;o1.text=l1.text;o1.font=l1.fontFace||"Arial";o1.fontSize=Math.abs(l1.fontSize)||16;o1.fontWeight=Math.min(l1.fontWeight,900);o1.fontItalic=l1.fontItalic;o1.textColor=b1.fromArray(l1.colour||[0,0,0]).getStyle();}if(k==="text"){var p1=j.position;o1.position=new THREE.Vector3(p1.x*2,p1.y*2,p1.z);var q1=new b(o1);q1.setText(o1.text);this._addDynamicObject(j,q1._update.bind(q1),true);}else if(k==="note"){var r1=e.attachment||{};o1.position=new THREE.Vector3().fromArray(r1.position||[0,0,0]);o1.anchorNode=this._nodes.get(r1.sid)||this._rootNode;o1.depthTest=false;var s1=new C(o1);s1.setText(o1.text);this._callouts.set(e.id,s1);this._addDynamicObject(j,s1._update.bind(s1),false);}else{L.warning("Unsupported annotation type",e);}};
var c1=[f.RectangularShape,f.CircularShape,f.None,f.TextGlow];var d1=[c.Viewport,c.Screen,c.World];var e1=[g.None,g.Solid,g.Dash,g.Dot,g.DashDot,g.DashDotDot];var f1=[n.None,n.Point,n.Arrow];var g1=[h.Left,h.Center,h.Right];
function h1(e){var i=e.toString(16);if(e.length>=3){i=(((e[0]*255)<<16)|((e[1]*255)<<8)|(e[2]*255)).toString(16);}return"#"+"000000".substring(i.length)+i;}
function i1(e){if(!e){return false;}for(var i=0,l=e.length;i<l;i++){if(!isFinite(e[i])){return false;}}return true;}
S.prototype.createLegacyAnnotation=function(e,i){var j=e.position;if(!i1(j)){L.warning("Incorrect annotation position",e);return;}e.coordinateSpace|=0;var k=e.backgroundOpacity;if(!k){k=e.backgroundColour?e.backgroundColour[3]:0;}var l=e.borderOpacity;if(!l){l=e.borderColour?e.borderColour[3]:0;}var m={node:i,coordinateSpace:d1[e.coordinateSpace],style:c1[e.shape||0],width:e.width,height:e.height,backgroundColor:e.backgroundColour?h1(e.backgroundColour):"#fff",backgroundOpacity:k,borderColor:e.borderColour?h1(e.borderColour):"#000",borderOpacity:l,borderWidth:e.borderWidth,borderLineStyle:e1[e.borderLineStyle]};if(e.encoding!==undefined){m.encoding=e.encoding?d.HtmlText:d.PlainText;m.font=e.font;m.fontSize=e.fontSize;m.fontWeight=Math.min(e.fontWeight,900);m.fontItalic=e.fontItalic;m.textColor=h1(e.textColor);m.link=e.link;m.horizontalAlignment=g1[e.textHorizontalAlignment];m.position=new THREE.Vector3().fromArray(j);}else if(e.fontFace){m.encoding=d.PlainText;m.font=e.fontFace;m.fontSize=Math.abs(e.fontSize);m.fontWeight=Math.min(e.fontWeight,900);m.textColor=h1(e.textColour);}else{m.encoding=d.HtmlText;}if(e.coordinateSpace<2){if(!m.positions){m.position=new THREE.Vector3(j[0]*2-1,j[1]*-2+1,j[2]);}m.renderOrder=(e.order|0)+1000;var l1=new b(m);l1.setText(e.text);this._addDynamicObject(i,l1._update.bind(l1),true);}else{m.anchorNode=this._nodes.get(e.sid)||this._rootNode;if(!m.postion){m.position=new THREE.Vector3().fromArray(j);}m.depthTest=false;m.renderOrder=e.order|0;if(e.alwaysOnTop){m.renderOrder=1;}var m1=new C(m);m1.setText(e.text);this._callouts.set(e.id,m1);this._addDynamicObject(i,m1._update.bind(m1),false);}};
S.prototype.createImageNote=function(e,i){this._resetCurrentScene(i);var j=this._nodes.get(e.nodeId);if(!j){L.warning("Image annotation node not found",e);return;}if(e.type==="image"){var l=e.label||{};var m=this._getMaterialRef(l.materialId);if(!m){L.warning("Image annotation material not found",e);return;}var k=new b({node:j,renderOrder:j.renderOrder||0,coordinateSpace:c.Screen,position:new THREE.Vector3(j.position.x,j.position.y,0),width:(l.width||200)*j.scale.x*0.5,height:(l.height||200)*j.scale.y*0.5});j.position.setScalar(0);j.scale.setScalar(1);k.setMaterial(m);this._addDynamicObject(j,k._update.bind(k),true);}else{this.createLegacyImageNote(e,j);}};
S.prototype.createLegacyImageNote=function(e,i){var j=new THREE.Vector3().fromArray(e.position);var k=e.width;var l=e.height;if(!e.properlyAligned){j.x+=e.width*0.5;j.y+=e.height*0.5;j.applyMatrix4(i.matrix);k=e.width*0.5*i.matrix.elements[0];l=e.height*0.5*i.matrix.elements[5];}var m=new b({node:i,coordinateSpace:c.Screen,renderOrder:(e.order|0)+1000,position:j,width:k,height:l});var l1=this._getMaterialRef(e.labelMaterialId);m.setMaterial(l1);this._addDynamicObject(i,m._update.bind(m),true);};
S.prototype.insertLeaderLine=function(e,j){this._resetCurrentScene(j);var k=this._callouts.get(e.annotationId);if(k){var m=this._getMaterialRef(e.materialId);if(!m){L.warning("Leader line material not found",e);return;}var l1=[];var m1=e.points;for(var i=0,l=m1.length;i<l;i++){l1.push(new THREE.Vector3().fromArray(m1[i]));}var n1;if(e.start){var o1=e.start||{};var p1=e.end||{};var q1=e.extension||{};n1=this._nodes.get(e.start.sid)||this._rootNode;k.addLeaderLine(l1,n1,m,a1[o1.style]||n.None,a1[p1.style]||n.None,o1.size,q1.length||0);}else{n1=this._nodes.get(e.startPointSid)||this._rootNode;k.addLeaderLine(l1,n1,m,f1[e.startPointHeadStyle],f1[e.endPointHeadStyle],e.pointHeadConstant,e.extensionLength);}}};
S.prototype._findDetailViewNodes=function(e){var i=[];if(e){e.forEach(function(j){var k=this._nodes.get(j);if(k){i.push(k);}else{L.warning("Unknown detailView node reference",j);}}.bind(this));}return i;};
S.prototype.createDetailView=function(i,e){this._resetCurrentScene(e);var j=this._nodes.get(i.nodeId);if(!j){L.warning("Detail view node not found",i);return;}var l=i.label;if(!l){this.createLegacyDetailView(i,j);return;}var k=i.attachment;var m={name:i.name,camera:l.camera?this.createCamera(l.camera):null,type:i.cutaway?o.Cutaway:o.DetailView,borderWidth:l.borderWidth||0,backgroundColor:b1.fromArray(l.colour||[1,1,1]).getStyle(),borderColor:b1.fromArray(l.borderColour||[1,1,1]).getStyle(),origin:new THREE.Vector2(j.position.x*2-1+j.scale.x,j.position.y*-2+1-j.scale.x),size:new THREE.Vector2(j.scale.x,j.scale.y),attachmentPoint:new THREE.Vector3().fromArray(k.position||[0,0,0]),veId:i.veid,visibleNodes:this._findDetailViewNodes(i.visibleNodes),targetNodes:this._findDetailViewNodes(i.targetNodes)};if(l.shape==="rect"){m.shape=!l.leaderStyle||l.leaderStyle==="none"?p.Box:p.BoxLine;}else{m.shape={none:p.Circle,line:p.CircleLine,pointer:p.CirclePointer,arrow:p.CircleArrow,bubbles:p.CircleBubbles}[l.leaderStyle]||p.Circle;}var l1=new D(m);if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[];}this._rootNode.userData._vkDetailViews.push({detailView:l1,node:j,renderOrder:i.renderOrder||j.renderOrder||0});};
S.prototype.createLegacyDetailView=function(i,e){if(!i.properlyAligned){if(!i.shape){i.shape=i.leaderStyle?p.BoxLine:p.Box;}else{i.shape=[p.Circle,p.CircleLine,p.CirclePointer,p.CircleArrow,p.CircleBubbles][i.leaderStyle||0];}i.type=i.cutaway?o.Cutaway:o.DetailView;i.camera=i.camera?this.createCamera(i.camera):null;i.origin=new THREE.Vector2(e.position.x*2-1+e.scale.x,e.position.y*-2+1-e.scale.x);i.size=new THREE.Vector2(e.scale.x,e.scale.y);i.renderOrder=e.renderOrder;}else{i.type=[o.DetailView,o.Cutaway][i.type];i.shape=[p.Box,p.Circle,p.CircleLine,p.CirclePointer,p.CircleArrow,p.CircleBubbles,p.BoxLine,p.BoxNoOutline,p.SolidPointer,p.SolidArrow][i.shape];i.camera=this._cameras.get(i.cameraId);i.origin=new THREE.Vector2().fromArray(i.origin);i.size=new THREE.Vector2().fromArray(i.size);}var j=new D({name:i.name,camera:i.camera,type:i.type,shape:i.shape,borderWidth:i.borderWidth||0,backgroundColor:i.backgroundColour?h1(i.backgroundColour):"#fff",borderColor:i.borderColour?h1(i.borderColour):"#000",origin:i.origin,size:i.size,attachmentPoint:new THREE.Vector3().fromArray(i.attachment),metadata:i.metadata,veId:i.veid,visibleNodes:this._findDetailViewNodes(i.visibleNodes),targetNodes:this._findDetailViewNodes(i.targetNodes)});if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[];}this._rootNode.userData._vkDetailViews.push({detailView:j,node:e,renderOrder:i.renderOrder||0});};
S.prototype.insertThrustline=function(i){var e=this._nodes.get(i.thrustlineId);if(e&&!this._thrustlines.get(i.thrustlineId)){var j=new a({node:e,principleAxis:new THREE.Vector3().fromArray(i.principleAxis),material:this._getMaterialRef(i.materialId)});var k=[];var l=0;var m=0;var l1=0;for(var ii=0;ii<i.itemCount;ii++){var n1={};n1.target=this._nodes.get(i.targets[ii]);n1.majorAxisIndex=i.itemMajorAxisesIndices[ii];var bi;n1.basisAxises=[];l1=l+i.itemBasisAxisesCounts[ii];for(bi=l;bi<l1;bi++){var p1={};p1.x=i.itemBasisAxisesCoordinates[bi*3];p1.y=i.itemBasisAxisesCoordinates[bi*3+1];p1.z=i.itemBasisAxisesCoordinates[bi*3+2];n1.basisAxises.push(p1);}l=l1;n1.dimension={};n1.dimension.x=i.itemDimensionsCoordinates[ii*3];n1.dimension.y=i.itemDimensionsCoordinates[ii*3+1];n1.dimension.z=i.itemDimensionsCoordinates[ii*3+2];n1.center={};n1.center.x=i.itemCentersCoordinates[ii*3];n1.center.y=i.itemCentersCoordinates[ii*3+1];n1.center.z=i.itemCentersCoordinates[ii*3+2];n1.boundPoints=[];l1=m+i.itemBoundPointsCounts[ii];for(bi=m;bi<l1;bi++){var q1={};q1.x=i.itemBoundPointsCoordinates[bi*3];q1.y=i.itemBoundPointsCoordinates[bi*3+1];q1.z=i.itemBoundPointsCoordinates[bi*3+2];n1.boundPoints.push(q1);}m=l1;k.push(n1);}j.setItems(k);var r1=0;var s1=[];for(var si=0;si<i.segmentCount;si++){var u1={};u1.startItemIndex=i.segmentsStartItemIndices[si];u1.endItemIndex=i.segmentsEndItemIndices[si];u1.startBoundIndex=i.segmentsStartBoundIndices[si];u1.endBoundIndex=i.segmentsEndBoundIndices[si];u1.ratios=[];l1=r1+i.segmentRatioCounts[si];for(var ri=0;ri<l1;ri++){var w1={};w1.x=i.segmentRatiosCoordinates[ri*2];w1.y=i.segmentRatiosCoordinates[ri*2+1];u1.ratios.push(w1);}r1=l1;s1.push(u1);}j.setSegments(s1);this._thrustlines.set(i.thrustlineId,j);this._addDynamicObject(e,j._update.bind(j),false);}};
S.prototype.updateViewsForReplacedNodes=function(e){var i=new Map();e.forEach(function(l){var m=this._nodes.get(l.sid);if(m){i.set(l.sid,m);}},this);function j(l,i){var e=l.getNodeInfos();e.forEach(function(m){var l1=m.target;if(l1&&l1.userData&&l1.userData.treeNode&&l1.userData.treeNode.sid){var m1=i.get(l1.userData.treeNode.sid);if(m1){m.target=m1;m1.updateMatrixWorld();}}});}function k(l,i){var m;var l1=l.getPlaybacks();for(var pi=0;pi<l1.length;pi++){var n1=l1[pi];var o1=n1.getSequence();if(o1){var p1=false;var q1=o1.getNodeAnimation();for(var ni=0;ni<q1.length;ni++){var s1=q1[ni];var t1=s1.nodeRef;if(t1&&t1.userData&&t1.userData.treeNode&&t1.userData.treeNode.sid){m=i.get(t1.userData.treeNode.sid);if(m){o1.removeNodeAnimation(t1,null,true);for(var u1 in s1){if(u1==="nodeRef"){continue;}o1.setNodeAnimation(m,u1,s1[u1],true);}p1=true;}}}var v1=o1.getJoint();for(var ji=0;v1&&ji<v1.length;ji++){var x1=v1[ji];if(x1.parentSid){m=i.get(x1.parentSid);if(m){x1.parent=m;p1=true;}}if(x1.nodeSid){m=i.get(x1.nodeSid);if(m){x1.node=m;p1=true;}}}if(p1){o1._fireSequenceChanged();}}}e.forEach(function(m1){var r1=m1.target;if(r1&&r1.userData&&r1.userData.treeNode&&r1.userData.treeNode.sid){var m=i.get(r1.userData.treeNode.sid);if(m){m1.target=m;m.updateMatrixWorld();}}});}this._views.forEach(function(l,m){j(l,i);k(l,i);});};
S.prototype._decrementResourceCounters=function(e){e.traverse(function(i){if(i.isMesh){U.decreaseMaterialUsed(i.material);U.decreaseGeometryUsed(i.geometry);}});};
S.prototype.decrementResourceCountersForDeletedTreeNode=function(e,i){this._resetCurrentScene(i);var j=this;e=[].concat(e);e.forEach(function(k){var l=j._nodes.get(k);if(l){j._decrementResourceCounters(l);j._nodes.delete(k);}});return this;};
S.prototype.remove=function(e,j){this._resetCurrentScene(j);var k=this;e=[].concat(e);e.forEach(function(l){var m=k._nodes.get(l);if(m){k._decrementResourceCounters(m);if(m.parent){m.parent.remove(m);}k._nodes.delete(l);for(var i=0;i<m.children.length;i++){var l1=m.children[i];if(l1.userData&&l1.userData.treeNode&&l1.userData.treeNode.sid){k.remove(l1.userData.treeNode.sid,j);}}}});return this;};
S.prototype.resourcesCleanUp=function(){var e=this._geometries;e.forEach(function(i){var j=i.userData.geometryUsed;if(j<=0){i.dispose();}});return this;};
S.prototype.createCamera=function(e,i){this._resetCurrentScene(i);var j=e.near||1;var k=e.far||200000;var l;if(e.ortho){l=new THREE.OrthographicCamera(-1,1,1,-1,j,k);l.zoom=e.zoom||-1;}else{l=new THREE.PerspectiveCamera(THREE.Math.radToDeg(e.fov),1,j,k);}if(e.origin){l.position.fromArray(e.origin);}if(e.up){l.up.fromArray(e.up);if(e.notUseDirectionVector){l.up.sub(l.position);}l.up.normalize();}if(e.target){var m=new THREE.Vector3().fromArray(e.target);if(!e.notUseDirectionVector){m.add(l.position);}l.lookAt(m);}this._rootNode.userData.camera=l;var l1=null;if(l.isOrthographicCamera){l1=new O();}else if(l.isPerspectiveCamera){l1=new P();}l1.setCameraRef(l);l1.setUsingDefaultClipPlanes(true);var m1=e.id;if(m1){this._cameras.set(m1,l1);}this._rootNode.userData.camera=l1;return l1;};
S.prototype.insertCamera=function(e,i,j){this._resetCurrentScene(j);var k=this._nodes.get(e);var l=this._cameras.get(i);if(k&&l){(k||this._rootNode).add(l.parent?l.clone():l);}return this;};
S.prototype.getCamera=function(e){return this._cameras.get(e);};
S.prototype.updateMaterialForGeometryWithoutNormal=function(m){var e=this._getMaterialRef(m);if(e&&e.emissive){e.emissive.copy(e.color);e.side=THREE.DoubleSide;}return this;};
S.prototype.createMaterial=function(m){var e=[];var i=m.id;var j=this._getMaterialRef(i);if(m.lineWidth>0){if(!j||!j.isLineBasicMaterial){j=new THREE.LineBasicMaterial();var k=new M(true);k.setMaterialRef(j);this._vkScene.setMaterial(i,k);}j.color=new THREE.Color(m.lineColour[0],m.lineColour[1],m.lineColour[2]);j.linewidth=m.lineWidth;j.userData.lineStyle={width:m.lineWidth,haloWidth:m.lineHaloWidth||0,endCapStyle:m.lineEndRound?1:0,dashPattern:m.lineDashPattern||[],dashPatternScale:m.lineDashPatternScale,widthCoordinateSpace:m.lineWidthCoordinateSpace};j.userData.materialInfo=m;j.userData.materialId=i;return e;}if(!j){j=this._createTemporaryMaterial(i);}delete j.userData.toBeUpdated;j.userData.materialInfo=m;if(m.diffuseColour){j.color.fromArray(m.diffuseColour);}if(m.specularColour){j.specular.fromArray(m.specularColour);}var l=true;if(m.emissiveColour){j.emissive.fromArray(m.emissiveColour);if(j.emissive.r!==0||j.emissive.g!==0||j.emissive.b!==0){l=false;j.depthFunc=THREE.LessDepth;}}if(l&&m.ambientColour){j.emissive.fromArray(m.ambientColour);j.emissive.multiplyScalar(0.2);}if(j.opacity!==undefined){j.opacity=m.opacity;j.transparent=m.opacity<0.99;if(j.transparent){j.side=THREE.DoubleSide;}}var l1=j.glossiness?j.glossiness:0;var m1=j.specularLevel?j.specularLevel:0;j.shininess=l1*2+m1*3;j.userData.defaultHighlightingEmissive=G;j.userData.defaultHighlightingSpecular=H;e=this.updateTextureMaps(i);if(e.length>0){j.userData.imageIdsToLoad=new Set();for(var ti=0;ti<e.length;ti++){var o1=e[ti];T.pushElementIntoMapArray(this._imageTextures,o1.imageId,{textureType:o1.textureType,materialId:i});j.userData.imageIdsToLoad.add(o1.imageId);}}var p1=this._materialMeshes.get(i);if(p1){for(var mi=0;mi<p1.length;mi++){var r1=p1[mi];var s1=this._meshNodes.get(r1);if(s1){for(var ni=0;ni<s1.length;ni++){this._updateMaterial(s1[ni],i,j);}}}}return e;};
S.prototype.getMaterial=function(m){return this._getMaterialRef(m);};
var j1=function(i){var j="";try{var k=0x8000;var l=0;var m=i.length;var l1;while(l<m){l1=i.slice(l,Math.min(l+k,m));j+=String.fromCharCode.apply(null,l1);l+=k;}}catch(e){j="";}return j;};
S.prototype.createImage=function(e){var j=new DataView(e.binaryData.buffer);var k=true;if(j.getUint8(0,true)===parseInt("0xFF",16)&&j.getUint8(1,true)===parseInt("0xD8",16)){k=false;}var l=j1(e.binaryData);var m="data:image/"+(k?"png":"jpeg")+";base64,"+btoa(l);this._images.set(e.id,m);var l1=this._imageTextures.get(e.id);if(l1){this._imageTextures.delete(e.id);for(var i=0;i<l1.length;i++){var m1=l1[i];this.updateTextureMap(m1.materialId,m1.textureType);}}return this;};
var k1=new THREE.TextureLoader();S.TextureType={Diffuse:0,Bump:1,Opacity:2,Reflection:3,Refraction:4,Specular:5,Ambient:6,Emissive:7,SpecularLevel:8,Glosiness:9,AmbientOcclusion:10,Decal:11};
S.prototype.updateTextureMaps=function(m){var e=[];var i=this._getMaterialRef(m);if(!i){return e;}var j=i.userData.materialInfo;if(!j){return e;}if(j.textureDiffuse){var k=this.updateTextureMap(m,S.TextureType.Diffuse);if(k.imageId){e.push(k);}}if(j.textureBump){var l=this.updateTextureMap(m,S.TextureType.Bump);if(l.imageId){e.push(l);}}if(j.textureOpacity){var l1=this.updateTextureMap(m,S.TextureType.Opacity);if(l1.imageId){e.push(l1);}}if(j.textureEmissive){var m1=this.updateTextureMap(m,S.TextureType.Emissive);if(m1.imageId){e.push(m1);}}if(j.textureAmbientOcclusion){var n1=this.updateTextureMap(m,S.TextureType.AmbientOcclusion);if(n1.imageId){e.push(n1);}}if(j.textureReflection){var o1=this.updateTextureMap(m,S.TextureType.Reflection);if(o1.imageId){e.push(o1);}}return e;};
S.prototype.updateTextureMap=function(e,i){var j={textureType:i,imageId:null};var k=this._getMaterialRef(e);if(!k){return j;}var l=k.userData.materialInfo;if(!l){return j;}var l1=null;switch(i){case S.TextureType.Diffuse:l1=l.textureDiffuse;break;case S.TextureType.Bump:l1=l.textureBump;break;case S.TextureType.Opacity:l1=l.textureOpacity;break;case S.TextureType.Reflection:l1=l.textureReflection;break;case S.TextureType.Emissive:l1=l.textureEmissive;break;case S.TextureType.AmbientOcclusion:l1=l.textureAmbientOcclusion;break;default:break;}if(!l1){return j;}var m1=l1[0]||l1;var n1=this._images.get(m1.imageId);if(!n1){j.imageId=m1.imageId;return j;}if(k.userData.imageIdsToLoad){k.userData.imageIdsToLoad.delete(m1.imageId);if(k.userData.imageIdsToLoad.size===0){delete k.userData.imageIdsToLoad;}}var o1=k1.load(n1,this._fireSceneUpdated);o1.wrapS=m1.uvHorizontalTilingEnabled?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;o1.wrapT=m1.uvVerticalTilingEnabled?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;o1.magFilter=m1.filterMode===1?THREE.NearestFilter:THREE.LinearFilter;o1.minFilter=m1.filterMode===1?THREE.NearestFilter:THREE.LinearMipMapLinearFilter;o1.anisotropy=4;var p1=m1.influence!==undefined?m1.influence:0;var q1=m1.uvHorizontalScale!==undefined?m1.uvHorizontalScale:1;var r1=m1.uvVerticalScale!==undefined?m1.uvVerticalScale:1;var s1=m1.uvHorizontalOffset!==undefined?m1.uvHorizontalOffset:0;var t1=m1.uvVerticalOffset!==undefined?m1.uvVerticalOffset:0;o1.repeat.set(q1,r1);o1.center.set(-s1,-t1);o1.offset.set(s1,t1);o1.rotation=-m1.uvRotationAngle;function u1(m){switch(i){case S.TextureType.Diffuse:m.map=o1;m.transparent|=n1.startsWith("data:image/png");break;case S.TextureType.Bump:m.bumpMap=o1;m.bumpScale=p1;break;case S.TextureType.Opacity:m.alphaMap=o1;break;case S.TextureType.Reflection:o1.mapping=THREE.SphericalReflectionMapping;m.envMap=o1;m.combine=THREE.AddOperation;m.reflectivity=p1;break;case S.TextureType.Emissive:m.emissiveMap=o1;m.emissive.setRGB(1,1,1);break;case S.TextureType.AmbientOcclusion:m.aoMap=o1;break;default:}m.needsUpdate=true;}u1(k);var v1=this._materialClones.get(e);if(v1){v1.forEach(function(m){u1(m);});}return j;};
S.prototype.insertPlayback=function(e,i,j){this._resetCurrentScene(j);var k=this._vkScene.findSequence(e.sequenceId);var l=new r(e.id,{sequence:k,timeScale:e.speed?1.0/e.speed:1,preDelay:e.preDelay?e.preDelay:0,postDelay:e.postDelay?e.postDelay:0,repeats:e.repeat?Math.abs(e.repeat):0,reversed:e.reversed?true:false,startTime:e.start?e.start:0});var m=this._views.get(i);if(m){m.addPlayback(l);}if(!k){T.pushElementIntoMapArray(this._sequenceIdToPlaybacks,e.sequenceId,l);}return this;};
S.prototype.insertSequence=function(i,e){var j=this._vkScene.findSequence(i.id);if(j){return this;}var k;if(i.endTime){if(i.startTime){k=i.endTime-i.startTime;}else{k=i.endTime;}}else{k=1.0;}j=this._vkScene.createSequence(i.id,{name:i.name,duration:k});if(Array.isArray(i.joints)){i.joints.forEach(function(n1){var o1=this._joints[n1];if(o1){j.setJoint(o1,true);}}.bind(this));}if(i.nodes&&i.nodes.length>0){for(var l=0;l<i.nodes.length;l++){var m=i.nodes[l];if(m.empty){m.type=m.binding;var l1=this._nodes.get(m.sid);this._animationHelper.insertEmptyTrack(m,j,l1,this._vkScene);continue;}T.pushElementIntoMapArray(this._trackIdSequenceNodeMap,m.trackId,{sequenceId:i.id,targetId:m.sid,type:m.binding,pivot:m.pivot,isAbsoluteValue:m.isAbsoluteValue});}}var m1=this._sequenceIdToPlaybacks.get(i.id);if(m1){m1.forEach(function(n1){n1.setSequence(j);});}return this;};
S.prototype.insertTracks=function(e){this._animationHelper.insertTracks(e,this._trackIdSequenceNodeMap,this._nodes,this._vkScene);return this;};
S.prototype.insertJoints=function(j,e){this._resetCurrentScene(e);this._joints=[];j.forEach(function(i){var k=this._nodes.get(i.childSid);var l=this._nodes.get(i.parentSid);var m={id:i.id,node:k,parent:l,translation:new Float32Array(i.t?i.t:[0,0,0]),quaternion:new Float32Array(i.q?i.q:[0,0,0,1]),scale:new Float32Array(i.s?i.s:[1,1,1])};if(!k){var l1=this._jointNodesMap.get(i.childSid);if(!l1){l1=[];}l1.push(m);this._jointNodesMap.set(i.childSid,l1);}if(!l){var m1=this._jointParentsMap.get(i.parentSid);if(!m1){m1=[];}m1.push(m);this._jointParentsMap.set(i.parentSid,m1);}this._joints.push(m);}.bind(this));return this;};
S.prototype.finalizeAnimation=function(){var e=this._rootNode;if(e){while(e.parent){e=e.parent;}if(!e.userData){e.userData={};}e.userData.tracks=this._tracks;}return this;};
S.prototype.finalizePlaybacks=function(){var e=this._rootNode;if(e){while(e.parent){e=e.parent;}if(!e.userData){e.userData={};}}else{return this;}if(!e.userData.animationNodeOriginalData){e.userData.animationNodeOriginalData=new Map();}var i;var j=this._viewGroups.entries();var k=j.next();while(!k.done){i=k.value[1];k=j.next();var l=[];for(var m=0;m<i.getViews().length;m++){if(i.getViews()[m].id){var l1=this._views.get(i.getViews()[m].id);if(l1){l.push(l1);}}}}return this;};
S.prototype.finalizeViewGroups=function(e){this._resetCurrentScene(e);var i=this._viewGroups.entries();var j=i.next();while(!j.done){var k=j.value[1];var l=j.value[0];if(!k||!k.views||!k.views.length){j=i.next();continue;}k.removeViews();for(var m=0;m<k.views.length;m++){var l1=k.views[m].id;var m1=this._views.get(l1);if(m1&&m1.userData.viewInfo.thumbnailId&&!m1.thumbnailData){var n1=this._images.get(m1.userData.viewInfo.thumbnailId);if(n1){m1.thumbnailData=n1;}}if(m1){m1.viewGroupId=l;k.addView(m1);}}j=i.next();}return this;};
S.prototype.insertViewGroup=function(i,e){this._resetCurrentScene(e);var j=this._viewGroups.get(i.id);if(!j){j=this._vkScene.createViewGroup({viewGroupId:i.id,name:i.name,description:i.description});this._viewGroups.set(i.id,j);}else{j.setViewGroupId(i.id);j.setName(i.name);j.setDescription(i.description);}j.type=i.type;j.metadata=i.metadata;j.veids=i.veids;j.views=i.views;j.sceneId=i.sceneId;return this;};
S.prototype.getViewGroup=function(e,i){this._resetCurrentScene(i);var j=this._viewGroups.get(e);var k=[];if(j&&j.views){for(var l=0;l<j.views.length;l++){var m=j.views[l].id;var l1=this._views.get(m);if(l1){k.push(l1);}}}return k;};
S.prototype.insertView=function(e,i){this._resetCurrentScene(i);if(e.description){var j=new RegExp("^<[^>]*?>");if(j.test(e.description)){var k=new RegExp("(^(<[^>]*?>\s*)+)|((<[^>]*?>\s*)+$)","g");var l=e.description.replace(k,"");if(!l){e.description=l;}}}var m=this._vkScene.createView({viewId:e.viewId,name:e.name,description:e.description?"<pre style=\"white-space: pre-wrap;\">"+e.description+"</pre>":e.description,aspectRatio:e.safeAreaAspectRatio});m.userData={};m.userData.viewInfo=e;if(e.thumbnailId){var l1=this._images.get(e.thumbnailId);if(l1){m.thumbnailData=l1;}else{this._viewThumbnails.set(e.thumbnailId,m);}}if(e.animatedThumbnailId){var m1=this._images.get(e.animatedThumbnailId);if(m1){m.animatedThumbnailData=m1;m.tileWidth=this._imageIdsAndTileWidths.get(e.animatedThumbnailId);}}if(e.cameraId){m.setCamera(this._cameras.get(e.cameraId));}m.type=e.type;m.flyToTime=e.flyToTime;m.preDelay=e.preDelay;m.postDelay=e.postDelay;m.navigationMode=e.navigationMode;m.topColor=e.topColor;m.bottomColor=e.bottomColor;m.renderMode=E[e.renderMethod];m.dimension=e.dimension;m.query=e.query;m.metadata=e.metadata;m.veids=e.veids;m.viewGroupId=e.viewGroupId;m.id=e.viewId;this._views.set(e.viewId,m);if(m.viewGroupId){var n1=this._viewGroups.get(m.viewGroupId);if(n1){n1.addView(m);}}return this;};
S.prototype.setModelViewVisibilitySet=function(i){var e=this._views.get(i.viewId);var j=[];i.visibleNodes.forEach(function(k){var l=this._nodes.get(k);if(l){j.push({target:l,visible:true});}else{L.warning("Unknown modelView visible node reference",k);}}.bind(this));e.updateNodeInfos(j);};
S.prototype.recordHighlightedNodeInView=function(e,i,j,k){this._resetCurrentScene(k);var l=this._views.get(j);if(!l){return this;}var m=this._nodes.get(i);if(!m){return this;}l.addHighlightedNodes(e,m);return this;};
S.prototype.insertHighlightStyle=function(i){var e=this._vkScene.getHighlight(i.id);if(e){return this;}this._vkScene.createHighlight(i.id,i);return this;};
S.prototype.insertModelViewHighlight=function(i){var e=this._views.get(i.viewId);if(e){var j=[];i.highlightNodes.forEach(function(l1){var m1=this._nodes.get(l1);if(m1){j.push(m1);}else{}}.bind(this));var k={duration:i.duration,cycles:i.cycles};if(!i.id){i.id=THREE.Math.generateUUID().toLowerCase();}var l=new THREE.Color(i.color1).toArray();var m=new THREE.Color(i.color2).toArray();l[3]=((i.color1>>>24)&255)/255;m[3]=((i.color2>>>24)&255)/255;k.colours=[l,m];k.opacities=[i.opacity1,i.opacity2];this._vkScene.createHighlight(i.id,k);e.addHighlightedNodes(i.id,j);}};
S.prototype.createThumbnail=function(i){var e=this._viewThumbnails.get(i.imageId);if(e){e.thumbnailData="data:image/"+"jpeg"+";base64,"+window.btoa(String.fromCharCode.apply(null,i.data));if(this._fireThumbnailLoaded){this._fireThumbnailLoaded({modelView:e});}}};
S.prototype.highlightStyleExists=function(i){var e=this._vkScene.getHighlight(i);return e!==undefined;};
S.prototype.getView=function(e,i){this._resetCurrentScene(i);return this._views.get(e);};
S.prototype.getSequence=function(e){return this._vkScene.findSequence(e);};
S.prototype.setViewCamera=function(e,i,j){this._resetCurrentScene(j);var k=this._cameras.get(e);var l=this._views.get(i);if(k&&l){l.setCamera(k);}return this;};
S.prototype.setViewNodeInfos=function(e,i,j){this._resetCurrentScene(j);var k=this._views.get(i);k.setNodeInfos(e);return this;};
S.prototype.setViewThumbnail=function(i,e,j,k){this._resetCurrentScene(j);var l=this._views.get(e);var m=this._images.get(i);if(l&&m){if(l.userData!==undefined){if(l.userData.viewInfo.thumbnailId===i){l.thumbnailData=m;}else if(l.userData.viewInfo.animatedThumbnailId===i){l.animatedThumbnailData=m;l.tileWidth=k;}}}return this;};
S.prototype.cleanup=function(){this._rootNode=null;if(this._vkScene){this._vkScene.clearMaterials();}this._callouts.clear();this._cameras.clear();this._images.clear();this._imageIdsAndTileWidths.clear();this._imageTextures.clear();this._geometries.clear();this._meshNodes.clear();this._meshSubmeshes.clear();this._geometryMeshes.clear();this._materialMeshes.clear();this._materialClones.clear();this._currentSceneId=null;if(this._nodes){this._nodes.clear();}if(this._tracks){this._tracks.clear();}if(this._trackIdSequenceNodeMap){this._trackIdSequenceNodeMap.clear();}if(this._viewGroups){this._viewGroups.clear();}if(this._views){this._views.clear();}this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();this._sceneIdViewGroupMap.clear();this._sceneIdViewMap.clear();S._map.delete(this._id);};
S.prototype.insertAnimationGroup=function(i){var e=this._vkScene.findSequence(i.animationGroupRef.toString());if(!e){var j;if(i.endTime){j=i.endTime-i.startTime;if(!i.startTime){i.startTime=0;}}e=this._vkScene.createSequence(i.animationGroupRef.toString(),{name:i.name,duration:j});if(!e.userData){e.userData={};}e.userData.animations=[];}if(i.modelViewRef){var m=this._views.get(i.modelViewRef);if(m){var k=this._vkScene.findSequence(i.animationGroupRef.toString());var l=new r({sequence:k,timeScale:i.playbackSpeed?1.0/i.playbackSpeed:1,preDelay:i.playbackPreDelay?i.playbackPreDelay:0,postDelay:i.playbackPostDelay?i.playbackPostDelay:0,repeat:i.playbackRepeat?Math.abs(i.playbackRepeat):0,reversed:i.playbackReversed?true:false,startTime:0});m.addPlayback(l);}}};
S.prototype.insertAnimation=function(i){var e=this._animations.get(i.animationRef);if(!e){e={};e.type=i.animationType;e.targetRefs=[];e.targetPivots=[];e.sequenceId=i.animationGroupRef.toString();e.trackIds=new Set();e.tracks=[];this._animations.set(i.animationRef,e);}if(i.animationGroupRef){var j=this._vkScene.findSequence(i.animationGroupRef.toString());if(!j.userData.animations.includes(i.animationRef)){j.userData.animations.push(i.animationRef);}}};
S.prototype.insertAnimationTarget=function(i){var e=this._animations.get(i.animationRef);if(e){if(!e.targetRefs.includes(i.targetRef)){e.targetRefs.push(i.targetRef);e.targetPivots.push({x:i.targetPivotX,y:i.targetPivotY,z:i.targetPivotZ});}}};
S.prototype.insertAnimationTrack=function(i){var e=this._animationTracks.get(i.animationTrackRef);var j=i.animationRef;if(!e){delete i.animationRef;e=i;this._animationTracks.set(i.animationTrackRef,e);}if(!j){return;}var k=this._animations.get(j);if(!k||!k.sequenceId){return;}if(k.trackIds.has(e.animationTrackRef)){return;}k.trackIds.add(e.animationTrackRef);for(var l=0;k.targetRefs&&l<k.targetRefs.length;l++){var m=k.targetRefs[l];var l1=k.targetPivots[l];var m1=this._nodes.get(m);if(!m1){continue;}var n1;if(l1.x!==0||l1.y!==0||l1.z!==0){n1=[l1.x,l1.y,l1.z];}var o1=["OPACITY","COLOUR","TRANSLATE","SCALE","ROTATE"][e.type]||"";T.pushElementIntoMapArray(this._trackIdSequenceNodeMap,i.animationTrackRef,{sequenceId:k.sequenceId,targetId:m,type:o1,pivot:n1,isAbsoluteValue:true});var p1={};p1.times=Array.prototype.slice.call(e.times);p1.values=Array.prototype.slice.call(e.values);p1.id=i.animationTrackRef;p1.cyclicInfo={};p1.cyclicInfo.cyclicStart=e.cyclicStart;p1.cyclicInfo.cyclicEnd=e.cyclicEnd;var ki;if(k.type===0){if(e.dataType===0){if(e.values.length!==e.keyCount||e.times.length!==e.keyCount){continue;}if(e.type===3){p1.values=[];for(ki=0;ki<e.keyCount;ki++){p1.values.push(e.values[ki]);p1.values.push(e.values[ki]);p1.values.push(e.values[ki]);}}}else if(e.dataType===1||e.dataType===3){if(e.values.length!==3*e.keyCount||e.times.length!==e.keyCount){continue;}}else if(e.dataType===4||e.dataType===5||e.dataType===6){if(e.values.length!==4*e.keyCount||e.times.length!==e.keyCount){continue;}if(e.dataType===4){p1.rotateType=s.AngleAxis;}else if(e.dataType===6){p1.rotateType=s.Euler;}else{p1.rotateType=s.Quaternion;for(var vi=3;vi<p1.values.length;vi=vi+4){p1.values[vi]=-p1.values[vi];}}}}k.tracks.push(p1);}};
S.prototype.setAnimationTracks=function(e){var i=this._animations.get(e);if(i){this._animationHelper.insertTracks(i.tracks,this._trackIdSequenceNodeMap,this._nodes,this._vkScene);}};
S.prototype.setAnimationPlaybacks=function(i){var e=this._viewGroups.get(i.viewGroupId);this._animationHelper.setInitialNodePositionsFromSubsequentViews(e.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromPreviousViews(e.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromCurrenetViews(e.getViews(),this._vkScene);this._animationHelper.setPlaybackStartTimes(e.getViews(),this._vkScene);this._animationHelper.buildViewsInitialState(e.getViews(),this._vkScene);};
return S;});
sap.ui.predefine('sap/ui/vk/threejs/Texture',["../Texture","./thirdparty/three"],function(T,t){"use strict";
var a=T.extend("sap.ui.vk.threejs.Texture",{
metadata:{},
constructor:function(i){if(i){var c=new THREE.TextureLoader();this._nativeTexture=c.load(i);if(!this._nativeTexture.userData){this._nativeTexture.userData={};}}}
});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}};
a.prototype.load=function(i){var c=new THREE.TextureLoader();this._nativeTexture=c.load(i);if(!this._nativeTexture.userData){this._nativeTexture.userData={};}return this;};
a.prototype.getTextureRef=function(){return this._nativeTexture;};
a.prototype.setTextureRef=function(c){this._nativeTexture=c;if(!this._nativeTexture.userData){this._nativeTexture.userData={};}return this;};
a.prototype.getId=function(){if(this._nativeTexture&&this._nativeTexture.userData&&this._nativeTexture.userData.id){return this._nativeTexture.userData.id;}};
a.prototype.setId=function(v){if(this._nativeTexture){if(!this._nativeTexture.userData){this._nativeTexture.userData={};}this._nativeTexture.userData.id=v;}return this;};
a.prototype.getFilterMode=function(){if(this._nativeTexture){return this._nativeTexture.magFilter===THREE.NearestFilter?1:0;}};
a.prototype.setFilterMode=function(v){if(this._nativeTexture){this._nativeTexture.magFilter=v===1?THREE.NearestFilter:THREE.LinearFilter;}};
a.prototype.getUvRotationAngle=function(){if(this._nativeTexture){return this._nativeTexture.rotation;}};
a.prototype.setUvRotationAngle=function(v){if(this._nativeTexture){this._nativeTexture.rotation=v;}};
a.prototype.getUvHorizontalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.x;}};
a.prototype.setUvHorizontalOffset=function(v){if(this._nativeTexture){this._nativeTexture.offset.x=v;}};
a.prototype.getUvVerticalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.y;}};
a.prototype.setUvVerticalOffset=function(v){if(this._nativeTexture){this._nativeTexture.offset.y=v;}};
a.prototype.getUvHorizontalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.x;}};
a.prototype.setUvHorizontalScale=function(v){if(this._nativeTexture){this._nativeTexture.repeat.x=v;}};
a.prototype.getUvVerticalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.y;}};
a.prototype.setUvVerticalScale=function(v){if(this._nativeTexture){this._nativeTexture.repeat.y=v;}};
a.prototype.getUvHorizontalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapS===THREE.RepeatWrapping;}};
a.prototype.setUvHorizontalTilingEnabled=function(v){if(this._nativeTexture){this._nativeTexture.wrapS=v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;}};
a.prototype.getUvVerticalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapT===THREE.RepeatWrapping;}};
a.prototype.setUvVerticalTilingEnabled=function(v){if(this._nativeTexture){this._nativeTexture.wrapT=v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;}};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/ThreeExtensions',["../abgrToColor","../ObjectType","./thirdparty/three","../NodeContentType"],function(a,O,t,N){"use strict";THREE.Object3D.prototype.defaultEmissive={r:0.0235,g:0.0235,b:0.0235};THREE.Object3D.prototype.defaultSpecular={r:0.0602,g:0.0602,b:0.0602};
THREE.Box3.prototype._setFromObjectExcludingHotSpotAndPMI=function(o){this.makeEmpty();var v=new THREE.Vector3();var c=this;o.updateMatrixWorld(true);o.traverse(function(n){if(n.userData.objectType===O.Hotspot||n.userData.objectType===O.PMI){return;}var i,l;var g=n.geometry;if(g!==undefined){if(g.isGeometry){var d=g.vertices;for(i=0,l=d.length;i<l;i++){v.copy(d[i]);v.applyMatrix4(n.matrixWorld);c.expandByPoint(v);}}else if(g.isBufferGeometry){var e=g.attributes.position;if(e!==undefined){for(i=0,l=e.count;i<l;i++){v.fromBufferAttribute(e,i).applyMatrix4(n.matrixWorld);c.expandByPoint(v);}}}}});return this;};
THREE.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){var p=this.parent,m=this.matrix.clone(),c=this.matrixAutoUpdate;this.parent=null;this.matrix.identity();this.matrixAutoUpdate=false;this.userData.boundingBox._setFromObjectExcludingHotSpotAndPMI(this);this.matrixAutoUpdate=c;this.matrix.copy(m);this.parent=p;this.updateMatrixWorld(true);};
THREE.Object3D.prototype._vkTraverseNodeGeometry=function(c){c(this);for(var i=0,l=this.children.length;i<l;i++){var d=this.children[i];if(d.geometry!==undefined&&d.layers===this.layers){c(d);}}};
THREE.Object3D.prototype._vkSetTintColor=function(c){this._vkTraverseNodeGeometry(function(n){n.userData.tintColor=c;n._vkUpdateMaterialColor();});};
THREE.Object3D.prototype._vkSetOpacity=function(o,j){this.userData.opacity=o;var n;var p;if(j){n=new Map();p=new Map();j.forEach(function(c){if(!c.node||!c.parent){return;}n.set(c.node,c);if(c.parent){var d=p.get(c.parent);if(!d){d=[];}d.push(c);p.set(c.parent,d);}});}this._vkTraverseNodes(function(c){c._vkUpdateMaterialOpacity(n);},n,p);};
THREE.Object3D.prototype._vkUpdateMaterialColor=function(){if(!this.material||!this.material.color){return;}var u=this.userData;if(u.originalMaterial){if(u.originalMaterial.color.r===undefined){u.originalMaterial=null;}else{this.material.color.copy(u.originalMaterial.color);if(this.material.emissive!==undefined){this.material.emissive.copy(u.originalMaterial.emissive);}if(this.material.specular!==undefined){this.material.specular.copy(u.originalMaterial.specular);}}}if(u.highlightColor!==undefined||u.tintColor!==undefined||u.highlightingColor!==undefined){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}if(u.highlightingColor!==undefined){var d=new THREE.Color();d.fromArray(u.highlightingColor).lerp(u.originalMaterial.color,1-u.highlightingColor[3]);this.material.color.copy(d);}var c;if(u.tintColor!==undefined){c=a(u.tintColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}if(u.highlightColor!==undefined){c=a(u.highlightColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}}this._vkUpdateMaterialOpacity();};
THREE.Object3D.prototype._vkUpdateMaterialOpacity=function(n){if(!this.material){return;}var u=this.userData;if(u.originalMaterial){this.material.opacity=u.originalMaterial.opacity;this.material.transparent=u.originalMaterial.transparent;}var o=1.0;var h=false;var c=this;do{if(c.userData&&c.userData.opacity!==undefined){o*=c.userData.opacity;h=true;}if(n){var j=n.get(c);if(j&&j.parent){c=j.parent;continue;}}c=c.parent;}while(c);if(h){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}if(this.material.opacity){this.material.opacity*=o;this.material.transparent=this.material.transparent||this.material.opacity<0.99;}}};
THREE.Object3D.prototype._vkGetTotalOpacity=function(j){var n;if(j){n=new Map();j.forEach(function(d){if(!d.node||!d.parent){return;}n.set(d.node,d);});}var o=1.0;var c=this;do{if(c.userData&&c.userData.opacity!==undefined){o*=c.userData.opacity;}if(n){var d=n.get(c);if(d&&d.parent){c=d.parent;continue;}}c=c.parent;}while(c);return o;};
THREE.Object3D.prototype._vkTraverseMeshNodes=function(c){if(this._vkUpdate!==undefined||this.isDetailView){return;}c(this);var d=this.children;for(var i=0,l=d.length;i<l;i++){d[i]._vkTraverseMeshNodes(c);}};
THREE.Object3D.prototype._vkTraverseNodes=function(c,n,p){c(this);var d;if(p){d=p.get(this);}var j;if(d){for(j=0;j<d.length;j++){d[j].node._vkTraverseNodes(c,n,p);}}var e=this.children;if(e){for(j=0;j<e.length;j++){var f=e[j];if(n){var g=n.get(f);if(g){continue;}}f._vkTraverseNodes(c,n,p);}}};
function b(c,d){var e=c.min,f=c.max,m=d.elements,g=(e.x+f.x)*0.5,h=(e.y+f.y)*0.5,i=(e.z+f.z)*0.5,j=f.x-g,k=f.y-h,l=f.z-i;var n=m[0]*g+m[4]*h+m[8]*i+m[12];var o=m[1]*g+m[5]*h+m[9]*i+m[13];var p=m[2]*g+m[6]*h+m[10]*i+m[14];var q=Math.abs(m[0]*j)+Math.abs(m[4]*k)+Math.abs(m[8]*l);var r=Math.abs(m[1]*j)+Math.abs(m[5]*k)+Math.abs(m[9]*l);var s=Math.abs(m[2]*j)+Math.abs(m[6]*k)+Math.abs(m[10]*l);e.set(n-q,o-r,p-s);f.set(n+q,o+r,p+s);}
THREE.Object3D.prototype._expandBoundingBox=function(c,v,d,e){var n=new THREE.Box3();function f(h){var i=h.geometry;if(i!==undefined){if(!i.boundingBox){i.computeBoundingBox();}if(!i.boundingBox.isEmpty()){n.copy(i.boundingBox);b(n,h.matrixWorld);if(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.min.z)&&isFinite(n.max.x)&&isFinite(n.max.y)&&isFinite(n.max.z)){c.min.min(n.min);c.max.max(n.max);}}}var s=h.userData.boundingBox;if(s!==undefined&&!s.isEmpty()&&!v){n.copy(s);b(n,h.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}function g(h){if(h._vkUpdate!==undefined&&(d||(e&&h.userData.is2D))){return;}if(!v||h.layers.test(v)){f(h);}var j=h.children;for(var i=0,l=j.length;i<l;i++){g(j[i]);}}g(this);return c;};
THREE.Object3D.prototype._vkPersistentId=function(){var o=this;do{if(o.userData.treeNode&&o.userData.treeNode.sid){return o.userData.treeNode.sid;}o=o.parent;}while(o);return null;};
THREE.Object3D.prototype._vkSetNodeContentType=function(n){this.userData.nodeContentType=n;if(n===N.Reference){for(var i=0;i<32;i++){this.layers.disable(i);}this.userData.skipIt=true;}};
THREE.Object3D.prototype._vkGetNodeContentType=function(n){return this.userData.nodeContentType;};
});
sap.ui.predefine('sap/ui/vk/threejs/Thrustline',["jquery.sap.global","./thirdparty/three","sap/ui/base/ManagedObject","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../LeaderLineMarkStyle"],function(q,t,B,P,a,b,L){"use strict";
var T=B.extend("sap.ui.vk.threejs.Thrustline",{metadata:{properties:{node:{type:"object"},renderOrder:{type:"int",defaultValue:0},depthTest:{type:"boolean",defaultValue:true},principleAxis:{type:"object",defaultValue:new THREE.Vector3(0,0,0)},material:{type:"object"},items:{type:"object[]"},segments:{type:"object[]"}}}});
T.prototype.init=function(){if(B.prototype.init){B.prototype.init.call(this);}this._needUpdateMeshes=false;};
T.prototype.setNode=function(n){if(n instanceof THREE.Object3D){this.setProperty("node",n,true);this._needUpdateMeshes=true;}return this;};
T.prototype.setRenderOrder=function(v){this.setProperty("renderOrder",v,true);this._needUpdateMeshes=true;return this;};
T.prototype.setDepthTest=function(v){this.setProperty("depthTest",v,true);this._needUpdateMeshes=true;return this;};
T.prototype.setMaterial=function(h){if(h instanceof THREE.Material){this.setProperty("material",h,true);this._needUpdateMeshes=true;}return this;};
T.prototype.setItems=function(v){this.setProperty("items",v,true);this._needUpdateMeshes=true;return this;};
T.prototype.setSegments=function(v){this.setProperty("segments",v,true);this._needUpdateMeshes=true;return this;};
T.prototype._updateMeshes=function(v){var n=this.getNode();var h=this.getMaterial();var j=this.getDepthTest();var r=this.getRenderOrder();var k=h&&h.userData.lineStyle?h.userData.lineStyle:{};var o=k.width;var p=k.dashPatternScale;if(k.widthCoordinateSpace===3){o=o?o*v.y:1;p=p?p*v.y:1;}o=o||1;k.haloWidth=k.haloWidth||0;k.endCapStyle=k.endCapStyle||0;this.getSegments().forEach(function(s){if(s.polylineMesh){n.remove(s.polylineMesh);s.polylineMesh=null;}if(s.haloMesh){n.remove(s.haloMesh);s.haloMesh=null;}var u=[];for(var i=0,l=s.ratios.length;i<l;i++){u.push(new THREE.Vector3());}var w=new P();w.setVertices(u);var x=k.endCapStyle||u.length>2?1:0;var y=(x&&k.endCapStyle===0?1:0)|(x&&k.endCapStyle===0?2:0);if(k.haloWidth>0){var z=new a({color:0xFFFFFF,lineColor:0xFFFFFF,linewidth:o*(k.haloWidth*2+1),dashCapStyle:k.endCapStyle,segmentCapStyle:x,trimStyle:y,transparent:true,depthTest:j});var A=new b(w,z);A.matrixAutoUpdate=false;A.renderOrder=r;A.layers=n.layers;s.haloMesh=A;n.add(A);}var C=new a({color:0xFFFFFF,lineColor:h.color,linewidth:o,dashCapStyle:k.endCapStyle,segmentCapStyle:x,trimStyle:y,dashPattern:k.dashPattern||[],dashScale:p||1,transparent:true,depthTest:j,polygonOffset:true,polygonOffsetFactor:-4});var D=new b(w,C);D.matrixAutoUpdate=false;D.renderOrder=r;D.layers=n.layers;s.polylineMesh=D;n.add(D);});};
var m=new THREE.Matrix4(),c=new THREE.Matrix4(),d=new THREE.Vector3(),e=new THREE.Vector3(),f=new THREE.Vector3(),g=new THREE.Vector3();
T.prototype._update=function(r,h,v){var n=this.getNode();if(!n||!n.layers.test(h.layers)){return;}if(this._needUpdateMeshes){this._needUpdateMeshes=false;this._updateMeshes(v);}m.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse);c.copy(m);var j=h instanceof THREE.PerspectiveCamera?h.near:undefined;var k=this.getItems();d.copy(this.getPrincipleAxis()).normalize();this.getSegments().forEach(function(s){var p=s.polylineMesh;if(p){var o=p.geometry;var u=k[s.startItemIndex];var w=new THREE.Vector3().copy(u.boundPoints[s.startBoundIndex]).applyMatrix4(u.target.matrixWorld);var x=k[s.endItemIndex];var y=new THREE.Vector3().copy(x.boundPoints[s.endBoundIndex]).applyMatrix4(x.target.matrixWorld);e.copy(y).sub(w);f.copy(d).multiplyScalar(e.dot(d));g.copy(e).sub(f);var z=o.vertices;var A=[];for(var i=0,l=s.ratios.length;i<l;i++){A.push(i);var C=s.ratios[i];var D=z[i];D.copy(w);e.copy(f).multiplyScalar(C.x);D.add(e);e.copy(g).multiplyScalar(C.y);D.add(e);}o._updateVertices(A);p.material.resolution.copy(v);p.computeLineDistances(c,v,j);}var E=s.haloMesh;if(E){E.material.resolution.copy(v);E.computeLineDistances(c,v,j);}});};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/ViewStateManager',["../Core","../ContentConnector","../ViewStateManagerBase","./thirdparty/three","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene","../ObjectType","../RotationType","./NodesTransitionHelper","./OutlineRenderer","./HighlightPlayer","../HighlightDisplayState","../Highlight","../AnimationTrackType","../AnimationTrackValueType","../AnimationMath"],function(a,C,V,t,b,d,e,f,S,O,R,N,g,H,h,m,A,n,o){"use strict";var p;
var u=V.extend("sap.ui.vk.threejs.ViewStateManager",{metadata:{}});
var w=u.getMetadata().getParent().getClass().prototype;
u.prototype.init=function(){if(w.init){w.init.call(this);}this._channel=0;this._layers=new THREE.Layers();this._layers.set(this._channel);this._nodeHierarchy=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._outlineRenderer=new g(1.0);this._outlinedNodes=new Set();this.setOutlineColor("rgba(255, 0, 255, 1.0)");this.setOutlineWidth(1.0);this._visibilityTracker=new p();this._showSelectionBoundingBox=true;this._boundingBoxesScene=new THREE.Scene();this._selectionColor=new THREE.Color(0xC0C000);this.setHighlightColor("rgba(255, 0, 0, 1.0)");this._joints=[];this._customPositionedNodes=new Set();this._nodesTransitionHelper=new N();this._nodesTransitionHelper.setViewStateManager(this);this._highlightPlayer=new H();this._transitionHighlightPlayer=new H();a.getEventBus().subscribe("sap.ui.vk","activateView",this._onViewActivated,this);};
u.prototype.exit=function(){a.getEventBus().unsubscribe("sap.ui.vk","activateView",this._onViewActivated,this);};
u.prototype._setContent=function(c){var s=null;if(c&&c instanceof S){s=c;}this._setScene(s);if(s){var i=s.getInitialView();if(i){this._currentView=i;this._resetNodesMaterialAndOpacityByCurrenView(this._currentView);}}};
u.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
u.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
u.prototype._handleContentReplaced=function(c){var i=c.getParameter("newContent");this._setContent(i);};
u.prototype._setScene=function(s){this._boundingBoxesScene=new THREE.Scene();this._setNodeHierarchy(s?s.getDefaultNodeHierarchy():null);if(s){s.setViewStateManager(this);}this._scene=s;return this;};
u.prototype._setNodeHierarchy=function(c){var i=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._nodeStates.clear();this._selectedNodes.clear();this._outlinedNodes.clear();this._visibilityTracker.clear();}if(c){this._nodeHierarchy=c;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._initialState={visible:[],hidden:[]};var j=this;var k=c.findNodesByName();k.forEach(function(l){(l.layers.test(j._layers)?j._initialState.visible:j._initialState.hidden).push(l);});this.fireVisibilityChanged({visible:this._initialState.visible,hidden:this._initialState.hidden});}if(c!==i){this.fireNodeHierarchyReplaced({oldNodeHierarchy:i,newNodeHierarchy:c});}return this;};
u.prototype._getJointByChildNode=function(c){var j;if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===c){j=this._jointCollection[i];break;}}}return j;};
u.prototype._handleNodeReplaced=function(c){var r=c.getParameter("ReplacedNodeRef");var i=c.getParameter("ReplacementNodeRef");if(this.getSelectionState(r)){this.setSelectionState(i,true);this.setSelectionState(r,false);}};
u.prototype._handleNodeUpdated=function(c){var i=c.getParameter("nodeRef");if(this.getSelectionState(i)){this.setSelectionState(i,false);this.setSelectionState(i,true);}};
u.prototype._handleNodeRemoving=function(c){var j=c.getParameter("nodeRef");if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===j){this._jointCollection[i].node=null;break;}if(this._jointCollection[i].parent===j){this._jointCollection[i].parent=null;break;}}}if(this.getSelectionState(j)){this.setSelectionState(j,false,true,true);}};
u.prototype._renderOutline=function(r,s,i){var c=e(this._outlineColorABGR);var j=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);this._outlineRenderer.render(r,s,i,Array.from(this._outlinedNodes),j,this._jointCollection);};
u.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
u.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
u.prototype.getCurrentView=function(){var v=sap.ui.getCore().byId(this.getViewManager());if(!v){return null;}var c=v.getActiveView();return c;};
u.prototype.resetNodeProperty=function(c,i){var j=this.getCurrentView();if(!j){return;}var k=j.getNodeInfos();if(k){var l=[];l.push(c);if(this._jointCollection&&this._jointCollection.length>0){for(var q=0;q<this._jointCollection.length;q++){var r=this._jointCollection[q];if(!r.node||!r.parent){continue;}var s=r.parent;if(s!==c){break;}l.push(r.node);}}k.forEach(function(v){if(!l.includes(v.target)){return;}if(!i||i!==A.Opacity){var x={nodeRefs:[],positions:[]};var y;var z;var D;if(v.transform){var E=new THREE.Vector3();var F=new THREE.Quaternion();var G=new THREE.Vector3();var I=B(v.transform);I.decompose(E,F,G);y=E.toArray();z=F.toArray();D=G.toArray();}else if(v[A.Scale]&&v[A.Rotate]&&v[A.Translate]){y=v[A.Translate].slice();z=v[A.Rotate].slice();D=v[A.Scale].slice();}if(y){x.nodeRefs.push(v.target);x.positions.push({translation:y,quaternion:z,scale:D});this.setTransformation(x.nodeRefs,x.positions);}}else{c._vkSetOpacity(v.opacity,this._jointCollection);var J={changed:c,opacity:k.opacity};this.fireOpacityChanged(J);}}.bind(this));}};
u.prototype.getVisibilityComplete=function(){var c=this.getNodeHierarchy(),i=c.findNodesByName(),v=[],j=[];i.forEach(function(k){var l=c.createNodeProxy(k);var q=l.getVeId();c.destroyNodeProxy(l);if(q){if(this.getVisibilityState(k)){v.push(q);}else{j.push(q);}}},this);return{visible:v,hidden:j};};
u.prototype.resetVisibility=function(){this.setVisibilityState(this._initialState.visible,true,false);this.setVisibilityState(this._initialState.hidden,false,false);this._visibilityTracker.clear();};
u.prototype.getVisibilityState=function(c){var l=this._layers;if(Array.isArray(c)){return c.map(function(i){return i?i.layers.test(l):false;});}return c?c.layers.test(l):false;};
u.prototype.setVisibilityState=function(c,v,r){if(!Array.isArray(c)){c=[c];}var i=Array.isArray(v);var j=[];var k=c;if(r){k=[];c.forEach(function(D,E){var F=this._collectNodesRecursively(D);k=k.concat(F);var G=j.length;j.length=G+F.length;j.fill(i?v[E]:v,G);},this);}else if(!i){j.length=k.length;j.fill(v);}else{j=v;}var l=[];var q=new Set();var s=this._layers,x=this._channel;var y=k.filter(function(D,E){if(q.has(D)){return false;}q.add(D);var y=D?D.layers.test(s)!=j[E]:false;if(y){l.push(j[E]);}return y;},this);if(y.length>0){var z={visible:[],hidden:[]};y.forEach(function(D,E){if(l[E]){D.layers.enable(x);z.visible.push(D);}else{D.layers.disable(x);z.hidden.push(D);}},this);if(this.getShouldTrackVisibilityChanges()){y.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged(z);}return this;};
u.prototype.enumerateSelection=function(c){this._selectedNodes.forEach(c);return this;};
u.prototype.enumerateOutlinedNodes=function(c){this._outlinedNodes.forEach(c);return this;};
u.prototype.getSelectionState=function(c){var s=this._selectedNodes;function i(j){return s.has(j);}return Array.isArray(c)?c.map(i):i(c);};
u.prototype._isAChild=function(c,i){var j=c.parent;while(j){if(i.has(j)){return true;}j=j.parent;}return false;};
u.prototype._AddBoundingBox=function(c){if(c.userData.boundingBox===undefined){c.userData.boundingBox=new THREE.Box3();c._vkCalculateObjectOrientedBoundingBox();}if(!c.userData.boundingBox.isEmpty()&&this._boundingBoxesScene&&c.userData.boxHelper===undefined){var i=new THREE.Box3Helper(c.userData.boundingBox,0xffff00);i.material.color=this._selectionColor;this._boundingBoxesScene.add(i);i.parent=c;c.userData.boxHelper=i;}};
u.prototype._RemoveBoundingBox=function(c){if(c.userData.boundingBox!==undefined){delete c.userData.boundingBox;}if(c.userData.boxHelper!==undefined){this._boundingBoxesScene.remove(c.userData.boxHelper);delete c.userData.boxHelper;}};
u.prototype._updateBoundingBoxesIfNeeded=function(){var c=new Set();this._selectedNodes.forEach(function(i){var j=i.parent;while(j){if(this._selectedNodes.has(j)){c.add(j);}j=j.parent;}}.bind(this));c.forEach(function(i){i._vkCalculateObjectOrientedBoundingBox();});};
u.prototype._updateBoundingBoxes=function(){this._selectedNodes.forEach(function(c){if(c.userData.boundingBox){c._vkCalculateObjectOrientedBoundingBox();}});};
u.prototype.setShowSelectionBoundingBox=function(v){this._showSelectionBoundingBox=v;if(this._showSelectionBoundingBox){this._selectedNodes.forEach(function(c){this._AddBoundingBox(c);}.bind(this));}else{this._selectedNodes.forEach(function(c){this._RemoveBoundingBox(c);}.bind(this));}this.fireSelectionChanged({selected:this._selectedNodes,unselected:[]});};
u.prototype.getShowSelectionBoundingBox=function(){return this._showSelectionBoundingBox;};
u.prototype._isAncestorSelected=function(c){c=c.parent;while(c){if(this._selectedNodes.has(c)){return true;}c=c.parent;}return false;};
u.prototype._updateHighlightColor=function(c,j){var s=j||this._selectedNodes.has(c);c.userData.highlightColor=s?this._highlightColorABGR:undefined;c._vkUpdateMaterialColor();var k=c.children;for(var i=0,l=k.length;i<l;i++){var q=k[i].userData;if(q&&q.objectType===O.Hotspot){continue;}this._updateHighlightColor(k[i],s);}};
u.prototype.setSelectionState=function(c,s,r,i){if(!Array.isArray(c)){c=[c];}c=(r||this.getRecursiveSelection()?this._collectNodesRecursively(c):c).filter(function(v,k,l){return l.indexOf(v)===k;});if(this.getRecursiveSelection()&&!s){c=this._nodeHierarchy._appendAncestors(c);}var j=c.filter(function(k){return this._selectedNodes.has(k)!==s;},this);if(j.length>0){j.forEach(function(k){if(k){this._selectedNodes[s?"add":"delete"](k);if(this._showSelectionBoundingBox){this[s?"_AddBoundingBox":"_RemoveBoundingBox"](k);}}},this);j.forEach(function(k){if(k){this._updateHighlightColor(k,s||this._isAncestorSelected(k));}},this);if(!i){this.fireSelectionChanged({selected:s?j:[],unselected:s?[]:j});}}return this;};
u.prototype.setSelectionStates=function(s,c,r,i){if(!Array.isArray(s)){s=[s];}if(!Array.isArray(c)){c=[c];}s=(r||this.getRecursiveSelection()?this._collectNodesRecursively(s):s);c=(r||this.getRecursiveSelection()?this._collectNodesRecursively(c):c);if(this.getRecursiveSelection()){c=this._nodeHierarchy._appendAncestors(c,s);}var j=s.filter(function(l){return this._selectedNodes.has(l)===false;},this);var k=c.filter(function(l){return this._selectedNodes.has(l)===true;},this);if(j.length>0||k.length>0){j.forEach(function(l){this._selectedNodes.add(l);this._updateHighlightColor(l,true);if(this._showSelectionBoundingBox){this._AddBoundingBox(l);}},this);k.forEach(function(l){this._selectedNodes.delete(l);if(this._showSelectionBoundingBox){this._RemoveBoundingBox(l);}},this);k.forEach(function(l){this._updateHighlightColor(l,this._isAncestorSelected(l));},this);if(!i){this.fireSelectionChanged({selected:j,unselected:k});}}return this;};
u.prototype.setOutlineColor=function(c){switch(typeof c){case"number":this._outlineColorABGR=c;break;case"string":if(sap.ui.core.CSSColor.isValid(c)){this._outlineColorABGR=f(b(c));}break;default:return this;}this.fireOutlineColorChanged({outlineColor:d(e(this._outlineColorABGR)),outlineColorABGR:this._outlineColorABGR});return this;};
u.prototype.getOutlineColor=function(i){return i?this._outlineColorABGR:d(e(this._outlineColorABGR));};
u.prototype.getOutliningState=function(c){var i=this._outlinedNodes;function j(k){return i.has(k);}return Array.isArray(c)?c.map(j):j(c);};
u.prototype.setOutliningStates=function(c,i,r,j){if(!Array.isArray(c)){c=[c];}if(!Array.isArray(i)){i=[i];}c=(r||this.getRecursiveOutlining()?this._collectNodesRecursively(c):c);i=(r||this.getRecursiveOutlining()?this._collectNodesRecursively(i):i);if(this.getRecursiveOutlining()){i=this._nodeHierarchy._appendAncestors(i,c);}var k=c.filter(function(q){return this._outlinedNodes.has(q)===false;},this);var l=i.filter(function(q){return this._outlinedNodes.has(q)===true;},this);if(k.length>0||l.length>0){k.forEach(function(q){this._outlinedNodes.add(q);},this);l.forEach(function(q){this._outlinedNodes.delete(q);},this);if(!j){this.fireOutliningChanged({outlined:k,unoutlined:l});}}return this;};
u.prototype.setOutlineWidth=function(c){this._outlineWidth=c;this._outlineRenderer.setOutlineWidth(c);this.fireOutlineWidthChanged({width:c});return this;};
u.prototype.getOutlineWidth=function(){return this._outlineWidth;};
u.prototype._collectNodesRecursively=function(c){var r=[],i=this;if(!Array.isArray(c)){c=[c];}c.forEach(function collectChildNodes(j){r.push(j);i._nodeHierarchy.enumerateChildren(j,collectChildNodes,false,true);});return r;};
u.prototype._getOpacity=function(c){return c.userData.opacity!==undefined?c.userData.opacity:null;};
u.prototype.getOpacity=function(c){if(Array.isArray(c)){return c.map(this._getOpacity,this);}else{return this._getOpacity(c);}};
u.prototype.setOpacity=function(c,i,r){if(!Array.isArray(c)){c=[c];}var j=Array.isArray(i);if(i==null){i=undefined;}else if(j){i.forEach(function(y,z){if(y==null){i[z]=undefined;}});}var k=[];var l=c;if(!j){k.length=l.length;k.fill(i);}else{k=i;}var q=[];var s=new Set();var v=l.filter(function(y,z){if(s.has(y)){return false;}s.add(y);var v=y?y.userData.opacity!==k[z]:false;if(v){q.push(k[z]);}return v;},this);if(v.length>0){v.forEach(function(y,z){y._vkSetOpacity(q[z],this._jointCollection);},this);var x={changed:v,opacity:j?q:q[0]};this.fireOpacityChanged(x);}return this;};
u.prototype._getTintColorABGR=function(c){return c.userData.tintColor!==undefined?c.userData.tintColor:null;};
u.prototype._getTintColor=function(c){return c.userData.tintColor!==undefined?d(e(c.userData.tintColor)):null;};
u.prototype.getTintColor=function(c,i){var j=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(c)){return c.map(this[j],this);}else{return this[j](c);}};
u.prototype.setTintColor=function(c,i,r){if(!Array.isArray(c)){c=[c];}var j=function(D){var E=null;switch(typeof D){case"number":E=D;break;case"string":if(sap.ui.core.CSSColor.isValid(D)){E=f(b(D));}break;default:E=undefined;break;}return E;};var k=Array.isArray(i);var l=[];var q=c;if(r){q=[];c.forEach(function(D,E){var F=this._collectNodesRecursively(D);q=q.concat(F);var G=l.length;l.length=G+F.length;l.fill(k?i[E]:i,G);},this);}else if(!k){l.length=q.length;l.fill(i);}else{l=i;}var s=[];var v=new Set();var x=q.filter(function(D,E){if(v.has(D)){return false;}v.add(D);var x=D?D.userData.tintColor!==j(l[E]):false;if(x){s.push(l[E]);}return x;},this);if(x.length>0){var y=[];x.forEach(function(D,E){var F=j(s[E]);D._vkSetTintColor(F);y.push(F);},this);var z={changed:x,tintColor:k?s:s[0],tintColorABGR:k?y:y[0]};this.fireTintColorChanged(z);}return this;};
u.prototype.setHighlightColor=function(c){switch(typeof c){case"number":this._highlightColorABGR=c;break;case"string":if(sap.ui.core.CSSColor.isValid(c)){this._highlightColorABGR=f(b(c));}break;default:return this;}if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(i){this._updateHighlightColor(i,true);},this);}this.fireHighlightColorChanged({highlightColor:d(e(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this;};
u.prototype.getHighlightColor=function(i){return i?this._highlightColorABGR:d(e(this._highlightColorABGR));};
u.prototype.getRestTransformationUsingJoint=function(c){var j=this._getJointByChildNode(c);if(j&&j.translation&&j.scale&&j.quaternion){return j;}else{return this.getRestTransformation(c);}};
u.prototype.getRelativeTransformation=function(c){var i=false;var j=this.getCurrentView();if(j){var k=j.getPlayback(0);if(k&&k.getReversed()){i=true;}}var l=function(q){var s=this.getRestTransformation(q,i);var v=[q.position.x-s.translation[0],q.position.y-s.translation[1],q.position.z-s.translation[2]];var x=new THREE.Quaternion(s.quaternion[0],s.quaternion[1],s.quaternion[2],s.quaternion[3]);var y=new THREE.Matrix4().makeRotationFromQuaternion(x);var z=new THREE.Matrix4().getInverse(y);var M=new THREE.Matrix4();var D=new THREE.Matrix4();M.makeRotationFromQuaternion(q.quaternion);D.multiplyMatrices(M,z);var E=new THREE.Quaternion().setFromRotationMatrix(D);var F=E.toArray();var G=[q.scale.x/s.scale[0],q.scale.y/s.scale[1],q.scale.z/s.scale[2]];return{translation:v,quaternion:F,scale:G};}.bind(this);if(!Array.isArray(c)){return l(c);}var r=[];c.forEach(function(q){r.push(l(q));});return r;};
u.prototype.getTransformationWorld=function(c){var i=function(j){var k=new THREE.Vector3();var s=new THREE.Vector3();var q=new THREE.Quaternion();j.updateMatrixWorld();j.matrixWorld.decompose(k,q,s);return{translation:k.toArray(),quaternion:q.toArray(),scale:s.toArray()};};if(!Array.isArray(c)){return i(c);}var r=[];c.forEach(function(j){r.push(i(j));});return r;};
u.prototype.getTransformation=function(c){var i=function(j){return{translation:this.getTranslation(j),quaternion:this.getRotation(j,R.Quaternion),scale:this.getScale(j)};}.bind(this);if(!Array.isArray(c)){return i(c);}var r=[];c.forEach(function(j){r.push(i(j));});return r;};
u.prototype.getTranslation=function(c){var i=function(j){return j.position.toArray();};if(!Array.isArray(c)){return i(c);}var r=[];c.forEach(function(j){r.push(i(j));});return r;};
u.prototype.getScale=function(c){var i=function(j){return j.scale.toArray();};if(!Array.isArray(c)){return i(c);}var r=[];c.forEach(function(j){r.push(i(j));});return r;};
u.prototype._convertQuaternionToAngleAxis=function(q){if(q.w>1){q.normalize();}if(q.w>0.9999&&q.x<0.0001&&q.y<0.0001&&q.z<0.0001){q.w=1;q.x=0;q.y=0;q.z=0;}var c=2*Math.acos(q.w);var x;var y;var z;var s=Math.sqrt(1-q.w*q.w);if(s<0.0001){x=1;y=0;z=0;}else{x=q.x/s;y=q.y/s;z=q.z/s;}return[x,y,z,c];};
u.prototype.getRotation=function(c,r){var i=function(k){var q=k.quaternion;var j;switch(r){case R.AngleAxis:j=this._convertQuaternionToAngleAxis(q);break;case R.Euler:var l=new THREE.Euler();l.setFromQuaternion(q);j=l.toArray();break;default:j=q.toArray();}return j;};if(!Array.isArray(c)){return i(c);}var j=[];c.forEach(function(k){j.push(i(k));});return j;};
u.prototype.setTransformation=function(c,i){var j=Array.isArray(c);if(!Array.isArray(c)){c=[c];}var k={changed:[],transformation:[]};var l=function(q){return{position:q.position.toArray(),quaternion:q.quaternion.toArray(),scale:q.scale.toArray()};};if(!i){c.forEach(function(q){if(q.userData.position&&q.userData.quaternion&&q.userData.scale){q.position=q.userData.position;q.quaternion=q.userData.quaternion;q.scale=q.userData.scale;q.updateMatrix();delete q.userData.position;delete q.userData.quaternion;delete q.userData.scale;}this._customPositionedNodes.delete(q);k.changed.push(q);k.transformation.push(l(q));},this);}else{if(!Array.isArray(i)){i=[i];}c.forEach(function(q,r){var s=q.userData;if(!s){return;}if(!s.position){s.position=q.position.clone();}if(!s.quaternion){s.quaternion=q.quaternion.clone();}if(!s.scale){s.scale=q.scale.clone();}var v=i[r];if(v.transform){var x=B(v.transform);x.decompose(q.position,q.quaternion,q.scale);}else{q.position.fromArray(v.translation);q.scale.fromArray(v.scale);if(v.quaternion){q.quaternion.fromArray(v.quaternion);}else if(v.angleAxis){var y=new THREE.Vector3(v.angleAxis[0],v.angleAxis[1],v.angleAxis[2]);q.quaternion.setFromAxisAngle(y,v.angleAxis[3]);}else if(v.euler){var z=new THREE.Euler();z.fromArray(v.euler[0],v.euler[1],v.euler[2],v.euler[3]);q.quaternion.setFromEuler(z);}}q.updateMatrix();this._customPositionedNodes.add(q);k.changed.push(q);k.transformation.push(l(q));},this);}if(!j){k.changed=k.changed[0];k.transformation=k.transformation[0];}this.fireTransformationChanged(k);return this;};
u.prototype.getJoints=function(){return this._jointCollection;};
u.prototype.setJoints=function(j,s){this._jointCollection=[];this._sequenceAssociatedWithJoints=null;if(!j){return this;}var c=new Set();var i=new Map();j.forEach(function(l){if(!l.node||!l.parent){return;}c.add(l.node);i.set(l.node,l);});while(c.size>0){var k=c.values().next().value;c.delete(k);var l=i.get(k);var q=[l];var r=[];var v=l.parent;while(v){l=i.get(v);if(l!==undefined){if(c.delete(v)){q.push(l);}if(r.length>0){l.nodesToUpdate=l.nodesToUpdate||[];while(r.length>0){var x=r.pop();if(l.nodesToUpdate.indexOf(x)>=0){break;}l.nodesToUpdate.push(x);}}r.length=0;v=l.parent;}else{r.push(v);v=v.parent;}}while(q.length>0){this._jointCollection.push(q.pop());}}if(this._jointCollection&&this._jointCollection.length>0){this._sequenceAssociatedWithJoints=s;this._jointCollection.forEach(function(l){if(!l.node||!l.parent){return;}l.translation=null;l.scale=null;l.quaternion=null;if(l.node.userData){l.node.userData.offsetTranslation=null;l.node.userData.offsetQuaternion=null;l.node.userData.offsetScale=null;l.node.userData.originalRotationType=null;}});this._jointCollection.forEach(function(l){this._updateJointNode(l,this._sequenceAssociatedWithJoints);}.bind(this));}return this;};
u.prototype._updateJointNode=function(j,s){if(!j.node||!j.parent){return;}if(j.translation&&j.quaternion&&j.scale){return;}var c=new Map();if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(j){if(!j.node||!j.parent){return;}c.set(j.node,j);});}var i=false;var k=this.getCurrentView();if(k){var l=k.getPlayback(0);if(l&&l.getReversed()){i=true;}}var q,r,v,x,y;var z=j.node;var D=new THREE.Matrix4();while(z){y=this.getRestTransformation(z,i);if(!y){z=z.parent;continue;}q=new THREE.Vector3(y.translation[0],y.translation[1],y.translation[2]);r=new THREE.Vector3(y.scale[0],y.scale[1],y.scale[2]);v=new THREE.Quaternion(y.quaternion[0],y.quaternion[1],y.quaternion[2],y.quaternion[3]);if(s){var E=this._getEndPropertyInPreviousSequence(z,A.Translate,s);if(E){q.x+=E[0];q.y+=E[1];q.z+=E[2];}var F=this._getEndPropertyInPreviousSequence(z,A.Scale,s);if(F){r.x*=F[0];r.y*=F[1];r.z*=F[2];}var G=this._getEndPropertyInPreviousSequence(z,A.Rotate,s);if(G){var I=new THREE.Quaternion(G[0],G[1],G[2],G[3]);v=I.multiply(v);}}x=new THREE.Matrix4().compose(q,v,r);D.premultiply(x);z=z.parent;}var J=j.parent;var P=new THREE.Matrix4();while(J){var K=c.get(J);if(K){if(!K.translation){this._updateJointNode(K);}q=new THREE.Vector3(K.translation[0],K.translation[1],K.translation[2]);r=new THREE.Vector3(K.scale[0],K.scale[1],K.scale[2]);v=new THREE.Quaternion(K.quaternion[0],K.quaternion[1],K.quaternion[2],K.quaternion[3]);J=K.parent;}else{y=this.getRestTransformation(J,i);if(!y){J=J.parent;continue;}q=new THREE.Vector3(y.translation[0],y.translation[1],y.translation[2]);r=new THREE.Vector3(y.scale[0],y.scale[1],y.scale[2]);v=new THREE.Quaternion(y.quaternion[0],y.quaternion[1],y.quaternion[2],y.quaternion[3]);J=J.parent;}x=new THREE.Matrix4().compose(q,v,r);P.premultiply(x);}var L=P.getInverse(P).multiply(D);L.decompose(q,v,r);j.translation=q.toArray();j.quaternion=v.toArray();j.scale=r.toArray();};
u.prototype._updateMaterialInNode=function(c){var j=c.target;for(var i=0,l=j.children.length;i<l;i++){var k=j.children[i];if(k.userData.animatedColor){k._vkUpdateMaterialColor();}}var q=c.materialId;if(j.userData.materialId!==q){j.userData.materialId=q;this._scene._setNodeMaterial(j,q);}};
function B(c){return new THREE.Matrix4().set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],0,0,0,1);}
u.prototype._resetNodesStatusByCurrenView=function(v,s,c){var i=this.getNodeHierarchy();if(i){var j;if(v){j=v.getPlaybacks();}var k=v.getNodeInfos();if(k){this._nodesTransitionHelper.clear();var l={nodeRefs:[],positions:[]};var q=new THREE.Vector3();var r=new THREE.Quaternion();var x=new THREE.Vector3();k.forEach(function(D){if(D.target===null){return;}function E(I,J,K){for(var L=0;L<I.elements.length;L++){if(Math.abs(I.elements[L]-J.elements[L])>K){return false;}}return true;}if(D.transform){var F=B(D.transform);if(!E(F,D.target.matrix,1e-6)){if((!j||!j.length)&&c){var G=i.createNodeProxy(D.target);this._nodesTransitionHelper.setNodeForDisplay(G,F);}else{F.decompose(q,r,x);l.nodeRefs.push(D.target);l.positions.push({translation:q.toArray(),quaternion:r.toArray(),scale:x.toArray()});}}}else if(D[A.Scale]&&D[A.Rotate]&&D[A.Translate]){l.nodeRefs.push(D.target);l.positions.push({translation:D[A.Translate].slice(),quaternion:D[A.Rotate].slice(),scale:D[A.Scale].slice()});}}.bind(this));if(v.userData&&v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation.forEach(function(D,E){if(D[A.Translate]&&D[A.Rotate]&&D[A.Scale]){l.nodeRefs.push(E);l.positions.push({translation:D[A.Translate].slice(),quaternion:D[A.Rotate].slice(),scale:D[A.Scale].slice()});}},this);}if(l.nodeRefs.length){this.setTransformation(l.nodeRefs,l.positions);}if(s){var y=[];var z=[];k.forEach(function(D){(D.visible?y:z).push(D.target);});this.setVisibilityState(i.getChildren()[0].children,false,true);this.setVisibilityState(y,true,false);this.setVisibilityState(z,false,false);this._startViewChangeNodeTransition();}}}};
u.prototype._startViewChangeNodeTransition=function(){this._nodesTransitionHelper.startDisplay(500);var c=true;this._nodesTransitionHelper.attachEventOnce("displayed",function(){c=false;});var i=function(){if(c){this._nodesTransitionHelper.displayNodesMoving();window.requestAnimationFrame(i);}}.bind(this);window.requestAnimationFrame(i);};
u.prototype._resetNodesMaterialAndOpacityByCurrenView=function(v){if(!v){return;}var c=v.getNodeInfos();if(c){c.forEach(function(j){if(!j.target){return;}this._updateMaterialInNode(j);}.bind(this));c.forEach(function(j){if(!j.target||!j.target.userData){return;}j.target.userData.opacity=j.opacity;});var i=this._scene.getSceneRef();i._vkSetOpacity(undefined,this._jointCollection);}this._selectedNodes.forEach(function(j){this._updateHighlightColor(j);}.bind(this));};
u.prototype._onViewActivated=function(c,i,j){var v=this.getViewManager();if(!v||j.source.getId()!==v){return;}this.activateView(j.view,false,j.playViewGroup,j.notAnimateCameraChange);};
u.prototype.activateView=function(v,i,c,j){this.fireViewStateApplying({view:v});this.setJoints(undefined);this._customPositionedNodes.clear();this._resetNodesMaterialAndOpacityByCurrenView(v);this._resetTransitionHighlight(v);this._resetNodesStatusByCurrenView(v,true,true);this._highlightPlayer.reset(v,this._scene);this.fireViewStateApplied({view:v,ignoreAnimationPosition:i,notAnimateCameraChange:j,playViewGroup:c});a.getEventBus().publish("sap.ui.vk","viewStateApplied",{source:this,view:v,ignoreAnimationPosition:i,notAnimateCameraChange:j,playViewGroup:c});return this;};
u.prototype.setHighlightDisplayState=function(s){if(s===h.playing){this._highlightPlayer.start((new Date()).getTime());}else if(s===h.stopped){this._highlightPlayer.stop();}else if(s===h.pausing){this._highlightPlayer.pause((new Date()).getTime());}this.fireHighlightColorChanged({highlightColor:d(e(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this;};
u.prototype._startHighlight=function(){this._highlightPlayer.start((new Date()).getTime());return this;};
u.prototype._playHighlight=function(){return this._highlightPlayer.play((new Date()).getTime());};
u.prototype._resetTransitionHighlight=function(v){this._transitionHighlightPlayer.reset();this._transitionHighlightPlayer.fadeInNodes=[];this._transitionHighlightPlayer.fadeOutNodes=[];this._transitionHighlightPlayer.setViewStateManager(this);var c=v.getNodeInfos();if(!c){return;}var j=function(r,s,x){if(!r||!r.length){return;}for(var i=0;i<r.length;i++){var y=r[i];if(y.type==="Mesh"&&(!x||(x&&!x.includes(y)))){s.push(y);}j(y.children,s,x);}};var k=[];var l=[];var q=this;c.forEach(function(i){var r=i.target;var s=r.layers.test(q._layers);if(s&&!i.visible){k.push(r);}if(!s&&i.visible){l.push(r);}});j(l,this._transitionHighlightPlayer.fadeInNodes);j(k,this._transitionHighlightPlayer.fadeOutNodes,this._transitionHighlightPlayer.fadeInNodes);};
u.prototype._startTransitionHighlight=function(c){var i=this._transitionHighlightPlayer.fadeInNodes;var j=this._transitionHighlightPlayer.fadeOutNodes;if(i&&i.length){var k=new m("FadeIn",{duration:c/500.0,opacities:[0.0,1.0],cycles:1});this._transitionHighlightPlayer.addHighlights(k,i);}if(j&&j.length){var l=new m("FadeOut",{duration:c/500.0,opacities:[1.0,0.0],cycles:1,fadeOut:true});this._transitionHighlightPlayer.addHighlights(l,j);}if((i&&i.length)||(j&&j.length)){this._transitionHighlightPlayer.start((new Date()).getTime());this._transitionHighlightPlayer.play((new Date()).getTime());return c;}else{return 0;}return 0;};
u.prototype._playTransitionHighlight=function(){return this._transitionHighlightPlayer.play((new Date()).getTime());};
u.prototype.updateRestTransformation=function(c){var i=this.getCurrentView();if(!i){return this;}var j=i.getNodeInfos();if(j){j.forEach(function(k){if(k.target!==c){return;}c.updateMatrix();var l=c.matrix.elements;var q=[l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14]];k.transform=q;});}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.parent===c||k.node===c){k.translation=null;k.scale=null;k.quaternion=null;if(k.node.userData){k.node.userData.offsetTranslation=null;k.node.userData.offsetQuaternion=null;k.node.userData.offsetScale=null;k.node.userData.originalRotationType=null;}}});this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.parent===c){this._updateJointNode(k,this._sequenceAssociatedWithJoints);this.restoreRestTransformation(k.node);}}.bind(this));this._jointCollection.forEach(function(k){if(!k.node||!k.parent){return;}if(k.node===c){this._updateJointNode(k,this._sequenceAssociatedWithJoints);}},this);}return this;};
u.prototype.restoreRestTransformation=function(c){var i=this.getCurrentView();if(!i){return this;}var j=i.getNodeInfos();if(j){j.forEach(function(l){if(l.target!==c){return;}if(l.transform){var q=B(l.transform);q.decompose(c.position,c.quaternion,c.scale);}else if(l[A.Scale]&&l[A.Rotate]&&l[A.Translate]){c.position.set(l[A.Translate][0],l[A.Translate][1],l[A.Translate][2]);c.quaternion.set(l[A.Rotate][0],l[A.Rotate][1],l[A.Rotate][2],l[A.Rotate][3]);c.scale.set(l[A.Scale][0],l[A.Scale][1],l[A.Scale][2]);}c.updateMatrix();});}var k={changed:[c],transformation:[{position:c.position.toArray(),quaternion:c.quaternion.toArray(),scale:c.scale.toArray()}]};this.fireTransformationChanged(k);return this;};
u.prototype.setRestTransformation=function(c,i,q,s){var j=this.getCurrentView();if(!j){return this;}var k=j.getNodeInfos();if(k){k.forEach(function(l){if(l.target!==c){return;}if(!i||!q||!s){if(l.transform){var r=new THREE.Vector3();var v=new THREE.Quaternion();var x=new THREE.Vector3();var y=B(l.transform);y.decompose(r,v,x);if(!i){i=[r.x,r.y,r.z];}if(!s){s=[x.x,x.y,x.z];}if(!q){q=[v.x,v.y,v.z,v.w];}}else if(l[A.Scale]&&l[A.Rotate]&&l[A.Translate]){if(!i){i=l[A.Translate].slice();}if(!s){s=l[A.Scale].slice();}if(!q){q=l[A.Rotate].slice();}}}var z=new THREE.Vector3(i[0],i[1],i[2]);var D=new THREE.Quaternion(q[0],q[1],q[2],q[3]);var E=new THREE.Vector3(s[0],s[1],s[2]);var F=new THREE.Matrix4();F.compose(z,D,E);var G=F.elements;l.transform=[G[0],G[4],G[8],G[12],G[1],G[5],G[9],G[13],G[2],G[6],G[10],G[14]];});}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(l){if(!l.node||!l.parent){return;}if(l.parent===c||l.node===c){l.translation=null;l.scale=null;l.quaternion=null;if(l.node.userData){l.node.userData.offsetTranslation=null;l.node.userData.offsetQuaternion=null;l.node.userData.offsetScale=null;l.node.userData.originalRotationType=null;}}});this._jointCollection.forEach(function(l){if(!l.node||!l.parent){return;}if(l.parent===c){this._updateJointNode(l,this._sequenceAssociatedWithJoints);this.restoreRestTransformation(l.node);}},this);this._jointCollection.forEach(function(l){if(!l.node||!l.parent){return;}if(l.node===c){this._updateJointNode(l,this._sequenceAssociatedWithJoints);}},this);}return this;};
u.prototype.getRestOpacity=function(c){var j;var k=this.getCurrentView();if(k){j=k.getNodeInfos();}var r=1;if(j&&j.length){for(var i=0;i<j.length;i++){var l=j[i];if(l.target!==c){continue;}if(l.opacity!==undefined&&l.opacity!==null){r=l.opacity;}break;}}return r;};
u.prototype.setRestOpacity=function(c,i){var j;var k=this.getCurrentView();if(k){j=k.getNodeInfos();}if(j){j.forEach(function(l){if(l.target!==c){return;}l.opacity=i;});}return this;};
u.prototype.restoreRestOpacity=function(c){var i;var j=this.getCurrentView();if(j){i=j.getNodeInfos();}if(i){i.forEach(function(k){if(k.target!==c){return;}var l=1;if(k.opacity!==undefined){l=k.opacity;}this.setOpacity(c,l);}.bind(this));}return this;};
u.prototype.updateRestOpacity=function(c){var i;var j=this.getCurrentView();if(j){i=j.getNodeInfos();}if(i){i.forEach(function(k){if(k.target!==c){return;}if(c.userData&&c.userData.opacity!==undefined&&c.userData.opacity!==null){k.opacity=c.userData.opacity;}else{delete k.opacity;}});}return this;};
u.prototype.getRestTransformationWorld=function(c){var j;var k=this.getCurrentView();if(k){j=k.getNodeInfos();}var r;if(j){var l=new THREE.Matrix4();while(c){for(var i=0;i<j.length;i++){var q=j[i];if(q.target!==c){continue;}var s;if(q.transform){s=B(q.transform);}else if(q[A.Scale]&&q[A.Rotate]&&q[A.Translate]){var v=new THREE.Vector3(q[A.Translate][0],q[A.Translate][1],q[A.Translate][2]);var x=new THREE.Quaternion(q[A.Rotate][0],q[A.Rotate][1],q[A.Rotate][2],q[A.Rotate][3]);var y=new THREE.Vector3(q[A.Scale][0],q[A.Scale][1],q[A.Scale][2]);s=new THREE.Matrix4().compose(v,x,y);}if(s){l.premultiply(s);}break;}c=c.parent;}var z=new THREE.Vector3();var D=new THREE.Quaternion();var E=new THREE.Vector3();l.decompose(z,D,E);r={};r.translation=z.toArray();r.quaternion=D.toArray();r.scale=E.toArray();}if(!r){r=this.getTransformationWorld(c);}return r;};
u.prototype.getRestTransformation=function(c,i){var j;var k=this.getCurrentView();if(k){j=k.getNodeInfos();}var r;if(j){j.forEach(function(l){if(l.target!==c){return;}if(l.transform){var q=l.transform;var s=new THREE.Vector3();var v=new THREE.Quaternion();var x=new THREE.Vector3();var y=B(l.transform);y.decompose(s,v,x);if(i){var z=this._getEndPropertyInLastSequence(c,A.Translate);if(z){s.x-=z[0];s.y-=z[1];s.z-=z[2];}var D=this._getEndPropertyInLastSequence(c,A.Scale);if(D){x.x/=D[0];x.y/=D[1];x.z/=D[2];}var E=this._getEndPropertyInLastSequence(c,A.Rotate);if(E){var F=new THREE.Quaternion(E[0],E[1],E[2],E[3]);v=F.inverse().normalize().multiply(v);}y.compose(s,v,x);var G=y.elements;q=[G[0],G[4],G[8],G[12],G[1],G[5],G[9],G[13],G[2],G[6],G[10],G[14]];}r={};r.translation=s.toArray();r.quaternion=v.toArray();r.scale=x.toArray();r.transformRowWise=q;r.transformColumnWise=[q[0],q[4],q[8],q[1],q[5],q[9],q[2],q[6],q[10],q[3],q[7],q[11]];}else if(l[A.Scale]&&l[A.Rotate]&&l[A.Translate]){r={};r.translation=l[A.Translate].slice();r.quaternion=l[A.Rotate].slice();r.scale=l[A.Scale].slice();}}.bind(this));}if(!r&&c){r={};r.translation=c.userData.position?c.userData.position.toArray():c.position.toArray();r.quaternion=c.userData.quaternion?c.userData.quaternion.toArray():c.quaternion.toArray();r.scale=c.userData.scale?c.userData.scale.toArray():c.scale.toArray();r.matrix=c.matrix.clone();}return r;};
u.prototype._addToTransformation=function(c,j,q,s,k){var r={};var i;if(j){r.translation=[];for(i=0;i<3;i++){r.translation.push(j[i]+c.translation[i]);}}else{r.translation=c.translation;}if(s){r.scale=[];for(i=0;i<3;i++){r.scale.push(s[i]*c.scale[i]);}}else{r.scale=c.scale;}if(q){var l=new THREE.Quaternion(q[0],q[1],q[2],q[3]);var v=new THREE.Matrix4().makeRotationFromQuaternion(l);var x=new THREE.Quaternion(c.quaternion[0],c.quaternion[1],c.quaternion[2],c.quaternion[3]);var y=new THREE.Matrix4().makeRotationFromQuaternion(x);y.premultiply(v);x.setFromRotationMatrix(y);r.quaternion=[x.x,x.y,x.z,x.w];}else{r.quaternion=c.quaternion;}return r;};
u.prototype.addToRestTransformation=function(c,i,q,s,j){var k=false;var l=this.getCurrentView();if(l){var r=l.getPlayback(0);if(r&&r.getReversed()){k=true;}}var v=this.getRestTransformation(c,k);if(!c.userData){c.userData={};}if(i){c.userData.offsetTranslation=i;}else{c.userData.offsetTranslation=null;}if(s){c.userData.offsetScale=s;}else{c.userData.offsetScale=null;}if(q){c.userData.offsetQuaternion=q;c.userData.originalRotationType=j;}else{c.userData.offsetQuaternion=null;c.userData.originalRotationType=null;}return this._addToTransformation(v,i,q,s,j);};
u.prototype._setJointNodeMatrix=function(){if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(j){if(!j.node||!j.parent){return;}var c=j.node;if(c.userData.skipUpdateJointNode){return;}var i={};i.translation=j.translation.slice();i.scale=j.scale.slice();i.quaternion=j.quaternion.slice();var k=this._addToTransformation(i,c.userData.offsetTranslation,c.userData.offsetQuaternion,c.userData.offsetScale,c.userData.originalRotationType);c.position.fromArray(k.translation);c.scale.fromArray(k.scale);c.quaternion.fromArray(k.quaternion);c.updateMatrix();var l=c.quaternion.clone();var q=new THREE.Matrix4();if(j.parent){j.parent.updateMatrixWorld();q=j.parent.matrixWorld.clone();c.matrixWorld.multiplyMatrices(j.parent.matrixWorld,c.matrix);}else{c.matrixWorld.copy(c.matrix);}var r=new THREE.Matrix4();if(c.parent){r=c.parent.matrixWorld.clone();c.matrix.getInverse(c.parent.matrixWorld).multiply(c.matrixWorld);}else{c.matrix.copy(c.matrixWorld);}c.matrix.decompose(c.position,c.quaternion,c.scale);var s=[c.scale.x,c.scale.y,c.scale.z];this._adjustQuaternionAndScale(q,r,l,c.quaternion,k.scale,s);c.scale.x=s[0];c.scale.y=s[1];c.scale.z=s[2];if(j.nodesToUpdate){j.nodesToUpdate.forEach(function(v){if(v.matrixAutoUpdate){v.updateMatrix();}v.matrixWorld.multiplyMatrices(v.parent.matrixWorld,v.matrix);});}}.bind(this));}};
u.prototype._getEndPropertyInLastSequence=function(c,i){var j;var l=this.getCurrentView();if(!l){return j;}var q=l.getPlaybacks();if(!q||!q.length){return j;}for(var k=q.length-1;k>=0;k--){var r=q[k];var s=r.getSequence();if(s._convertedFromAbsolute){return j;}if(s){j=s.getNodeBoundaryProperty(c,i,true);if(j){break;}}}return j;};
u.prototype._getEndPropertyInPreviousSequence=function(c,k,s){var l;if(s&&s._convertedFromAbsolute){return l;}var q=this.getCurrentView();if(!q){return l;}var r=q.getPlaybacks();for(var i=1;i<r.length;i++){var v=r[i];var x=v.getSequence();if(x!==s){continue;}for(var j=i-1;j>=0;j--){var y=r[j];var z=y.getSequence();if(z){l=z.getNodeBoundaryProperty(c,k,true);if(l){break;}}}}return l;};
u.prototype._convertTracksToRelative=function(s,c){if((c&&s._convertionDoneForReversed)||(!c&&s._convertionDone)){return this;}s._convertedFromAbsolute=false;var k=this.getCurrentView();if(!k){return this;}var l=s.getNodeAnimation();if(!l||!l.length){return this;}var v=k.getNodeInfos();if(v){v.forEach(function(x){var y;for(var i=0;i<l.length;i++){if(x.target===l[i].nodeRef){y=l[i];break;}}if(!y){return;}var z=[0,0,0];var D=[1,1,1];var E=new THREE.Quaternion();var F=new THREE.Vector3();var G=new THREE.Vector3();if(x.transform){var I=B(x.transform);I.decompose(F,E,G);z=F.toArray();D=G.toArray();}else if(x[A.Scale]&&x[A.Rotate]&&x[A.Translate]){z=x[A.Translate].slice();E=new THREE.Quaternion(x[A.Rotate][0],x[A.Rotate][1],x[A.Rotate][2],x[A.Rotate][3]);D=x[A.Scale].slice();}else{x.target.matrix.decompose(F,E,G);z=F.toArray();D=G.toArray();}var j,J,K,L;var M=y[A.Translate];if(M&&M.getIsAbsoluteValue()){J=M.getKeysCount();for(j=0;j<J;j++){K=M.getKey(j);L=[K.value[0]-z[0],K.value[1]-z[1],K.value[2]-z[2]];M.updateKey(j,L,true);}M.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}var P=y[A.Scale];if(P&&P.getIsAbsoluteValue()){J=P.getKeysCount();for(j=0;j<J;j++){K=P.getKey(j);L=[K.value[0]/D[0],K.value[1]/D[1],K.value[2]/D[2]];P.updateKey(j,L,true);}P.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}var Q=y[A.Opacity];if(Q&&Q.getIsAbsoluteValue()){var T=this.getRestOpacity(x.target);if(!T){T=1.0;}J=Q.getKeysCount();for(j=0;j<J;j++){K=Q.getKey(j);L=K.value/T;Q.updateKey(j,L,true);}Q.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}var U=function(d1){var e1=0;var f1=2*Math.PI;if(d1>0){while(d1>f1-0.0001){e1+=f1;d1-=f1;}}else if(d1<0){while(d1<-f1+0.0001){e1-=f1;d1+=f1;}}return e1;};var W=y[A.Rotate];if(W&&W.getIsAbsoluteValue()){var X;var Y=new THREE.Matrix4().makeRotationFromQuaternion(E);var Z=new THREE.Matrix4().getInverse(Y);var $=new THREE.Matrix4();var _=new THREE.Matrix4();J=W.getKeysCount();var a1=W.getKeysType();for(j=0;j<J;j++){K=W.getKey(j);if(a1===n.Quaternion){X=new THREE.Quaternion(K.value[0],K.value[1],K.value[2],K.value[3]);$.makeRotationFromQuaternion(X);_.multiplyMatrices($,Z);X.setFromRotationMatrix(_);L=X.toArray();W.updateKey(j,L,true);}else if(a1===n.Euler){var q=o.neutralEulerToGlMatrixQuat(K.value);var r=o.glMatrixQuatToNeutral(q);X=new THREE.Quaternion(r[0],r[1],r[2],r[3]);$=new THREE.Matrix4().makeRotationFromQuaternion(X);_.multiplyMatrices($,Z);X.setFromRotationMatrix(_);var b1=o.neutralQuatToNeutralEuler(X,K.value[3]);L=[b1[0]+U(K.value[0]),b1[1]+U(K.value[1]),b1[2]+U(K.value[2]),K.value[3]];W.updateKey(j,L,true);}else if(j===0){var c1=new THREE.Vector3(K.value[0],K.value[1],K.value[2]);$.makeRotationAxis(c1,K.value[3]);_.multiplyMatrices($,Z);X=new THREE.Quaternion().setFromRotationMatrix(_);L=this._convertQuaternionToAngleAxis(X);W.updateKey(j,L,true);break;}}W.setIsAbsoluteValue(false);s._convertedFromAbsolute=true;}}.bind(this));}if(!c){s._convertionDone=true;s._convertionDoneForReversed=false;}else{s._convertionDone=false;s._convertionDoneForReversed=true;}return this;};
u.prototype._getTrackKeys=function(c){var k=[];var i=c.getKeysCount();for(var j=0;j<i;j++){var l=c.getKey(j);var v;if(Array.isArray(l.value)){v=l.value.slice();}else{v=l.value;}k.push({time:l.time,value:v});}return k;};
u.prototype._setJointNodeOffsets=function(c,i){var j=this._getJointByChildNode(c);if(j){var k=new THREE.Matrix4();if(c.parent){k=c.parent.matrixWorld.clone();}var l=new THREE.Matrix4();c.updateMatrixWorld();var q=new THREE.Matrix4();if(j.parent){j.parent.updateMatrixWorld();q=j.parent.matrixWorld.clone();l.getInverse(j.parent.matrixWorld).multiply(c.matrixWorld);}else{l.copy(c.matrixWorld);}var r=new THREE.Vector3();var s=new THREE.Vector3();var v=new THREE.Quaternion();l.decompose(r,v,s);if(i===A.Translate){var x=r.toArray();c.userData.offsetTranslation=[x[0]-j.translation[0],x[1]-j.translation[1],x[2]-j.translation[2]];}else if(i===A.Scale){var y=s.toArray();this._adjustQuaternionAndScale(k,q,c.quaternion,v,c.scale.toArray(),y);c.userData.offsetScale=[y[0]/j.scale[0],y[1]/j.scale[1],y[2]/j.scale[2]];}else{this._adjustQuaternionAndScale(k,q,c.quaternion,v,c.scale.toArray(),s.toArray());var z=new THREE.Quaternion(j.quaternion[0],j.quaternion[1],j.quaternion[2],j.quaternion[3]);var D=new THREE.Matrix4().makeRotationFromQuaternion(z);var E=new THREE.Matrix4().getInverse(D);var M=new THREE.Matrix4().makeRotationFromQuaternion(v);var F=new THREE.Matrix4().multiplyMatrices(M,E);var G=new THREE.Quaternion().setFromRotationMatrix(F);c.userData.offsetQuaternion=G.toArray();}}return this;};
u.prototype.setTranslationKey=function(c,i,s){var r;var j=false;var k=this.getCurrentView();if(k){var l=k.getPlayback(0);if(l&&l.getReversed()){j=true;}}var q=new THREE.Vector3();c.matrix.decompose(q,new THREE.Quaternion(),new THREE.Vector3());var v=this._getJointByChildNode(c);if(v){r=v.translation.slice();c.updateMatrixWorld();var x=new THREE.Matrix4();if(v.parent){v.parent.updateMatrixWorld();x.getInverse(v.parent.matrixWorld).multiply(c.matrixWorld);}else{x.matrix.copy(c.matrixWorld);}x.decompose(q,new THREE.Quaternion(),new THREE.Vector3());}else{var y=this.getRestTransformation(c,j);r=y.translation;}var z=q.toArray();var D=[z[0]-r[0],z[1]-r[1],z[2]-r[2]];var E=this._getEndPropertyInPreviousSequence(c,A.Translate,s);if(E){D[0]-=E[0];D[1]-=E[1];D[2]-=E[2];}var F=s.getNodeAnimation(c,A.Translate);var G;if(!F){F=this._scene.createTrack(null,{trackValueType:n.Vector3,isAbsoluteValue:false});s.setNodeAnimation(c,A.Translate,F,true);}else{G=this._getTrackKeys(F);}F.insertKey(i,D);var I=this._getTrackKeys(F);return{KeyValue:D,absoluteValue:z,offset:E,PreviousTrack:G,CurrentTrack:I};};
u.prototype._adjustQuaternionAndScale=function(c,j,q,k,s,l){function r(v,Q,T,U){var W=Math.abs(v.dot(Q));var X=Math.abs(v.dot(T));var Y=Math.abs(v.dot(U));if(W>=X&&W>=Y){return 0;}else if(X>=W&&X>=Y){return 1;}else{return 2;}}if(s[0]>0&&s[1]>0&&s[2]>0){return;}var x=c.clone().multiply(new THREE.Matrix4().makeRotationFromQuaternion(q));var y=new THREE.Matrix4().makeRotationFromQuaternion(k);var z=j.clone().multiply(y);var D=new THREE.Vector3();var E=new THREE.Vector3();var F=new THREE.Vector3();x.extractBasis(D,E,F);var G=[D,E,F];var I=new THREE.Vector3();var J=new THREE.Vector3();var K=new THREE.Vector3();z.extractBasis(I,J,K);var L=[1,1,1];for(var i=0;i<3;i++){var M=r(G[i],I,J,K);if(s[i]*l[M]<0){L[M]=-1;l[M]=-l[M];}}y.scale(new THREE.Vector3(L[0],L[1],L[2]));var P=new THREE.Quaternion().setFromRotationMatrix(y);k.x=P.x;k.y=P.y;k.z=P.z;k.w=P.w;};
u.prototype.setScaleKey=function(c,i,s){var r;var j=false;var k=this.getCurrentView();if(k){var l=k.getPlayback(0);if(l&&l.getReversed()){j=true;}}var q=c.scale.toArray();var v=c.quaternion.clone();var x=this._getJointByChildNode(c);if(x){var y=new THREE.Matrix4();if(c.parent){y=c.parent.matrixWorld.clone();}r=x.scale.slice();c.updateMatrixWorld();var z=new THREE.Matrix4();var D=new THREE.Matrix4();if(x.parent){x.parent.updateMatrixWorld();D=x.parent.matrixWorld.clone();z.getInverse(x.parent.matrixWorld).multiply(c.matrixWorld);}else{z.copy(c.matrixWorld);}var E=new THREE.Quaternion();var F=new THREE.Vector3();z.decompose(new THREE.Vector3(),E,F);var G=F.toArray();this._adjustQuaternionAndScale(y,D,v,E,q,G);q=G;}else{var I=this.getRestTransformation(c,j);r=I.scale;}var J=[q[0]/r[0],q[1]/r[1],q[2]/r[2]];var K=this._getEndPropertyInPreviousSequence(c,A.Scale,s);if(K){J[0]/=K[0];J[1]/=K[1];J[2]/=K[2];}var L=s.getNodeAnimation(c,A.Scale);var M;if(!L){L=this._scene.createTrack(null,{trackValueType:n.Vector3,isAbsoluteValue:false});s.setNodeAnimation(c,A.Scale,L,true);}else{M=this._getTrackKeys(L);}L.insertKey(i,J);var P=this._getTrackKeys(L);return{KeyValue:J,absoluteValue:q,offset:K,PreviousTrack:M,CurrentTrack:P};};
u.prototype.setRotationKey=function(c,i,j,s){var k=36;var v=[j[0],j[1],j[2],k];var l=s.getNodeAnimation(c,A.Rotate);if(l&&l.getKeysType()!==n.Euler){return null;}var q;if(!l){l=this._scene.createTrack(null,{trackValueType:n.Euler,isAbsoluteValue:false});s.setNodeAnimation(c,A.Rotate,l,true);}else{q=this._getTrackKeys(l);}l.insertKey(i,v);var r=this._getTrackKeys(l);var x=new THREE.Quaternion();var y=new THREE.Euler(j[0],j[1],j[2]);x.setFromEuler(y);var z=this._getEndPropertyInPreviousSequence(c,A.Rotate,s);if(z){var D=new THREE.Quaternion(z[0],z[1],z[2],z[3]);x.multiply(D);}var E=new THREE.Quaternion();var F=this._getJointByChildNode(c);if(F){E.fromArray(F.quaternion);}else{var G=false;var I=this.getCurrentView();if(I){var J=I.getPlayback(0);if(J&&J.getReversed()){G=true;}}var K=this.getRestTransformation(c,G);E.fromArray(K.quaternion);}x.multiply(E);return{KeyValue:v,absoluteValue:x.toArray(),offset:z,PreviousTrack:q,CurrentTrack:r};};
u.prototype.getTotalOpacity=function(c){return c._vkGetTotalOpacity(this._jointCollection);};
u.prototype.setTotalOpacity=function(c,i){var j=1;var k=this._getJointByChildNode(c);if(k&&k.parent){j=k.parent._vkGetTotalOpacity(this._jointCollection);}else if(c.parent){j=c.parent._vkGetTotalOpacity(this._jointCollection);}if(!c.userData){c.userData={};}var l=this.getOpacity(c);if(j!==0.0){l=i/j;}else{i=0.0;}c._vkSetOpacity(l,this._jointCollection);var q={changed:c,opacity:l};this.fireOpacityChanged(q);return{opacity:l,totalOpacity:i};};
u.prototype.setOpacityKey=function(c,i,s){var v=1;if(c.userData&&c.userData.opacity!==undefined&&c.userData.opacity!==null){v=c.userData.opacity;}var r=this.getRestOpacity(c);if(!r&&s._convertedFromAbsolute){r=1;}v/=r;var j=this._getEndPropertyInPreviousSequence(c,A.Opacity,s);if(j){v/=j;}var k=s.getNodeAnimation(c,A.Opacity);var l;if(!k){k=this._scene.createTrack(null,{trackValueType:n.Opacity});s.setNodeAnimation(c,A.Opacity,k,true);}else{l=this._getTrackKeys(k);}k.insertKey(i,v);var q=this._getTrackKeys(k);return{KeyValue:v,totalOpacity:this.getTotalOpacity(c),PreviousTrack:l,CurrentTrack:q};};
p=function(){this._visibilityChanges=new Set();};
p.prototype.getInfo=function(c){var i=[];this._visibilityChanges.forEach(function(j){var k=c.createNodeProxy(j);var v=k.getVeId();c.destroyNodeProxy(k);if(v){i.push(v);}else{i.push(c.getScene().nodeRefToPersistentId(j));}});return i;};
p.prototype.clear=function(){this._visibilityChanges.clear();};
p.prototype.trackNodeRef=function(c){if(this._visibilityChanges.has(c)){this._visibilityChanges.delete(c);}else{this._visibilityChanges.add(c);}};
C.injectMethodsIntoClass(u);return u;});
sap.ui.predefine('sap/ui/vk/threejs/Viewport',["jquery.sap.global","../Core","../ViewportBase","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","./thirdparty/three","../ContentConnector","../ViewStateManager","./ViewportGestureHandler","./OrthographicCamera","./PerspectiveCamera","./NodesTransitionHelper","../Messages","sap/ui/base/ManagedObjectObserver","./ViewportRenderer","../CameraProjectionType","../CameraFOVBindingType","../VisibilityMode","../ZoomTo","../SelectionMode","../RenderMode","../getResourceBundle","../cssColorToColor","../ViewStateManager","./ViewStateManager","./HitTester","./Scene","./ContentDeliveryService","../SafeArea","../Annotation","../NodeContentType"],function(q,v,V,R,K,L,t,C,c,d,O,P,N,M,e,f,g,h,j,Z,S,k,m,o,p,T,H,r,s,u,A,w){"use strict";
var B=V.extend("sap.ui.vk.threejs.Viewport",{metadata:{library:"sap.ui.vk",events:{cameraChanged:{parameters:{position:"float[]",quaternion:"float[]",zoom:"float"},enableEventBubbling:true},frameRenderingFinished:{}}}});
var D=B.getMetadata().getParent().getClass().prototype;THREE.PropertyBinding.prototype.GetterByBindingType[0]=function(b,a){b[a]=this.targetObject[this.propertyName];};
B.prototype.init=function(){if(D.init){D.init.call(this);}this._resizeListenerId=null;this._renderLoopRequestId=0;this._renderLoopFunction=this._renderLoop.bind(this);this._shouldRenderFrame=true;this._clippingPlanes=[];this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._renderer.shadowMap.enabled=true;this._hitTester=new H();this._scene=null;this._camera=new P();this._upAxis=2;var b=new THREE.Vector4();var a=new THREE.Vector4();this._updateColor(b,this.getBackgroundColorTop());this._updateColor(a,this.getBackgroundColorBottom());this._checkBackgroundColor();this._backgroundMaterial=new THREE.ShaderMaterial({uniforms:{topColor:{value:b},bottomColor:{value:a}},vertexShader:["varying float vPos;","void main() {","	gl_Position = vec4(position, 1.0);","	vPos = position.y * -0.5 + 0.5;","}"].join("\n"),fragmentShader:["uniform vec4 topColor;","uniform vec4 bottomColor;","varying float vPos;","void main() {","	gl_FragColor = mix(topColor, bottomColor, vPos);","}"].join("\n"),side:THREE.DoubleSide,depthTest:false,depthWrite:false,blending:THREE.NoBlending});var i=new THREE.Geometry();i.vertices.push(new THREE.Vector3(-1,1,0),new THREE.Vector3(1,1,0),new THREE.Vector3(-1,-1,0),new THREE.Vector3(1,-1,0));i.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));this._backgroundCamera=new THREE.Camera();this._backgroundScene=new THREE.Scene();this._backgroundScene.add(new THREE.Mesh(i,this._backgroundMaterial));this._xrayColor1=new THREE.Vector4(0,0.75,1,0.45);this._xrayColor2=new THREE.Vector4(0,0,1,0);this._xrayMaterial=new THREE.ShaderMaterial({uniforms:{color1:{value:this._xrayColor1},color2:{value:this._xrayColor2}},vertexShader:["#include <clipping_planes_pars_vertex>","varying vec3 vNormal;","void main() {","#include <begin_vertex>","#include <project_vertex>","#include <clipping_planes_vertex>","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","	vNormal = normalize( transformedNormal );","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","uniform vec4 color1;","uniform vec4 color2;","varying vec3 vNormal;","void main() {","#include <clipping_planes_fragment>","	gl_FragColor = mix(color1, color2, abs(normalize(vNormal).z));","}"].join("\n"),side:THREE.DoubleSide,depthWrite:false,depthFunc:THREE.LessDepth,blending:THREE.NormalBlending,clipping:true,transparent:true});this._viewportGestureHandler=new d(this);this._loco=new L(this);this._loco.addHandler(this._viewportGestureHandler,-1);this._zoomedObject=null;this._cdsLoader=null;this.attachCameraChanged(function(l){this.setShouldRenderFrame();});this._sceneObserver=new e(this.setShouldRenderFrame.bind(this));this._currentViewIndex=0;this._currentView=null;v.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewApplied,this);};
B.prototype.cameraUpdateCompleted=function(a){this.fireViewFinished({viewIndex:this._currentViewIndex});};
B.prototype.exit=function(){v.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewApplied,this);this._loco.removeHandler(this._viewportGestureHandler);this._viewportGestureHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();this.setScene(null);this.setCamera(null);this._renderer=null;this._backgroundCamera=null;this._backgroundMaterial=null;this._backgroundScene=null;this._loco=null;this._viewportGestureHandler=null;if(this._cdsLoader){this._cdsLoader.detachSceneUpdated(this._handleCdsSceneUpdate,this);}if(D.exit){D.exit.call(this);}};
B.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};
B.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=0;}return this;};
B.prototype.setBackgroundColorTop=function(a){D.setBackgroundColorTop.call(this,a);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.topColor.value,a);this._checkBackgroundColor();}return this;};
B.prototype.setBackgroundColorBottom=function(a){D.setBackgroundColorBottom.call(this,a);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.bottomColor.value,a);this._checkBackgroundColor();}return this;};
B.prototype.setClippingPlanes=function(a){this._clippingPlanes=a;return this;};
B.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();};
B.prototype.onAfterRendering=function(){var a=this.getDomRef();a.appendChild(this._renderer.domElement);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:a.clientWidth,height:a.clientHeight}});this._startRenderLoop();};
B.prototype._handleResize=function(a){if(!this._camera||!this._renderer){return false;}this.getSafeArea().resize();var b=a.size.width;var i=a.size.height;if(this._camera){this._camera.update(b,i);}this._renderer.setSize(b,i);this.fireResize({size:{width:b,height:i}});this.setShouldRenderFrame();return true;};
B.prototype.setScene=function(a){if(this._scene){var n=this._scene.getDefaultNodeHierarchy();n.detachChanged(this._clearAnnotations,this);n.detachNodeCreated(this._nodeCreatedHandler,this);}this._scene=a;this._homeCamera=null;this._currentViewIndex=0;this._currentView=null;this._sceneObserver.disconnect();var b=this._getNativeScene();if(b){this._sceneObserver.observe(this._scene,{properties:["doubleSided"]});var l;for(var i=0;i<b.children.length;i++){l=b.children[i];if(l.private&&l.name==="DefaultLights"&&l.children.length){if(l.children[0]instanceof THREE.PointLight){this._eyePointLight=l.children[0];}}}}if(this._scene){this._scene.getDefaultNodeHierarchy().attachChanged(this._clearAnnotations,this);this._scene.getDefaultNodeHierarchy().attachNodeCreated(this._nodeCreatedHandler,this);}this._clearAnnotations();this.setShouldRenderFrame();return this;};
B.prototype.getScene=function(){return this._scene;};
B.prototype._getNativeScene=function(){return this._scene?this._scene.getSceneRef():null;};
B.prototype._getNativeCamera=function(){return this._camera?this._camera.getCameraRef():null;};
B.prototype._clearAnnotations=function(){this.destroyAnnotations();this._annotationsLoaded=false;};
B.prototype._nodeCreatedHandler=function(a){var n=a.getParameter("nodeRef");if(n._vkGetNodeContentType()==w.Annotation){var b=this.getCurrentView();if(b){b.getNodeInfos().push({target:n,visible:true});}}};
var E=new THREE.Vector2();
B.prototype.setCamera=function(a){if(D.setCamera){D.setCamera.call(this,a);}var b=this.getCamera();if(b&&this._renderer){this._renderer.getSize(E);b.update(E.x,E.y);if(!this._homeCamera&&b.getCameraRef()){this._homeCamera=b.getCameraRef().clone();}}this.setShouldRenderFrame();return this;};
B.prototype.getRenderer=function(){return this._renderer;};
B.prototype._getViewStateManagerThreeJS=function(){if(this._viewStateManager){if(this._viewStateManager instanceof T){return this._viewStateManager;}if(this._viewStateManager instanceof p&&this._viewStateManager._implementation instanceof T){return this._viewStateManager._implementation;}}return null;};
B.prototype._getLayers=function(){var a=this._getViewStateManagerThreeJS();return a?a._layers:null;};
B.prototype._updateBoundingBoxesIfNeeded=function(){var a=this._getViewStateManagerThreeJS();if(a){a._updateBoundingBoxesIfNeeded();}};
B.prototype._updateColor=function(a,b){var i=o(b);a.color=new THREE.Color(i.red/255,i.green/255,i.blue/255);a.alpha=i.alpha;a.x=a.color.r*a.alpha;a.y=a.color.g*a.alpha;a.z=a.color.b*a.alpha;a.w=a.alpha;};
B.prototype._checkBackgroundColor=function(){var a=this.getBackgroundColorTop();if(a===this.getBackgroundColorBottom()){if(this._backgroundColor===null){this._backgroundColor=new THREE.Vector4();}this._updateColor(this._backgroundColor,a);}else{this._backgroundColor=null;}this.setShouldRenderFrame();};
B.prototype._handleCdsSceneUpdate=function(){this.setShouldRenderFrame();};
B.prototype.setShouldRenderFrame=function(){this._shouldRenderFrame=true;return this;};
B.prototype.shouldRenderFrame=function(){return this._shouldRenderFrame;};
B.prototype.setRenderMode=function(a){this.setProperty("renderMode",a,true);if(this._scene){switch(a){case k.LineIllustration:case k.ShadedIllustration:case k.SolidOutline:this._scene._createOutlineGeometry(a);break;default:this._scene._hideOutlineGeometry();break;}}this.setShouldRenderFrame();return this;};
B.prototype.hitTest=function(x,y){var n=this._getNativeScene();var a=this._getNativeCamera();if(!a||!n){return null;}var b=this._renderer.domElement;return this._hitTester.hitTest(x-b.clientLeft,y-b.clientTop,b.clientWidth,b.clientHeight,this._renderer,n,a,this._clippingPlanes);};
B.prototype._isRedlineActivated=function(){var n=this._getNativeCamera();return n?n.userData.isRedlineActivated:false;};
B.prototype.tap=function(x,y,i){if(!i){if(this._viewStateManager){var a=this.hitTest(x,y);var n=a&&a.object;this.tapObject(n);if(n!==null){this.fireNodeClicked({nodeRef:n,x:x,y:y},true,true);}}}else if(!this.getFreezeCamera()&&!this._isRedlineActivated()){var b=this.hitTest(x,y);if(b&&(this._zoomedObject===null||this._zoomedObject!==b.object)){this._zoomedObject=b.object;this._viewportGestureHandler.zoomObject(this._zoomedObject,true);}else{this._viewportGestureHandler.zoomObject(this._zoomedObject,false);this._zoomedObject=null;}}return this;};
B.prototype.tapObject=function(n){var a={picked:n?[n]:[]};this.fireNodesPicked(a);if(this.getSelectionMode()===S.Exclusive){this.exclusiveSelectionHandler(a.picked);}else if(this.getSelectionMode()===S.Sticky){this.stickySelectionHandler(a.picked);}return this;};
var F={x:-2,y:-2};var G=2;var I=5;
B.prototype.onkeydown=function(a){if(!a.isMarked()){var b;switch(a.keyCode){case K.ARROW_LEFT:case K.ARROW_RIGHT:case K.ARROW_UP:case K.ARROW_DOWN:if(a.ctrlKey||a.altKey||a.metaKey){break;}var i={x:0,y:0};switch(a.keyCode){case K.ARROW_LEFT:i.x=-1;break;case K.ARROW_RIGHT:i.x=+1;break;case K.ARROW_UP:i.y=-1;break;case K.ARROW_DOWN:i.y=+1;break;default:break;}b=this._viewportGestureHandler._cameraController;b.beginGesture(F.x,F.y);if(a.shiftKey){b.pan(I*i.x,I*i.y);}else{b.rotate(G*i.x,G*i.y,true);}b.endGesture();this.setShouldRenderFrame();a.preventDefault();a.stopPropagation();break;case 189:case K.PLUS:case K.NUMPAD_MINUS:case K.NUMPAD_PLUS:b=this._viewportGestureHandler._cameraController;b.beginGesture(this.$().width()/2,this.$().height()/2);b.zoom(a.keyCode===K.PLUS||a.keyCode===K.NUMPAD_PLUS?1.02:0.98);b.endGesture();this.setShouldRenderFrame();a.preventDefault();a.stopPropagation();break;default:break;}}};
B.prototype._handleVisibilityChanged=B.prototype._handleOpacityChanged=B.prototype._handleTintColorChanged=B.prototype._handleHighlightColorChanged=B.prototype._handleTransformationChanged=B.prototype._handleOutlineColorChanged=B.prototype._handleOutlineWidthChanged=function(a){this.setShouldRenderFrame();};B.prototype._handleOutliningChanged=B.prototype._handleSelectionChanged=function(a){var b=this.getTools();for(var i=0;i<b.length;i++){var l=sap.ui.getCore().byId(b[i]);var n=l.getGizmoForContainer(this);if(n&&n.handleSelectionChanged){n.handleSelectionChanged(a);}}this.setShouldRenderFrame();};
B.prototype.setSelectionRect=function(a){this.setShouldRenderFrame();if(!a){this._selectionRect=null;return;}this._renderer.getSize(E);var x=(a.x1/E.x)*2-1,y=(a.y1/E.y)*-2+1,b=(a.x2/E.x)*2-1,i=(a.y2/E.y)*-2+1;if(!this._selectionRect){var l=new THREE.Geometry();l.vertices.push(new THREE.Vector3(x,i,-1),new THREE.Vector3(b,i,-1),new THREE.Vector3(b,y,-1),new THREE.Vector3(x,y,-1));this._selectionRect=new THREE.LineLoop(l,new THREE.LineBasicMaterial({color:0xC0C000,linewidth:window.devicePixelRatio}));}else{var n=this._selectionRect.geometry.vertices;n[0].set(x,i,-1);n[1].set(b,i,-1);n[2].set(b,y,-1);n[3].set(x,y,-1);this._selectionRect.geometry.verticesNeedUpdate=true;}};
B.prototype._renderLoop=function(){if(!this._renderer||!this.getDomRef()){this._renderLoopRequestId=0;return;}if(this._viewportGestureHandler){this._viewportGestureHandler.animateCameraUpdate();}if(this.getCamera()){if(this.getCamera().getIsModified()){this.getCamera().setIsModified(false);this._shouldRenderFrame=true;}}if(this._shouldRenderFrame){var a=this._getViewStateManagerThreeJS();if(a){a._setJointNodeMatrix();}this._shouldRenderFrame=false;this.render();var b=this.getAnnotations();if(b){b.forEach(function(i){i.update();});}}this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};
function _(a,b,i){a.getSize(E);i.children.forEach(function(l){if(l.userData._vkDynamicObjects){l.userData._vkDynamicObjects.forEach(function(n){if(n.layers.test(b.layers)){n._vkUpdate(a,b,E);}});}});}
function J(i,l,n,x,y){n.children.forEach(function(z){if(z.userData._vkDetailViews){z.userData._vkDetailViews.sort(function(a,b){return a.renderOrder-b.renderOrder;});z.userData._vkDetailViews.forEach(function(a){if(a.node.layers.test(l.layers)){a.detailView._render(i,l,n,x,y);}});}});}
function Q(n,a){n.matrixAutoUpdate=false;if(n.matrixWorldNeedsUpdate||a){if(n.parent===null){n.matrixWorld.copy(n.matrix);}else{n.matrixWorld.multiplyMatrices(n.parent.matrixWorld,n.matrix);}n.matrixWorldNeedsUpdate=false;a=true;}var b=n.children;for(var i=0,l=b.length;i<l;i++){Q(b[i],a);}}
B.prototype.render=function(){var a=this._renderer;if(!a){return;}var n=this._getNativeScene();var b=this._getNativeCamera();if(!n||!b){return;}if(this._eyePointLight){this._eyePointLight.position.copy(b.position);this._eyePointLight.updateMatrix();}Q(n,false);n.autoUpdate=false;var l=this._getLayers();b.layers.mask=l?l.mask:(1|0);var x=this.getTools();var y=this._getViewStateManagerThreeJS();var i,z,U,W;if(this._camera.getUsingDefaultClipPlanes()||(b.isOrthographicCamera&&b.zoom<=0)){W=this._scene._computeBoundingBox(l,false,true);if(y){y._selectedNodes.forEach(function($){$._expandBoundingBox(W,null,false,false);});}if(!W.isEmpty()){if(b.isOrthographicCamera&&b.zoom<=0){this._camera.adjustZoom(W);}if(this._camera.getUsingDefaultClipPlanes()){for(i=0;i<x.length;i++){z=sap.ui.getCore().byId(x[i]);U=z.getGizmoForContainer(this);if(U&&U.expandBoundingBox){U.expandBoundingBox(W);}}this._camera.adjustClipPlanes(W);}}}_(a,b,n);a.clippingPlanes=this._clippingPlanes;switch(this.getRenderMode()){case k.XRay:if(y){var X=n.children[n.children.length-1].clone();y._selectedNodes.forEach(function($){if($.layers.test(b.layers)){$.add(X);a.render($,b);a.autoClear=false;$.remove(X);}});}n.overrideMaterial=this._xrayMaterial;break;case k.LineIllustration:case k.ShadedIllustration:case k.SolidOutline:this._scene._outlineMaterial.linewidth=this._renderer.getPixelRatio();break;default:break;}a.autoClear=this._backgroundColor!=null;if(a.autoClear){a.setClearColor(this._backgroundColor.color,this._backgroundColor.alpha);}else{a.render(this._backgroundScene,this._backgroundCamera);}if(this.getRenderMode()===k.XRay){a.autoClear=false;}a.render(n,b);a.autoClear=false;a.clippingPlanes=[];n.overrideMaterial=null;J(a,b,n,W,this._eyePointLight);if(y){var Y=y._boundingBoxesScene;if(Y){y._updateBoundingBoxes();a.render(Y,b);}}for(i=0;i<x.length;i++){z=sap.ui.getCore().byId(x[i]);U=z.getGizmoForContainer(this);if(U&&U.render){U.render(this);}}if(this._selectionRect){a.render(this._selectionRect,this._backgroundCamera);}if(y){y._renderOutline(a,n,b);}if(y){if(y._playTransitionHighlight()){this._shouldRenderFrame=true;}if(y._playHighlight()){this._shouldRenderFrame=true;}}this.fireFrameRenderingFinished();};
B.prototype.getImage=function(a,b,i,l,n){var x=this._getNativeScene();if(!x){return null;}a=Math.min(a||16,2048);b=Math.min(b||16,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var y=new THREE.WebGLRenderer({canvas:this._imageCanvas,preserveDrawingBuffer:true,antialias:true,alpha:true});y.setSize(a,b);var z=this.getBackgroundColorTop();var U=this.getBackgroundColorBottom();if(i&&!l){y.setClearColor(i,1);}else if(!i&&l){y.setClearColor(l,1);}else{if(i&&l){this.setBackgroundColorTop(i);this.setBackgroundColorBottom(l);}y.render(this._backgroundScene,this._backgroundCamera);y.autoClear=false;}document.body.appendChild(y.domElement);var W=this.getCamera();var X=W instanceof P?new P():new O();X.getCameraRef().copy(W.getCameraRef());X.update(a,b);var Y=[];var $=this._getViewStateManagerThreeJS();if(!n){if($!==null){$.enumerateSelection(function(b1){Y.push(b1);});$.setSelectionState(Y,false,false,true);}}y.render(x,X.getCameraRef());var a1=y.getContext().canvas.toDataURL();if($!==null&&Y.length>0){$.setSelectionState(Y,true,false,true);}document.body.removeChild(y.domElement);y.dispose();if(U&&i){this.setBackgroundColorBottom(U);}if(z&&l){this.setBackgroundColorTop(z);}return a1;};
B.prototype._setContent=function(a){var b=null;var l;var n;if(a){b=a;if(!(b instanceof r)){b=null;}l=a.camera;if(l instanceof O){n=b._computeBoundingBox(this._getLayers(),true);var x=new THREE.Vector3();n.getCenter(x);var y=l.getTargetDirection();var z=l.getPosition();var U=[x.x-z[0],x.y-z[1],x.z-z[2]];var W=U[0]*y[0]+U[1]*y[1]+U[2]*y[2];if(W<0){var X=n.getSize().length()/2;X-=W;z[0]-=y[0]*X;z[1]-=y[1]*X;z[2]-=y[2]*X;l.setPosition(z);}}else if(!(l instanceof P)){l=new P();if(a.builders&&a.builders.length>0){n=b._computeBoundingBox(this._getLayers(),true);if(!n.isEmpty()){l.setFov(14.27);var Y;if(a.upAxis===4){Y=new THREE.Euler(THREE.Math.degToRad(90-30),0,THREE.Math.degToRad(55-90),"ZXY");}else{Y=new THREE.Euler(THREE.Math.degToRad(-30),THREE.Math.degToRad(55-90),0,"YXZ");}this.setCamera(l);this._viewportGestureHandler.zoomTo(n,new THREE.Quaternion().setFromEuler(Y),0,0,null,false);}}}var i;if(a.loaders){for(i=0;i<a.loaders.length;i++){if(a.loaders[i]instanceof s){this._cdsLoader=a.loaders[i];this._cdsLoader.attachSceneUpdated(this._handleCdsSceneUpdate,this);this._cdsLoader.attachLoadingFinished(function(){this._clearAnnotations();this.getAnnotations();},this);break;}}}if(a.builders){for(i=0;i<a.builders.length;i++){a.builders[i]._fireSceneUpdated=this.setShouldRenderFrame.bind(this);a.builders[i]._fireLoadingFinished=function($){this.setRenderMode(this.getRenderMode());}.bind(this);}}}this.setScene(b);if(l){this.setCamera(l);}if(a){if(a.backgroundTopColor!==undefined){this.setBackgroundColorTop(new THREE.Color(a.backgroundTopColor).getStyle());}if(a.backgroundBottomColor!==undefined){this.setBackgroundColorBottom(new THREE.Color(a.backgroundBottomColor).getStyle());}if(a.renderMode!==undefined){this.setRenderMode(a.renderMode);}this._upAxis=a.upAxis||2;}};
B.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
B.prototype._onBeforeClearContentConnector=function(){if(D._onBeforeClearContentConnector){D._onBeforeClearContentConnector.call(this);}this.setScene(null);};
B.prototype._handleContentReplaced=function(a){var b=a.getParameter("newContent");this._setContent(b);};
B.prototype._onAfterUpdateViewStateManager=function(){};
B.prototype._onBeforeClearViewStateManager=function(){};
C.injectMethodsIntoClass(B);c.injectMethodsIntoClass(B);
B.prototype.getCurrentView=function(){return this._currentView;};
B.prototype._onViewApplied=function(a,b,i){if(i.source!=this._getViewStateManagerThreeJS()){return;}this._ignoreAnimationPosition=i.ignoreAnimationPosition;this.activateView(i.view,i.playViewGroup,i.notAnimateCameraChange);};
B.prototype._activateSingleView=function(a,b,n){var i=this._scene.getViewGroups();var l=this;if(i){i.forEach(function(j1){j1.getViews().forEach(function(k1){if(k1===a){l._currentViewIndex=j1.getViews().indexOf(k1);}});});}this.fireViewActivated({viewIndex:this._currentViewIndex,view:a});v.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:a,viewIndex:this._currentViewIndex});this._currentView=a;if(a.topColor!==undefined){this.setBackgroundColorTop(new THREE.Color(a.topColor).getStyle());}if(a.bottomColor!==undefined){this.setBackgroundColorBottom(new THREE.Color(a.bottomColor).getStyle());}if(a.renderMode!==undefined){this.setRenderMode(a.renderMode);}var x=a.getCamera();var y=this._getNativeScene();if(x){var z=x.getCameraRef();if(z.type==="OrthographicCamera"&&y){var U=x.getPosition();var W=this.getScene();if(W){var X=new THREE.Box3();if(y){y._expandBoundingBox(X,this._getLayers(),true);}var Y=new THREE.Vector3();X.getCenter(Y);var $=x.getTargetDirection();var a1=[Y.x-U[0],Y.y-U[1],Y.z-U[2]];var b1=a1[0]*$[0]+a1[1]*$[1]+a1[2]*$[2];if(b1<0){var c1=X.getSize().length()/2;c1-=b1;U[0]-=$[0]*c1;U[1]-=$[1]*c1;U[2]-=$[2]*c1;}}x.setPosition(U);}}var d1=this._getViewStateManagerThreeJS();var e1=2000;if(a.flyToTime!=null){e1=a.flyToTime;}var f1=0;if(x){var g1=b&&!a.hasAnimation();f1=this._viewportGestureHandler.activateCamera(x.getCameraRef(),e1,g1,n);}var h1=0;if(!n){if(f1>0){h1=d1._startTransitionHighlight(f1,a);}else{h1=d1._startTransitionHighlight(e1,a);}}var i1=h1>f1?h1:f1;this.getSafeArea().resize();setTimeout(function(){if(d1){d1.fireReadyForAnimation({view:a,ignoreAnimationPosition:this._ignoreAnimationPosition});v.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:d1,view:a,ignoreAnimationPosition:this._ignoreAnimationPosition});d1._startHighlight();}}.bind(this),i1);};
B.prototype.resetCurrentView=function(){if(!this._currentView){return this;}this._getViewStateManagerThreeJS()._resetNodesMaterialAndOpacityByCurrenView(this._currentView);this._getViewStateManagerThreeJS()._resetNodesStatusByCurrenView(this._currentView,true,true);this.setShouldRenderFrame();return this;};
B.prototype.activateView=function(a,b,n){this._clearAnnotations();this._activateSingleView(a,b,n);return this;};
B.prototype.zoomTo=function(a,n,b,i){var l=this._getNativeScene();var x=this._getNativeCamera();if(!x||!l){return this;}i=i||0;var y=new THREE.Box3();var z=null;var U=null;(Array.isArray(a)?a:[a]).forEach(function(a){switch(a){case Z.All:l._expandBoundingBox(y,null,true);break;case Z.Visible:l._expandBoundingBox(y,this._getLayers(),true);break;case Z.Selected:var W=this._getViewStateManagerThreeJS();if(W){W.enumerateSelection(function(n){n._expandBoundingBox(y,null,true);});}break;case Z.Node:if(!n){return this;}U=n;if(Array.isArray(n)){n.forEach(function(n){n._expandBoundingBox(y,null,true);});}else{n._expandBoundingBox(y,null,true);}break;case Z.Restore:q.sap.log.error(m().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return this;case Z.NodeSetIsolation:q.sap.log.error(m().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return this;case Z.RestoreRemoveIsolation:q.sap.log.error(m().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return this;case Z.ViewLeft:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case Z.ViewRight:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case Z.ViewTop:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case Z.ViewBottom:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;case Z.ViewBack:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case Z.ViewFront:z=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;default:break;}}.bind(this));if(!y.isEmpty()){this._viewportGestureHandler.zoomTo(y,z,i,b*1000,U,U!==null);}return this;};
B.prototype.pan=function(a,b){this._viewportGestureHandler._cameraController.pan(a,b);};
B.prototype.rotate=function(a,b){this._viewportGestureHandler._cameraController.rotate(a,b);};
B.prototype.zoom=function(a){this._viewportGestureHandler._cameraController.zoom(a);};
B.prototype.getViewInfo=function(a){var b={};if(a==null){a={};}if(a.camera==null){a.camera=true;}var n=this._getNativeCamera();if(a.camera&&n){var i=n.rotation.clone();i.reorder("YXZ");b.camera={rotation:{yaw:THREE.Math.radToDeg(i.y),pitch:THREE.Math.radToDeg(i.x),roll:THREE.Math.radToDeg(i.z)},position:{x:n.position.x,y:n.position.y,z:n.position.z},projectionType:n.isOrthographicCamera?g.Orthographic:g.Perspective,bindingType:h.Vertical};var l=n.view;if(l&&l.enabled){b.camera.view={fullWidth:l.fullWidth,fullHeight:l.fullHeight,offsetX:l.offsetX,offsetY:l.offsetY,width:l.width,height:l.height};}if(b.camera.projectionType===g.Perspective){b.camera.fieldOfView=n.fov;}else if(b.camera.projectionType===g.Orthographic){b.camera.zoomFactor=n.zoom;}if(a.camera.matrices){b.camera.matrices={view:n.matrixWorldInverse.elements.slice(),projection:n.projectionMatrix.elements.slice()};}}if(a.visibility&&this._viewStateManager){var x=a.visibility.mode==null?j.Complete:a.visibility.mode;b.visibility={mode:x};if(x===j.Complete){var y=this._viewStateManager.getVisibilityComplete();b.visibility.visible=y.visible;b.visibility.hidden=y.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){b.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{q.sap.log.warning(m().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.threejs.Viewport");}}return b;};
B.prototype.setViewInfo=function(a,b){var n=this._getNativeCamera();if(a.camera&&n){var i=a.camera;var l=i.projectionType===g.Orthographic?new THREE.OrthographicCamera():new THREE.PerspectiveCamera();l.userData=n.userData;l.aspect=n.aspect;l.position.copy(i.position);var x=i.rotation;l.quaternion.setFromEuler(new THREE.Euler(THREE.Math.degToRad(x.pitch),THREE.Math.degToRad(x.yaw),THREE.Math.degToRad(x.roll),"YXZ"));l.fov=i.fieldOfView||l.fov;l.zoom=i.zoomFactor||l.zoom;if(n.view&&n.view.enabled){var y=i.view||n.view;l.setViewOffset(y.fullWidth,y.fullHeight,y.offsetX,y.offsetY,y.width,y.height);l.aspect=y.fullWidth/y.fullHeight;l.zoom=Math.min(l.aspect,1);}this._viewportGestureHandler.activateCamera(l,(b||0)*1000);}if(a.visibility){var z=this._viewStateManager.getNodeHierarchy(),U=new Map(),W=z.findNodesByName();W.forEach(function($){var a1=z.createNodeProxy($);var b1=a1.getVeId();z.destroyNodeProxy(a1);if(b1){U.set(b1,$);}});switch(a.visibility.mode){case j.Complete:var X=a.visibility.visible,Y=a.visibility.hidden;X.forEach(function($){this._viewStateManager.setVisibilityState(U.get($),true,false);},this);Y.forEach(function($){this._viewStateManager.setVisibilityState(U.get($),false,false);},this);break;case j.Differences:this._viewStateManager.resetVisibility();a.visibility.changes.forEach(function($){var a1=U.get($);if(a1){this._viewStateManager.setVisibilityState(a1,!this._viewStateManager.getVisibilityState(a1),false);}},this);break;default:q.sap.log.error(m().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.threejs.Viewport");break;}}this.setShouldRenderFrame();return this;};
B.prototype.queueCommand=function(a){if(this instanceof B){a();}return this;};
B.prototype.getOutputSize=function(){var b=this.getDomRef().getBoundingClientRect();var a=b.width;var i=b.height;var l;l=Math.min(a,i);return{left:(a-l)/2,top:(i-l)/2,sideLength:l};};
B.prototype.projectToScreen=function(x,y,z,a){var b=this.getDomRef().getBoundingClientRect();var i=b.width/2;var l=b.height/2;var n=new THREE.Vector3(x,y,z).project(a.getCameraRef());return{x:n.x*i+i,y:n.y*l+l,depth:n.z};};
B.prototype.getAnnotations=function(){if(this.getScene()==null||this._annotationsLoaded){return this.getAggregation("annotations")||[];}if(this.getScene().annotations){var a=[];var b=this.getCurrentView();if(b){b.getNodeInfos().forEach(function(i){if(i.target._vkGetNodeContentType()===w.Annotation){a.push(i);}});}this.getScene().annotations.forEach(function(i){var l=null;if(b){for(var n=0;n<a.length;n++){var x=a[n];if(x.target._vkPersistentId()===i.node._vkPersistentId()){l=this.addAnnotation(A.createAnnotation(i,this));break;}}}else{l=this.addAnnotation(A.createAnnotation(i,this));}if(l){var y=this._viewStateManager.getVisibilityState(i.node);l.setVisible(y);}}.bind(this));}this._annotationsLoaded=true;return this.getAggregation("annotations")||[];};
V.prototype.normalizeRectangle=function(x,y,a,b){var i=window.getComputedStyle(this.getSafeArea().getDomRef());var l=parseFloat(i.width);var n=parseFloat(i.left);var z=(((x-n))/l)-0.5;var U=parseFloat(i.height);var W=parseFloat(i.top);var X=(((y-W))/U)-0.5;return{x:z,y:X,width:a/l,height:b/U};};
B.prototype.deNormalizeRectangle=function(x,y,a,b){var i=window.getComputedStyle(this.getSafeArea().getDomRef());var l=parseFloat(i.width);var n=parseFloat(i.left);var z=l/2;var U=n+z;var W=Math.abs(x)*2;if(x<0){W=1-W;W*=z;W+=n;}else if(x>0){W*=z;W+=U;}else{W=U;}var X=Math.abs(a)*2*z;var Y=parseFloat(i.height);var $=parseFloat(i.top);var a1=Y/2;var b1=$+a1;var c1=Math.abs(y)*2;if(y<0){c1=1-c1;c1*=a1;c1+=$;}else if(y>0){c1*=a1;c1+=b1;}else{c1=b1;}var d1=Math.abs(b)*2*a1;return{x:W,y:c1,width:X,height:d1};};
return B;});
sap.ui.predefine('sap/ui/vk/threejs/ViewportGestureHandler',["sap/base/Log","sap/ui/base/EventProvider","./PerspectiveCamera","./OrthographicCamera","./thirdparty/three","../getResourceBundle"],function(L,E,P,O,t,g){"use strict";
var V=E.extend("sap.ui.vk.threejs.ViewportGestureHandler",{
metadata:{},
constructor:function(v){this._matProj=null;this._viewport=v;this._rect=null;this._evt={x:0,y:0,z:0,d:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;var T=function(a){var v=a;var b=new THREE.Vector3();var z=new THREE.Vector2();var A=0.001;var M=-Math.PI/2+A;var c=Math.PI/2-A;this.isTurnTableMode=true;this._timeIntervalForCameraAnimation=500;this._startTimeForCameraAnimation=0;this._newCamera=null;this._oldCamera=null;this._animationType=null;this._zoomedNodeRef=null;this._isZoomIn=true;this.beginGesture=function(x,y){var s=v.getScene();if(s==null){return;}var d=s.getSceneRef();var e=v.getCamera().getCameraRef();var f=v.getRenderer().getSize(new THREE.Vector2());z.x=x/f.width*2-1;z.y=y/f.height*-2+1;v._gesturePoint={x:x,y:y};var h=e.userData.isRedlineActivated?null:v.hitTest(x,y,d,e);if(h){b.copy(h.point);}else{var i=new THREE.Box3();d._expandBoundingBox(i,v._getLayers(),true);if(!i.isEmpty()){i.getCenter(b);}else{b.setScalar(0);}}};this.endGesture=function(){};this.pan=function(d,e){if(v.getFreezeCamera()||v.getCamera()==null){return;}if(d===0&&e===0){return;}var f=v.getCamera().getCameraRef();var s=v.getRenderer().getSize(new THREE.Vector2());if(f.view&&f.view.enabled){f.view.offsetX-=d*f.zoom*f.view.width/f.view.fullWidth;f.view.offsetY-=e*f.zoom*f.view.height/f.view.fullHeight;f.updateProjectionMatrix();}else{var o=b.clone().project(f);o.x-=d*2/s.width;o.y+=e*2/s.height;o.unproject(f).sub(b);f.position.add(o);f.updateMatrixWorld();}v.fireCameraChanged({position:f.position.toArray()});};var u=[new THREE.Vector3(+1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,+1,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,+1),new THREE.Vector3(0,0,-1)];this.rotate=function(d,e,i){if(v.getFreezeCamera()||v.getCamera()==null){return;}if(i!==undefined){this.isTurnTableMode=i;}if(d===0&&e===0){return;}var f=v.getCamera().getCameraRef(),h=d*-0.01,j=e*-0.01;var o=f.position.clone().sub(b);var l=new THREE.Vector3(),k=new THREE.Vector3().setFromMatrixColumn(f.matrixWorld,1).normalize(),r=new THREE.Vector3().setFromMatrixColumn(f.matrixWorld,0).normalize();f.getWorldDirection(l);l.normalize();var m=new THREE.Quaternion(),n=new THREE.Quaternion();if(this.isTurnTableMode){var s=u[v._upAxis]||u[2];r.crossVectors(l,s).normalize();k.crossVectors(r,l);var p=Math.atan2(l.y,Math.sqrt(l.x*l.x+l.z*l.z));m.setFromAxisAngle(s,h);n.setFromAxisAngle(r,THREE.Math.clamp(j,M-p,c-p));}else{m.setFromAxisAngle(k,h);n.setFromAxisAngle(r,j);}m.multiply(n);o.applyQuaternion(m);l.applyQuaternion(m);k.applyQuaternion(m);o.add(b);f.position.copy(o);f.up.copy(k);f.lookAt(o.add(l));f.updateMatrixWorld();v.fireCameraChanged({position:f.position.toArray(),quaternion:f.quaternion.toArray()});};this.zoom=function(d){if(d===0||d===1||v.getFreezeCamera()||v.getCamera()===null||v.getScene()===null){return;}var e=v.getCamera().getCameraRef();var h=new THREE.Vector3();if(!e.userData.isRedlineActivated){var i=100;var j=new THREE.Box3();var k=new THREE.Vector3();v.getScene().getSceneRef()._expandBoundingBox(j,v._getLayers(),true);j.applyMatrix4(e.matrixWorldInverse);j.min.z=Math.max(j.min.z,e.near);j.max.z=Math.max(j.max.z,e.near);j.applyMatrix4(e.projectionMatrix);j.getSize(k);var l=v.getRenderer().getSize(new THREE.Vector2());var s=k.x*l.width*0.5;var m=k.y*l.height*0.5;if(s<i&&m<i&&d<1){return;}}if(e.isPerspectiveCamera){if(e.view&&e.view.enabled){var n=v.getDomRef();var x=v._gesturePoint.x/n.clientWidth;var y=v._gesturePoint.y/n.clientHeight;var f=1/d;e.view.offsetX+=x*e.view.width;e.view.offsetY+=y*e.view.height;e.view.width*=f;e.view.height*=f;e.view.offsetX-=x*e.view.width;e.view.offsetY-=y*e.view.height;}else{h.set(z.x,z.y,1).unproject(e);h.sub(new THREE.Vector3(z.x,z.y,-1).unproject(e));var o=b.clone().sub(e.position).length()*(1-1/d);h.setLength(o);e.position.add(h);}}else if(e.isOrthographicCamera){h.set(z.x,z.y,1).unproject(e);h.sub(new THREE.Vector3(0,0,1).unproject(e));h.multiplyScalar(1-1/d);e.zoom*=d;e.position.add(h);}else{L.error(g().getText("VIEWPORTGESTUREHANDLER_MSG_UNSUPPORTEDCAMERATYPE"));}e.updateProjectionMatrix();e.updateMatrixWorld();var p={position:e.position.toArray()};if(e.isOrthographicCamera){p.zoom=e.zoom;}v.fireCameraChanged(p);};this.animateCameraUpdate=function(){if(this._newCamera===null||this._oldCamera===null){return;}if(v.getCamera()==null){this._newCamera=null;this._oldCamera=null;return;}function s(f,h,x){x=THREE.Math.clamp((x-f)/(h-f),0.0,1.0);return x*x*x*(x*(x*6-15)+10);}var i=Math.min((Date.now()-this._startTimeForCameraAnimation)/this._timeIntervalForCameraAnimation,1);i=s(0,1,i);var d=v.getCamera().getCameraRef();if(d.isOrthographicCamera&&this._newCamera.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){d.left=THREE.Math.lerp(this._oldCamera.left,this._newCamera.left,i);d.right=THREE.Math.lerp(this._oldCamera.right,this._newCamera.right,i);d.top=THREE.Math.lerp(this._oldCamera.top,this._newCamera.top,i);d.bottom=THREE.Math.lerp(this._oldCamera.bottom,this._newCamera.bottom,i);d.zoom=THREE.Math.lerp(this._oldCamera.zoom,this._newCamera.zoom,i);}if(d.isPerspectiveCamera&&this._newCamera.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){d.fov=THREE.Math.lerp(this._oldCamera.fov,this._newCamera.fov,i);}d.far=THREE.Math.lerp(this._oldCamera.far,this._newCamera.far,i);d.near=THREE.Math.lerp(this._oldCamera.near,this._newCamera.near,i);d.updateProjectionMatrix();d.position.lerpVectors(this._oldCamera.position,this._newCamera.position,i);d.scale.lerpVectors(this._oldCamera.scale,this._newCamera.scale,i);d.up.lerpVectors(this._oldCamera.up,this._newCamera.up,i);var o=this._oldCamera.getWorldDirection(new THREE.Vector3());var n=this._newCamera.getWorldDirection(new THREE.Vector3());var e=new THREE.Vector3().lerpVectors(o,n,i);d.lookAt(e.add(d.position));if(i===1){this._newCamera=null;this._oldCamera=null;if(this._animationType==="zooming"&&this._zoomedNodeRef){v.fireNodeZoomed({zoomed:this._zoomedNodeRef,isZoomIn:this._isZoomIn});}v.cameraUpdateCompleted({position:d.position.toArray(),quaternion:d.quaternion.toArray()});}v.fireCameraChanged({position:d.position.toArray(),quaternion:d.quaternion.toArray()});};this.zoomObject=function(n,i,d){if(v.getScene()==null){return;}var e=new THREE.Box3();(i&&n?n:v.getScene().getSceneRef())._expandBoundingBox(e,v._getLayers(),true);this.zoomBox(e,0,d,n,i);};this.zoomBox=function(d,m,e,n,f){this._zoomedNodeRef=n;this._isZoomIn=f;this._animationType="zooming";var h=v.getCamera().getCameraRef();var s=new THREE.Vector3();d.getSize(s);if(s.lengthSq()===0){return;}var j=new THREE.Vector3();h.getWorldDirection(j);j.multiplyScalar(s.length());var k=new THREE.Vector3();d.getCenter(k);var l=[new THREE.Vector3(d.min.x,d.min.y,d.min.z),new THREE.Vector3(d.max.x,d.max.y,d.max.z),new THREE.Vector3(d.min.x,d.min.y,d.max.z),new THREE.Vector3(d.min.x,d.max.y,d.max.z),new THREE.Vector3(d.max.x,d.min.y,d.max.z),new THREE.Vector3(d.max.x,d.max.y,d.min.z),new THREE.Vector3(d.min.x,d.max.y,d.min.z),new THREE.Vector3(d.max.x,d.min.y,d.min.z)];var o=new THREE.Matrix4(),p=new THREE.Vector3();function q(h){o.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse);for(var i in l){p.copy(l[i]).applyMatrix4(o);if(p.x<-1.0||p.x>1.0||p.y<-1.0||p.y>1.0){return false;}}return true;}this._newCamera=h.clone();this._newCamera.position.copy(k).sub(j);this._newCamera.updateMatrixWorld(true);if(h.isPerspectiveCamera){while(!q(this._newCamera)){this._newCamera.position.sub(j);this._newCamera.updateMatrixWorld(true);}var r=10;var w=this._newCamera.position.clone();var x=k.clone();for(var y=0;y<r;y++){this._newCamera.position.copy(w).add(x).multiplyScalar(0.5);this._newCamera.updateMatrixWorld(true);if(q(this._newCamera)){w.copy(this._newCamera.position);}else{x.copy(this._newCamera.position);}}this._newCamera.position.copy(w).sub(k).multiplyScalar(m).add(w);this._newCamera.updateMatrixWorld(true);}if(h.isOrthographicCamera){var B=new THREE.Box2();l.forEach(function(i){p=i.project(this._newCamera);B.expandByPoint(new THREE.Vector2(p.x,p.y));}.bind(this));this._newCamera.zoom/=Math.max(B.getSize().x,B.getSize().y)*0.5*(1+m);this._newCamera.updateProjectionMatrix();}this._startTimeForCameraAnimation=Date.now();this._timeIntervalForCameraAnimation=e!==undefined?e:500;};this.prepareForCameraUpdateAnimation=function(){this._oldCamera=v.getCamera().getCameraRef().clone();};this.startAnimatingCameraUpdate=function(d,p){var e=v.getCamera().getCameraRef();if(!this._oldCamera){return 0;}var n=false;var f=0.0001;if(e.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){if(Math.abs(e.left-this._oldCamera.left)>f||Math.abs(e.right-this._oldCamera.right)>f||Math.abs(e.top-this._oldCamera.top)>f||Math.abs(e.bottom-this._oldCamera.bottom)>f||Math.abs(e.zoom-this._oldCamera.zoom)>f){n=true;}}else if(e.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){if(Math.abs(e.fov-this._oldCamera.fov)>f||Math.abs(e.aspect-this._oldCamera.aspect)>f){n=true;}}if(!n){if(Math.abs(e.position.x-this._oldCamera.position.x)>f||Math.abs(e.position.y-this._oldCamera.position.y)>f||Math.abs(e.position.z-this._oldCamera.position.z)>f||Math.abs(e.scale.x-this._oldCamera.scale.x)>f||Math.abs(e.scale.y-this._oldCamera.scale.y)>f||Math.abs(e.scale.z-this._oldCamera.scale.z)>f||Math.abs(e.quaternion.x-this._oldCamera.quaternion.x)>f||Math.abs(e.quaternion.y-this._oldCamera.quaternion.y)>f||Math.abs(e.quaternion.z-this._oldCamera.quaternion.z)>f||Math.abs(e.quaternion.w-this._oldCamera.quaternion.w)>f){n=true;}}if(!n){if(!p){v.cameraUpdateCompleted({position:e.position.toArray(),quaternion:e.quaternion.toArray()});return 0;}else{d=500;}}this._newCamera=v.getCamera().getCameraRef().clone();this._timeIntervalForCameraAnimation=d!==undefined?d:500;this._startTimeForCameraAnimation=Date.now();return d;};};this._cameraController=new T(v);}
});
V.prototype._activateRedline=function(){var c=this._viewport.getCamera().getCameraRef();c.userData.isRedlineActivated=true;if(c.isPerspectiveCamera){var d=this._viewport.getDomRef();c.setViewOffset(d.clientWidth,d.clientHeight,0,0,d.clientWidth,d.clientHeight);}};
V.prototype._deactivateRedline=function(){var c=this._viewport.getCamera().getCameraRef();c.userData.isRedlineActivated=false;c.clearViewOffset();};
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect===null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(!d){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;L.debug("Loco: beginGesture: "+x+", "+y);this._cameraController.beginGesture(x,y);a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);L.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}z=THREE.Math.clamp(z,0.88,1.12);this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;switch(e.n){case 1:L.debug("Loco: Rotate: "+(d)+", "+(a));this._cameraController.rotate(d,a);break;case 2:L.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){L.debug("Loco: Zoom: "+(z));}this._cameraController.pan(d,a);if(d<10&&a<10&&z!=0&&z!=1.0){this._cameraController.zoom(z);}break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: endGesture: "+x+", "+y);this._cameraController.endGesture();this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: click: "+(x)+", "+(y));if(this._viewport){this._viewport.tap(x,y,false);}e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;L.debug("Loco: doubleClick: "+(x)+", "+(y));if(this._viewport){this._viewport.tap(x,y,true);}e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons===5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
V.prototype.activateCamera=function(c,a,p,n){var r=0;this._cameraController.prepareForCameraUpdateAnimation();if(this._viewport.getCamera().getCameraRef().isPerspectiveCamera!=c.isPerspectiveCamera){this._viewport.setCamera(c.isPerspectiveCamera?new P():new O());}this._viewport.getCamera().getCameraRef().copy(c);var s=this._viewport.getRenderer().getSize(new THREE.Vector2());this._viewport.getCamera().update(s.width,s.height);if(a>0&&!n){r=this._cameraController.startAnimatingCameraUpdate(a,p);}else{this._viewport.cameraUpdateCompleted({position:c.position.toArray(),quaternion:c.quaternion.toArray()});}return r;};
V.prototype.setView=function(q,a){var c=this._viewport.getCamera().getCameraRef();if(c.userData.isRedlineActivated){L.error("setView() method is disabled when Redlining is activated");return this;}this._cameraController.prepareForCameraUpdateAnimation();if(q){c.quaternion.copy(q);c.updateMatrixWorld();c.up.setFromMatrixColumn(c.matrixWorld,1).normalize();this._cameraController.zoomObject(null,false,a);}else{c.copy(this._viewport._homeCamera?this._viewport._homeCamera:new P().getCameraRef());var s=this._viewport.getRenderer().getSize(new THREE.Vector2());this._viewport.getCamera().update(s.width,s.height);this._cameraController.startAnimatingCameraUpdate(a);}return this;};
V.prototype.zoomTo=function(b,q,m,a,n,i){var c=this._viewport.getCamera().getCameraRef();if(c.userData.isRedlineActivated){L.error("zoomTo() method is disabled when Redlining is activated");return this;}this._cameraController.prepareForCameraUpdateAnimation();if(q){c.quaternion.copy(q);c.updateMatrixWorld();c.up.setFromMatrixColumn(c.matrixWorld,1).normalize();}this._cameraController.zoomBox(b,m,a,n,i);return this;};
V.prototype.zoomObject=function(n,i,a){var c=this._viewport.getCamera().getCameraRef();if(c.userData.isRedlineActivated){L.error("zoomObject() method is disabled when Redlining is activated");return this;}this._cameraController.prepareForCameraUpdateAnimation();this._cameraController.zoomObject(n,i,a);return this;};
V.prototype.animateCameraUpdate=function(){this._cameraController.animateCameraUpdate();};
V.prototype.prepareForCameraUpdateAnimation=function(){this._cameraController.prepareForCameraUpdateAnimation();};
V.prototype.startAnimatingCameraUpdate=function(a){this._cameraController.startAnimatingCameraUpdate(a);};
return V;});
sap.ui.predefine('sap/ui/vk/threejs/ViewportRenderer',[],function(){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.writeAttribute("aria-label","Image");r.addStyle("width",c.getWidth());r.addStyle("height",c.getHeight());r.writeStyles();r.write(">");if(c.getSafeArea()){r.renderControl(c.getSafeArea());}var i,l;var t=c.getTools();for(i=0,l=t.length;i<l;i++){var _=sap.ui.getCore().byId(t[i]);var a=_.getGizmoForContainer(c);if(a&&a.hasDomElement()){r.renderControl(a);}}var C=c.getContent();for(i=0,l=C.length;i<l;i++){r.renderControl(C[i]);}var A=c.getAnnotations();if(A&&A.length>0){r.write("<div");r.addClass("sapUiVizKitAnnotationContainer");r.writeClasses();r.write(">");A.forEach(function(o){o._viewport=c;r.renderControl(o);});r.write("</div>");}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/tools/AnchorPointTool',["../threejs/thirdparty/three","./Tool","./AnchorPointToolHandler","./AnchorPointToolGizmo","./AnchorPointToolOperation"],function(t,T,A,a,b){"use strict";
var c=T.extend("sap.ui.vk.tools.AnchorPointTool",{
metadata:{properties:{enableStepping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowOperation:{type:"sap.ui.vk.tools.AnchorPointToolOperation",defaultValue:b.All},allowContextMenu:{type:"boolean",defaultValue:true},position:{type:"any",defaultValue:null},quaternion:{type:"any",defaultValue:null}},events:{moving:{parameters:{x:"float",y:"float",z:"float"}},moved:{parameters:{x:"float",y:"float",z:"float"}},rotating:{parameters:{x:"float",y:"float",z:"float"}},rotated:{parameters:{x:"float",y:"float",z:"float"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new A(this);this._gizmo=null;}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);var g=new a();this.setAggregation("gizmo",g);this.setProperty("position",g._gizmo.position);this.setProperty("quaternion",g._gizmo.quaternion);};
c.prototype.setViewport=function(v){if(this._viewport!==v){this._deactivateScreenAlignment();}T.prototype.setViewport.call(this,v);if(v){this.getGizmo()._initAnchorPoint(v);}};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();this._deactivateScreenAlignment();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setAllowOperation=function(v){this.setProperty("allowOperation",v,true);if(this._gizmo){this._gizmo._updateHandlesVisibility();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.move=function(x,y,z){if(this._gizmo){this._gizmo.move(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.rotate=function(x,y,z){if(this._gizmo){this._gizmo.rotate(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.moveTo=function(d,u){var n=Array.isArray(d)?d:[d];var p=new THREE.Vector3();if(u){var e=0;var f=new THREE.Vector3();n.forEach(function(h){h.updateWorldMatrix(false,false);p.add(f.setFromMatrixPosition(h.matrixWorld));e++;});p.multiplyScalar(1/e);}else{var g=new THREE.Box3();n.forEach(function(h){g.expandByObject(h);});g.getCenter(p);}this.getGizmo().setPosition(p);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.alignTo=function(n){this._deactivateScreenAlignment();var q=new THREE.Quaternion();if(n){n.updateWorldMatrix(false,false);n.matrixWorld.decompose(new THREE.Vector3(),q,new THREE.Vector3());}this.getGizmo().setQuaternion(q);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.alignToWorld=function(){this._deactivateScreenAlignment();this.getGizmo().setQuaternion(new THREE.Quaternion());if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.alignToScreen=function(){if(this._viewport){this._activateScreenAlignment();this.alignToScreenCallback();this._viewport.setShouldRenderFrame();}return this;};
c.prototype._activateScreenAlignment=function(){if(!this.alignToScreenCallback){this.alignToScreenCallback=function(){var d=this._viewport.getCamera().getCameraRef();this.getGizmo().setQuaternion(d.quaternion);}.bind(this);this._viewport.attachCameraChanged(this.alignToScreenCallback);}};
c.prototype._deactivateScreenAlignment=function(){if(this.alignToScreenCallback&&this._viewport){this._viewport.detachCameraChanged(this.alignToScreenCallback);this.alignToScreenCallback=null;}};
c.prototype.setPosition=function(){throw new Error("The AnchorPointTool position is read-only");};
c.prototype.setQuaternion=function(){throw new Error("The AnchorPointTool quaternion is read-only");};
return c;});
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolGizmo',["jquery.sap.global","../getResourceBundle","../threejs/thirdparty/three","./Gizmo","./AnchorPointToolGizmoRenderer","./CoordinateSystem","./AxisColours","./AnchorPointToolOperation"],function(q,g,t,G,A,C,c,d){"use strict";
var e=G.extend("sap.ui.vk.tools.AnchorPointToolGizmo",{metadata:{library:"sap.ui.vk"}});
e.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(null,84);this._gizmoIndex=-1;this._handleIndex=-1;this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._sceneGizmo.add(l);this._sceneGizmo.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._touchAreas=new THREE.Group();this._gizmo=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;this._moveDelta=new THREE.Vector3();this._rotationDelta=new THREE.Vector3();function h(a,b,r){var s=96,u=1,v=24,w=4,x=48;a.multiplyScalar(1/s);var y=new THREE.CylinderBufferGeometry(u,u,s-v,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));m.setPosition(a.clone().multiplyScalar((s-v)*0.5));y.applyMatrix(m);var z=new THREE.MeshLambertMaterial({color:b,transparent:true});var B=new THREE.Mesh(y,z);B.matrixAutoUpdate=false;B.userData.color=b;var D=new THREE.CylinderBufferGeometry(0,w,v,12,1);m.setPosition(a.clone().multiplyScalar(s-v*0.5));D.applyMatrix(m);var E=new THREE.Mesh(D,z);E.matrixAutoUpdate=false;B.add(E);var F=new THREE.CylinderGeometry(x*0.5,x*0.5,x,12,1);F.applyMatrix(m);var H=new THREE.CylinderGeometry(x*0.5,x*0.2,x,12,1);m.setPosition(a.clone().multiplyScalar(s*0.5));F.merge(H,m);r.add(new THREE.Mesh(F,z));return B;}function j(a,b,m){var r=new Float32Array(9);r[a]=r[b+6]=1;r[a+3]=r[b+3]=0.5;var v=new THREE.Vector3().setComponent(a,0.333);var s=new THREE.Vector3().setComponent(b,0.333);var p=new THREE.Geometry();p.vertices.push(new THREE.Vector3(),v,s,v.clone().add(s));p.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var u=new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,visible:false,side:THREE.DoubleSide});var w=new THREE.Mesh(p,u);w.matrixAutoUpdate=false;w.userData.colors=r;var x=new THREE.BufferGeometry();var y=new Float32Array(9);y[a]=y[a+3]=y[b+3]=y[b+6]=0.333;x.setAttribute("position",new THREE.Float32BufferAttribute(y,3));x.setAttribute("color",new THREE.Float32BufferAttribute(r,3));var z=new THREE.Line(x,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));z.matrixAutoUpdate=false;w.add(z);var B=new THREE.Geometry();B.vertices.push(new THREE.Vector3(),v,s,v.clone().add(s));B.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));m.add(new THREE.Mesh(B,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return w;}function k(a,b,r,s){var p=new THREE.TorusBufferGeometry(r,1/96,4,s,Math.PI/2);if(a===0){p.rotateY(Math.PI/-2);}else if(a===1){p.rotateX(Math.PI/2);}var m=new THREE.Mesh(p,new THREE.MeshBasicMaterial({color:b,transparent:true}));m.matrixAutoUpdate=false;m.userData.color=b;return m;}function n(a,r,s){var p=new THREE.TorusBufferGeometry(r,16/96,4,s,Math.PI/2);if(a===0){p.rotateY(Math.PI/-2);}else if(a===1){p.rotateX(Math.PI/2);}return new THREE.Mesh(p,new THREE.MeshBasicMaterial({opacity:0.2,transparent:true}));}this._gizmo.add(h(new THREE.Vector3(1,0,0),c.x,this._touchAreas));this._gizmo.add(h(new THREE.Vector3(0,1,0),c.y,this._touchAreas));this._gizmo.add(h(new THREE.Vector3(0,0,1),c.z,this._touchAreas));this._gizmo.add(j(1,2,this._touchAreas));this._gizmo.add(j(2,0,this._touchAreas));this._gizmo.add(j(0,1,this._touchAreas));for(var i=0;i<3;i++){this._gizmo.add(k(i,c[["x","y","z"][i]],1,32));this._touchAreas.add(n(i,1,24));}var o=new THREE.MeshBasicMaterial({color:0x0080FF,opacity:0.5,transparent:true,side:THREE.DoubleSide});this._arcMesh=new THREE.Mesh(new THREE.Geometry(),o);this._arcMesh.drawMode=THREE.TriangleFanDrawMode;this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var p=new THREE.Geometry();p.vertices.push(new THREE.Vector3(),new THREE.Vector3());this._line=new THREE.LineSegments(p,new THREE.LineBasicMaterial());this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line);};
e.prototype.hasDomElement=function(){return true;};
e.prototype._updateHandlesVisibility=function(){var a=this._tool.getAllowOperation();var b=a!==d.Rotate;var h=a!==d.Move;var i;for(i=0;i<3;i++){this._touchAreas.children[i].visible=b;}for(i=3;i<6;i++){this._gizmo.children[i].visible=this._touchAreas.children[i].visible=b;}for(i=6;i<9;i++){this._gizmo.children[i].visible=this._touchAreas.children[i].visible=h;}};
e.prototype._initAnchorPoint=function(v){v._anchorPoint=this._gizmo;};
e.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._updateHandlesVisibility();this._initAnchorPoint(v);};
e.prototype.hide=function(){this._viewport=null;this._tool=null;};
e.prototype.setPosition=function(p){this._gizmo.position.copy(p);this._gizmo.updateMatrixWorld();};
e.prototype.setQuaternion=function(a){this._gizmo.quaternion.copy(a);this._gizmo.updateMatrixWorld();};
e.prototype.getGizmoCount=function(){return 1;};
e.prototype.getTouchObject=function(i){this._touchAreas.position.copy(this._gizmo.position);this._touchAreas.quaternion.copy(this._gizmo.quaternion);this._touchAreas.scale.copy(this._gizmo.scale);this._touchAreas.updateMatrixWorld(true);return this._touchAreas;};
var f=[1,2,4,6,5,3,1,2,4];
e.prototype.highlightHandle=function(a,h){var i;for(i=0;i<3;i++){var b=this._gizmo.children[i];var j=f[a]&(1<<i);var k=j?0xFFFF00:b.userData.color;b.material.color.setHex(k);b.children[0].material.color.setHex(k);this._axisTitles.children[i].material.color.setHex(k);}for(i=3;i<6;i++){var p=this._gizmo.children[i];p.material.visible=i===a;var l=p.children[0].geometry.attributes.color;l.copyArray(i===a?[1,1,0,1,1,0,1,1,0]:p.userData.colors);l.needsUpdate=true;p.children[0].material.opacity=(i===a||(h&&a===-1))?1:0.35;p.children[0].visible=(i===a||h);}for(i=6;i<9;i++){var m=this._gizmo.children[i];m.visible=this._tool.getAllowOperation()!==d.Move&&(i===a||h);m.material.color.setHex(i===a?0xFFFF00:m.userData.color);m.material.opacity=(i===a||(h&&a===-1))?1:0.35;}};
e.prototype.selectHandle=function(i){this._handleIndex=i;if(i>=0&&i<3){this._units.setText(g().getText("TOOL_UNITS_MM"));}else if(i>=6&&i<9){this._units.setText(String.fromCharCode(176));}this._editingForm.rerender();this._viewport.setShouldRenderFrame();};
e.prototype.beginGesture=function(){this._isMoved=false;this._isRotated=false;this._originPosition=new THREE.Vector3().setFromMatrixPosition(this._gizmo.matrixWorld);this._originQuaternion=this._gizmo.quaternion.clone();};
e.prototype.endGesture=function(){if(this._isMoved){this._tool.fireMoved({x:this._moveDelta.x,y:this._moveDelta.y,z:this._moveDelta.z});}if(this._isRotated){this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z});}this._line.visible=false;this._arcMesh.visible=false;};
e.prototype._setOffset=function(o,a){if(this._tool.fireEvent("moving",{x:o.x,y:o.y,z:o.z},true)){this._move(o);var m=new THREE.Matrix4().getInverse(this._gizmo.matrixWorld);var s=new THREE.Vector3().setFromMatrixScale(this._gizmo.matrixWorld);var n=this._gizmo.position.clone().applyMatrix4(m);o.copy(this._originPosition).applyMatrix4(m).sub(n).multiply(s);this._line.geometry.vertices[0].copy(o);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();o.set(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z));o.multiplyScalar(1/Math.max(o.x,o.y,o.z));this._line.material.color.setRGB(o.x,o.y,o.z);this._line.visible=true;}};
e.prototype._move=function(o){if(this._tool.getAllowOperation()===d.Rotate){return this;}this._isMoved=true;this._moveDelta.copy(o);this._gizmo.position.copy(this._originPosition).add(o);this._viewport.setShouldRenderFrame();};
e.prototype.move=function(x,y,z){this.beginGesture();this._move(new THREE.Vector3(x,y,z||0));};
e.prototype._setRotationAxisAngle=function(b,h,j){var k=(j-h)%(Math.PI*2);var l=[0,0,0];l[b]=k;l=new THREE.Euler().fromArray(l);if(this._tool.fireEvent("rotating",{x:THREE.Math.radToDeg(l.x),y:THREE.Math.radToDeg(l.y),z:THREE.Math.radToDeg(l.z)},true)){this._rotate(l);var v=[0,0,0];var m=new THREE.Vector3();var o=(b+1)%3,p=(b+2)%3;var n=Math.max(Math.ceil(Math.abs(k)*64/Math.PI),1);for(var i=0;i<=n;i++){var a=h-k*(i/n);m.set(0,0,0).setComponent(o,Math.cos(a)).setComponent(p,Math.sin(a));v.push(m.x,m.y,m.z);}this._arcMesh.geometry=new THREE.BufferGeometry().setAttribute("position",new THREE.Float32BufferAttribute(v,3));this._arcMesh.visible=true;}};
e.prototype._rotate=function(a){if(this._tool.getAllowOperation()===d.Move){return this;}this._tool._deactivateScreenAlignment();this._isRotated=true;this._rotationDelta.set(THREE.Math.radToDeg(a.x),THREE.Math.radToDeg(a.y),THREE.Math.radToDeg(a.z));var b=new THREE.Quaternion().setFromEuler(a);this._gizmo.quaternion.copy(this._originQuaternion).multiply(b);this._viewport.setShouldRenderFrame();};
e.prototype.rotate=function(x,y,z){this.beginGesture();this._rotate(new THREE.Euler(THREE.Math.degToRad(x||0),THREE.Math.degToRad(y||0),THREE.Math.degToRad(z||0)));};
e.prototype._getValueLocaleOptions=function(){return(this._handleIndex>=0&&this._handleIndex<3)?{useGrouping:false}:{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2};};
e.prototype.getValue=function(){if(this._handleIndex>=0&&this._handleIndex<3){var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.dot(this._gizmo.position);}if(this._handleIndex>=6&&this._handleIndex<9){return THREE.Math.radToDeg(this._gizmo.rotation.reorder("YXZ")[["x","y","z"][this._handleIndex-6]]);}return 0;};
e.prototype.setValue=function(v){if(this._handleIndex>=0&&this._handleIndex<3){var o=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize().multiplyScalar(v-this.getValue());this.beginGesture();this._move(o);this.endGesture();}else if(this._handleIndex>=6&&this._handleIndex<9){var a=this._gizmo.rotation.clone();a[["x","y","z"][this._handleIndex-6]]=THREE.Math.degToRad(v);var b=new THREE.Quaternion().setFromEuler(a);var h=this._gizmo.quaternion.clone().inverse().multiply(b);a.setFromQuaternion(h);this.beginGesture();this._rotate(a);this.endGesture();}};
e.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef(),this._viewport._getLayers());}};
e.prototype._updateGizmoTransformation=function(i,a){this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);var s=this._getGizmoScale(this._gizmo.position);this._gizmo.scale.setScalar(this._gizmoSize*s);this._gizmo.updateMatrixWorld(true);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize+18,s);this._line.scale.setScalar(1/(this._gizmoSize*s));};
e.prototype._getEditingFormPosition=function(){var s=this._getGizmoScale(this._gizmo.position);var a=new THREE.Vector3();if(this._handleIndex>=0&&this._handleIndex<3){a.setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();}else if(this._handleIndex>=6&&this._handleIndex<9){var i=this._handleIndex%3;var b=this._extractBasis(this._gizmo.matrixWorld);a.copy(b[(i+1)%3]).add(b[(i+2)%3]).normalize();}return a.clone().multiplyScalar((this._gizmoSize+18)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
e.prototype.render=function(){var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();r.clearDepth();this._updateGizmoTransformation(0,a);r.render(this._sceneGizmo,a);this._updateEditingForm((this._handleIndex>=0&&this._handleIndex<3)||(this._handleIndex>=6&&this._handleIndex<9),this._handleIndex%3);};
return e;});
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolGizmoRenderer',[],function(){"use strict";var A={};
A.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return A;},true);
sap.ui.predefine('sap/ui/vk/tools/AnchorPointToolOperation',[],function(){"use strict";var A={All:"All",Rotate:"Rotate",Move:"Move"};return A;},true);
sap.ui.predefine('sap/ui/vk/tools/AxisColours',[],function(){"use strict";var A={x:0xFF2222,y:0x00A745,z:0x488AF7};return A;},true);
sap.ui.predefine('sap/ui/vk/tools/CoordinateSystem',[],function(){"use strict";var C={Local:"Local",World:"World",Screen:"Screen",Parent:"Parent",Custom:"Custom"};return C;},true);
sap.ui.predefine('sap/ui/vk/tools/CrossSectionTool',["./Tool","./CrossSectionToolHandler","./CrossSectionToolGizmo"],function(T,C,a){"use strict";
var b=T.extend("sap.ui.vk.tools.CrossSectionTool",{
metadata:{properties:{showEditingUI:{type:"boolean",defaultValue:false}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new C(this);this._gizmo=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
b.prototype.setAxis=function(i){if(this._gizmo){this._gizmo.setAxis(i);}return this;};
b.prototype.setFlip=function(f){if(this._gizmo){this._gizmo.setFlip(f);}return this;};
b.prototype.getFlip=function(){return this._gizmo?this._gizmo._flip:undefined;};
b.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
b.prototype.queueCommand=function(c){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolGizmo',["jquery.sap.global","../getResourceBundle","../threejs/thirdparty/three","./Gizmo","./AxisColours"],function(q,g,t,G,A){"use strict";
var C=G.extend("sap.ui.vk.tools.CrossSectionToolGizmo",{metadata:{library:"sap.ui.vk"}});
C.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(g().getText("TOOL_UNITS_MM"),84);this._handleIndex=-1;this._viewport=null;this._tool=null;this._position=new THREE.Vector3(0,0,0);this._plane=new THREE.Plane(new THREE.Vector3(0,0,1),0);this._flip=false;this._matViewProj=new THREE.Matrix4();this._gizmoSize=144;this._firstShowPress=true;this.setAxis(0);};
C.prototype.hasDomElement=function(){return true;};
C.prototype.show=function(v,a){this._viewport=v;this._tool=a;if(this._firstShowPress){var b=v._scene?v._scene._computeBoundingBox(v._getLayers(),true):new THREE.Box3();b.getCenter(this._position);this._firstShowPress=false;}this._plane.constant=-this._plane.normal.dot(this._position);v.setClippingPlanes([this._plane]);};
C.prototype.hide=function(){if(this._viewport){this._viewport.setClippingPlanes([]);this._viewport=null;}this._handleIndex=-1;this._tool=null;this._updateEditingForm(false,-1);};
C.prototype._getOffset=function(){return this._position.getComponent(this._axis);};
C.prototype.getAxis=function(){return this._axis;};
C.prototype.setAxis=function(i){this._handleIndex=-1;this._axis=i;var d=new THREE.Vector3().setComponent(i,1);this._plane.normal.set(0,0,0).setComponent(i,this._flip?-1:1);this._plane.constant=-this._plane.normal.dot(this._position);var a=new THREE.BufferGeometry();var v=new Array(15);var b=new THREE.Vector3(d.y,d.z,d.x),c=new THREE.Vector3(d.z,d.x,d.y),p=new THREE.Vector3();p.sub(b).sub(c).multiplyScalar(0.5).toArray(v,0);p.toArray(v,12);p.add(b).toArray(v,3);p.add(c).toArray(v,6);p.sub(b).toArray(v,9);a.setAttribute("position",new THREE.Float32BufferAttribute(v,3));this._gizmoPlane=new THREE.Line(a,new THREE.LineBasicMaterial({color:0x404040,transparent:true,linewidth:window.devicePixelRatio}));var e=144,l=window.devicePixelRatio*0.5,f=32,h=6,j=48;d=this._plane.normal.clone().multiplyScalar(1/e);var k=0;switch(i){case 0:k=A.x;break;case 1:k=A.y;break;case 2:k=A.z;break;default:break;}var n=new THREE.CylinderBufferGeometry(l,l,e-f,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(d.y,d.z,d.x),d,new THREE.Vector3(d.z,d.x,d.y));m.setPosition(d.clone().multiplyScalar((e-f)*0.5));n.applyMatrix(m);this._gizmoArrow=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:k}));this._gizmoArrow.userData.color=k;var o=new THREE.CylinderBufferGeometry(0,h,f,12,1);m.setPosition(d.clone().multiplyScalar(e-f*0.5));o.applyMatrix(m);var r=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:k}));r.matrixAutoUpdate=false;this._gizmoArrow.add(r);var u=new THREE.CylinderGeometry(j*0.5,j*0.5,e,12,1);m.setPosition(d.clone().multiplyScalar(e*0.5));u.applyMatrix(m);this._touchMesh=new THREE.Mesh(u,new THREE.MeshBasicMaterial({visible:false,side:THREE.DoubleSide}));this._gizmoArrow.add(this._touchMesh);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
C.prototype.setFlip=function(f){this._flip=!!f;var h=this._handleIndex;this.setAxis(this._axis);this._handleIndex=h;return this;};
C.prototype.getTouchObject=function(){return this._touchMesh;};
var s=new THREE.Vector3();
C.prototype._getDelta=function(){var b=this._viewport._scene._computeBoundingBox(this._viewport._getLayers(),true);b.getSize(s);return Math.max(s.x,s.y,s.z);};
C.prototype._setOffset=function(o){var b=this._viewport._scene._computeBoundingBox(this._viewport._getLayers(),true);o=THREE.Math.clamp(o,b.min.getComponent(this._axis),b.max.getComponent(this._axis));this._position.setComponent(this._axis,o);this._plane.constant=-this._plane.normal.dot(this._position);this._viewport.setShouldRenderFrame();};
C.prototype.getValue=function(){return this._position.getComponent(this._handleIndex);};
C.prototype.setValue=function(v){if(this._handleIndex>=0){this._position.setComponent(this._handleIndex,v);this._plane.constant=v;this._viewport.setShouldRenderFrame();}};
C.prototype.highlightArrowHandle=function(h){var c=h?0xFFFF00:this._gizmoArrow.userData.color;this._gizmoArrow.material.color.setHex(c);this._gizmoArrow.children[0].material.color.setHex(c);};
C.prototype.selectHandle=function(i){this._handleIndex=i;this._viewport.setShouldRenderFrame();};
C.prototype._adjustBoundingBox=function(b){b.getSize(s);var d=Math.max(s.x,s.y,s.z)*0.2;b.expandByScalar(d);};
C.prototype._updateGizmo=function(b){var i=this._axis;var o=THREE.Math.clamp(this._position.getComponent(i),b.min.getComponent(i),b.max.getComponent(i));this._position.setComponent(i,o);this._plane.constant=-this._plane.normal.dot(this._position);this._adjustBoundingBox(b);b.getCenter(this._gizmoPlane.position);this._gizmoPlane.position.setComponent(i,o);b.getSize(this._gizmoPlane.scale);this._gizmoPlane.updateMatrixWorld(true);var c=this._viewport.getCamera().getCameraRef();this._gizmoArrow.position.copy(this._gizmoPlane.position);this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);this._gizmoArrow.scale.setScalar(this._gizmoSize*this._getGizmoScale(this._gizmoArrow.position));this._gizmoArrow.updateMatrixWorld(true);};
C.prototype.expandBoundingBox=function(b){if(this._viewport){var a=this._viewport._scene._computeBoundingBox(this._viewport._getLayers(),true);this._updateGizmo(a);b.min.min(a.min);b.max.max(a.max);b.expandByPoint(this._plane.normal.clone().multiply(this._gizmoArrow.scale).add(this._gizmoArrow.position));}};
C.prototype._getEditingFormPosition=function(){return this._plane.normal.clone().applyMatrix4(this._gizmoArrow.matrixWorld).applyMatrix4(this._matViewProj);};
C.prototype.render=function(){var a=this._viewport._scene._computeBoundingBox(this._viewport._getLayers(),true);this._updateGizmo(a);var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();r.render(this._gizmoPlane,c);r.clearDepth();r.render(this._gizmoArrow,c);this._gizmo=this._gizmoArrow;this._updateEditingForm(this._handleIndex>=0,this._handleIndex);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolGizmoRenderer',[],function(){"use strict";var C={};
C.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return C;},true);
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var C=E.extend("sap.ui.vk.tools.CrossSectionToolHandler",{
metadata:{},
constructor:function(t){this._priority=20;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._mouse=new THREE.Vector2();this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0;this._gizmoAxis=new THREE.Vector3();this._dragOrigin=new THREE.Vector2();this._dragOffset=0;this._dragDelta=0;}
});
C.prototype._updateRayCaster=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
C.prototype._updateArrowHandle=function(e){var t=this._gizmo.getTouchObject();var a=-1;if(e.n===1){this._updateRayCaster(e);var i=this._rayCaster.intersectObject(t,true);a=i.length>0?this._gizmo.getAxis():-1;}if(a!==this._axisIndex){this._axisIndex=a;this._gizmo.highlightArrowHandle(a>=0);if(a>=0){this._gizmoAxis.setScalar(0).setComponent(this._axisIndex,1);}this.getViewport().setShouldRenderFrame();}};
C.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateArrowHandle(e);e.handled|=this._axisIndex>=0;}};
C.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateArrowHandle(e);this._gizmo.selectHandle(this._axisIndex);e.handled|=this._axisIndex>=0;}};
C.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateArrowHandle(e);this._gizmo.selectHandle(this._axisIndex);if(this._axisIndex>=0){this._gesture=true;e.handled=true;this._dragOrigin.set(e.x,e.y);this._dragOffset=this._gizmo._getOffset();this._dragDelta=this._gizmo._getDelta()/500;}}};
C.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateRayCaster(e);var d=this._gizmoAxis.clone().applyQuaternion(this.getViewport().getCamera().getCameraRef().quaternion.clone().inverse());d.z=0;d.normalize();if(d.x===0&&d.y===0){d.y=1;}this._gizmo._setOffset(this._dragOffset+((e.x-this._dragOrigin.x)*d.x-(e.y-this._dragOrigin.y)*d.y)*this._dragDelta);}};
C.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateArrowHandle(e);}};
C.prototype.getViewport=function(){return this._tool._viewport;};
C.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
C.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return C;});
sap.ui.predefine('sap/ui/vk/tools/Detector',[],function(){"use strict";var D=function(){this._verticesMap=new Map();this._objArr=[];this._collidedUuids=new Set();this._sourceObjects=null;this._targetObjects=[];this._srcBoxHelper=null;this._sourceBox=new THREE.Box3();this._originPos=new THREE.Vector3();this._targetBoxHelper=[];this._targetBoxes=[];this._detectDistance=20.0;this._direction=new THREE.Vector3();this._isReady=false;this._finalDistance=null;this._finalSnaps=[];this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;this._detectType={"move":this.detectMove.bind(this),"scale":this.detectScale.bind(this),"rotate":this.detectRotate.bind(this)};};
D.prototype.isReady=function(){if(this._isReady&&this._sourceObjects){return true;}else{return false;}};
D.prototype.setDetectDistance=function(v){this._detectDistance=parseFloat(v)||20.0;};
D.prototype.setMoved=function(v){this._isMoved=v;this._intersectDistance=Number.NEGATIVE_INFINITY;};
D.prototype.getObjArray=function(){return this._objArr;};
D.prototype.addObjFromScene=function(v){var s=v._scene.getSceneRef();var a=v._viewStateManager;this._objArr.length=0;this._verticesMap.clear();s.traverse(function(c){if(c.isMesh){if(!this._objArr.find(function(o){return o.uuid===c.uuid;})){this._objArr.push(c);var A=this.getVertices(c.geometry);this._verticesMap.set(c.uuid,A);}}}.bind(this));this.setSource(a);this._isReady=true;};
D.prototype.setSource=function(v){var s=[];v.enumerateSelection(function(n){s.push(n);});if(s.length>0){var o=s.pop();if(this._isReady){v.setSelectionStates(o,s,false,true);}if(o.children.length===0){this._isGroup=false;this._sourceObjects=o;}else{this._isGroup=true;this._sourceObjects=o.children.filter(function(c){return c.type==="Mesh";})[0];}this._srcBoxHelper=new THREE.BoxHelper(this._sourceObjects);this._srcBoxHelper.update();this._sourceBox.setFromObject(this._srcBoxHelper);}else{this._isReady=false;this._sourceObjects=null;this._sourceBox=new THREE.Box3();}this.setTarget();};
D.prototype.setTarget=function(){this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._collidedUuids.clear();this._isMoved=false;if(this._sourceObjects){this._sourceObjects.geometry.computeBoundingSphere();this._originPos=new THREE.Vector3();this._targetObjects=this._objArr.filter(function(o){return o.uuid!==this._sourceObjects.uuid;}.bind(this));this._targetBoxes.length=0;this._targetBoxHelper.length=0;this._targetObjects.forEach(function(t){var a=new THREE.BoxHelper(t);this._targetBoxHelper.push(a);a.update();var c=new THREE.Box3();c.setFromObject(t);this._targetBoxes.push(c);}.bind(this));}else{this._targetObjects.length=0;this._targetBoxes.length=0;this._targetBoxHelper.length=0;}};
D.prototype.updateTargetBox=function(){this._targetBoxHelper.forEach(function(t,i){t.update();this._targetBoxes[i].setFromObject(t);}.bind(this));};
D.prototype.getVertices=function(g){var i,l,a=[];if(g.isGeometry){a=g.vertices;}else if(g.isBufferGeometry){var c=g.attributes.position;if(c!==undefined){var v=new THREE.Vector3();a=[];var o={};var s="";for(i=0,l=c.count;i<l;i++){v.fromBufferAttribute(c,i);s=JSON.stringify(v);if(!o[s]){a.push(v.clone());o[s]=true;}}}}return a;};
D.prototype.findClosestVertex=function(p,r,o){var v=this._verticesMap.get(o.uuid);if(v.length===0){return null;}var d,a=null,l=o.worldToLocal(p.clone());for(var i=0,c=v.length;i<c;i++){d=v[i].distanceTo(l);if(d>r){continue;}r=d;a=v[i];}if(a===null){return null;}return o.localToWorld(a.clone());};
D.prototype.findClosestSnap=function(p,r,t){var i=2;var s;while(!s){s=this.findClosestVertex(p,r,t);r*=i;}return s;};
D.prototype.intersectDetect=function(i){var s=new Map();var a=this._sourceBox.clone().expandByScalar(this._detectDistance);i.forEach(function(o){var c=this._targetObjects.findIndex(function(t){return t.uuid===o.object.uuid;});if(!this._collidedUuids.has(o.object.uuid)&&c!==-1&&this._targetBoxes&&this._targetBoxes[c].intersectsBox(a)){var d=this.findClosestSnap(this._originPos,this._detectDistance,this._targetObjects[c]);s.set(d,this._targetObjects[c]);if(this._targetBoxes[c].intersectsBox(this._sourceBox)&&this._intersectDistance<this._finalDistance){if(this.detectCollisionGJK(this._sourceObjects,this._targetObjects[c])){this._collidedUuid=o.object.uuid;this._intersectDistance=this._finalDistance;}}}}.bind(this));return s;};
D.prototype.getFinalSnaps=function(a){var f=[];if(a.length>0){var s=this.intersectDetect(a);if(s.size!==0){var c=Array.from(s.keys());var m=c[0];var l=m.distanceTo(this._originPos);for(var i=1;i<c.length;++i){var q=c[i];var d=q.distanceTo(this._originPos);if(d<l){m=q;l=d;}}var o=s.get(m);var e=this._originPos.distanceTo(m);var g,n;g=this.findClosestSnap(m,e,this._sourceObjects);var h=g.distanceTo(m);n=this.findClosestSnap(g,h,o);f=[g,n];}}return f;};
D.prototype.snapMove=function(){var o=this._op;if(this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>0.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){o.gizmo._tool._handler._gesture=false;o.gizmo._moveDelta.add(this._direction.clone().multiplyScalar(0.1));o.gizmo._move(o.gizmo._moveDelta);}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;o.viewport.setShouldRenderFrame();}this.detect();}};
D.prototype.snapScale=function(){var o=this._op;if(!o.gizmo._scaleDelta.equals(new THREE.Vector3(1,1,1))&&this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>0.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){o.gizmo._tool._handler._gesture=false;var g=o.gizmo._scaleDelta.toArray();g.forEach(function(s,i){if(s>1){o.gizmo._scaleDelta.setComponent(i,s*1.01);}});o.gizmo._scale(o.gizmo._scaleDelta);}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;o.viewport.setShouldRenderFrame();}this.detect();}else if(Math.abs(this._finalDistance-this._intersectDistance)<=0.1){this._collidedUuids.add(this._collidedUuid);}};
D.prototype.snapRotate=function(){var o=this._op;if(this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>0.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){o.gizmo._tool._handler._gesture=false;o.angle2+=0.02*(o.angle2-o.angle1)/Math.abs(o.angle2-o.angle1);o.gizmo._setRotationAxisAngle(o.handleIndex,o.angle1,o.angle2);}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;o.viewport.setShouldRenderFrame();}this.detect();}};
D.prototype.detectMove=function(){this._direction.copy(this._op.gizmo._moveDelta).normalize();var r=new THREE.Raycaster(this._originPos,this._direction,0,this._detectDistance);this._snapAction=b(this.snapMove,1000/60).bind(this);return r.intersectObjects(this._targetObjects,false);};
D.prototype.detectScale=function(){if(this._op.gizmo._scaleDelta.toArray().find(function(s){return s<=1;})){this._op.gizmo._tool._handler._gesture=true;this._collidedUuids.forEach(function(e){var f=this._targetObjects.find(function(t){return t.uuid===e;});if(f&&!this.detectCollisionGJK(this._sourceObjects,f)){this._collidedUuids.delete(e);}}.bind(this));}this._gizmoPos=new THREE.Vector3();this._op.gizmo._gizmo.getWorldPosition(this._gizmoPos);var a=new THREE.Vector3();this._sourceObjects.getWorldPosition(a);var S=0.0,c=0.0;c=this._sourceObjects.geometry.boundingSphere.clone().applyMatrix4(this._sourceObjects.matrixWorld).radius;S=new THREE.Sphere(a,c+this._detectDistance);var d=[];this._targetBoxes.forEach(function(t,i){if(t.intersectsSphere(S)){d.push({object:this._targetObjects[i]});}}.bind(this));this._snapAction=b(this.snapScale,1000/60).bind(this);return d;};
D.prototype.detectRotate=function(){this._gizmoPos=new THREE.Vector3();this._op.gizmo._gizmo.getWorldPosition(this._gizmoPos);var p=new THREE.Vector3();var s=new THREE.Vector3();var r=new THREE.Raycaster(this._originPos,this._direction,0,this._detectDistance);this._sourceObjects.getWorldPosition(s);this._radius=this._gizmoPos.distanceTo(s);var a=this._op.handleIndex;this._axis=new THREE.Vector3().setFromMatrixColumn(this._op.gizmo._matOrigin,a).normalize();this._axis.transformDirection(this._op.gizmo._gizmo.matrixWorld);if(this._radius>0.01){p.subVectors(s,this._gizmoPos).normalize();this._detectDistance=this._radius;this._direction.crossVectors(p,this._axis).normalize();}else if(this._finalSnaps.length===2){p.subVectors(this._finalSnaps[0],this._gizmoPos).normalize();this._direction.crossVectors(p,this._axis).normalize();}if(this._op.gizmo._rotationDelta.getComponent(a)>0){this._direction.negate();}var c=new THREE.Plane(this._axis);var d=[],t=[];var S=0.0,e=0.0;if(this._radius<0.01){e=this._sourceObjects.geometry.boundingSphere.clone().applyMatrix4(this._sourceObjects.matrixWorld).radius;S=new THREE.Sphere(this._gizmoPos,e);this._targetBoxes.forEach(function(f,i){if(f.intersectsSphere(S)&&f.intersectsPlane(c)){d.push({object:this._targetObjects[i]});}}.bind(this));}else{S=new THREE.Sphere(this._gizmoPos,this._radius);this._targetBoxes.forEach(function(f,i){if(f.intersectsSphere(S)&&f.intersectsPlane(c)){t.push(this._targetObjects[i]);}}.bind(this));d=r.intersectObjects(t,false);}this._snapAction=b(this.snapRotate,1000/60).bind(this);return d;};
D.prototype.detect=function(d){var o=this._op=d||this._op;if(!this.isReady()||!this._verticesMap.has(this._sourceObjects.uuid)){this.addObjFromScene(o.viewport);}else{this._srcBoxHelper.update();this._sourceBox.setFromObject(this._sourceObjects);this._sourceBox.getCenter(this._originPos);this.updateTargetBox();var i=this._detectType[o.detectType]();this._finalSnaps=this.getFinalSnaps(i);if(this._finalSnaps.length===2){var f=new THREE.Vector3();f.subVectors(this._finalSnaps[1],this._finalSnaps[0]);this._finalDistance=f.length();if(this._finalDistance){this._snapAction();}}}};
function b(f,w){var t;return function(){var a=this,c=arguments;clearTimeout(t);t=setTimeout(function(){t=null;f.apply(a,c);},w);};}
D.prototype.detectCollisionGJK=function(o,t){var M=64;var c=this;function G(f,g){var h=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];var n=2;var d=c._direction;h[1]=v(f,g,d);if(h[1].dot(d)<0){return false;}d=h[1].clone().negate();h[0]=v(f,g,d);if(h[0].dot(d)<0){return false;}var j=h[1].clone().sub(h[0]);var k=h[0].clone().negate();d=j.clone().cross(k).cross(j);var m=function(a,O,x,y,z,A,E){if(x.clone().cross(A).dot(O)>0){h[1]=h[0];h[0]=a.clone();d=x.clone().cross(O).cross(x);n=2;}else{h[2]=h[1];h[1]=h[0];h[0]=a.clone();d=A.clone();}};var r=function(a,O,x,y,z,A,E){if(A.clone().cross(y).dot(O)>0){h[0]=a.clone();d=y.clone().cross(O).cross(y);n=2;}else{m(a,O,x,y,z,A,E);}};var u=function(a,O,x,y,z,A,E){if(A.clone().cross(y).dot(O)>0){h[0]=h[1];h[1]=h[2].clone();x=y;y=z.clone();A=E.clone();r(a,O,x,y,z,A,E);}else{m(a,O,x,y,z,A,E);}};function v(f,g,d){var l=d.clone().normalize();var p=w(f,l);var q=w(g,l.negate());return p.clone().sub(q);}function w(L,d){var N=c._verticesMap.get(L.uuid);var p=L.localToWorld(N[0].clone());var l=p.dot(d);for(var i=1;i<N.length;++i){var q=L.localToWorld(N[i].clone());var P=q.dot(d);if(P>l){p=q;l=P;}}return p;}for(var i=0;i<M;++i){var a=v(f,g,d);if(a.dot(d)<0){return false;}var O,x,y,z,A;if(n===2){O=a.clone().negate();x=h[0].clone().sub(a);y=h[1].clone().sub(a);A=x.clone().cross(y);var B=x.clone().cross(A);if(B.dot(O)>0){h[1]=h[0];h[0]=a.clone();d=x.clone().cross(O).cross(x);continue;}var C=A.clone().cross(y);if(C.dot(O)>0){h[0]=a.clone();d=y.clone().cross(O).cross(y);continue;}if(A.dot(O)>0){h[2]=h[1];h[1]=h[0];h[0]=a.clone();d=A.clone();}else{h[2]=h[0];h[0]=a.clone();d=A.clone().negate();}n=3;continue;}O=a.clone().negate();x=h[0].clone().sub(a);y=h[1].clone().sub(a);z=h[2].clone().sub(a);A=x.clone().cross(y);var E=y.clone().cross(z);var F=z.clone().cross(x);var H=0x1;var I=0x2;var J=0x4;var K=(A.dot(O)>0?H:0)|(E.dot(O)>0?I:0)|(F.dot(O)>0?J:0);if(K===0){return true;}if(K===H){r(a,O,x,y,z,A,E);}else if(K===I){h[0]=h[1];h[1]=h[2].clone();x=y;y=z.clone();A=E.clone();r(a,O,x,y,z,A,E);}else if(K===J){h[1]=h[0];h[0]=h[2].clone();y=x;x=z.clone();A=F.clone();r(a,O,x,y,z,A,E);}else if(K===H||I){u(a,O,x,y,z,A,E);}else if(K===I||J){j=h[0];h[0]=h[1];h[1]=h[2];h[2]=j;j=x;x=y;y=z;z=j;A=E;E=F.clone();u(a,O,x,y,z,A,E);}else if(K===J||H){j=h[1];h[1]=h[0];h[0]=h[2];h[2]=j;j=y;y=x;x=z;z=j;E=A;A=F.clone();u(a,O,x,y,z,A,E);}else{return true;}}return true;}var s=performance.now();var e=G(o,t);if(e){console.log("Collide (ms): ",performance.now()-s);return true;}else{console.log("Not Collide (ms): ",performance.now()-s);return false;}};
return D;});
sap.ui.predefine('sap/ui/vk/tools/Gizmo',["../library","sap/m/library","sap/m/Input","sap/m/Label","sap/ui/core/library","sap/ui/core/Control","./CoordinateSystem","./AxisColours","./ToolNodeSet","../threejs/thirdparty/three","./GizmoPlacementMode","../AnimationTrackType"],function(a,L,I,b,c,C,d,A,T,t,G,e){"use strict";var f=L.InputType;
var g=C.extend("sap.ui.vk.tools.Gizmo",{metadata:{library:"sap.ui.vk"}});
g.prototype.hasDomElement=function(){return true;};
g.prototype._createAxisTitles=function(s,h,i){s=s||32;h=h||20;function j(l,m){var n=document.createElement("canvas");n.width=n.height=s*window.devicePixelRatio;var o=n.getContext("2d");var p=n.width*0.5;o.font="Bold "+h*window.devicePixelRatio+"px Arial";o.textAlign="center";o.textBaseline="middle";o.fillStyle="#000";o.globalAlpha=0.5;o.filter="blur(3px)";o.fillText(l,p+1,p+1);o.fillStyle="#fff";o.globalAlpha=1;o.filter="blur(0px)";o.fillText(l,p,p);if(i){o.beginPath();o.arc(p,p,p-window.devicePixelRatio,0,2*Math.PI,false);o.closePath();o.lineWidth=window.devicePixelRatio*2;o.strokeStyle="#fff";o.stroke();}var q=new THREE.Texture(n);q.needsUpdate=true;var r=new THREE.MeshBasicMaterial({map:q,color:m,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide});var u=new THREE.Mesh(new THREE.PlaneGeometry(s,s),r);u.userData.color=m;return u;}var k=new THREE.Group();k.add(j("X",A.x));k.add(j("Y",A.y));k.add(j("Z",A.z));return k;};
g.prototype._extractBasis=function(m){var h=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];m.extractBasis(h[0],h[1],h[2]);h[0].normalize();h[1].normalize();h[2].normalize();return h;};
g.prototype._updateAxisTitles=function(o,h,j,k,s){var l=this._extractBasis(h.matrixWorld);o.children.forEach(function(m,i){m.position.copy(l[i]).multiplyScalar(k.constructor===THREE.Vector3?k.getComponent(i):k);m.quaternion.copy(j.quaternion);});o.position.copy(h.position);o.scale.setScalar(s);};
g.prototype._updateSelection=function(h){if(h==null){return false;}var n=[];if(this._tool){if(this._tool.getNodeSet()===T.Highlight){h.enumerateSelection(function(i){n.push({node:i});});}else{h.enumerateOutlinedNodes(function(i){n.push({node:i});});}}if(this._nodes.length===n.length&&this._nodes.every(function(v,i){return n[i].node===v.node;})){return false;}this._cleanTempData();this._nodes=n;n.forEach(function(j){j.ignore=false;var p=j.node.parent;while(p&&!j.ignore){for(var i=0,l=n.length;i<l;i++){if(n[i].node===p){j.ignore=true;break;}}p=p.parent;}this._getOffsetForRestTransformation(j.node);}.bind(this));return true;};
g.prototype.setPlacementMode=function(p){this._placementMode=p;};
g.prototype._getAnchorPoint=function(){return this._viewport?this._viewport._anchorPoint:null;};
g.prototype._getSelectionCenter=function(h){if(this._nodes.length===1){var n=this._nodes[0].node;h.setFromMatrixPosition(n.matrixWorld);var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(n);}if(this._placementMode===G.Rest&&u&&u.offsetWTranslation){h.x+=u.offsetWTranslation[0];h.y+=u.offsetWTranslation[1];h.z+=u.offsetWTranslation[2];}}else{h.setScalar(0);if(this._nodes.length>0){var i=new THREE.Vector3();this._nodes.forEach(function(j){var n=j.node;if(n.userData.boundingBox){n.userData.boundingBox.getCenter(i);h.add(i.applyMatrix4(n.matrixWorld));}else{h.add(i.setFromMatrixPosition(n.matrixWorld));}});h.multiplyScalar(1/this._nodes.length);}}};
g.prototype._getGizmoScale=function(p){var r=this._viewport.getRenderer();var h=this._viewport.getCamera().getCameraRef();var i=new THREE.Vector4();i.copy(p).applyMatrix4(this._matViewProj);return i.w*2/(r.getSize(new THREE.Vector2()).x*h.projectionMatrix.elements[0]);};
g.prototype._getEffectiveParent=function(h){if(this._viewport._viewStateManager){var j=this._viewport._viewStateManager.getJoints();if(j){for(var n=0;n<j.length;n++){var i=j[n];if(!i.node||!i.parent){continue;}if(i.node===h){return i.parent;}}}}return h.parent;};
g.prototype._cleanTempData=function(){this._nodes.forEach(function(n){var h=n.node;if(h.userData){delete h.userData.skipUpdateJointNode;}});if(this._nodeUserDataMap){this._nodeUserDataMap.clear();}this._sequence=null;};
g.prototype._prepareForCreatingKey=function(s){this._sequence=s;};
g.prototype._getOffsetForRestTransformation=function(n){if(this._viewport._viewStateManager){if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map();}var u=this._nodeUserDataMap.get(n);if(!u){u={};this._nodeUserDataMap.set(n,u);}var h=this._viewport._viewStateManager.getTransformation(n);var r=this._viewport._viewStateManager.getRestTransformation(n);var w=this._viewport._viewStateManager.getRestTransformationWorld(n);var i=this._viewport._viewStateManager.getTransformationWorld(n);if(!r||!w){return;}var p=new THREE.Vector3(r.translation[0],r.translation[1],r.translation[2]);var s=new THREE.Vector3(r.scale[0],r.scale[1],r.scale[2]);u.quatRest=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);u.matRest=new THREE.Matrix4().compose(p,u.quatRest,s);u.matRestInv=new THREE.Matrix4().getInverse(u.matRest);u.initialTranslation=h.translation.slice();u.initialScale=h.scale.slice();u.initialQuaternion=new THREE.Quaternion(h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3]);u.matInitial=n.matrix.clone();u.matInitialInv=new THREE.Matrix4().getInverse(n.matrix);u.quatInitialDiff=u.initialQuaternion.clone().multiply(u.quatRest.clone().inverse());u.quatInitialDiffInv=u.quatInitialDiff.clone().inverse();u.matInitialDiff=n.matrix.clone().multiply(u.matRestInv);u.offsetWTranslation=[w.translation[0]-i.translation[0],w.translation[1]-i.translation[1],w.translation[2]-i.translation[2]];var j=new THREE.Vector3();var k=new THREE.Box3();k.expandByObject(n);k.getCenter(j);u.offsetWTranslationCenter=[w.translation[0]+j.x-2*i.translation[0],w.translation[1]+j.y-2*i.translation[1],w.translation[2]+j.z-2*i.translation[2]];var l=[0,0,0];var m=this._viewport._viewStateManager.getAnimationPlayer();if(m){var o=m.getAnimatedProperty(n,e.Rotate);if(o.offsetToPrevious){l=o.offsetToPrevious;}}u.euler=new THREE.Euler(0,0,0);u.startEuler=new THREE.Euler(0,0,0);u.eulerInParentCoors=new THREE.Euler(l[0],l[1],l[2]);u.startEulerInParentCoors=new THREE.Euler(l[0],l[1],l[2]);}};
g.prototype._updateGizmoObjectTransformation=function(o,i,m){var h=this._viewport.getCamera().getCameraRef();var j=this._getAnchorPoint();var n,p,k;if(j&&this._coordinateSystem===d.Custom){o.position.copy(j.position);o.quaternion.copy(j.quaternion);}else if(this._coordinateSystem===d.Local||this._coordinateSystem===d.Parent){k=this._nodes[i].node;var l=this._getEffectiveParent(k);if(this._coordinateSystem===d.Parent&&l){p=l.matrixWorld;}n=k.matrixWorld.clone();if(p){p.decompose(o.position,o.quaternion,o.scale);o.position.setFromMatrixPosition(n);}else{n.decompose(o.position,o.quaternion,o.scale);}var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(k);}if(this._placementMode===G.Rest&&u&&u.offsetWTranslation){if(m){o.position.x+=u.offsetWTranslationCenter[0];o.position.y+=u.offsetWTranslationCenter[1];o.position.z+=u.offsetWTranslationCenter[2];}else{o.position.x+=u.offsetWTranslation[0];o.position.y+=u.offsetWTranslation[1];o.position.z+=u.offsetWTranslation[2];}n.setPosition(o.position);}}else if(this._nodes.length>0){this._getSelectionCenter(o.position);if(this._coordinateSystem===d.Screen){o.quaternion.copy(h.quaternion);}else{o.quaternion.set(0,0,0,1);}}var s=this._getGizmoScale(o.position);o.scale.setScalar(this._gizmoSize*s);if(n){var q=this._extractBasis(p?p:n);o.matrix.makeBasis(q[0],q[1],q[2]);o.matrix.scale(o.scale);o.matrix.copyPosition(n);if(p&&k){var r=new THREE.Matrix4().makeRotationFromQuaternion(k.quaternion);o.matrix=o.matrix.multiply(r);}o.matrixAutoUpdate=false;}else{o.matrixAutoUpdate=true;}o.updateMatrixWorld(true);return s;};
g.prototype._expandBoundingBox=function(h,j,l){var k=this.getGizmoCount();if(k>0){this._matViewProj.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse);for(var i=0;i<k;i++){this._updateGizmoTransformation(i,j);this._sceneGizmo._expandBoundingBox(h,l,false);}}};
g.prototype._createEditingForm=function(u,w){this._label=new sap.m.Label({}).addStyleClass("sapUiVkTransformationToolEditLabel");this._units=new sap.m.Label({text:u}).addStyleClass("sapUiVkTransformationToolEditUnits");this._input=new I({width:w+"px",type:f.Number,maxLength:10,textAlign:c.TextAlign.Right,change:function(h){this.setValue(h.getParameter("value"));}.bind(this)});this._editingForm=new sap.m.HBox({items:[this._label,this._input,this._units]}).addStyleClass("sapUiSizeCompact");this._editingForm.onkeydown=this._editingForm.ontap=this._editingForm.ontouchstart=function(h){h.setMarked();};};
g.prototype._getValueLocaleOptions=function(){return{useGrouping:false};};
g.prototype._updateEditingForm=function(h,i){var j=this.getDomRef();if(j){if(h&&this._tool&&this._tool.getShowEditingUI()){this._label.setText(["X","Y","Z"][i]);this._label.rerender();var l=this._label.getDomRef();if(l){l.style.color=new THREE.Color(A[["x","y","z"][i]]).getStyle();}this._input.setValue(this.getValue().toLocaleString("fullwide",this._getValueLocaleOptions()));var p=this._getEditingFormPosition();var k=this._gizmo.position.clone().applyMatrix4(this._matViewProj).sub(p);var v=this._viewport.getDomRef().getBoundingClientRect();var m=j.getBoundingClientRect();var n=k.x>-0.0001;var o=n?m.width:-m.width;var q=m.height*0.5;var x=THREE.Math.clamp(v.width*(p.x*0.5+0.5)+(n?-20:20),Math.max(o,0),v.width+Math.min(o,0));var y=THREE.Math.clamp(v.height*(p.y*-0.5+0.5),q,v.height-q);j.style.left=Math.round(x)+"px";j.style.top=Math.round(y)+"px";j.style.transform="translate("+(n?"-100%":"0%")+", -50%)";j.style.display="block";}else{j.style.display="none";}}};
return g;});
sap.ui.predefine('sap/ui/vk/tools/GizmoPlacementMode',[],function(){"use strict";var G={Default:"Default",ObjectCenter:"ObjectCenter",OnScreen:"OnScreen",Rest:"Rest"};return G;},true);
sap.ui.predefine('sap/ui/vk/tools/HitTestClickType',[],function(){"use strict";var H={Single:"Single",Double:"Double",Context:"Context"};return H;},true);
sap.ui.predefine('sap/ui/vk/tools/HitTestIdMode',[],function(){"use strict";var H={ThreeJS:"ThreeJS",VEsID:"VEsID",Callback:"Callback"};return H;},true);
sap.ui.predefine('sap/ui/vk/tools/HitTestTool',["./Tool","./HitTestToolHandler","./HitTestIdMode"],function(T,H,a){"use strict";
var b=T.extend("sap.ui.vk.tools.HitTestTool",{
metadata:{properties:{IdMode:{type:"sap.ui.vk.tools.HitTestIdMode",defaultValue:a.ThreeJS}},events:{hit:{parameters:{id:"any",object:"any",point:"any",clickType:"sap.ui.vk.tools.HitTestClickType"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("63150593-75f6-c330-2a7a-c1f85d36b2b9");this._viewport=null;this._handler=new H(this);this._loco=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){this._prepare();}else{this._removeLocoHandler();}}return this;};
b.prototype._prepare=function(){if(!this._addLocoHandler()){return false;}var o=false;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;o=true;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&(this._viewport._scene&&this._viewport._scene.getSceneRef())){o=true;}return o;};
b.prototype.queueCommand=function(c){if(this._prepare()){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(c,this._dvlRendererId);}}return this;};
b.prototype.hitTest=function(x,y,s,c,d){if(this._prepare()){var h=null;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return null;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(!s||!c){h=null;}else if(this._viewport._renderer){var e=this._viewport._renderer.domElement;var m=new THREE.Vector2((x-e.offsetLeft)/e.clientWidth*2-1,(e.offsetTop-y)/e.clientHeight*2+1);var r=new THREE.Raycaster();r.setFromCamera(m,c.getCameraRef());var f=r.intersectObjects(s.getSceneRef().children,true);if(f&&f.length){var l=c.getCameraRef().layers;for(var i in f){var g=f[i];var o=g.object;var p=o.parent;while(p){if(p.userData.closed){o=p;}p=p.parent;}while(o.parent&&(o.userData.skipIt||(o.layers===o.parent.layers))){o=o.parent;}if(o.layers.test(l)&&!o.isBillboard&&!o.isDetailView){g.object=o;h=g;break;}}}}}var j=null;if(h){var k;switch(this.getIdMode()){case a.VEsID:k=this._viewport._scene.nodeRefToPersistentId(h.object);break;case a.ThreeJS:k=h.object.id;break;default:k=h.object.id;break;}j={id:k,object:h.object,point:h.point,clickType:d};this.fireHit(j);}return j;}};
return b;});
sap.ui.predefine('sap/ui/vk/tools/HitTestToolHandler',["sap/ui/base/EventProvider","./HitTestClickType"],function(E,H){"use strict";
var a=E.extend("sap.ui.vk.tools.HitTestToolHandler",{
metadata:{},
constructor:function(T){this._priority=0;this._tool=T;this._rect=null;this._gesture=false;this._nomenu=false;}
});
a.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
a.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
a.prototype.beginGesture=function(e){e.handled=false;};
a.prototype.move=function(e){e.handled=false;};
a.prototype.endGesture=function(e){e.handled=false;};
a.prototype._executeHittest=function(e,c){if(this._inside(e)&&!this._gesture){this._gesture=false;var x=e.x-this._rect.x,y=e.y-this._rect.y;this._gizmo=this._tool.getGizmo();if(this._gizmo){this._gizmo.show(this._tool._viewport);this._gizmo.moveGizmo(x,y);}var s=this._tool._viewport.getScene();var b=this._tool._viewport.getCamera();this._tool.hitTest(x,y,s,b,c);if(this._gizmo){this._gizmo.hide();}}};
a.prototype.click=function(e){this._executeHittest(e,H.Single);e.handled=true;};
a.prototype.doubleClick=function(e){this._executeHittest(e,H.Double);e.handled=false;};
a.prototype.contextMenu=function(e){this._executeHittest(e,H.Context);e.handled=false;};
a.prototype.getViewport=function(){return this._tool._viewport;};
return a;});
sap.ui.predefine('sap/ui/vk/tools/MoveTool',["./Tool","./CoordinateSystem","./GizmoPlacementMode","./MoveToolHandler","./MoveToolGizmo","./Detector","./ToolNodeSet"],function(T,C,G,M,a,D,b){"use strict";
var c=T.extend("sap.ui.vk.tools.MoveTool",{
metadata:{properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:C.World},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:G.Default},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:b.Highlight}},events:{moving:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},moved:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new M(this);this._gizmo=null;this._detector=new D();}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setPlacementMode(this.getPlacementMode());this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
c.prototype.setPlacementMode=function(v){var d=this.getPlacementMode();if(d!==v){this.setProperty("placementMode",v,true);this.getGizmo().setPlacementMode(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.firePlacementModeChanged({placementMode:v});}return this;};
c.prototype.setCoordinateSystem=function(v){var d=this.getCoordinateSystem();if(d!==v){this.setProperty("coordinateSystem",v,true);this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireCoordinateSystemChanged({coordinateSystem:v});}return this;};
c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setEnableSnapping=function(v){this.setProperty("enableSnapping",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setNodeSet=function(v){this.setProperty("nodeSet",v,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
c.prototype.getDetector=function(){return this._detector;};
c.prototype.move=function(x,y,z,d){var o;if(d&&d!==this.getCoordinateSystem()){o=this.getCoordinateSystem();this.setCoordinateSystem(d);}if(this._gizmo){this._gizmo.move(x,y,z);}if(o){this.setCoordinateSystem(o);}if(this._gizmo){this._gizmo.endGesture();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.prepareForCreatingTranslateKey=function(s){if(this._gizmo){this._gizmo._prepareForCreatingKey(s);var n=this._gizmo._getNodesProperties();this.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:n},true);}};
return c;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolGizmo',["jquery.sap.global","../getResourceBundle","../threejs/thirdparty/three","./Gizmo","./MoveToolGizmoRenderer","./CoordinateSystem","./GizmoPlacementMode","./AxisColours","../AnimationTrackType"],function(q,g,t,G,M,C,d,A,e){"use strict";
var f=G.extend("sap.ui.vk.tools.MoveToolGizmo",{metadata:{library:"sap.ui.vk"}});
f.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(g().getText("TOOL_UNITS_MM"),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3();this._moveDelta=new THREE.Vector3();this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._sceneGizmo.add(l);this._sceneGizmo.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._coordinateSystem=C.World;this._placementMode=d.Default;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;function c(a,b,k){var n=96,o=1,p=24,r=4,s=48;a.multiplyScalar(1/n);var u=new THREE.MeshLambertMaterial({color:b,transparent:true});var v=new THREE.CylinderBufferGeometry(o,o,n-p,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));m.setPosition(a.clone().multiplyScalar((n-p)*0.5));v.applyMatrix(m);var w=new THREE.Mesh(v,u);w.matrixAutoUpdate=false;w.userData.color=b;var x=new THREE.CylinderBufferGeometry(0,r,p,12,1);m.setPosition(a.clone().multiplyScalar(n-p*0.5));x.applyMatrix(m);var y=new THREE.Mesh(x,u);y.matrixAutoUpdate=false;w.add(y);var z=new THREE.CylinderGeometry(s*0.5,s*0.5,s,12,1);z.applyMatrix(m);var B=new THREE.CylinderGeometry(s*0.5,s*0.2,s,12,1);m.setPosition(a.clone().multiplyScalar(n*0.5));z.merge(B,m);k.add(new THREE.Mesh(z,u));return w;}function i(a,b,k){var m=new Float32Array(9);m[a]=m[b+6]=1;m[a+3]=m[b+3]=0.5;var v=new THREE.Vector3().setComponent(a,0.333);var n=new THREE.Vector3().setComponent(b,0.333);var j=new THREE.Geometry();j.vertices.push(new THREE.Vector3(),v,n,v.clone().add(n));j.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var o=new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,visible:false,side:THREE.DoubleSide});var p=new THREE.Mesh(j,o);p.matrixAutoUpdate=false;p.userData.colors=m;var r=new THREE.BufferGeometry();var s=new Float32Array(9);s[a]=s[a+3]=s[b+3]=s[b+6]=0.333;r.setAttribute("position",new THREE.Float32BufferAttribute(s,3));r.setAttribute("color",new THREE.Float32BufferAttribute(m,3));var u=new THREE.Line(r,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));u.matrixAutoUpdate=false;p.add(u);var w=new THREE.Geometry();w.vertices.push(new THREE.Vector3(),v,n,v.clone().add(n));w.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));k.add(new THREE.Mesh(w,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return p;}this._gizmo.add(c(new THREE.Vector3(1,0,0),A.x,this._touchAreas));this._gizmo.add(c(new THREE.Vector3(0,1,0),A.y,this._touchAreas));this._gizmo.add(c(new THREE.Vector3(0,0,1),A.z,this._touchAreas));this._gizmo.add(i(1,2,this._touchAreas));this._gizmo.add(i(2,0,this._touchAreas));this._gizmo.add(i(0,1,this._touchAreas));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var j=new THREE.Geometry();j.vertices.push(new THREE.Vector3(),new THREE.Vector3());this._line=new THREE.LineSegments(j,new THREE.LineBasicMaterial());this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line);};
f.prototype.hasDomElement=function(){return true;};
f.prototype.resetValues=function(){this._value.setScalar(0);};
f.prototype.setCoordinateSystem=function(c){this._coordinateSystem=c;var s=c===C.Screen;var a=this._gizmo.children,b=this._touchAreas.children;a[2].visible=a[3].visible=a[4].visible=!s;b[2].visible=b[3].visible=b[4].visible=!s;this._axisTitles.children[2].visible=!s;this._gizmoIndex=this._handleIndex=-1;};
f.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._nodes.length=0;this._updateSelection(v._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:n},true);};
f.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false);};
f.prototype.getGizmoCount=function(){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
f.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i,true);return this._touchAreas;};
var h=[1,2,4,6,5,3];
f.prototype.highlightHandle=function(a,b){var i;for(i=0;i<3;i++){var c=this._gizmo.children[i];var j=h[a]&(1<<i);var k=j?0xFFFF00:c.userData.color;c.material.color.setHex(k);c.material.opacity=(j||b)?1:0.35;c.children[0].material.color.setHex(k);c.children[0].material.opacity=(j||b)?1:0.35;var l=this._axisTitles.children[i];l.material.color.setHex(k);l.material.opacity=j||b?1:0.35;}for(i=3;i<6;i++){var p=this._gizmo.children[i];p.material.visible=i===a;var m=p.children[0].geometry.attributes.color;m.copyArray(i===a?[1,1,0,1,1,0,1,1,0]:p.userData.colors);m.needsUpdate=true;p.children[0].material.opacity=(i===a||b)?1:0.35;}};
f.prototype.selectHandle=function(i,a){this._gizmoIndex=a;this._handleIndex=i;if(this._tool.getAutoResetValues()){this.resetValues();}this._viewport.setShouldRenderFrame();};
f.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._moveDelta.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){var a=n.node;n.matOrigin=a.matrixWorld.clone();n.originLocal=a.position.clone();n.origin=new THREE.Vector3().setFromMatrixPosition(a.matrixWorld);if(a.parent){n.matParentInv=new THREE.Matrix4().getInverse(a.parent.matrixWorld);}else{n.matParentInv=new THREE.Matrix4();}});};
f.prototype._printEventInfo=function(a,x,y,z,n){q.sap.log.debug(a+" is fired:"+" x = "+x+"; y = "+y+"; z = "+z);n.forEach(function(p){q.sap.log.debug("Node: "+p.node.name);if(p.offsetToRest){q.sap.log.debug("offsetToRest: [ "+p.offsetToRest[0]+", "+p.offsetToRest[1]+", "+p.offsetToRest[2]+" ] ");}else{q.sap.log.debug("offsetToRest: null");}if(p.offsetToPrevious){q.sap.log.debug("offsetToPrevious: [ "+p.offsetToPrevious[0]+", "+p.offsetToPrevious[1]+", "+p.offsetToPrevious[2]+" ] ");}else{q.sap.log.debug("offsetToPrevious: null");}if(p.absolute){q.sap.log.debug("absolute: [ "+p.absolute[0]+", "+p.absolute[1]+", "+p.absolute[2]+" ] ");}else{q.sap.log.debug("absolute: null");}if(p.world){q.sap.log.debug("world: [ "+p.world[0]+", "+p.world[1]+", "+p.world[2]+" ] ");}else{q.sap.log.debug("world: null");}if(p.restDifference){q.sap.log.debug("restDifference: [ "+p.restDifference[0]+", "+p.restDifference[1]+", "+p.restDifference[2]+" ] ");}else{q.sap.log.debug("restDifference: null");}if(p.restDifferenceInCoordinates){q.sap.log.debug("restDifferenceInCoordinates: [ "+p.restDifferenceInCoordinates[0]+", "+p.restDifferenceInCoordinates[1]+", "+p.restDifferenceInCoordinates[2]+" ] ");}else{q.sap.log.debug("restDifferenceInCoordinates: null");}});};
f.prototype._getOffsetToRestInCooridnateSystem=function(n,o,c){if(c===C.World){return o.toArray();}else if(c===C.Custom){var a=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);var b=new THREE.Matrix4().getInverse(a);return o.clone().applyMatrix4(b).toArray();}else if(c===C.Local){var i=new THREE.Matrix4().extractRotation(n.matrixWorld);var j=new THREE.Matrix4().getInverse(i);return o.clone().applyMatrix4(j).toArray();}else if(c===C.Screen){var s=this._viewport.getRenderer().getSize(new THREE.Vector2());var k=this._viewport.getCamera().getCameraRef();var l=new THREE.Vector4().copy(this._gizmo.position).applyMatrix4(this._matViewProj);var m=new THREE.Matrix3().setFromMatrix4(k.matrixWorld);var p=new THREE.Matrix3().getInverse(m);var r=o.clone().applyMatrix3(p);var u=2*l.w/(k.projectionMatrix.elements[0]*s.width);var v=2*l.w/(k.projectionMatrix.elements[5]*s.height);return[r.x/u,r.y/v,0.0];}};
f.prototype._getNodesProperties=function(){var n=[];this._nodes.forEach(function(a){var b=a.node;var p={};p.node=b;var r=this._viewport._viewStateManager.getRelativeTransformation(b);p.offsetToRest=r.translation.slice();var c=new THREE.Matrix4();if(b.parent){c=new THREE.Matrix4().extractRotation(b.parent.matrixWorld);}p.offsetToPrevious=p.offsetToRest.slice();var i=this._getEffectiveParent(b);if(i!==b.parent){if(b.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(b,e.Translate);}if(b.userData&&b.userData.offsetTranslation){p.offsetToRest=b.userData.offsetTranslation.slice();}else{p.offsetToRest=[0,0,0];}p.offsetToPrevious=p.offsetToRest.slice();if(b.userData.skipUpdateJointNode){b.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();b.userData.skipUpdateJointNode=true;}}if(this._sequence){var s=this._viewport._viewStateManager._getEndPropertyInPreviousSequence(b,e.Translate,this._sequence);if(s){p.offsetToPrevious[0]-=s[0];p.offsetToPrevious[1]-=s[1];p.offsetToPrevious[2]-=s[2];}}var j=this._viewport._viewStateManager.getTransformation(b);p.absolute=[j.translation[0],j.translation[1],j.translation[2]];var w=this._viewport._viewStateManager.getTransformationWorld(b);p.world=w.translation;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(b);}if(u&&u.initialTranslation){p.restDifference=[j.translation[0]-u.initialTranslation[0],j.translation[1]-u.initialTranslation[1],j.translation[2]-u.initialTranslation[2]];if(this._coordinateSystem===C.Parent){p.restDifferenceInCoordinates=p.restDifference.slice();}else{var k=new THREE.Vector3(p.restDifference[0],p.restDifference[1],p.restDifference[2]).applyMatrix4(c);p.restDifferenceInCoordinates=this._getOffsetToRestInCooridnateSystem(b,k,this._coordinateSystem);}}n.push(p);}.bind(this));return n;};
f.prototype.endGesture=function(){this._line.visible=false;var n=this._getNodesProperties();var o=this._moveDelta.clone();if(this._coordinateSystem===C.Custom){var a=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);var b=new THREE.Matrix4().getInverse(a);o.applyMatrix4(b);}delete this._beginValue;this._nodes.forEach(function(c){var i=c.node;if(i.userData){delete i.userData.skipUpdateJointNode;}this._viewport._viewStateManager._setJointNodeOffsets(i,e.Translate);}.bind(this));this._tool.fireMoved({x:o.x,y:o.y,z:o.z,nodesProperties:n});this._printEventInfo("Event 'moved'",o.x,o.y,o.z,n);};
f.prototype._setOffset=function(o,a){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){var n=this._nodes[a];var b=n.node;var c=this._getEffectiveParent(b);if(this._coordinateSystem===C.Parent&&c){b=c;}var m=new THREE.Matrix4().getInverse(b.matrixWorld);var s=new THREE.Vector3().setFromMatrixScale(b.matrixWorld);var i=n.origin.clone().applyMatrix4(m);o=n.origin.clone().add(o).applyMatrix4(m).sub(i).multiply(s);}else if(this._coordinateSystem===C.Screen){var j=this._viewport.getRenderer().getSize(new THREE.Vector2());var p=this._gizmo.position.clone().applyMatrix4(this._matViewProj);var k=this._gizmo.position.clone().add(o).applyMatrix4(this._matViewProj);o.set(Math.round((k.x-p.x)*0.5*j.width),Math.round((k.y-p.y)*0.5*j.height),0);}var l=this._getNodesProperties();var r=o.clone();if(this._coordinateSystem===C.Custom){var u=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);var v=new THREE.Matrix4().getInverse(u);r.applyMatrix4(v);}if(this._tool.fireEvent("moving",{x:r.x,y:r.y,z:r.z,nodesProperties:l},true)){this._printEventInfo("Event 'moving'",r.x,r.y,r.z,l);this._move(o);if(this._coordinateSystem===C.Screen){o.set(new THREE.Vector3().setFromMatrixColumn(this._matOrigin,0).normalize().dot(o),new THREE.Vector3().setFromMatrixColumn(this._matOrigin,1).normalize().dot(o),0);}else if(this._coordinateSystem===C.Custom){var w=this._getAnchorPoint();if(w){var x=new THREE.Matrix4().getInverse(w.matrixWorld);var y=new THREE.Vector3().setFromMatrixScale(w.matrixWorld);var z=w.position.clone().applyMatrix4(x);o.copy(w.position.clone().add(o).applyMatrix4(x).sub(z).multiply(y));}}this._line.geometry.vertices[0].setScalar(0).sub(o);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();o.set(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z));o.multiplyScalar(1/Math.max(o.x,o.y,o.z));this._line.material.color.setRGB(o.x,o.y,o.z);this._line.visible=true;}};
f.prototype._move=function(o){this._value.addVectors(this._beginValue,o);this._moveDelta.copy(o);this._nodes.forEach(function(n){var k=n.node;if(!k.userData){k.userData={};}k.userData.skipUpdateJointNode=true;});if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){this._nodes.forEach(function(n){var k=n.node;var l=this._getEffectiveParent(k);var m=null;if(this._coordinateSystem===C.Parent&&l){m=this._extractBasis(l.matrixWorld);}else{m=this._extractBasis(k.matrixWorld);}var p=n.origin.clone();p.add(m[0].multiplyScalar(o.x)).add(m[1].multiplyScalar(o.y)).add(m[2].multiplyScalar(o.z));k.matrixWorld.setPosition(p);k.matrix.multiplyMatrices(n.matParentInv,k.matrixWorld);k.position.setFromMatrixPosition(k.matrix);k.matrixWorldNeedsUpdate=true;}.bind(this));}else{if(this._coordinateSystem===C.Screen){var s=this._viewport.getRenderer().getSize(new THREE.Vector2());var c=this._viewport.getCamera().getCameraRef();var a=new THREE.Vector4().copy(this._gizmo.position).applyMatrix4(this._matViewProj);var b=o.x*2*a.w/(c.projectionMatrix.elements[0]*s.width);var i=o.y*2*a.w/(c.projectionMatrix.elements[5]*s.height);o.setFromMatrixColumn(c.matrixWorld,0).multiplyScalar(b);o.add(new THREE.Vector3().setFromMatrixColumn(c.matrixWorld,1).multiplyScalar(i));}this._gizmo.position.setFromMatrixPosition(this._matOrigin).add(o);if(this._coordinateSystem===C.Custom){var j=this._getAnchorPoint();if(j){j.position.copy(this._gizmo.position);}}this._nodes.forEach(function(n){if(!n.ignore){var k=n.node;k.matrixWorld.setPosition(n.origin.clone().add(o));k.matrix.multiplyMatrices(n.matParentInv,k.matrixWorld);k.position.setFromMatrixPosition(k.matrix);k.matrixWorldNeedsUpdate=true;}});}this._viewport.setShouldRenderFrame();};
f.prototype.move=function(x,y,z){this.beginGesture();if(this._coordinateSystem===C.Custom){var o=new THREE.Vector3(x,y,z);var a=new THREE.Matrix4().extractRotation(this._gizmo.matrixWorld);o.applyMatrix4(a);x=o.x;y=o.y;z=o.z;}this._move(new THREE.Vector3(x,y,z||0));};
f.prototype.getValue=function(){return(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3)?this._value.getComponent(this._handleIndex):0;};
f.prototype.setValue=function(v){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){this.beginGesture();this._move(new THREE.Vector3().setComponent(this._handleIndex,v-this._value.getComponent(this._handleIndex)));this.endGesture();}};
f.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef(),this._viewport._getLayers());}};
f.prototype.handleSelectionChanged=function(a){if(this._viewport){if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(this._viewport._viewStateManager);}this._updateSelection(this._viewport._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:n},true);this._gizmoIndex=this._handleIndex=-1;}};
f.prototype._getSelectionCenter=function(a){G.prototype._getSelectionCenter.apply(this,arguments);var b=this;function i(c,m,w,l){var u=(w/2);var x=(l/2);c.project(m);c.x=(c.x*u)+u;c.y=-(c.y*x)+x;return c;}function j(c,m,w,l){var u=(w/2);var x=(l/2);c.x=(c.x-u)/u;c.y=-(c.y-x)/x;c.unproject(m);return c;}function k(m,w,l){var c=new THREE.Vector3(b._gizmoSize,b._gizmoSize,0);var u=new THREE.Vector3(w-b._gizmoSize,b._gizmoSize,0);var x=new THREE.Vector3(w-b._gizmoSize,l-b._gizmoSize,0);var y=new THREE.Vector3(b._gizmoSize,l-b._gizmoSize,0);var z=[j(c,m,w,l),j(u,m,w,l),j(x,m,w,l),j(y,m,w,l)];return z[0].add(z[1]).add(z[2]).add(z[3]).multiplyScalar(0.25);}if(this._placementMode===d.OnScreen){var v=this._viewport.getDomRef().getBoundingClientRect();var w=v.width;var l=v.height;var m=this._viewport.getCamera().getCameraRef();var p=i(a.clone(),m,w,l);var n=p.clone();var o=[n.x<this._gizmoSize&&n.setX(b._gizmoSize)||n.x>w-this._gizmoSize&&n.setX(w-b._gizmoSize),n.y<this._gizmoSize&&n.setY(b._gizmoSize)||n.y>l-this._gizmoSize&&n.setY(l-b._gizmoSize)].some(function(c){return c!==false;})&&a.copy(j(n,m,w,l));return p.z>1.0&&a.copy(k(m,w,l))||o||a;}else if(this._placementMode===d.ObjectCenter&&this._nodes.length===1){var r=new THREE.Vector3();if(this._nodes[0].node.userData.boundingBox){this._nodes[0].node.userData.boundingBox.getCenter(r);}else{var s=new THREE.Box3();s.expandByObject(this._nodes[0].node);s.getCenter(r);}a.copy(r.applyMatrix4(this._nodes[0].node.matrixWorld));}};
f.prototype._updateGizmoTransformation=function(i,c){var s=this._updateGizmoObjectTransformation(this._gizmo,i,true);this._updateAxisTitles(this._axisTitles,this._gizmo,c,this._gizmoSize+18,s);this._line.scale.setScalar(1/(this._gizmoSize*s));};
f.prototype._getEditingFormPosition=function(){var s=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex,true);var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.clone().multiplyScalar((this._gizmoSize+18)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
f.prototype.render=function(){if(this._nodes.length>0){var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,c);r.render(this._sceneGizmo,c);}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex);};
return f;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolGizmoRenderer',[],function(){"use strict";var M={};
M.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return M;},true);
sap.ui.predefine('sap/ui/vk/tools/PredefinedView',[],function(){"use strict";var P={Initial:"Initial",Front:"Front",Back:"Back",Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom"};return P;},true);
sap.ui.predefine('sap/ui/vk/tools/RectSelectTool',["./Tool","./RectSelectToolHandler","../SelectionDisplayMode","../Loco"],function(T,R,S,L){"use strict";
var a=T.extend("sap.ui.vk.tools.RectSelectTool",{
metadata:{properties:{subtractMode:{type:"boolean",defaultValue:false}}},
constructor:function(i,s){if(a._instance){return a._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new R(this);this._loco=null;a._instance=this;}
});
a.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
a.prototype.setActive=function(v,b,g){T.prototype.setActive.call(this,v,b,g);if(this._viewport){if(v){if(this._prepare()){this._handler.activate(this._viewport);}}else{this._handler.deactivate();}}return this;};
a.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return true;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&this._viewport._scene&&this._viewport._scene.getSceneRef()){return true;}else{return false;}};
a.prototype.queueCommand=function(b){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){b();}}return this;};
function c(b,d,v){var m=b.elements;var i=m[15]===1;var r=2/m[0];var t=2/m[5];var e,f;if(i){e=-m[12]*r;f=-m[13]*t;}else{e=m[8]*r;f=m[9]*t;}var g=(r+e)*0.5;var l=e-g;var h=(t+f)*0.5;var j=f-h;var k=THREE.Math.lerp(l,g,Math.min(d.x1,d.x2)/v.width);var n=THREE.Math.lerp(l,g,Math.max(d.x1,d.x2)/v.width);var o=THREE.Math.lerp(h,j,Math.min(d.y1,d.y2)/v.height);var p=THREE.Math.lerp(h,j,Math.max(d.y1,d.y2)/v.height);m[0]=2/(n-k);m[5]=2/(o-p);if(i){m[12]=-(n+k)/(n-k);m[13]=-(o+p)/(o-p);}else{m[8]=(n+k)/(n-k);m[9]=(o+p)/(o-p);}}
a.prototype.select=function(x,y,b,d,s,e){if(!this._prepare()){return[];}return this._select(x,y,b,d,this._viewport,s,e);};
a.prototype._select=function(x,y,b,d,v,s,e){var n=[];if(v.getMetadata().getName()==="sap.ui.vk.dvl.Viewport"){n=v.rectSelect(x,y,b,d);if(n.length>0){var p={picked:n};v.fireNodesPicked(p);if(v.getSelectionDisplayMode()===S.Outline){if(this.getSubtractMode()){v._viewStateManager.setOutliningStates([],n);}else{v._viewStateManager.setOutliningStates(n,[]);}}else if(this.getSubtractMode()){v._viewStateManager.setSelectionStates([],n);}else{v._viewStateManager.setSelectionStates(n,[]);}}return n;}var f=s?s.getSceneRef():undefined;var g=e?e.getCameraRef():undefined;var h=v._getViewStateManagerThreeJS();if(!g||!f||!h||x===b||y===d){return n;}var r={x1:x,y1:y,x2:b,y2:d};var j=v._getLayers();var m=g.projectionMatrix.clone();c(m,r,v._renderer.getSize(new THREE.Vector2()));var k=new THREE.Matrix4().multiplyMatrices(m,g.matrixWorldInverse);var o=new THREE.Frustum().setFromMatrix(k);var q=new THREE.Vector3();function t(z){var A=z.geometry;if(A!==undefined&&o.intersectsObject(z)){var i,l=0;if(A.isGeometry){var B=A.vertices;for(i=0,l=B.length;i<l;i++){q.copy(B[i]).applyMatrix4(z.matrixWorld);if(!o.containsPoint(q)){break;}}}else if(A.isBufferGeometry){var C=A.attributes.position;if(C!==undefined){for(i=0,l=C.count;i<l;i++){q.fromBufferAttribute(C,i).applyMatrix4(z.matrixWorld);if(!o.containsPoint(q)){break;}}}}return l>0&&i===l;}return false;}function u(l){if(!l.layers.test(j)){return;}var z=0,A=0;if(l.geometry!==undefined){z++;if(t(l)){A++;}}var B=l.children;if(B.length>0){for(var i=0;i<B.length;i++){var C=B[i];if(C.geometry!==undefined&&!C.name&&C.children.length===0){if(C.layers.test(j)){z++;if(t(C)){A++;}}}else{u(C);}}}if(A>0&&z===A){n.push(l);}}u(f);if(n.length>0){var w={picked:n};v.fireNodesPicked(w);if(v.getSelectionDisplayMode()===S.Outline){if(this.getSubtractMode()){h.setOutliningStates([],n);}else{h.setOutliningStates(n,[]);}}else if(this.getSubtractMode()){h.setSelectionStates([],n);}else{h.setSelectionStates(n,[]);}}return n;};
return a;});
sap.ui.predefine('sap/ui/vk/tools/RedlineTool',["sap/base/Log","../library","./Tool","./RedlineToolHandler","./RedlineToolGizmo","../Redline","../RedlineElementRectangle","../RedlineElementEllipse","../RedlineElementFreehand","../RedlineElementLine","../RedlineElementText"],function(L,v,T,R,a,b,c,d,e,f,g){"use strict";
var h=T.extend("sap.ui.vk.tools.RedlineTool",{
metadata:{events:{elementCreated:{parameters:{element:"object"}}},aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement",multiple:true,forwarding:{getter:"getGizmo",aggregation:"redlineElements",forwardBinding:true}}}},
constructor:function(i,s){if(h._instance){return h._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new R(this);h._instance=this;}
});
h.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.dvl.Viewport","sap.ui.vk.NativeViewport"]);this.setAggregation("gizmo",new a());};
h.prototype.setActive=function(i,j,k){T.prototype.setActive.call(this,i,j,k);var l=this._viewport;if(l){if(i){if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._activateRedline();}else if(l instanceof v.dvl.Viewport){l._activateRedline();}this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show();}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}if(l instanceof v.dvl.Viewport){l._deactivateRedline();}else if(l instanceof v.threejs.Viewport){l._viewportGestureHandler._deactivateRedline();}}}return this;};
var J={rectangle:c,ellipse:d,freehand:e,line:f,text:g};var S={rect:c,ellipse:d,path:e,line:f,text:g};
h.prototype.startAdding=function(i){this.getGizmo()._startAdding(i);return this;};
h.prototype.stopAdding=function(){this.getGizmo()._stopAdding();return this;};
h.prototype.exportJSON=function(){return this.getGizmo().getRedlineElements().map(function(i){return i.exportJSON();});};
h.prototype.importJSON=function(j){var i=this.getGizmo();j=Array.isArray(j)?j:[j];j.forEach(function(k){var E=J[k.type];if(E){i.addRedlineElement(new E().importJSON(k));}else{L.warning("Unsupported JSON element type "+k.type);}});i.rerender();return this;};
h.prototype.exportSVG=function(){var s=document.createElementNS(b.svgNamespace,"svg");this.getGizmo().getRedlineElements().map(function(i){s.appendChild(i.exportSVG());});return s;};
h.prototype.importSVG=function(s){var i=this.getGizmo();s.childNodes.forEach(function(t){if(t.getAttribute){var E=S[t.tagName];if(E){i.addRedlineElement(new E().importSVG(t));}else{L.warning("Unsupported SVG element type "+E);}}});i.rerender();return this;};
h.prototype.queueCommand=function(i){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){i();}}return this;};
return h;});
sap.ui.predefine('sap/ui/vk/tools/RedlineToolGizmo',["./Gizmo","./RedlineToolGizmoRenderer"],function(G,R){"use strict";
var a=G.extend("sap.ui.vk.tools.RedlineToolGizmo",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"},activeElement:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});
a.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._activeElement=null;this._virtualLeft=0;this._virtualTop=0;this._virtualSideLength=1;};
a.prototype.show=function(){this.getParent()._viewport.attachEvent("resize",null,this._onResize,this);this.addStyleClass("sapUiVizkitRedlineInteractionMode");};
a.prototype.hide=function(){this.getParent()._viewport.detachEvent("resize",this._onResize,this);this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");};
a.prototype._startAdding=function(e){this._activeElement=e;this.setAggregation("activeElement",this._activeElement);this.removeStyleClass("sapUiVizkitRedlineInteractionMode");this.addStyleClass("sapUiVizkitRedlineDesignMode");};
a.prototype._stopAdding=function(){this.setAggregation("activeElement",null);this._activeElement=null;this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.addStyleClass("sapUiVizkitRedlineInteractionMode");};
a.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this._virtualSideLength;}else{return{x:(x-this._virtualLeft)/this._virtualSideLength,y:(y-this._virtualTop)/this._virtualSideLength};}};
a.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this._virtualSideLength;}else{return{x:x*this._virtualSideLength+this._virtualLeft,y:y*this._virtualSideLength+this._virtualTop};}};
a.prototype._onResize=function(){if(this.getDomRef()){this.rerender();}};
a.prototype._getPanningRatio=function(){var c=this.getDomRef().getBoundingClientRect(),h=c.height,w=c.width;if(this._virtualLeft===0&&(h<w&&this._virtualTop<0||(h>w&&this._virtualTop>0))){return h/w;}return 1;};
a.prototype.onBeforeRendering=function(){var v=this.getParent()._viewport;if(v&&v.getDomRef()){var b=v.getOutputSize();this._virtualLeft=b.left;this._virtualTop=b.top;this._virtualSideLength=b.sideLength;}};
return a;});
sap.ui.predefine('sap/ui/vk/tools/RedlineToolGizmoRenderer',[],function(){"use strict";var R={};
R.render=function(r,c){r.write("<svg");r.writeControlData(c);r.addClass("sapUiVizkitRedlineTool");r.writeClasses();r.write(">");r.write("			<defs>				<filter id='halo' filterUnits='userSpaceOnUse' >					<feGaussianBlur in='SourceAlpha' stdDeviation='3' result='blur' />					<feMerge>						<feMergeNode in='blur' />						<feMergeNode in='SourceGraphic' />					</feMerge>				</filter>			</defs>		");c.getRedlineElements().forEach(function(e){e.render(r);});if(c._activeElement){c._activeElement.render(r);}r.write("</svg>");};
return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RedlineToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var R=E.extend("sap.ui.vk.tools.RedlineToolHandler",{
metadata:{},
constructor:function(t){this._priority=0;this._tool=t;this._rect=null;this._x=0;this._y=0;this._d=0;this._zoomFactor=1;}
});
R.prototype.destroy=function(){this._tool=null;this._rect=null;};
R.prototype.hover=function(e){};
R.prototype.beginGesture=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)){this._gesture=true;e.handled=true;if(g._activeElement){var b=g.getDomRef().getBoundingClientRect(),p=g._toVirtualSpace(e.x-b.left-window.pageXOffset,e.y-b.top-window.pageYOffset);g._activeElement.setOriginX(p.x);g._activeElement.setOriginY(p.y);g.rerender();}else{this._x=e.x;this._y=e.y;this._d=e.d;this._initd=e.d;}}};
var T="sap.ui.vk.threejs.Viewport";var N="sap.ui.vk.NativeViewport";
R.prototype._pan=function(e){var v=this.getViewport(),g=this._tool.getGizmo(),d=e.x-this._x,a=e.y-this._y;if(d||a){this._x=e.x;this._y=e.y;g.getRedlineElements().forEach(function(c){c.setOriginX(c.getOriginX()+g._toVirtualSpace(d));c.setOriginY(c.getOriginY()+g._toVirtualSpace(a));});g.rerender();var p=g._getPanningRatio();var b=v.getMetadata().getName()===T?v._viewportGestureHandler._cameraController:v;b.beginGesture(0,0);b.pan(d*p,a*p);b.endGesture();}};
R.prototype._zoom=function(e){var v=this.getViewport(),g=this._tool.getGizmo(),z=1;var d=e.d-this._d;this._d=e.d;if(this._initd>0){z=1+d*(1/this._initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=Math.max(1-d*0.005,0.333);}else{z=Math.min(1+d*0.005,3);}}z=Math.min(Math.max(z,0.88),1.12);var a=v.getMetadata().getName();var b=32;var c=1/8;if(a===N){b=v._getZoomInLimit();c=v._getZoomOutLimit();this._zoomFactor=v._getZoomFactor();}z=Math.min(Math.max(this._zoomFactor*z,c),b)/this._zoomFactor;this._zoomFactor*=z;var o=this._getOffset(g.getDomRef());var s=1-z,p=g._toVirtualSpace(e.x-o.x,e.y-o.y);g.getRedlineElements().forEach(function(h){h.applyZoom(z);var i=h.getOriginX(),j=h.getOriginY();i+=(p.x-i)*s;j+=(p.y-j)*s;h.setOriginX(i);h.setOriginY(j);});g.rerender();var f=a===T?v._viewportGestureHandler._cameraController:v;f.beginGesture(e.x-o.x,e.y-o.y);f.zoom(z);f.endGesture();};
R.prototype.move=function(e){var g=this._tool.getGizmo();if(g&&this._gesture){e.handled=true;if(g._activeElement){var b=g.getDomRef().getBoundingClientRect(),x=e.x-b.left-window.pageXOffset,y=e.y-b.top-window.pageYOffset;g._activeElement.edit(x,y);}else{if(e.n===1||e.n===2){this._pan(e);}if(e.n===2&&!e.buttons){this._zoom(e);}}}};
R.prototype.endGesture=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)){this._gesture=false;e.handled=true;if(g._activeElement){g.addRedlineElement(g._activeElement);this._tool.fireElementCreated({element:g._activeElement});this._tool.stopAdding();}}};
R.prototype.click=function(e){};
R.prototype.doubleClick=function(e){};
R.prototype.contextMenu=function(e){};
R.prototype.getViewport=function(){return this._tool._viewport;};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return R;});
sap.ui.predefine('sap/ui/vk/tools/RotatableAxis',[],function(){"use strict";var R={All:"All",X:"X",Y:"Y",Z:"Z"};return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RotateOrbitTool',["./Tool","../helpers/RotateOrbitHelperDvl","../helpers/RotateOrbitHelperThree"],function(T,R,a){"use strict";
var b=T.extend("sap.ui.vk.tools.RotateOrbitTool",{
metadata:{events:{rotate:{parameters:{dx:"int",dy:"int"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("1a1fced1-9b42-d7f3-5fdf-8d338b3591a6");this._viewport=null;this._rotateOrbitHelper=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){if(this._prepare()){this._rotateOrbitHelper.activateOrbitMode();}}else if(this._rotateOrbitHelper){this._rotateOrbitHelper.deactivateOrbitMode();this._rotateOrbitHelper=null;}}return this;};
b.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateOrbitHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateOrbitHelper=new R(this,this._dvl);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateOrbitHelper==null){this._rotateOrbitHelper=new a(this);}}else{return false;}return true;};
b.prototype.rotate=function(d,c){if(this._prepare()){this._rotateOrbitHelper.rotate(d,c);}};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._rotateOrbitHelper=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/RotateTool',["./Tool","../threejs/thirdparty/three","./RotatableAxis","./CoordinateSystem","./RotateToolHandler","./RotateToolGizmo","./GizmoPlacementMode","./Detector","./ToolNodeSet"],function(T,a,R,C,b,c,G,D,d){"use strict";
var e=T.extend("sap.ui.vk.tools.RotateTool",{
metadata:{properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:C.World},axis:{type:"sap.ui.vk.tools.RotatableAxis",defaultValue:R.All},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:d.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:G.Default}},events:{rotating:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},rotated:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},axisChanged:{parameters:{axis:"sap.ui.vk.tools.RotatableAxis"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new b(this);this._gizmo=null;this._detector=new D();}
});
e.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new c());};
e.prototype.setActive=function(v,f,g){T.prototype.setActive.call(this,v,f,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.setAxis(this.getAxis());this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
e.prototype.setPlacementMode=function(v){var f=this.getPlacementMode();if(f!==v){this.setProperty("placementMode",v,true);this.getGizmo().setPlacementMode(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.firePlacementModeChanged({placementMode:v});}return this;};
e.prototype.queueCommand=function(f){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){f();}}return this;};
e.prototype.setAxis=function(v){var f=this.getAxis();if(f!==v){this.setProperty("axis",v,true);this.getGizmo().setAxis(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireAxisChanged({axis:v});}return this;};
e.prototype.setCoordinateSystem=function(v){var f=this.getCoordinateSystem();if(f!==v){this.setProperty("coordinateSystem",v,true);this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireCoordinateSystemChanged({coordinateSystem:v});}return this;};
e.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.setEnableSnapping=function(v){this.setProperty("enableSnapping",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.getDetector=function(){return this._detector;};
e.prototype.setNodeSet=function(v){this.setProperty("nodeSet",v,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
e.prototype.rotate=function(x,y,z,f){var o;if(f&&f!==this.getCoordinateSystem()){o=this.getCoordinateSystem();this.setCoordinateSystem(f);}if(this._gizmo){this._gizmo.rotate(x,y,z);}if(o){this.setCoordinateSystem(o);}if(this._gizmo){this._gizmo.endGesture();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.prepareForCreatingRotationKey=function(f,t,p){if(this._gizmo){this._gizmo._prepareForCreatingRotationKey(f,t,p);var n=this._gizmo._getNodesProperties();this.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:n},true);}};
e.prototype.rotateRestPosition=function(x,y,z){if(this._gizmo){this._gizmo.rotateRestPosition(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
e.prototype.rotateFromRestPosition=function(x,y,z){if(this._gizmo){this._gizmo.rotateFromRestPosition(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
return e;});
sap.ui.predefine('sap/ui/vk/tools/RotateToolGizmo',["jquery.sap.global","../threejs/thirdparty/three","./Gizmo","./RotateToolGizmoRenderer","./RotatableAxis","./CoordinateSystem","./AxisColours","../AnimationTrackType","../AnimationTrackValueType","./GizmoPlacementMode"],function(q,t,G,R,b,C,A,c,d,e){"use strict";
var f=G.extend("sap.ui.vk.tools.RotateToolGizmo",{metadata:{library:"sap.ui.vk"}});
f.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(String.fromCharCode(176),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3();this._rotationDelta=new THREE.Vector3();this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._axis=b.All;this._coordinateSystem=C.World;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;function a(k,l,r,s){var m=new THREE.TorusBufferGeometry(r,1/96,4,s);if(k===0){m.rotateY(Math.PI/2);}else if(k===1){m.rotateX(Math.PI/2);}var n=new THREE.Mesh(m,new THREE.MeshBasicMaterial({color:l,transparent:true}));n.matrixAutoUpdate=false;n.userData.color=l;return n;}function h(k,r,s){var l=new THREE.TorusBufferGeometry(r,16/96,4,s);if(k===0){l.rotateY(Math.PI/2);}else if(k===1){l.rotateX(Math.PI/2);}return new THREE.Mesh(l,new THREE.MeshBasicMaterial({opacity:0.2,transparent:true}));}for(var i=0;i<3;i++){this._gizmo.add(a(i,A[["x","y","z"][i]],1,128));this._touchAreas.add(h(i,1,24));}this._gizmo.add(new THREE.AxesHelper(0.75));var j=new THREE.MeshBasicMaterial({color:0x0080FF,opacity:0.5,transparent:true,side:THREE.DoubleSide});this._arcMesh=new THREE.Mesh(new THREE.Geometry(),j);this._arcMesh.drawMode=THREE.TriangleFanDrawMode;this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);};
f.prototype.hasDomElement=function(){return true;};
f.prototype.setAxis=function(v){this._axis=v;var a=[b.All,b.X,b.Y,b.Z];if(this._coordinateSystem!==C.Screen){for(var i=0;i<3;i++){if(v!==b.All&&a[i+1]!==v){this._gizmo.children[i].visible=this._touchAreas.children[i].visible=false;}else{this._gizmo.children[i].visible=this._touchAreas.children[i].visible=true;}}}};
f.prototype.resetValues=function(){this._value.setScalar(0);};
f.prototype.setCoordinateSystem=function(a){this._coordinateSystem=a;var s=a===C.Screen;if(s){this._gizmo.children[0].visible=this._gizmo.children[1].visible=false;this._touchAreas.children[0].visible=this._touchAreas.children[1].visible=false;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=true;}else{this._gizmo.children[0].visible=this._touchAreas.children[0].visible=this._axis===b.All||this._axis===b.X;this._gizmo.children[1].visible=this._touchAreas.children[1].visible=this._axis===b.All||this._axis===b.Y;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=this._axis===b.All||this._axis===b.Z;}this._axisTitles.visible=!s;this._gizmoIndex=this._handleIndex=-1;};
f.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._nodes.length=0;this._updateSelection(v._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:n},true);};
f.prototype._prepareForCreatingRotationKey=function(a,h,p){this._nodes.forEach(function(n){var j=n.node;var k=[0,0,0];a.setTime(h,p);var l=a.getAnimatedProperty(j,c.Rotate);if(l.offsetToPrevious){k=l.offsetToPrevious;}if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map();}var u=this._nodeUserDataMap.get(j);if(!u){u={};this._nodeUserDataMap.set(j,u);}u.eulerInParentCoors=new THREE.Euler(k[0],k[1],k[2]);u.startEulerInParentCoors=new THREE.Euler(k[0],k[1],k[2]);}.bind(this));var i=a.getCurrentPlayback();if(i){this._prepareForCreatingKey(i.getSequence());}};
f.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false);};
f.prototype.getGizmoCount=function(){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
f.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
f.prototype.getGizmoObject=function(){return this._nodes.length>0?this._gizmo:null;};
f.prototype.highlightHandle=function(a,h){for(var i=0;i<3;i++){var j=this._gizmo.children[i];var k=i===a?0xFFFF00:j.userData.color;j.material.color.setHex(k);j.material.opacity=a===-1||i===a?1:0.35;j.material.visible=h||i===a;var l=this._axisTitles.children[i];l.material.color.setHex(k);l.material.opacity=a===-1||i===a?1:0.35;l.material.visible=h||i===a;}};
f.prototype.selectHandle=function(i,a){this._gizmoIndex=a;this._handleIndex=i;if(this._tool.getAutoResetValues()){this.resetValues();}this._viewport.setShouldRenderFrame();};
f.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._rotationDelta.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){n.node.parent.updateMatrixWorld(true);n.matOrigin=n.node.matrixWorld.clone();n.matLocalOrigin=n.node.matrix.clone();if(n.node.parent){n.matParentInv=new THREE.Matrix4().getInverse(n.node.parent.matrixWorld);}else{n.matParentInv=new THREE.Matrix4();}n.quaternion=n.node.quaternion.clone();});};
f.prototype._printEventInfo=function(a,x,y,z,n){q.sap.log.debug(a+" is fired:"+" x = "+x+"; y = "+y+"; z = "+z);n.forEach(function(p){q.sap.log.debug("Node: "+p.node.name);if(p.offsetToRest){q.sap.log.debug("offsetToRest: [ "+p.offsetToRest[0]+", "+p.offsetToRest[1]+", "+p.offsetToRest[2]+", "+p.offsetToRest[3]+" ] ");}else{q.sap.log.debug("offsetToRest: null");}if(p.offsetToRestInCoordinates){q.sap.log.debug("offsetToRestInCoordinates: [ "+p.offsetToRestInCoordinates[0]+", "+p.offsetToRestInCoordinates[1]+", "+p.offsetToRestInCoordinates[2]+" ] ");}else{q.sap.log.debug("offsetToRestInCoordinates: null");}if(p.offsetToPrevious){q.sap.log.debug("offsetToPrevious: [ "+p.offsetToPrevious[0]+", "+p.offsetToPrevious[1]+", "+p.offsetToPrevious[2]+" ] ");}else{q.sap.log.debug("offsetToPrevious: null");}if(p.absolute){q.sap.log.debug("absolute: [ "+p.absolute[0]+", "+p.absolute[1]+", "+p.absolute[2]+", "+p.absolute[3]+" ] ");}else{q.sap.log.debug("absolute: null");}if(p.world){q.sap.log.debug("world: [ "+p.world[0]+", "+p.world[1]+", "+p.world[2]+", "+p.world[3]+" ] ");}else{q.sap.log.debug("world: null");}if(p.restDifference){q.sap.log.debug("restDifference: [ "+p.restDifference[0]+", "+p.restDifference[1]+", "+p.restDifference[2]+", "+p.restDifference[3]+" ] ");}else{q.sap.log.debug("restDifference: null");}if(p.restDifferenceInCoordinates){q.sap.log.debug("restDifference: [ "+p.restDifferenceInCoordinates[0]+", "+p.restDifferenceInCoordinates[1]+", "+p.restDifferenceInCoordinates[2]+", "+p.restDifferenceInCoordinates[3]+" ] ");}else{q.sap.log.debug("restDifference: null");}});};
f.prototype._getNodesProperties=function(){var n=[];this._nodes.forEach(function(a){var h=a.node;var p={};p.node=h;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(h);}if(u&&u.eulerInParentCoors){var o=new THREE.Euler(u.eulerInParentCoors.x,u.eulerInParentCoors.y,u.eulerInParentCoors.z);var i=new THREE.Quaternion().setFromEuler(o);if(this._sequence){var s=this._viewport._viewStateManager._getEndPropertyInPreviousSequence(h,c.Rotate,this._sequence);if(s){var j=new THREE.Quaternion(s[0],s[1],s[2],s[3]);i.multiply(j);}}p.offsetToRest=[i.x,i.y,i.z,i.w];p.offsetToPrevious=[u.eulerInParentCoors.x,u.eulerInParentCoors.y,u.eulerInParentCoors.z];}else{p.offsetToRest=null;p.offsetToPrevious=null;}var k=this._viewport._viewStateManager.getTransformation(h);p.absolute=[k.quaternion[0],k.quaternion[1],k.quaternion[2],k.quaternion[3]];var w=this._viewport._viewStateManager.getTransformationWorld(h);var l=new THREE.Quaternion(w.quaternion[0],w.quaternion[1],w.quaternion[2],w.quaternion[3]);var m=new THREE.Euler().setFromQuaternion(l);p.world=[m.x,m.y,m.z];if(u&&u.quatInitialDiffInv){var r=new THREE.Quaternion(k.quaternion[0],k.quaternion[1],k.quaternion[2],k.quaternion[3]);r.multiply(u.quatInitialDiffInv);p.restDifference=[r.x,r.y,r.z,r.w];}else{p.restDifference=null;}if(u.euler){p.restDifferenceInCoordinates=[u.euler.x,u.euler.y,u.euler.z];}else{p.restDifferenceInCoordinates=null;}p.offsetToRestInCoordinates=null;n.push(p);}.bind(this));return n;};
f.prototype.endGesture=function(){this._arcMesh.visible=false;var n=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(function(a){var h=a.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(h);}if(u&&u.euler){u.startEuler.x=u.euler.x;u.startEuler.y=u.euler.y;u.startEuler.z=u.euler.z;u.startEulerInParentCoors.x=u.eulerInParentCoors.x;u.startEulerInParentCoors.y=u.eulerInParentCoors.y;u.startEulerInParentCoors.z=u.eulerInParentCoors.z;}delete h.userData.skipUpdateJointNode;this._viewport._viewStateManager._setJointNodeOffsets(h,c.Rotate);}.bind(this));this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z,nodesProperties:n});this._printEventInfo("Event 'rotated'",this._rotationDelta.x,this._rotationDelta.y,this._rotationDelta.z,n);};
var g=function(o,a){if(Math.abs(o-a)<0.000001){return o;}if(o>a){while(o>a){a+=2*Math.PI;}if(a-o<=Math.PI){return a;}else{return a-2*Math.PI;}}else{while(o<a){a-=2*Math.PI;}if(o-a<=Math.PI){return a;}else{return a+2*Math.PI;}}};
f.prototype.rotateFromRestPosition=function(x,y,z){if(this._coordinateSystem!==C.Parent){return;}this.beginGesture();this._nodes.forEach(function(h){var i=h.node;if(!i.userData){i.userData={};}i.userData.skipUpdateJointNode=true;});x=THREE.Math.degToRad(x);y=THREE.Math.degToRad(y);z=THREE.Math.degToRad(z);for(var n=0,a=this._nodes.length;n<a;n++){var h=this._nodes[n];if(!h.ignore){var i=h.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(i);}if(u&&u.euler&&u.eulerInParentCoors){this._rotationDelta.set(THREE.Math.radToDeg(x-u.eulerInParentCoors.x),THREE.Math.radToDeg(y-u.eulerInParentCoors.y),THREE.Math.radToDeg(z-u.eulerInParentCoors.z));u.eulerInParentCoors.x=x;u.eulerInParentCoors.y=y;u.eulerInParentCoors.z=z;var o=new THREE.Euler(u.eulerInParentCoors.x,u.eulerInParentCoors.y,u.eulerInParentCoors.z);var j=new THREE.Quaternion().setFromEuler(o);var r=this._viewport._viewStateManager.getRestTransformationUsingJoint(i);var k=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);if(this._sequence){var s=this._viewport._viewStateManager._getEndPropertyInPreviousSequence(i,c.Rotate,this._sequence);if(s){var l=new THREE.Quaternion(s[0],s[1],s[2],s[3]);j.multiply(l);}}var p=this._getEffectiveParent(i);if(p!==i.parent){this._viewport._viewStateManager._setJointNodeOffsets(i,c.Rotate);i.userData.offsetQuaternion=[j.x,j.y,j.z,j.w];i.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();i.userData.skipUpdateJointNode=true;}else{i.quaternion.copy(j.multiply(k));}i.updateMatrix();u.euler.x=u.eulerInParentCoors.x-u.startEulerInParentCoors.x+u.startEuler.x;u.euler.y=u.eulerInParentCoors.y-u.startEulerInParentCoors.y+u.startEuler.y;u.euler.z=u.eulerInParentCoors.z-u.startEulerInParentCoors.z+u.startEuler.z;}}}this.endGesture();};
f.prototype.rotateRestPosition=function(x,y,z){this.beginGesture();this._nodes.forEach(function(h){var i=h.node;if(!i.userData){i.userData={};}i.userData.skipUpdateJointNode=true;});x=THREE.Math.degToRad(x);y=THREE.Math.degToRad(y);z=THREE.Math.degToRad(z);for(var n=0,a=this._nodes.length;n<a;n++){var h=this._nodes[n];if(!h.ignore){var i=h.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(i);}if(u&&u.euler&&u.eulerInParentCoors){this._rotationDelta.set(THREE.Math.radToDeg(x-u.euler.x),THREE.Math.radToDeg(y-u.euler.y),THREE.Math.radToDeg(z-u.euler.z));u.euler.x=x;u.euler.y=y;u.euler.z=z;var o=new THREE.Euler(u.euler.x,u.euler.y,u.euler.z);var j=new THREE.Quaternion().setFromEuler(o);var k=new THREE.Matrix4();var l=new THREE.Matrix4();if(this._coordinateSystem===C.Local){k=i.parent.matrixWorld.clone().multiply(u.matRest);l=u.matRestInv.clone().multiply(h.matParentInv);}else if(this._gizmo&&this._coordinateSystem!==C.Parent){k=this._gizmo.matrixWorld.clone();l=l.getInverse(k);}var m=new THREE.Matrix4().makeRotationFromQuaternion(j);var p=m;if(this._coordinateSystem!==C.Parent){p=h.matParentInv.clone().multiply(k).multiply(m).multiply(l).multiply(i.parent.matrixWorld);}var r=new THREE.Matrix4().makeRotationFromQuaternion(u.quatInitialDiff).multiply(p);var s=new THREE.Euler().setFromRotationMatrix(r);if(Math.abs(s.x)<0.000001){s.x=0;}if(Math.abs(s.y)<0.000001){s.y=0;}if(Math.abs(s.z)<0.000001){s.z=0;}u.eulerInParentCoors.x=g(u.eulerInParentCoors.x,s.x);u.eulerInParentCoors.y=g(u.eulerInParentCoors.y,s.y);u.eulerInParentCoors.z=g(u.eulerInParentCoors.z,s.z);i.matrix=u.matInitialDiff.clone().multiply(p.multiply(u.matRest));i.matrix.decompose(i.position,i.quaternion,i.scale);i.updateMatrix();}}}this.endGesture();};
f.prototype._updateEulerForCreatingAnimationKey=function(a){for(var n=0,h=this._nodes.length;n<h;n++){var i=this._nodes[n];if(!i.ignore){var j=i.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(j);}if(u&&u.euler){u.euler.x=u.startEuler.x+a[0];u.euler.y=u.startEuler.y+a[1];u.euler.z=u.startEuler.z+a[2];var k=false;if((Math.abs(u.euler.x)<0.000001&&(Math.abs(u.euler.y)<0.000001||Math.abs(u.euler.z)<0.000001))||(Math.abs(u.euler.y)<0.000001&&Math.abs(u.euler.z)<0.000001)){k=true;}if(k&&this._coordinateSystem===C.Parent){u.eulerInParentCoors.x=u.startEulerInParentCoors.x+a[0];u.eulerInParentCoors.y=u.startEulerInParentCoors.y+a[1];u.eulerInParentCoors.z=u.startEulerInParentCoors.z+a[2];continue;}var r=this._viewport._viewStateManager.getRelativeTransformation(j);var o;var p=this._getEffectiveParent(j);if(p!==j.parent){this._viewport._viewStateManager._setJointNodeOffsets(j,c.Rotate);o=new THREE.Quaternion(j.userData.offsetQuaternion[0],j.userData.offsetQuaternion[1],j.userData.offsetQuaternion[2],j.userData.offsetQuaternion[3]);j.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();j.userData.skipUpdateJointNode=true;}else{o=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);}var l=new THREE.Matrix4().makeRotationFromQuaternion(o);if(this._sequence){var s=this._viewport._viewStateManager._getEndPropertyInPreviousSequence(j,c.Rotate,this._sequence);if(s){var m=new THREE.Quaternion(s[0],s[1],s[2],s[3]);var v=new THREE.Matrix4().makeRotationFromQuaternion(m);l.multiply(new THREE.Matrix4().getInverse(v));}}var w=new THREE.Euler().setFromRotationMatrix(l);if(Math.abs(w.x)<0.00001){w.x=0;}if(Math.abs(w.y)<0.00001){w.y=0;}if(Math.abs(w.z)<0.00001){w.z=0;}u.eulerInParentCoors.x=g(u.eulerInParentCoors.x,w.x);u.eulerInParentCoors.y=g(u.eulerInParentCoors.y,w.y);u.eulerInParentCoors.z=g(u.eulerInParentCoors.z,w.z);if(k){continue;}var x=new THREE.Matrix4();var y=new THREE.Matrix4();if(this._coordinateSystem===C.Local){x=j.parent.matrixWorld.clone().multiply(u.matRest);y=u.matRestInv.clone().multiply(i.matParentInv);}else if(this._gizmo&&this._coordinateSystem!==C.Parent){x=this._gizmo.matrixWorld.clone();y=y.getInverse(x);}var z=new THREE.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);z.multiply(u.quatInitialDiffInv);var B=new THREE.Matrix4().makeRotationFromQuaternion(z);var D=B;if(this._coordinateSystem!==C.Parent){D=y.clone().multiply(j.parent.matrixWorld).multiply(B).multiply(i.matParentInv).multiply(x);}w=new THREE.Euler().setFromRotationMatrix(D);if(Math.abs(w.x)<0.000001){w.x=0;}if(Math.abs(w.y)<0.000001){w.y=0;}if(Math.abs(w.z)<0.000001){w.z=0;}u.euler.x=g(u.euler.x,w.x);u.euler.y=g(u.euler.y,w.y);u.euler.z=g(u.euler.z,w.z);}}}};
f.prototype._rotate=function(a){this._rotationDelta.set(THREE.Math.radToDeg(a.x),THREE.Math.radToDeg(a.y),THREE.Math.radToDeg(a.z));this._value.addVectors(this._beginValue,this._rotationDelta);this._nodes.forEach(function(r){var s=r.node;if(!s.userData){s.userData={};}s.userData.skipUpdateJointNode=true;});var h=new THREE.Quaternion();if(this._coordinateSystem===C.Local){h.setFromEuler(a);this._nodes.forEach(function(r){var s=r.node;s.quaternion.copy(r.quaternion).multiply(h);s.updateMatrix();});a=a.toArray();this._updateEulerForCreatingAnimationKey(a);}else{a=a.toArray();for(var i=0;i<3;i++){var j=a[i];if(j){var k=a[3].charCodeAt(i)-88;if(k>=0&&k<3){var l=new THREE.Vector3().setFromMatrixColumn(this._matOrigin,k).normalize();var m=new THREE.Matrix4().makeRotationAxis(l,j);var p=new THREE.Vector3().setFromMatrixPosition(this._matOrigin);m.setPosition(p.sub(p.clone().applyMatrix4(m)));for(var n=0,o=this._nodes.length;n<o;n++){var r=this._nodes[n];if(!r.ignore){var s=r.node;if(this._coordinateSystem!==C.Parent){s.position.setFromMatrixPosition(r.matOrigin).applyMatrix4(m).applyMatrix4(r.matParentInv);}var u=new THREE.Vector3().setFromMatrixScale(r.matOrigin);var v=l.clone().transformDirection(new THREE.Matrix4().getInverse(r.matOrigin)).multiply(u).normalize();h.setFromAxisAngle(v,j);s.quaternion.copy(r.quaternion).multiply(h);s.updateMatrix();}}}}}this._updateEulerForCreatingAnimationKey(a);}this._viewport.setShouldRenderFrame();};
f.prototype._setRotationAxisAngle=function(h,j,k){var l=(k-j)%(Math.PI*2);var m=new THREE.Euler();m[["x","y","z"][h]]=l;var o=this._getNodesProperties();if(this._tool.fireEvent("rotating",{x:THREE.Math.radToDeg(m.x),y:THREE.Math.radToDeg(m.y),z:THREE.Math.radToDeg(m.z),nodesProperties:o},true)){this._printEventInfo("Event 'rotating'",THREE.Math.radToDeg(m.x),THREE.Math.radToDeg(m.y),THREE.Math.radToDeg(m.z),o);this._rotate(m);var v=[0,0,0];var p=new THREE.Vector3();var r=(h+1)%3,s=(h+2)%3;var n=Math.max(Math.ceil(Math.abs(l)*64/Math.PI),1);l*=this._coordinateSystem===C.Local?-1:1;for(var i=0;i<=n;i++){var a=j+l*(i/n);p.set(0,0,0).setComponent(r,Math.cos(a)).setComponent(s,Math.sin(a));v.push(p.x,p.y,p.z);}this._arcMesh.geometry=new THREE.BufferGeometry().setAttribute("position",new THREE.Float32BufferAttribute(v,3));this._arcMesh.visible=true;}};
f.prototype.rotate=function(x,y,z){this.beginGesture();this._rotate(new THREE.Euler(THREE.Math.degToRad(x||0),THREE.Math.degToRad(y||0),THREE.Math.degToRad(z||0)));};
f.prototype._getValueLocaleOptions=function(){return{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2};};
f.prototype.getValue=function(){return(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3)?this._value.getComponent(this._handleIndex):0;};
f.prototype.setValue=function(v){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var a=new THREE.Euler();a[["x","y","z"][this._handleIndex]]=THREE.Math.degToRad(v-this._value.getComponent(this._handleIndex));this.beginGesture();this._rotate(a);this.endGesture();}};
f.prototype.expandBoundingBox=function(a){if(this._viewport){this._expandBoundingBox(a,this._viewport.getCamera().getCameraRef(),this._viewport._getLayers());}};
f.prototype.handleSelectionChanged=function(a){if(this._viewport){if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(this._viewport._viewStateManager);}this._updateSelection(this._viewport._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:n},true);this._gizmoIndex=this._handleIndex=-1;}};
f.prototype._getLevelingQuaternion=function(a,o){a.set(0,0,0,1);switch(this._coordinateSystem){case C.Local:a.setFromRotationMatrix(this._nodes[o].node.parent.matrixWorld);break;case C.Screen:a.copy(this._viewport.getCamera().getCameraRef().quaternion);break;case C.Custom:var h=this._getAnchorPoint();if(h){a.copy(h.quaternion);}break;default:break;}return false;};
f.prototype._getObjectSize=function(o){var a=new THREE.Box3();if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(a,this._viewport._getLayers(),false);}else if(this._coordinateSystem===C.Local){this._nodes[0].node._expandBoundingBox(a,this._viewport._getLayers(),false);}if(a.isEmpty()){return 0;}var s=new THREE.Vector3();a.getSize(s);return s.length();};
f.prototype._updateGizmoTransformation=function(i,a){var s=this._updateGizmoObjectTransformation(this._gizmo,i);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize-12,s);};
f.prototype._getEditingFormPosition=function(){var s=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.clone().multiplyScalar((this._gizmoSize-12)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
f.prototype.render=function(){if(this._nodes.length>0){var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,a);r.render(this._sceneGizmo,a);}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex);};
return f;});
sap.ui.predefine('sap/ui/vk/tools/RotateToolGizmoRenderer',[],function(){"use strict";var R={};
R.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RotateTurntableTool',["./Tool","../helpers/RotateTurntableHelperDvl","../helpers/RotateTurntableHelperThree"],function(T,R,a){"use strict";
var b=T.extend("sap.ui.vk.tools.RotateTurntableTool",{
metadata:{events:{rotate:{parameters:{dx:"int",dy:"int"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("f271c082-676c-adc6-167f-0d5ce602aa45");this._viewport=null;this._rotateTurntableHelper=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){T.prototype.setActive.call(this,v,c,g);if(this._viewport){if(v){if(this._prepare()){this._rotateTurntableHelper.activateTurntableMode();}}else if(this._rotateTurntableHelper){this._rotateTurntableHelper.deactivateTurntableMode();this._rotateTurntableHelper=null;}}return this;};
b.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateTurntableHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateTurntableHelper=new R(this,this._dvl);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateTurntableHelper==null){this._rotateTurntableHelper=new a(this);}}else{return false;}return true;};
b.prototype.rotate=function(d,c){if(this._prepare()){this._rotateTurntableHelper.rotate(d,c);}};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._rotateTurntableHelper=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/ScaleTool',["./Tool","./CoordinateSystem","./ScaleToolHandler","./ScaleToolGizmo","./Detector","./ToolNodeSet","./GizmoPlacementMode"],function(T,C,S,a,D,b,G){"use strict";
var c=T.extend("sap.ui.vk.tools.ScaleTool",{
metadata:{properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:C.World},nonUniformScaleEnabled:{type:"boolean",defaultValue:false},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:b.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:G.Default}},events:{scaling:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},scaled:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new S(this);this._gizmo=null;this._detector=new D();}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setNonUniformScaleEnabled(this.getNonUniformScaleEnabled());this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.setPlacementMode=function(v){var d=this.getPlacementMode();if(d!==v){this.setProperty("placementMode",v,true);this.getGizmo().setPlacementMode(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.firePlacementModeChanged({placementMode:v});}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
c.prototype.setCoordinateSystem=function(v){var d=this.getCoordinateSystem();if(d!==v){this.setProperty("coordinateSystem",v,true);this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}this.fireCoordinateSystemChanged({coordinateSystem:v});}return this;};
c.prototype.setNonUniformScaleEnabled=function(v){this.setProperty("nonUniformScaleEnabled",v,true);this.getGizmo().setNonUniformScaleEnabled(v);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.setEnableSnapping=function(v){this.setProperty("enableSnapping",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.getDetector=function(){return this._detector;};
c.prototype.setNodeSet=function(v){this.setProperty("nodeSet",v,true);if(this._gizmo){this._gizmo.handleSelectionChanged();}};
c.prototype.scale=function(x,y,z,d){var o;if(d&&d!==this.getCoordinateSystem()){o=this.getCoordinateSystem();this.setCoordinateSystem(d);}if(this._gizmo){this._gizmo.scale(x,y,z);}if(o){this.setCoordinateSystem(o);}if(this._gizmo){this._gizmo.endGesture();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
c.prototype.prepareForCreatingScaleKey=function(s){if(this._gizmo){this._gizmo._prepareForCreatingKey(s);var n=this._gizmo._getNodesProperties();this.fireEvent("scaling",{x:1,y:1,z:1,nodesProperties:n},true);}};
return c;});
sap.ui.predefine('sap/ui/vk/tools/ScaleToolGizmo',["jquery.sap.global","../threejs/thirdparty/three","./Gizmo","./ScaleToolGizmoRenderer","./CoordinateSystem","./AxisColours","../AnimationTrackType"],function(q,t,G,S,C,A,c){"use strict";
var d=G.extend("sap.ui.vk.tools.ScaleToolGizmo",{metadata:{library:"sap.ui.vk"}});
d.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._createEditingForm(null,64);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3().setScalar(1);this._scaleDelta=new THREE.Vector3().setScalar(1);this._viewport=null;this._tool=null;this._nonUniformScaleEnabled=false;this._sceneGizmo=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._sceneGizmo.add(l);this._sceneGizmo.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._coordinateSystem=C.World;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=96;var f=96,g=16/f,h=48/f;function i(a,b,n){var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));var o=new THREE.BoxBufferGeometry(g,g,g);o.applyMatrix(m);var p=new THREE.MeshLambertMaterial({color:b,transparent:true});var r=new THREE.Mesh(o,p);r.userData.color=b;if(a){r.position.copy(a);var s=1/f;var u=new THREE.CylinderBufferGeometry(s,s,1,4);m.setPosition(a.clone().multiplyScalar(-0.5));u.applyMatrix(m);var v=new THREE.Mesh(u,p);v.renderOrder=1;r.add(v);m.setPosition(a);}var w=new THREE.BoxBufferGeometry(h,h,h);w.applyMatrix(m);n.add(new THREE.Mesh(w,p));return r;}function j(a,b,m){var n=new THREE.BufferGeometry();var v=new Float32Array(6);v[a]=v[b+3]=0.7;n.setAttribute("position",new THREE.Float32BufferAttribute(v,3));var o=new Float32Array(6);o[a]=o[b+3]=1;n.setAttribute("color",new THREE.Float32BufferAttribute(o,3));var p=new THREE.Line(n,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));p.userData.colors=o;var r=new THREE.Geometry();var s=new THREE.Vector3().setComponent(a,0.7);var u=new THREE.Vector3().setComponent(b,0.7);r.vertices.push(new THREE.Vector3(),s,u);r.faces.push(new THREE.Face3(0,1,2));var w=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,side:THREE.DoubleSide,visible:false}));w.renderOrder=1;p.add(w);m.add(w.clone());return p;}this._gizmo.add(i(new THREE.Vector3(1,0,0),A.x,this._touchAreas));this._gizmo.add(i(new THREE.Vector3(0,1,0),A.y,this._touchAreas));this._gizmo.add(i(new THREE.Vector3(0,0,1),A.z,this._touchAreas));this._gizmo.add(j(1,2,this._touchAreas));this._gizmo.add(j(2,0,this._touchAreas));this._gizmo.add(j(0,1,this._touchAreas));g-=0.1/f;var k=new THREE.MeshLambertMaterial({color:0xC0C0C0,transparent:true});this._gizmo.add(new THREE.Mesh(new THREE.BoxBufferGeometry(g,g,g),k));this._touchAreas.add(new THREE.Mesh(new THREE.BoxBufferGeometry(h,h,h),new THREE.MeshBasicMaterial()));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);this._updateGizmoPartVisibility();};
d.prototype.hasDomElement=function(){return true;};
d.prototype._updateGizmoPartVisibility=function(){var s=this._coordinateSystem===C.Screen;var g=this._gizmo.children,a=this._touchAreas.children;g[2].visible=a[2].visible=!s;g[3].visible=g[4].visible=a[3].visible=a[4].visible=!s&&this._nonUniformScaleEnabled;g[5].visible=a[5].visible=this._nonUniformScaleEnabled;this._axisTitles.children[2].visible=!s;};
d.prototype.resetValues=function(){this._value.setScalar(1);};
d.prototype.setCoordinateSystem=function(a){this._coordinateSystem=a;this._gizmoIndex=this._handleIndex=-1;this._updateGizmoPartVisibility();};
d.prototype.setNonUniformScaleEnabled=function(v){this._nonUniformScaleEnabled=!!v;this._updateGizmoPartVisibility();};
d.prototype.show=function(v,a){this._viewport=v;this._tool=a;this._nodes.length=0;this._sequence=null;this._updateSelection(v._viewStateManager);var n=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:n},true);};
d.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._sequence=null;this._updateEditingForm(false);};
d.prototype.getGizmoCount=function(){if(this._coordinateSystem===C.Local||this._coordinateSystem===C.Parent){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
d.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
var e=[1,2,4,6,5,3];
d.prototype.highlightHandle=function(a,h){var b=(a===6)||(a>=0&&!this._nonUniformScaleEnabled);var i,o;for(i=0;i<3;i++){o=this._gizmo.children[i];var f=b||(e[a]&(1<<i));var g=f?0xFFFF00:o.userData.color;o.material.color.setHex(g);o.children[0].material.color.setHex(g);o.children[0].material.opacity=o.material.opacity=f||h?1:0.35;var j=this._axisTitles.children[i];j.material.color.setHex(g);j.material.opacity=f||h?1:0.35;}for(i=3;i<6;i++){o=this._gizmo.children[i];var k=o.geometry.attributes.color;k.copyArray(b||i===a?[1,1,0,1,1,0]:o.userData.colors);k.needsUpdate=true;o.material.opacity=h||i===a?1:0.35;o.children[0].material.visible=i===a;}o=this._gizmo.children[6];o.material.color.setHex(b?0xFFFF00:0xC0C0C0);o.material.opacity=b||h?1:0.35;};
d.prototype.selectHandle=function(i,g){this._gizmoIndex=g;this._handleIndex=i;if(this._tool.getAutoResetValues()){this.resetValues();}this._viewport.setShouldRenderFrame();};
d.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._scaleDelta.setScalar(1);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){n.scaleOrigin=n.node.scale.clone();n.matOrigin=n.node.matrixWorld.clone();if(n.node.parent){n.matParentInv=new THREE.Matrix4().getInverse(n.node.parent.matrixWorld);}else{n.matParentInv=new THREE.Matrix4();}});};
d.prototype._prepareForCreatingScaleKey=function(s){this._sequence=s;};
d.prototype._printEventInfo=function(a,x,y,z,n){q.sap.log.debug(a+" is fired:"+" x = "+x+"; y = "+y+"; z = "+z);n.forEach(function(p){q.sap.log.debug("Node: "+p.node.name);if(p.offsetToRest){q.sap.log.debug("offsetToRest: [ "+p.offsetToRest[0]+", "+p.offsetToRest[1]+", "+p.offsetToRest[2]+" ] ");}else{q.sap.log.debug("offsetToRest: null");}if(p.offsetToPrevious){q.sap.log.debug("offsetToPrevious: [ "+p.offsetToPrevious[0]+", "+p.offsetToPrevious[1]+", "+p.offsetToPrevious[2]+" ] ");}else{q.sap.log.debug("offsetToPrevious: null");}if(p.absolute){q.sap.log.debug("absolute: [ "+p.absolute[0]+", "+p.absolute[1]+", "+p.absolute[2]+" ] ");}else{q.sap.log.debug("absolute: null");}if(p.world){q.sap.log.debug("world: [ "+p.world[0]+", "+p.world[1]+", "+p.world[2]+" ] ");}else{q.sap.log.debug("world: null");}if(p.restDifference){q.sap.log.debug("restDifference: [ "+p.restDifference[0]+", "+p.restDifference[1]+", "+p.restDifference[2]+" ] ");}else{q.sap.log.debug("restDifference: null");}if(p.restDifferenceInCoordinates){q.sap.log.debug("restDifferenceInCoordinates: [ "+p.restDifferenceInCoordinates[0]+", "+p.restDifferenceInCoordinates[1]+", "+p.restDifferenceInCoordinates[2]+" ] ");}else{q.sap.log.debug("restDifferenceInCoordinates: null");}});};
d.prototype._getNodesProperties=function(){var n=[];this._nodes.forEach(function(a){var b=a.node;var p={};p.node=b;var r=this._viewport._viewStateManager.getRelativeTransformation(b);p.offsetToRest=[r.scale[0],r.scale[1],r.scale[2]];p.offsetToPrevious=p.offsetToRest.slice();var f=this._getEffectiveParent(b);if(f!==b.parent){if(b.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(b,c.Scale);}if(b.userData&&b.userData.offsetScale){p.offsetToRest=b.userData.offsetScale.slice();}else{p.offsetToRest=[1,1,1];}p.offsetToPrevious=p.offsetToRest.slice();if(b.userData.skipUpdateJointNode){b.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();b.userData.skipUpdateJointNode=true;}}if(this._sequence){var s=this._viewport._viewStateManager._getEndPropertyInPreviousSequence(b,c.Scale,this._sequence);if(s){p.offsetToPrevious[0]/=s[0];p.offsetToPrevious[1]/=s[1];p.offsetToPrevious[2]/=s[2];}}var g=this._viewport._viewStateManager.getTransformation(b);p.absolute=[g.scale[0],g.scale[1],g.scale[2]];var w=this._viewport._viewStateManager.getTransformationWorld(b);p.world=w.scale;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(b);}if(!a.matParentInv){a.matParentInv=new THREE.Matrix4().getInverse(b.parent.matrixWorld);}var h=new THREE.Matrix4();if(this._gizmo){h=this._gizmo.matrixWorld.clone();}var j=new THREE.Vector3();var k,m,l;if(u&&u.initialScale){p.restDifference=[g.scale[0]/u.initialScale[0],g.scale[1]/u.initialScale[1],g.scale[2]/u.initialScale[2]];l=new THREE.Vector3(p.restDifference[0],p.restDifference[1],p.restDifference[2]);var o=new THREE.Quaternion(g.quaternion[0],g.quaternion[1],g.quaternion[2],g.quaternion[3]);var v=new THREE.Matrix4().makeRotationFromQuaternion(o);var x=new THREE.Matrix4().makeRotationFromQuaternion(u.initialQuaternion);var y=new THREE.Vector3();var z=new THREE.Vector3();var B=new THREE.Vector3();v.extractBasis(y,z,B);var D=new THREE.Vector3();var E=new THREE.Vector3();var F=new THREE.Vector3();x.extractBasis(D,E,F);if(y.dot(D)<0){p.restDifference[0]=-p.restDifference[0];}if(z.dot(E)<0){p.restDifference[1]=-p.restDifference[1];}if(B.dot(F)<0){p.restDifference[2]=-p.restDifference[2];}k=b.parent.matrixWorld.clone().scale(l).multiply(a.matParentInv);k.decompose(new THREE.Vector3(),new THREE.Quaternion(),j);if(this._coordinateSystem===C.World){p.restDifferenceInCoordinates=[j.x,j.y,j.z];}else{m=new THREE.Matrix4().getInverse(h).multiply(k).multiply(h);m.decompose(new THREE.Vector3(),new THREE.Quaternion(),j);p.restDifferenceInCoordinates=[j.x,j.y,j.z];}var H=this._alignAxesBetweenGizmoAndNodeCoordinates(b);for(var i=0;i<3;i++){if(p.restDifference[i]>0){p.restDifferenceInCoordinates[H[i]]=Math.abs(p.restDifferenceInCoordinates[H[i]]);}else{p.restDifferenceInCoordinates[H[i]]=-Math.abs(p.restDifferenceInCoordinates[H[i]]);}}}n.push(p);}.bind(this));return n;};
d.prototype.endGesture=function(){var n=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(function(a){var b=a.node;if(b.userData){delete b.userData.skipUpdateJointNode;}this._viewport._viewStateManager._setJointNodeOffsets(b,c.Scale);}.bind(this));this._tool.fireScaled({x:this._scaleDelta.x,y:this._scaleDelta.y,z:this._scaleDelta.z,nodesProperties:n});this._printEventInfo("Event 'scaled'",this._scaleDelta.x,this._scaleDelta.y,this._scaleDelta.z,n);};
d.prototype._alignAxesBetweenGizmoAndNodeCoordinates=function(n,w){function g(v,p,r,s){var u=Math.abs(v.dot(p));var x=Math.abs(v.dot(r));var y=Math.abs(v.dot(s));if(u>=x&&u>=y){return 0;}else if(x>=u&&x>=y){return 1;}else{return 2;}}var a=n.parent.matrixWorld.clone().multiply(new THREE.Matrix4().makeRotationFromQuaternion(n.quaternion.clone()));var b=new THREE.Vector3();var f=new THREE.Vector3();var h=new THREE.Vector3();a.extractBasis(b,f,h);b.normalize();f.normalize();h.normalize();var i=new THREE.Matrix4();if(this._gizmo){i=this._gizmo.matrixWorld.clone();}var j=new THREE.Vector3();var k=new THREE.Vector3();var l=new THREE.Vector3();i.extractBasis(j,k,l);j.normalize();k.normalize();l.normalize();var m=[];var o;if(w){o=g(j,b,f,h);m.push(o);o=g(k,b,f,h);m.push(o);o=g(l,b,f,h);m.push(o);}else{o=g(b,j,k,l);m.push(o);o=g(f,j,k,l);m.push(o);o=g(h,j,k,l);m.push(o);}return m;};
d.prototype._scale=function(s){function a(b,i,f,g){if(i===0){if((g&&f.x>0)||(!g&&f.x<0)){b.x=Math.abs(b.x);}else{b.x=-Math.abs(b.x);}}else if(i===1){if((g&&f.y>0)||(!g&&f.y<0)){b.y=Math.abs(b.y);}else{b.y=-Math.abs(b.y);}}else if(i===2){if((g&&f.z>0)||(!g&&f.z<0)){b.z=Math.abs(b.z);}else{b.z=-Math.abs(b.z);}}}if(!this._beginValue){this._beginValue=this._value.clone();}this._value.multiplyVectors(this._beginValue,s);this._scaleDelta.copy(s);this._nodes.forEach(function(n){var b=n.node;if(!b.userData){b.userData={};}b.userData.skipUpdateJointNode=true;});if(this._coordinateSystem===C.Local){this._nodes.forEach(function(n){n.node.scale.copy(n.scaleOrigin).multiply(s);n.node.updateMatrix();});}else{var m=this._matOrigin.clone().scale(s).multiply(new THREE.Matrix4().getInverse(this._matOrigin));this._nodes.forEach(function(n){if(!n.ignore){var b=n.node;b.matrixWorld.multiplyMatrices(m,n.matOrigin);b.matrix.multiplyMatrices(n.matParentInv,b.matrixWorld);if(this._coordinateSystem===C.Parent){var f=b.matrix.clone();f.elements[12]=0;f.elements[13]=0;f.elements[14]=0;var g=new THREE.Matrix4().makeRotationFromQuaternion(b.quaternion.clone().inverse()).multiply(b.matrix);var h=g.elements;b.scale.x=h[0];b.scale.y=h[5];b.scale.z=h[10];b.updateMatrix();}else{b.matrix.decompose(b.position,new THREE.Quaternion(),b.scale);var i=this._alignAxesBetweenGizmoAndNodeCoordinates(b,true);a(b.scale,i[0],n.scaleOrigin,s.x>0);a(b.scale,i[1],n.scaleOrigin,s.y>0);a(b.scale,i[2],n.scaleOrigin,s.z>0);b.updateMatrix();}}}.bind(this));}this._viewport.setShouldRenderFrame();};
d.prototype.scale=function(x,y,z){this.beginGesture();this._scale(new THREE.Vector3(x,y,z));};
d.prototype._setScale=function(s){var n=this._getNodesProperties();if(this._tool.fireEvent("scaling",{x:s.x,y:s.y,z:s.z,nodesProperties:n},true)){this._printEventInfo("Event 'scaling'",s.x,s.y,s.z,n);this._scale(s);}};
d.prototype.getValue=function(){return(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3)?this._value.getComponent(this._handleIndex):1;};
d.prototype.setValue=function(v){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var a=v/this._value.getComponent(this._handleIndex);var s=new THREE.Vector3(1,1,1);if(this._nonUniformScaleEnabled){s.setComponent(this._handleIndex,a);}else{s.setScalar(a);}this.beginGesture();this._scale(s);this.endGesture();}};
d.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef(),this._viewport._getLayers());}};
d.prototype.handleSelectionChanged=function(a){this._sequence=null;if(this._viewport){if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(this._viewport._viewStateManager);}this._updateSelection(this._viewport._viewStateManager);this._gizmoIndex=this._handleIndex=-1;var n=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:n},true);}};
d.prototype._getObjectScale=function(o){if(this._nodes.length===1){return this._nodes[0].node.scale;}else if(this._coordinateSystem===C.Local){return this._nodes[o].node.scale;}return new THREE.Vector3(1,1,1);};
d.prototype._getObjectSize=function(o){var b=new THREE.Box3();if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(b,this._viewport._getLayers(),false);}else if(this._coordinateSystem===C.Local){this._nodes[0].node._expandBoundingBox(b,this._viewport._getLayers(),false);}if(b.isEmpty()){return 0;}var s=new THREE.Vector3();b.getSize(s);return s.length();};
d.prototype._updateGizmoTransformation=function(g,a){var s=this._updateGizmoObjectTransformation(this._gizmo,g);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize+30,s);};
d.prototype._getEditingFormPosition=function(){var s=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var a=new THREE.Vector3().setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return a.clone().multiplyScalar((this._gizmoSize+18)*s).add(this._gizmo.position).applyMatrix4(this._matViewProj);};
d.prototype.render=function(){if(this._nodes.length>0){var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,a);r.render(this._sceneGizmo,a);}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex);};
return d;});
sap.ui.predefine('sap/ui/vk/tools/ScaleToolGizmoRenderer',[],function(){"use strict";var M={};
M.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkTransformationToolEdit");r.writeClasses();r.write(">");r.renderControl(c._editingForm);r.write("</div>");};
return M;},true);
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationTool',["./Tool","./SceneOrientationToolGizmo"],function(T,S){"use strict";
var a=T.extend("sap.ui.vk.tools.SceneOrientationTool",{
metadata:{properties:{enablePredefinedViews:{type:"boolean",defaultValue:true},enableInitialView:{type:"boolean",defaultValue:true}}},
constructor:function(i,s){if(a._instance){return a._instance;}T.apply(this,arguments);this._viewport=null;this._menu=null;a._instance=this;}
});
a.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new S());};
a.prototype.setActive=function(v,b,g){T.prototype.setActive.call(this,v,b,g);this.getGizmo()._viewport=this._viewport;return this;};
a.prototype.setView=function(v,m){this.getGizmo().setView(v,m);return this;};
a.prototype.setEnableInitialView=function(v){this.setProperty("enableInitialView",v);this.getGizmo().setEnableInitialView(v);};
a.prototype.queueCommand=function(c){if(this.isViewportType("sap.ui.vk.dvl.Viewport")){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(c,this._dvlRendererId);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}return this;};
a.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;delete a._instance;};
return a;});
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationToolGizmo',["./Gizmo","sap/m/MenuButton","sap/m/Menu","sap/m/MenuItem","../threejs/thirdparty/three","./SceneOrientationToolGizmoRenderer","../getResourceBundle","./PredefinedView","./AxisColours"],function(G,M,a,b,t,S,g,P,A){"use strict";sap.ui.require("sap.m.Menu");
var c=G.extend("sap.ui.vk.tools.SceneOrientationToolGizmo",{metadata:{library:"sap.ui.vk"}});
function d(e,f){var h=64,l=0.5,i=15,j=3,k=29,n=30;e.multiplyScalar(1/80);var o=new THREE.Vector3(e.y,e.z,e.x),p=new THREE.Vector3(e.z,e.x,e.y);var q=new THREE.MeshLambertMaterial({color:f}),r=new THREE.MeshBasicMaterial({color:0xFFFFFF,transparent:true,opacity:0.8}),s=new THREE.MeshBasicMaterial({color:0x000000,transparent:true,opacity:0.8});var u=new THREE.CylinderBufferGeometry(l,l,h-i,4);var m=new THREE.Matrix4().makeBasis(o,e,p).setPosition(e.clone().multiplyScalar((h-i)*0.5));u.applyMatrix(m);var v=new THREE.Mesh(u,q);var w=new THREE.CylinderBufferGeometry(0,j,i,12,1);m.setPosition(e.clone().multiplyScalar(h-i*0.5));w.applyMatrix(m);v.add(new THREE.Mesh(w,q));var x=new THREE.CylinderBufferGeometry(l,l,k,4);m.makeBasis(e,p,o).setPosition(p.clone().multiplyScalar(0.5).add(e).multiplyScalar(k));x.applyMatrix(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(l,l,k,4);m.setPosition(p.clone().multiplyScalar(0.5).add(e).add(o).multiplyScalar(k));x.applyMatrix(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(l,l,k,4);m.makeBasis(p,o,e).setPosition(o.clone().multiplyScalar(0.5).add(e).multiplyScalar(k));x.applyMatrix(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(l,l,n,4);m.makeBasis(e,p,o).setPosition(p.clone().multiplyScalar(0.5).add(e).multiplyScalar(n));x.applyMatrix(m);v.add(new THREE.Mesh(x,s));x=new THREE.CylinderBufferGeometry(l,l,n,4);m.setPosition(p.clone().multiplyScalar(0.5).add(e).add(o).multiplyScalar(n));x.applyMatrix(m);v.add(new THREE.Mesh(x,s));x=new THREE.CylinderBufferGeometry(l,l,n,4);m.makeBasis(p,o,e).setPosition(o.clone().multiplyScalar(0.5).add(e).multiplyScalar(n));x.applyMatrix(m);v.add(new THREE.Mesh(x,s));return v;}
c.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._enableInitialView=true;this._viewport=null;this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0.1,100);this._scene=new THREE.Scene();var l=new THREE.DirectionalLight(0xFFFFFF,0.5);l.position.set(1,3,2);this._scene.add(l);this._scene.add(new THREE.AmbientLight(0xFFFFFF,0.5));this._scene.add(d(new THREE.Vector3(1,0,0),A.x));this._scene.add(d(new THREE.Vector3(0,1,0),A.y));this._scene.add(d(new THREE.Vector3(0,0,1),A.z));this._scene.traverse(function(o){o.matrixAutoUpdate=false;});this._axisTitles=this._createAxisTitles(32,16);this._scene.add(this._axisTitles);var v=[P.Initial,P.Front,P.Back,P.Left,P.Right,P.Top,P.Bottom];this._menu=new a({items:[new b({text:g().getText("PREDEFINED_VIEW_INITIAL")}),new b({text:g().getText("PREDEFINED_VIEW_FRONT")}),new b({text:g().getText("PREDEFINED_VIEW_BACK")}),new b({text:g().getText("PREDEFINED_VIEW_LEFT")}),new b({text:g().getText("PREDEFINED_VIEW_RIGHT")}),new b({text:g().getText("PREDEFINED_VIEW_TOP")}),new b({text:g().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(e){var i=e.getParameters("item").item;var f=e.getSource().indexOfItem(i);this.setView(v[f],1000);},this);this._button=new M({tooltip:g().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:this._menu}).addStyleClass("sapUiVizKitSceneOrientationGizmoButton").addStyleClass("sapUiSizeCompact");};
c.prototype.setView=function(v,m){var q;switch(v){case P.Initial:q=null;break;case P.Front:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;case P.Back:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case P.Left:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case P.Right:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case P.Top:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case P.Bottom:q=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;default:return this;}this._viewport._viewportGestureHandler.setView(q,m||0);return this;};
c.prototype.setEnableInitialView=function(v){this._enableInitialView=v;var i=this._menu.getItems();i[0].setVisible(v);i[1].setStartsSection(v);};
c.prototype.render=function(v){this._viewport=v;this._camera.quaternion.copy(v.getCamera().getCameraRef().quaternion);this._camera.position.set(0,0,1).applyQuaternion(this._camera.quaternion);var w=this._renderer.getSize(new THREE.Vector2()).x;this._updateAxisTitles(this._axisTitles,this._scene,this._camera,w*0.45,2/w);this._renderer.render(this._scene,this._camera);};
c.prototype.onBeforeRendering=function(){};
c.prototype.onAfterRendering=function(){var e=this.getDomRef();this._renderer.setSize(e.clientWidth,e.clientHeight);e.appendChild(this._renderer.domElement);};
return c;});
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationToolGizmoRenderer',[],function(){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVizKitSceneOrientationGizmo");r.writeClasses();r.write(">");if(c.getParent().getEnablePredefinedViews()){r.renderControl(c._button);}r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/tools/Tool',["sap/ui/core/Element"],function(E){"use strict";
var T=E.extend("sap.ui.vk.tools.Tool",{
metadata:{properties:{targetViewportType:"any",toolid:"string",active:{type:"boolean",defaultValue:false},footprint:{type:"string[]"}},associations:{gizmoContainer:{type:"sap.ui.core.Control",cardinality:"0..1"}},aggregations:{gizmo:{type:"sap.ui.vk.tools.Gizmo",multiple:false}},events:{enabled:{parameters:{enabled:"boolean",reason:"string"}}}},
constructor:function(i,s){E.apply(this,arguments);this._viewport=null;this._handler=null;}
});
T.prototype.init=function(){if(E.prototype.init){E.prototype.init.call(this);}};
T.prototype.setViewport=function(v){var t=v&&v.getMetadata().getName();this._viewport=this.getFootprint().indexOf(t)>=0?v:null;};
T.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};
T.prototype.getViewportImplementation=function(v){var r=v;if(v&&typeof v.getImplementation==="function"){r=v.getImplementation()||v;}return r;};
T.prototype.setActive=function(v,a,g){var b=this.getViewportImplementation(a)||this._viewport;var t=b&&b.getMetadata().getName();var r;if(this.getFootprint().indexOf(t)>=0){this._viewport=b;this.setProperty("active",v,true);if(this.getGizmo()){g=g||b;this.setAssociation("gizmoContainer",g);if(g.getDomRef()){g.rerender();}}this._viewport.setShouldRenderFrame();r=v?"":"Disabled by application logic";}else{this._viewport=null;this.setProperty("active",false,true);r="Tool does not support Viewport type: "+t;jQuery.sap.log.warning(r);}this.fireEnabled({enabled:this.getActive(),reason:r});};
T.prototype.getGizmoForContainer=function(r){var _=this.getGizmo();if((r.getId()===this.getGizmoContainer())&&_&&this.getActive()){return _;}};
T.prototype.destroy=function(){E.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
T.prototype._addLocoHandler=function(){if(!this._viewport||!this._viewport._loco){return false;}this._viewport._loco.addHandler(this._handler,this._handler._priority);return true;};
T.prototype._removeLocoHandler=function(p){if(this._viewport&&this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}};
return T;});
sap.ui.predefine('sap/ui/vk/tools/ToolNodeSet',[],function(){"use strict";var T={Highlight:"Highlight",Outline:"Outline"};return T;},true);
sap.ui.predefine('sap/ui/vk/tools/TooltipTool',["./Tool","./TooltipToolHandler","./TooltipToolGizmo"],function(T,a,b){"use strict";
var c=T.extend("sap.ui.vk.tools.TooltipTool",{
metadata:{events:{hover:{parameters:{x:"int",y:"int",nodeRef:"any"}}}},
constructor:function(i,s){if(c._instance){return c._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new a(this);c._instance=this;}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new b());};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this);}this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};
c.prototype.setTitle=function(t){if(this._gizmo){this._gizmo.setTitle(t);}return this;};
c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
return c;});
sap.ui.predefine('sap/ui/vk/tools/TooltipToolGizmo',["./Gizmo","./TooltipToolGizmoRenderer"],function(G,T){"use strict";
var a=G.extend("sap.ui.vk.tools.TooltipToolGizmo",{metadata:{library:"sap.ui.vk"}});
a.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;};
a.prototype.show=function(v,t){this._viewport=v;this._tool=t;var b=this.getDomRef();if(b){b.style.display="none";}};
a.prototype.hide=function(){this._tool=null;var t=this.getDomRef();if(t){t.style.display="none";}};
a.prototype.setTitle=function(t){var b=this.getDomRef();if(b){b.style.display=t?"block":"none";b.innerText=t;}};
a.prototype.update=function(x,y,b,c,n){if(this._tool.fireEvent("hover",{x:x,y:y,nodeRef:n},true)){var t=this.getDomRef();if(t){var o=t.offsetParent;while(o){b-=o.offsetLeft||0;c-=o.offsetTop||0;o=o.offsetParent;}b+=10;c+=15;t.style.left=Math.round(b)+"px";t.style.top=Math.round(c)+"px";var v=this._viewport.getDomRef().getBoundingClientRect();var d=t.getBoundingClientRect();if(d.right>v.right){t.style.left=Math.round(b+v.right-d.right)+"px";}if(d.bottom>v.bottom){t.style.top=Math.round(c+v.bottom-d.bottom)+"px";}}}};
a.prototype.onBeforeRendering=function(){};
a.prototype.onAfterRendering=function(){};
return a;});
sap.ui.predefine('sap/ui/vk/tools/TooltipToolGizmoRenderer',[],function(){"use strict";var T={};
T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVizKitTooltip");r.writeClasses();r.write(">");r.write("</div>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/tools/TooltipToolHandler',["sap/ui/base/EventProvider"],function(E){"use strict";
var T=E.extend("sap.ui.vk.tools.TooltipToolHandler",{
metadata:{},
constructor:function(t){this._priority=0;this._tool=t;this._rect=null;this._rayCaster=new THREE.Raycaster();this._mouse=new THREE.Vector2();}
});
T.prototype.destroy=function(){this._tool=null;this._rect=null;};
T.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize(new THREE.Vector2());this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
T.prototype.hover=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)&&this.getViewport().getScene()){this._updateMouse(e);var i=this._rayCaster.intersectObject(this.getViewport().getScene().getSceneRef(),true);g.update(e.x-this._rect.x,e.y-this._rect.y,e.x,e.y,i.length>0?i[0].object:null);e.handled=i.length>0;}};
T.prototype.beginGesture=function(e){};
T.prototype.move=function(e){};
T.prototype.endGesture=function(e){};
T.prototype.click=function(e){};
T.prototype.doubleClick=function(e){};
T.prototype.contextMenu=function(e){};
T.prototype.getViewport=function(){return this._tool._viewport;};
T.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
T.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return T;});
sap.ui.predefine('sap/ui/vk/totara/Command',[],function(){"use strict";var C={addClientLog:"addClientLog",getAnnotation:"getAnnotation",getDynamicView:"getDynamicView",getGeometry:"getGeometry",getHighlightStyle:"getHighlightStyle",getImage:"getImage",getMaterial:"getMaterial",getMesh:"getMesh",getScene:"getScene",getSequence:"getSequence",getTrack:"getTrack",getTree:"getTree",getView:"getView",getViewGroups:"getViewGroups",notifyError:"notifyError",notifyFinishedTree:"notifyFinishedTree",notifyFinishedView:"notifyFinishedView",requestScene:"requestScene",setAnnotation:"setAnnotation",setCamera:"setCamera",setGeometry:"setGeometry",setHighlightStyle:"setHighlightStyle",setImage:"setImage",setMaterial:"setMaterial",setMesh:"setMesh",setScene:"setScene",setPlayback:"setPlayback",setSequence:"setSequence",setStreamingToken:"setStreamingToken",setTrack:"setTrack",setTree:"setTree",setTreeNode:"setTreeNode",setView:"setView",setViewGroup:"setViewGroup",setViewNode:"setViewNode",timestamp:"timestamp",performanceTiming:"performanceTiming"};return C;});
sap.ui.predefine('sap/ui/vk/utf8ArrayBufferToString',[],function(){"use strict";var u=function(a){return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(a))));};return u;},true);
sap.ui.require.preload({
	"sap/ui/vk/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.ui.vk","type":"library","embeds":[],"applicationVersion":{"version":"1.78.0"},"title":"SAPUI5 Visualization Toolkit.","description":"SAPUI5 Visualization Toolkit.","ach":"CA-UI5-VTK","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw","sap_hcb"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.78","libs":{"sap.ui.core":{"minVersion":"1.78.0"},"sap.ui.unified":{"minVersion":"1.78.0","lazy":true},"sap.m":{"minVersion":"1.78.0","lazy":true},"sap.ui.layout":{"minVersion":"1.78.0","lazy":true},"sap.ui.vbm":{"minVersion":"1.78.0","lazy":true},"sap.ui.richtexteditor":{"minVersion":"1.78.0","lazy":true}}},"library":{"i18n":false,"content":{"controls":["sap.ui.vk.AnimationTimeSlider","sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DrawerToolbar","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.ProgressIndicator","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.ViewGallery","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.tools.AnchorPointToolGizmo","sap.ui.vk.tools.CrossSectionToolGizmo","sap.ui.vk.tools.Gizmo","sap.ui.vk.tools.MoveToolGizmo","sap.ui.vk.tools.RotateToolGizmo","sap.ui.vk.tools.ScaleToolGizmo","sap.ui.vk.tools.SceneOrientationToolGizmo","sap.ui.vk.tools.TooltipToolGizmo"],"elements":["sap.ui.vk.ContentConnector","sap.ui.vk.FlexibleControlLayoutData","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.RedlineElementText","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.NodesTransitionHelper","sap.ui.vk.threejs.ViewStateManager","sap.ui.vk.tools.AnchorPointTool","sap.ui.vk.tools.CrossSectionTool","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.Tool","sap.ui.vk.tools.TooltipTool"],"types":[],"interfaces":["sap.ui.vk.AuthorizationHandler","sap.ui.vk.DecryptionHandler","sap.ui.vk.IPlaybackCollection"]}}}}',
	"sap/ui/vk/thirdparty/ie-polyfills.js":function(){
/* the subsequent text seems not to contain a copyright or license statement */
if(!Uint8Array.prototype.slice){Object.defineProperty(Uint8Array.prototype,"slice",{value:function(b,e){return new Uint8Array(Array.prototype.slice.call(this,b,e));}});}if(!Uint8Array.prototype.indexOf){Object.defineProperty(Uint8Array.prototype,"indexOf",{value:function(o,s){for(var i=(s||0),j=this.length;i<j;i++){if(this[i]===o){return i;}}return-1;}});}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{enumerable:false,value:function(o){var n=this.filter(function(e){return e==o;});return n.length>0;}});}
},
	"sap/ui/vk/threejs/MataiLoaderWorker.js":function(){(function(){"use strict";console.log("MataiLoaderWorker started.");
function S(s){this.sceneBuilderId=s;}
S.prototype.setScene=function(i){i.cameraId=i.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setScene",args:[i]});};
function p(v){var r=[];for(var a in v){var i=a.indexOf("/");if(i>=0){var f=[];var s=v[a];if(s){for(var n in s){f.push({name:n,value:s[n]});}}r.push({source:a.substr(0,i),type:a.substr(i+1),fields:f});}}return r;}
S.prototype.createNode=function(i){i.parentId=i.parentRef;if(i.transformType===1){i.transformType="BILLBOARD_VIEW";}else if(i.transformType===257){i.transformType="LOCK_TOVIEWPORT";}i.transform=i.matrix;i.sid=i.nodeRef;if(i.veids){i.veids=p(i.veids);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createNode",args:[i]},[i.transform.buffer]);};
S.prototype.createMesh=function(i){var t=[i.boundingBox.buffer];if(i.transform){t.push(i.matrix.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertSubmesh",args:[{meshId:i.meshRef,materialId:i.materialRef,transform:i.matrix,lods:[{id:i.meshRef,boundingBox:i.boundingBox}]}]},t);};
S.prototype.setMeshGeometry=function(i){var t=[i.data.index.buffer,i.data.position.buffer];if(i.data.normal){t.push(i.data.normal.buffer);}if(i.data.uv){t.push(i.data.uv.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setGeometry",args:[{id:i.meshRef,isPolyline:(i.flags&1)>0,data:{indices:i.data.index,points:i.data.position,normals:i.data.normal,uvs:i.data.uv}}]},t);};
S.prototype.insertMesh=function(n,m){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setMeshNode",args:[n,m]});};
S.prototype.createTextAnnotation=function(i){i.coordinateSpace=0;i.nodeId=i.nodeRef;i.fontFace=i.font;i.shape=i.style;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;i.textColour=i.textColor;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[i]});};
S.prototype.createTextNote=function(i){i.coordinateSpace=2;i.nodeId=i.nodeRef;i.id=i.nodeRef;i.sid=i.targetNodeRef;i.fontFace=i.font;i.shape=i.style;i.backgroundColour=i.backgroundColor;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[i]});};
S.prototype.createImageNote=function(i){i.properlyAligned=true;i.nodeId=i.nodeRef;i.labelMaterialId=i.materialRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImageNote",args:[i]});};
S.prototype.insertLeaderLine=function(a){var b=[];for(var i=0;i<a.points.length;i+=3){var c=[a.points[i],a.points[i+1],a.points[i+2]];b.push(c);}a.points=b;a.annotationId=a.nodeRef;a.nodeId=a.nodeRef;a.startPointSid=a.targetNodeRef;a.materialId=a.materialRef;a.startPointHeadStyle=a.startPointStyle;a.endPointHeadStyle=a.endPointStyle;a.pointHeadConstant=a.styleConstant;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertLeaderLine",args:[a]});};
S.prototype.createCamera=function(i){i.ortho=i.projection==="orthographic";i.near=i.nearClip;i.far=i.farClip;i.fov=i.fov*Math.PI/180;i.zoom=i.orthoZoomFactor;i.id=i.cameraRef;var t=[i.origin.buffer,i.up.buffer,i.target.buffer];if(i.matrix){t.push(i.matrix.buffer);}i.notUseDirectionVector=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createCamera",args:[i]},t);};
S.prototype.insertCamera=function(n,c){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertCamera",args:[n,c]});};
S.prototype.createViewportGroup=function(i){i.id=i.viewportGroupRef;if(i.veids){i.veids=p(i.veids);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertViewGroup",args:[i]});};
S.prototype.finalizePlaybacks=function(i){i.viewGroupId=i.viewportGroupRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationPlaybacks",args:[i]});};
S.prototype.insertModelView=function(i){i.viewGroupId=i.viewportGroupRef;i.viewId=i.modelViewRef;i.thumbnailId=i.thumbnail;i.cameraId=i.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertView",args:[i]});};
S.prototype.setModelViewVisibilitySet=function(i){i.viewId=i.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setModelViewVisibilitySet",args:[i]});};
S.prototype.insertModelViewHighlight=function(i){i.viewId=i.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertModelViewHighlight",args:[i]});};
S.prototype.createThumbnail=function(i){i.imageId=i.imageRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createThumbnail",args:[i]});};
S.prototype.createDetailView=function(i){i.nodeId=i.nodeRef;i.detailViewId=i.detailViewRef;i.cameraId=i.cameraRef;i.backgroundColour=i.backgroundColor;i.borderColour=i.borderColor;i.attachment=i.attachmentPoint;var t=[i.origin.buffer,i.size.buffer];if(i.attachment){t.push(i.attachment.buffer);}if(i.visibleNodes){t.push(i.visibleNodes.buffer);}if(i.targetNodes){t.push(i.targetNodes.buffer);}i.properlyAligned=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createDetailView",args:[i]},t);};
S.prototype.createMaterial=function(i){i.ambientColour=i.ambient;i.diffuseColour=i.diffuse;i.specularColour=i.specular;i.emissiveColour=i.emissive;i.lineWidth=i.linestyle.width;i.lineHaloWidth=i.linestyle.haloWidth;i.lineColour=i.linestyle.color;i.lineEndRound=i.linestyle.endCapStyle;i.lineDashPatternScale=i.linestyle.dashPatternScale;i.lineDashPattern=i.linestyle.dashPattern;i.lineWidthCoordinateSpace=i.linestyle.widthCoordinateSpace;i.id=i.materialRef;var t=[i.ambientColour.buffer,i.diffuseColour.buffer,i.specularColour.buffer,i.emissiveColour.buffer];if(i.lineColour&&i.lineDashPattern){t.push(i.lineColour.buffer,i.lineDashPattern.buffer);}if(i.textures){for(var a=0;a<i.textures.length;a++){var b=i.textures[a];var c="texture"+b.type.charAt(0).toUpperCase()+b.type.slice(1);i[c]={imageId:b.imageRef,matrix:b.matrix,uvHorizontalScale:b.scaleX,uvVerticalScale:b.scaleY,uvHorizontalOffset:b.offsetX,uvVerticalOffset:b.offsetY,uvRotationAngle:b.angle,influence:b.amount,filterMode:b.filterMode,uvHorizontalTilingEnabled:b.repeatX,uvVerticalTilingEnabled:b.repeatY,uvClampToBordersEnabled:b.clampToBorder,inverted:b.invert,modulate:b.modulate};}}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createMaterial",args:[i]},t);};
S.prototype.createImage=function(i){i.id=i.imageRef;i.binaryData=i.data;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImage",args:[i]},[i.binaryData.buffer]);};
S.prototype.progress=function(a){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"progress",args:[a]});};
S.prototype.insertThrustline=function(i){i.thrustlineId=i.thrustlineRef;i.materialId=i.material;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertThrustline",args:[i]});};
S.prototype.insertAnimationGroup=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationGroup",args:[i]});};
S.prototype.insertAnimation=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimation",args:[i]});};
S.prototype.insertAnimationTarget=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTarget",args:[i]});};
S.prototype.insertAnimationTrack=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTrack",args:[i]});};
S.prototype.finalizeAnimation=function(a){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationTracks",args:[a]});};
self.onmessage=function(e){var d=e.data;switch(d.method){case"createRuntime":console.log("MataiLoaderWorker starting runtime.");sap.ve.matai.createRuntime({prefixURL:d.scriptDirectory}).then(function(m){console.log("MataiLoaderWorker runtime created.");self.matai=m;self.postMessage({ready:true});});break;case"loadSceneFromArrayBuffer":var a=new S(d.sceneBuilderId);var r=self.matai.loadSceneFromArrayBuffer(a,d.buffer,d.fileName,null,d.sourceLocation);this.postMessage({sceneBuilderId:d.sceneBuilderId,method:"loadingFinished",args:[{result:r}]});break;default:break;}};
console.log("MataiLoaderWorker initialized.");})();
},
	"sap/ui/vk/totara/TotaraLoaderWorker.js":function(){(function(){"use strict";var m={};["getVersion","initializeConnection","getScene","getMesh","getAnnotation","getMaterial","getGeometry","getImage","getSequence","getTrack","getView","getHighlightStyle"].reverse().forEach(function(n,i){m[n]=i;});var t=new Map();
function H(){this._url=null;this._url2=null;this._correlationId=null;this._authorizationToken=null;this._tenantUuidToken=null;this._onResponse=null;this._onError=null;this._requestQueue=[];this._maxActiveRequests=4;this._activeRequestCount=0;}
H.prototype.init=function(s,a,b){this._url=s;this._correlationId=b;var d=this;return new Promise(function(e,f){if(a){a(s).then(function(h){d._authorizationToken=h?h.token_type+" "+h.access_token:null;d._tenantUuidToken=h?h.tenant_uuid:null;e({});}).catch(function(h){return f(h);});}else{e({});}});};
H.prototype.close=function(){};
H.prototype.setCachingURL=function(d){this._url2=d;};
H.prototype.send=function(a,b,o){if(!a){return;}this._requestQueue.push({message:(o?this._url2:this._url)+a,context:b,priority:m[b&&b.method]||0,onResponse:o||this._onResponse});if(this._activeRequestCount<this._maxActiveRequests){this._processNextRequest();}};
H.prototype._processNextRequest=function(){if(!this._requestQueue.length){return;}this._requestQueue.sort(function(a,b){return a.priority-b.priority;});var d=this._requestQueue.pop();this._activeRequestCount++;var e=this;this._makeRequestPromise(encodeURI(d.message)).then(function(a){if(d.onResponse){d.onResponse(a);}e._activeRequestCount--;e._processNextRequest();}).catch(function(a){if(e._onError){e._onError({errorText:"Could not connect to server: "+e._url,error:a.status,reason:a.message?a.message:a,context:d.context});}e._activeRequestCount--;e._processNextRequest();});};
H.prototype._makeRequestPromise=function(a){var b=this;var p=new Promise(function(d,e){var x=new XMLHttpRequest();x.onload=function(){if(this.status>=200&&this.status<300){d(this.response);if(this.getAllResponseHeaders().includes("tile-width")){var f=this.getResponseHeader("tile-width");var h=new RegExp("[^\/]+$");var i=this.responseURL.match(h);t.set(i[0],f);}}else{e({status:this.status,statusText:this.statusText});}};x.onerror=function(){e({status:this.status,statusText:this.statusText});};x.open("GET",a,true);if(b._authorizationToken){x.setRequestHeader("Authorization",b._authorizationToken);}if(b._tenantUuidToken){x.setRequestHeader("X-TenantUuid",b._tenantUuidToken);}x.setRequestHeader("X-CorrelationID",b._correlationId);x.responseType="arraybuffer";x.send();});return p;};
function W(){this._url=null;this._webSocket=null;this._onResponse=null;this._onError=null;this._isInitialised=false;this._timerId=0;}
W.prototype.init=function(s,a){this._url=s;var b=this;return new Promise(function(d,f){var w=b._webSocket=new WebSocket(s);w.binaryType="arraybuffer";w.onopen=function(){b._isInitialised=true;if(a!=null){a(s).then(function(e){if(e!=null){var h={"token":e.access_token};if(e.tenant_uuid){h.tenantUuid=e.tenant_uuid;}var i=JSON.stringify(h);var j="setStreamingToken"+("["+i.length+"]")+i;w.send(j);}b._keepAlive();d({});}).catch(function(e){return f(e);});}else{b._keepAlive();d({});}};w.onclose=function(){b._cancelKeepAlive();};w.onmessage=function(e){var h=e.data;if(b._onResponse){b._onResponse(h);}};w.onerror=function(e){if(!b._isInitialised){f("error connecting to "+s);}else if(b._onError){b._onError({errorText:e});}};});};
W.prototype.close=function(){if(this._webSocket){this._webSocket.close();this._webSocket=null;}};
W.prototype._keepAlive=function(){var a=60000;if(this._webSocket===null){this._cancelKeepAlive();return;}if(this._webSocket.readyState===1){this._webSocket.send("");}this._timerId=setTimeout(this._keepAlive,a);};
W.prototype._cancelKeepAlive=function(){if(this._timerId){clearTimeout(this._timerId);this._timerId=0;}};
W.prototype.send=function(a,b){if(!a){return;}if(this._webSocket&&this._webSocket.readyState===1){try{this._webSocket.send(a);}catch(e){if(this._onError){this._onError({errorText:e,context:b});}}}else if(this._onError){this._onError({errorText:"websocket connection lost",context:b,error:4});}};
function g(a){var b=a.split(",");if(b.length<0||b.length>2){throw"invalid content length";}var j=0;var d=0;try{j=parseInt(b[0],10);if(b.length===2){d=parseInt(b[1],10);}}catch(e){throw"invalid content length";}return{jsonContentLength:j,binaryContentLength:d};}
function c(a){var b="[".charCodeAt(0);var d="]".charCodeAt(0);var f=[];var s=0;var h=0;var i;var j;var k;var n=new Uint8Array(a);while(h<a.byteLength){h=n.indexOf(b,s);if(h===-1){break;}var o=u(a,s,h).replace(/\n|\r|\s/g,"");s=h+1;h=n.indexOf(d,s);if(h===-1){throw"No matching [] for command length. abort";}i=g(u(a,s,h));s=h+1;h=s+i.jsonContentLength;j=u(a,s,h);try{j=JSON.parse(j);}catch(e){var p=o+": "+e;throw p;}if(i.binaryContentLength){s=h;h=s+i.binaryContentLength;k=a.slice(s,h);}else{k=undefined;}s=h;var q={name:o,jsonContent:j};if(k){q.binaryContent=new Uint8Array(k);}f.push(q);}return f;}
function u(a,s,b){var d="";var M=1000;try{while(s<b){var f=Math.min(M,b-s);var h=new Uint8Array(a,s,f);d+=String.fromCharCode.apply(null,h);s+=f;}}catch(e){return"";}return decodeURIComponent(escape(d));}
function L(){this.resolveFunctions=[];this.rejectFunctions=[];this.init=function(d,h,e){this._connection=d;this._connectionHTTP=h;this._sceneBuilderId=e;if(!d){throw"no connection provided for loader!";}this._connection._onResponse=function(f){var i=c(f);p(i);};this._connection.send("getVersion[2]{}",{method:"getVersion"});};var a=this;function b(v){a.protocolVersion=v.split(".").map(function(s){return parseInt(s,10);});}function p(d){var e;var s=-1;var v,i;var n=false;var f=false;var h=false;for(i=0;i<d.length;i++){e=d[i];if(e.name==="setView"){if(!e.jsonContent.viewId){n=true;}f=true;}else if(e.name==="setViewNode"){v=e.jsonContent.viewId;}else if(e.name==="setSequence"&&f){h=true;}}if(v&&n){for(i=0;i<d.length;i++){e=d[i];if(e.name==="setView"){e.jsonContent.viewId=v;break;}}}var j=function(e){if(e.binaryContent){self.postMessage({name:e.name,jsonContent:e.jsonContent,binaryContent:e.binaryContent},[e.binaryContent.buffer]);}else{self.postMessage({name:e.name,jsonContent:e.jsonContent});}};for(i=0;i<d.length;i++){e=d[i];if(e.name==="protocol"){b(e.jsonContent.version);}if(e.name==="setPlayback"&&h){s=i;continue;}if(e.name==="setImage"&&t.get(e.jsonContent.id)){e.jsonContent.tileWidth=t.get(e.jsonContent.id);}if(e.name==="setScene"&&d.length>1){continue;}j(e);}if(s!==-1){e=d[s];j(e);}}this.getConnection=function(){return this._connection;};this._sendGetImage=function(d){var e;if(this.protocolVersion&&(this.protocolVersion[0]>1||this.protocolVersion[1]>0)){if(d.materialId){e="scenes/"+d.sceneId+"/materials/"+d.materialId+"/images/"+d.imageId;}else if(d.viewId){e="scenes/"+d.sceneId+"/views/"+d.viewId+"/images/"+d.imageId;}}e=e||("images/"+d.imageId);this._connectionHTTP.send(e,d,function(f){p([{name:"setImage",jsonContent:{sceneId:d.sceneId,id:d.imageId},binaryContent:new Uint8Array(f)}]);});};this._sendGetGeometries=function(d){var e=d.geometryIds;var f="geometry?";for(var i=0;i<e.length;i++){f+=(i>0?"&id=":"id=")+e[i];}this._connectionHTTP.send(f,d,function(h){var j=new DataView(h);var k=j.getUint16(2,true),o=0;var n=[];while(k-->0){var q={sceneId:d.sceneId,id:j.getUint32(o+4,true).toString(),box:[j.getFloat32(o+14,true),j.getFloat32(o+18,true),j.getFloat32(o+22,true),j.getFloat32(o+26,true),j.getFloat32(o+30,true),j.getFloat32(o+34,true)]};var s=j.getUint16(o+12,true);o+=38;if(s!==3){q.flags=j.getUint16(o,true);q.quality=j.getFloat32(o+4,true);q.pointCount=j.getUint16(o+8,true);q.elementCount=j.getUint16(o+10,true);o+=14;}var v=j.getUint32(o,true);var w=new Uint8Array(h,o+4,v);o+=v;n.push({name:"setGeometry",jsonContent:q,binaryContent:w.slice()});}p(n);});};this._sendGetGeomMeshes=function(d){var e="scenes/"+d.sceneId+"/meshes?ids=";var f=d.meshIds;for(var i=0;i<f.length;i++){e+=(i>0?",":"")+f[i];}this._connectionHTTP.send(e,d,function(h){var j=c(h);j.forEach(function(s){s.jsonContent.sceneId=d.sceneId;});p(j);});};this.send=function(d){if(this._connectionHTTP){switch(d.method){case"getImage":this._sendGetImage(d);return;case"getGeometry":this._sendGetGeometries(d);return;case"getMesh":if(d.meshIds){this._sendGetGeomMeshes(d);return;}break;default:break;}}if(this._connection){this._connection.send(d.command,{method:d.method});}};this.setSceneBuilderId=function(i){this._sceneBuilderId=i;};this.getSceneBuilderId=function(){return this._sceneBuilderId;};this.authorizationHandler=function(d){var a=this;return new Promise(function(e,f){var h={name:"getAuthorization",jsonContent:{"url":d},sceneId:a.sceneId};a.resolveFunctions.push(e);a.rejectFunctions.push(f);self.postMessage(h);});}.bind(this);}
var l=new L();var r=function(e){self.postMessage({name:"notifyError",jsonContent:e});};
self.onmessage=function(e){var d=e.data;switch(d.method){case"initializeConnection":{if(!d.url){break;}if(d.sceneId){l.sceneId=d.sceneId;}var a="";if(d.url[d.url.length-1]!=="/"){d.url+="/";}if(d.url.toLowerCase().startsWith("ws")){a=d.url+"streaming?";}else if(d.url.toLowerCase().startsWith("http")){a=d.url+"streaming-http?request=";}else{a=(d.useSecureConnection?"wss://":"ws://")+d.url+"streaming?";}var b=d.cid;var f=l.getConnection();if(!f||f._url!==a){if(f){f.close();}var h;var i=null;if(d.url.toLowerCase().startsWith("ws")){h=new W();}else if(d.url.toLowerCase().startsWith("http")){h=new H();h.setCachingURL(d.url);}else{h=new W();i=(d.useSecureConnection?"https://":"http://")+d.url;}h._onError=r;h.init(a,l.authorizationHandler,b).then(function(){var n=function(h,o){l.init(h,o,d.sceneBuilderId);if(d.command){l.send(d);}};if(i){var o=new H();o.setCachingURL(i);o.init(i,l.authorizationHandler,b).then(function(){n(h,o);}).catch(function(p){r(p);});}else{n(h,h instanceof H?h:null);}}).catch(function(n){r(n);});}else if(d.command){l.send(d);}break;}case"setAuthorization":{var j=l.resolveFunctions.shift();var k=l.rejectFunctions.shift();if(d.error==null){j(d.authorizationToken);}else{k(d.error);}break;}case"close":{self.close();break;}default:{if(d.command){l.send(d);}break;}}};
self.postMessage({ready:true});})();
},
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
	"sap/ui/vk/dvl/GraphicsCore.js":'/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n\n        (c) Copyright 2009-2015 SAP SE. All rights reserved\n    \n */\nvar dvlLib="../ve/dvl";if(sap.ui.Device.browser.internet_explorer){dvlLib="../ve/dvl_asm";}sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider","../ve/thirdparty/html2canvas",dvlLib,"./Scene","../ContentResource","../DownloadManager","./ViewStateManager","../DvlException","../Messages","sap/ui/thirdparty/URI","./GraphicsCoreApi","./checkResult","./getPointer","./getJSONObject","../getResourceBundle","../utf8ArrayBufferToString"],function(q,E,H,D,S,C,a,V,b,M,U,G,c,d,f,h,u){"use strict";var l=q.sap.log;\nfunction j(e){return e instanceof File?"local":"remote";}\nfunction k(e){return e instanceof File?e.name:e;}\nvar n=function(e){Object.defineProperties(this,{source:{value:e,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};\nn.prototype.isInUse=function(){return this._refCount>0;};\nn.prototype.addRef=function(){++this._refCount;return this;};\nn.prototype.release=function(){--this._refCount;return this;};\nn.prototype.destroy=function(){};\nvar o=function(e,g,i){n.call(this,e);Object.defineProperties(this,{content:{value:i,writable:false,enumerable:true},vdsSourceDatum:{value:g,writable:false,enumerable:true}});};o.prototype=Object.create(n.prototype);o.prototype.constructor=o;\no.prototype.destroy=function(){if(this.vdsSourceDatum){this.vdsSourceDatum.release();}n.prototype.destroy.call(this);};\nvar p=function(e,g,i){Object.defineProperties(this,{dvlSceneId:{value:e,writable:false,enumerable:true},sourceDatum:{value:g,writable:false,enumerable:true},root:{value:!!i,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};\np.prototype.isInUse=function(){return this._refCount>0;};\np.prototype.addRef=function(){++this._refCount;return this;};\np.prototype.release=function(){--this._refCount;return this;};\np.prototype.destroy=function(){if(this.sourceDatum){this.sourceDatum.release();}};\nvar r=function(e,g){Object.defineProperties(this,{source:{value:e.getSource()},sourceType:{value:e.getSourceType()},sourceId:{value:e.getSourceId(),writable:true},name:{value:e.getName()},localMatrix:{value:e.getLocalMatrix(),writable:true},password:{value:e.getPassword()},children:{value:e.getContentResources().map(function(e){return new r(e);})},dvlSceneDatum:{value:null,writable:true},nodeProxy:{value:null,writable:true},fake:{value:!!g},sourceProperties:{value:null,writable:true}});e._shadowContentResource=this;};\nr.prototype.destroy=function(){if(this.dvlSceneDatum){this.dvlSceneDatum.release();}};\nvar s=function(e,g){Object.defineProperties(this,{vkScene:{value:e},shadowContentResource:{value:g}});};\nvar t=E.extend("sap.ui.vk.dvl.GraphicsCore",{\nmetadata:{publicMethods:["attachSceneLoadingFinished","attachSceneLoadingProgress","attachSceneLoadingStarted","buildSceneTree","buildSceneTreeAsync","createViewStateManager","destroyScene","destroyViewStateManager","detachSceneLoadingFinished","detachSceneLoadingProgress","detachSceneLoadingStarted","getApi","loadContentResourcesAsync","showDebugInfo","updateSceneTree","updateSceneTreeAsync"]},\nconstructor:function(e,g){E.apply(this);var i=q.extend({},e,{filePackagePrefixURL:q.sap.getResourcePath("sap/ui/vk/ve")+"/"});this._dvlClientId=q.sap.uid();var m=this;this._initialized=new Promise(function(z){m._initResolve=z;});sap.ve.dvl.createRuntime(i).then(function(z){m._dvl=z;m._dvl.CreateCoreInstance(m._dvlClientId);c(m._dvl.Core.Init(m._DVLMajorVersion,m._DVLMinorVersion));var A=sap.ui.getCore();A.attachLocalizationChanged(m._onlocalizationChanged,m);c(m._dvl.Core.SetLocale(A.getConfiguration().getLanguageTag()));m._canvas=m._createRenderingCanvasAndContext(g);m._rendererId=d(m._dvl.Core.CreateRenderer());m._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,m._rendererId);m._initResolve();});this._sourceData=[];this._dvlSceneData=[];this._vkSceneData=[];this._viewports=[];this._renderLoopRequestId=null;this._renderLoopFunction=this._renderLoop.bind(this);this._viewStateManagers=[];},\n_DVLMajorVersion:7,\n_DVLMinorVersion:4\n});\nt.create=function(e,i){return new Promise(function(m,z){try{var g=new t(e,i);g._initialized.then(function(){m(g);});}catch(A){z(A);}});};\nt.prototype.destroy=function(){sap.ui.getCore().detachLocalizationChanged(this._onlocalizationChanged,this);var e=this._viewports.slice();e.reverse();e.forEach(function(g){g.control.setGraphicsCore(null);});this._viewports=null;this._cleanupVkSceneData();this._vkSceneData=null;this._cleanupDvlSceneData();this._dvlSceneData=null;this._cleanupSourceData();this._sourceData=null;this._viewStateManagers.slice().forEach(this.destroyViewStateManager.bind(this));this._viewStateManagers=null;this._webGLContext=null;this._canvas=null;this._dvl.Core.DeleteRenderer(this._rendererId);this._rendererId=null;this._dvl.Core.Release();this._dvl=null;E.prototype.destroy.apply(this);};\nt.prototype._createRenderingCanvasAndContext=function(e){var g=document.createElement("canvas");g.id=q.sap.uid();this._webGLContext=this._dvl.Core.CreateWebGLContext(g,e);return g;};\nt.prototype._getCanvas=function(){return this._canvas;};\nt.prototype._getWebGLContext=function(){return this._webGLContext;};\nt.prototype._getDvl=function(){return this._dvl;};\nt.prototype._getDvlClientId=function(){return this._dvlClientId;};\nt.prototype._findSourceData=function(e){var g=Object.getOwnPropertyNames(e);return this._sourceData.filter(function(i){return g.every(function(m){return e[m]===i[m];});});};\nt.prototype._destroySourceDatum=function(e){if(!(e instanceof o)){this._dvl.Core.DeleteFileByUrl(k(e.source),j(e.source));}e.destroy();return this;};\nt.prototype._cleanupSourceData=function(){var e=false;for(var i=this._sourceData.length-1;i>=0;--i){var g=this._sourceData[i];if(!g.isInUse()){var m=g instanceof o?g.vdsSourceDatum:null;this._sourceData.splice(i,1);this._destroySourceDatum(g);if(m&&!m.isInUse()){e=true;}}}if(e){this._cleanupSourceData();}return this;};\nt.prototype._findDvlSceneData=function(e){var g=Object.getOwnPropertyNames(e);return this._dvlSceneData.filter(function(i){return g.every(function(m){return e[m]===i[m];});});};\nt.prototype._destroyDvlSceneDatum=function(e){this._dvl.Scene.Release(e.dvlSceneId);e.destroy();return this;};\nt.prototype._cleanupDvlSceneData=function(){for(var i=this._dvlSceneData.length-1;i>=0;--i){var e=this._dvlSceneData[i];if(!e.isInUse()){this._dvlSceneData.splice(i,1);this._destroyDvlSceneDatum(e);}}};\nt.prototype._findVkSceneData=function(e){var g=Object.getOwnPropertyNames(e);return this._vkSceneData.filter(function(i){return g.every(function(m){return e[m]===i[m];});});};\nt.prototype._cleanupVkSceneData=function(){for(var i=this._vkSceneData.length-1;i>=0;--i){this.destroyScene(this._vkSceneData[i].vkScene);}};\nt.prototype._destroyShadowContentResource=function(g,i){if(i.children){i.children.forEach(this._destroyShadowContentResource.bind(this,g));}if(i.nodeProxy){var m=g.getDefaultNodeHierarchy();try{m.removeNode(i.nodeProxy.getNodeRef());}catch(e){var z="Failed to delete node with ID = "+i.nodeProxy.getNodeRef()+".";if(e instanceof b){z+=" Error code: "+e.code+". Message: "+e.message+".";}l.error(z);}m.destroyNodeProxy(i.nodeProxy);}i.destroy();};\nt.prototype._filterContentResources=function(e,g){var i=[];e.forEach(function enumerate(m){if(g(m)){i.push(m);}m.getContentResources().forEach(enumerate);});return i;};\nt.prototype._getContentResourcesWithMissingPasswords=function(g){var i=this._dvl.Library;return this._filterContentResources(g,function(m){var z=m.getSource();try{return z&&(f(i.RetrieveInfo(k(z),j(z))).flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED)&&!m.getPassword();}catch(e){l.warning("Failed to get information from Emscripten virtual file system about file \'"+k(z)+"\'");return false;}});};\nt.prototype._getContentResourcesWithEncryptedVds3=function(g){var i=this._dvl.Library;return this._filterContentResources(g,function(m){var z=m.getSource();if(z){try{var A=f(i.RetrieveInfo(k(z),j(z)));return A.major<=3&&(A.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED);}catch(e){l.warning("Failed to get information from Emscripten virtual file system about file \'"+k(z)+"\'");return false;}}else{return false;}});};\nt.prototype._collectAndCheckSourceProperties=function(g){var i=g.dvlSceneDatum.sourceDatum;if(!i){return this;}try{if(i instanceof o){i=i.vdsSourceDatum;}var m=f(this._dvl.Library.RetrieveInfo(k(i.source),j(i.source)));g.sourceProperties={version:{major:m.major,minor:m.minor}};if(m.flags&(sap.ve.dvl.DVLFILEFLAG.PAGESCOMPRESSED|sap.ve.dvl.DVLFILEFLAG.WHOLEFILECOMPRESSED)){g.sourceProperties.compressed=true;}if(m.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED){g.sourceProperties.encrypted=true;}}catch(e){l.warning("Failed to get information from Emscripten virtual file system about file \'"+k(g.source)+"\'");}return this;};\nt.prototype.loadContentResourcesAsync=function(e,g,i){var z=this,A=[],B=new Map();e.forEach(function enumerate(m){var K=m.getSource();if(K&&A.indexOf(K)<0&&z._findSourceData({source:K}).length===0){A.push(K);var L=m.getSource();var N;if(L instanceof Object){N=L.name;}else{N=L;}if(m.getSourceType()==="vdsl"||m.getSourceType()==="vds"&&N.split(".").pop()==="vdsl"){B.set(K,{});}}m.getContentResources().forEach(enumerate);});var F=[];if(A.length>0){var I;var J=new a(A,null,this._authorizationHandler).attachItemSucceeded(function(K){var L=K.getParameter("source");var N=K.getParameter("response");if(B.has(L)){var O=u(N);if(O.trim().length===0){I=I||[];I.push({source:L,status:M.VIT22.code,statusText:h().getText(M.VIT22.summary)});l.error(h().getText(M.VIT22.summary),M.VIT22.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var P=O.split(/\\n|\\r\\n/);var m=P[0].match(/^file=(.+)$/);if(!m){I=I||[];I.push({source:L,status:M.VIT23.code,statusText:h().getText(M.VIT23.summary)});l.error(h().getText(M.VIT23.summary),M.VIT23.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var Q=B.get(L);Q.content=P;var R=m[1];var T=R;var W=new U(T);if(W.is("relative")){if(L instanceof File){I=I||[];I.push({source:L,status:M.VIT24.code,statusText:h().getText(M.VIT24.summary)});l.error(h().getText(M.VIT24.summary),M.VIT24.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var X=new U(L);R=W.absoluteTo(X).href();}}Q.referencedSource=R;Q.content[0]=Q.content[0].replace(T,this._dvl.Core.GetFilename(Q.referencedSource,"remote"));if(A.indexOf(Q.referencedSource)<0&&this._findSourceData({source:Q.referencedSource}).length===0){A.push(Q.referencedSource);J.queue(Q.referencedSource);}}}}else{var Y=L instanceof File;var Z=Y?L.name:L;var $=j(L);this._dvl.Core.CreateFileFromArrayBuffer(N,Z,$);F.push(new n(L));}},this).attachAllItemsCompleted(function(m){Array.prototype.push.apply(this._sourceData,F);B.forEach(function(K,L){var N=this._findSourceData({source:K.referencedSource})[0];if(N){var O=new o(L,N,K.content.join("\\n"));this._sourceData.push(O);N.addRef();}}.bind(this));if(g){g(I);}},this).attachItemFailed(function(m){I=I||[];I.push({source:m.getParameter("source"),status:m.getParameter("status"),statusText:m.getParameter("statusText")});},this);if(i){J.attachItemProgress(i,this);}J.start();}else if(g){g();}return this;};\nt.prototype._buildPlaceholders=function(e,g,i,m){var z=[];m.forEach(function build(g,i,A){var B=e.createNode(g,A.name,i);A.nodeProxy=e.createNodeProxy(B);if(A.localMatrix){A.nodeProxy.setLocalMatrix(A.localMatrix);}if(A.source){z.push(A);}A.children.forEach(build.bind(this,B,null));}.bind(this,g,i));return z;};\nt.prototype._updatePlaceholders=function(e,g,m){var z=this,A=e.getDefaultNodeHierarchy(),B=[];(function update(F,m,I){function J(N,O){if(!N&&!O){return true;}else if(!!N^!!O){return false;}else{return N.source===O.getSource()&&N.sourceType===O.getSourceType()&&N.name===O.getName()&&N.password===O.getPassword();}}function K(N,O){O._shadowContentResource=N;N.sourceId=O.getSourceId();N.localMatrix=O.getLocalMatrix();if(N.nodeProxy){N.nodeProxy.setLocalMatrix(N.localMatrix);}}var i=0;var L=q.sap.arrayDiff(F,m,J,true);L.forEach(function(N){for(;i<N.index;++i){update(F[i].children,m[i].getContentResources(),F[i].nodeProxy.getNodeRef());K(F[i],m[i]);}if(N.type==="delete"){z._destroyShadowContentResource(e,F[N.index]);F.splice(N.index,1);}else if(N.type==="insert"){var O;if(i<F.length&&F[i].nodeProxy){O=F[i].nodeProxy.getNodeRef();}var P=new r(m[N.index]);B=B.concat(z._buildPlaceholders(A,I,O,[P]));F.splice(N.index,0,P);++i;}});for(;i<F.length;++i){update(F[i].children,m[i].getContentResources(),F[i].nodeProxy&&F[i].nodeProxy.getNodeRef());K(F[i],m[i]);}})(g.fake?g.children:[g],m,null);return B;};\nt.prototype._loadAndMergeContentResource=function(g,i){if(i.source){var m=this._findSourceData({source:i.source})[0];if(!m){l.warning("Failed to load content resource with sourceId \'"+i.sourceId+"\' due to failed downloading from URL \'"+k(i.source)+"\'.");}else{var z=i.nodeProxy.getNodeRef();var A=this._findDvlSceneData({sourceDatum:m,root:false})[0];if(!A){try{A=new p(d(m instanceof o?this._dvl.Core.LoadSceneFromVDSL(m.content,i.password):this._dvl.Core.LoadSceneByUrl(k(i.source),i.password,j(i.source))),m,false);}catch(e){l.error(h().getText(M.VIT34.summary)+": "+k(i.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return;}this._dvlSceneData.push(A);m.addRef();}i.dvlSceneDatum=A;A.addRef();this._collectAndCheckSourceProperties(i);this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,this._rendererId);this._dvl.Scene.Merge(g._dvlSceneRef,A.dvlSceneId,z);}}};\nt.prototype.buildSceneTree=function(g){if(g.length===0){return null;}var i;var m;var z=g.map(function(I){return new r(I);});if(z.length===1&&z[0].name==null){m=z[0];if(m.source){var A=this._findSourceData({source:m.source})[0];try{i=new p(d(A instanceof o?this._dvl.Core.LoadSceneFromVDSL(A.content,m.password):this._dvl.Core.LoadSceneByUrl(k(m.source),m.password,j(m.source))),A,true);}catch(e){l.error(h().getText(M.VIT34.summary)+": "+k(m.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return null;}A.addRef();}else{i=new p(this._dvl.Core.CreateEmptyScene(),null,true);}}else{var B=new C({sourceType:"vds",sourceId:q.sap.uid()});m=new r(B,true);B.destroy();B=null;Array.prototype.push.apply(m.children,z);z=[m];i=new p(this._dvl.Core.CreateEmptyScene(),null,true);}this._dvlSceneData.push(i);m.dvlSceneDatum=i;i.addRef();this._collectAndCheckSourceProperties(m);var F=new S(this,i.dvlSceneId);this._vkSceneData.push(new s(F,m));this._buildPlaceholders(F.getDefaultNodeHierarchy(),null,null,m.children).forEach(this._loadAndMergeContentResource.bind(this,F.getDefaultNodeHierarchy()));return F;};\nt.prototype.updateSceneTree=function(e,g,i){if(g.length===0){return null;}var m;var z=this._getContentResourcesWithEncryptedVds3(g);if(z.length>0){l.error(h().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithEncryptedVds3=z;}var A=this._getContentResourcesWithMissingPasswords(g);if(A.length>0){l.error(h().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithMissingPasswords=A;}if(m&&i){i(m);}if(!e){return this.buildSceneTree(g);}var B=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var F=!!B.source;var I=g.length===1&&!!g[0].getSource();if(!(F&&I&&B.source===g[0].getSource()||!F&&!I&&B.fake===g.length>1)||!B.fake&&g.length===1&&B.name!==g[0].getName()){return this.buildSceneTree(g);}this._updatePlaceholders(e,B,g).forEach(this._loadAndMergeContentResource.bind(this,e.getDefaultNodeHierarchy()));e.getDefaultNodeHierarchy().fireChanged();return e;};\nt.prototype._loadDvlSceneAsync=function(g,i){return new Promise(function(m,z){var A;var B=function(J){A();this.fireSceneLoadingFinished({source:g.source,sceneId:J.sceneId});m(J.sceneId);};var F=function(J){A();var K=J.errorMessage;if(K==null){K=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(J.errorCode):"";}var L={source:g.source,errorCode:J.errorCode,errorMessage:K};this.fireSceneLoadingFinished(L);z(L);};var I=function(J,K){this.fireSceneLoadingProgress({source:k(g.source),percentage:K});return true;}.bind(this);A=function(){this._dvl.Client.NotifyFileLoadProgress=null;this._dvl.Client.detachSceneFailed(F,this);this._dvl.Client.detachSceneLoaded(B,this);}.bind(this);this._dvl.Client.attachSceneLoaded(B,this);this._dvl.Client.attachSceneFailed(F,this);this._dvl.Client.NotifyFileLoadProgress=I;this.fireSceneLoadingStarted({source:k(g.source)});try{c(g instanceof o?this._dvl.Core.LoadSceneFromVDSLAsync(g.content,i):this._dvl.Core.LoadSceneByUrlAsync(k(g.source),i,j(g.source)));}catch(e){A();F.call(this,{errorCode:e instanceof b?e.code:sap.ve.dvl.DVLRESULT.FAIL,errorMessage:e instanceof b?null:e});}}.bind(this));};\nvar v=function(e,g){return new Promise(function(i){(function step(m){if(m>=e.length){i();}else{g(e[m]).catch(function(){}).then(function(){step(m+1);});}})(0);});};\nt.prototype._loadAndMergeContentResourcesAsync=function(e,g){var i,m=this;return v(g,function(z){if(z.source){var A=m._findSourceData({source:z.source})[0];if(!A){var B="Failed to load content resource with sourceId \'"+z.sourceId+"\' due to failed downloading from URL \'"+k(z.source)+"\'.";l.warning(B);i=i||[];i.push({errorMessage:B,source:z.source});return Promise.reject();}return(function(){var F=m._findDvlSceneData({sourceDatum:A,root:false})[0];if(F){return Promise.resolve(F);}else{return m._loadDvlSceneAsync(A,z.password).then(function(I){F=new p(I,A,false);m._dvlSceneData.push(F);A.addRef();return Promise.resolve(F);},function(I){i=i||[];i.push(I);return Promise.reject();});}})().then(function(F){z.dvlSceneDatum=F;F.addRef();m._collectAndCheckSourceProperties(z);var I=z.nodeProxy.getNodeRef();m._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,m._rendererId);m._dvl.Scene.Merge(e._dvlSceneRef,F.dvlSceneId,I);return Promise.resolve();});}return Promise.resolve();}).then(function(){return Promise.resolve(i);});};\nt.prototype.buildSceneTreeAsync=function(e){if(e.length===0){return Promise.resolve(null);}var g=e.map(function(i){return new r(i);});return function(){var i;if(g.length===1&&g[0].name==null){i=g[0];if(i.source){var m=this._findSourceData({source:i.source})[0];if(m){return this._loadDvlSceneAsync(m,i.password).then(function(A){var B=new p(A,m,true);m.addRef();return Promise.resolve({shadowContentResource:i,dvlSceneDatum:B});});}else{return Promise.reject({errorMessage:"Failed to download the root content resource.",source:i.source});}}return Promise.resolve({shadowContentResource:i,dvlSceneDatum:new p(this._dvl.Core.CreateEmptyScene(),null,true)});}else{var z=new C({sourceType:"vds",sourceId:q.sap.uid()});i=new r(z,true);z.destroy();z=null;Array.prototype.push.apply(i.children,g);g=[i];return Promise.resolve({shadowContentResource:i,dvlSceneDatum:new p(this._dvl.Core.CreateEmptyScene(),null,true)});}}.call(this).then(function(i){this._dvlSceneData.push(i.dvlSceneDatum);i.shadowContentResource.dvlSceneDatum=i.dvlSceneDatum;i.dvlSceneDatum.addRef();this._collectAndCheckSourceProperties(i.shadowContentResource);var m=new S(this,i.dvlSceneDatum.dvlSceneId);this._vkSceneData.push(new s(m,i.shadowContentResource));var z=m.getDefaultNodeHierarchy();return this._loadAndMergeContentResourcesAsync(z,this._buildPlaceholders(m.getDefaultNodeHierarchy(),null,null,i.shadowContentResource.children)).then(function(A){return Promise.resolve({scene:m,failureReason:A});});}.bind(this));};\nt.prototype.updateSceneTreeAsync=function(e,g){if(g.length===0){return Promise.resolve(null);}var i=this._getContentResourcesWithEncryptedVds3(g);if(i.length>0){l.error(h().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");}var m=this._getContentResourcesWithMissingPasswords(g);if(m.length>0){l.error(h().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");}if(!e){return this.buildSceneTreeAsync(g);}var z=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var A=!!z.source;var B=g.length===1&&!!g[0].getSource();if(!(A&&B&&z.source===g[0].getSource()||!A&&!B&&z.fake===g.length>1)||!z.fake&&g.length===1&&z.name!==g[0].getName()){return this.buildSceneTreeAsync(g);}return new Promise(function(F,I){var J=e.getDefaultNodeHierarchy();this._loadAndMergeContentResourcesAsync(J,this._updatePlaceholders(e,z,g)).then(function(K){F({scene:e,failureReason:K});J.fireChanged();});}.bind(this));};\nt.prototype.destroyScene=function(e){var g;for(g=0;g<this._vkSceneData.length;++g){if(this._vkSceneData[g].vkScene===e){break;}}if(g===this._vkSceneData.length){l.warning("Scene with id \'"+e.getId()+"\' is not created by this GraphicsCore.");return this;}var i=this._vkSceneData.splice(g,1)[0];this._destroyShadowContentResource(e,i.shadowContentResource);e.destroy();return this;};\nvar w=function(e,g,m){for(var i=0,z=e.length;i<z;++i){if(g.call(m,e[i],i,e)){return i;}}return-1;};var x=function(e,g){return w(e,function(i){return i.control===g;});};var y=function(e,g){return w(e,function(i){return i.rendererId===g;});};\nt.prototype._registerViewport=function(e){if(x(this._viewports,e)>=0){return false;}var g={control:e,canvas:null,rendererId:null};if(this._viewports.length===0){g.canvas=this._canvas;g.rendererId=this._rendererId;this._startRenderLoop();}else{if(this._viewports.length===1){var i=this._viewports[0];i.control._setCanvas(i.canvas=document.createElement("canvas"));this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);}g.canvas=document.createElement("canvas");g.rendererId=this._dvl.Core.CreateRenderer();}e._setCanvas(g.canvas);e._setRenderer(g.rendererId);e.attachResize(this._handleViewportResize,this);this._viewports.push(g);return true;};\nt.prototype._deregisterViewport=function(e){var i=x(this._viewports,e);if(i<0){return false;}var g=this._viewports.splice(i,1)[0];if(this._viewports.length===0){this._stopRenderLoop();}else{if(this._viewports.length===1){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);var m=this._viewports[1-i];m.control._setCanvas(m.canvas=this._canvas);}this._dvl.Core.DeleteRenderer(g.rendererId);}e.detachResize(this._handleViewportResize,this);e._setRenderer(null);e._setCanvas(null);return true;};\nt.prototype._getViewportCount=function(){return this._viewports.length;};\nt.prototype._handleViewportResize=function(e){if(this._viewports.length>1){this._canvas.width=Math.max.apply(null,this._viewports.map(function(g){return g.canvas.width;}));this._canvas.height=Math.max.apply(null,this._viewports.map(function(g){return g.canvas.height;}));}};\nt.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};\nt.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=null;}return this;};\nt.prototype._renderLoop=(function(){var e;return function(){var m=this._viewports.length>1;this._viewports.forEach(function(g){var i=g.canvas,z=g.rendererId;this._dvl.Renderer._processCommandQueue(z);if(i.width>0&&i.height>0&&this._dvl.Renderer.ShouldRenderFrame(z)){if(m&&e!==z){this._dvl.Renderer.SetDimensions(i.width,i.height,z);}g.control.renderFrame();e=z;}},this);this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};})();\nt.prototype._handleFrameFinished=function(e){if(this._viewports.length>1){var i=y(this._viewports,e.rendererId);if(i>=0){var g=this._viewports[i].canvas,m=g.getContext("2d"),z=g.width,A=g.height;m.drawImage(this._canvas,0,this._canvas.height-A,z,A,0,0,z,A);}}};\nt.prototype.createViewStateManager=function(e,g){var i=new V();i._setNodeHierarchy(e).setShouldTrackVisibilityChanges(g);this._viewStateManagers.push(i);return i;};\nt.prototype.destroyViewStateManager=function(e){var i=this._viewStateManagers.indexOf(e);if(i>=0){this._viewStateManagers.splice(i,1)[0].destroy();}return this;};\nt.prototype.showDebugInfo=function(e){this._viewports.forEach(function(g){g.control.setShowDebugInfo(e);});return this;};\nt.prototype.getApi=function(e){switch(e){case G.LegacyDvl:return this._dvl;default:return null;}};\nt.prototype.collectGarbage=function(){this._cleanupDvlSceneData();this._cleanupSourceData();return this;};\nt.prototype._onlocalizationChanged=function(e){if(e.getParameter("changes").language){c(this._dvl.Core.SetLocale(sap.ui.getCore().getConfiguration().getLanguageTag()));}};\nt.prototype.setDecryptionHandler=function(e){this._dvl.Client.setDecryptionHandler(e);return this;};\nt.prototype.setAuthorizationHandler=function(e){this._authorizationHandler=e;return this;};\nt.prototype.getDecryptionHandler=function(){return this._dvl.Client.getDecryptionHandler();};\nt.prototype.attachSceneLoadingFinished=function(e,g,i){return this.attachEvent("sceneLoadingFinished",e,g,i);};\nt.prototype.detachSceneLoadingFinished=function(e,g){return this.detachEvent("sceneLoadingFinished",e,g);};\nt.prototype.fireSceneLoadingFinished=function(e,g,i){return this.fireEvent("sceneLoadingFinished",e,g,i);};\nt.prototype.attachSceneLoadingProgress=function(e,g,i){return this.attachEvent("sceneLoadingProgress",e,g,i);};\nt.prototype.detachSceneLoadingProgress=function(e,g){return this.detachEvent("sceneLoadingProgress",e,g);};\nt.prototype.fireSceneLoadingProgress=function(e,g,i){return this.fireEvent("sceneLoadingProgress",e,g,i);};\nt.prototype.attachSceneLoadingStarted=function(e,g,i){return this.attachEvent("sceneLoadingStarted",e,g,i);};\nt.prototype.detachSceneLoadingStarted=function(e,g){return this.detachEvent("sceneLoadingStarted",e,g);};\nt.prototype.fireSceneLoadingStarted=function(e,g,i){return this.fireEvent("sceneLoadingStarted",e,g,i);};\nreturn t;});\n'
},"sap/ui/vk/library-preload"
);
//# sourceMappingURL=library-preload.js.map