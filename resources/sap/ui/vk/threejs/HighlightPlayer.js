/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/Object","./thirdparty/three","../HighlightDisplayState"],function(B,t,H){"use strict";var a=B.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=H.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map();}});a.prototype.reset=function(v,s){this.stop();this._highlightsNodesMap.clear();this._state=H.stopped;if(v&&s){var h=v.getHighlightIdNodesMap();var b=this;h.forEach(function(c,k){var d=s.getHighlight(k);b.addHighlights(d,c);});}return this;};a.prototype.setViewStateManager=function(v){this._viewStateManager=v;};a.prototype.addHighlights=function(h,n){if(!h||!n||!n.length){return;}var g=function(n,b){if(!n||!n.length){return;}for(var i=0;i<n.length;i++){var c=n[i];if(c.type==="Mesh"){b.push(c);}g(c.children,b);}};var m=[];g(n,m);if(m.length){this._highlightsNodesMap.set(h,m);}};a.prototype.start=function(b){if(this._state===H.pausing){this._startTime=b-this._timeElapsed;}else{this._startTime=b;this._timeElapsed=0;}this._state=H.playing;};a.prototype.play=function(b){if(this._state!==H.playing){return false;}this._timeElapsed=b-this._startTime;var c=this;var i=true;var s=false;this._highlightsNodesMap.forEach(function(n,h){var r=h.getColour(c._timeElapsed/1000.0);var d;if(r!==undefined){for(d=0;d<n.length;d++){if(!s&&n[d].userData.highlightingColor!==r.colour){s=true;}n[d].userData.highlightingColor=r.colour;n[d]._vkUpdateMaterialColor();}if(!r.isCompleted){i=false;}}r=h.getOpacity(c._timeElapsed/1000.0);if(r!==undefined){if(c._viewStateManager&&r.opacity>0&&h.isFadeOut()){c._viewStateManager.setVisibilityState(n,true,false);}for(d=0;d<n.length;d++){if(!s&&n[d].userData.opacity!==r.opacity){s=true;}n[d].userData.opacity=r.opacity;n[d]._vkUpdateMaterialOpacity();}if(c._viewStateManager&&r.opacity===undefined&&h.getLastOpacity()<0.000001&&h.isFadeOut()){c._viewStateManager.setVisibilityState(n,false,false);}if(!r.isCompleted){i=false;}}});if(i){this._state=H.stopped;}return!i||s;};a.prototype.stop=function(b){this._timeElapsed=0;this._startTime=0;var c=this;this._highlightsNodesMap.forEach(function(n,h){for(var d=0;d<n.length;d++){delete n[d].userData.highlightingColor;n[d]._vkUpdateMaterialColor();delete n[d].userData.opacity;n[d]._vkUpdateMaterialOpacity();if(c._viewStateManager&&h.isFadeOut()){c._viewStateManager.setVisibilityState(n,false,false);}}});this._state=H.stopped;return this;};a.prototype.pause=function(b){if(this._state===H.stopped){return this;}this._timeElapsed=b-this._startTime;this._state=H.pausing;return this;};return a;});
