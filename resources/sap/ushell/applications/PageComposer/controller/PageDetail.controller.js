// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["./BaseController","./Page","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/base/strings/formatMessage"],function(B,P,J,M,f){"use strict";return B.extend("sap.ushell.applications.PageComposer.controller.PageDetail",{onInit:function(){var r=this.getRouter();r.getRoute("view").attachPatternMatched(this._onPageMatched,this);this.setModel(new J({page:{},editMode:false,transportSupported:this.getOwnerComponent().isTransportSupported()}));this.getView().addEventDelegate({onBeforeHide:this.onRouteLeave.bind(this)});this.Page.init(this);},onExit:function(){B.prototype.onExit.apply(this,arguments);this.Page.exit();},Page:P,formatMessage:f,_onPageMatched:function(e){var a=e.getParameter("arguments");var p=decodeURIComponent(a.pageId);this.getView().setBusy(true);this.getModel().setProperty("/page",{});this._loadPage(p).then(function(o){this.getModel().setProperty("/page",o);this.Page.init(this);if(!this.getModel().getProperty("/page/code")){this.getPageRepository().getRoles(p).then(function(r){var R=r.map(function(b){return b.id;});this._resetRolesModel({available:R});this.Page.collectMessages();}.bind(this));}}.bind(this)).catch(function(){this.navigateToErrorPage(p);}.bind(this)).finally(function(){this.getView().setBusy(false);}.bind(this));},_navigateToEdit:function(p){this.getRouter().navTo("edit",{pageId:encodeURIComponent(p)});},_deletePage:function(e){var d=e.getSource().getParent(),t=e.transportId||"",p=this.getModel().getProperty("/page/id"),s=this.getResourceBundle().getText("Message.SuccessDeletePage");return this.getPageRepository().deletePage(p,t).then(function(){this.navigateBack();M.show(s,{closeOnBrowserNavigation:false});d.close();}.bind(this)).catch(this.handleBackendError.bind(this));},onEdit:function(){this._navigateToEdit(this.getModel().getProperty("/page/id"));},onDelete:function(){var p=this.getModel().getProperty("/page");this.checkShowDeleteDialog(p,this._deletePage.bind(this));},onCopy:function(){var p=this.getModel().getProperty("/page");this.showCopyDialog(p,function(a){sap.ushell.Container.getServiceAsync("PageReferencing").then(function(b){return b.createReferencePage(a);}).then(function(r){return this.getPageRepository().copyPage(r);}.bind(this)).then(function(){this._navigateToEdit(a.targetId);M.show(this.getResourceBundle().getText("Message.PageCreated"),{closeOnBrowserNavigation:false});}.bind(this)).catch(this.handleBackendError.bind(this));}.bind(this));},onErrorMessageClicked:function(){var p=this.getModel().getProperty("/page");var e=this.formatAssignmentDetailsMessage(p.code);this.showMessageBoxWarning(p.message,e,false);}});});
