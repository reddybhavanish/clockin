// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/format/DateFormat","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter"],function(D,C,F,a,S){"use strict";return C.extend("sap.ushell.applications.PageComposer.controller.ViewSettingsDialogSapDelivered",{constructor:function(P){this.PageOverviewController=P;},handleSapDeliveredDialogConfirm:function(e){var p=e.getParameters(),t=this.PageOverviewController.byId(this.PageOverviewController.sCurrentTableId),b=t.getBinding("items"),s=this.getSorters(p),f=this.getFilters(p);b.sort(s);this.PageOverviewController.mViewSettingsFilters[this.PageOverviewController.sCurrentTableId]=f;this.PageOverviewController._applyCombinedFilters();this.PageOverviewController.byId(this.PageOverviewController.sCurrentTableId.slice(0,-5)+"InfoFilterBar").setVisible(!!Object.keys(f).length);this.PageOverviewController.byId(this.PageOverviewController.sCurrentTableId.slice(0,-5)+"InfoFilterLabel").setText(p.filterString);},getSorters:function(p){var s=[],g=p.groupItem;if(g){var G=g.getKey(),f;switch(G){case"createdOnSapDelivered":case"modifiedOn":f=function(c){var o=D.getInstance({style:"medium"}),d=c.getProperty(G),b=o.format(d);return{key:b,text:b};};break;default:f=function(c){var n=c.getProperty(G);return{key:n,text:n};};}s.push(new S(G,p.groupDescending,f));}if(p.sortItem){s.push(new S(p.sortItem.getKey(),p.sortDescending));}else{s.push(new S("id",true));}return s;},getFilters:function(p){var f={};p.filterItems.forEach(function(i){var P,o,v,V;if(i.getKey()==="createdOn"||i.getKey()==="modifiedOn"){var d=i.getCustomControl();P=i.getKey();o=a.BT;v=d.getDateValue();V=d.getSecondDateValue();if(P==="createdOn"){this._createdOnFromFilter=v;this._createdOnToFilter=V;}else{this._changedOnFromFilter=v;this._changedOnToFilter=V;}}else{var s=i.getKey().split("___");P=s[0];o=s[1];v=s[2];V=s[3];}if(!f[P]){f[P]=[];}f[P].push(new F(P,o,v,V));}.bind(this));return f;},handleSapDeliveredDateRangeSelectionChanged:function(e){var p=e.getParameters(),v=p.id==="SapDeliveredCreatedOnDateRangeSelection"?sap.ui.getCore().byId("SapDeliveredCreatedOnFilter"):sap.ui.getCore().byId("SapDeliveredChangedOnFilter");if(p.from){v.setFilterCount(1);v.setSelected(true);}else{v.setFilterCount(0);v.setSelected(false);}}});});
