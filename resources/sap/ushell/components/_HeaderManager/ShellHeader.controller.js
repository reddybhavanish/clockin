// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/ui/shell/OverflowListItem"],function(m,C,D,J,M,A,a,E,O){"use strict";var L=m.ListType;var F=O.prototype.FloatingNumberType;return C.extend("sap.ushell.components._HeaderManager.ShellHeader",{shellUpdateAggItem:function(i,c){return sap.ui.getCore().byId(c.getObject());},pressNavBackButton:function(){E.emit("showMeArea",false);A.service().navigateBack();},pressEndItemsOverflow:function(e){var p=sap.ui.getCore().byId("headEndItemsOverflow"),o;if(!p){p=sap.ui.xmlfragment("sap.ushell.renderers.fiori2.HeadEndItemsOverflowPopover",this);var P=sap.ui.getCore().byId("headEndItemsOverflowList");P.enhanceAccessibilityState=function(b,c){if(b.getFloatingNumberType()!==F.None){c.describedby=b._oAriaDescribedbyText.getId();}return c;};o=new J({headEndItems:a.last("/core/shellHeader/headEndItems")});p.setModel(o);}if(p.isOpen()){p.close();}else{if(sap.ui.getCore().byId("shellNotificationsPopover")){E.emit("showNotifications",false);}p.openBy(e.getSource());}},headEndItemsOverflowItemFactory:function(i,c){var s=sap.ui.getCore().byId(c.getObject());var f=s.getBindingPath("floatingNumber");var o=new O({id:i+"-"+s.getId(),icon:s.getIcon(),iconInset:true,title:s.getText(),type:L.Active,floatingNumber:(f?{path:f}:undefined),floatingNumberType:s.getFloatingNumberType(),press:function(){if(s){s.firePress();}var p=sap.ui.getCore().byId("headEndItemsOverflow");if(p.isOpen()){p.close();}}});if(f){o.setModel(s.getModel());}return o;},destroyHeadEndItemsOverflow:function(e){e.getSource().destroy();},isHeadEndItemInOverflow:function(b){return b!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(b);},isHeadEndItemNotInOverflow:function(b){var o=this.isHeadEndItemOverflow();var s=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;if(b==="ENDITEMSOVERFLOWBTN"){return o;}if(!o){return true;}if(["MEAREAHEADERBUTTON","BACKBTN"].indexOf(b)>-1){return true;}if(s==="Phone"){return false;}if(["SF","FLOATINGCONTAINERBUTTON"].indexOf(b)>-1){return true;}if(s==="Desktop"&&b==="COPILOTBTN"){return true;}return false;},isHeadEndItemOverflow:function(){var n=0,e,b=a.last("/core/shellHeader/headEndItems");if(b.indexOf("endItemsOverflowBtn")===-1){return false;}var c=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;var d=3;if(c==="Phone"){d=1;}for(var i=0;i<b.length;i++){e=sap.ui.getCore().byId(b[i]);if(e&&e.getVisible()){n++;}}if(sap.ui.getCore().byId("endItemsOverflowBtn").getVisible()){return n>d+1;}return n>d;},handleNavigationMenuItemPress:function(e){var d=e.getSource().getCustomData();if(d&&d.length>0){for(var i=0;i<d.length;i++){if(d[i].getKey()==="intent"){var l=d[i].getValue();if(l&&l[0]==="#"){this.navigateFromShellApplicationNavigationMenu(l);return;}}}}},navigateFromShellApplicationNavigationMenu:function(i){if(window.hasher.getHash()!==i.substr(1)){E.emit("centerViewPort",Date.now());window.hasher.setHash(i);}var s=sap.ui.getCore().byId("shellAppTitle");if(s){s.close();}},handleUserSettingsPress:function(){E.emit("openUserSettings",Date.now());},handleAppFinderPress:function(){M.start("FLP:AppFinderLoadingStartToEnd","AppFinderLoadingStartToEnd","FLP");sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(c){c.toExternal({target:{semanticObject:"Shell",action:"appfinder"}});});}});});
