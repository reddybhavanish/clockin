// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/HTML","sap/ushell/ui/appfinder/AppBox","sap/ushell/ui/appfinder/PinButton","sap/ushell/ui/launchpad/CatalogEntryContainer","sap/ushell/ui/launchpad/CatalogsContainer","sap/ushell/ui/launchpad/Panel","sap/ushell/ui/launchpad/Tile","sap/ui/thirdparty/jquery","sap/ui/performance/Measurement","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/m/List","sap/m/StandardListItem","sap/ui/Device","sap/m/MessagePage","sap/m/Page","sap/m/BusyIndicator","sap/m/SplitApp","sap/ushell/Config","sap/ushell/components/appfinder/VisualizationOrganizerHelper"],function(H,A,P,C,a,b,T,q,M,r,c,L,S,D,d,f,B,g,h,V){"use strict";sap.ui.jsview("sap.ushell.components.appfinder.Catalog",{oController:null,oVisualizationOrganizerHelper:V.getInstance(),formatPinButtonTooltip:function(G,o){var t;if(o.path){var i=G?Array.prototype.indexOf.call(G,o.id):-1;t=i!==-1?"removeAssociatedTileFromContextGroup":"addAssociatedTileToContextGroup";return r.i18n.getText(t,o.title);}t=G&&G.length?"EasyAccessMenu_PinButton_Toggled_Tooltip":"EasyAccessMenu_PinButton_UnToggled_Tooltip";return r.i18n.getText(t);},formatPinButtonSelectState:function(e,i,G,s){if(G){var j=e?Array.prototype.indexOf.call(e,s):-1;return j!==-1;}return!!i;},createContent:function(o){var t=this;this.oViewData=this.getViewData();this.parentComponent=this.oViewData.parentComponent;var m=this.parentComponent.getModel();this.setModel(m);this.setModel(this.oViewData.subHeaderModel,"subHeaderModel");this.oVisualizationOrganizerHelper.setModel(m);this.oController=o;function i(e){return((e!==null)&&(e==="1x2"||e==="2x2"))||false;}function j(v){return parseInt(v,10)||0;}var k=new P({icon:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonIcon},type:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonType},selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonSelectState.bind(this)},tooltip:{parts:["associatedGroups","/groupContext","id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonTooltip.bind(this)},press:[this.oVisualizationOrganizerHelper.onTilePinButtonClick,this]});var l=new P({icon:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonIcon},type:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonType},selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonSelectState.bind(this)},tooltip:{parts:["associatedGroups","/groupContext","id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonTooltip.bind(this)},press:[this.oVisualizationOrganizerHelper.onTilePinButtonClick,this]});this.oAppBoxesTemplate=new A({title:"{title}",icon:"{icon}",subtitle:"{subtitle}",url:"{url}",navigationMode:"{navigationMode}",pinButton:l,press:[o.onAppBoxPressed,o]});var E=h.last("/core/shell/enablePersonalization");l.setVisible(E);l.addCustomData(new c({key:"tabindex",value:"-1",writeToDom:true}));l.addStyleClass("sapUshellPinButton");k.setVisible(E);k.addCustomData(new c({key:"tabindex",value:"-1",writeToDom:true}));k.addStyleClass("sapUshellPinButton");this.oTileTemplate=new T({tileViews:{path:"content",factory:function(I,e){return e.getObject();}},"long":{path:"size",formatter:i},index:{path:"id",formatter:j},tileCatalogId:"{id}",pinButton:k,press:[o.catalogTilePress,o],afterRendering:o.onTileAfterRendering});this.oCatalogSelect=new L("catalogSelect",{visible:"{/enableCatalogSelection}",name:"Browse",rememberSelections:true,mode:"SingleSelectMaster",items:{path:"/masterCatalogs",template:new S({type:"Active",title:"{title}",tooltip:"{title}"})},showNoData:false,itemPress:[o._handleCatalogListItemPress,o],selectionChange:[o._handleCatalogListItemPress,o]});this.getCatalogSelect=function(){return this.oCatalogSelect;};var n=this.oCatalogSelect.onAfterRendering;if(D.system.desktop){this.oCatalogSelect.addEventDelegate({onsaptabnext:function(v){try{v.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipforward:function(v){try{v.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipback:function(v){try{v.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);var G=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(G.getVisible()){G.focus();}else{sap.ushell.components.ComponentKeysHandler.appFinderFocusMenuButtons(v);}}catch(e){}}});}if(m.getProperty("/enableHelp")){this.oCatalogSelect.addStyleClass("help-id-catalogCategorySelect");}this.setCategoryFilterSelection=function(e,v){var G=t.getCatalogSelect(),I=G.getItems(),J=e,K=0;if(!J||J===""){J=r.i18n.getText("all");}I.forEach(function(N,O){if(N.getTitle()===J){K=O;G.setSelectedItem(N);}});if(I.length!==0&&v){I[K].focus();}};this.oCatalogSelect.onAfterRendering=function(){var e=t.oController.categoryFilter||r.i18n.getText("all");t.setCategoryFilterSelection(e);if(n){n.apply(this,arguments);}if(!this.getSelectedItem()){this.setSelectedItem(this.getItems()[0]);}setTimeout(function(){var v=q("#catalog-button, #userMenu-button, #sapMenu-button").filter("[tabindex=0]");if(v.length){v.eq(0).focus();}else{q("#catalog-button").focus();}},0);};var p=this.oCatalogSelect._onAfterRenderingPopover;this.oCatalogSelect._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false);}if(p){p.apply(this,arguments);}};var s=sap.ui.getCore().getEventBus(),u,U=function(){this.splitApp.toMaster("catalogSelect","show");if(!D.system.phone){u=this._calculateDetailPageId();if(u!==this.splitApp.getCurrentDetailPage().getId()){this.splitApp.toDetail(u);}}};s.subscribe("launchpad","catalogContentLoaded",function(){setTimeout(U.bind(this),500);},this);s.subscribe("launchpad","afterCatalogSegment",U,this);var w=new H("sapUshellCatalogAccessibilityTileText",{content:"<div style='height: 0px; width: 0px; overflow: hidden; float: left;'>"+r.i18n.getText("tile")+"</div>"});var x=new C({header:"{title}",customTilesContainer:{path:"customTiles",template:this.oTileTemplate,templateShareable:true},appBoxesContainer:{path:"appBoxes",template:this.oAppBoxesTemplate,templateShareable:true}});this.oMessagePage=new d({visible:true,showHeader:false,text:r.i18n.getText("EasyAccessMenu_NoAppsToDisplayMessagePage_Text"),description:""});this.oCatalogsContainer=new a("catalogTiles",{categoryFilter:"{/categoryFilter}",catalogs:{path:"/catalogs",templateShareable:true,template:x},busy:true});this.oCatalogsContainer.addStyleClass("sapUshellCatalogTileContainer");this.oCatalogsContainer.addEventDelegate({onsaptabprevious:function(e){var v=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader"),G=q(e.srcControl.getDomRef());if(v.getVisible()&&!v.getPressed()&&!G.hasClass("sapUshellPinButton")){e.preventDefault();var I=sap.ui.getCore().byId("appFinderSearch");I.focus();}},onsapskipback:function(e){var v=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(v.getVisible()&&!v.getPressed()){e.preventDefault();v.focus();}}});this.oCatalogsContainer.onAfterRendering=function(){var e=sap.ui.getCore().byId("catalogTilesDetailedPage");if(!this.getBusy()){e.setBusy(false);M.end("FLP:AppFinderLoadingStartToEnd");}else{e.setBusy(true);}q("#catalogTilesDetailedPage-cont").scroll(function(){var v=sap.ui.getCore().byId("catalogTilesDetailedPage"),G=v.getScrollDelegate(),I=G.getScrollTop(),J=G.getMaxScrollTop();if(J-I<=30+3*t.oController.PagingManager.getTileHeight()&&t.oController.bIsInProcess===false){t.oController.bIsInProcess=true;t.oController.allocateNextPage();setTimeout(function(){t.oController.bIsInProcess=false;},0);}});};this.wrapCatalogsContainerInDetailPage=function(e,I){var v=new f(I,{showHeader:false,showFooter:false,showNavButton:false,content:[new b({translucent:true,content:e}).addStyleClass("sapUshellCatalogPage")]});return v;};this.getCatalogContainer=function(){return this.oCatalogsContainer;};new f({showHeader:false,showFooter:false,showNavButton:false,content:[new b({translucent:true,content:[w,this.getCatalogContainer()]}).addStyleClass("sapUshellCatalogPage")]});var y=this.wrapCatalogsContainerInDetailPage([w,this.getCatalogContainer()],"catalogTilesDetailedPage"),z=new f("catalogMessagePage",{showHeader:false,showFooter:false,showNavButton:false,content:[this.oMessagePage]});var F=new B("catalogSelectBusyIndicator",{size:"1rem"});this.splitApp=new g("catalogViewMasterDetail",{masterPages:[F,this.oCatalogSelect],detailPages:[y,z]});document.toSearch=function(){this.splitApp.toDetail("catalogTilesSearchPage");}.bind(this);document.toDetail=function(){this.splitApp.toDetail("catalogTilesDetailedPage");}.bind(this);document.toMessage=function(){this.splitApp.toDetail("catalogMessagePage");}.bind(this);return this.splitApp;},_calculateDetailPageId:function(){var s=this.getModel("subHeaderModel");var e=s.getProperty("/search/searchMode");var t=s.getProperty("/tag/tagMode");var n=!!this.getModel().getProperty("/catalogsNoDataText");var i;if(e||t){i=this.getController().bSearchResults?"catalogTilesDetailedPage":"catalogMessagePage";}else if(n){i="catalogMessagePage";}else{i="catalogTilesDetailedPage";}return i;},getControllerName:function(){return"sap.ushell.components.appfinder.Catalog";}});});
