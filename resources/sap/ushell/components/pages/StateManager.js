// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define([],function(){"use strict";var S={};S.init=function(p,a){this.oPagesRuntimeNavContainer=p;this.oPagesNavContainer=a;this._oURLParsingService=sap.ushell.Container.getServiceAsync("URLParsing");this.oPagesRuntimeNavContainer.attachNavigate(this._onErrorPageNavigated,this);this.oPagesNavContainer.attachNavigate(this._onPageNavigated,this);this._onTabNavigatedBind=this._onTabNavigated.bind(this);document.addEventListener("visibilitychange",this._onTabNavigatedBind);this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventBus.subscribe("sap.ushell","navigated",this._onShellNavigated,this);};S._onEnableRequests=function(c,e,d){if(!d||d.active===undefined){return;}this._setCurrentPageVisibility(d.active);};S._setCurrentPageVisibility=function(v,r,n){if(this.oPagesRuntimeNavContainer.getCurrentPage().isA("sap.m.MessagePage")&&!n){return;}var c=this.oPagesNavContainer.getCurrentPage();this._setPageVisibility(c,v,r);};S._setPageVisibility=function(p,v,r){if(!p){return;}this._visitVisualizations(p,function(a){a.setActive(v,r);});};S._visitVisualizations=function(p,v){if(!v){return;}p.getContent()[0].getAggregation("sections").forEach(function(s){s.getAggregation("visualizations").forEach(v);});};S._onShellNavigated=function(){return this._oURLParsingService.then(function(u){var h=u.parseShellHash(window.hasher.getHash());if((h.semanticObject==="Shell"&&h.action==="home")||(h.semanticObject==="Launchpad"&&h.action==="openFLPPage")){this._setCurrentPageVisibility(true,true);}else{this._setCurrentPageVisibility(false,false);}}.bind(this));};S._onTabNavigated=function(){return this._oURLParsingService.then(function(u){var h=u.parseShellHash(window.hasher.getHash());if((h.semanticObject==="Shell"&&h.action==="home")||(h.semanticObject==="Launchpad"&&h.action==="openFLPPage")){this._setCurrentPageVisibility(!document.hidden);}}.bind(this));};S._onPageNavigated=function(e){var p=e.getParameters();this._setPageVisibility(p.from,false,false);this._setPageVisibility(p.to,true,true);};S._onErrorPageNavigated=function(e){var t=e.getParameter("to");this._setCurrentPageVisibility(!t.isA("sap.m.MessagePage"),undefined,true);};S.exit=function(){this.oEventBus.unsubscribe("sap.ushell","navigated",this._onPageNavigated,this);document.removeEventListener("visibilitychange",this._onTabNavigatedBind);this.oPagesNavContainer.detachNavigate(this._onPageNavigated,this);this.oPagesRuntimeNavContainer.detachNavigate(this._onErrorPageNavigated,this);this.oEventBus.unsubscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);};return S;});
