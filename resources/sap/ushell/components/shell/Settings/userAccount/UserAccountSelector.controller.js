// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/base/Log","sap/ushell/Config","sap/ushell/resources"],function(C,J,L,a,r){"use strict";return C.extend("sap.ushell.components.shell.Settings.userAccount.UserAccountSelector",{onInit:function(){var s=sap.ushell.Container.getRenderer("fiori2").getShellConfig(),e=s.enableUserImgConsent;this.imgConsentEnabled=e||false;this.oUser=sap.ushell.Container.getUser();var R=r.getTranslationModel();var c=this.getConfigurationModel();this.getView().setModel(R,"i18n");this.getView().setModel(c,"config");this.oUser.attachOnSetImage(function(){var p=a.last("/core/shell/model/userImage/personPlaceHolder"),P="sap-icon://person-placeholder";c.setProperty("/icon",p||P);});},getConfigurationModel:function(){var m=new J({}),u=sap.ushell.Container.getUser(),i=u.getImage()?a.last("/core/shell/model/userImage/personPlaceHolder"):"sap-icon://person-placeholder";m.setData({icon:i,name:u.getFullName(),mail:u.getEmail(),server:window.location.host,imgConsentEnabled:this.imgConsentEnabled,isImageConsentForUser:u.getImageConsent()});return m;},onCancel:function(){if(this.imgConsentEnabled){this.getView().getModel("config").setProperty("/isImageConsentForUser",this.oUser.getImageConsent());}},onSave:function(){if(this.imgConsentEnabled){return this.onSaveUserImgConsent();}return Promise.resolve();},onSaveUserImgConsent:function(){var u=this.oUser,o=u.getImageConsent(),m=this.getView().getModel("config"),c=m.getProperty("/isImageConsentForUser"),U;if(o!==c){u.setImageConsent(c);return new Promise(function(b,d){U=sap.ushell.Container.getService("UserInfo").updateUserPreferences(u);U.done(function(){u.resetChangedProperty("isImageConsent");b();});U.fail(function(e){u.setImageConsent(o);u.resetChangedProperty("isImageConsent");m.setProperty("/isImageConsentForUser",o);L.error(e);d(e);});});}return Promise.resolve();},termsOfUserPress:function(){var t=this.getView().byId("termsOfUseTextFlexBox"),b=this.getView().byId("termsOfUseLink"),i=t.getVisible();t.setVisible(!i);b.setText(r.i18n.getText(i?"userImageConsentDialogShowTermsOfUse":"userImageConsentDialogHideTermsOfUse"));}});});
