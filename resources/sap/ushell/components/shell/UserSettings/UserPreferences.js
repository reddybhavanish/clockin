// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/ushell/components/SharedComponentUtils","sap/ushell/Config","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/utils"],function(r,s,C,q,L,u){"use strict";function _(){return sap.ushell.Container.getRenderer("fiori2");}function G(v,h,i,j,t,o,k,l,m,n,p){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId(v)){if(i==="xml"){this.view=sap.ui.xmlview(v,h);}else{this.view=sap.ui.jsview(v,h);}}return this.view;};return{entryHelpID:j,title:t,valueResult:null,onSave:o?o.bind(this):function(){if(this.getView().getController().onSave){return this.getView().getController().onSave();}}.bind(this),onCancel:k?k.bind(this):function(){if(this.getView().getController().onCancel){return this.getView().getController().onCancel();}}.bind(this),contentFunc:l?l.bind(this):function(){if(this.getView().getController().getContent){return this.getView().getController().getContent();}}.bind(this),valueArgument:m?m.bind(this):function(){var w=new q.Deferred(),x=this;setTimeout(function(){if(x.getView().getController().getValue){x.getView().getController().getValue().done(function(y){w.resolve(y);});}},0);return w.promise();}.bind(this),contentResult:null,icon:n,defaultVisibility:p};}function c(m){return function(){return this.getView().getController()[m]();};}function a(p){var E={entryHelpID:p.entryHelpId,title:r.i18n.getText(p.i18nTitleKey),editable:true,valueResult:null,contentResult:null,icon:p.icon,getView:function(){var h=p.viewType==="xml"?sap.ui.xmlview:sap.ui.jsview;var v=sap.ui.getCore().byId(p.viewId);if(!v){v=h(p.viewId,p.componentNamespace);}return v;}};E.valueArgument=c("getValue").bind(E);E.onSave=c("onSave").bind(E);E.onCancel=c("onCancel").bind(E);E.contentFunc=c("getContent").bind(E);return E;}function b(){return a({entryHelpId:"language",i18nTitleKey:"languageRegionTit",icon:"sap-icon://globe",viewId:"languageRegionSelector",componentNamespace:"sap.ushell.components.shell.UserSettings.LanguageRegionSelector"});}function U(){return a({entryHelpId:"UserActivitiesEntry",i18nTitleKey:"userActivities",icon:"sap-icon://laptop",viewId:"userActivitiesHandler",componentNamespace:"sap.ushell.components.shell.UserSettings.userActivitiesHandler"});}function S(){return a({entryHelpId:"spaces",i18nTitleKey:"spaces",icon:"sap-icon://home",viewId:"Spaces",viewType:"xml",componentNamespace:"sap.ushell.components.shell.UserSettings.Spaces"});}function d(){var o=_().getShellConfig();var h=o.enableUserImgConsent;var v=h?"userAccountSelector":"userAccountSetting";var i=h?"sap.ushell.components.shell.UserSettings.userAccount.UserAccountSelector":"sap.ushell.components.shell.UserSettings.userAccount.UserAccountSetting";return a({entryHelpId:"userAccountEntry",i18nTitleKey:"UserAccountFld",icon:"sap-icon://account",viewId:v,componentNamespace:i,viewType:"xml"});}function e(){var h=[],p=[];h.push(new d());var t=new G("userPrefThemeSelector","sap.ushell.components.shell.UserSettings.ThemeSelector","xml","themes",r.i18n.getText("Appearance"),function(){var i=this.getView().getController().onSave();i.done(function(){if(C.last("/core/home/enableTilesOpacity")){u.handleTilesOpacity();}});return i;},undefined,undefined,undefined,"sap-icon://palette");h.push(t);var j=new G("userPrefUsageAnalyticsSelector","sap.ushell.components.shell.UserSettings.UsageAnalyticsSelector","js","usageAnalytics",r.i18n.getText("usageAnalytics"),undefined,undefined,undefined,undefined);p.push(j);var k=new G("userProfilingView","sap.ushell.components.shell.UserSettings.UserProfiling","js","userProfiling",r.i18n.getText("userProfiling"),undefined,undefined,undefined,undefined,"sap-icon://user-settings",false);var E=C.last("/core/spaces/configurable");if(E){h.push(new S());}h.push(new b());var l=C.last("/core/shell/enableRecentActivity");if(l){h.push(new U());}h.push(k);if(C.last("/core/shell/model/enableNotifications")===true){var n=sap.ushell.Container.getService("Notifications")._getNotificationSettingsAvalability(),m;m=new G("notificationSettings","sap.ushell.components.shell.Notifications.Settings","js","notification",r.i18n.getText("notificationSettingsEntry_title"),undefined,undefined,undefined,undefined,"sap-icon://bell",false);h.push(m);n.done(function(v){if(v.settingsAvailable){m.visible=true;var w=C.last("/core/userPreferences/entries"),x;for(var i=0;i<w.length;i++){x=w[i];if(x.title===r.i18n.getText("notificationSettingsEntry_title")){x.visible=true;break;}}C.emit("/core/userPreferences/entries",w);}});}if(C.last("/core/shell/model/userDefaultParameters")){sap.ui.getCore().loadLibrary("sap.ui.comp",{async:true}).then(function(){var i=new G("defaultParametersSelector","sap.ushell.components.shell.UserSettings.DefaultParameters","js","defaultParameters",r.i18n.getText("defaultsValuesEntry"),undefined,undefined,undefined,undefined,undefined,false);var v=C.last("/core/userPreferences/entries");v.push(i);C.emit("/core/userPreferences/entries",v);});}var o=C.last("/core/home/enableHomePageSettings")&&!C.last("/core/spaces/enabled");if(o){h.push(g());}return{enableNewComponent:C.last("/core/userPreferences/enableNewComponent"),dialogTitle:r.i18n.getText("userSettings"),isDetailedEntryMode:false,activeEntryPath:null,entries:h,profiling:p};}function g(){var R=_(),o=r.i18n;var h;var E={title:o.getText("FlpSettings_entry_title"),entryHelpID:"flpSettingsEntry",valueArgument:function(){return q.Deferred().resolve(" ");},contentFunc:function(){var D=new q.Deferred();s.getEffectiveHomepageSetting("/core/home/homePageGroupDisplay","/core/home/enableHomePageSettings").then(function(i){h=sap.ui.xmlview("UserSettingsFLPSettingsView",{viewName:"sap.ushell.components.shell.UserSettings.FlpSettings",viewData:{initialDisplayMode:i||"scroll"}});D.resolve(h);});return D;},onSave:function(){var D=h.getController().onSave();var i=s.getPersonalizer("homePageGroupDisplay",R).setPersData(D);i.fail(function(j){L.error("Failed to save the anchor bar mode in personalization",j,"sap.ushell.components.flp.settings.FlpSettings");});C.emit("/core/home/homePageGroupDisplay",D);return q.Deferred().resolve();},onCancel:function(){return q.Deferred().resolve();},icon:"sap-icon://home"};return E;}function f(){var h=C.last("/core/userPreferences/entries");var D=e();D.entries=D.entries.concat(h);D.entries=_().reorderUserPrefEntries(D.entries);C.emit("/core/userPreferences",D);}return{setModel:f};});
