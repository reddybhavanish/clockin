//@ui5-bundle sap/ushell/components/tiles/cdm/applauncherdynamic/Component-preload.js
// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.predefine('sap/ushell/components/tiles/cdm/applauncherdynamic/Component',["sap/ui/core/UIComponent","sap/ui/core/library"],function(U,c){"use strict";var V=c.mvc.ViewType;return U.extend("sap.ushell.components.tiles.cdm.applauncherdynamic.Component",{metadata:{},createContent:function(){var C=this.getComponentData();var p=C.properties||{};var P=p.tilePersonalization||{};var i=p.indicatorDataSource;if(i&&i.path){P.serviceUrl=i.path;P.serviceRefreshInterval=i.refresh;}var s=C.startupParameters;if(s&&s["sap-system"]&&s["sap-system"][0]){P["sap-system"]=s["sap-system"][0];}if(P.serviceUrl&&P.serviceUrl.charAt(0)!=="/"&&p.dataSource&&p.dataSource.uri){var S=p.dataSource.uri;if(P["sap-system"]){if(S.charAt(S.length-1)==="/"){S=S.slice(0,S.length-1);}S+=";o="+P["sap-system"];}if(S.charAt(S.length-1)!=="/"){S+="/";}S+=P.serviceUrl;P.serviceUrl=S;}var t=sap.ui.view({type:V.JS,viewName:"sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile",viewData:{properties:p,configuration:P},async:true});t.loaded().then(function(v){this._oController=t.getController();this.tileRefresh();}.bind(this));return t;},tileSetVisualProperties:function(n){if(this._oController){this._oController.updateVisualPropertiesHandler(n);}},tileRefresh:function(){if(this._oController){this._oController.refreshHandler();}},tileSetVisible:function(i){if(this._oController){this._oController.visibleHandler(i);}},exit:function(){this._oController=null;}});});
sap.ui.predefine('sap/ushell/components/tiles/cdm/applauncherdynamic/DynamicTile.controller',["sap/ui/core/mvc/Controller","sap/ushell/components/tiles/utils","sap/ui/core/format/NumberFormat","sap/ushell/Config","sap/ushell/services/AppType","sap/ushell/utils/WindowUtils","sap/ui/thirdparty/datajs","sap/ui/thirdparty/URI","sap/ui/model/json/JSONModel","sap/m/library","sap/base/Log","sap/base/util/UriParameters"],function(C,u,N,a,A,W,O,U,J,m,L,b){"use strict";var G=m.GenericTileScope;return C.extend("sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile",{timer:null,_aDoableObject:{},oDataRequest:null,_getConfiguration:function(){var v=this.getView().getViewData(),c={},o,h;c.configuration=v.configuration;c.properties=v.properties;c.properties.info=c.properties.info||"";c.properties.number_value="...";c.properties.number_value_state="Neutral";c.properties.number_state_arrow="None";c.properties.number_factor="";c.properties.number_unit="";var s=c.configuration["sap-system"];var t=c.properties.targetURL;if(t&&s){o=sap.ushell.Container.getService("URLParsing");if(o.isIntentUrl(t)){h=o.parseShellHash(t);if(!h.params){h.params={};}h.params["sap-system"]=s;t="#"+o.constructShellHash(h);}else{t+=((t.indexOf("?")<0)?"?":"&")+"sap-system="+s;}c.properties.targetURL=t;}c.properties.sizeBehavior=a.last("/core/home/sizeBehavior");c.properties.wrappingType=a.last("/core/home/wrappingType");return c;},onInit:function(){var v=this.getView();var M=new J();M.setData(this._getConfiguration());v.setModel(M);this._aDoableObject=a.on("/core/home/sizeBehavior").do(function(s){M.setProperty("/properties/sizeBehavior",s);});},refreshHandler:function(){this.loadData(0);},visibleHandler:function(i){if(i){if(!this.oDataRequest){this.refreshHandler(this);}}else{this.stopRequests();}},updateVisualPropertiesHandler:function(n){var p=this.getView().getModel().getProperty("/properties");var c=false;if(typeof n.title!=="undefined"){p.title=n.title;c=true;}if(typeof n.subtitle!=="undefined"){p.subtitle=n.subtitle;c=true;}if(typeof n.icon!=="undefined"){p.icon=n.icon;c=true;}if(typeof n.targetURL!=="undefined"){p.targetURL=n.targetURL;c=true;}if(typeof n.info!=="undefined"){p.info=n.info;c=true;}if(c){this.getView().getModel().setProperty("/properties",p);}},stopRequests:function(){if(this.timer){clearTimeout(this.timer);}if(this.oDataRequest){try{this.oDataRequest.abort();}catch(e){L.warning(e.name,e.message);}}},onPress:function(e){if(e.getSource().getScope&&e.getSource().getScope()===G.Display){var t=this.getView().getModel().getProperty("/properties/targetURL"),T=this.getView().getModel().getProperty("/properties/title");if(!t){return;}else if(t[0]==="#"){hasher.setHash(t);}else{var l=a.last("/core/shell/enableRecentActivity")&&a.last("/core/shell/enableRecentActivityLogging");if(l){var r={title:T,appType:A.URL,url:t,appId:t};sap.ushell.Container.getRenderer("fiori2").logRecentActivity(r);}W.openURL(t,"_blank");}}},initUpdateDynamicData:function(){var v=this.getView(),s=v.getModel().getProperty("/configuration/serviceUrl"),S=v.getModel().getProperty("/configuration/serviceRefreshInterval");if(!S){S=0;}else if(S<10){L.warning("Refresh Interval "+S+" seconds for service URL "+s+" is less than 10 seconds, which is not supported. Increased to 10 seconds automatically.",null,"sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile.controller");S=10;}if(s){this.loadData(S);}},extractData:function(d){var n,k=["results","icon","title","number","numberUnit","info","infoState","infoStatus","targetParams","subtitle","stateArrow","numberState","numberDigits","numberFactor"];if(typeof d==="object"&&Object.keys(d).length===1){n=Object.keys(d)[0];if(Array.prototype.indexOf.call(k,n)===-1){return d[n];}}return d;},successHandleFn:function(r){var c=this.getView().getModel().getProperty("/configuration");var d=r;this.oDataRequest=undefined;if(typeof r==="object"){var e=new b(c.serviceUrl).get("$inlinecount");if(e&&e==="allpages"){d={number:r.__count};}else{d=this.extractData(d);}}else if(typeof r==="string"){d={number:r};}this.updatePropertiesHandler(d);},errorHandlerFn:function(M){var s=M&&M.message?M.message:M,r=u.getResourceBundleModel().getResourceBundle(),c=this.getView().getModel().getProperty("/configuration/serviceUrl");this.oDataRequest=undefined;if(s==="Request aborted"){jQuery.sap.log.info("Data request from service "+c+" was aborted",null,"sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile");}else{if(M.response){s+=" - "+M.response.statusCode+" "+M.response.statusText;}L.error("Failed to update data via service "+c+": "+s,null,"sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile");this.updatePropertiesHandler({number:"???",info:r.getText("dynamic_data.error")});}},loadData:function(s){return new Promise(function(r,c){var S,d,R,o,D=this.getView(),e=D.getModel().getProperty("/configuration/serviceUrl"),f,g;if(!e){r();return;}f=sap.ushell.Container.getService("ReferenceResolver");g=f.resolveUserDefaultParameters(e);g.then(function(h){if(h.defaultsWithoutValue&&h.defaultsWithoutValue.length>0){this.errorHandlerFn("The service URL contains User Default(s) with no set value: "+h.defaultsWithoutValue.join(", "),true);r();return;}if(h.ignoredReferences&&h.ignoredReferences.length>0){this.errorHandlerFn("The service URL contains invalid Reference(s): "+h.ignoredReferences.join(", "),false);r();return;}R={"Cache-Control":"no-cache, no-store, must-revalidate","Pragma":"no-cache","Expires":"0","Accept-Language":(sap.ui&&sap.ui.getCore().getConfiguration().getLanguage())||""};if(s>0){L.info("Wait "+s+" seconds before calling "+h.url+" again",null,"sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile.controller");this.timer=window.setTimeout(this.loadData.bind(this,s,false),(s*1000));}if(!this.oDataRequest){if(sap.ushell.Container){S=sap.ui.getCore().getConfiguration().getSAPLogonLanguage();if(S){R["sap-language"]=S;}d=sap.ushell.Container.getLogonSystem()?sap.ushell.Container.getLogonSystem().getClient():"";o=new U(h.url);if(d&&!o.protocol()){R["sap-client"]=d;}}if((S)&&(h.url.indexOf("sap-language=")===-1)){h.url=h.url+(h.url.indexOf("?")>=0?"&":"?")+"sap-language="+S;}this.oDataRequest=O.read({requestUri:h.url,headers:R},this.successHandleFn.bind(this),this.errorHandlerFn.bind(this));}r();}.bind(this));}.bind(this));},onExit:function(){this.stopRequests();this._aDoableObject.off();},addParamsToUrl:function(s,t){var p="",c=s.indexOf("?")!==-1,i;if(t&&t.length>0){for(i=0;i<t.length;i=i+1){p+=t[i];if(i<t.length-1){p+="&";}}}if(p.length>0){if(!c){s+="?";}else{s+="&";}s+=p;}return s;},_normalizeNumber:function(n,c,d,i){var e;if(isNaN(n)){e=n;}else{var o=N.getFloatInstance({maxFractionDigits:i});if(!d){var f=Math.abs(n);if(f>=1000000000){d="B";n/=1000000000;}else if(f>=1000000){d="M";n/=1000000;}else if(f>=1000){d="K";n/=1000;}}e=o.format(n);}var g=e;var h=g[c-1];c-=(h==="."||h===",")?1:0;g=g.substring(0,c);return{displayNumber:g,numberFactor:d};},updatePropertiesHandler:function(d){var e=u.getResourceBundleModel().getResourceBundle().getText("dynamic_data.error");var c=0,i,n,o,s,p=this.getView().getModel().getProperty("/properties"),f={title:d.title||p.title||"",subtitle:d.subtitle||p.subtitle||"",icon:d.icon||p.icon||"",targetURL:d.targetURL||p.targetURL||"",number_value:!isNaN(d.number)?d.number:"...",number_digits:d.numberDigits>=0?d.numberDigits:4,info:p.info==e?d.info||"":d.info||p.info||"",number_unit:d.numberUnit||p.number_unit||"",number_state_arrow:d.stateArrow||p.number_state_arrow||"None",number_value_state:d.numberState||p.number_value_state||"Neutral",number_factor:d.numberFactor||p.number_factor||""};var t=[];if(d.targetParams){t.push(d.targetParams);}if(d.results){for(i=0,n=d.results.length;i<n;i=i+1){o=d.results[i].number||0;if(typeof o==="string"){o=parseInt(o,10);}c=c+o;s=d.results[i].targetParams;if(s){t.push(s);}}f.number_value=c;}if(t.length>0){f.targetURL=this.addParamsToUrl(f.targetURL,t);}if(!isNaN(d.number)){if(typeof d.number==="string"){d.number=d.number.trim();}var S=this._shouldProcessDigits(d.number,d.numberDigits),g=f.icon?4:5;if(d.number&&d.number.length>=g||S){var h=this._normalizeNumber(d.number,g,d.numberFactor,d.numberDigits);f.number_factor=h.numberFactor;f.number_value=h.displayNumber;}else{var j=N.getFloatInstance({maxFractionDigits:g});f.number_value=j.format(d.number);}}if(f.number_value_state){switch(f.number_value_state){case"Positive":f.number_value_state="Good";break;case"Negative":f.number_value_state="Error";break;}}f.sizeBehavior=a.last("/core/home/sizeBehavior");this.getView().getModel().setProperty("/properties",f);},_shouldProcessDigits:function(d,D){var n;d=typeof(d)!=="string"?d.toString():d;if(d.indexOf(".")!==-1){n=d.split(".")[1].length;if(n>D){return true;}}return false;}});},true);
sap.ui.predefine('sap/ushell/components/tiles/cdm/applauncherdynamic/DynamicTile.view',["sap/m/GenericTile","sap/m/TileContent","sap/m/NumericContent","sap/m/library"],function(G,T,N,m){"use strict";var V=m.ValueColor;sap.ui.jsview("sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile",{getControllerName:function(){return"sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile";},createContent:function(c){this.setHeight("100%");this.setWidth("100%");if(this.getContent().length===1){return this.getContent()[0];}return new G({size:"Auto",header:"{/properties/title}",subheader:"{/properties/subtitle}",sizeBehavior:"{/properties/sizeBehavior}",wrappingType:"{/properties/wrappingType}",tileContent:[new T({size:"Auto",footer:"{/properties/info}",footerColor:{path:"/data/display_info_state",formatter:function(f){if(!V[f]){f=V.Neutral;}return f;}},unit:"{/properties/number_unit}",content:[new N({truncateValueTo:5,scale:"{/properties/number_factor}",value:"{/properties/number_value}",indicator:"{/properties/number_state_arrow}",valueColor:{path:"/properties/number_value_state",formatter:function(v){if(!V[v]){v=V.Neutral;}return v;}},icon:"{/properties/icon}",width:"100%"})]})],press:[c.onPress,c]});}});});
sap.ui.require.preload({
	"sap/ushell/components/tiles/cdm/applauncherdynamic/i18n/i18n.properties":'#\n#Tue May 19 07:07:05 UTC 2020\ntitle=Dynamic App Launcher\n',
	"sap/ushell/components/tiles/cdm/applauncherdynamic/manifest.json":'{"_version":"1.1.0","sap.flp":{"type":"tile","tileSize":"1x1"},"sap.app":{"id":"sap.ushell.components.tiles.cdm.applauncherdynamic","_version":"1.0.0","type":"component","applicationVersion":{"version":"1.0.0"},"title":"{{title}}","description":"","tags":{"keywords":[]},"ach":"CA-FLP-FE-COR"},"sap.ui":{"_version":"1.1.0","icons":{"icon":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true},"supportedThemes":["sap_hcb","sap_belize","sap_belize_plus"]},"sap.ui5":{"_version":"1.1.0","componentName":"sap.ushell.components.tiles.cdm.applauncherdynamic","dependencies":{"minUI5Version":"1.42","libs":{"sap.m":{}}},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","uri":"i18n/i18n.properties"}},"rootView":{"viewName":"sap.ushell.components.tiles.cdm.applauncherdynamic.DynamicTile","type":"JS"},"handleValidation":false}}'
},"sap/ushell/components/tiles/cdm/applauncherdynamic/Component-preload"
);
//# sourceMappingURL=Component-preload.js.map