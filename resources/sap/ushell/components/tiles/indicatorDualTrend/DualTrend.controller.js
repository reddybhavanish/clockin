// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/model/json/JSONModel","sap/suite/ui/microchart/AreaMicroChartPoint","sap/suite/ui/microchart/AreaMicroChartItem","sap/ushell/components/tiles/indicatorTileUtils/cache","sap/m/library","sap/ui/thirdparty/jquery"],function(J,A,c,d,m,q){"use strict";var S=m.Size;var V=m.ValueColor;var D=m.DeviationIndicator;var L=m.LoadState;sap.ui.controller("tiles.indicatorDualTrend.DualTrend",{logError:function(e){this.oDualTrendView.oGenericTile.setState(L.Failed);this.oDualTrendView.oGenericTile.setState(L.Failed);sap.ushell.components.tiles.indicatorTileUtils.util.logError(e);},formSelectStatement:function(o){var t=Object.keys(o);var f="";for(var i=0;i<t.length;i++){if((o[t[i]]!==undefined)&&(o.fullyFormedMeasure)){f+=","+o[t[i]];}}return f;},setThresholdValues:function(){var t=this;try{var T={};T.fullyFormedMeasure=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){switch(this.DEFINITION_DATA.EVALUATION.GOAL_TYPE){case"MI":T.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");T.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");T.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");T.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");T.fullyFormedMeasure+=t.formSelectStatement(T);break;case"MA":T.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");T.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");T.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");T.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");T.fullyFormedMeasure+=t.formSelectStatement(T);break;case"RA":T.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");T.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");T.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");T.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");T.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");T.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");T.fullyFormedMeasure+=t.formSelectStatement(T);break;}}else{T.criticalHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","FIXED");T.criticalLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","FIXED");T.warningHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","FIXED");T.warningLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","FIXED");T.targetValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","FIXED");T.trendValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","FIXED");}return T;}catch(e){t.logError(e);}},getTrendIndicator:function(t,v){var a=this;t=Number(t);try{var b=D.None;if(t>v){b=D.Down;}else if(t<v){b=D.Up;}return b;}catch(e){a.logError(e);}},getTile:function(){return this.oDualTrendView.oGenericTile;},getTrendColor:function(t){var a=this;try{var i=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;var r=V.Neutral;if(i==="MI"){if(t.criticalHighValue&&t.warningHighValue){t.criticalHighValue=Number(t.criticalHighValue);t.warningHighValue=Number(t.warningHighValue);if(this.CALCULATED_KPI_VALUE<t.warningHighValue){r=V.Good;}else if(this.CALCULATED_KPI_VALUE<=t.criticalHighValue){r=V.Critical;}else{r=V.Error;}}}else if(i==="MA"){if(t.criticalLowValue&&t.warningLowValue){t.criticalLowValue=Number(t.criticalLowValue);t.warningLowValue=Number(t.warningLowValue);if(this.CALCULATED_KPI_VALUE<t.criticalLowValue){r=V.Error;}else if(this.CALCULATED_KPI_VALUE<=t.warningLowValue){r=V.Critical;}else{r=V.Good;}}}else if(t.warningLowValue&&t.warningHighValue&&t.criticalLowValue&&t.criticalHighValue){t.criticalHighValue=Number(t.criticalHighValue);t.warningHighValue=Number(t.warningHighValue);t.warningLowValue=Number(t.warningLowValue);t.criticalLowValue=Number(t.criticalLowValue);if(this.CALCULATED_KPI_VALUE<t.criticalLowValue||this.CALCULATED_KPI_VALUE>t.criticalHighValue){r=V.Error;}else if((this.CALCULATED_KPI_VALUE>=t.criticalLowValue&&this.CALCULATED_KPI_VALUE<=t.warningLowValue)||(this.CALCULATED_KPI_VALUE>=t.warningHighValue&&this.CALCULATED_KPI_VALUE<=t.criticalHighValue)){r=V.Critical;}else{r=V.Good;}}return r;}catch(e){a.logError(e);}},_updateTileModel:function(n){var a=this.getTile().getModel().getData();q.extend(a,n);this.getTile().getModel().setData(a);},onAfterFinalEvaluation:function(){var t=this;var u=this.DEFINITION_DATA.EVALUATION.ODATA_URL;var E=this.DEFINITION_DATA.EVALUATION.ODATA_ENTITYSET;var M=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;var v=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(this.DEFINITION_DATA.EVALUATION_FILTERS,this.DEFINITION_DATA.ADDITIONAL_FILTERS);var f=this.DEFINITION_DATA.TILE_PROPERTIES.dimension;if(f==undefined){this.logError();return;}var g=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE,h=this.DEFINITION_DATA.EVALUATION_VALUES,Q;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){var j=M;switch(g){case"MI":t.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");if(t.sWarningHigh&&t.sCriticalHigh&&t.sTarget){j+=","+t.sWarningHigh+","+t.sCriticalHigh+","+t.sTarget;}break;case"MA":t.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");t.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");if(t.sWarningLow&&t.sCriticalLow&&t.sTarget){j+=","+t.sWarningLow+","+t.sCriticalLow+","+t.sTarget;}break;case"RA":t.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");t.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");t.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");t.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");t.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");t.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");if(t.sWarningLow&&t.sCriticalLow&&t.sTarget&&t.sWarningHigh&&t.sCriticalHigh){j+=","+t.sWarningLow+","+t.sCriticalLow+","+t.sTarget+","+t.sWarningHigh+","+t.sCriticalHigh;}break;}Q=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(t.oTileApi.url.addSystemToServiceUrl(u),E,j,f,v);}else{Q=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(t.oTileApi.url.addSystemToServiceUrl(u),E,M,f,v);}var k=d.getKpivalueById(t.oConfig.TILE_PROPERTIES.id);if(!k){if(Q){this.queryUriForTrendChart=Q.uri;t.writeData={};try{this.trendChartODataReadRef=Q.model.read(Q.uri,null,null,true,function(a){if(a&&a.results&&a.results.length){if(Q.unit[0]){t.unit=a.results[0][Q.unit[0].name];t.writeData.unit=Q.unit[0];t.writeData.unit.name=Q.unit[0].name;}t.queryUriResponseForTrendChart=a;f=sap.ushell.components.tiles.indicatorTileUtils.util.findTextPropertyForDimension(t.oTileApi.url.addSystemToServiceUrl(u),E,f);a.firstXlabel=a.results[0][f];a.lastXlabel=a.results[a.results.length-1][f];t.writeData.data=a;t.writeData.dimensionName=f;d.setKpivalueById(t.oConfig.TILE_PROPERTIES.id,t.writeData);var b=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(t.oConfig,t.system);t.oDualTrendView.oGenericTile.$().wrap("<a href ='"+b+"'/>");t.oDualTrendView.oGenericTile.setState(L.Loaded);_(a,t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE);}else{t.logError("no Response from QueryServiceUri");}},function(a){if(a&&a.response){t.logError("Data call failed");}});}catch(e){t.logError(e);}}else{t.logError();}v=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(t.DEFINITION_DATA.EVALUATION_FILTERS,t.DEFINITION_DATA.ADDITIONAL_FILTERS);Q=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(t.oTileApi.url.addSystemToServiceUrl(u),E,M,null,v);if(Q){t.QUERY_SERVICE_MODEL=Q.model;t.queryUriForKpiValue=Q.uri;t.numericODataReadRef=t.QUERY_SERVICE_MODEL.read(Q.uri,null,null,true,function(a){if(a&&a.results&&a.results.length){var s="";var l=a.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME];t.writeData.numericData=a;if(t.oConfig.EVALUATION.SCALING==-2){l*=100;}s=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(l),t.oConfig.EVALUATION.SCALING,t.oConfig.EVALUATION.DECIMAL_PRECISION);if(t.oConfig.EVALUATION.SCALING==-2){t._updateTileModel({scale:"%"});}var n=t.getTrendIndicator(t.setThresholdValues().trendValue,l);t._updateTileModel({value:s.toString(),valueColor:t.getTrendColor(t.setThresholdValues()),indicator:n});}else{fnError.call(t,"no Response from QueryServiceUri");}});}}else{try{if(k.unit!==undefined){t.unit=k.data.results[0][k.unit.name];}t.queryUriResponseForTrendChart=k.data;f=k.dimensionName;var l=k.numericData.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME];var n=t.getTrendIndicator(t.setThresholdValues().trendValue,k.data.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME]);var s=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(l),t.oConfig.EVALUATION.SCALING,t.oConfig.EVALUATION.DECIMAL_PRECISION);t.oDualTrendView.oGenericTile.setState(L.Loaded);_(k.data,t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE);t._updateTileModel({value:s.toString(),valueColor:t.getTrendColor(t.setThresholdValues()),indicator:n});}catch(e){t.logError(e);}}function _(o,p){var r=[];var w=[];var x=[];var y=[];var z=[];var B=[];var C=o.firstXlabel;var F,G,H,I,K;var N=o.lastXlabel;var O=Number(o.results[0][M]);var P=Number(o.results[o.results.length-1][M]);var i;for(i in o.results){o.results[i][f]=Number(i);o.results[i][M]=Number(o.results[i][M]);if(t.sWarningHigh){o.results[i][t.sWarningHigh]=Number(o.results[i][t.sWarningHigh]);}if(t.sCriticalHigh){o.results[i][t.sCriticalHigh]=Number(o.results[i][t.sCriticalHigh]);}if(t.sCriticalLow){o.results[i][t.sCriticalLow]=Number(o.results[i][t.sCriticalLow]);}if(t.sWarningLow){o.results[i][t.sWarningLow]=Number(o.results[i][t.sWarningLow]);}if(t.sTarget){o.results[i][t.sTarget]=Number(o.results[i][t.sTarget]);}if(t.sWarningHigh){x.push(o.results[i][t.sWarningHigh]);}if(t.sCriticalHigh){y.push(o.results[i][t.sCriticalHigh]);}if(t.sCriticalLow){z.push(o.results[i][t.sCriticalLow]);}if(t.sWarningLow){B.push(o.results[i][t.sWarningLow]);}r.push(o.results[i][f]);w.push(o.results[i][M]);}try{C=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(C);N=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(N);}catch(e){t.logError(e);}var R=Number(O);if(t.oConfig.EVALUATION.SCALING==-2){R*=100;}var T=Math.min.apply(Math,w);var U=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(R,t.oConfig.EVALUATION.SCALING,t.oConfig.EVALUATION.DECIMAL_PRECISION);if(t.oConfig.EVALUATION.SCALING==-2){U+=" %";}var W=U.toString();var X=Number(P);if(t.oConfig.EVALUATION.SCALING==-2){X*=100;}var Y=Math.max.apply(Math,w);var Z=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(X,t.oConfig.EVALUATION.SCALING,t.oConfig.EVALUATION.DECIMAL_PRECISION);if(t.oConfig.EVALUATION.SCALING==-2){Z+=" %";}var $=Z.toString();try{var a1=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.min.apply(Math,r));var b1=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.max.apply(Math,r));}catch(e){t.logError(e);}if(p=="MEASURE"){if(x.length!=0){t.firstwH=x[a1];t.lastwH=x[b1];}if(y.length!=0){t.firstcH=y[a1];t.lastcH=y[b1];}if(z.length!=0){t.firstcL=z[a1];t.lastcL=z[b1];}if(B.length!=0){t.firstwL=B[a1];t.lastwL=B[b1];}}var c1={width:"100%",height:"100%",unit:t.unit||"",chart:{color:"Neutral",data:o.results},size:"Auto",minXValue:a1,maxXValue:b1,minYValue:T,maxYValue:Y,firstXLabel:{label:C+"",color:"Neutral"},lastXLabel:{label:N+"",color:"Neutral"},firstYLabel:{label:W+"",color:"Neutral"},lastYLabel:{label:$+"",color:"Neutral"},minLabel:{},maxLabel:{}},d1;switch(g){case"MA":for(i in h){if(h[i].TYPE=="CL"){c1.minThreshold={color:"Error"};d1={};d1[f]="";d1[M]=Number(h[i].FIXED);t.cl=Number(h[i].FIXED);c1.minThreshold.data=(p=="MEASURE")?o.results:[d1];F=(p=="MEASURE")?t.sCriticalLow:M;}else if(h[i].TYPE=="WL"){c1.maxThreshold={color:"Good"};d1={};d1[f]="";d1[M]=Number(h[i].FIXED);c1.maxThreshold.data=(p=="MEASURE")?o.results:[d1];G=(p=="MEASURE")?t.sWarningLow:M;t.wl=Number(h[i].FIXED);}else if(h[i].TYPE=="TA"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);c1.target={color:"Neutral"};c1.target.data=(p=="MEASURE")?o.results:[d1];K=(p=="MEASURE")?t.sTarget:M;}}c1.innerMinThreshold={data:[]};c1.innerMaxThreshold={data:[]};if(p=="FIXED"){c1.firstYLabel.color=O<t.cl?"Error":((t.cl<=O)&&(O<=t.wl))?"Critical":(O>t.wl)?"Good":"Neutral";c1.lastYLabel.color=P<t.cl?"Error":((t.cl<=P)&&(P<=t.wl))?"Critical":(P>t.wl)?"Good":"Neutral";}else if(p=="MEASURE"&&t.firstwL&&t.lastwL&&t.firstcL&&t.lastcL){c1.firstYLabel.color=O<t.firstcL?"Error":((t.firstcL<=O)&&(O<=t.firstwL))?"Critical":(O>t.firstwL)?"Good":"Neutral";c1.lastYLabel.color=P<t.lastcL?"Error":((t.lastcL<=P)&&(P<=t.lastwL))?"Critical":(P>t.lastwL)?"Good":"Neutral";}break;case"MI":for(i in h){if(h[i].TYPE=="CH"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);t.ch=Number(h[i].FIXED);c1.maxThreshold={color:"Error"};c1.maxThreshold.data=(p=="MEASURE")?o.results:[d1];G=(p=="MEASURE")?t.sCriticalHigh:M;}else if(h[i].TYPE=="WH"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);t.wh=Number(h[i].FIXED);c1.minThreshold={color:"Good"};c1.minThreshold.data=(p=="MEASURE")?o.results:[d1];F=(p=="MEASURE")?t.sWarningHigh:M;}else if(h[i].TYPE=="TA"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);c1.target={color:"Neutral"};c1.target.data=(p=="MEASURE")?o.results:[d1];K=(p=="MEASURE")?t.sTarget:M;}}if(p=="FIXED"){c1.firstYLabel.color=O>t.ch?"Error":((t.wh<=O)&&(O<=t.ch))?"Critical":(O<t.wh)?"Good":"Neutral";c1.lastYLabel.color=P>t.ch?"Error":((t.wh<=P)&&(P<=t.ch))?"Critical":(P<t.wh)?"Good":"Neutral";}else if(p=="MEASURE"&&t.firstwH&&t.lastwH&&t.firstcH&&t.lastcH){c1.firstYLabel.color=O>t.firstcH?"Error":((t.firstwH<=O)&&(O<=t.firstcH))?"Critical":(O<t.firstwH)?"Good":"Neutral";c1.lastYLabel.color=P>t.lastcH?"Error":((t.lastwH<=P)&&(P<=t.lastcH))?"Critical":(P<t.lastwH)?"Good":"Neutral";}c1.innerMaxThreshold={data:[]};c1.innerMinThreshold={data:[]};break;case"RA":for(i in h){if(h[i].TYPE=="CH"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);t.ch=Number(h[i].FIXED);c1.maxThreshold={color:"Error"};c1.maxThreshold.data=(p=="MEASURE")?o.results:[d1];G=(p=="MEASURE")?t.sCriticalHigh:M;}else if(h[i].TYPE=="WH"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);t.wh=Number(h[i].FIXED);c1.innerMaxThreshold={color:"Good"};c1.innerMaxThreshold.data=(p=="MEASURE")?o.results:[d1];I=(p=="MEASURE")?t.sWarningHigh:M;}else if(h[i].TYPE=="WL"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);t.wl=Number(h[i].FIXED);c1.innerMinThreshold={color:"Good"};c1.innerMinThreshold.data=(p=="MEASURE")?o.results:[d1];H=(p=="MEASURE")?t.sWarningLow:M;}else if(h[i].TYPE=="CL"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);t.cl=Number(h[i].FIXED);c1.minThreshold={color:"Error"};c1.minThreshold.data=(p=="MEASURE")?o.results:[d1];F=(p=="MEASURE")?t.sCriticalLow:M;}else if(h[i].TYPE=="TA"){d1={};d1[f]="";d1[M]=Number(h[i].FIXED);c1.target={color:"Neutral"};c1.target.data=(p=="MEASURE")?o.results:[d1];K=(p=="MEASURE")?t.sTarget:M;}}if(p=="FIXED"){c1.firstYLabel.color=(O>t.ch||O<t.cl)?"Error":((t.wh<=O)&&(O<=t.ch))||((t.cl<=O)&&(O<=t.wl))?"Critical":((O>=t.wl)&&(O<=t.wh))?"Good":"Neutral";c1.lastYLabel.color=(P>t.ch||P<t.cl)?"Error":((t.wh<=P)&&(P<=t.ch))||((t.cl<=P)&&(P<=t.wl))?"Critical":((P>=t.wl)&&(P<=t.wh))?"Good":"Neutral";}else if(p=="MEASURE"&&t.firstwL&&t.lastwL&&t.firstcL&&t.lastcL&&t.firstwH&&t.lastwH&&t.firstcH&&t.lastcH){c1.firstYLabel.color=(O>t.firstcH||O<t.firstcL)?"Error":((t.firstwH<=O)&&(O<=t.firstcH))||((t.firstcL<=O)&&(O<=t.firstwL))?"Critical":((O>=t.firstwL)&&(O<=t.firstwH))?"Good":"Neutral";c1.lastYLabel.color=(P>t.lastcH||P<t.lastcL)?"Error":((t.lastwH<=P)&&(P<=t.lastcH))||((t.lastcL<=P)&&(P<=t.lastwL))?"Critical":((P>=t.lastwL)&&(P<=t.lastwH))?"Good":"Neutral";}break;}var e1=function(f1,a,b){return new c({color:"{/"+f1+"/color}",points:{path:"/"+f1+"/data",template:new A({x:"{"+a+"}",y:"{"+b+"}"})}});};t.getTile().getTileContent()[1].getContent().setTarget(e1("target",f,K));t.getTile().getTileContent()[1].getContent().setInnerMinThreshold(e1("innerMinThreshold",f,H));t.getTile().getTileContent()[1].getContent().setInnerMaxThreshold(e1("innerMaxThreshold",f,I));t.getTile().getTileContent()[1].getContent().setMinThreshold(e1("minThreshold",f,F));t.getTile().getTileContent()[1].getContent().setMaxThreshold(e1("maxThreshold",f,G));t.getTile().getTileContent()[1].getContent().setChart(e1("chart",f,M));t._updateTileModel(c1);}},flowWithoutDesignTimeCall:function(){this.DEFINITION_DATA=this.oConfig;this._updateTileModel(this.DEFINITION_DATA);if(this.oTileApi.visible.isVisible()&&!this.firstTimeVisible){this.firstTimeVisible=true;}this.onAfterFinalEvaluation();},flowWithDesignTimeCall:function(){var t=this;try{var a=d.getEvaluationById(this.oConfig.EVALUATION.ID);if(a){t.oConfig.EVALUATION_FILTERS=a.EVALUATION_FILTERS;t.flowWithoutDesignTimeCall();}else{sap.ushell.components.tiles.indicatorTileUtils.util.getFilterFromRunTimeService(this.oConfig,function(f){t.oConfig.EVALUATION_FILTERS=f;d.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);t.flowWithoutDesignTimeCall();});}}catch(e){this.logError(e);}},refreshHandler:function(C){if(!C.firstTimeVisible){if(Number(this.oTileApi.configuration.getParameterValueAsString("isSufficient"))){C.flowWithoutDesignTimeCall();}else{C.flowWithDesignTimeCall();}}},visibleHandler:function(i){if(!i){this.firstTimeVisible=false;sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef);}if(i){this.refreshHandler(this);}},setTextInTile:function(){var t=this;this._updateTileModel({header:t.oTileApi.preview.getTitle()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipTitle(t.oConfig),subheader:t.oTileApi.preview.getDescription()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipSubTitle(t.oConfig)});},onInit:function(){var t=this;this.firstTimeVisible=false;this.oDualTrendView=this.getView();this.oViewData=this.oDualTrendView.getViewData();this.oTileApi=this.oViewData.chip;if(this.oTileApi.visible){this.oTileApi.visible.attachVisible(this.visibleHandler.bind(this));}this.system=this.oTileApi.url.getApplicationSystem();this.oDualTrendView.oGenericTile.setState(L.Loading);if(this.oTileApi.preview.isEnabled()){this.setTextInTile();this._updateTileModel({value:8888,size:S.Auto,frameType:"TwoByOne",state:L.Loading,valueColor:V.Error,indicator:D.None,title:"Liquidity Structure",footer:"Current Quarter",description:"Apr 1st 2013 (B$)",width:"100%",height:"100%",chart:{color:"Good",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:20},{day:100,balance:80}]},target:{color:"Error",data:[{day:0,balance:0},{day:30,balance:30},{day:60,balance:40},{day:100,balance:90}]},maxThreshold:{color:"Good",data:[{day:0,balance:0},{day:30,balance:40},{day:60,balance:50},{day:100,balance:100}]},innerMaxThreshold:{color:"Error",data:[]},innerMinThreshold:{color:"Neutral",data:[]},minThreshold:{color:"Error",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:30},{day:100,balance:70}]},minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:{label:"June 123",color:"Error"},lastXLabel:{label:"June 30",color:"Error"},firstYLabel:{label:"0M",color:"Good"},lastYLabel:{label:"80M",color:"Critical"},minLabel:{},maxLabel:{}});this.oDualTrendView.oGenericTile.setState(L.Loaded);}else{try{sap.ushell.components.tiles.indicatorTileUtils.util.getParsedChip(this.oTileApi.configuration.getParameterValueAsString("tileConfiguration"),function(a){t.oConfig=a;t.setTextInTile();t.oDualTrendView.oGenericTile.attachPress(function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(t.trendChartODataReadRef);d.setKpivalueById(t.oConfig.TILE_PROPERTIES.id,null);window.location.hash=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(t.oConfig,t.system);});if(Number(t.oTileApi.configuration.getParameterValueAsString("isSufficient"))){d.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);t.flowWithoutDesignTimeCall();}else{t.flowWithDesignTimeCall();}});}catch(e){this.logError(e);}}},_setLocalModelToTile:function(){if(!this.getTile().getModel()){this.getTile().setModel(new J({}));}},onExit:function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef);}});return{};},true);
