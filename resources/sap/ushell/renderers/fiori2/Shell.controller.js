// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","./AccessKeysHandler","./History","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/services/AppConfiguration","sap/ushell/services/AppType","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/resources","sap/ushell/UserActivityLog","sap/ushell/EventHub","sap/ushell/Config","sap/ui/core/Component","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger","sap/ushell/components/HeaderManager","sap/ushell/components/_HeaderManager/ControlManager","sap/ushell/bootstrap/SchedulingAgent","sap/ui/core/library","sap/ushell/performance/FesrEnhancer","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/performance/Measurement","sap/base/util/isPlainObject","sap/base/util/UriParameters","sap/ui/util/Storage","sap/m/InstanceManager","sap/ushell/services/Message"],function(D,A,H,a,b,c,u,W,r,U,E,C,d,f,g,h,j,S,l,F,L,q,M,k,m,n,I,o){"use strict";var p=l.routing.HistoryDirection;var s=true,P=false,t,v=a.getElementsModel(),w,x={embedded:0,newWindowThenEmbedded:1,newWindow:1,replace:0},N={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"},y={};F.init();sap.ui.controller("sap.ushell.renderers.fiori2.Shell",{_aDoableObjects:[],onComponentTargetDisplay:function(e){var i=e.getParameters(),z=i.control,B=i.object;z.navTo("centerViewPort",B.getId(),"show");},onInit:function(){var e=this;var R=d.getOwnerComponentFor(this.getView()).getRouter();R.getTarget("home").attachDisplay(this.onComponentTargetDisplay);R.getTarget("appfinder").attachDisplay(this.onComponentTargetDisplay);R.getTarget("pages").attachDisplay(this.onComponentTargetDisplay);R.oHashChanger=g.getInstance();R.initialize(true);this.bEnableHashChange=true;s=true;var V=this.getView();var i=window.matchMedia("(min-width: 600px)"),z;var y=(V.getViewData()?V.getViewData().config:{})||{};a.parseStatefulContainerConfiguration(y.statefulApplicationContainer);var B=a.shellElements().model();h.init(y,B);this.oEndUserFeedbackConfiguration={showAnonymous:true,anonymousByDefault:true,showLegalAgreement:true,showCustomUIContent:true,feedbackDialogTitle:true,textAreaPlaceholder:true,customUIContent:undefined};this.initShellModel(y,B);var G=this.getView().updateShellAggregation;sap.ui.getCore().byId("shell-header").updateAggregation=G;sap.ui.getCore().byId("shell").updateAggregation=G;sap.ui.getCore().byId("right-floating-container").updateAggregation=G;sap.ui.getCore().byId("shell-split").updateAggregation=G;z=function(Q){C.emit("/core/shell/model/isPhoneWidth",!Q.matches);};if(i.addListener){i.addListener(z);z(i);}V.setModel(r.i18nModel,"i18n");sap.ui.getCore().getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","appOpened",this.onAppOpened,this);sap.ui.getCore().getEventBus().subscribe("allSearchFinished",this._logSearchActivity,this);this._setConfigurationToModel();this._aDoableObjects=this._registerAndCreateEventHubDoables();sap.ushell.Container.getService("AppLifeCycle");t.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);t.addHeaderEndItem(["meAreaHeaderButton"],false,["home","app","minimal","standalone","embedded","embedded-home","lean"],true);var J=[];if(y){if(!y.moveContactSupportActionToShellHeader){J.push("ContactSupportBtn");}if(!y.moveGiveFeedbackActionToShellHeader){J.push("EndUserFeedbackBtn");}}this.history=new H();this.oViewPortContainer=sap.ui.getCore().byId("viewPortContainer");a.init(y.appState,this.oViewPortContainer,y.rootIntent,y.disableHomeAppCache,{ownerComponent:this.getOwnerComponent()},J,y.cacheConfiguration);this.oNotificationsCountButton=sap.ui.getCore().byId("NotificationsCountButton");var K=function(Q){this.oShellNavigation=Q;this.oShellNavigation.registerExtraRouter(R);this.oShellNavigation.registerNavigationFilter(this._handleEmptyHash.bind(this));this.oShellNavigation.init(this.doHashChange.bind(this));this.oShellNavigation.registerNavigationFilter(this._disableSourceAppRouter.bind(this));this.oShellNavigation.registerNavigationFilter(this.handleDataLoss.bind(this));this.oShellNavigation.hashChanger.attachEvent("hashChanged",function(T){if(window.hasher.disableBlueBoxHashChangeTrigger===true){return;}if(T.mParameters&&e.oShellNavigation.hashChanger.isInnerAppNavigation(T.mParameters.newHash,T.mParameters.oldHash)){a.postMessageToIframeApp("sap.ushell.appRuntime","innerAppRouteChange",{oHash:T.mParameters});}a.postMessageToIframeApp("sap.ushell.appRuntime","hashChange",{sHash:T.mParameters.fullHash});});E.emit("ShellNavigationInitialized");}.bind(this);Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("URLShortening")]).then(function(){return sap.ushell.Container.getServiceAsync("ShellNavigation");}).then(K);sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());A.init(w);window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()&&!(D.browser.name===D.browser.BROWSER.INTERNET_EXPLORER&&a.getCurrentApplication().container.getApplicationType()===sap.ushell.ApplicationType.NWBC.type)){if(!r.browserI18n){r.browserI18n=r.getTranslationModel(window.navigator.language).getResourceBundle();}return r.browserI18n.getText("dataLossExternalMessage");}return undefined;};if(C.last("/core/shell/model/contentDensity")){a.getAppMeta()._applyContentDensityClass();}D.media.attachHandler(this.handleNavMenuTitleVisibility,this,D.media.RANGESETS.SAP_STANDARD);this.handleNavMenuTitleVisibility(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD));this.initShellUIService();if(!y.disableSignOut&&(y.sessionTimeoutTileStopRefreshIntervalInMinutes>0||y.sessionTimeoutReminderInMinutes>0)){var O=20000;setTimeout(function(){e._createSessionHandler(y);},O);}this.oViewPortContainer.onfocusin=function(){A.bFocusOnShell=false;A.bFocusPassedToExternalHandlerFirstTime=false;};this.oViewPortContainer.onfocusout=function(){A.bFocusOnShell=true;A.bFocusPassedToExternalHandlerFirstTime=true;};},shellUpdateAggItem:function(i,e){return sap.ui.getCore().byId(e.getObject());},getViewPortContainer:function(){return sap.ui.getCore().byId("viewPortContainer");},_registerAndCreateEventHubDoables:function(){var e=[E.once("CenterViewPointContentRendered").do(this._loadCoreExt.bind(this)),E.once("PagesRuntimeRendered").do(this._loadCoreExt.bind(this)),E.once("AppRendered").do(this._loadCoreExtNonUI5.bind(this)),E.on("toggleContentDensity").do(this.toggleContentDensity.bind(this)),E.on("ShellFloatingContainerDockedIsResized").do(this._onResizeWithDocking.bind(this)),E.on("LaunchpadCustomRouterRouteMatched").do(this._centerViewPort.bind(this)),E.once("CoreResourcesComplementLoaded").do(this._onCoreResourcesComplementLoaded.bind(this)),E.once("loadRendererExtensions").do(this._loadRendererExtensionPlugins.bind(this)),E.once("loadUsageAnalytics").do(this._loadUsageAnalytics.bind(this)),E.once("loadWarmupPlugins").do(this._loadWarmupPlugins.bind(this)),E.on("centerViewPort").do(this._centerViewPort.bind(this))];return e;},initShellModel:function(y,e){t=v;t.init(y,e);w=this.getView().getViewData().shellModel;C.emit("/core/shell/model/personalization",C.last("/core/shell/enablePersonalization"));},initShellUIService:function(){a.initShellUIService({fnOnBackNavigationChange:this.onBackNavigationChange.bind(this)});if(y.enableOnlineStatus){sap.ui.require(["sap/ushell/ui5service/UserStatus"],function(e){this.oUserStatus=new e({scopeObject:this.getOwnerComponent(),scopeType:"component"});}.bind(this));}},onBackNavigationChange:function(e){a.setBackNavigationChanged(true);var i=e.getParameters().data,z=C.last("/core/shell/model/currentState");if(i){a.service().setNavigateBack(i);if(z.stateName==="minimal"||z.stateName==="standalone"||z.stateName==="embedded"){sap.ushell.Container.getRenderer("fiori2").showHeaderItem("backBtn",true);}}else{a.service().resetNavigateBack();}},toggleContentDensity:function(e){var i=e.contentDensity==="compact";a.getAppMeta()._applyContentDensityByPriority(i,true);},_handleEmptyHash:function(e){e=(typeof e==="string")?e:"";e=e.split("?")[0];if(e.length===0){var V=this.getView()?this.getView().getViewData():{};y=V.config||{};if(y.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue;}if(y.rootIntent){setTimeout(function(){window.hasher.setHash(y.rootIntent);},0);return this.oShellNavigation.NavigationFilterStatus.Abandon;}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_setConfigurationToModel:function(){var V=this.getView().getViewData();if(V){y=V.config||{};}if(y){if(y.states){v.extendStates(y.states);h.extendStates(y.states);}if(y.changeEndUserFeedbackTitle!==undefined){this.oEndUserFeedbackConfiguration.feedbackDialogTitle=y.changeEndUserFeedbackTitle;}if(y.changeEndUserFeedbackPlaceholder!==undefined){this.oEndUserFeedbackConfiguration.textAreaPlaceholder=y.changeEndUserFeedbackPlaceholder;}if(y.showEndUserFeedbackAnonymousCheckbox!==undefined){this.oEndUserFeedbackConfiguration.showAnonymous=y.showEndUserFeedbackAnonymousCheckbox;}if(y.makeEndUserFeedbackAnonymousByDefault!==undefined){this.oEndUserFeedbackConfiguration.anonymousByDefault=y.makeEndUserFeedbackAnonymousByDefault;}if(y.showEndUserFeedbackLegalAgreement!==undefined){this.oEndUserFeedbackConfiguration.showLegalAgreement=y.showEndUserFeedbackLegalAgreement;}if(y.enableSetTheme!==undefined){w.setProperty("/setTheme",y.enableSetTheme);}w.setProperty("/contentDensity",y.enableContentDensity===undefined?true:y.enableContentDensity);if(y.migrationConfig!==undefined){w.setProperty("/migrationConfig",y.migrationConfig);}if(y.enableUserDefaultParameters!==undefined){w.setProperty("/userDefaultParameters",y.enableUserDefaultParameters);}if(y.disableHomeAppCache!==undefined){w.setProperty("/disableHomeAppCache",y.disableHomeAppCache);}w.setProperty("/enableHelp",C.last("/core/extension/enableHelp"));w.setProperty("/searchAvailable",(y.enableSearch!==false));this._getPersData({container:"flp.settings.FlpSettings",item:"userActivitesTracking"}).then(function(e){if(e===undefined){e=true;}w.setProperty("/enableTrackingActivity",e);}).catch(function(e){L.error("Failed to ltracking activities state state from the personalization",e,"sap.ushell.components.flp.settings.FlpSettings");});}},_getPreviousPageDirty:function(){return P;},_setPreviousPageDirty:function(e){P=e;},getModelConfiguration:function(){var V=this.getView().getViewData(),e,i;if(V){e=V.config||{};i=q.extend({},e);}delete i.applications;return i;},_getLogonFrameProvider:function(){var V=this.getView();return{create:function(){return V.createIFrameDialog();},show:function(){V.showIFrameDialog();},destroy:function(){V.destroyIFrameDialog();}};},onExit:function(){this._aDoableObjects.forEach(function(i){i.off();});sap.ui.getCore().getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);sap.ui.getCore().getEventBus().unsubscribe("allSearchFinished",this._logSearchActivity,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell","appOpened",this.onAppOpened,this);D.media.detachHandler(this.handleNavMenuTitleVisibility,this,D.media.RANGESETS.SAP_STANDARD);if(this.oShellNavigation){this.oShellNavigation.hashChanger.destroy();}if(this.getView()&&this.getView().destroyDanglingControls){this.getView().destroyDanglingControls();}var e=sap.ui.getCore().byId("shell-header");if(e&&e.destroy){e.destroy();}h.destroy();j.destroy();U.deactivate();t.destroy();a.shellElements().clean();a.destroy();t=undefined;},_getCurrentAppRouter:function(){var e=sap.ushell.Container.getService("AppLifeCycle"),i=e&&e.getCurrentApplication&&e.getCurrentApplication(),z=i&&i.componentInstance;if(z){return z.getRouter();}return null;},_disableSourceAppRouter:function(e,i){if(!this.bEnableHashChange){return this.oShellNavigation.NavigationFilterStatus.Continue;}var z=this.oShellNavigation.hashChanger.isInnerAppNavigation(e,i);if(!z){var B=this._getCurrentAppRouter();if(B){B.stop();}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_resumeAppRouterIgnoringCurrentHash:function(){var e=this._getCurrentAppRouter();if(e){e.initialize(true);}},handleDataLoss:function(e,i){if(!this.bEnableHashChange){this.bEnableHashChange=true;return this.oShellNavigation.NavigationFilterStatus.Custom;}if(sap.ushell.Container.getDirtyFlag()){if(!r.browserI18n){r.browserI18n=r.getTranslationModel(window.navigator.language).getResourceBundle();}if(confirm(r.browserI18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);a.postMessageToIframeApp("sap.ushell.appRuntime","setDirtyFlag",{bIsDirty:false});P=true;return this.oShellNavigation.NavigationFilterStatus.Continue;}var z=f.getInstance().getHistoryStateOffset();var B=this.oShellNavigation.wasHistoryEntryReplaced();var R=this._getRestoreHashStrategy(z,B);this._resumeAppRouterIgnoringCurrentHash();return this._restorePreviousHash(i,R);}return this.oShellNavigation.NavigationFilterStatus.Continue;},_getRestoreHashStrategy:function(i,e){if(e){return{strategy:"replaceHash",stepCount:0};}return{strategy:i<0?"historyForward":"historyBack",stepCount:i===undefined?1:Math.abs(i)};},_restorePreviousHash:function(e,R){var i=null;switch(R.strategy){case"historyBack":this.bEnableHashChange=false;this._windowHistoryBack(R.stepCount);i=this.oShellNavigation.NavigationFilterStatus.Custom;break;case"replaceHash":i={status:this.oShellNavigation.NavigationFilterStatus.Custom,hash:e};break;case"historyForward":this.bEnableHashChange=false;this._windowHistoryForward(R.stepCount);i=this.oShellNavigation.NavigationFilterStatus.Custom;break;default:throw new Error("Cannot execute unknown navigation strategy");}return i;},_isColdStart:function(){var R=sap.ushell.Container.getRenderer("fiori2");var e=!R||!R.getCurrentCoreView();if(this.history.getHistoryLength()<=1&&e){return true;}this._isColdStart=function(){return false;};return false;},_setEnableHashChange:function(V){this.bEnableHashChange=V;},_logRecentActivity:function(R){if(C.last("/core/shell/model/enableTrackingActivity")){return b.addActivity(R);}return Promise.reject("Tracking is not enabled");},_logApplicationUsage:function(e){if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("UserRecents").then(function(i){i.addAppUsage(e);});}},doHashChange:function(e,i,O,z,B){M.start("FLP:ShellController.doHashChange","doHashChange","FLP");u.addTime("ShellControllerHashChange");E.emit("trackHashChange",e);var G=sap.ui.getCore().byId("sapUshellDashboardPage");if(G){G.setBlocked(true);G.setBusy(true);}return this._doHashChange(this,e,i,O,z,B).then(function(){M.end("FLP:ShellController.doHashChange");},function(J){M.end("FLP:ShellController.doHashChange");E.emit("doHashChangeError",Date.now());if(G){G.setBlocked(false);G.setBusy(false);}});},_doHashChange:function(e,i,z,O,B,G){this._wasHistoryEntryReplaced=this.oShellNavigation.wasHistoryEntryReplaced();this.oShellNavigation.resetHistoryEntryReplaced();var J,K,Q;if(!this.bEnableHashChange){this.bEnableHashChange=true;return q.when();}if(G){e.hashChangeFailure(e.history.getHistoryLength(),G.message,null,"sap.ushell.renderers.fiori2.Shell.controller",false);return q.when();}if(I&&s){I.closeAllDialogs();I.closeAllPopovers();}s=true;K=e.history.getHistoryLength();Q=e.fixShellHash(i);e.history.hashChange(Q,O);e.currentAppBeforeNav=b.getCurrentApplication();q.sap.flpmeasure.end(0,"Creating Shell");q.sap.flpmeasure.start(0,"targetResolution",1);return e._resolveHashFragment(Q).then(function(R,T){q.sap.flpmeasure.end(0,"targetResolution");q.sap.flpmeasure.start(0,"CreateComponent",3);var V=T?T.semanticObject+"-"+T.action:"",y=e._getConfig(),X=!!(R&&R.componentHandle),Y=R&&R.ui5ComponentName;R=e._calculateNavigationMode(T,R);if(e._handleEarlyNavigation(Q,z,R)){return;}if(y&&y.applications&&y.applications[V]){R.applicationConfiguration=y.applications[V];}J=a.getInMemoryInstance(V,Q);if(J.isInstanceSupported){e._initiateApplication(R,Q,T,K,z);return;}if(X||!Y){e._initiateApplication(R,Q,T,K,z);return;}a.destroy(J.appId,J.container);a.removeApplication(V);b.setApplicationInInitMode();sap.ui.getCore().getEventBus().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:Y});M.start("FLP:ShellController.UI5createComponent","UI5 createComponent","FLP");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){a.createComponent(R,T).done(function(){M.end("FLP:ShellController.UI5createComponent");q.sap.flpmeasure.end(0,"CreateComponent");e._initiateApplication(R,Q,T,K,z);}).fail(function(Z){var $=r.i18n.getText("cannot_load_ui5_component_details",[Q]),_="Failed to load UI5 component for navigation intent "+Q;b.setCurrentApplication(e.currentAppBeforeNav);e.hashChangeFailure(K,{title:r.i18n.getText("error"),message:r.i18n.getText("failed_to_open_ui5_component"),technicalMessage:_},{info:$,technicalMessage:Z.message+"\n"+Z.stack},"sap.ushell.renderers.fiori2.Shell.controller",false);});});},function(R){var T=r.i18n.getText("cannot_resolve_navigation_target_details",[Q]),V="Failed to resolve navigation target: "+Q+". This is most likely caused by an incorrect SAP Fiori launchpad content configuration or by missing role assignment.";e.hashChangeFailure(K,{title:r.i18n.getText("error"),message:r.i18n.getText("failed_to_open_app_missing_configuration_or_role_assignment"),technicalMessage:V},{info:T,fixedShellHash:Q,technicalMessage:R},"sap.ushell.renderers.fiori2.Shell.controller",false);});},_handleEarlyNavigation:function(e,i,R){var z=R&&(u.isNativeWebGuiNavigation(R)||R.nativeNWBCNavigation),B;if(z&&this._openAppViaNWBC(R)){R.sFixedShellHash=e;this.logOpenAppAction(R,i);B=sap.ui.getCore().byId("sapUshellDashboardPage");if(B){B.setBlocked(false);B.setBusy(false);}return true;}var G=R&&R.navigationMode===N.newWindow;if(G){R.sFixedShellHash=e;this.logOpenAppAction(R,i);this._openAppInNewWindowAndRestore(R);B=sap.ui.getCore().byId("sapUshellDashboardPage");if(B){B.setBlocked(false);B.setBusy(false);}return true;}if(C.last("/core/shell/model/migrationConfig")){y.migrationConfig=false;this.getModel().setProperty("/migrationConfig",false);if(R&&e==="#"){y.rootIntent="";}else if(e==="#"){setTimeout(function(){window.hasher.setHash(y.rootIntent);},0);return true;}}return false;},_initiateApplication:function(R,e,i,O){M.start("FLP:ShellController._initiateApplication","_initiateApplication","FLP");var z=b.getMetadata(R),B=C.last("/core/extension/SupportTicket"),G;if(z.title){window.document.title=z.title;}else{L.debug("Shell controller._initiateApplication: the title of the window is not changed because most probably the application was resolved with undefined");}if(B){setTimeout(function(){U.activate();},0);}try{G=this.oShellNavigation.isInitialNavigation();this.navigate(i,e,z,R);}catch(J){if(J.stack){L.error("Application initialization (Intent: \n"+e+"\n failed due to an Exception:\n"+J.stack);}this.oShellNavigation.setIsInitialNavigation(G);this.hashChangeFailure(O,J.name,J.message,z?z.title:"",false);}M.end("FLP:ShellController._initiateApplication");},_resolveHashFragment:function(e){M.start("FLP:ShellController._resolveHashFragment","_resolveHashFragment","FLP");var R,i,z=sap.ushell.Container.getService("URLParsing").parseShellHash(e),B=new q.Deferred(),y=this._getConfig();i=z&&z.params||{};if(z&&z.contextRaw&&z.contextRaw==="navResCtx"&&i&&i.additionalInformation&&(i.additionalInformation[0]||i.additionalInformation[0]==="")&&i.applicationType&&i.applicationType[0]&&i.url&&i.url[0]&&i.navigationMode&&(i.navigationMode[0]||i.additionalInformation[0]==="")){i=z.params||{};R={additionalInformation:i.additionalInformation[0],applicationType:i.applicationType[0],url:i.url[0],navigationMode:i.navigationMode[0]};if(i.title){R.text=i.title[0];}B.resolve(R,z);}else{if(window["sap-ushell-async-libs-promise-directstart"]){window["sap-ushell-async-libs-promise-directstart"].then(function(G){B.resolve(G.resolvedHashFragment,z);delete window["sap-ushell-async-libs-promise-directstart"];},function(G){B.reject(G);delete window["sap-ushell-async-libs-promise-directstart"];});return B.promise();}sap.ushell.Container.getService("NavTargetResolution").resolveHashFragment(e).done(function(R){b.setCurrentApplication(R);if(z&&(z.semanticObject+"-"+z.action)===y.rootIntent){R.navigationMode="embedded";}M.end("FLP:ShellController._resolveHashFragment");B.resolve(R,z);}).fail(function(G){B.reject(G);});}return B.promise();},_calculateNavigationMode:function(e,R){if(!R){return undefined;}var i=R.navigationMode;if(i===N.newWindowThenEmbedded){if(this._isColdStart()||(e.contextRaw&&e.contextRaw==="navResCtx")||f.getInstance().getDirection()===p.Backwards){R.navigationMode=N.embedded;}else{R.navigationMode=N.newWindow;if(!u.isNativeWebGuiNavigation(R)){R.url=this._getCurrentLocationHash();}}return R;}if(i===N.newWindow&&this._isColdStart()){if(this._hasAppCapabilitiesNavigationMode(R)&&R.appCapabilities.navigationMode===N.embedded){R.navigationMode=N.embedded;return R;}R.navigationMode=N.replace;return R;}if(i===N.newWindow&&this._hasAppCapabilitiesNavigationMode(R)&&R.appCapabilities.navigationMode===N.embedded){R.url=this._getCurrentLocationHash();}return R;},_hasAppCapabilitiesNavigationMode:function(R){return u.isPlainObject(R.appCapabilities)&&R.appCapabilities.hasOwnProperty("navigationMode");},_usesNavigationRedirect:function(e){if(!e){return new q.Deferred().reject().promise();}var i=this,z=e.getInstance({});if(z&&typeof z.navigationRedirect==="function"){var B=new q.Deferred();var G=z.navigationRedirect();if(G&&typeof G.then==="function"){G.then(function(J){L.warning("Performing navigation redirect to hash "+J);z.destroy();i.history.pop();sap.ushell.Container.getService("ShellNavigation").toExternal({target:{shellHash:J}},undefined,false);B.resolve(true);},function(){B.reject();});return B.promise();}}return new q.Deferred().reject().promise();},navigate:function(e,i,z,R){M.start("FLP:ShellController.navigate","navigate","FLP");var B=(k(R)?R.navigationMode:null),G=this;if(B===null){if(this._isColdStart()){window.hasher.setHash("");return;}this.bEnableHashChange=false;this.history.pop();this._windowHistoryBack(1);return Promise.resolve();}R=this._calculateNavigationMode(e,R);B=(k(R)?R.navigationMode:null);if(B===N.embedded){if(!this._isColdStart()&&!this._wasHistoryEntryReplaced){this.oShellNavigation.setIsInitialNavigation(false);}var J=this._usesNavigationRedirect(R.componentHandle),K=new Promise(function(O,Q){J.then(null,function(){G._handleEmbeddedNavMode(i,e,z,R).then(function(){O();});if(e&&e.contextRaw==="navResCtx"){L.error(" This path will no longer be supported in 1.40");G.bEnableHashChange=false;if(e&&e.params&&e.params.original_intent&&e.params.original_intent[0]){window.hasher.replaceHash(e.params.original_intent[0]);G.history._history[0]=e.params.original_intent[0];}}});M.end("FLP:ShellController.navigate");});return K;}if(B===N.replace){this.oShellNavigation.setIsInitialNavigation(false);this.bEnableHashChange=false;this._changeWindowLocation(R.url);return Promise.resolve();}if(B===N.newWindow){this._openAppInNewWindowAndRestore(R);return Promise.resolve();}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller",false);return Promise.resolve();},_openAppViaNWBC:function(R){try{var i=u.appendUserIdToUrl("sap-user",R.url);var z=u.appendSapShellParam(i);var B=u.getPrivateEpcm();var G=x[R.navigationMode];var J;if(u.hasNavigationModeCapability()){J=G||x[N.embedded];}if(!B.doNavigate(z,J)){return false;}}catch(e){if(e.stack){L.error("Application initialization failed due to an Exception:\n"+e.stack);}this.hashChangeFailure(this.history.getHistoryLength(),e.name,e.message,R.text,false);return false;}this._restorePreviousHashAfterOpenNewWindow(R);return true;},_restorePreviousHashAfterOpenNewWindow:function(R){this.history.pop();var V=R.componentHandle&&R.componentHandle.getInstance&&R.componentHandle.getInstance({});if(V){V.destroy();}this._resumeAppRouterIgnoringCurrentHash();this._windowHistoryBack(1);b.setCurrentApplication(this.currentAppBeforeNav);E.emit("openedAppInNewWindow",Date.now());},_openAppInNewWindowAndRestore:function(R){this.bEnableHashChange=false;this._openAppNewWindow(R.url);this._restorePreviousHashAfterOpenNewWindow(R);},_handleEmbeddedNavMode:function(e,i,z,R){M.start("FLP:ShellController._handleEmbeddedNavMode","_handleEmbeddedNavMode","FLP");var B,G,J,K;this.resetShellUIServiceHandlers();a.getAppMeta().setAppIcons(z);B="-"+i.semanticObject+"-"+i.action;J=e==="#"||(y.rootIntent&&y.rootIntent===i.semanticObject+"-"+i.action);K=i?i.semanticObject+"-"+i.action:"";a.switchViewState(a.shellElements().calculateElementsState(J?"home":"app",R.applicationType,y.appState,R.explicitNavMode),undefined,B);if(J){a.getShellUIService().setBackNavigation();}G=a.handleControl(K,B,i,R,this.getWrappedApplicationWithMoreStrictnessInIntention.bind(this),e);if(this.currentAppBeforeNav){var O=a.getStatefulContainer(this.currentAppBeforeNav.applicationType);if(O){O.onApplicationOpened(R.applicationType);}}M.end("FLP:ShellController._handleEmbeddedNavMode");return G;},_centerViewPort:function(){this.oViewPortContainer.switchState("Center");},_isShellHomeIntent:function(i){return i==="#"||i===y.rootIntent;},getWrappedApplicationWithMoreStrictnessInIntention:function(i,e,z,R,B,G,J){var K,O=this;setTimeout(function(){setTimeout(function(){var Q;if(C.last("/core/shell/model/currentState/stateName")==="app"){Q="shellAppTitle";}A.sendFocusBackToShell(Q);setTimeout(function(){O.readNavigationEnd();},500);},100);sap.ui.getCore().getEventBus().publish("launchpad","appOpening",R);L.info("app is being opened");},0);if(y.applications){R.applicationConfiguration=y.applications[i];}K=a.getAppContainer(B,R,this._isColdStart(),z,J);R.sFixedShellHash=J;a.publishNavigationStateEvents(K,R,this.onAppAfterRendering.bind(this,R));K.addStyleClass("sapUshellApplicationPage");if(!G){K.addStyleClass("sapUShellApplicationContainerLimitedWidth");}if(this._isDock()&&window.matchMedia("(min-width: 106.4rem)").matches){K.addStyleClass("sapUShellDockingContainer");K.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}else if(this._isDock()){K.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}K.toggleStyleClass("sapUshellDefaultBackground",!e.hideLightBackground);a.getAppMeta()._applyContentDensityByPriority();a.addControl(K);M.end("FLP:ShellController.getWrappedApplication");return K;},resetShellUIServiceHandlers:function(){a.getAppMeta().resetShellUIServiceHandlers();a.setBackNavigationChanged(false);},onAppAfterRendering:function(e){var i=a.getShellUIService();setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",e);L.info("app was opened");},0);var z=a._publicEventDataFromResolutionResult(e);E.emit("AppRendered",z);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",z);if(i){a.initAppMetaParams();}t.updateStateProperty("application/icon",a.getAppMeta().getAppIcon(),true);t.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},_saveHomePageComponent:function(){if(this.oHomeApp){return;}var e=this,i="sap.ushell",z=function(B,G,J){e.oHomeApp=J.component;sap.ui.getCore().getEventBus().unsubscribe(i,"appComponentLoaded",z);};sap.ui.getCore().getEventBus().subscribe(i,"appComponentLoaded",z);},hashChangeFailure:function(i,e,z,B,G){if(u.isPlainObject(e)){this.reportError(e.technicalMessage,z.technicalMessage,B);sap.ushell.Container.getService("Message").show(o.Type.ERROR,e.message,{title:e.title,details:z});}else{this.reportError(e,z,B);this.delayedMessageError(r.i18n.getText("fail_to_start_app_try_later"));}s=false;this._resumeAppRouterIgnoringCurrentHash();if(i===0){window.hasher.setHash("");}else if((new m(window.location.href)).get("bFallbackToShellHome")){window.hasher.setHash("");}else{this.bEnableHashChange=G;sap.ushell.Container.setDirtyFlag(P);a.postMessageToIframeApp("sap.ushell.appRuntime","setDirtyFlag",{bIsDirty:P});this._windowHistoryBack(1);}},reportError:function(e,i,z){L.error(e,i,z);},delayedMessageError:function(e){setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getService("Message").error(e);}},0);},fixShellHash:function(e){if(!e){e="#";}else if(e.charAt(0)!=="#"){e="#"+e;}return e;},_openAppNewWindow:function(e){if(e.trim().indexOf("sap-nwbc://")===0&&(D.browser.edge||D.browser.msie)){window.location.href=e;}else{var i=W.openURL(e);if(!i&&!(D.browser.msie||D.browser.edge)){var z=r.i18n.getText("fail_to_start_app_popup_blocker",[window.location.hostname]);this.delayedMessageError(z);}}},_windowHistoryBack:function(i){window.history.go(-1*i);},_windowHistoryForward:function(i){window.history.go(i);},_changeWindowLocation:function(e){window.location.href=e;},onAppOpened:function(e,i,R){var z=sap.ui.getCore().byId("menuBarComponentContainer");z.setVisible(false);var B=this.oShellNavigation.hashChanger.getAppHash(),G=B?"&/"+B:null;this.logOpenAppAction(R,G);},externalSearchTriggered:function(e,i,z){C.emit("/core/shell/model/searchTerm",z.searchTerm);z.query=z.searchTerm;},onBeforeNavigate:function(e){var i=sap.ui.getCore().byId("menuBarComponentContainer");if(i.getComponent()){var z=this.getOwnerComponent().byId("pages-component-container");if(e.getParameter("to")===z){i.setVisible(true);}else{i.setVisible(false);}i.rerender();}},onAfterNavigate:function(e){var T=e.mParameters?e.mParameters.toId:undefined;var i=sap.ui.getCore().byId("sapUshellDashboardPage");if(i){i.setBlocked(false);i.setBusy(false);}u.addTime("ShellController.onAfterNavigate");a.onAfterNavigate(e.getParameter("fromId"),e.getParameter("from"),T,e.getParameter("to"));sap.ui.getCore().getEventBus().publish("sap.ushell","navigated",{});},logOpenAppAction:function(R,e){var i=C.last("/core/shell/enableRecentActivity")&&C.last("/core/shell/enableRecentActivityLogging");if(!i){return;}var z={};var B=b.getMetadata(R);var G=R.sFixedShellHash;var J=G;if(e){J+=e;}z.title=B.title;z.appType=c.APP;z.url=J;sap.ushell.Container.getServiceAsync("URLParsing").then(function(K){var O=K.parseShellHash(G);if(O){z.appId="#"+K.constructShellHash({semanticObject:O.semanticObject,action:O.action});}else{z.appId=G;}if(G.indexOf("#Action-search")===-1){setTimeout(function(){this._logRecentActivity(z);}.bind(this),1500);}if(y.enableTilesOpacity){setTimeout(function(){this._logApplicationUsage(G);}.bind(this),1500);}}.bind(this));},_logSearchActivity:function(){if(C.last("/core/shell/enableRecentActivity")&&C.last("/core/shell/enableRecentActivityLogging")){var T="";try{T=sap.ui.getCore().byId("searchFieldInShell-input").getModel().getLastSearchTerm();}catch(e){L.error("Shell: last search term is not available to log a recent activity");}this._logRecentActivity({appId:"#Action-search",appType:c.SEARCH,title:T,url:"#"+window.hasher.getHash()});}},readNavigationEnd:function(){var e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=r.i18n.getText("loadingComplete");setTimeout(function(){e.setAttribute("aria-live","off");e.innerHTML="";},0);}},handleNavMenuTitleVisibility:function(e){this.bNavMenuTitleVisible=false;if(e.name!=="Desktop"){this.bNavMenuTitleVisible=true;}t.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},_loadCoreExtNonUI5:function(e){if(e&&e.applicationType!=="SAPUI5"){this._loadCoreExt();}},_loadUsageAnalytics:function(e){sap.ushell.Container.getServiceAsync("UsageAnalytics").then(function(i){i.init(r.i18n.getText("usageAnalytics"),r.i18n.getText("i_agree"),r.i18n.getText("i_disagree"),r.i18n.getText("remind_me_later"));E.emit("StepDone",e.stepName);},function(){E.emit("StepFailed",e.stepName);});},_onCoreResourcesComplementLoaded:function(){u.setPerformanceMark("SchedulingAgent-StartOfFlow");var V=this.getView();if(V){V.createPostCoreExtControls();}S._initialize();E.emit("startScheduler");},_loadRendererExtensionPlugins:function(e){var i=new m(window.location.href),z=i.get("sap-ushell-xx-pluginmode")==="delayed";function B(G){function J(){E.emit("StepDone",e.stepName);}function K(){G.loadPlugins("RendererExtensions").always(J);}if(!y.inHeaderLessOpt){if(z){setTimeout(K,5000);}else{K();}}else{J();}}sap.ushell.Container.getServiceAsync("PluginManager").then(B.bind(this));},_loadWarmupPlugins:function(e){sap.ushell.Container.getService("PluginManager").loadPlugins("AppWarmup").always(function(){L.debug("WARMUP plugins loaded",null,"sap.ushell.renderers.fiori2.Shell");E.emit("StepDone",e.stepName);u.setPerformanceMark("SchedulingAgent-EndOfFlow");u.setPerformanceMeasure("SchedulingAgentTotalTime","SchedulingAgent-StartOfFlow","SchedulingAgent-EndOfFlow");});},_loadCoreExt:function(){M.end("FLP:Container.InitLoading");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){E.emit("loadCoreResourcesComplement");});},getCurrentViewportState:function(){return C.last("/core/shell/model/currentViewPortState");},makeEndUserFeedbackAnonymousByDefault:function(e){this.oEndUserFeedbackConfiguration.anonymousByDefault=e;},showEndUserFeedbackLegalAgreement:function(e){this.oEndUserFeedbackConfiguration.showLegalAgreement=e;},_activateFloatingUIActions:function(i){if(i<417){this.oFloatingUIActions.disable();}else{this.oFloatingUIActions.enable();}},setFloatingContainerDragSelector:function(e){q(e).addClass("sapUshellShellFloatingContainerSelector");sap.ui.require(["sap/ushell/UIActions"],function(i){if(!this.oFloatingUIActions){this.oFloatingUIActions=new i({containerSelector:".sapUiBody",wrapperSelector:".sapUshellShellFloatingContainerWrapper",draggableSelector:".sapUshellShellFloatingContainerWrapper",rootSelector:".sapUiBody",cloneClass:"sapUshellFloatingContainer-clone",dragCallback:this._handleFloatingContainerUIStart.bind(this),endCallback:this._handleFloatingContainerDrop.bind(this),moveTolerance:3,onDragStartUIHandler:this._onDragStartUI.bind(this),onDragEndUIHandler:this._setFloatingContainerHeight.bind(this),dragAndScrollCallback:this._doDock.bind(this),switchModeDelay:1000,isLayoutEngine:false,isTouch:false,elementToCapture:e,defaultMouseMoveHandler:function(){},debug:q.sap.debug()});}else{this.oFloatingUIActions.elementsToCapture=q(e);}this._activateFloatingUIActions(q(window).width());var z;q(window).bind("resize",function(){clearTimeout(z);z=setTimeout(this._activateFloatingUIActions(q(window).width()),300);}.bind(this));}.bind(this));},_doDock:function(e){M.start("FLP:Shell.controller._doDock","dragging co-pilot element","FLP");var i=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD);if(i.name==="Desktop"){var z=q(window).width();if(e){e.docked={};var B=e.docked;if(e.moveX>=z-64){B.dockPos="right";B.setIsDockingAreaOpen=true;this._openDockingArea(e);}else if(e.moveX<64){B.dockPos="left";B.setIsDockingAreaOpen=true;this._openDockingArea(e);}else{if(this._isDockingAreaOpen()){this._closeDockingArea(e);}if(q("#canvas").hasClass("sapUshellContainerDocked")){this._handleCloseCanvas(e);}}}}M.end("FLP:Shell.controller._doDock");},_finishDoDock:function(e){this._openDockingArea(false);var i=new n(n.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","docked:"+e.dockPos);this._handleOpenCanvas(e);var z=q("#sapUshellFloatingContainerWrapper");z.css("height","100%");q("#shell-floatingContainer").addClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsDocked");},_onResizeWithDocking:function(){this.handleNavMenuTitleVisibility(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD));setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appFinderWithDocking");},300);},_onDragStartUI:function(e){M.start("FLP:Shell.controller._onDragStartUI","start drag","FLP");if(this._isDock()){var i=new n(n.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","floating");q("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDocked");q(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsUnDocked");q("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");q("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedMinimizeCoPilot");q(q(".sapUshellContainerDockedMinimizeCoPilot")).on("webkitAnimationEnd oanimationend msAnimationEnd animationend",this._handleAnimations(false));this._handleCloseCanvas(e);}M.end("FLP:Shell.controller._onDragStartUI");},_handleAnimations:function(i){var e="sapUshellContainerDockedLaunchpad";var z=q("#sapUshellFloatingContainerWrapper");if(i){q("#canvas, #shell-header").addClass(e);z.addClass("sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking();}else{q("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedExtendCoPilot");}},_openDockingArea:function(e){var i=e?e.docked:false;var z=i?i.setIsDockingAreaOpen:false;if(z&&q("#DockinaAreaDiv").length==0){var B=sap.ui.getCore().getConfiguration().getRTL();if((i.dockPos==="right"&&e.clone&&!B)||(i.dockPos==="left"&&e.clone&&B)){q("<div id=\"DockinaAreaDiv\"  class=\"sapUshellShellDisplayDockingAreaRight\">").appendTo(e.clone.parentElement);}else if((i.dockPos==="left"&&e.clone&&!B)||(i.dockPos==="right"&&e.clone&&B)){q("<div id=\"DockinaAreaDiv\"  class=\"sapUshellShellDisplayDockingAreaLeft\">").appendTo(e.clone.parentElement);}e.clone.oDockedProp={};e.clone.oDockedProp.dockPos=i.dockPos;}else if(!z){this._closeDockingArea();}},_closeDockingArea:function(){setTimeout(function(){q(".sapUshellShellDisplayDockingAreaRight").remove();q(".sapUshellShellDisplayDockingAreaLeft").remove();},150);},_isDock:function(){return q(".sapUshellContainerDocked").size()!==0;},_isDockingAreaOpen:function(){return q(".sapUshellShellDisplayDockingAreaRight").size()!==0||q(".sapUshellShellDisplayDockingAreaLeft").size()!==0;},_handleOpenCanvas:function(e){var i=q("#canvas");var z=q(".sapUshellShellHead");var B=sap.ui.getCore().getConfiguration().getRTL();if((e.dockPos==="right"&&!B)||(e.dockPos==="left"&&B)){i.addClass("sapUshellContainer-Narrow-Right sapUshellContainerDocked ");z.addClass("sapUshellHead-Narrow-Right sapUshellContainerDocked");}if((e.dockPos==="left"&&!B)||(e.dockPos==="right"&&B)){i.addClass("sapUshellContainer-Narrow-Left sapUshellContainerDocked ");z.addClass("sapUshellHead-Narrow-Left sapUshellContainerDocked");}var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}},_handleCloseCanvas:function(e){var i=q("#canvas");var z=q(".sapUshellShellHead");if(e){e.docked.setIsDockingAreaOpen=false;}if(i.hasClass("sapUshellContainer-Narrow-Right")){i.removeClass("sapUshellContainer-Narrow-Right sapUshellContainerDocked sapUshellMoveCanvasRight");z.removeClass("sapUshellHead-Narrow-Right sapUshellContainerDocked");this._openDockingArea(e);this._setFloatingContainerHeight();}if(i.hasClass("sapUshellContainer-Narrow-Left")){i.removeClass("sapUshellContainer-Narrow-Left sapUshellContainerDocked sapUshellMoveCanvasLeft");z.removeClass("sapUshellHead-Narrow-Left sapUshellContainerDocked");this._openDockingArea(e);this._setFloatingContainerHeight();}this._onResizeWithDocking();var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}},_setFloatingContainerHeight:function(e){var i=q(window).width();var z=q("#sapUshellFloatingContainerWrapper");if(this._isDock()){if(e&&(e.clientX>=i-64||e.clientX<64)){z.addClass(" sapUshellContainerDocked");z.addClass("sapUshellContainerDockedMinimizeCoPilot");q(z).on("webkitAnimationEnd oanimationend msAnimationEnd animationend",this._handleAnimations(true));}}else if(!this._isDock()){q("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");}},_handleFloatingContainerDrop:function(e,i,z){M.start("FLP:Shell.controller._handleFloatingContainerDrop","drop floating container","FLP");var B=i.firstChild?sap.ui.getCore().byId(i.firstChild.id):undefined,G=new n(n.Type.local,"com.sap.ushell.adapters.local.FloatingContainer"),J=q(window).width(),K=q(window).height(),O=z.deltaX/J,Q=z.deltaY/K,R=i.style.visibility,T=i.style.display,V=parseFloat(i.style.left.replace("%","")),X=parseFloat(i.style.top.replace("%",""));i.style.visibility="hidden";i.style.display="block";if(typeof(V)==="number"){O=V+100*z.deltaX/J;}if(typeof(X)==="number"){Q=X+100*z.deltaY/K;}if(this._isDockingAreaOpen()){Q=0;}i.setAttribute("style","left:"+O+"%;top:"+Q+"%;position:absolute;");i.visibility=R;i.display=T;G.put("floatingContainerStyle",i.getAttribute("style"));if(B){B.handleDrop();if(!!z.clone.oDockedProp&&this._isDockingAreaOpen()){this._finishDoDock(z.clone.oDockedProp);}}M.end("FLP:Shell.controller.handleFloatingContainerDrop");},_handleFloatingContainerUIStart:function(i,z){M.start("FLP:Shell.controller._handleFloatingContainerUIStart","starts dragging floating container","FLP");var B=z;B.style.display="none";if(window.getSelection){var G=window.getSelection();try{G.removeAllRanges();}catch(e){}}M.end("FLP:Shell.controller._handleFloatingContainerUIStart");},getFloatingContainerState:function(){var e=new n(n.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");var i="floating";if(e!=null){i=e.get("lastState");if(i==null){i="floating";}}return i;},setFloatingContainerVisibility:function(V){var e=this.getFloatingContainerState();if(e){if(e=="floating"){this.getView().getOUnifiedShell().setFloatingContainerVisible(V);}else if(e.indexOf("docked")!=-1){var i=sap.ui.getCore().byId("viewPortContainer");if(V==true){var z=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD);if(z.name=="Desktop"){var B=q("#sapUshellFloatingContainerWrapper");B.addClass("sapUshellContainerDocked");q("#canvas, .sapUshellShellHead").addClass("sapUshellContainerDocked");B.css("height","100%");sap.ui.getCore().byId("shell-floatingContainer").addStyleClass("sapUshellShellFloatingContainerFullHeight");if(i){i._handleSizeChange();}if(sap.ui.getCore().getConfiguration().getRTL()){if(e.indexOf("right")!=-1){q("#canvas").addClass("sapUshellContainer-Narrow-Left");q(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Left");this._handleAnimations(true);}else{q("#canvas").addClass("sapUshellContainer-Narrow-Right");q(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Right");this._handleAnimations(true);}}else if(e.indexOf("right")!=-1){q("#canvas").addClass("sapUshellContainer-Narrow-Right");q(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Right");this._handleAnimations(true);}else{q("#canvas").addClass("sapUshellContainer-Narrow-Left");q(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Left");this._handleAnimations(true);}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(V);}.bind(this),400);}else{new n(n.Type.local,"com.sap.ushell.adapters.local.CopilotLastState").put("lastState","floating");this.getView().getOUnifiedShell().setFloatingContainerVisible(V);}}else{this._handleAnimations(false);if(i){i._handleSizeChange();}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(V);}.bind(this),400);q("#canvas, .sapUshellShellHead").removeClass("sapUshellContainerDocked sapUshellContainer-Narrow-Right sapUshellContainer-Narrow-Left");}q("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking();if(i){i._handleSizeChange();}}}},getFloatingContainerVisibility:function(){return this.getView().getOUnifiedShell().getFloatingContainerVisible();},setFloatingContainerContent:function(e,i,z,B){t.setFloatingContainerContent(e,i,z,B);},getRightFloatingContainerVisibility:function(){var R=this.getView().getOUnifiedShell().getRightFloatingContainer(),e=R&&R.getVisible();return e;},setHeaderTitle:function(T){h.updateStates({propertyName:"title",value:T||"",aStates:["home","app"],bCurrentState:false,bDoNotPropagate:false});},addEndUserFeedbackCustomUI:function(e,i){if(e){this.oEndUserFeedbackConfiguration.customUIContent=e;}if(i===false){this.oEndUserFeedbackConfiguration.showCustomUIContent=i;}},setFooter:function(e){var i=this.getView().getOUnifiedShell();if(typeof e!=="object"||!e.getId){throw new Error("oFooter value is invalid");}if(i.getFooter()!==null){q.sap.log.warning("You can only set one footer. Replacing existing footer: "+i.getFooter().getId()+", with the new footer: "+e.getId()+".");}i.setFooter(e);},removeFooter:function(){this.getView().getOUnifiedShell().setFooter(null);},addUserPreferencesEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateUserPrefModel(e);},addUserProfilingEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateProfilingModel(e);},_validateUserPrefEntryConfiguration:function(e){if((!e)||(typeof e!=="object")){throw new Error("object oConfig was not provided");}if(!e.title){throw new Error("title was not provided");}if(!e.value){throw new Error("value was not provided");}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid");}else if(e.entryHelpID===""){throw new Error("entryHelpID type is invalid");}}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid");}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid");}if(e.onSave&&typeof e.onSave!=="function"){throw new Error("onSave type is invalid");}if(e.content&&typeof e.content!=="function"){throw new Error("content type is invalid");}if(e.onCancel&&typeof e.onCancel!=="function"){throw new Error("onCancel type is invalid");}},_createSessionHandler:function(y){var e=this;sap.ui.require(["sap/ushell/SessionHandler"],function(i){e.oSessionHandler=new i(a);e.oSessionHandler.init({sessionTimeoutReminderInMinutes:y.sessionTimeoutReminderInMinutes,sessionTimeoutIntervalInMinutes:y.sessionTimeoutIntervalInMinutes,sessionTimeoutTileStopRefreshIntervalInMinutes:y.sessionTimeoutTileStopRefreshIntervalInMinutes,enableAutomaticSignout:y.enableAutomaticSignout});});},_getSessionHandler:function(){return this.oSessionHandler;},_navBack:function(){this.setMeAreaSelected(false);a.service().navigateBack();},_updateUserPrefModel:function(e){var i=this._getModelEntryFromEntryObject(e),z=C.last("/core/userPreferences/entries");z.push(i);z=this._reorderUserPrefEntries(z);C.emit("/core/userPreferences/entries",z);},_updateProfilingModel:function(e){var i=this._getModelEntryFromEntryObject(e),z=C.last("/core/userPreferences/profiling")||[];z.push(i);C.emit("/core/userPreferences/profiling",z);},_getModelEntryFromEntryObject:function(e){return{"entryHelpID":e.entryHelpID,"title":e.title,"valueArgument":e.value,"valueResult":null,"onSave":e.onSave,"onCancel":e.onCancel,"contentFunc":e.content,"contentResult":null,"icon":e.icon,"provideEmptyWrapper":e.provideEmptyWrapper};},_reorderUserPrefEntries:function(e){var z,B;for(var i=0;i<e.length;i++){if(e[i].entryHelpID==="flpSettingsEntry"){z=i;}else if(e[i].entryHelpID==="themes"){B=i;}if(z!=undefined&&B!=undefined){var G=e.splice(z,1);e.splice(B+1,0,G[0]);break;}}return e;},getModel:function(){return w;},_getConfig:function(){return y||{};},_getPersData:function(e){var i=d.getOwnerComponentFor(this.getView());return new Promise(function(z,B){sap.ushell.Container.getServiceAsync("Personalization").then(function(G){var J={keyCategory:G.constants.keyCategory.FIXED_KEY,writeFrequency:G.constants.writeFrequency.LOW,clientStorageAllowed:true};var K=G.getPersonalizer(e,J,i);K.getPersData().then(z).fail(B);});});},_getCurrentLocationHash:function(){return window.location.hash;},setMeAreaSelected:function(e){E.emit("showMeArea",e);},getMeAreaSelected:function(){return C.last("/core/shell/model/currentViewPortState")==="LeftCenter";},setNotificationsSelected:function(e){E.emit("showNotifications",e);},getNotificationsSelected:function(){return C.last("/core/shell/model/currentViewPortState")==="RightCenter";}});});
