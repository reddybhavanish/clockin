// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/library","sap/ui/Device","sap/ui/core/HTML","sap/ushell/components/_HeaderManager/ControlManager","sap/ushell/components/HeaderManager","sap/ushell/components/_HeaderManager/ShellHeader.controller","sap/ushell/ui/footerbar/ContactSupportButton","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/m/Button","sap/m/Dialog","sap/ushell/resources","sap/ushell/utils","sap/ushell/Config","sap/ushell/EventHub","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/ui/core/library"],function(l,D,H,a,b,S,C,A,B,c,r,u,d,E,J,q,e){"use strict";var V=e.mvc.ViewType;var f=l.AppTitleState;function s(i,o){return sap.ui.getCore().byId(o.getObject());}sap.ui.jsview("sap.ushell.renderers.fiori2.Shell",{createContent:function(o){this.oController=o;var v=this.getViewData()||{},g=v.config||{};this.oConfig=g;this.aDanglingControls=[];this._allowUpToThreeActionInShellHeader(g);var U=sap.ui.xmlfragment("sap.ushell.ui.ShellLayout",o),h=this.createShellHeader(g,this.getViewData().shellModel);U.setHeader(h);h.setShellLayout(U);E.once("CreateToolArea").do(function(){sap.ui.require(["sap/ushell/ui/shell/ToolArea"],function(T){var i=new T({id:"shell-toolArea",toolAreaItems:{path:"/currentState/toolAreaItems",factory:s}});i.updateAggregation=this.updateShellAggregation;i.addEventDelegate({onAfterRendering:function(){U.applySplitContainerSecondaryContentSize();}});U.setToolArea(i);}.bind(this));}.bind(this));this.setOUnifiedShell(U);this.setDisplayBlock(true);this.addDanglingControl(sap.ui.getCore().byId("viewPortContainer"));this.logonIFrameReference=null;u.setPerformanceMark("FLP - Shell.view rendering started!");return U;},_allowUpToThreeActionInShellHeader:function(o){if(Object.keys(o).length>3){var p=["moveAppFinderActionToShellHeader","moveUserSettingsActionToShellHeader","moveGiveFeedbackActionToShellHeader","moveContactSupportActionToShellHeader","moveEditHomePageActionToShellHeader"],g=0,P;for(var i=0;i<5;i++){P=p[i];if(g===3){o[P]=false;}else if(o[P]){g++;}}}},createShellHeader:function(o,g){var h=d.createModel("/core/shellHeader",J),i=new S(),j;a.init(o,i,g);j=sap.ui.xmlfragment("sap.ushell.ui.ShellHeader",i);if(D.system.desktop){j.setAccessKeyHandler(sap.ushell.renderers.fiori2.AccessKeysHandler);var k=j.getAppTitle();k.addEventDelegate({onsapskipforward:function(m){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){m.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}}});}if(o.appState==="embedded"){j.setNoLogo();}j.setModel(h);j.setModel(r.i18nModel,"i18n");this.addEventDelegate({"onBeforeRendering":function(){j.createUIArea(this.getUIArea().getId());}},this);return j;},createPostCoreExtControls:function(){sap.ui.require(["sap/ushell/ui/shell/FloatingContainer","sap/ushell/ui/shell/ShellFloatingActions"],function(F,g){var o=sap.ui.getCore().byId("shell");if(!o){return;}var h=new F({id:"shell-floatingContainer",content:{path:"/currentState/floatingContainerContent",factory:s}});if(D.system.desktop){h.addCustomData(new A({key:"tabindex",value:"-1",writeToDom:true}));h.addEventDelegate({onsapskipforward:function(k){k.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(k);},onsapskipback:function(k){if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){k.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}}});}h.setModel(o.getModel());this.addDanglingControl(h);var i=new g({id:"shell-floatingActions",floatingActions:{path:"/currentState/floatingActions",factory:s}});i.updateAggregation=this.updateShellAggregation;var j=this.getOUnifiedShell();j.setFloatingContainer(h);j.setFloatingActionsContainer(i);this._createAllMyAppsView();}.bind(this));},_createAllMyAppsView:function(){var m=this.getModel(),o=function(g){if(g.isEnabled()){this.oAllMyAppsView=sap.ui.view("allMyAppsView",{type:V.JS,viewName:"sap.ushell.renderers.fiori2.allMyApps.AllMyApps",viewData:{_fnGetShellModel:function(){return m;}},async:true,height:"100%",visible:{path:"/ShellAppTitleState",formatter:function(h){return h!==f.ShellNavMenu;}}}).addStyleClass("sapUshellAllMyAppsView");this.oAllMyAppsView.addCustomData(new A({key:"aria-label",value:r.i18n.getText("allMyApps_headerTitle"),writeToDom:true}));this.getOUnifiedShell().getHeader().getAppTitle().setAllMyApps(this.oAllMyAppsView);}}.bind(this);sap.ushell.Container.getServiceAsync("AllMyApps").then(o);},getOUnifiedShell:function(){return this.oUnifiedShell;},setOUnifiedShell:function(U){this.oUnifiedShell=U;},updateShellAggregation:function(n){var o=this.mBindingInfos[n],g=this.getMetadata().getJSONKeys()[n],h;q.each(this[g._sGetter](),function(i,v){this[g._sRemoveMutator](v);}.bind(this));q.each(o.binding.getContexts(),function(i,v){h=o.factory(this.getId()+"-"+i,v)?o.factory(this.getId()+"-"+i,v).setBindingContext(v,o.model):"";this[g._sMutator](h);}.bind(this));},getControllerName:function(){return"sap.ushell.renderers.fiori2.Shell";},createIFrameDialog:function(){var o=null,L=this.logonIFrameReference,g;var _=function(){if(L){L.remove();}return q("<iframe id=\"SAMLDialogFrame\" src=\"\" frameborder=\"0\" height=\"100%\" width=\"100%\"></iframe>");};var h=function(){o.addStyleClass("sapUshellSamlDialogHidden");q("#sap-ui-blocklayer-popup").addClass("sapUshellSamlDialogHidden");};this.destroyIFrameDialog();var i=new B({text:r.i18n.getText("samlCloseBtn"),press:function(){sap.ushell.Container.cancelLogon();}});var j=new H("SAMLDialogFrame");this.logonIFrameReference=_();j.setContent(this.logonIFrameReference.prop("outerHTML"));o=new c({id:"SAMLDialog",title:r.i18n.getText("samlDialogTitle"),contentWidth:"50%",contentHeight:"50%",rightButton:i}).addStyleClass("sapUshellIframeDialog").addStyleClass("sapContrastPlus");g=d.last("/core/extension/SupportTicket");if(g){var k=new C();k.setWidth("150px");k.setIcon("");o.setLeftButton(k);}o.addContent(j);o.open();h();this.logonIFrameReference=q("#SAMLDialogFrame");return this.logonIFrameReference[0];},destroyIFrameDialog:function(){var g=sap.ui.getCore().byId("SAMLDialog");if(g){g.destroy();}this.logonIFrameReference=null;},showIFrameDialog:function(){var o=sap.ui.getCore().byId("SAMLDialog");if(o){o.removeStyleClass("sapUshellSamlDialogHidden");q("#sap-ui-blocklayer-popup").removeClass("sapUshellSamlDialogHidden");}},addDanglingControl:function(o){this.aDanglingControls.push(o);},destroyDanglingControls:function(){if(this.aDanglingControls){this.aDanglingControls.forEach(function(o){if(o.destroyContent){o.destroyContent();}o.destroy();});}}});});
