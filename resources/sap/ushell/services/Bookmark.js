// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ushell/Config"],function(q,C){"use strict";function B(){var l=sap.ushell.Container.getService("LaunchPage");this._isMatchingRemoteCatalog=function(c,r){var o=l.getCatalogData(c);return o.remoteId===r.remoteId&&o.baseUrl.replace(/\/$/,"")===r.baseUrl.replace(/\/$/,"");};this.addBookmark=function(p,g){var d=new q.Deferred();if(C.last("/core/spaces/enabled")){var e="Bookmark Service: The API 'addBookmark' is not supported in launchpad spaces mode.";return d.reject(e).promise();}if(!C.last("/core/shell/enablePersonalization")){return d.resolve().promise();}d=l.addBookmark(p,g);d.done(function(t){var D={tile:t,group:g};sap.ui.getCore().getEventBus().publish("sap.ushell.services.Bookmark","bookmarkTileAdded",D);});return d;};this.addBookmarkToPage=function(p,P){var d=new q.Deferred();if(!C.last("/core/spaces/enabled")){return d.reject("Bookmark Service: 'addBookmarkToPage' is not valid in launchpad homepage mode, use 'addBookmark' instead.").promise();}if(!C.last("/core/shell/enablePersonalization")){return d.reject("Bookmark Service: Add bookmark is not allowed as the personalization functionality is not enabled.").promise();}if(p&&(typeof p.title!=="string"||typeof p.url!=="string")){return d.reject("Bookmark Service - Invalid bookmark data.").promise();}sap.ushell.Container.getServiceAsync("Pages").then(function(a){a.addBookmarkToPage(P,p);}).then(function(){d.resolve();}).catch(function(e){d.reject(e);});return d.promise();};this.addBookmarkByGroupId=function(p,g){if(C.last("/core/spaces/enabled")){var e="Bookmark Service: The API 'addBookmarkByGroupId' is not supported in launchpad spaces mode.";return q.Deferred().reject(e).promise();}return l.getGroups().then(function(G){G=q.grep(G,function(a){return a.id===g;});var o=null;if(G.length>0){o=G[0];}return this.addBookmark(p,o);}.bind(this));};this.getShellGroupIDs=function(g){if(C.last("/core/spaces/enabled")){var e="Bookmark Service: The API 'getShellGroupIDs' is not supported in launchpad spaces mode.";return q.Deferred().reject(e).promise();}var d=new q.Deferred();l.getGroupsForBookmarks(g).done(function(G){G=G.map(function(a){var n={id:l.getGroupId(a.object),title:a.title};return n;});d.resolve(G);});return d;};this._doAddCatalogTileToGroup=function(d,c,o,g){var e,f=d.reject.bind(d);function i(c,b){var I=l.getCatalogTileId(b);if(I===undefined){return false;}return I.indexOf(c)===0;}function a(G){l.getCatalogTiles(o).fail(f).done(function(b){var g=l.getGroupId(G),t=b.some(function(h){if(i(c,h)){l.addTile(h,G).fail(f).done(function(){d.resolve();sap.ui.getCore().getEventBus().publish("sap.ushell.services.Bookmark","catalogTileAdded",g);});return true;}});if(!t){e="No tile '"+c+"' in catalog '"+l.getCatalogId(o)+"'";q.sap.log.error(e,null,"sap.ushell.services.Bookmark");f(e);}});}if(g){l.getGroups().fail(f).done(function(G){var b=G.some(function(h){if(l.getGroupId(h)===g){a(h);return true;}});if(!b){e="Group '"+g+"' is unknown";q.sap.log.error(e,null,"sap.ushell.services.Bookmark");f(e);}});}else{l.getDefaultGroup().fail(f).done(a);}return d.promise();};this.addCatalogTileToGroup=function(c,g,o){var d=new q.Deferred(),e,f=d.reject.bind(d),m,L="X-SAP-UI2-HANA:hana?remoteId=HANA_CATALOG",t=this;if(C.last("/core/spaces/enabled")){e="Bookmark Service: The API 'addCatalogTileToGroup' is not supported in launchpad spaces mode.";return d.reject(e).promise();}function i(a){return l.getCatalogId(a)===L;}m=o?this._isMatchingRemoteCatalog:i;o=o||{id:L};l.onCatalogTileAdded(c);l.getCatalogs().fail(f).done(function(a){var s;a.forEach(function(b){if(m(b,o)){if(!s){s=b;}else{q.sap.log.warning("More than one matching catalog: "+JSON.stringify(o),null,"sap.ushell.services.Bookmark");}}});if(s){t._doAddCatalogTileToGroup(d,c,s,g);}else{e="No matching catalog found: "+JSON.stringify(o);q.sap.log.error(e,null,"sap.ushell.services.Bookmark");d.reject(e);}});return d.promise();};this.countBookmarks=function(u){if(C.last("/core/spaces/enabled")){var e="Bookmark Service: The API 'countBookmarks' is not supported in launchpad spaces mode.";return q.Deferred().reject(e).promise();}return l.countBookmarks(u);};this.deleteBookmarks=function(u){if(C.last("/core/spaces/enabled")){var e="Bookmark Service: The API 'deleteBookmarks' is not supported in launchpad spaces mode.";return q.Deferred().reject(e).promise();}var p=l.deleteBookmarks(u);p.done(function(){sap.ui.getCore().getEventBus().publish("sap.ushell.services.Bookmark","bookmarkTileDeleted",u);});return p;};this.updateBookmarks=function(u,p){if(C.last("/core/spaces/enabled")){var e="Bookmark Service: The API 'updateBookmarks' is not supported in launchpad spaces mode.";return q.Deferred().reject(e).promise();}return l.updateBookmarks(u,p);};}B.hasNoAdapter=true;return B;},true);
