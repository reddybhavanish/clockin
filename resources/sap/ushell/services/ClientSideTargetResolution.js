// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/services/_ClientSideTargetResolution/SystemContext","sap/ushell/services/_ClientSideTargetResolution/Utils","sap/ushell/services/AppConfiguration","sap/ushell/services/_ClientSideTargetResolution/InboundProvider","sap/ushell/services/_ClientSideTargetResolution/InboundIndex","sap/ushell/services/_ClientSideTargetResolution/VirtualInbounds","sap/ushell/services/_ClientSideTargetResolution/Search","sap/ushell/services/_ClientSideTargetResolution/StagedLogger","sap/ushell/services/_ClientSideTargetResolution/Formatter","sap/ushell/services/_ClientSideTargetResolution/ParameterMapping","sap/ushell/services/_ClientSideTargetResolution/PrelaunchOperations","sap/ushell/services/_ClientSideTargetResolution/XAppStateProcessing","sap/ushell/navigationMode","sap/ushell/Config","sap/ushell/ApplicationType","sap/ui/thirdparty/URI","sap/ushell/_ApplicationType/systemAlias","sap/ushell/TechnicalParameters","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery","sap/base/util/isPlainObject"],function(u,S,c,a,I,b,V,s,l,f,p,P,x,n,C,A,U,d,T,O,q,i){"use strict";function g(o,e,h,j){this._init.apply(this,arguments);}g.prototype._init=function(o,e,h,j){this._iLogId=0;sap.ui.lazyRequire("sap/ui/generic/app/navigation/service/SelectionVariant");if(!this._implementsServiceInterface(o)){q.sap.log.error("Cannot get Inbounds","ClientSideTargetResolutionAdapter should implement getInbounds method","sap.ushell.services.ClientSideTargetResolution");return;}this._oInboundProvider=new I(o.getInbounds.bind(o));this._oHaveEasyAccessSystemsDeferreds={userMenu:null,sapMenu:null};this._oServiceConfiguration=j;this._oAdapter=o;};g.prototype._implementsServiceInterface=function(o){if(typeof o.getInbounds==="function"){return true;}return false;};g.prototype._getURLParsing=function(){if(!this._oURLParsing){this._oURLParsing=sap.ushell.Container.getService("URLParsing");}return this._oURLParsing;};g.prototype._extractInboundFilter=function(o){if(!this._oAdapter.hasSegmentedAccess){return undefined;}if(typeof o!=="string"){return undefined;}var F=o.indexOf("#")===0?o:"#"+o;var e=this._getURLParsing().parseShellHash(F);if(!e||!e.semanticObject||!e.action){return undefined;}return[{semanticObject:e.semanticObject,action:e.action}];};g.prototype.resolveHashFragment=function(h){var t=this,D=new q.Deferred(),B=this._oAdapter.resolveHashFragmentFallback&&this._oAdapter.resolveHashFragmentFallback.bind(this._oAdapter),e=this._extractInboundFilter(h);this._oInboundProvider.getInbounds(e).then(function(j){t._resolveHashFragment(h,B,j).done(function(o){return D.resolve(o);}).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};g.prototype.resolveTileIntent=function(h){var t=this,D=new q.Deferred(),e=this._extractInboundFilter(h);this._oInboundProvider.getInbounds(e).then(function(o){t._resolveTileIntent(h,undefined,o).done(D.resolve.bind(D)).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};g.prototype.resolveTileIntentInContext=function(e,h){var o,D=new q.Deferred();o=b.createIndex(e.concat(V.getInbounds()));this._resolveTileIntent(h,undefined,o).done(D.resolve.bind(D)).fail(D.reject.bind(D));return D.promise();};g.prototype._resolveHashFragment=function(h,B,e){var j=this._getURLParsing(),t=this,D=new q.Deferred(),F=h.indexOf("#")===0?h:"#"+h,k=j.parseShellHash(F);if(k===undefined){q.sap.log.error("Could not parse shell hash '"+h+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return D.reject().promise();}k.formFactor=u.getFormFactor();this._getMatchingInbounds(k,e,{bExcludeTileInbounds:true}).fail(function(E){q.sap.log.error("Could not resolve "+h,"_getMatchingInbounds promise rejected with: "+E,"sap.ushell.services.ClientSideTargetResolution");D.reject(E);}).done(function(m){var M;if(m.length===0){q.sap.log.warning("Could not resolve "+h,"rejecting promise","sap.ushell.services.ClientSideTargetResolution");D.reject("Could not resolve navigation target");return;}m=t._applySapNavigationScopeFilter(m,k);M=m[0];c.whenDebugEnabled(function(){function o(K,w){return this[K]===undefined?"<undefined>":w;}function r(w,y){return(w==="_original")?undefined:o.call(this,w,y);}var v=JSON.stringify(M,r,"   ");q.sap.log.debug("The following target will now be resolved",v,"sap.ushell.services.ClientSideTargetResolution");});t._resolveSingleMatchingTarget(M,B,F).done(function(o){D.resolve(o);}).fail(D.reject.bind(D));});return D.promise();};g.prototype._applySapNavigationScopeFilter=function(m,o){var e=o&&o.params&&o.params["sap-navigation-scope-filter"];if(!e){return m;}var F=m.filter(function(M){var h=O.get("inbound.signature.parameters",M);var j=h&&h["sap-navigation-scope"];if(j){return e[0]===j.defaultValue.value;}});return F.length>0?F:m;};g.prototype._resolveSingleMatchingTarget=function(m,B,F){var t=this,D=new q.Deferred(),o=this._getURLParsing(),e=o.parseShellHash(F),h=[e.semanticObject,e.action].join("-"),j=(m.inbound.resolutionResult||{}).applicationType;var E;if(this._oAdapter.resolveSystemAlias){E=this._oAdapter.resolveSystemAlias.bind(this._oAdapter);}var k=A.getEasyAccessMenuResolver(h,j);if(k){k(e,m,E).then(function(R){var N=n.compute(O.get("inbound.resolutionResult.applicationType",m),(m.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0],(m.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(a.getCurrentApplication()||{}).applicationType,C.last("/core/navigation/enableInPlaceForClassicUIs"));u.shallowMergeObject(R,N);R.inboundPermanentKey=m.inbound.permanentKey||m.inbound.id;D.resolve(R);},function(v){D.reject(v);});return D.promise();}var r=this._getReservedParameters(m);p.mapParameterNamesAndRemoveObjects(m);x.mixAppStateIntoResolutionResultAndRename(m,sap.ushell.Container.getService("AppState")).done(function(m){var R=function(){return t._constructFallbackResolutionResult.call(t,m,B,F);};if(A[j]){R=A[j].generateResolutionResult;}delete m.intentParamsPlusAllDefaults["sap-tag"];delete m.mappedIntentParamsPlusSimpleDefaults["sap-tag"];m.mappedDefaultedParamNames=m.mappedDefaultedParamNames.filter(function(w){return w!=="sap-tag";});var v=O.get("inbound.resolutionResult.url",m);P.executePrelaunchOperations(m,r["sap-prelaunch-operations"]).then(function(){return R(m,v,E);}).then(function(w){w.reservedParameters=r;w.inboundPermanentKey=m.inbound.permanentKey||m.inbound.id;return w;}).then(function(w){q.sap.log.debug("Intent was resolved to the following target",JSON.stringify(m.resolutionResult,null,3),"sap.ushell.services.ClientSideTargetResolution");u.shallowMergeObject(m.resolutionResult,w);D.resolve(m.resolutionResult);},function(M){if(typeof M==="string"&&M.indexOf("fallback:")>=0){t._constructFallbackResolutionResult.call(this,m,B,F).then(function(w){u.shallowMergeObject(m.resolutionResult,w);D.resolve(m.resolutionResult);},D.reject.bind(D));}else{D.reject(M);}});});return D.promise();};g.prototype._getReservedParameters=function(m){var r=T.getParameters({injectFrom:"startupParameter"}).map(function(o){return o.name;});var R=c.extractParameters(r,m.intentParamsPlusAllDefaults);T.getParameters({injectFrom:"inboundParameter"}).forEach(function(o){var e=o.name;var h=m.inbound&&m.inbound.signature&&m.inbound.signature.parameters;if(h&&Object.keys(h).length>0){var j=h[e];var k=j&&j.defaultValue&&j.defaultValue.hasOwnProperty("value");var t=j&&j.filter&&j.filter.hasOwnProperty("value");if(j&&(t||k)){if(k){R[e]=j.defaultValue.value;}else{R[e]=j.filter.value;}}else{delete R[e];}delete m.intentParamsPlusAllDefaults[e];var v=m.defaultedParamNames.indexOf(e);if(v>=0){m.defaultedParamNames.splice(v,1);}}});return R;};g.prototype._resolveTileIntent=function(h,B,o){var e=this._getURLParsing(),t=this,D=new q.Deferred(),F=h.indexOf("#")===0?h:"#"+h,j=e.parseShellHash(F);if(j===undefined){q.sap.log.error("Could not parse shell hash '"+h+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return D.reject("Cannot parse shell hash").promise();}j.formFactor=u.getFormFactor();this._getMatchingInbounds(j,o,{bExcludeTileInbounds:false}).fail(function(E){q.sap.log.error("Could not resolve "+h,"_getMatchingInbounds promise rejected with: "+E,"sap.ushell.services.ClientSideTargetResolution");D.reject(E);}).done(function(m){var M;if(m.length===0){q.sap.log.warning("Could not resolve "+h,"no matching targets were found","sap.ushell.services.ClientSideTargetResolution");D.reject("No matching targets found");return;}M=m[0];t._resolveSingleMatchingTileIntent(M,B,F).done(D.resolve.bind(D)).fail(D.reject.bind(D));});return D.promise();};g.prototype._resolveSingleMatchingTileIntent=function(m,B,F){var D=new q.Deferred(),e=(m.inbound.resolutionResult||{}).applicationType,t=this;var E;if(this._oAdapter.resolveSystemAlias){E=this._oAdapter.resolveSystemAlias.bind(this._oAdapter);}p.mapParameterNamesAndRemoveObjects(m);x.mixAppStateIntoResolutionResultAndRename(m,sap.ushell.Container.getService("AppState")).done(function(m){var r=function(){return t._constructFallbackResolutionResult.call(t,m,B,F);};if(A[e]){r=A[e].generateResolutionResult;}delete m.intentParamsPlusAllDefaults["sap-tag"];delete m.mappedIntentParamsPlusSimpleDefaults["sap-tag"];m.mappedDefaultedParamNames=m.mappedDefaultedParamNames.filter(function(j){return j!=="sap-tag";});var h=O.get("inbound.resolutionResult.url",m);r(m,h,E).then(function(R){u.shallowMergeObject(m.resolutionResult,R);var o=q.extend(true,{},m.inbound.tileResolutionResult);o.startupParameters=m.effectiveParameters;o.navigationMode=m.resolutionResult.navigationMode;if(!o.navigationMode){o.navigationMode=n.getNavigationMode(m.resolutionResult);}D.resolve(o);q.sap.log.debug("Tile Intent was resolved to the following target",JSON.stringify(o,null,3),"sap.ushell.services.ClientSideTargetResolution");},function(M){D.reject(M);});});return D.promise();};g.prototype._constructFallbackResolutionResult=function(m,B,F){var e={},D;Object.keys(m.intentParamsPlusAllDefaults).forEach(function(h){if(Array.isArray(m.intentParamsPlusAllDefaults[h])){e[h]=m.intentParamsPlusAllDefaults[h];}});D=m.mappedDefaultedParamNames||m.defaultedParamNames;if(D.length>0){e["sap-ushell-defaultedParameterNames"]=[JSON.stringify(D)];}if(typeof B!=="function"){q.sap.log.error("Cannot resolve hash fragment",F+" has matched an inbound that cannot be resolved client side and no resolveHashFragmentFallback method was implemented in ClientSideTargetResolutionAdapter","sap.ushell.services.ClientSideTargetResolution");return Promise.reject("Cannot resolve hash fragment: no fallback provided.");}q.sap.log.warning("Cannot resolve hash fragment client side",F+" has matched an inbound that cannot be resolved client side. Using fallback logic","sap.ushell.services.ClientSideTargetResolution");return new Promise(function(r,R){B(F,q.extend(true,{},m.inbound),e).done(function(o){var h={};["applicationType","additionalInformation","url","applicationDependencies","text"].forEach(function(j){if(o.hasOwnProperty(j)){h[j]=o[j];}});r(h);}).fail(R.bind(null));});};g.prototype.getDistinctSemanticObjects=function(){var D=new q.Deferred();this._oInboundProvider.getInbounds().then(function(o){var e={};o.getAllInbounds().forEach(function(h){if(typeof h.semanticObject==="string"&&h.semanticObject!=="*"&&!h.hideIntentLink&&h.semanticObject.length>0){e[h.semanticObject]=true;}});D.resolve(Object.keys(e).sort());},function(){D.reject.apply(D,arguments);});return D.promise();};g.prototype.getLinks=function(o){var N,t=this,e,m,h,D=new q.Deferred(),j;if(arguments.length===1&&i(arguments[0])){N=arguments[0];j=q.extend(true,{},N);["action","semanticObject"].forEach(function(k){if(N.hasOwnProperty(k)){j[k]=N[k];}});if(j.appStateKey){j.params=j.params||{};j.params["sap-xapp-state"]=[j.appStateKey];delete j.appStateKey;}}else if(arguments.length<=3){q.sap.log.warning("Passing positional arguments to getLinks is deprecated","Please use nominal arguments instead","sap.ushell.services.ClientSideTargetResolution");e=arguments[0];m=arguments[1];h=arguments[2];j={semanticObject:e,params:m,ignoreFormFactor:h};}else{return D.reject("invalid arguments for getLinks").promise();}this._oInboundProvider.getInbounds().then(function(k){t._getLinks(j,k).done(D.resolve.bind(D)).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};g.prototype._validateGetSemanticObjectLinksArgs=function(o){var e=o.semanticObject,h=o.action,j=!o.hasOwnProperty("action");if(typeof e!=="undefined"||j){if(typeof e!=="string"){q.sap.log.error("invalid input for _getLinks","the semantic object must be a string, got "+Object.prototype.toString.call(e)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object";}if(j&&e.match(/^\s+$/)){q.sap.log.error("invalid input for _getLinks","the semantic object must be a non-empty string, got '"+e+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object";}if(!j&&e.length===0){q.sap.log.error("invalid input for _getLinks","the semantic object must not be an empty string, got '"+e+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object";}}if(typeof h!=="undefined"){if(typeof h!=="string"){q.sap.log.error("invalid input for _getLinks","the action must be a string, got "+Object.prototype.toString.call(h)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action";}if(h.length===0){q.sap.log.error("invalid input for _getLinks","the action must not be an empty string, got '"+h+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action";}}return undefined;};g.prototype._getLinks=function(o,e){var h=o.semanticObject,j=o.action,m=o.params,w=!!o.withAtLeastOneUsedParam,t=!!o.treatTechHintAsFilter,k=o.ignoreFormFactor,r=o.hasOwnProperty("sortResultsBy")?o.sortResultsBy:"intent";if(o.hasOwnProperty("sortResultOnTexts")){q.sap.log.warning("the parameter 'sortResultOnTexts' was experimantal and is no longer supported","getLinks results will be sorted by '"+r+"'","sap.ushell.services.ClientsideTargetResolution");}var v={bExcludeTileInbounds:true};var E=this._validateGetSemanticObjectLinksArgs(o);if(o.tags){v.tags=o.tags;}if(E){return new q.Deferred().reject(E).promise();}if(h==="*"){return q.when([]);}function y(z,m){var H=z.paramsToString(m);return H?"?"+H:"";}var z=this._getURLParsing(),D=new q.Deferred(),F=u.getFormFactor(),B=z.parseParameters(y(z,m)),G={semanticObject:(h===""?undefined:h),action:j,formFactor:(k?undefined:F),params:B};if(t){G.treatTechHintAsFilter=true;}this._getMatchingInbounds(G,e,v).done(function(M){var H={},R=M.map(function(L){var N=h||L.inbound.semanticObject,Q="#"+N+"-"+L.inbound.action,W;if(N==="*"){return undefined;}if(L.inbound.action==="*"){return undefined;}if(L.inbound&&L.inbound.hasOwnProperty("hideIntentLink")&&L.inbound.hideIntentLink===true){return undefined;}if(!H.hasOwnProperty(Q)){H[Q]={matchingInbound:L.inbound,count:1};if(L.inbound.signature.additionalParameters==="ignored"){W=c.filterObjectKeys(B,function(_){return(_.indexOf("sap-")===0)||L.inbound.signature.parameters.hasOwnProperty(_);},false);}else{W=B;}if(w){var X=Object.keys(W).some(function(_){return _.indexOf("sap-")!==0;});if(!X){H[Q].hideReason="getLinks called with 'withAtLeastOneUsedParam = true', but the inbound had no business parameters defined.";return undefined;}}var Y=c.inboundSignatureMeetsParameterOptions(L.inbound.signature.parameters,o.paramsOptions||[]);if(!Y){H[Q].hideReason="inbound signature does not meet the requested parameter filter options";return undefined;}var Z={"intent":Q+y(z,W),"text":L.inbound.title};if(L.inbound.icon){Z.icon=L.inbound.icon;}if(L.inbound.subTitle){Z.subTitle=L.inbound.subTitle;}if(L.inbound.shortTitle){Z.shortTitle=L.inbound.shortTitle;}var $=O.get("inbound.signature.parameters.sap-tag.defaultValue.value",L);if($){Z.tags=[$];}return Z;}H[Q].count++;return undefined;}).filter(function(L){return typeof L==="object";});if(r!=="priority"){R.sort(function(L,N){return L[r]<N[r]?-1:1;});}if(R.length===0){q.sap.log.debug("_getLinks returned no results");}else if(q.sap.log.getLevel()>=q.sap.log.Level.DEBUG){if(q.sap.log.getLevel()>=q.sap.log.Level.TRACE){var J=[];var K=[];R.forEach(function(L){var N=L.intent.split("?")[0];if(H[N].hideReason){K.push(["-",N+"("+H[N].hideReason+")\n"," text:",L.text+"\n"," full intent:",L.intent].join(" "));}else{J.push(["-",N,H[N].count>1?"("+(H[N].count-1)+" others matched)\n":"\n","text:",L.text+"\n","full intent:",L.intent].join(" "));}});q.sap.log.debug("_getLinks filtered to the following unique intents:","\n"+J.join("\n"),"sap.ushell.services.ClientSideTargetResolution");q.sap.log.debug("_getLinks would have also returned the following unique intents, but something prevented this:",K.join("\n"),"sap.ushell.services.ClientSideTargetResolution");}else{q.sap.log.debug("_getLinks filtered to unique intents.","Reporting histogram: \n - "+Object.keys(H).join("\n - "),"sap.ushell.services.ClientSideTargetResolution");}}D.resolve(R);}).fail(D.reject.bind(D));return D.promise();};g.prototype._getMatchingInbounds=function(o,e,h){var t=this,j,k,L,m,r,E,v,D=new q.Deferred();if(h){j=h.tags;E=h.bExcludeTileInbounds;}c.whenDebugEnabled(function(){L=++t._iLogId;});l.begin(function(){function w(M){var z=M.action||(typeof M.action==="undefined"?"<any>":"<invalid-value>");var B=M.semanticObject||(typeof M.semanticObject==="undefined"?"<any>":"<invalid-value>");return t._getURLParsing().constructShellHash({semanticObject:B,action:z,params:M.params});}var y=w(o);return{logId:L,title:"Matching Intent '"+y+"' to inbounds (form factor: "+(o.formFactor||"<any>")+")",moduleName:"sap.ushell.services.ClientSideTargetResolution",stages:["STAGE1: Find matching inbounds","STAGE2: Resolve references","STAGE3: Rematch with references","STAGE4: Sort matched targets"]};});r=o.semanticObject;k=o.action;this._oShellHash=o;m=j?e.getSegmentByTags(j):e.getSegment(r,k);if(E){v=m.filter(function(w){return!w.tileResolutionResult||!w.tileResolutionResult.isCustomTile;});}else{v=m;}s.match(o,v,{},c.isDebugEnabled()).then(function(w){l.log(function(){return{logId:L,stage:1,prefix:"\u2718",lines:Object.keys(w.noMatchReasons||{}).map(function(y){return y+" "+w.noMatchReasons[y];})};});l.log(function(){var y=w.matchResults.map(function(z){return f.formatInbound(z.inbound);});return{logId:L,stage:1,prefix:y.length>0?"\u2705":"\u2718",lines:y.length>0?y:["No inbound was matched"]};});var M=Object.keys(w.missingReferences||[]);if(M.length===0){l.log(function(){return{logId:L,stage:2,prefix:"\u2705",line:"No need to resolve references"};});return new q.Deferred().resolve({matchResults:w.matchResults,referencesToInclude:null}).promise();}l.log(function(){return{logId:L,stage:2,line:"@ Must resolve the following references:",prefix:"\u2022",lines:M};});var R=new q.Deferred();sap.ushell.Container.getService("ReferenceResolver").resolveReferences(M).done(function(y){l.log(function(){return{logId:L,stage:2,line:"\u2705 resolved references with the following values:",prefix:"\u2022",lines:Object.keys(y).map(function(z){return z+": '"+y[z]+"'";})};});R.resolve({matchResults:w.matchResults,referencesToInclude:y});}).fail(function(y){l.log(function(){return{logId:L,stage:2,prefix:"\u274c",line:"Failed to resolve references: "+y};});D.resolve([]);});return R.promise();}).then(function(w){var M,y,R=w.referencesToInclude;if(!R){l.log(function(){return{logId:L,stage:3,line:"rematch was skipped (no references to resolve)",prefix:"\u2705"};});return new q.Deferred().resolve(w).promise();}y=w.matchResults;M=y.map(function(z){return z.inbound;});return s.match(o,M,R,0).then(function(F){l.log(function(){var y=F.matchResults||[];if(y.length>=1){return{logId:L,stage:3,line:"The following inbounds re-matched:",lines:y.map(function(z){return f.formatInbound(z.inbound);}),prefix:"\u2705"};}return{logId:L,stage:3,line:"No inbounds re-matched",prefix:"-"};});return F;});}).then(function(F){var M=F.matchResults||[];if(M.length<=1){l.log(function(){return{logId:L,stage:4,line:"Nothing to sort"};});D.resolve(M);return;}var w=s.sortMatchingResultsDeterministic(F.matchResults||[]);l.log(function(){var y=w.map(function(z){return f.formatInbound(z.inbound||{})+(z.matchesVirtualInbound?" (virtual)":"")+"\n[ Sort Criteria ] "+"\n * 1 * sap-priority: '"+z["sap-priority"]+"'"+"\n * 2 * Sort string: '"+z.priorityString+"\n * 3 * Deterministic blob: '"+s.serializeMatchingResult(z)+"'";});return{logId:L,stage:4,line:"Sorted inbounds as follows:",lines:y,prefix:".",number:true};});D.resolve(w);});return D.promise().then(function(M){l.end(function(){return{logId:L};});return M;});};g.prototype._isIntentSupportedOne=function(e,o){var D=new q.Deferred(),h=this._getURLParsing().parseShellHash(e);if(e==="#"){D.resolve(true);return D.promise();}if(h===undefined){return D.reject("Could not parse shell hash '"+e+"'").promise();}h.formFactor=u.getFormFactor();this._getMatchingInbounds(h,o,{bExcludeTileInbounds:true}).done(function(t){D.resolve(t.length>0);}).fail(function(){D.reject();});return D.promise();};g.prototype.isIntentSupported=function(e){var t=this,D=new q.Deferred();this._oInboundProvider.getInbounds().then(function(o){t._isIntentSupported(e,o).done(D.resolve.bind(D)).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};g.prototype._isIntentSupported=function(e,o){var t=this,D=new q.Deferred(),m={};D.resolve();function h(j,k){m[j]={supported:k};}var r=[];e.forEach(function(j){var N=t._isIntentSupportedOne(j,o);N.fail(function(E){r.push(E);});N.done(function(k){h(j,k);});D=q.when(D,N);});var R=new q.Deferred();D.done(function(){R.resolve(m);}).fail(function(){R.reject("One or more input intents contain errors: "+r.join(", "));});return R.promise();};g.prototype.getUserDefaultParameterNames=function(){var t=this,D=new q.Deferred();this._oInboundProvider.getInbounds().then(function(o){var r;try{r=t._getUserDefaultParameterNames(o.getAllInbounds());D.resolve(r);}catch(e){D.reject("Cannot get user default parameters from inbounds: "+e);}},function(){D.reject.apply(D,arguments);});return D.promise();};g.prototype._getUserDefaultParameterNames=function(e){var r={simple:{},extended:{}};e.forEach(function(t){var o=t.signature&&t.signature.parameters||[];Object.keys(o).forEach(function(h){var j=o[h],R,E,k,m;if(j){if(j.filter&&j.filter.format==="reference"){k=j.filter.value;}else if(j.defaultValue&&j.defaultValue.format==="reference"){k=j.defaultValue.value;}if(typeof k==="string"){m=sap.ushell.Container.getService("ReferenceResolver");R=m.extractUserDefaultReferenceName(k);if(typeof R==="string"){r.simple[R]={};}E=m.extractExtendedUserDefaultReferenceName(k);if(typeof E==="string"){r.extended[E]={};}}}});});return r;};g.prototype.getEasyAccessSystems=function(m){var r={},o,v,D;m=m||"sapMenu";if(this._oHaveEasyAccessSystemsDeferreds[m]){return this._oHaveEasyAccessSystemsDeferreds[m].promise();}this._oHaveEasyAccessSystemsDeferreds[m]=new q.Deferred();D=this._oHaveEasyAccessSystemsDeferreds[m];function e(h,j,v){if(!h){return false;}var k=[h.semanticObject,h.action].join("-");return v[m][k]&&h.deviceTypes&&j!==undefined&&h.deviceTypes[j];}o=A.getEasyAccessMenuDefinitions().reduce(function(o,E){var h=E.easyAccessMenu.intent.split("-")[1];o[h]={appType:E.type,priority:E.easyAccessMenu.systemSelectionPriority};return o;},{});v={userMenu:A.getEasyAccessMenuDefinitions().reduce(function(h,E){var j=E.easyAccessMenu.intent;h[j]=E.easyAccessMenu.showSystemSelectionInUserMenu;return h;},{}),sapMenu:A.getEasyAccessMenuDefinitions().reduce(function(h,E){var j=E.easyAccessMenu.intent;h[j]=E.easyAccessMenu.showSystemSelectionInSapMenu;return h;},{})};this._oInboundProvider.getInbounds().then(function(h){var L={};h.getAllInbounds().filter(function(j){return e(j,u.getFormFactor(),v);}).forEach(function(E){var j;if(i(E.signature.parameters["sap-system"])&&E.signature.parameters["sap-system"].hasOwnProperty("filter")){j=O.get("signature.parameters.sap-system.filter.value",E);}if(typeof j==="string"){var k=o[E.action].priority;var t=o[E.action].appType;if(!r[j]){L[j]=-1;r[j]={appType:{}};}if(L[j]<k){r[j].text=E.title;L[j]=k;}r[j].appType[t]=true;}else{q.sap.log.warning("Cannot extract sap-system from easy access menu inbound: "+f.formatInbound(E),"This parameter is supposed to be a string. Got '"+j+"' instead.","sap.ushell.services.ClientSideTargetResolution");}});D.resolve(r);},function(){D.reject.apply(D,arguments);});return D.promise();};g.prototype.getSystemContext=function(e){return new Promise(function(r,h){var o;if(e===undefined){o=S.createDefaultSystemContext();r(o);}else{this._oAdapter.resolveSystemAlias(e).done(function(d){o=S.createSystemContextFromSystemAlias(d);r(o);}).fail(function(E){h(E);});}}.bind(this));};g.hasNoAdapter=false;return g;},true);
