// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/MessageBox","sap/ushell/Config","sap/ushell/resources","sap/m/Dialog","sap/m/Text","sap/m/Link","sap/m/Button","sap/m/VBox","sap/m/FormattedText","sap/ui/thirdparty/jquery","sap/m/MessageToast","sap/m/library","sap/ui/core/library"],function(M,C,r,D,T,L,B,V,F,q,a,m,c){"use strict";var b=m.ButtonType;var d=m.DialogType;var e=c.ValueState;var f=m.FlexRendertype;function g(){var s;this.init=function(S){s=S;return this;};this.show=function(t,h,p){if(!h){q.sap.log.error("Message must not be empty.");return;}if(s&&typeof s==="function"){s(t,h,p||{});}else{this.buildMessage(t,h,p||{});}};this.buildMessage=function(t,h,p){var o={title:p.title,actions:p.actions,details:p.details,onClose:p.callback},i;switch(t){case g.Type.ERROR:var j=this.createErrorDialog(h,o);j.open();return;case g.Type.CONFIRM:if(!p.actions){i="confirm";}else{o.icon=M.Icon.QUESTION;i="show";}break;case g.Type.INFO:i="info";this.buildAndSendMessageToast(h,p.duration||3000);return;default:o={duration:p.duration||3000};i="show";break;}this.sendMessageBox(h,i,o);};this.createErrorDialog=function(h,o){function i(E){var G=document.createElement("textarea");try{G.contentEditable=true;G.readonly=false;G.innerText=E;document.documentElement.appendChild(G);if(navigator.userAgent.match(/ipad|iphone/i)){var R=document.createRange();R.selectNodeContents(G);window.getSelection().removeAllRanges();window.getSelection().addRange(R);G.setSelectionRange(0,999999);}else{q(G).select();}document.execCommand("copy");a.show(r.i18n.getText("CopyWasSuccessful"));}catch(I){a.show(r.i18n.getText("CopyWasNotSuccessful"));}finally{q(G).remove();}}function j(E){var G=new B({text:r.i18n.getText(E),press:function(){var I=o.details;if(typeof o.details==="object"){I=JSON.stringify(o.details,null,"\t");}var J=[];J.push("Title: "+(w||"-"));J.push("Message: "+(h||"-"));J.push("Details: "+(I||"-"));i(J.join("\n"));}});G.setTooltip(r.i18n.getText("CopyToClipboardBtn_tooltip"));return G;}function k(E){var G=new B({text:r.i18n.getText(E),type:b.Emphasized,press:function(){sap.ui.require(["sap/ushell/ui/footerbar/ContactSupportButton"],function(I){var J=new I();if(J){J.showContactSupportDialog();J.destroy();}});x.destroy();}});G.setTooltip(r.i18n.getText("contactSupportBtn_tooltip"));return G;}function l(E){var G=E==="okDialogBtn"?b.Emphasized:b.Default;switch(E){case"contactSupportBtn":return k(E);case"CopyToClipboardBtn":return j(E);default:return new B({text:r.i18n.getText(E),type:G,press:function(){x.destroy();}});}}function n(H){var E=[],z=[];if(H){E.push("contactSupportBtn");}else{E.push("okDialogBtn");}E.push("CopyToClipboardBtn");E.push("cancelDialogBtn");E.forEach(function(G){z.push(l(G));});return z;}function p(x,z){z.forEach(function(E){x.addButton(E);});}function t(A){var E=new T({text:h});if(o.details){E.addStyleClass("sapUiSmallMarginBottom");}A.addItem(E);}function u(A){var E=o.details;if(typeof o.details==="object"){E=o.details.info;}var G=new L({text:r.i18n.getText("ViewDetails"),press:function(){var I=A.indexOfItem(G);A.removeItem(I);A.insertItem(new F({htmlText:E}),I);}});A.addItem(G);}function v(){var A=new V({renderType:f.Bare});t(A);if(o.details){u(A);}return A;}var w=o.title||r.i18n.getText("error"),x=new D({state:e.Error,title:w,type:d.Message,contentWidth:"30rem"}).addStyleClass("sapContrastPlus"),y=C.last("/core/extension/SupportTicket"),H=sap.ushell.Container&&y&&h!==r.i18n.getText("supportTicketCreationFailed"),z=n(H);p(x,z);var A=v();x.addContent(A);return x;};this.buildAndSendMessageToast=function(h,i){sap.ui.require(["sap/m/MessageToast"],function(a){a.show(h,{duration:i});});};this.sendMessageBox=function(h,t,o){if(M.hasOwnProperty(t)&&typeof M[t]==="function"){M[t](h,o);}else{q.sap.log.error("Unknown Message type: "+t);}};this.info=function(h,i){this.show(g.Type.INFO,h,{duration:i||3000});};this.error=function(h,t){h=(t!==undefined)?t+" , "+h:h;q.sap.log.error(h);this.show(g.Type.ERROR,h,{title:t});};this.confirm=function(h,i,t,A){this.show(g.Type.CONFIRM,h,{title:t,callback:i,actions:A});};}g.Type={INFO:0,ERROR:1,CONFIRM:2};g.hasNoAdapter=true;return g;},true);
