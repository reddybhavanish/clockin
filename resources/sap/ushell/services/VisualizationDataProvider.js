// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/ushell/Config"],function(r,C){"use strict";function V(){this.S_COMPONENT_NAME="sap.ushell.services.VisualizationDataProvider";this._init.apply(this,arguments);}V.prototype._init=function(l){this.oLaunchPageAdapter=l;this.oCatalogTilePromise=null;};V.prototype._getCatalogTileIndex=function(){if(this._oCatalogTileIndexPromise){return this._oCatalogTileIndexPromise;}if(!C.last("/core/spaces/vizInstantiation/enabled")){this._oCatalogTileIndexPromise=Promise.resolve({});return this._oCatalogTileIndexPromise;}var l=this.oLaunchPageAdapter;return l._getCatalogTileIndex();};V.prototype._getCatalogTiles=function(){if(this.oCatalogTilePromise){return this.oCatalogTilePromise;}var l=this.oLaunchPageAdapter;this.oCatalogTilePromise=new Promise(function(a,b){l.getCatalogs().then(function(c){var d=[];var e=[];var f=[];var o={};for(var i=0;i<c.length;i++){d.push(l.getCatalogTiles(c[i]).then(function(g){e.push(g);}));}jQuery.when.apply(null,d).done(function(){f=[].concat.apply([],e);for(var y=0;y<f.length;y++){o[l.getCatalogTileId(f[y])]=f[y];}a(o);}).fail(b);}).fail(b);});return this.oCatalogTilePromise;};V.prototype.getVisualizationData=function(){var l=this.oLaunchPageAdapter,c;return Promise.all([this._getCatalogTiles(),this._getCatalogTileIndex()]).then(function(R){var o=R[0];var a=R[1];return Object.keys(o).reduce(function(v,i){c=o[i];v[i]={title:l.getCatalogTilePreviewTitle(c),subTitle:l.getCatalogTilePreviewSubtitle(c),icon:l.getCatalogTilePreviewIcon(c),info:l.getCatalogTilePreviewInfo(c),size:l.getCatalogTileSize(c),indicatorDataSource:l.getCatalogTilePreviewIndicatorDataSource(c),url:l.getCatalogTileTargetURL(c),isCustomTile:l.isCustomTile&&l.isCustomTile(c)};if(a[i]){v[i]._instantiationData={platform:"ABAP",chip:a[i]};}return v;},{});}).catch(function(e){var E={component:this.S_COMPONENT_NAME,description:r.i18n.getText("VisualizationDataProvider.CannotLoadData"),detail:e};return Promise.reject(E);}.bind(this));};V.prototype.getVisualizationView=function(v,p){var l=this.oLaunchPageAdapter;p=p||false;return this._getCatalogTileById(v).then(function(c){return l.getCatalogTileView(c,p);});};V.prototype._getCatalogTileById=function(v){return this._getCatalogTiles().then(function(c){var o=c[v];if(!o){return Promise.reject("Visualization "+v+" not found");}return o;});};V.prototype._getAdapter=function(){return this.oLaunchPageAdapter;};V.hasNoAdapter=false;return V;});
