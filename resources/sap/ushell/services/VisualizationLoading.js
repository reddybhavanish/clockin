// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/m/library","sap/ushell/services/_VisualizationLoading/VizInstanceLocal","sap/ushell/services/_VisualizationLoading/VizInstanceDefault","sap/ushell/services/_VisualizationLoading/VizInstanceEmpty"],function(U,m,V,a,b){"use strict";var L=m.LoadState;var c={ABAP:"ABAP",local:"local",default:"default",card:"card",empty:"empty"};function d(){this._init.apply(this,arguments);}d.prototype._init=function(){};d.prototype.loadVisualizationData=function(){if(this.oCatalogTileRequest){return this.oCatalogTileRequest;}this.oCatalogTileRequest=sap.ushell.Container.getService("VisualizationDataProvider")._getCatalogTiles().then(function(C){this._oCatalogTiles=C;return Promise.resolve();}.bind(this)).catch(function(e){return Promise.reject(e);});return this.oCatalogTileRequest;};d.prototype.instantiateVisualization=function(v){var o,e,C;try{if(v.isBookmark){C=this._getBookmarkChipInstance(v);e=this._prepareDefaultConfig(v,C);o=new a(e.oInitData);o.load({isBookmark:true,chip:C});return o;}}catch(E){o=new b({visualizationId:v.vizId,vizType:c.empty,state:L.Failed});o.load();return o;}if(!v.localLoad){if(!v.vizId){return{};}if(!this._oCatalogTiles){this.loadVisualizationData();o=new b({visualizationId:v.vizId,vizType:c.empty,state:L.Loaded});o.load();return o;}C=this._oCatalogTiles[v.vizId];if(!C){o=new b({visualizationId:v.vizId,vizType:c.empty,state:L.Error});o.load();return o;}}var t=this._getPlatform(C,v);switch(t){case c.local:e=this._prepareLocalConfig(v,C);o=new V(e.oInitData);break;default:e=this._prepareDefaultConfig(v,C);o=new a(e.oInitData);break;}if(!v.deferLoading){o.load(e.oAdditionalData);}return o;};d.prototype._getPlatform=function(C,v){var t=c.default;if(C){if(C.getChip!==undefined){t=c.ABAP;}else if(C.namespace||C.tileType||C.properties||v.properties){t=c.local;}}else if(v.localLoad&&v.properties){t=c.local;}return t;};d.prototype._prepareDefaultConfig=function(v,e){var o={oInitData:{catalogTile:e,visualizationId:v.vizId,vizType:c.default}};return o;};d.prototype._prepareLocalConfig=function(v,e){var o={oInitData:{catalogTile:e,visualizationId:v.vizId,vizType:c.local}};if(v.properties){o.oAdditionalData={};o.oAdditionalData.properties=v.properties;o.oAdditionalData.mode=v.mode;o.oAdditionalData.namespace=v.namespace;o.oAdditionalData.path=v.path;o.oAdditionalData.moduleType=v.moduleType;o.oAdditionalData.moduleName=v.moduleName;o.oAdditionalData.tileType=v.tileType||"sap.ushell.ui.tile.StaticTile";o.oAdditionalData.keywords=v.keywords||[];}return o;};d.prototype._getBookmarkChipInstance=function(v){var D="X-SAP-UI2-CHIP:/UI2/DYNAMIC_APPLAUNCHER",s="X-SAP-UI2-CHIP:/UI2/STATIC_APPLAUNCHER",e="/sap/bc/ui5_ui5/ui2/ushell/chips/applauncher_dynamic.chip.xml",S="/sap/bc/ui5_ui5/ui2/ushell/chips/applauncher.chip.xml",C=s,f=S,o={display_icon_url:v.icon||"",display_info_text:v.info||"",display_subtitle_text:v.subtitle||"",display_title_text:v.title,navigation_target_url:v.url,navigation_use_semantic_object:false},F=sap.ushell.Container.getService("PageBuilding").getFactory(),g,u,l=new U(),B,h,t=sap.ushell.Container.getService("VisualizationDataProvider")._getAdapter().getTargetMappingSupport();B=new U(v.url);if(v.url&&(v.url[0]==="#"||B.host()+B.path()===l.host()+l.path())){u=sap.ushell.Container.getService("URLParsing");h=u.parseShellHash(u.getShellHash(v.url));if(h&&t.get(h.semanticObject+"-"+h.action)!==undefined){o.navigation_use_semantic_object=true;o.navigation_semantic_object=h.semanticObject;o.navigation_semantic_action=h.action;o.navigation_semantic_parameters=u.paramsToString(h.params);}}if(v.serviceUrl){f=e;C=D;o.display_number_unit=v.numberUnit;o.service_refresh_interval=v.serviceRefreshInterval||0;o.service_url=v.serviceUrl;}g=F.createChipInstance({chipId:C,Chip:{id:C,baseChipId:C,catalogId:"/UI2/CATALOG_ALL",url:f},pageId:"",title:v.title,configuration:JSON.stringify({tileConfiguration:JSON.stringify(o)}),layoutData:""});g.getBag("tileProperties").setText("display_title_text",o.display_title_text||"");g.getBag("tileProperties").setText("display_subtitle_text",o.display_subtitle_text||"");g.getBag("tileProperties").setText("display_info_text",o.display_info_text||"");return g;};d.hasNoAdapter=true;return d;});
