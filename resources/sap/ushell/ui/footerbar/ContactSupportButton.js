// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/ui/launchpad/ActionItem","sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/Device","./ContactSupportButtonRenderer"],function(m,r,A,a,q,L,D){"use strict";var B=m.ButtonType;var C=a.extend("sap.ushell.ui.footerbar.ContactSupportButton",{metadata:{library:"sap.ushell"}});C.prototype.init=function(){if(a.prototype.init){a.prototype.init.apply(this,arguments);}this.setIcon("sap-icon://email");this.setText(r.i18n.getText("contactSupportBtn"));this.attachPress(this.showContactSupportDialog);this.setEnabled();};C.prototype.showContactSupportDialog=function(){sap.ui.require(["sap/ui/layout/form/SimpleForm","sap/ui/layout/form/SimpleFormLayout","sap/m/TextArea","sap/m/Link","sap/m/Label","sap/m/Text","sap/m/Dialog","sap/m/Button","sap/ushell/UserActivityLog"],function(S,b,T,c,d,e,f,g,U){var h="",u="",i="",j=[],o,k;k=function(){this.oDialog.removeContent(this.oBottomSimpleForm.getId());this.oBottomSimpleForm.destroy();if(this.oClientContext.navigationData.applicationInformation){h=this.oClientContext.navigationData.applicationInformation.applicationType;u=this.oClientContext.navigationData.applicationInformation.url;i=this.oClientContext.navigationData.applicationInformation.additionalInformation;}j.push(new e({text:this.translationBundle.getText("loginDetails")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));j.push(new d({text:this.translationBundle.getText("userFld")}));j.push(new e({text:this.oClientContext.userDetails.fullName||""}));j.push(new d({text:this.translationBundle.getText("serverFld")}));j.push(new e({text:window.location.host}));if(this.oClientContext.userDetails.eMail&&this.oClientContext.userDetails.eMail!==""){j.push(new d({text:this.translationBundle.getText("eMailFld")}));j.push(new e({text:this.oClientContext.userDetails.eMail||""}));}j.push(new d({text:this.translationBundle.getText("languageFld")}));j.push(new e({text:this.oClientContext.userDetails.Language||""}));if(this.oClientContext.shellState==="app"||this.oClientContext.shellState==="standalone"){j.push(new e({text:""}));j.push(new e({text:this.translationBundle.getText("navigationDataFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));j.push(new d({text:this.translationBundle.getText("hashFld")}));j.push(new e({text:this.oClientContext.navigationData.navigationHash||""}));j.push(new e({text:""}));j.push(new e({text:this.translationBundle.getText("applicationInformationFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));j.push(new d({text:this.translationBundle.getText("applicationTypeFld")}));j.push(new e({text:h}));j.push(new d({text:this.translationBundle.getText("urlFld")}));j.push(new e({text:u}));j.push(new d({text:this.translationBundle.getText("additionalInfoFld")}));j.push(new e({text:i}));}this.oBottomSimpleForm=new S("technicalInfoBox",{layout:b.ResponsiveLayout,content:j}).addStyleClass("sapUshellTechnicalInfoBox");if(D.os.ios&&D.system.phone){this.oBottomSimpleForm.addStyleClass("sapUshellContactSupportFixWidth");}o=this.oBottomSimpleForm.onAfterRendering;this.oBottomSimpleForm.onAfterRendering=function(){o.apply(this,arguments);var n=q(this.getDomRef());n.attr("tabIndex",0);setTimeout(function(){this.focus();}.bind(n),700);};this.oDialog.addContent(this.oBottomSimpleForm);}.bind(this);this._embedLoginDetailsInBottomForm=k;this.translationBundle=r.i18n;this.oClientContext=U.getMessageInfo();this.oLink=new c({text:this.translationBundle.getText("technicalDataLink")});this.oBottomSimpleForm=new S("bottomForm",{editable:false,content:[this.oLink]});this.sendButton=new g("contactSupportSendBtn",{text:this.translationBundle.getText("sendBtn"),type:B.Emphasized,enabled:false,press:function(){var s=sap.ushell.Container.getService("SupportTicket"),t=this.oTextArea.getValue(),l={text:t,clientContext:this.oClientContext},p=s.createTicket(l);p.done(function(){sap.ushell.Container.getService("Message").info(this.translationBundle.getText("supportTicketCreationSuccess"));}.bind(this));p.fail(function(){sap.ushell.Container.getService("Message").error(this.translationBundle.getText("supportTicketCreationFailed"));}.bind(this));this.oDialog.close();}.bind(this)});this.cancelButton=new g("contactSupportCancelBtn",{text:this.translationBundle.getText("cancelBtn"),press:function(){this.oDialog.close();}.bind(this)});this.oTextArea=new T("textArea",{rows:7,liveChange:function(){if(/\S/.test(this.oTextArea.getValue())){this.sendButton.setEnabled(true);}else{this.sendButton.setEnabled(false);this.oTextArea.setValue("");}}.bind(this)});this.oTopSimpleForm=new S("topForm",{editable:false,content:[this.oTextArea],layout:b.ResponsiveGridLayout});this.oDialog=new f({id:"ContactSupportDialog",title:this.translationBundle.getText("contactSupportBtn"),contentWidth:"29.6rem",leftButton:this.sendButton,rightButton:this.cancelButton,initialFocus:"textArea",afterOpen:function(){q("#textArea").on("focusout",function(){window.scrollTo(0,0);});},afterClose:function(){this.oDialog.destroy();if(window.document.activeElement&&window.document.activeElement.tagName==="BODY"){window.document.getElementById("meAreaHeaderButton").focus();}}.bind(this)}).addStyleClass("sapUshellContactSupportDialog").addStyleClass("sapContrastPlus");this.oTextArea.setPlaceholder(this.translationBundle.getText("txtAreaPlaceHolderHeader"));this.oLink.attachPress(k.bind(this));this.oDialog.addCustomData(new A({key:"aria-label",value:this.translationBundle.getText("ContactSupportArialLabel"),writeToDom:true}));this.oDialog.addContent(this.oTopSimpleForm);this.oDialog.addContent(this.oBottomSimpleForm);this.oDialog.open();}.bind(this));};C.prototype.setEnabled=function(e){if(!sap.ushell.Container){if(this.getEnabled()){L.warning("Disabling 'Contact Support' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.ContactSupportButton");}e=false;}a.prototype.setEnabled.call(this,e);};return C;});
