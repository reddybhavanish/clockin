// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["./abap.bootstrap.utils","sap/ui/thirdparty/jquery","sap/base/util/UriParameters"],function(a,q,U){"use strict";var p={},S="/sap/opu/odata/UI2/PAGE_BUILDER_PERS",b="Pages/PageChipInstances/Chip/ChipBags/ChipProperties,"+"Pages/PageChipInstances/RemoteCatalog,"+"Pages/PageChipInstances/ChipInstanceBags/ChipInstanceProperties,"+"AssignedPages,DefaultPage",c="PageSets('%2FUI2%2FFiori2LaunchpadHome')";var s=a.isSapStatisticsSet();function r(o,n){if(n){return;}var P=g(o),D=h(P);i(P,o,function(j,C,R){f(D,j,C,R);});}function g(o){var u=a.getUrlParameterValue("sap-ui2-cache-disable");if(u&&o&&o.services&&o.services.pbFioriHome){o.services.pbFioriHome["sap-ui2-cache-disable"]=u;}return d(o,"pbFioriHome",S,c,b);}function d(o,j,F,k,l){var m,n,t=false;if(o.services){if(o.services[j]){n=o.services[j];}else{n={};o.services[j]=n;t=true;}}else{n={};o.services={};o.services[j]=n;t=true;}if(!n.baseUrl||!n.relativeUrl){n.baseUrl=F;n.relativeUrl=k;t=true;}if(t){q.sap.log.warning("URL for "+j+" service not found in startup service result; fallback to default; cache invalidation might fail",null,"sap.ushell_abap.bootstrap");}if(n.baseUrl.lastIndexOf("/")!==n.baseUrl.length-1){n.baseUrl+="/";}if(n.relativeUrl[0]==="/"){n.relativeUrl=n.relativeUrl.slice(1);}m=n.baseUrl+n.relativeUrl;if(!/\$expand=/.test(m)&&l){m+=(m.indexOf("?")<0?"?":"&")+"$expand="+l;}if(n.cacheId){m+=(m.indexOf("?")<0?"?":"&")+"sap-cache-id="+n.cacheId;}if(n["sap-ui2-cache-disable"]){m+=(m.indexOf("?")<0?"?":"&")+"sap-ui2-cache-disable="+n["sap-ui2-cache-disable"];}var L=e("sap-language");if(L){m+=(m.indexOf("?")<0?"?":"&")+"sap-language="+L;}return m;}function e(P){return U.fromURL(window.location.href.split("#")[0]).get(P);}function f(D,j,C,R){if(j===200){D.resolve(JSON.parse(R).d,C);}else{D.reject(R);}}function h(u){var D=new q.Deferred();sap.ui.require(["sap/ui/thirdparty/datajs"],function(j){OData.read.$cache=OData.read.$cache||new sap.ui2.srvc.Map();OData.read.$cache.put(u,D.promise());});return D;}function i(u,o,C){var x;x=a.createAndOpenXHR(u,o);x.setRequestHeader("X-CSRF-Token","fetch");if(s){x.setRequestHeader("sap-statistics","true");}x.onreadystatechange=function(){if(this.readyState!==4){return;}C(x.status,x.getResponseHeader("x-csrf-token"),x.responseText);};x.send();}p.requestPageSet=r;p._getAndAdjustServiceURL=d;p._getAndAdjustPageSetServiceURL=g;p._setSapStatistics=function(v){s=v;};return p;});
